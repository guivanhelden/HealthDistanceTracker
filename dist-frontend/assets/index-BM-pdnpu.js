var $M=t=>{throw TypeError(t)};var r5=(t,e,s)=>e.has(t)||$M("Cannot "+s);var zt=(t,e,s)=>(r5(t,e,"read from private field"),s?s.call(t):e.get(t)),Br=(t,e,s)=>e.has(t)?$M("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),hr=(t,e,s,a)=>(r5(t,e,"write to private field"),a?a.call(t,s):e.set(t,s),s),wi=(t,e,s)=>(r5(t,e,"access private method"),s);var $1=(t,e,s,a)=>({set _(d){hr(t,e,d,s)},get _(){return zt(t,e,a)}});function n7(t,e){for(var s=0;s<e.length;s++){const a=e[s];if(typeof a!="string"&&!Array.isArray(a)){for(const d in a)if(d!=="default"&&!(d in t)){const g=Object.getOwnPropertyDescriptor(a,d);g&&Object.defineProperty(t,d,g.get?g:{enumerable:!0,get:()=>a[d]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const v of g.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&a(v)}).observe(document,{childList:!0,subtree:!0});function s(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function a(d){if(d.ep)return;d.ep=!0;const g=s(d);fetch(d.href,g)}})();var Hc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function l3(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function r7(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var s=function a(){return this instanceof a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var d=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(s,a,d.get?d:{enumerable:!0,get:function(){return t[a]}})}),s}var $L={exports:{}},Bb={},GL={exports:{}},Ri={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tv=Symbol.for("react.element"),i7=Symbol.for("react.portal"),s7=Symbol.for("react.fragment"),o7=Symbol.for("react.strict_mode"),a7=Symbol.for("react.profiler"),l7=Symbol.for("react.provider"),c7=Symbol.for("react.context"),u7=Symbol.for("react.forward_ref"),h7=Symbol.for("react.suspense"),d7=Symbol.for("react.memo"),f7=Symbol.for("react.lazy"),GM=Symbol.iterator;function p7(t){return t===null||typeof t!="object"?null:(t=GM&&t[GM]||t["@@iterator"],typeof t=="function"?t:null)}var HL={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},WL=Object.assign,ZL={};function i0(t,e,s){this.props=t,this.context=e,this.refs=ZL,this.updater=s||HL}i0.prototype.isReactComponent={};i0.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};i0.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function KL(){}KL.prototype=i0.prototype;function c3(t,e,s){this.props=t,this.context=e,this.refs=ZL,this.updater=s||HL}var u3=c3.prototype=new KL;u3.constructor=c3;WL(u3,i0.prototype);u3.isPureReactComponent=!0;var HM=Array.isArray,XL=Object.prototype.hasOwnProperty,h3={current:null},YL={key:!0,ref:!0,__self:!0,__source:!0};function JL(t,e,s){var a,d={},g=null,v=null;if(e!=null)for(a in e.ref!==void 0&&(v=e.ref),e.key!==void 0&&(g=""+e.key),e)XL.call(e,a)&&!YL.hasOwnProperty(a)&&(d[a]=e[a]);var i=arguments.length-2;if(i===1)d.children=s;else if(1<i){for(var E=Array(i),k=0;k<i;k++)E[k]=arguments[k+2];d.children=E}if(t&&t.defaultProps)for(a in i=t.defaultProps,i)d[a]===void 0&&(d[a]=i[a]);return{$$typeof:Tv,type:t,key:g,ref:v,props:d,_owner:h3.current}}function m7(t,e){return{$$typeof:Tv,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function d3(t){return typeof t=="object"&&t!==null&&t.$$typeof===Tv}function g7(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return e[s]})}var WM=/\/+/g;function i5(t,e){return typeof t=="object"&&t!==null&&t.key!=null?g7(""+t.key):e.toString(36)}function Ex(t,e,s,a,d){var g=typeof t;(g==="undefined"||g==="boolean")&&(t=null);var v=!1;if(t===null)v=!0;else switch(g){case"string":case"number":v=!0;break;case"object":switch(t.$$typeof){case Tv:case i7:v=!0}}if(v)return v=t,d=d(v),t=a===""?"."+i5(v,0):a,HM(d)?(s="",t!=null&&(s=t.replace(WM,"$&/")+"/"),Ex(d,e,s,"",function(k){return k})):d!=null&&(d3(d)&&(d=m7(d,s+(!d.key||v&&v.key===d.key?"":(""+d.key).replace(WM,"$&/")+"/")+t)),e.push(d)),1;if(v=0,a=a===""?".":a+":",HM(t))for(var i=0;i<t.length;i++){g=t[i];var E=a+i5(g,i);v+=Ex(g,e,s,E,d)}else if(E=p7(t),typeof E=="function")for(t=E.call(t),i=0;!(g=t.next()).done;)g=g.value,E=a+i5(g,i++),v+=Ex(g,e,s,E,d);else if(g==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return v}function G1(t,e,s){if(t==null)return t;var a=[],d=0;return Ex(t,a,"","",function(g){return e.call(s,g,d++)}),a}function _7(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ul={current:null},Cx={transition:null},y7={ReactCurrentDispatcher:Ul,ReactCurrentBatchConfig:Cx,ReactCurrentOwner:h3};function QL(){throw Error("act(...) is not supported in production builds of React.")}Ri.Children={map:G1,forEach:function(t,e,s){G1(t,function(){e.apply(this,arguments)},s)},count:function(t){var e=0;return G1(t,function(){e++}),e},toArray:function(t){return G1(t,function(e){return e})||[]},only:function(t){if(!d3(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ri.Component=i0;Ri.Fragment=s7;Ri.Profiler=a7;Ri.PureComponent=c3;Ri.StrictMode=o7;Ri.Suspense=h7;Ri.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y7;Ri.act=QL;Ri.cloneElement=function(t,e,s){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var a=WL({},t.props),d=t.key,g=t.ref,v=t._owner;if(e!=null){if(e.ref!==void 0&&(g=e.ref,v=h3.current),e.key!==void 0&&(d=""+e.key),t.type&&t.type.defaultProps)var i=t.type.defaultProps;for(E in e)XL.call(e,E)&&!YL.hasOwnProperty(E)&&(a[E]=e[E]===void 0&&i!==void 0?i[E]:e[E])}var E=arguments.length-2;if(E===1)a.children=s;else if(1<E){i=Array(E);for(var k=0;k<E;k++)i[k]=arguments[k+2];a.children=i}return{$$typeof:Tv,type:t.type,key:d,ref:g,props:a,_owner:v}};Ri.createContext=function(t){return t={$$typeof:c7,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:l7,_context:t},t.Consumer=t};Ri.createElement=JL;Ri.createFactory=function(t){var e=JL.bind(null,t);return e.type=t,e};Ri.createRef=function(){return{current:null}};Ri.forwardRef=function(t){return{$$typeof:u7,render:t}};Ri.isValidElement=d3;Ri.lazy=function(t){return{$$typeof:f7,_payload:{_status:-1,_result:t},_init:_7}};Ri.memo=function(t,e){return{$$typeof:d7,type:t,compare:e===void 0?null:e}};Ri.startTransition=function(t){var e=Cx.transition;Cx.transition={};try{t()}finally{Cx.transition=e}};Ri.unstable_act=QL;Ri.useCallback=function(t,e){return Ul.current.useCallback(t,e)};Ri.useContext=function(t){return Ul.current.useContext(t)};Ri.useDebugValue=function(){};Ri.useDeferredValue=function(t){return Ul.current.useDeferredValue(t)};Ri.useEffect=function(t,e){return Ul.current.useEffect(t,e)};Ri.useId=function(){return Ul.current.useId()};Ri.useImperativeHandle=function(t,e,s){return Ul.current.useImperativeHandle(t,e,s)};Ri.useInsertionEffect=function(t,e){return Ul.current.useInsertionEffect(t,e)};Ri.useLayoutEffect=function(t,e){return Ul.current.useLayoutEffect(t,e)};Ri.useMemo=function(t,e){return Ul.current.useMemo(t,e)};Ri.useReducer=function(t,e,s){return Ul.current.useReducer(t,e,s)};Ri.useRef=function(t){return Ul.current.useRef(t)};Ri.useState=function(t){return Ul.current.useState(t)};Ri.useSyncExternalStore=function(t,e,s){return Ul.current.useSyncExternalStore(t,e,s)};Ri.useTransition=function(){return Ul.current.useTransition()};Ri.version="18.3.1";GL.exports=Ri;var ge=GL.exports;const Vs=l3(ge),ek=n7({__proto__:null,default:Vs},[ge]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v7=ge,x7=Symbol.for("react.element"),b7=Symbol.for("react.fragment"),w7=Object.prototype.hasOwnProperty,S7=v7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,T7={key:!0,ref:!0,__self:!0,__source:!0};function tk(t,e,s){var a,d={},g=null,v=null;s!==void 0&&(g=""+s),e.key!==void 0&&(g=""+e.key),e.ref!==void 0&&(v=e.ref);for(a in e)w7.call(e,a)&&!T7.hasOwnProperty(a)&&(d[a]=e[a]);if(t&&t.defaultProps)for(a in e=t.defaultProps,e)d[a]===void 0&&(d[a]=e[a]);return{$$typeof:x7,type:t,key:g,ref:v,props:d,_owner:S7.current}}Bb.Fragment=b7;Bb.jsx=tk;Bb.jsxs=tk;$L.exports=Bb;var V=$L.exports,nk={exports:{}},Zc={},rk={exports:{}},ik={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(et,Qe){var Xe=et.length;et.push(Qe);e:for(;0<Xe;){var Vt=Xe-1>>>1,be=et[Vt];if(0<d(be,Qe))et[Vt]=Qe,et[Xe]=be,Xe=Vt;else break e}}function s(et){return et.length===0?null:et[0]}function a(et){if(et.length===0)return null;var Qe=et[0],Xe=et.pop();if(Xe!==Qe){et[0]=Xe;e:for(var Vt=0,be=et.length,Re=be>>>1;Vt<Re;){var Fe=2*(Vt+1)-1,ut=et[Fe],Et=Fe+1,Ct=et[Et];if(0>d(ut,Xe))Et<be&&0>d(Ct,ut)?(et[Vt]=Ct,et[Et]=Xe,Vt=Et):(et[Vt]=ut,et[Fe]=Xe,Vt=Fe);else if(Et<be&&0>d(Ct,Xe))et[Vt]=Ct,et[Et]=Xe,Vt=Et;else break e}}return Qe}function d(et,Qe){var Xe=et.sortIndex-Qe.sortIndex;return Xe!==0?Xe:et.id-Qe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;t.unstable_now=function(){return g.now()}}else{var v=Date,i=v.now();t.unstable_now=function(){return v.now()-i}}var E=[],k=[],O=1,z=null,G=3,U=!1,ie=!1,Q=!1,se=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,te=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(et){for(var Qe=s(k);Qe!==null;){if(Qe.callback===null)a(k);else if(Qe.startTime<=et)a(k),Qe.sortIndex=Qe.expirationTime,e(E,Qe);else break;Qe=s(k)}}function ye(et){if(Q=!1,le(et),!ie)if(s(E)!==null)ie=!0,St(Ne);else{var Qe=s(k);Qe!==null&&jt(ye,Qe.startTime-et)}}function Ne(et,Qe){ie=!1,Q&&(Q=!1,J(Me),Me=-1),U=!0;var Xe=G;try{for(le(Qe),z=s(E);z!==null&&(!(z.expirationTime>Qe)||et&&!ve());){var Vt=z.callback;if(typeof Vt=="function"){z.callback=null,G=z.priorityLevel;var be=Vt(z.expirationTime<=Qe);Qe=t.unstable_now(),typeof be=="function"?z.callback=be:z===s(E)&&a(E),le(Qe)}else a(E);z=s(E)}if(z!==null)var Re=!0;else{var Fe=s(k);Fe!==null&&jt(ye,Fe.startTime-Qe),Re=!1}return Re}finally{z=null,G=Xe,U=!1}}var rt=!1,xe=null,Me=-1,it=5,ot=-1;function ve(){return!(t.unstable_now()-ot<it)}function Le(){if(xe!==null){var et=t.unstable_now();ot=et;var Qe=!0;try{Qe=xe(!0,et)}finally{Qe?dt():(rt=!1,xe=null)}}else rt=!1}var dt;if(typeof te=="function")dt=function(){te(Le)};else if(typeof MessageChannel<"u"){var Je=new MessageChannel,yt=Je.port2;Je.port1.onmessage=Le,dt=function(){yt.postMessage(null)}}else dt=function(){se(Le,0)};function St(et){xe=et,rt||(rt=!0,dt())}function jt(et,Qe){Me=se(function(){et(t.unstable_now())},Qe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(et){et.callback=null},t.unstable_continueExecution=function(){ie||U||(ie=!0,St(Ne))},t.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<et?Math.floor(1e3/et):5},t.unstable_getCurrentPriorityLevel=function(){return G},t.unstable_getFirstCallbackNode=function(){return s(E)},t.unstable_next=function(et){switch(G){case 1:case 2:case 3:var Qe=3;break;default:Qe=G}var Xe=G;G=Qe;try{return et()}finally{G=Xe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(et,Qe){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var Xe=G;G=et;try{return Qe()}finally{G=Xe}},t.unstable_scheduleCallback=function(et,Qe,Xe){var Vt=t.unstable_now();switch(typeof Xe=="object"&&Xe!==null?(Xe=Xe.delay,Xe=typeof Xe=="number"&&0<Xe?Vt+Xe:Vt):Xe=Vt,et){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=Xe+be,et={id:O++,callback:Qe,priorityLevel:et,startTime:Xe,expirationTime:be,sortIndex:-1},Xe>Vt?(et.sortIndex=Xe,e(k,et),s(E)===null&&et===s(k)&&(Q?(J(Me),Me=-1):Q=!0,jt(ye,Xe-Vt))):(et.sortIndex=be,e(E,et),ie||U||(ie=!0,St(Ne))),et},t.unstable_shouldYield=ve,t.unstable_wrapCallback=function(et){var Qe=G;return function(){var Xe=G;G=Qe;try{return et.apply(this,arguments)}finally{G=Xe}}}})(ik);rk.exports=ik;var A7=rk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E7=ge,Wc=A7;function zn(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,s=1;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sk=new Set,Zy={};function lg(t,e){Z_(t,e),Z_(t+"Capture",e)}function Z_(t,e){for(Zy[t]=e,t=0;t<e.length;t++)sk.add(e[t])}var af=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dS=Object.prototype.hasOwnProperty,C7=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ZM={},KM={};function P7(t){return dS.call(KM,t)?!0:dS.call(ZM,t)?!1:C7.test(t)?KM[t]=!0:(ZM[t]=!0,!1)}function M7(t,e,s,a){if(s!==null&&s.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return a?!1:s!==null?!s.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function I7(t,e,s,a){if(e===null||typeof e>"u"||M7(t,e,s,a))return!0;if(a)return!1;if(s!==null)switch(s.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Vl(t,e,s,a,d,g,v){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=a,this.attributeNamespace=d,this.mustUseProperty=s,this.propertyName=t,this.type=e,this.sanitizeURL=g,this.removeEmptyString=v}var Fa={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Fa[t]=new Vl(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Fa[e]=new Vl(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Fa[t]=new Vl(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Fa[t]=new Vl(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Fa[t]=new Vl(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Fa[t]=new Vl(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Fa[t]=new Vl(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Fa[t]=new Vl(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Fa[t]=new Vl(t,5,!1,t.toLowerCase(),null,!1,!1)});var f3=/[\-:]([a-z])/g;function p3(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(f3,p3);Fa[e]=new Vl(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(f3,p3);Fa[e]=new Vl(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(f3,p3);Fa[e]=new Vl(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Fa[t]=new Vl(t,1,!1,t.toLowerCase(),null,!1,!1)});Fa.xlinkHref=new Vl("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Fa[t]=new Vl(t,1,!1,t.toLowerCase(),null,!0,!0)});function m3(t,e,s,a){var d=Fa.hasOwnProperty(e)?Fa[e]:null;(d!==null?d.type!==0:a||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(I7(e,s,d,a)&&(s=null),a||d===null?P7(e)&&(s===null?t.removeAttribute(e):t.setAttribute(e,""+s)):d.mustUseProperty?t[d.propertyName]=s===null?d.type===3?!1:"":s:(e=d.attributeName,a=d.attributeNamespace,s===null?t.removeAttribute(e):(d=d.type,s=d===3||d===4&&s===!0?"":""+s,a?t.setAttributeNS(a,e,s):t.setAttribute(e,s))))}var mf=E7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,H1=Symbol.for("react.element"),s_=Symbol.for("react.portal"),o_=Symbol.for("react.fragment"),g3=Symbol.for("react.strict_mode"),fS=Symbol.for("react.profiler"),ok=Symbol.for("react.provider"),ak=Symbol.for("react.context"),_3=Symbol.for("react.forward_ref"),pS=Symbol.for("react.suspense"),mS=Symbol.for("react.suspense_list"),y3=Symbol.for("react.memo"),rp=Symbol.for("react.lazy"),lk=Symbol.for("react.offscreen"),XM=Symbol.iterator;function uy(t){return t===null||typeof t!="object"?null:(t=XM&&t[XM]||t["@@iterator"],typeof t=="function"?t:null)}var uo=Object.assign,s5;function Ty(t){if(s5===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);s5=e&&e[1]||""}return`
`+s5+t}var o5=!1;function a5(t,e){if(!t||o5)return"";o5=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(k){var a=k}Reflect.construct(t,[],e)}else{try{e.call()}catch(k){a=k}t.call(e.prototype)}else{try{throw Error()}catch(k){a=k}t()}}catch(k){if(k&&a&&typeof k.stack=="string"){for(var d=k.stack.split(`
`),g=a.stack.split(`
`),v=d.length-1,i=g.length-1;1<=v&&0<=i&&d[v]!==g[i];)i--;for(;1<=v&&0<=i;v--,i--)if(d[v]!==g[i]){if(v!==1||i!==1)do if(v--,i--,0>i||d[v]!==g[i]){var E=`
`+d[v].replace(" at new "," at ");return t.displayName&&E.includes("<anonymous>")&&(E=E.replace("<anonymous>",t.displayName)),E}while(1<=v&&0<=i);break}}}finally{o5=!1,Error.prepareStackTrace=s}return(t=t?t.displayName||t.name:"")?Ty(t):""}function L7(t){switch(t.tag){case 5:return Ty(t.type);case 16:return Ty("Lazy");case 13:return Ty("Suspense");case 19:return Ty("SuspenseList");case 0:case 2:case 15:return t=a5(t.type,!1),t;case 11:return t=a5(t.type.render,!1),t;case 1:return t=a5(t.type,!0),t;default:return""}}function gS(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case o_:return"Fragment";case s_:return"Portal";case fS:return"Profiler";case g3:return"StrictMode";case pS:return"Suspense";case mS:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case ak:return(t.displayName||"Context")+".Consumer";case ok:return(t._context.displayName||"Context")+".Provider";case _3:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case y3:return e=t.displayName||null,e!==null?e:gS(t.type)||"Memo";case rp:e=t._payload,t=t._init;try{return gS(t(e))}catch{}}return null}function k7(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gS(e);case 8:return e===g3?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ip(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ck(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function R7(t){var e=ck(t)?"checked":"value",s=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),a=""+t[e];if(!t.hasOwnProperty(e)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var d=s.get,g=s.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return d.call(this)},set:function(v){a=""+v,g.call(this,v)}}),Object.defineProperty(t,e,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(v){a=""+v},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function W1(t){t._valueTracker||(t._valueTracker=R7(t))}function uk(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var s=e.getValue(),a="";return t&&(a=ck(t)?t.checked?"true":"false":t.value),t=a,t!==s?(e.setValue(t),!0):!1}function Yx(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function _S(t,e){var s=e.checked;return uo({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??t._wrapperState.initialChecked})}function YM(t,e){var s=e.defaultValue==null?"":e.defaultValue,a=e.checked!=null?e.checked:e.defaultChecked;s=Ip(e.value!=null?e.value:s),t._wrapperState={initialChecked:a,initialValue:s,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function hk(t,e){e=e.checked,e!=null&&m3(t,"checked",e,!1)}function yS(t,e){hk(t,e);var s=Ip(e.value),a=e.type;if(s!=null)a==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+s):t.value!==""+s&&(t.value=""+s);else if(a==="submit"||a==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?vS(t,e.type,s):e.hasOwnProperty("defaultValue")&&vS(t,e.type,Ip(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function JM(t,e,s){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var a=e.type;if(!(a!=="submit"&&a!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,s||e===t.value||(t.value=e),t.defaultValue=e}s=t.name,s!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,s!==""&&(t.name=s)}function vS(t,e,s){(e!=="number"||Yx(t.ownerDocument)!==t)&&(s==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+s&&(t.defaultValue=""+s))}var Ay=Array.isArray;function v_(t,e,s,a){if(t=t.options,e){e={};for(var d=0;d<s.length;d++)e["$"+s[d]]=!0;for(s=0;s<t.length;s++)d=e.hasOwnProperty("$"+t[s].value),t[s].selected!==d&&(t[s].selected=d),d&&a&&(t[s].defaultSelected=!0)}else{for(s=""+Ip(s),e=null,d=0;d<t.length;d++){if(t[d].value===s){t[d].selected=!0,a&&(t[d].defaultSelected=!0);return}e!==null||t[d].disabled||(e=t[d])}e!==null&&(e.selected=!0)}}function xS(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(zn(91));return uo({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function QM(t,e){var s=e.value;if(s==null){if(s=e.children,e=e.defaultValue,s!=null){if(e!=null)throw Error(zn(92));if(Ay(s)){if(1<s.length)throw Error(zn(93));s=s[0]}e=s}e==null&&(e=""),s=e}t._wrapperState={initialValue:Ip(s)}}function dk(t,e){var s=Ip(e.value),a=Ip(e.defaultValue);s!=null&&(s=""+s,s!==t.value&&(t.value=s),e.defaultValue==null&&t.defaultValue!==s&&(t.defaultValue=s)),a!=null&&(t.defaultValue=""+a)}function eI(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function fk(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function bS(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?fk(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Z1,pk=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,s,a,d){MSApp.execUnsafeLocalFunction(function(){return t(e,s,a,d)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Z1=Z1||document.createElement("div"),Z1.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Z1.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ky(t,e){if(e){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=e;return}}t.textContent=e}var Ry={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},D7=["Webkit","ms","Moz","O"];Object.keys(Ry).forEach(function(t){D7.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ry[e]=Ry[t]})});function mk(t,e,s){return e==null||typeof e=="boolean"||e===""?"":s||typeof e!="number"||e===0||Ry.hasOwnProperty(t)&&Ry[t]?(""+e).trim():e+"px"}function gk(t,e){t=t.style;for(var s in e)if(e.hasOwnProperty(s)){var a=s.indexOf("--")===0,d=mk(s,e[s],a);s==="float"&&(s="cssFloat"),a?t.setProperty(s,d):t[s]=d}}var N7=uo({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wS(t,e){if(e){if(N7[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(zn(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(zn(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(zn(61))}if(e.style!=null&&typeof e.style!="object")throw Error(zn(62))}}function SS(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var TS=null;function v3(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var AS=null,x_=null,b_=null;function tI(t){if(t=Cv(t)){if(typeof AS!="function")throw Error(zn(280));var e=t.stateNode;e&&(e=$b(e),AS(t.stateNode,t.type,e))}}function _k(t){x_?b_?b_.push(t):b_=[t]:x_=t}function yk(){if(x_){var t=x_,e=b_;if(b_=x_=null,tI(t),e)for(t=0;t<e.length;t++)tI(e[t])}}function vk(t,e){return t(e)}function xk(){}var l5=!1;function bk(t,e,s){if(l5)return t(e,s);l5=!0;try{return vk(t,e,s)}finally{l5=!1,(x_!==null||b_!==null)&&(xk(),yk())}}function Xy(t,e){var s=t.stateNode;if(s===null)return null;var a=$b(s);if(a===null)return null;s=a[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(t=t.type,a=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!a;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(zn(231,e,typeof s));return s}var ES=!1;if(af)try{var hy={};Object.defineProperty(hy,"passive",{get:function(){ES=!0}}),window.addEventListener("test",hy,hy),window.removeEventListener("test",hy,hy)}catch{ES=!1}function O7(t,e,s,a,d,g,v,i,E){var k=Array.prototype.slice.call(arguments,3);try{e.apply(s,k)}catch(O){this.onError(O)}}var Dy=!1,Jx=null,Qx=!1,CS=null,z7={onError:function(t){Dy=!0,Jx=t}};function F7(t,e,s,a,d,g,v,i,E){Dy=!1,Jx=null,O7.apply(z7,arguments)}function B7(t,e,s,a,d,g,v,i,E){if(F7.apply(this,arguments),Dy){if(Dy){var k=Jx;Dy=!1,Jx=null}else throw Error(zn(198));Qx||(Qx=!0,CS=k)}}function cg(t){var e=t,s=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(s=e.return),t=e.return;while(t)}return e.tag===3?s:null}function wk(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function nI(t){if(cg(t)!==t)throw Error(zn(188))}function j7(t){var e=t.alternate;if(!e){if(e=cg(t),e===null)throw Error(zn(188));return e!==t?null:t}for(var s=t,a=e;;){var d=s.return;if(d===null)break;var g=d.alternate;if(g===null){if(a=d.return,a!==null){s=a;continue}break}if(d.child===g.child){for(g=d.child;g;){if(g===s)return nI(d),t;if(g===a)return nI(d),e;g=g.sibling}throw Error(zn(188))}if(s.return!==a.return)s=d,a=g;else{for(var v=!1,i=d.child;i;){if(i===s){v=!0,s=d,a=g;break}if(i===a){v=!0,a=d,s=g;break}i=i.sibling}if(!v){for(i=g.child;i;){if(i===s){v=!0,s=g,a=d;break}if(i===a){v=!0,a=g,s=d;break}i=i.sibling}if(!v)throw Error(zn(189))}}if(s.alternate!==a)throw Error(zn(190))}if(s.tag!==3)throw Error(zn(188));return s.stateNode.current===s?t:e}function Sk(t){return t=j7(t),t!==null?Tk(t):null}function Tk(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Tk(t);if(e!==null)return e;t=t.sibling}return null}var Ak=Wc.unstable_scheduleCallback,rI=Wc.unstable_cancelCallback,U7=Wc.unstable_shouldYield,V7=Wc.unstable_requestPaint,Lo=Wc.unstable_now,q7=Wc.unstable_getCurrentPriorityLevel,x3=Wc.unstable_ImmediatePriority,Ek=Wc.unstable_UserBlockingPriority,eb=Wc.unstable_NormalPriority,$7=Wc.unstable_LowPriority,Ck=Wc.unstable_IdlePriority,jb=null,nd=null;function G7(t){if(nd&&typeof nd.onCommitFiberRoot=="function")try{nd.onCommitFiberRoot(jb,t,void 0,(t.current.flags&128)===128)}catch{}}var uh=Math.clz32?Math.clz32:Z7,H7=Math.log,W7=Math.LN2;function Z7(t){return t>>>=0,t===0?32:31-(H7(t)/W7|0)|0}var K1=64,X1=4194304;function Ey(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function tb(t,e){var s=t.pendingLanes;if(s===0)return 0;var a=0,d=t.suspendedLanes,g=t.pingedLanes,v=s&268435455;if(v!==0){var i=v&~d;i!==0?a=Ey(i):(g&=v,g!==0&&(a=Ey(g)))}else v=s&~d,v!==0?a=Ey(v):g!==0&&(a=Ey(g));if(a===0)return 0;if(e!==0&&e!==a&&!(e&d)&&(d=a&-a,g=e&-e,d>=g||d===16&&(g&4194240)!==0))return e;if(a&4&&(a|=s&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=a;0<e;)s=31-uh(e),d=1<<s,a|=t[s],e&=~d;return a}function K7(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function X7(t,e){for(var s=t.suspendedLanes,a=t.pingedLanes,d=t.expirationTimes,g=t.pendingLanes;0<g;){var v=31-uh(g),i=1<<v,E=d[v];E===-1?(!(i&s)||i&a)&&(d[v]=K7(i,e)):E<=e&&(t.expiredLanes|=i),g&=~i}}function PS(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Pk(){var t=K1;return K1<<=1,!(K1&4194240)&&(K1=64),t}function c5(t){for(var e=[],s=0;31>s;s++)e.push(t);return e}function Av(t,e,s){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-uh(e),t[e]=s}function Y7(t,e){var s=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var a=t.eventTimes;for(t=t.expirationTimes;0<s;){var d=31-uh(s),g=1<<d;e[d]=0,a[d]=-1,t[d]=-1,s&=~g}}function b3(t,e){var s=t.entangledLanes|=e;for(t=t.entanglements;s;){var a=31-uh(s),d=1<<a;d&e|t[a]&e&&(t[a]|=e),s&=~d}}var us=0;function Mk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Ik,w3,Lk,kk,Rk,MS=!1,Y1=[],wp=null,Sp=null,Tp=null,Yy=new Map,Jy=new Map,op=[],J7="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function iI(t,e){switch(t){case"focusin":case"focusout":wp=null;break;case"dragenter":case"dragleave":Sp=null;break;case"mouseover":case"mouseout":Tp=null;break;case"pointerover":case"pointerout":Yy.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jy.delete(e.pointerId)}}function dy(t,e,s,a,d,g){return t===null||t.nativeEvent!==g?(t={blockedOn:e,domEventName:s,eventSystemFlags:a,nativeEvent:g,targetContainers:[d]},e!==null&&(e=Cv(e),e!==null&&w3(e)),t):(t.eventSystemFlags|=a,e=t.targetContainers,d!==null&&e.indexOf(d)===-1&&e.push(d),t)}function Q7(t,e,s,a,d){switch(e){case"focusin":return wp=dy(wp,t,e,s,a,d),!0;case"dragenter":return Sp=dy(Sp,t,e,s,a,d),!0;case"mouseover":return Tp=dy(Tp,t,e,s,a,d),!0;case"pointerover":var g=d.pointerId;return Yy.set(g,dy(Yy.get(g)||null,t,e,s,a,d)),!0;case"gotpointercapture":return g=d.pointerId,Jy.set(g,dy(Jy.get(g)||null,t,e,s,a,d)),!0}return!1}function Dk(t){var e=Fm(t.target);if(e!==null){var s=cg(e);if(s!==null){if(e=s.tag,e===13){if(e=wk(s),e!==null){t.blockedOn=e,Rk(t.priority,function(){Lk(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Px(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var s=IS(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(s===null){s=t.nativeEvent;var a=new s.constructor(s.type,s);TS=a,s.target.dispatchEvent(a),TS=null}else return e=Cv(s),e!==null&&w3(e),t.blockedOn=s,!1;e.shift()}return!0}function sI(t,e,s){Px(t)&&s.delete(e)}function eU(){MS=!1,wp!==null&&Px(wp)&&(wp=null),Sp!==null&&Px(Sp)&&(Sp=null),Tp!==null&&Px(Tp)&&(Tp=null),Yy.forEach(sI),Jy.forEach(sI)}function fy(t,e){t.blockedOn===e&&(t.blockedOn=null,MS||(MS=!0,Wc.unstable_scheduleCallback(Wc.unstable_NormalPriority,eU)))}function Qy(t){function e(d){return fy(d,t)}if(0<Y1.length){fy(Y1[0],t);for(var s=1;s<Y1.length;s++){var a=Y1[s];a.blockedOn===t&&(a.blockedOn=null)}}for(wp!==null&&fy(wp,t),Sp!==null&&fy(Sp,t),Tp!==null&&fy(Tp,t),Yy.forEach(e),Jy.forEach(e),s=0;s<op.length;s++)a=op[s],a.blockedOn===t&&(a.blockedOn=null);for(;0<op.length&&(s=op[0],s.blockedOn===null);)Dk(s),s.blockedOn===null&&op.shift()}var w_=mf.ReactCurrentBatchConfig,nb=!0;function tU(t,e,s,a){var d=us,g=w_.transition;w_.transition=null;try{us=1,S3(t,e,s,a)}finally{us=d,w_.transition=g}}function nU(t,e,s,a){var d=us,g=w_.transition;w_.transition=null;try{us=4,S3(t,e,s,a)}finally{us=d,w_.transition=g}}function S3(t,e,s,a){if(nb){var d=IS(t,e,s,a);if(d===null)v5(t,e,a,rb,s),iI(t,a);else if(Q7(d,t,e,s,a))a.stopPropagation();else if(iI(t,a),e&4&&-1<J7.indexOf(t)){for(;d!==null;){var g=Cv(d);if(g!==null&&Ik(g),g=IS(t,e,s,a),g===null&&v5(t,e,a,rb,s),g===d)break;d=g}d!==null&&a.stopPropagation()}else v5(t,e,a,null,s)}}var rb=null;function IS(t,e,s,a){if(rb=null,t=v3(a),t=Fm(t),t!==null)if(e=cg(t),e===null)t=null;else if(s=e.tag,s===13){if(t=wk(e),t!==null)return t;t=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return rb=t,null}function Nk(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(q7()){case x3:return 1;case Ek:return 4;case eb:case $7:return 16;case Ck:return 536870912;default:return 16}default:return 16}}var vp=null,T3=null,Mx=null;function Ok(){if(Mx)return Mx;var t,e=T3,s=e.length,a,d="value"in vp?vp.value:vp.textContent,g=d.length;for(t=0;t<s&&e[t]===d[t];t++);var v=s-t;for(a=1;a<=v&&e[s-a]===d[g-a];a++);return Mx=d.slice(t,1<a?1-a:void 0)}function Ix(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function J1(){return!0}function oI(){return!1}function Kc(t){function e(s,a,d,g,v){this._reactName=s,this._targetInst=d,this.type=a,this.nativeEvent=g,this.target=v,this.currentTarget=null;for(var i in t)t.hasOwnProperty(i)&&(s=t[i],this[i]=s?s(g):g[i]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?J1:oI,this.isPropagationStopped=oI,this}return uo(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=J1)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=J1)},persist:function(){},isPersistent:J1}),e}var s0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},A3=Kc(s0),Ev=uo({},s0,{view:0,detail:0}),rU=Kc(Ev),u5,h5,py,Ub=uo({},Ev,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:E3,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==py&&(py&&t.type==="mousemove"?(u5=t.screenX-py.screenX,h5=t.screenY-py.screenY):h5=u5=0,py=t),u5)},movementY:function(t){return"movementY"in t?t.movementY:h5}}),aI=Kc(Ub),iU=uo({},Ub,{dataTransfer:0}),sU=Kc(iU),oU=uo({},Ev,{relatedTarget:0}),d5=Kc(oU),aU=uo({},s0,{animationName:0,elapsedTime:0,pseudoElement:0}),lU=Kc(aU),cU=uo({},s0,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),uU=Kc(cU),hU=uo({},s0,{data:0}),lI=Kc(hU),dU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mU(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=pU[t])?!!e[t]:!1}function E3(){return mU}var gU=uo({},Ev,{key:function(t){if(t.key){var e=dU[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ix(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?fU[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:E3,charCode:function(t){return t.type==="keypress"?Ix(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ix(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),_U=Kc(gU),yU=uo({},Ub,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cI=Kc(yU),vU=uo({},Ev,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:E3}),xU=Kc(vU),bU=uo({},s0,{propertyName:0,elapsedTime:0,pseudoElement:0}),wU=Kc(bU),SU=uo({},Ub,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),TU=Kc(SU),AU=[9,13,27,32],C3=af&&"CompositionEvent"in window,Ny=null;af&&"documentMode"in document&&(Ny=document.documentMode);var EU=af&&"TextEvent"in window&&!Ny,zk=af&&(!C3||Ny&&8<Ny&&11>=Ny),uI=" ",hI=!1;function Fk(t,e){switch(t){case"keyup":return AU.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bk(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var a_=!1;function CU(t,e){switch(t){case"compositionend":return Bk(e);case"keypress":return e.which!==32?null:(hI=!0,uI);case"textInput":return t=e.data,t===uI&&hI?null:t;default:return null}}function PU(t,e){if(a_)return t==="compositionend"||!C3&&Fk(t,e)?(t=Ok(),Mx=T3=vp=null,a_=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return zk&&e.locale!=="ko"?null:e.data;default:return null}}var MU={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dI(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!MU[t.type]:e==="textarea"}function jk(t,e,s,a){_k(a),e=ib(e,"onChange"),0<e.length&&(s=new A3("onChange","change",null,s,a),t.push({event:s,listeners:e}))}var Oy=null,ev=null;function IU(t){Yk(t,0)}function Vb(t){var e=u_(t);if(uk(e))return t}function LU(t,e){if(t==="change")return e}var Uk=!1;if(af){var f5;if(af){var p5="oninput"in document;if(!p5){var fI=document.createElement("div");fI.setAttribute("oninput","return;"),p5=typeof fI.oninput=="function"}f5=p5}else f5=!1;Uk=f5&&(!document.documentMode||9<document.documentMode)}function pI(){Oy&&(Oy.detachEvent("onpropertychange",Vk),ev=Oy=null)}function Vk(t){if(t.propertyName==="value"&&Vb(ev)){var e=[];jk(e,ev,t,v3(t)),bk(IU,e)}}function kU(t,e,s){t==="focusin"?(pI(),Oy=e,ev=s,Oy.attachEvent("onpropertychange",Vk)):t==="focusout"&&pI()}function RU(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Vb(ev)}function DU(t,e){if(t==="click")return Vb(e)}function NU(t,e){if(t==="input"||t==="change")return Vb(e)}function OU(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var dh=typeof Object.is=="function"?Object.is:OU;function tv(t,e){if(dh(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var s=Object.keys(t),a=Object.keys(e);if(s.length!==a.length)return!1;for(a=0;a<s.length;a++){var d=s[a];if(!dS.call(e,d)||!dh(t[d],e[d]))return!1}return!0}function mI(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function gI(t,e){var s=mI(t);t=0;for(var a;s;){if(s.nodeType===3){if(a=t+s.textContent.length,t<=e&&a>=e)return{node:s,offset:e-t};t=a}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=mI(s)}}function qk(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?qk(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function $k(){for(var t=window,e=Yx();e instanceof t.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)t=e.contentWindow;else break;e=Yx(t.document)}return e}function P3(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function zU(t){var e=$k(),s=t.focusedElem,a=t.selectionRange;if(e!==s&&s&&s.ownerDocument&&qk(s.ownerDocument.documentElement,s)){if(a!==null&&P3(s)){if(e=a.start,t=a.end,t===void 0&&(t=e),"selectionStart"in s)s.selectionStart=e,s.selectionEnd=Math.min(t,s.value.length);else if(t=(e=s.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var d=s.textContent.length,g=Math.min(a.start,d);a=a.end===void 0?g:Math.min(a.end,d),!t.extend&&g>a&&(d=a,a=g,g=d),d=gI(s,g);var v=gI(s,a);d&&v&&(t.rangeCount!==1||t.anchorNode!==d.node||t.anchorOffset!==d.offset||t.focusNode!==v.node||t.focusOffset!==v.offset)&&(e=e.createRange(),e.setStart(d.node,d.offset),t.removeAllRanges(),g>a?(t.addRange(e),t.extend(v.node,v.offset)):(e.setEnd(v.node,v.offset),t.addRange(e)))}}for(e=[],t=s;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<e.length;s++)t=e[s],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var FU=af&&"documentMode"in document&&11>=document.documentMode,l_=null,LS=null,zy=null,kS=!1;function _I(t,e,s){var a=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;kS||l_==null||l_!==Yx(a)||(a=l_,"selectionStart"in a&&P3(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),zy&&tv(zy,a)||(zy=a,a=ib(LS,"onSelect"),0<a.length&&(e=new A3("onSelect","select",null,e,s),t.push({event:e,listeners:a}),e.target=l_)))}function Q1(t,e){var s={};return s[t.toLowerCase()]=e.toLowerCase(),s["Webkit"+t]="webkit"+e,s["Moz"+t]="moz"+e,s}var c_={animationend:Q1("Animation","AnimationEnd"),animationiteration:Q1("Animation","AnimationIteration"),animationstart:Q1("Animation","AnimationStart"),transitionend:Q1("Transition","TransitionEnd")},m5={},Gk={};af&&(Gk=document.createElement("div").style,"AnimationEvent"in window||(delete c_.animationend.animation,delete c_.animationiteration.animation,delete c_.animationstart.animation),"TransitionEvent"in window||delete c_.transitionend.transition);function qb(t){if(m5[t])return m5[t];if(!c_[t])return t;var e=c_[t],s;for(s in e)if(e.hasOwnProperty(s)&&s in Gk)return m5[t]=e[s];return t}var Hk=qb("animationend"),Wk=qb("animationiteration"),Zk=qb("animationstart"),Kk=qb("transitionend"),Xk=new Map,yI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Bp(t,e){Xk.set(t,e),lg(e,[t])}for(var g5=0;g5<yI.length;g5++){var _5=yI[g5],BU=_5.toLowerCase(),jU=_5[0].toUpperCase()+_5.slice(1);Bp(BU,"on"+jU)}Bp(Hk,"onAnimationEnd");Bp(Wk,"onAnimationIteration");Bp(Zk,"onAnimationStart");Bp("dblclick","onDoubleClick");Bp("focusin","onFocus");Bp("focusout","onBlur");Bp(Kk,"onTransitionEnd");Z_("onMouseEnter",["mouseout","mouseover"]);Z_("onMouseLeave",["mouseout","mouseover"]);Z_("onPointerEnter",["pointerout","pointerover"]);Z_("onPointerLeave",["pointerout","pointerover"]);lg("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));lg("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));lg("onBeforeInput",["compositionend","keypress","textInput","paste"]);lg("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));lg("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));lg("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cy="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),UU=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cy));function vI(t,e,s){var a=t.type||"unknown-event";t.currentTarget=s,B7(a,e,void 0,t),t.currentTarget=null}function Yk(t,e){e=(e&4)!==0;for(var s=0;s<t.length;s++){var a=t[s],d=a.event;a=a.listeners;e:{var g=void 0;if(e)for(var v=a.length-1;0<=v;v--){var i=a[v],E=i.instance,k=i.currentTarget;if(i=i.listener,E!==g&&d.isPropagationStopped())break e;vI(d,i,k),g=E}else for(v=0;v<a.length;v++){if(i=a[v],E=i.instance,k=i.currentTarget,i=i.listener,E!==g&&d.isPropagationStopped())break e;vI(d,i,k),g=E}}}if(Qx)throw t=CS,Qx=!1,CS=null,t}function Us(t,e){var s=e[zS];s===void 0&&(s=e[zS]=new Set);var a=t+"__bubble";s.has(a)||(Jk(e,t,2,!1),s.add(a))}function y5(t,e,s){var a=0;e&&(a|=4),Jk(s,t,a,e)}var ex="_reactListening"+Math.random().toString(36).slice(2);function nv(t){if(!t[ex]){t[ex]=!0,sk.forEach(function(s){s!=="selectionchange"&&(UU.has(s)||y5(s,!1,t),y5(s,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ex]||(e[ex]=!0,y5("selectionchange",!1,e))}}function Jk(t,e,s,a){switch(Nk(e)){case 1:var d=tU;break;case 4:d=nU;break;default:d=S3}s=d.bind(null,e,s,t),d=void 0,!ES||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(d=!0),a?d!==void 0?t.addEventListener(e,s,{capture:!0,passive:d}):t.addEventListener(e,s,!0):d!==void 0?t.addEventListener(e,s,{passive:d}):t.addEventListener(e,s,!1)}function v5(t,e,s,a,d){var g=a;if(!(e&1)&&!(e&2)&&a!==null)e:for(;;){if(a===null)return;var v=a.tag;if(v===3||v===4){var i=a.stateNode.containerInfo;if(i===d||i.nodeType===8&&i.parentNode===d)break;if(v===4)for(v=a.return;v!==null;){var E=v.tag;if((E===3||E===4)&&(E=v.stateNode.containerInfo,E===d||E.nodeType===8&&E.parentNode===d))return;v=v.return}for(;i!==null;){if(v=Fm(i),v===null)return;if(E=v.tag,E===5||E===6){a=g=v;continue e}i=i.parentNode}}a=a.return}bk(function(){var k=g,O=v3(s),z=[];e:{var G=Xk.get(t);if(G!==void 0){var U=A3,ie=t;switch(t){case"keypress":if(Ix(s)===0)break e;case"keydown":case"keyup":U=_U;break;case"focusin":ie="focus",U=d5;break;case"focusout":ie="blur",U=d5;break;case"beforeblur":case"afterblur":U=d5;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":U=aI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":U=sU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":U=xU;break;case Hk:case Wk:case Zk:U=lU;break;case Kk:U=wU;break;case"scroll":U=rU;break;case"wheel":U=TU;break;case"copy":case"cut":case"paste":U=uU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":U=cI}var Q=(e&4)!==0,se=!Q&&t==="scroll",J=Q?G!==null?G+"Capture":null:G;Q=[];for(var te=k,le;te!==null;){le=te;var ye=le.stateNode;if(le.tag===5&&ye!==null&&(le=ye,J!==null&&(ye=Xy(te,J),ye!=null&&Q.push(rv(te,ye,le)))),se)break;te=te.return}0<Q.length&&(G=new U(G,ie,null,s,O),z.push({event:G,listeners:Q}))}}if(!(e&7)){e:{if(G=t==="mouseover"||t==="pointerover",U=t==="mouseout"||t==="pointerout",G&&s!==TS&&(ie=s.relatedTarget||s.fromElement)&&(Fm(ie)||ie[lf]))break e;if((U||G)&&(G=O.window===O?O:(G=O.ownerDocument)?G.defaultView||G.parentWindow:window,U?(ie=s.relatedTarget||s.toElement,U=k,ie=ie?Fm(ie):null,ie!==null&&(se=cg(ie),ie!==se||ie.tag!==5&&ie.tag!==6)&&(ie=null)):(U=null,ie=k),U!==ie)){if(Q=aI,ye="onMouseLeave",J="onMouseEnter",te="mouse",(t==="pointerout"||t==="pointerover")&&(Q=cI,ye="onPointerLeave",J="onPointerEnter",te="pointer"),se=U==null?G:u_(U),le=ie==null?G:u_(ie),G=new Q(ye,te+"leave",U,s,O),G.target=se,G.relatedTarget=le,ye=null,Fm(O)===k&&(Q=new Q(J,te+"enter",ie,s,O),Q.target=le,Q.relatedTarget=se,ye=Q),se=ye,U&&ie)t:{for(Q=U,J=ie,te=0,le=Q;le;le=Hg(le))te++;for(le=0,ye=J;ye;ye=Hg(ye))le++;for(;0<te-le;)Q=Hg(Q),te--;for(;0<le-te;)J=Hg(J),le--;for(;te--;){if(Q===J||J!==null&&Q===J.alternate)break t;Q=Hg(Q),J=Hg(J)}Q=null}else Q=null;U!==null&&xI(z,G,U,Q,!1),ie!==null&&se!==null&&xI(z,se,ie,Q,!0)}}e:{if(G=k?u_(k):window,U=G.nodeName&&G.nodeName.toLowerCase(),U==="select"||U==="input"&&G.type==="file")var Ne=LU;else if(dI(G))if(Uk)Ne=NU;else{Ne=RU;var rt=kU}else(U=G.nodeName)&&U.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(Ne=DU);if(Ne&&(Ne=Ne(t,k))){jk(z,Ne,s,O);break e}rt&&rt(t,G,k),t==="focusout"&&(rt=G._wrapperState)&&rt.controlled&&G.type==="number"&&vS(G,"number",G.value)}switch(rt=k?u_(k):window,t){case"focusin":(dI(rt)||rt.contentEditable==="true")&&(l_=rt,LS=k,zy=null);break;case"focusout":zy=LS=l_=null;break;case"mousedown":kS=!0;break;case"contextmenu":case"mouseup":case"dragend":kS=!1,_I(z,s,O);break;case"selectionchange":if(FU)break;case"keydown":case"keyup":_I(z,s,O)}var xe;if(C3)e:{switch(t){case"compositionstart":var Me="onCompositionStart";break e;case"compositionend":Me="onCompositionEnd";break e;case"compositionupdate":Me="onCompositionUpdate";break e}Me=void 0}else a_?Fk(t,s)&&(Me="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(Me="onCompositionStart");Me&&(zk&&s.locale!=="ko"&&(a_||Me!=="onCompositionStart"?Me==="onCompositionEnd"&&a_&&(xe=Ok()):(vp=O,T3="value"in vp?vp.value:vp.textContent,a_=!0)),rt=ib(k,Me),0<rt.length&&(Me=new lI(Me,t,null,s,O),z.push({event:Me,listeners:rt}),xe?Me.data=xe:(xe=Bk(s),xe!==null&&(Me.data=xe)))),(xe=EU?CU(t,s):PU(t,s))&&(k=ib(k,"onBeforeInput"),0<k.length&&(O=new lI("onBeforeInput","beforeinput",null,s,O),z.push({event:O,listeners:k}),O.data=xe))}Yk(z,e)})}function rv(t,e,s){return{instance:t,listener:e,currentTarget:s}}function ib(t,e){for(var s=e+"Capture",a=[];t!==null;){var d=t,g=d.stateNode;d.tag===5&&g!==null&&(d=g,g=Xy(t,s),g!=null&&a.unshift(rv(t,g,d)),g=Xy(t,e),g!=null&&a.push(rv(t,g,d))),t=t.return}return a}function Hg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function xI(t,e,s,a,d){for(var g=e._reactName,v=[];s!==null&&s!==a;){var i=s,E=i.alternate,k=i.stateNode;if(E!==null&&E===a)break;i.tag===5&&k!==null&&(i=k,d?(E=Xy(s,g),E!=null&&v.unshift(rv(s,E,i))):d||(E=Xy(s,g),E!=null&&v.push(rv(s,E,i)))),s=s.return}v.length!==0&&t.push({event:e,listeners:v})}var VU=/\r\n?/g,qU=/\u0000|\uFFFD/g;function bI(t){return(typeof t=="string"?t:""+t).replace(VU,`
`).replace(qU,"")}function tx(t,e,s){if(e=bI(e),bI(t)!==e&&s)throw Error(zn(425))}function sb(){}var RS=null,DS=null;function NS(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var OS=typeof setTimeout=="function"?setTimeout:void 0,$U=typeof clearTimeout=="function"?clearTimeout:void 0,wI=typeof Promise=="function"?Promise:void 0,GU=typeof queueMicrotask=="function"?queueMicrotask:typeof wI<"u"?function(t){return wI.resolve(null).then(t).catch(HU)}:OS;function HU(t){setTimeout(function(){throw t})}function x5(t,e){var s=e,a=0;do{var d=s.nextSibling;if(t.removeChild(s),d&&d.nodeType===8)if(s=d.data,s==="/$"){if(a===0){t.removeChild(d),Qy(e);return}a--}else s!=="$"&&s!=="$?"&&s!=="$!"||a++;s=d}while(s);Qy(e)}function Ap(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function SI(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"){if(e===0)return t;e--}else s==="/$"&&e++}t=t.previousSibling}return null}var o0=Math.random().toString(36).slice(2),Jh="__reactFiber$"+o0,iv="__reactProps$"+o0,lf="__reactContainer$"+o0,zS="__reactEvents$"+o0,WU="__reactListeners$"+o0,ZU="__reactHandles$"+o0;function Fm(t){var e=t[Jh];if(e)return e;for(var s=t.parentNode;s;){if(e=s[lf]||s[Jh]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(t=SI(t);t!==null;){if(s=t[Jh])return s;t=SI(t)}return e}t=s,s=t.parentNode}return null}function Cv(t){return t=t[Jh]||t[lf],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function u_(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(zn(33))}function $b(t){return t[iv]||null}var FS=[],h_=-1;function jp(t){return{current:t}}function Gs(t){0>h_||(t.current=FS[h_],FS[h_]=null,h_--)}function ks(t,e){h_++,FS[h_]=t.current,t.current=e}var Lp={},dl=jp(Lp),mc=jp(!1),Jm=Lp;function K_(t,e){var s=t.type.contextTypes;if(!s)return Lp;var a=t.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===e)return a.__reactInternalMemoizedMaskedChildContext;var d={},g;for(g in s)d[g]=e[g];return a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=d),d}function gc(t){return t=t.childContextTypes,t!=null}function ob(){Gs(mc),Gs(dl)}function TI(t,e,s){if(dl.current!==Lp)throw Error(zn(168));ks(dl,e),ks(mc,s)}function Qk(t,e,s){var a=t.stateNode;if(e=e.childContextTypes,typeof a.getChildContext!="function")return s;a=a.getChildContext();for(var d in a)if(!(d in e))throw Error(zn(108,k7(t)||"Unknown",d));return uo({},s,a)}function ab(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Lp,Jm=dl.current,ks(dl,t),ks(mc,mc.current),!0}function AI(t,e,s){var a=t.stateNode;if(!a)throw Error(zn(169));s?(t=Qk(t,e,Jm),a.__reactInternalMemoizedMergedChildContext=t,Gs(mc),Gs(dl),ks(dl,t)):Gs(mc),ks(mc,s)}var Xd=null,Gb=!1,b5=!1;function eR(t){Xd===null?Xd=[t]:Xd.push(t)}function KU(t){Gb=!0,eR(t)}function Up(){if(!b5&&Xd!==null){b5=!0;var t=0,e=us;try{var s=Xd;for(us=1;t<s.length;t++){var a=s[t];do a=a(!0);while(a!==null)}Xd=null,Gb=!1}catch(d){throw Xd!==null&&(Xd=Xd.slice(t+1)),Ak(x3,Up),d}finally{us=e,b5=!1}}return null}var d_=[],f_=0,lb=null,cb=0,gu=[],_u=0,Qm=null,Qd=1,ef="";function km(t,e){d_[f_++]=cb,d_[f_++]=lb,lb=t,cb=e}function tR(t,e,s){gu[_u++]=Qd,gu[_u++]=ef,gu[_u++]=Qm,Qm=t;var a=Qd;t=ef;var d=32-uh(a)-1;a&=~(1<<d),s+=1;var g=32-uh(e)+d;if(30<g){var v=d-d%5;g=(a&(1<<v)-1).toString(32),a>>=v,d-=v,Qd=1<<32-uh(e)+d|s<<d|a,ef=g+t}else Qd=1<<g|s<<d|a,ef=t}function M3(t){t.return!==null&&(km(t,1),tR(t,1,0))}function I3(t){for(;t===lb;)lb=d_[--f_],d_[f_]=null,cb=d_[--f_],d_[f_]=null;for(;t===Qm;)Qm=gu[--_u],gu[_u]=null,ef=gu[--_u],gu[_u]=null,Qd=gu[--_u],gu[_u]=null}var $c=null,Vc=null,eo=!1,lh=null;function nR(t,e){var s=bu(5,null,null,0);s.elementType="DELETED",s.stateNode=e,s.return=t,e=t.deletions,e===null?(t.deletions=[s],t.flags|=16):e.push(s)}function EI(t,e){switch(t.tag){case 5:var s=t.type;return e=e.nodeType!==1||s.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,$c=t,Vc=Ap(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,$c=t,Vc=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(s=Qm!==null?{id:Qd,overflow:ef}:null,t.memoizedState={dehydrated:e,treeContext:s,retryLane:1073741824},s=bu(18,null,null,0),s.stateNode=e,s.return=t,t.child=s,$c=t,Vc=null,!0):!1;default:return!1}}function BS(t){return(t.mode&1)!==0&&(t.flags&128)===0}function jS(t){if(eo){var e=Vc;if(e){var s=e;if(!EI(t,e)){if(BS(t))throw Error(zn(418));e=Ap(s.nextSibling);var a=$c;e&&EI(t,e)?nR(a,s):(t.flags=t.flags&-4097|2,eo=!1,$c=t)}}else{if(BS(t))throw Error(zn(418));t.flags=t.flags&-4097|2,eo=!1,$c=t}}}function CI(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;$c=t}function nx(t){if(t!==$c)return!1;if(!eo)return CI(t),eo=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!NS(t.type,t.memoizedProps)),e&&(e=Vc)){if(BS(t))throw rR(),Error(zn(418));for(;e;)nR(t,e),e=Ap(e.nextSibling)}if(CI(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(zn(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"){if(e===0){Vc=Ap(t.nextSibling);break e}e--}else s!=="$"&&s!=="$!"&&s!=="$?"||e++}t=t.nextSibling}Vc=null}}else Vc=$c?Ap(t.stateNode.nextSibling):null;return!0}function rR(){for(var t=Vc;t;)t=Ap(t.nextSibling)}function X_(){Vc=$c=null,eo=!1}function L3(t){lh===null?lh=[t]:lh.push(t)}var XU=mf.ReactCurrentBatchConfig;function my(t,e,s){if(t=s.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(zn(309));var a=s.stateNode}if(!a)throw Error(zn(147,t));var d=a,g=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===g?e.ref:(e=function(v){var i=d.refs;v===null?delete i[g]:i[g]=v},e._stringRef=g,e)}if(typeof t!="string")throw Error(zn(284));if(!s._owner)throw Error(zn(290,t))}return t}function rx(t,e){throw t=Object.prototype.toString.call(e),Error(zn(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function PI(t){var e=t._init;return e(t._payload)}function iR(t){function e(J,te){if(t){var le=J.deletions;le===null?(J.deletions=[te],J.flags|=16):le.push(te)}}function s(J,te){if(!t)return null;for(;te!==null;)e(J,te),te=te.sibling;return null}function a(J,te){for(J=new Map;te!==null;)te.key!==null?J.set(te.key,te):J.set(te.index,te),te=te.sibling;return J}function d(J,te){return J=Mp(J,te),J.index=0,J.sibling=null,J}function g(J,te,le){return J.index=le,t?(le=J.alternate,le!==null?(le=le.index,le<te?(J.flags|=2,te):le):(J.flags|=2,te)):(J.flags|=1048576,te)}function v(J){return t&&J.alternate===null&&(J.flags|=2),J}function i(J,te,le,ye){return te===null||te.tag!==6?(te=P5(le,J.mode,ye),te.return=J,te):(te=d(te,le),te.return=J,te)}function E(J,te,le,ye){var Ne=le.type;return Ne===o_?O(J,te,le.props.children,ye,le.key):te!==null&&(te.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===rp&&PI(Ne)===te.type)?(ye=d(te,le.props),ye.ref=my(J,te,le),ye.return=J,ye):(ye=zx(le.type,le.key,le.props,null,J.mode,ye),ye.ref=my(J,te,le),ye.return=J,ye)}function k(J,te,le,ye){return te===null||te.tag!==4||te.stateNode.containerInfo!==le.containerInfo||te.stateNode.implementation!==le.implementation?(te=M5(le,J.mode,ye),te.return=J,te):(te=d(te,le.children||[]),te.return=J,te)}function O(J,te,le,ye,Ne){return te===null||te.tag!==7?(te=Km(le,J.mode,ye,Ne),te.return=J,te):(te=d(te,le),te.return=J,te)}function z(J,te,le){if(typeof te=="string"&&te!==""||typeof te=="number")return te=P5(""+te,J.mode,le),te.return=J,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case H1:return le=zx(te.type,te.key,te.props,null,J.mode,le),le.ref=my(J,null,te),le.return=J,le;case s_:return te=M5(te,J.mode,le),te.return=J,te;case rp:var ye=te._init;return z(J,ye(te._payload),le)}if(Ay(te)||uy(te))return te=Km(te,J.mode,le,null),te.return=J,te;rx(J,te)}return null}function G(J,te,le,ye){var Ne=te!==null?te.key:null;if(typeof le=="string"&&le!==""||typeof le=="number")return Ne!==null?null:i(J,te,""+le,ye);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case H1:return le.key===Ne?E(J,te,le,ye):null;case s_:return le.key===Ne?k(J,te,le,ye):null;case rp:return Ne=le._init,G(J,te,Ne(le._payload),ye)}if(Ay(le)||uy(le))return Ne!==null?null:O(J,te,le,ye,null);rx(J,le)}return null}function U(J,te,le,ye,Ne){if(typeof ye=="string"&&ye!==""||typeof ye=="number")return J=J.get(le)||null,i(te,J,""+ye,Ne);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case H1:return J=J.get(ye.key===null?le:ye.key)||null,E(te,J,ye,Ne);case s_:return J=J.get(ye.key===null?le:ye.key)||null,k(te,J,ye,Ne);case rp:var rt=ye._init;return U(J,te,le,rt(ye._payload),Ne)}if(Ay(ye)||uy(ye))return J=J.get(le)||null,O(te,J,ye,Ne,null);rx(te,ye)}return null}function ie(J,te,le,ye){for(var Ne=null,rt=null,xe=te,Me=te=0,it=null;xe!==null&&Me<le.length;Me++){xe.index>Me?(it=xe,xe=null):it=xe.sibling;var ot=G(J,xe,le[Me],ye);if(ot===null){xe===null&&(xe=it);break}t&&xe&&ot.alternate===null&&e(J,xe),te=g(ot,te,Me),rt===null?Ne=ot:rt.sibling=ot,rt=ot,xe=it}if(Me===le.length)return s(J,xe),eo&&km(J,Me),Ne;if(xe===null){for(;Me<le.length;Me++)xe=z(J,le[Me],ye),xe!==null&&(te=g(xe,te,Me),rt===null?Ne=xe:rt.sibling=xe,rt=xe);return eo&&km(J,Me),Ne}for(xe=a(J,xe);Me<le.length;Me++)it=U(xe,J,Me,le[Me],ye),it!==null&&(t&&it.alternate!==null&&xe.delete(it.key===null?Me:it.key),te=g(it,te,Me),rt===null?Ne=it:rt.sibling=it,rt=it);return t&&xe.forEach(function(ve){return e(J,ve)}),eo&&km(J,Me),Ne}function Q(J,te,le,ye){var Ne=uy(le);if(typeof Ne!="function")throw Error(zn(150));if(le=Ne.call(le),le==null)throw Error(zn(151));for(var rt=Ne=null,xe=te,Me=te=0,it=null,ot=le.next();xe!==null&&!ot.done;Me++,ot=le.next()){xe.index>Me?(it=xe,xe=null):it=xe.sibling;var ve=G(J,xe,ot.value,ye);if(ve===null){xe===null&&(xe=it);break}t&&xe&&ve.alternate===null&&e(J,xe),te=g(ve,te,Me),rt===null?Ne=ve:rt.sibling=ve,rt=ve,xe=it}if(ot.done)return s(J,xe),eo&&km(J,Me),Ne;if(xe===null){for(;!ot.done;Me++,ot=le.next())ot=z(J,ot.value,ye),ot!==null&&(te=g(ot,te,Me),rt===null?Ne=ot:rt.sibling=ot,rt=ot);return eo&&km(J,Me),Ne}for(xe=a(J,xe);!ot.done;Me++,ot=le.next())ot=U(xe,J,Me,ot.value,ye),ot!==null&&(t&&ot.alternate!==null&&xe.delete(ot.key===null?Me:ot.key),te=g(ot,te,Me),rt===null?Ne=ot:rt.sibling=ot,rt=ot);return t&&xe.forEach(function(Le){return e(J,Le)}),eo&&km(J,Me),Ne}function se(J,te,le,ye){if(typeof le=="object"&&le!==null&&le.type===o_&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case H1:e:{for(var Ne=le.key,rt=te;rt!==null;){if(rt.key===Ne){if(Ne=le.type,Ne===o_){if(rt.tag===7){s(J,rt.sibling),te=d(rt,le.props.children),te.return=J,J=te;break e}}else if(rt.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===rp&&PI(Ne)===rt.type){s(J,rt.sibling),te=d(rt,le.props),te.ref=my(J,rt,le),te.return=J,J=te;break e}s(J,rt);break}else e(J,rt);rt=rt.sibling}le.type===o_?(te=Km(le.props.children,J.mode,ye,le.key),te.return=J,J=te):(ye=zx(le.type,le.key,le.props,null,J.mode,ye),ye.ref=my(J,te,le),ye.return=J,J=ye)}return v(J);case s_:e:{for(rt=le.key;te!==null;){if(te.key===rt)if(te.tag===4&&te.stateNode.containerInfo===le.containerInfo&&te.stateNode.implementation===le.implementation){s(J,te.sibling),te=d(te,le.children||[]),te.return=J,J=te;break e}else{s(J,te);break}else e(J,te);te=te.sibling}te=M5(le,J.mode,ye),te.return=J,J=te}return v(J);case rp:return rt=le._init,se(J,te,rt(le._payload),ye)}if(Ay(le))return ie(J,te,le,ye);if(uy(le))return Q(J,te,le,ye);rx(J,le)}return typeof le=="string"&&le!==""||typeof le=="number"?(le=""+le,te!==null&&te.tag===6?(s(J,te.sibling),te=d(te,le),te.return=J,J=te):(s(J,te),te=P5(le,J.mode,ye),te.return=J,J=te),v(J)):s(J,te)}return se}var Y_=iR(!0),sR=iR(!1),ub=jp(null),hb=null,p_=null,k3=null;function R3(){k3=p_=hb=null}function D3(t){var e=ub.current;Gs(ub),t._currentValue=e}function US(t,e,s){for(;t!==null;){var a=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,a!==null&&(a.childLanes|=e)):a!==null&&(a.childLanes&e)!==e&&(a.childLanes|=e),t===s)break;t=t.return}}function S_(t,e){hb=t,k3=p_=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(pc=!0),t.firstContext=null)}function Tu(t){var e=t._currentValue;if(k3!==t)if(t={context:t,memoizedValue:e,next:null},p_===null){if(hb===null)throw Error(zn(308));p_=t,hb.dependencies={lanes:0,firstContext:t}}else p_=p_.next=t;return e}var Bm=null;function N3(t){Bm===null?Bm=[t]:Bm.push(t)}function oR(t,e,s,a){var d=e.interleaved;return d===null?(s.next=s,N3(e)):(s.next=d.next,d.next=s),e.interleaved=s,cf(t,a)}function cf(t,e){t.lanes|=e;var s=t.alternate;for(s!==null&&(s.lanes|=e),s=t,t=t.return;t!==null;)t.childLanes|=e,s=t.alternate,s!==null&&(s.childLanes|=e),s=t,t=t.return;return s.tag===3?s.stateNode:null}var ip=!1;function O3(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function aR(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function sf(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ep(t,e,s){var a=t.updateQueue;if(a===null)return null;if(a=a.shared,Xi&2){var d=a.pending;return d===null?e.next=e:(e.next=d.next,d.next=e),a.pending=e,cf(t,s)}return d=a.interleaved,d===null?(e.next=e,N3(a)):(e.next=d.next,d.next=e),a.interleaved=e,cf(t,s)}function Lx(t,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194240)!==0)){var a=e.lanes;a&=t.pendingLanes,s|=a,e.lanes=s,b3(t,s)}}function MI(t,e){var s=t.updateQueue,a=t.alternate;if(a!==null&&(a=a.updateQueue,s===a)){var d=null,g=null;if(s=s.firstBaseUpdate,s!==null){do{var v={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};g===null?d=g=v:g=g.next=v,s=s.next}while(s!==null);g===null?d=g=e:g=g.next=e}else d=g=e;s={baseState:a.baseState,firstBaseUpdate:d,lastBaseUpdate:g,shared:a.shared,effects:a.effects},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=e:t.next=e,s.lastBaseUpdate=e}function db(t,e,s,a){var d=t.updateQueue;ip=!1;var g=d.firstBaseUpdate,v=d.lastBaseUpdate,i=d.shared.pending;if(i!==null){d.shared.pending=null;var E=i,k=E.next;E.next=null,v===null?g=k:v.next=k,v=E;var O=t.alternate;O!==null&&(O=O.updateQueue,i=O.lastBaseUpdate,i!==v&&(i===null?O.firstBaseUpdate=k:i.next=k,O.lastBaseUpdate=E))}if(g!==null){var z=d.baseState;v=0,O=k=E=null,i=g;do{var G=i.lane,U=i.eventTime;if((a&G)===G){O!==null&&(O=O.next={eventTime:U,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var ie=t,Q=i;switch(G=e,U=s,Q.tag){case 1:if(ie=Q.payload,typeof ie=="function"){z=ie.call(U,z,G);break e}z=ie;break e;case 3:ie.flags=ie.flags&-65537|128;case 0:if(ie=Q.payload,G=typeof ie=="function"?ie.call(U,z,G):ie,G==null)break e;z=uo({},z,G);break e;case 2:ip=!0}}i.callback!==null&&i.lane!==0&&(t.flags|=64,G=d.effects,G===null?d.effects=[i]:G.push(i))}else U={eventTime:U,lane:G,tag:i.tag,payload:i.payload,callback:i.callback,next:null},O===null?(k=O=U,E=z):O=O.next=U,v|=G;if(i=i.next,i===null){if(i=d.shared.pending,i===null)break;G=i,i=G.next,G.next=null,d.lastBaseUpdate=G,d.shared.pending=null}}while(!0);if(O===null&&(E=z),d.baseState=E,d.firstBaseUpdate=k,d.lastBaseUpdate=O,e=d.shared.interleaved,e!==null){d=e;do v|=d.lane,d=d.next;while(d!==e)}else g===null&&(d.shared.lanes=0);tg|=v,t.lanes=v,t.memoizedState=z}}function II(t,e,s){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var a=t[e],d=a.callback;if(d!==null){if(a.callback=null,a=s,typeof d!="function")throw Error(zn(191,d));d.call(a)}}}var Pv={},rd=jp(Pv),sv=jp(Pv),ov=jp(Pv);function jm(t){if(t===Pv)throw Error(zn(174));return t}function z3(t,e){switch(ks(ov,e),ks(sv,t),ks(rd,Pv),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:bS(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=bS(e,t)}Gs(rd),ks(rd,e)}function J_(){Gs(rd),Gs(sv),Gs(ov)}function lR(t){jm(ov.current);var e=jm(rd.current),s=bS(e,t.type);e!==s&&(ks(sv,t),ks(rd,s))}function F3(t){sv.current===t&&(Gs(rd),Gs(sv))}var lo=jp(0);function fb(t){for(var e=t;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var w5=[];function B3(){for(var t=0;t<w5.length;t++)w5[t]._workInProgressVersionPrimary=null;w5.length=0}var kx=mf.ReactCurrentDispatcher,S5=mf.ReactCurrentBatchConfig,eg=0,co=null,aa=null,xa=null,pb=!1,Fy=!1,av=0,YU=0;function nl(){throw Error(zn(321))}function j3(t,e){if(e===null)return!1;for(var s=0;s<e.length&&s<t.length;s++)if(!dh(t[s],e[s]))return!1;return!0}function U3(t,e,s,a,d,g){if(eg=g,co=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,kx.current=t===null||t.memoizedState===null?tV:nV,t=s(a,d),Fy){g=0;do{if(Fy=!1,av=0,25<=g)throw Error(zn(301));g+=1,xa=aa=null,e.updateQueue=null,kx.current=rV,t=s(a,d)}while(Fy)}if(kx.current=mb,e=aa!==null&&aa.next!==null,eg=0,xa=aa=co=null,pb=!1,e)throw Error(zn(300));return t}function V3(){var t=av!==0;return av=0,t}function Wh(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xa===null?co.memoizedState=xa=t:xa=xa.next=t,xa}function Au(){if(aa===null){var t=co.alternate;t=t!==null?t.memoizedState:null}else t=aa.next;var e=xa===null?co.memoizedState:xa.next;if(e!==null)xa=e,aa=t;else{if(t===null)throw Error(zn(310));aa=t,t={memoizedState:aa.memoizedState,baseState:aa.baseState,baseQueue:aa.baseQueue,queue:aa.queue,next:null},xa===null?co.memoizedState=xa=t:xa=xa.next=t}return xa}function lv(t,e){return typeof e=="function"?e(t):e}function T5(t){var e=Au(),s=e.queue;if(s===null)throw Error(zn(311));s.lastRenderedReducer=t;var a=aa,d=a.baseQueue,g=s.pending;if(g!==null){if(d!==null){var v=d.next;d.next=g.next,g.next=v}a.baseQueue=d=g,s.pending=null}if(d!==null){g=d.next,a=a.baseState;var i=v=null,E=null,k=g;do{var O=k.lane;if((eg&O)===O)E!==null&&(E=E.next={lane:0,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),a=k.hasEagerState?k.eagerState:t(a,k.action);else{var z={lane:O,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null};E===null?(i=E=z,v=a):E=E.next=z,co.lanes|=O,tg|=O}k=k.next}while(k!==null&&k!==g);E===null?v=a:E.next=i,dh(a,e.memoizedState)||(pc=!0),e.memoizedState=a,e.baseState=v,e.baseQueue=E,s.lastRenderedState=a}if(t=s.interleaved,t!==null){d=t;do g=d.lane,co.lanes|=g,tg|=g,d=d.next;while(d!==t)}else d===null&&(s.lanes=0);return[e.memoizedState,s.dispatch]}function A5(t){var e=Au(),s=e.queue;if(s===null)throw Error(zn(311));s.lastRenderedReducer=t;var a=s.dispatch,d=s.pending,g=e.memoizedState;if(d!==null){s.pending=null;var v=d=d.next;do g=t(g,v.action),v=v.next;while(v!==d);dh(g,e.memoizedState)||(pc=!0),e.memoizedState=g,e.baseQueue===null&&(e.baseState=g),s.lastRenderedState=g}return[g,a]}function cR(){}function uR(t,e){var s=co,a=Au(),d=e(),g=!dh(a.memoizedState,d);if(g&&(a.memoizedState=d,pc=!0),a=a.queue,q3(fR.bind(null,s,a,t),[t]),a.getSnapshot!==e||g||xa!==null&&xa.memoizedState.tag&1){if(s.flags|=2048,cv(9,dR.bind(null,s,a,d,e),void 0,null),wa===null)throw Error(zn(349));eg&30||hR(s,e,d)}return d}function hR(t,e,s){t.flags|=16384,t={getSnapshot:e,value:s},e=co.updateQueue,e===null?(e={lastEffect:null,stores:null},co.updateQueue=e,e.stores=[t]):(s=e.stores,s===null?e.stores=[t]:s.push(t))}function dR(t,e,s,a){e.value=s,e.getSnapshot=a,pR(e)&&mR(t)}function fR(t,e,s){return s(function(){pR(e)&&mR(t)})}function pR(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!dh(t,s)}catch{return!0}}function mR(t){var e=cf(t,1);e!==null&&hh(e,t,1,-1)}function LI(t){var e=Wh();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lv,lastRenderedState:t},e.queue=t,t=t.dispatch=eV.bind(null,co,t),[e.memoizedState,t]}function cv(t,e,s,a){return t={tag:t,create:e,destroy:s,deps:a,next:null},e=co.updateQueue,e===null?(e={lastEffect:null,stores:null},co.updateQueue=e,e.lastEffect=t.next=t):(s=e.lastEffect,s===null?e.lastEffect=t.next=t:(a=s.next,s.next=t,t.next=a,e.lastEffect=t)),t}function gR(){return Au().memoizedState}function Rx(t,e,s,a){var d=Wh();co.flags|=t,d.memoizedState=cv(1|e,s,void 0,a===void 0?null:a)}function Hb(t,e,s,a){var d=Au();a=a===void 0?null:a;var g=void 0;if(aa!==null){var v=aa.memoizedState;if(g=v.destroy,a!==null&&j3(a,v.deps)){d.memoizedState=cv(e,s,g,a);return}}co.flags|=t,d.memoizedState=cv(1|e,s,g,a)}function kI(t,e){return Rx(8390656,8,t,e)}function q3(t,e){return Hb(2048,8,t,e)}function _R(t,e){return Hb(4,2,t,e)}function yR(t,e){return Hb(4,4,t,e)}function vR(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function xR(t,e,s){return s=s!=null?s.concat([t]):null,Hb(4,4,vR.bind(null,e,t),s)}function $3(){}function bR(t,e){var s=Au();e=e===void 0?null:e;var a=s.memoizedState;return a!==null&&e!==null&&j3(e,a[1])?a[0]:(s.memoizedState=[t,e],t)}function wR(t,e){var s=Au();e=e===void 0?null:e;var a=s.memoizedState;return a!==null&&e!==null&&j3(e,a[1])?a[0]:(t=t(),s.memoizedState=[t,e],t)}function SR(t,e,s){return eg&21?(dh(s,e)||(s=Pk(),co.lanes|=s,tg|=s,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,pc=!0),t.memoizedState=s)}function JU(t,e){var s=us;us=s!==0&&4>s?s:4,t(!0);var a=S5.transition;S5.transition={};try{t(!1),e()}finally{us=s,S5.transition=a}}function TR(){return Au().memoizedState}function QU(t,e,s){var a=Pp(t);if(s={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null},AR(t))ER(e,s);else if(s=oR(t,e,s,a),s!==null){var d=jl();hh(s,t,a,d),CR(s,e,a)}}function eV(t,e,s){var a=Pp(t),d={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null};if(AR(t))ER(e,d);else{var g=t.alternate;if(t.lanes===0&&(g===null||g.lanes===0)&&(g=e.lastRenderedReducer,g!==null))try{var v=e.lastRenderedState,i=g(v,s);if(d.hasEagerState=!0,d.eagerState=i,dh(i,v)){var E=e.interleaved;E===null?(d.next=d,N3(e)):(d.next=E.next,E.next=d),e.interleaved=d;return}}catch{}finally{}s=oR(t,e,d,a),s!==null&&(d=jl(),hh(s,t,a,d),CR(s,e,a))}}function AR(t){var e=t.alternate;return t===co||e!==null&&e===co}function ER(t,e){Fy=pb=!0;var s=t.pending;s===null?e.next=e:(e.next=s.next,s.next=e),t.pending=e}function CR(t,e,s){if(s&4194240){var a=e.lanes;a&=t.pendingLanes,s|=a,e.lanes=s,b3(t,s)}}var mb={readContext:Tu,useCallback:nl,useContext:nl,useEffect:nl,useImperativeHandle:nl,useInsertionEffect:nl,useLayoutEffect:nl,useMemo:nl,useReducer:nl,useRef:nl,useState:nl,useDebugValue:nl,useDeferredValue:nl,useTransition:nl,useMutableSource:nl,useSyncExternalStore:nl,useId:nl,unstable_isNewReconciler:!1},tV={readContext:Tu,useCallback:function(t,e){return Wh().memoizedState=[t,e===void 0?null:e],t},useContext:Tu,useEffect:kI,useImperativeHandle:function(t,e,s){return s=s!=null?s.concat([t]):null,Rx(4194308,4,vR.bind(null,e,t),s)},useLayoutEffect:function(t,e){return Rx(4194308,4,t,e)},useInsertionEffect:function(t,e){return Rx(4,2,t,e)},useMemo:function(t,e){var s=Wh();return e=e===void 0?null:e,t=t(),s.memoizedState=[t,e],t},useReducer:function(t,e,s){var a=Wh();return e=s!==void 0?s(e):e,a.memoizedState=a.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},a.queue=t,t=t.dispatch=QU.bind(null,co,t),[a.memoizedState,t]},useRef:function(t){var e=Wh();return t={current:t},e.memoizedState=t},useState:LI,useDebugValue:$3,useDeferredValue:function(t){return Wh().memoizedState=t},useTransition:function(){var t=LI(!1),e=t[0];return t=JU.bind(null,t[1]),Wh().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,s){var a=co,d=Wh();if(eo){if(s===void 0)throw Error(zn(407));s=s()}else{if(s=e(),wa===null)throw Error(zn(349));eg&30||hR(a,e,s)}d.memoizedState=s;var g={value:s,getSnapshot:e};return d.queue=g,kI(fR.bind(null,a,g,t),[t]),a.flags|=2048,cv(9,dR.bind(null,a,g,s,e),void 0,null),s},useId:function(){var t=Wh(),e=wa.identifierPrefix;if(eo){var s=ef,a=Qd;s=(a&~(1<<32-uh(a)-1)).toString(32)+s,e=":"+e+"R"+s,s=av++,0<s&&(e+="H"+s.toString(32)),e+=":"}else s=YU++,e=":"+e+"r"+s.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},nV={readContext:Tu,useCallback:bR,useContext:Tu,useEffect:q3,useImperativeHandle:xR,useInsertionEffect:_R,useLayoutEffect:yR,useMemo:wR,useReducer:T5,useRef:gR,useState:function(){return T5(lv)},useDebugValue:$3,useDeferredValue:function(t){var e=Au();return SR(e,aa.memoizedState,t)},useTransition:function(){var t=T5(lv)[0],e=Au().memoizedState;return[t,e]},useMutableSource:cR,useSyncExternalStore:uR,useId:TR,unstable_isNewReconciler:!1},rV={readContext:Tu,useCallback:bR,useContext:Tu,useEffect:q3,useImperativeHandle:xR,useInsertionEffect:_R,useLayoutEffect:yR,useMemo:wR,useReducer:A5,useRef:gR,useState:function(){return A5(lv)},useDebugValue:$3,useDeferredValue:function(t){var e=Au();return aa===null?e.memoizedState=t:SR(e,aa.memoizedState,t)},useTransition:function(){var t=A5(lv)[0],e=Au().memoizedState;return[t,e]},useMutableSource:cR,useSyncExternalStore:uR,useId:TR,unstable_isNewReconciler:!1};function rh(t,e){if(t&&t.defaultProps){e=uo({},e),t=t.defaultProps;for(var s in t)e[s]===void 0&&(e[s]=t[s]);return e}return e}function VS(t,e,s,a){e=t.memoizedState,s=s(a,e),s=s==null?e:uo({},e,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Wb={isMounted:function(t){return(t=t._reactInternals)?cg(t)===t:!1},enqueueSetState:function(t,e,s){t=t._reactInternals;var a=jl(),d=Pp(t),g=sf(a,d);g.payload=e,s!=null&&(g.callback=s),e=Ep(t,g,d),e!==null&&(hh(e,t,d,a),Lx(e,t,d))},enqueueReplaceState:function(t,e,s){t=t._reactInternals;var a=jl(),d=Pp(t),g=sf(a,d);g.tag=1,g.payload=e,s!=null&&(g.callback=s),e=Ep(t,g,d),e!==null&&(hh(e,t,d,a),Lx(e,t,d))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var s=jl(),a=Pp(t),d=sf(s,a);d.tag=2,e!=null&&(d.callback=e),e=Ep(t,d,a),e!==null&&(hh(e,t,a,s),Lx(e,t,a))}};function RI(t,e,s,a,d,g,v){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(a,g,v):e.prototype&&e.prototype.isPureReactComponent?!tv(s,a)||!tv(d,g):!0}function PR(t,e,s){var a=!1,d=Lp,g=e.contextType;return typeof g=="object"&&g!==null?g=Tu(g):(d=gc(e)?Jm:dl.current,a=e.contextTypes,g=(a=a!=null)?K_(t,d):Lp),e=new e(s,g),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Wb,t.stateNode=e,e._reactInternals=t,a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=d,t.__reactInternalMemoizedMaskedChildContext=g),e}function DI(t,e,s,a){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,a),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,a),e.state!==t&&Wb.enqueueReplaceState(e,e.state,null)}function qS(t,e,s,a){var d=t.stateNode;d.props=s,d.state=t.memoizedState,d.refs={},O3(t);var g=e.contextType;typeof g=="object"&&g!==null?d.context=Tu(g):(g=gc(e)?Jm:dl.current,d.context=K_(t,g)),d.state=t.memoizedState,g=e.getDerivedStateFromProps,typeof g=="function"&&(VS(t,e,g,s),d.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(e=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),e!==d.state&&Wb.enqueueReplaceState(d,d.state,null),db(t,s,d,a),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308)}function Q_(t,e){try{var s="",a=e;do s+=L7(a),a=a.return;while(a);var d=s}catch(g){d=`
Error generating stack: `+g.message+`
`+g.stack}return{value:t,source:e,stack:d,digest:null}}function E5(t,e,s){return{value:t,source:null,stack:s??null,digest:e??null}}function $S(t,e){try{console.error(e.value)}catch(s){setTimeout(function(){throw s})}}var iV=typeof WeakMap=="function"?WeakMap:Map;function MR(t,e,s){s=sf(-1,s),s.tag=3,s.payload={element:null};var a=e.value;return s.callback=function(){_b||(_b=!0,eT=a),$S(t,e)},s}function IR(t,e,s){s=sf(-1,s),s.tag=3;var a=t.type.getDerivedStateFromError;if(typeof a=="function"){var d=e.value;s.payload=function(){return a(d)},s.callback=function(){$S(t,e)}}var g=t.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(s.callback=function(){$S(t,e),typeof a!="function"&&(Cp===null?Cp=new Set([this]):Cp.add(this));var v=e.stack;this.componentDidCatch(e.value,{componentStack:v!==null?v:""})}),s}function NI(t,e,s){var a=t.pingCache;if(a===null){a=t.pingCache=new iV;var d=new Set;a.set(e,d)}else d=a.get(e),d===void 0&&(d=new Set,a.set(e,d));d.has(s)||(d.add(s),t=yV.bind(null,t,e,s),e.then(t,t))}function OI(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function zI(t,e,s,a,d){return t.mode&1?(t.flags|=65536,t.lanes=d,t):(t===e?t.flags|=65536:(t.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(e=sf(-1,1),e.tag=2,Ep(s,e,1))),s.lanes|=1),t)}var sV=mf.ReactCurrentOwner,pc=!1;function Bl(t,e,s,a){e.child=t===null?sR(e,null,s,a):Y_(e,t.child,s,a)}function FI(t,e,s,a,d){s=s.render;var g=e.ref;return S_(e,d),a=U3(t,e,s,a,g,d),s=V3(),t!==null&&!pc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~d,uf(t,e,d)):(eo&&s&&M3(e),e.flags|=1,Bl(t,e,a,d),e.child)}function BI(t,e,s,a,d){if(t===null){var g=s.type;return typeof g=="function"&&!J3(g)&&g.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(e.tag=15,e.type=g,LR(t,e,g,a,d)):(t=zx(s.type,null,a,e,e.mode,d),t.ref=e.ref,t.return=e,e.child=t)}if(g=t.child,!(t.lanes&d)){var v=g.memoizedProps;if(s=s.compare,s=s!==null?s:tv,s(v,a)&&t.ref===e.ref)return uf(t,e,d)}return e.flags|=1,t=Mp(g,a),t.ref=e.ref,t.return=e,e.child=t}function LR(t,e,s,a,d){if(t!==null){var g=t.memoizedProps;if(tv(g,a)&&t.ref===e.ref)if(pc=!1,e.pendingProps=a=g,(t.lanes&d)!==0)t.flags&131072&&(pc=!0);else return e.lanes=t.lanes,uf(t,e,d)}return GS(t,e,s,a,d)}function kR(t,e,s){var a=e.pendingProps,d=a.children,g=t!==null?t.memoizedState:null;if(a.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ks(g_,Bc),Bc|=s;else{if(!(s&1073741824))return t=g!==null?g.baseLanes|s:s,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ks(g_,Bc),Bc|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=g!==null?g.baseLanes:s,ks(g_,Bc),Bc|=a}else g!==null?(a=g.baseLanes|s,e.memoizedState=null):a=s,ks(g_,Bc),Bc|=a;return Bl(t,e,d,s),e.child}function RR(t,e){var s=e.ref;(t===null&&s!==null||t!==null&&t.ref!==s)&&(e.flags|=512,e.flags|=2097152)}function GS(t,e,s,a,d){var g=gc(s)?Jm:dl.current;return g=K_(e,g),S_(e,d),s=U3(t,e,s,a,g,d),a=V3(),t!==null&&!pc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~d,uf(t,e,d)):(eo&&a&&M3(e),e.flags|=1,Bl(t,e,s,d),e.child)}function jI(t,e,s,a,d){if(gc(s)){var g=!0;ab(e)}else g=!1;if(S_(e,d),e.stateNode===null)Dx(t,e),PR(e,s,a),qS(e,s,a,d),a=!0;else if(t===null){var v=e.stateNode,i=e.memoizedProps;v.props=i;var E=v.context,k=s.contextType;typeof k=="object"&&k!==null?k=Tu(k):(k=gc(s)?Jm:dl.current,k=K_(e,k));var O=s.getDerivedStateFromProps,z=typeof O=="function"||typeof v.getSnapshotBeforeUpdate=="function";z||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(i!==a||E!==k)&&DI(e,v,a,k),ip=!1;var G=e.memoizedState;v.state=G,db(e,a,v,d),E=e.memoizedState,i!==a||G!==E||mc.current||ip?(typeof O=="function"&&(VS(e,s,O,a),E=e.memoizedState),(i=ip||RI(e,s,i,a,G,E,k))?(z||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(e.flags|=4194308)):(typeof v.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=a,e.memoizedState=E),v.props=a,v.state=E,v.context=k,a=i):(typeof v.componentDidMount=="function"&&(e.flags|=4194308),a=!1)}else{v=e.stateNode,aR(t,e),i=e.memoizedProps,k=e.type===e.elementType?i:rh(e.type,i),v.props=k,z=e.pendingProps,G=v.context,E=s.contextType,typeof E=="object"&&E!==null?E=Tu(E):(E=gc(s)?Jm:dl.current,E=K_(e,E));var U=s.getDerivedStateFromProps;(O=typeof U=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(i!==z||G!==E)&&DI(e,v,a,E),ip=!1,G=e.memoizedState,v.state=G,db(e,a,v,d);var ie=e.memoizedState;i!==z||G!==ie||mc.current||ip?(typeof U=="function"&&(VS(e,s,U,a),ie=e.memoizedState),(k=ip||RI(e,s,k,a,G,ie,E)||!1)?(O||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(a,ie,E),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(a,ie,E)),typeof v.componentDidUpdate=="function"&&(e.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof v.componentDidUpdate!="function"||i===t.memoizedProps&&G===t.memoizedState||(e.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||i===t.memoizedProps&&G===t.memoizedState||(e.flags|=1024),e.memoizedProps=a,e.memoizedState=ie),v.props=a,v.state=ie,v.context=E,a=k):(typeof v.componentDidUpdate!="function"||i===t.memoizedProps&&G===t.memoizedState||(e.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||i===t.memoizedProps&&G===t.memoizedState||(e.flags|=1024),a=!1)}return HS(t,e,s,a,g,d)}function HS(t,e,s,a,d,g){RR(t,e);var v=(e.flags&128)!==0;if(!a&&!v)return d&&AI(e,s,!1),uf(t,e,g);a=e.stateNode,sV.current=e;var i=v&&typeof s.getDerivedStateFromError!="function"?null:a.render();return e.flags|=1,t!==null&&v?(e.child=Y_(e,t.child,null,g),e.child=Y_(e,null,i,g)):Bl(t,e,i,g),e.memoizedState=a.state,d&&AI(e,s,!0),e.child}function DR(t){var e=t.stateNode;e.pendingContext?TI(t,e.pendingContext,e.pendingContext!==e.context):e.context&&TI(t,e.context,!1),z3(t,e.containerInfo)}function UI(t,e,s,a,d){return X_(),L3(d),e.flags|=256,Bl(t,e,s,a),e.child}var WS={dehydrated:null,treeContext:null,retryLane:0};function ZS(t){return{baseLanes:t,cachePool:null,transitions:null}}function NR(t,e,s){var a=e.pendingProps,d=lo.current,g=!1,v=(e.flags&128)!==0,i;if((i=v)||(i=t!==null&&t.memoizedState===null?!1:(d&2)!==0),i?(g=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(d|=1),ks(lo,d&1),t===null)return jS(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(v=a.children,t=a.fallback,g?(a=e.mode,g=e.child,v={mode:"hidden",children:v},!(a&1)&&g!==null?(g.childLanes=0,g.pendingProps=v):g=Xb(v,a,0,null),t=Km(t,a,s,null),g.return=e,t.return=e,g.sibling=t,e.child=g,e.child.memoizedState=ZS(s),e.memoizedState=WS,t):G3(e,v));if(d=t.memoizedState,d!==null&&(i=d.dehydrated,i!==null))return oV(t,e,v,a,i,d,s);if(g){g=a.fallback,v=e.mode,d=t.child,i=d.sibling;var E={mode:"hidden",children:a.children};return!(v&1)&&e.child!==d?(a=e.child,a.childLanes=0,a.pendingProps=E,e.deletions=null):(a=Mp(d,E),a.subtreeFlags=d.subtreeFlags&14680064),i!==null?g=Mp(i,g):(g=Km(g,v,s,null),g.flags|=2),g.return=e,a.return=e,a.sibling=g,e.child=a,a=g,g=e.child,v=t.child.memoizedState,v=v===null?ZS(s):{baseLanes:v.baseLanes|s,cachePool:null,transitions:v.transitions},g.memoizedState=v,g.childLanes=t.childLanes&~s,e.memoizedState=WS,a}return g=t.child,t=g.sibling,a=Mp(g,{mode:"visible",children:a.children}),!(e.mode&1)&&(a.lanes=s),a.return=e,a.sibling=null,t!==null&&(s=e.deletions,s===null?(e.deletions=[t],e.flags|=16):s.push(t)),e.child=a,e.memoizedState=null,a}function G3(t,e){return e=Xb({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ix(t,e,s,a){return a!==null&&L3(a),Y_(e,t.child,null,s),t=G3(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function oV(t,e,s,a,d,g,v){if(s)return e.flags&256?(e.flags&=-257,a=E5(Error(zn(422))),ix(t,e,v,a)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(g=a.fallback,d=e.mode,a=Xb({mode:"visible",children:a.children},d,0,null),g=Km(g,d,v,null),g.flags|=2,a.return=e,g.return=e,a.sibling=g,e.child=a,e.mode&1&&Y_(e,t.child,null,v),e.child.memoizedState=ZS(v),e.memoizedState=WS,g);if(!(e.mode&1))return ix(t,e,v,null);if(d.data==="$!"){if(a=d.nextSibling&&d.nextSibling.dataset,a)var i=a.dgst;return a=i,g=Error(zn(419)),a=E5(g,a,void 0),ix(t,e,v,a)}if(i=(v&t.childLanes)!==0,pc||i){if(a=wa,a!==null){switch(v&-v){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(a.suspendedLanes|v)?0:d,d!==0&&d!==g.retryLane&&(g.retryLane=d,cf(t,d),hh(a,t,d,-1))}return Y3(),a=E5(Error(zn(421))),ix(t,e,v,a)}return d.data==="$?"?(e.flags|=128,e.child=t.child,e=vV.bind(null,t),d._reactRetry=e,null):(t=g.treeContext,Vc=Ap(d.nextSibling),$c=e,eo=!0,lh=null,t!==null&&(gu[_u++]=Qd,gu[_u++]=ef,gu[_u++]=Qm,Qd=t.id,ef=t.overflow,Qm=e),e=G3(e,a.children),e.flags|=4096,e)}function VI(t,e,s){t.lanes|=e;var a=t.alternate;a!==null&&(a.lanes|=e),US(t.return,e,s)}function C5(t,e,s,a,d){var g=t.memoizedState;g===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:a,tail:s,tailMode:d}:(g.isBackwards=e,g.rendering=null,g.renderingStartTime=0,g.last=a,g.tail=s,g.tailMode=d)}function OR(t,e,s){var a=e.pendingProps,d=a.revealOrder,g=a.tail;if(Bl(t,e,a.children,s),a=lo.current,a&2)a=a&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&VI(t,s,e);else if(t.tag===19)VI(t,s,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}a&=1}if(ks(lo,a),!(e.mode&1))e.memoizedState=null;else switch(d){case"forwards":for(s=e.child,d=null;s!==null;)t=s.alternate,t!==null&&fb(t)===null&&(d=s),s=s.sibling;s=d,s===null?(d=e.child,e.child=null):(d=s.sibling,s.sibling=null),C5(e,!1,d,s,g);break;case"backwards":for(s=null,d=e.child,e.child=null;d!==null;){if(t=d.alternate,t!==null&&fb(t)===null){e.child=d;break}t=d.sibling,d.sibling=s,s=d,d=t}C5(e,!0,s,null,g);break;case"together":C5(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Dx(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function uf(t,e,s){if(t!==null&&(e.dependencies=t.dependencies),tg|=e.lanes,!(s&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(zn(153));if(e.child!==null){for(t=e.child,s=Mp(t,t.pendingProps),e.child=s,s.return=e;t.sibling!==null;)t=t.sibling,s=s.sibling=Mp(t,t.pendingProps),s.return=e;s.sibling=null}return e.child}function aV(t,e,s){switch(e.tag){case 3:DR(e),X_();break;case 5:lR(e);break;case 1:gc(e.type)&&ab(e);break;case 4:z3(e,e.stateNode.containerInfo);break;case 10:var a=e.type._context,d=e.memoizedProps.value;ks(ub,a._currentValue),a._currentValue=d;break;case 13:if(a=e.memoizedState,a!==null)return a.dehydrated!==null?(ks(lo,lo.current&1),e.flags|=128,null):s&e.child.childLanes?NR(t,e,s):(ks(lo,lo.current&1),t=uf(t,e,s),t!==null?t.sibling:null);ks(lo,lo.current&1);break;case 19:if(a=(s&e.childLanes)!==0,t.flags&128){if(a)return OR(t,e,s);e.flags|=128}if(d=e.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),ks(lo,lo.current),a)break;return null;case 22:case 23:return e.lanes=0,kR(t,e,s)}return uf(t,e,s)}var zR,KS,FR,BR;zR=function(t,e){for(var s=e.child;s!==null;){if(s.tag===5||s.tag===6)t.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};KS=function(){};FR=function(t,e,s,a){var d=t.memoizedProps;if(d!==a){t=e.stateNode,jm(rd.current);var g=null;switch(s){case"input":d=_S(t,d),a=_S(t,a),g=[];break;case"select":d=uo({},d,{value:void 0}),a=uo({},a,{value:void 0}),g=[];break;case"textarea":d=xS(t,d),a=xS(t,a),g=[];break;default:typeof d.onClick!="function"&&typeof a.onClick=="function"&&(t.onclick=sb)}wS(s,a);var v;s=null;for(k in d)if(!a.hasOwnProperty(k)&&d.hasOwnProperty(k)&&d[k]!=null)if(k==="style"){var i=d[k];for(v in i)i.hasOwnProperty(v)&&(s||(s={}),s[v]="")}else k!=="dangerouslySetInnerHTML"&&k!=="children"&&k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(Zy.hasOwnProperty(k)?g||(g=[]):(g=g||[]).push(k,null));for(k in a){var E=a[k];if(i=d!=null?d[k]:void 0,a.hasOwnProperty(k)&&E!==i&&(E!=null||i!=null))if(k==="style")if(i){for(v in i)!i.hasOwnProperty(v)||E&&E.hasOwnProperty(v)||(s||(s={}),s[v]="");for(v in E)E.hasOwnProperty(v)&&i[v]!==E[v]&&(s||(s={}),s[v]=E[v])}else s||(g||(g=[]),g.push(k,s)),s=E;else k==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,i=i?i.__html:void 0,E!=null&&i!==E&&(g=g||[]).push(k,E)):k==="children"?typeof E!="string"&&typeof E!="number"||(g=g||[]).push(k,""+E):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&(Zy.hasOwnProperty(k)?(E!=null&&k==="onScroll"&&Us("scroll",t),g||i===E||(g=[])):(g=g||[]).push(k,E))}s&&(g=g||[]).push("style",s);var k=g;(e.updateQueue=k)&&(e.flags|=4)}};BR=function(t,e,s,a){s!==a&&(e.flags|=4)};function gy(t,e){if(!eo)switch(t.tailMode){case"hidden":e=t.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:a.sibling=null}}function rl(t){var e=t.alternate!==null&&t.alternate.child===t.child,s=0,a=0;if(e)for(var d=t.child;d!==null;)s|=d.lanes|d.childLanes,a|=d.subtreeFlags&14680064,a|=d.flags&14680064,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)s|=d.lanes|d.childLanes,a|=d.subtreeFlags,a|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=a,t.childLanes=s,e}function lV(t,e,s){var a=e.pendingProps;switch(I3(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rl(e),null;case 1:return gc(e.type)&&ob(),rl(e),null;case 3:return a=e.stateNode,J_(),Gs(mc),Gs(dl),B3(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&(nx(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,lh!==null&&(rT(lh),lh=null))),KS(t,e),rl(e),null;case 5:F3(e);var d=jm(ov.current);if(s=e.type,t!==null&&e.stateNode!=null)FR(t,e,s,a,d),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!a){if(e.stateNode===null)throw Error(zn(166));return rl(e),null}if(t=jm(rd.current),nx(e)){a=e.stateNode,s=e.type;var g=e.memoizedProps;switch(a[Jh]=e,a[iv]=g,t=(e.mode&1)!==0,s){case"dialog":Us("cancel",a),Us("close",a);break;case"iframe":case"object":case"embed":Us("load",a);break;case"video":case"audio":for(d=0;d<Cy.length;d++)Us(Cy[d],a);break;case"source":Us("error",a);break;case"img":case"image":case"link":Us("error",a),Us("load",a);break;case"details":Us("toggle",a);break;case"input":YM(a,g),Us("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!g.multiple},Us("invalid",a);break;case"textarea":QM(a,g),Us("invalid",a)}wS(s,g),d=null;for(var v in g)if(g.hasOwnProperty(v)){var i=g[v];v==="children"?typeof i=="string"?a.textContent!==i&&(g.suppressHydrationWarning!==!0&&tx(a.textContent,i,t),d=["children",i]):typeof i=="number"&&a.textContent!==""+i&&(g.suppressHydrationWarning!==!0&&tx(a.textContent,i,t),d=["children",""+i]):Zy.hasOwnProperty(v)&&i!=null&&v==="onScroll"&&Us("scroll",a)}switch(s){case"input":W1(a),JM(a,g,!0);break;case"textarea":W1(a),eI(a);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(a.onclick=sb)}a=d,e.updateQueue=a,a!==null&&(e.flags|=4)}else{v=d.nodeType===9?d:d.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=fk(s)),t==="http://www.w3.org/1999/xhtml"?s==="script"?(t=v.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof a.is=="string"?t=v.createElement(s,{is:a.is}):(t=v.createElement(s),s==="select"&&(v=t,a.multiple?v.multiple=!0:a.size&&(v.size=a.size))):t=v.createElementNS(t,s),t[Jh]=e,t[iv]=a,zR(t,e,!1,!1),e.stateNode=t;e:{switch(v=SS(s,a),s){case"dialog":Us("cancel",t),Us("close",t),d=a;break;case"iframe":case"object":case"embed":Us("load",t),d=a;break;case"video":case"audio":for(d=0;d<Cy.length;d++)Us(Cy[d],t);d=a;break;case"source":Us("error",t),d=a;break;case"img":case"image":case"link":Us("error",t),Us("load",t),d=a;break;case"details":Us("toggle",t),d=a;break;case"input":YM(t,a),d=_S(t,a),Us("invalid",t);break;case"option":d=a;break;case"select":t._wrapperState={wasMultiple:!!a.multiple},d=uo({},a,{value:void 0}),Us("invalid",t);break;case"textarea":QM(t,a),d=xS(t,a),Us("invalid",t);break;default:d=a}wS(s,d),i=d;for(g in i)if(i.hasOwnProperty(g)){var E=i[g];g==="style"?gk(t,E):g==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,E!=null&&pk(t,E)):g==="children"?typeof E=="string"?(s!=="textarea"||E!=="")&&Ky(t,E):typeof E=="number"&&Ky(t,""+E):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(Zy.hasOwnProperty(g)?E!=null&&g==="onScroll"&&Us("scroll",t):E!=null&&m3(t,g,E,v))}switch(s){case"input":W1(t),JM(t,a,!1);break;case"textarea":W1(t),eI(t);break;case"option":a.value!=null&&t.setAttribute("value",""+Ip(a.value));break;case"select":t.multiple=!!a.multiple,g=a.value,g!=null?v_(t,!!a.multiple,g,!1):a.defaultValue!=null&&v_(t,!!a.multiple,a.defaultValue,!0);break;default:typeof d.onClick=="function"&&(t.onclick=sb)}switch(s){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return rl(e),null;case 6:if(t&&e.stateNode!=null)BR(t,e,t.memoizedProps,a);else{if(typeof a!="string"&&e.stateNode===null)throw Error(zn(166));if(s=jm(ov.current),jm(rd.current),nx(e)){if(a=e.stateNode,s=e.memoizedProps,a[Jh]=e,(g=a.nodeValue!==s)&&(t=$c,t!==null))switch(t.tag){case 3:tx(a.nodeValue,s,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&tx(a.nodeValue,s,(t.mode&1)!==0)}g&&(e.flags|=4)}else a=(s.nodeType===9?s:s.ownerDocument).createTextNode(a),a[Jh]=e,e.stateNode=a}return rl(e),null;case 13:if(Gs(lo),a=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(eo&&Vc!==null&&e.mode&1&&!(e.flags&128))rR(),X_(),e.flags|=98560,g=!1;else if(g=nx(e),a!==null&&a.dehydrated!==null){if(t===null){if(!g)throw Error(zn(318));if(g=e.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(zn(317));g[Jh]=e}else X_(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;rl(e),g=!1}else lh!==null&&(rT(lh),lh=null),g=!0;if(!g)return e.flags&65536?e:null}return e.flags&128?(e.lanes=s,e):(a=a!==null,a!==(t!==null&&t.memoizedState!==null)&&a&&(e.child.flags|=8192,e.mode&1&&(t===null||lo.current&1?ca===0&&(ca=3):Y3())),e.updateQueue!==null&&(e.flags|=4),rl(e),null);case 4:return J_(),KS(t,e),t===null&&nv(e.stateNode.containerInfo),rl(e),null;case 10:return D3(e.type._context),rl(e),null;case 17:return gc(e.type)&&ob(),rl(e),null;case 19:if(Gs(lo),g=e.memoizedState,g===null)return rl(e),null;if(a=(e.flags&128)!==0,v=g.rendering,v===null)if(a)gy(g,!1);else{if(ca!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(v=fb(t),v!==null){for(e.flags|=128,gy(g,!1),a=v.updateQueue,a!==null&&(e.updateQueue=a,e.flags|=4),e.subtreeFlags=0,a=s,s=e.child;s!==null;)g=s,t=a,g.flags&=14680066,v=g.alternate,v===null?(g.childLanes=0,g.lanes=t,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=v.childLanes,g.lanes=v.lanes,g.child=v.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=v.memoizedProps,g.memoizedState=v.memoizedState,g.updateQueue=v.updateQueue,g.type=v.type,t=v.dependencies,g.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),s=s.sibling;return ks(lo,lo.current&1|2),e.child}t=t.sibling}g.tail!==null&&Lo()>e0&&(e.flags|=128,a=!0,gy(g,!1),e.lanes=4194304)}else{if(!a)if(t=fb(v),t!==null){if(e.flags|=128,a=!0,s=t.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),gy(g,!0),g.tail===null&&g.tailMode==="hidden"&&!v.alternate&&!eo)return rl(e),null}else 2*Lo()-g.renderingStartTime>e0&&s!==1073741824&&(e.flags|=128,a=!0,gy(g,!1),e.lanes=4194304);g.isBackwards?(v.sibling=e.child,e.child=v):(s=g.last,s!==null?s.sibling=v:e.child=v,g.last=v)}return g.tail!==null?(e=g.tail,g.rendering=e,g.tail=e.sibling,g.renderingStartTime=Lo(),e.sibling=null,s=lo.current,ks(lo,a?s&1|2:s&1),e):(rl(e),null);case 22:case 23:return X3(),a=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==a&&(e.flags|=8192),a&&e.mode&1?Bc&1073741824&&(rl(e),e.subtreeFlags&6&&(e.flags|=8192)):rl(e),null;case 24:return null;case 25:return null}throw Error(zn(156,e.tag))}function cV(t,e){switch(I3(e),e.tag){case 1:return gc(e.type)&&ob(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return J_(),Gs(mc),Gs(dl),B3(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return F3(e),null;case 13:if(Gs(lo),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(zn(340));X_()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Gs(lo),null;case 4:return J_(),null;case 10:return D3(e.type._context),null;case 22:case 23:return X3(),null;case 24:return null;default:return null}}var sx=!1,cl=!1,uV=typeof WeakSet=="function"?WeakSet:Set,dr=null;function m_(t,e){var s=t.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(a){vo(t,e,a)}else s.current=null}function XS(t,e,s){try{s()}catch(a){vo(t,e,a)}}var qI=!1;function hV(t,e){if(RS=nb,t=$k(),P3(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var a=s.getSelection&&s.getSelection();if(a&&a.rangeCount!==0){s=a.anchorNode;var d=a.anchorOffset,g=a.focusNode;a=a.focusOffset;try{s.nodeType,g.nodeType}catch{s=null;break e}var v=0,i=-1,E=-1,k=0,O=0,z=t,G=null;t:for(;;){for(var U;z!==s||d!==0&&z.nodeType!==3||(i=v+d),z!==g||a!==0&&z.nodeType!==3||(E=v+a),z.nodeType===3&&(v+=z.nodeValue.length),(U=z.firstChild)!==null;)G=z,z=U;for(;;){if(z===t)break t;if(G===s&&++k===d&&(i=v),G===g&&++O===a&&(E=v),(U=z.nextSibling)!==null)break;z=G,G=z.parentNode}z=U}s=i===-1||E===-1?null:{start:i,end:E}}else s=null}s=s||{start:0,end:0}}else s=null;for(DS={focusedElem:t,selectionRange:s},nb=!1,dr=e;dr!==null;)if(e=dr,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,dr=t;else for(;dr!==null;){e=dr;try{var ie=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(ie!==null){var Q=ie.memoizedProps,se=ie.memoizedState,J=e.stateNode,te=J.getSnapshotBeforeUpdate(e.elementType===e.type?Q:rh(e.type,Q),se);J.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var le=e.stateNode.containerInfo;le.nodeType===1?le.textContent="":le.nodeType===9&&le.documentElement&&le.removeChild(le.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(zn(163))}}catch(ye){vo(e,e.return,ye)}if(t=e.sibling,t!==null){t.return=e.return,dr=t;break}dr=e.return}return ie=qI,qI=!1,ie}function By(t,e,s){var a=e.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&t)===t){var g=d.destroy;d.destroy=void 0,g!==void 0&&XS(e,s,g)}d=d.next}while(d!==a)}}function Zb(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var s=e=e.next;do{if((s.tag&t)===t){var a=s.create;s.destroy=a()}s=s.next}while(s!==e)}}function YS(t){var e=t.ref;if(e!==null){var s=t.stateNode;switch(t.tag){case 5:t=s;break;default:t=s}typeof e=="function"?e(t):e.current=t}}function jR(t){var e=t.alternate;e!==null&&(t.alternate=null,jR(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Jh],delete e[iv],delete e[zS],delete e[WU],delete e[ZU])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function UR(t){return t.tag===5||t.tag===3||t.tag===4}function $I(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||UR(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function JS(t,e,s){var a=t.tag;if(a===5||a===6)t=t.stateNode,e?s.nodeType===8?s.parentNode.insertBefore(t,e):s.insertBefore(t,e):(s.nodeType===8?(e=s.parentNode,e.insertBefore(t,s)):(e=s,e.appendChild(t)),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=sb));else if(a!==4&&(t=t.child,t!==null))for(JS(t,e,s),t=t.sibling;t!==null;)JS(t,e,s),t=t.sibling}function QS(t,e,s){var a=t.tag;if(a===5||a===6)t=t.stateNode,e?s.insertBefore(t,e):s.appendChild(t);else if(a!==4&&(t=t.child,t!==null))for(QS(t,e,s),t=t.sibling;t!==null;)QS(t,e,s),t=t.sibling}var Na=null,oh=!1;function Wf(t,e,s){for(s=s.child;s!==null;)VR(t,e,s),s=s.sibling}function VR(t,e,s){if(nd&&typeof nd.onCommitFiberUnmount=="function")try{nd.onCommitFiberUnmount(jb,s)}catch{}switch(s.tag){case 5:cl||m_(s,e);case 6:var a=Na,d=oh;Na=null,Wf(t,e,s),Na=a,oh=d,Na!==null&&(oh?(t=Na,s=s.stateNode,t.nodeType===8?t.parentNode.removeChild(s):t.removeChild(s)):Na.removeChild(s.stateNode));break;case 18:Na!==null&&(oh?(t=Na,s=s.stateNode,t.nodeType===8?x5(t.parentNode,s):t.nodeType===1&&x5(t,s),Qy(t)):x5(Na,s.stateNode));break;case 4:a=Na,d=oh,Na=s.stateNode.containerInfo,oh=!0,Wf(t,e,s),Na=a,oh=d;break;case 0:case 11:case 14:case 15:if(!cl&&(a=s.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){d=a=a.next;do{var g=d,v=g.destroy;g=g.tag,v!==void 0&&(g&2||g&4)&&XS(s,e,v),d=d.next}while(d!==a)}Wf(t,e,s);break;case 1:if(!cl&&(m_(s,e),a=s.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=s.memoizedProps,a.state=s.memoizedState,a.componentWillUnmount()}catch(i){vo(s,e,i)}Wf(t,e,s);break;case 21:Wf(t,e,s);break;case 22:s.mode&1?(cl=(a=cl)||s.memoizedState!==null,Wf(t,e,s),cl=a):Wf(t,e,s);break;default:Wf(t,e,s)}}function GI(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var s=t.stateNode;s===null&&(s=t.stateNode=new uV),e.forEach(function(a){var d=xV.bind(null,t,a);s.has(a)||(s.add(a),a.then(d,d))})}}function Qu(t,e){var s=e.deletions;if(s!==null)for(var a=0;a<s.length;a++){var d=s[a];try{var g=t,v=e,i=v;e:for(;i!==null;){switch(i.tag){case 5:Na=i.stateNode,oh=!1;break e;case 3:Na=i.stateNode.containerInfo,oh=!0;break e;case 4:Na=i.stateNode.containerInfo,oh=!0;break e}i=i.return}if(Na===null)throw Error(zn(160));VR(g,v,d),Na=null,oh=!1;var E=d.alternate;E!==null&&(E.return=null),d.return=null}catch(k){vo(d,e,k)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)qR(e,t),e=e.sibling}function qR(t,e){var s=t.alternate,a=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Qu(e,t),qh(t),a&4){try{By(3,t,t.return),Zb(3,t)}catch(Q){vo(t,t.return,Q)}try{By(5,t,t.return)}catch(Q){vo(t,t.return,Q)}}break;case 1:Qu(e,t),qh(t),a&512&&s!==null&&m_(s,s.return);break;case 5:if(Qu(e,t),qh(t),a&512&&s!==null&&m_(s,s.return),t.flags&32){var d=t.stateNode;try{Ky(d,"")}catch(Q){vo(t,t.return,Q)}}if(a&4&&(d=t.stateNode,d!=null)){var g=t.memoizedProps,v=s!==null?s.memoizedProps:g,i=t.type,E=t.updateQueue;if(t.updateQueue=null,E!==null)try{i==="input"&&g.type==="radio"&&g.name!=null&&hk(d,g),SS(i,v);var k=SS(i,g);for(v=0;v<E.length;v+=2){var O=E[v],z=E[v+1];O==="style"?gk(d,z):O==="dangerouslySetInnerHTML"?pk(d,z):O==="children"?Ky(d,z):m3(d,O,z,k)}switch(i){case"input":yS(d,g);break;case"textarea":dk(d,g);break;case"select":var G=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!g.multiple;var U=g.value;U!=null?v_(d,!!g.multiple,U,!1):G!==!!g.multiple&&(g.defaultValue!=null?v_(d,!!g.multiple,g.defaultValue,!0):v_(d,!!g.multiple,g.multiple?[]:"",!1))}d[iv]=g}catch(Q){vo(t,t.return,Q)}}break;case 6:if(Qu(e,t),qh(t),a&4){if(t.stateNode===null)throw Error(zn(162));d=t.stateNode,g=t.memoizedProps;try{d.nodeValue=g}catch(Q){vo(t,t.return,Q)}}break;case 3:if(Qu(e,t),qh(t),a&4&&s!==null&&s.memoizedState.isDehydrated)try{Qy(e.containerInfo)}catch(Q){vo(t,t.return,Q)}break;case 4:Qu(e,t),qh(t);break;case 13:Qu(e,t),qh(t),d=t.child,d.flags&8192&&(g=d.memoizedState!==null,d.stateNode.isHidden=g,!g||d.alternate!==null&&d.alternate.memoizedState!==null||(Z3=Lo())),a&4&&GI(t);break;case 22:if(O=s!==null&&s.memoizedState!==null,t.mode&1?(cl=(k=cl)||O,Qu(e,t),cl=k):Qu(e,t),qh(t),a&8192){if(k=t.memoizedState!==null,(t.stateNode.isHidden=k)&&!O&&t.mode&1)for(dr=t,O=t.child;O!==null;){for(z=dr=O;dr!==null;){switch(G=dr,U=G.child,G.tag){case 0:case 11:case 14:case 15:By(4,G,G.return);break;case 1:m_(G,G.return);var ie=G.stateNode;if(typeof ie.componentWillUnmount=="function"){a=G,s=G.return;try{e=a,ie.props=e.memoizedProps,ie.state=e.memoizedState,ie.componentWillUnmount()}catch(Q){vo(a,s,Q)}}break;case 5:m_(G,G.return);break;case 22:if(G.memoizedState!==null){WI(z);continue}}U!==null?(U.return=G,dr=U):WI(z)}O=O.sibling}e:for(O=null,z=t;;){if(z.tag===5){if(O===null){O=z;try{d=z.stateNode,k?(g=d.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(i=z.stateNode,E=z.memoizedProps.style,v=E!=null&&E.hasOwnProperty("display")?E.display:null,i.style.display=mk("display",v))}catch(Q){vo(t,t.return,Q)}}}else if(z.tag===6){if(O===null)try{z.stateNode.nodeValue=k?"":z.memoizedProps}catch(Q){vo(t,t.return,Q)}}else if((z.tag!==22&&z.tag!==23||z.memoizedState===null||z===t)&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===t)break e;for(;z.sibling===null;){if(z.return===null||z.return===t)break e;O===z&&(O=null),z=z.return}O===z&&(O=null),z.sibling.return=z.return,z=z.sibling}}break;case 19:Qu(e,t),qh(t),a&4&&GI(t);break;case 21:break;default:Qu(e,t),qh(t)}}function qh(t){var e=t.flags;if(e&2){try{e:{for(var s=t.return;s!==null;){if(UR(s)){var a=s;break e}s=s.return}throw Error(zn(160))}switch(a.tag){case 5:var d=a.stateNode;a.flags&32&&(Ky(d,""),a.flags&=-33);var g=$I(t);QS(t,g,d);break;case 3:case 4:var v=a.stateNode.containerInfo,i=$I(t);JS(t,i,v);break;default:throw Error(zn(161))}}catch(E){vo(t,t.return,E)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function dV(t,e,s){dr=t,$R(t)}function $R(t,e,s){for(var a=(t.mode&1)!==0;dr!==null;){var d=dr,g=d.child;if(d.tag===22&&a){var v=d.memoizedState!==null||sx;if(!v){var i=d.alternate,E=i!==null&&i.memoizedState!==null||cl;i=sx;var k=cl;if(sx=v,(cl=E)&&!k)for(dr=d;dr!==null;)v=dr,E=v.child,v.tag===22&&v.memoizedState!==null?ZI(d):E!==null?(E.return=v,dr=E):ZI(d);for(;g!==null;)dr=g,$R(g),g=g.sibling;dr=d,sx=i,cl=k}HI(t)}else d.subtreeFlags&8772&&g!==null?(g.return=d,dr=g):HI(t)}}function HI(t){for(;dr!==null;){var e=dr;if(e.flags&8772){var s=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:cl||Zb(5,e);break;case 1:var a=e.stateNode;if(e.flags&4&&!cl)if(s===null)a.componentDidMount();else{var d=e.elementType===e.type?s.memoizedProps:rh(e.type,s.memoizedProps);a.componentDidUpdate(d,s.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var g=e.updateQueue;g!==null&&II(e,g,a);break;case 3:var v=e.updateQueue;if(v!==null){if(s=null,e.child!==null)switch(e.child.tag){case 5:s=e.child.stateNode;break;case 1:s=e.child.stateNode}II(e,v,s)}break;case 5:var i=e.stateNode;if(s===null&&e.flags&4){s=i;var E=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":E.autoFocus&&s.focus();break;case"img":E.src&&(s.src=E.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var k=e.alternate;if(k!==null){var O=k.memoizedState;if(O!==null){var z=O.dehydrated;z!==null&&Qy(z)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(zn(163))}cl||e.flags&512&&YS(e)}catch(G){vo(e,e.return,G)}}if(e===t){dr=null;break}if(s=e.sibling,s!==null){s.return=e.return,dr=s;break}dr=e.return}}function WI(t){for(;dr!==null;){var e=dr;if(e===t){dr=null;break}var s=e.sibling;if(s!==null){s.return=e.return,dr=s;break}dr=e.return}}function ZI(t){for(;dr!==null;){var e=dr;try{switch(e.tag){case 0:case 11:case 15:var s=e.return;try{Zb(4,e)}catch(E){vo(e,s,E)}break;case 1:var a=e.stateNode;if(typeof a.componentDidMount=="function"){var d=e.return;try{a.componentDidMount()}catch(E){vo(e,d,E)}}var g=e.return;try{YS(e)}catch(E){vo(e,g,E)}break;case 5:var v=e.return;try{YS(e)}catch(E){vo(e,v,E)}}}catch(E){vo(e,e.return,E)}if(e===t){dr=null;break}var i=e.sibling;if(i!==null){i.return=e.return,dr=i;break}dr=e.return}}var fV=Math.ceil,gb=mf.ReactCurrentDispatcher,H3=mf.ReactCurrentOwner,wu=mf.ReactCurrentBatchConfig,Xi=0,wa=null,Go=null,za=0,Bc=0,g_=jp(0),ca=0,uv=null,tg=0,Kb=0,W3=0,jy=null,hc=null,Z3=0,e0=1/0,Zd=null,_b=!1,eT=null,Cp=null,ox=!1,xp=null,yb=0,Uy=0,tT=null,Nx=-1,Ox=0;function jl(){return Xi&6?Lo():Nx!==-1?Nx:Nx=Lo()}function Pp(t){return t.mode&1?Xi&2&&za!==0?za&-za:XU.transition!==null?(Ox===0&&(Ox=Pk()),Ox):(t=us,t!==0||(t=window.event,t=t===void 0?16:Nk(t.type)),t):1}function hh(t,e,s,a){if(50<Uy)throw Uy=0,tT=null,Error(zn(185));Av(t,s,a),(!(Xi&2)||t!==wa)&&(t===wa&&(!(Xi&2)&&(Kb|=s),ca===4&&ap(t,za)),_c(t,a),s===1&&Xi===0&&!(e.mode&1)&&(e0=Lo()+500,Gb&&Up()))}function _c(t,e){var s=t.callbackNode;X7(t,e);var a=tb(t,t===wa?za:0);if(a===0)s!==null&&rI(s),t.callbackNode=null,t.callbackPriority=0;else if(e=a&-a,t.callbackPriority!==e){if(s!=null&&rI(s),e===1)t.tag===0?KU(KI.bind(null,t)):eR(KI.bind(null,t)),GU(function(){!(Xi&6)&&Up()}),s=null;else{switch(Mk(a)){case 1:s=x3;break;case 4:s=Ek;break;case 16:s=eb;break;case 536870912:s=Ck;break;default:s=eb}s=JR(s,GR.bind(null,t))}t.callbackPriority=e,t.callbackNode=s}}function GR(t,e){if(Nx=-1,Ox=0,Xi&6)throw Error(zn(327));var s=t.callbackNode;if(T_()&&t.callbackNode!==s)return null;var a=tb(t,t===wa?za:0);if(a===0)return null;if(a&30||a&t.expiredLanes||e)e=vb(t,a);else{e=a;var d=Xi;Xi|=2;var g=WR();(wa!==t||za!==e)&&(Zd=null,e0=Lo()+500,Zm(t,e));do try{gV();break}catch(i){HR(t,i)}while(!0);R3(),gb.current=g,Xi=d,Go!==null?e=0:(wa=null,za=0,e=ca)}if(e!==0){if(e===2&&(d=PS(t),d!==0&&(a=d,e=nT(t,d))),e===1)throw s=uv,Zm(t,0),ap(t,a),_c(t,Lo()),s;if(e===6)ap(t,a);else{if(d=t.current.alternate,!(a&30)&&!pV(d)&&(e=vb(t,a),e===2&&(g=PS(t),g!==0&&(a=g,e=nT(t,g))),e===1))throw s=uv,Zm(t,0),ap(t,a),_c(t,Lo()),s;switch(t.finishedWork=d,t.finishedLanes=a,e){case 0:case 1:throw Error(zn(345));case 2:Rm(t,hc,Zd);break;case 3:if(ap(t,a),(a&130023424)===a&&(e=Z3+500-Lo(),10<e)){if(tb(t,0)!==0)break;if(d=t.suspendedLanes,(d&a)!==a){jl(),t.pingedLanes|=t.suspendedLanes&d;break}t.timeoutHandle=OS(Rm.bind(null,t,hc,Zd),e);break}Rm(t,hc,Zd);break;case 4:if(ap(t,a),(a&4194240)===a)break;for(e=t.eventTimes,d=-1;0<a;){var v=31-uh(a);g=1<<v,v=e[v],v>d&&(d=v),a&=~g}if(a=d,a=Lo()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*fV(a/1960))-a,10<a){t.timeoutHandle=OS(Rm.bind(null,t,hc,Zd),a);break}Rm(t,hc,Zd);break;case 5:Rm(t,hc,Zd);break;default:throw Error(zn(329))}}}return _c(t,Lo()),t.callbackNode===s?GR.bind(null,t):null}function nT(t,e){var s=jy;return t.current.memoizedState.isDehydrated&&(Zm(t,e).flags|=256),t=vb(t,e),t!==2&&(e=hc,hc=s,e!==null&&rT(e)),t}function rT(t){hc===null?hc=t:hc.push.apply(hc,t)}function pV(t){for(var e=t;;){if(e.flags&16384){var s=e.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var a=0;a<s.length;a++){var d=s[a],g=d.getSnapshot;d=d.value;try{if(!dh(g(),d))return!1}catch{return!1}}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ap(t,e){for(e&=~W3,e&=~Kb,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var s=31-uh(e),a=1<<s;t[s]=-1,e&=~a}}function KI(t){if(Xi&6)throw Error(zn(327));T_();var e=tb(t,0);if(!(e&1))return _c(t,Lo()),null;var s=vb(t,e);if(t.tag!==0&&s===2){var a=PS(t);a!==0&&(e=a,s=nT(t,a))}if(s===1)throw s=uv,Zm(t,0),ap(t,e),_c(t,Lo()),s;if(s===6)throw Error(zn(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Rm(t,hc,Zd),_c(t,Lo()),null}function K3(t,e){var s=Xi;Xi|=1;try{return t(e)}finally{Xi=s,Xi===0&&(e0=Lo()+500,Gb&&Up())}}function ng(t){xp!==null&&xp.tag===0&&!(Xi&6)&&T_();var e=Xi;Xi|=1;var s=wu.transition,a=us;try{if(wu.transition=null,us=1,t)return t()}finally{us=a,wu.transition=s,Xi=e,!(Xi&6)&&Up()}}function X3(){Bc=g_.current,Gs(g_)}function Zm(t,e){t.finishedWork=null,t.finishedLanes=0;var s=t.timeoutHandle;if(s!==-1&&(t.timeoutHandle=-1,$U(s)),Go!==null)for(s=Go.return;s!==null;){var a=s;switch(I3(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&ob();break;case 3:J_(),Gs(mc),Gs(dl),B3();break;case 5:F3(a);break;case 4:J_();break;case 13:Gs(lo);break;case 19:Gs(lo);break;case 10:D3(a.type._context);break;case 22:case 23:X3()}s=s.return}if(wa=t,Go=t=Mp(t.current,null),za=Bc=e,ca=0,uv=null,W3=Kb=tg=0,hc=jy=null,Bm!==null){for(e=0;e<Bm.length;e++)if(s=Bm[e],a=s.interleaved,a!==null){s.interleaved=null;var d=a.next,g=s.pending;if(g!==null){var v=g.next;g.next=d,a.next=v}s.pending=a}Bm=null}return t}function HR(t,e){do{var s=Go;try{if(R3(),kx.current=mb,pb){for(var a=co.memoizedState;a!==null;){var d=a.queue;d!==null&&(d.pending=null),a=a.next}pb=!1}if(eg=0,xa=aa=co=null,Fy=!1,av=0,H3.current=null,s===null||s.return===null){ca=1,uv=e,Go=null;break}e:{var g=t,v=s.return,i=s,E=e;if(e=za,i.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){var k=E,O=i,z=O.tag;if(!(O.mode&1)&&(z===0||z===11||z===15)){var G=O.alternate;G?(O.updateQueue=G.updateQueue,O.memoizedState=G.memoizedState,O.lanes=G.lanes):(O.updateQueue=null,O.memoizedState=null)}var U=OI(v);if(U!==null){U.flags&=-257,zI(U,v,i,g,e),U.mode&1&&NI(g,k,e),e=U,E=k;var ie=e.updateQueue;if(ie===null){var Q=new Set;Q.add(E),e.updateQueue=Q}else ie.add(E);break e}else{if(!(e&1)){NI(g,k,e),Y3();break e}E=Error(zn(426))}}else if(eo&&i.mode&1){var se=OI(v);if(se!==null){!(se.flags&65536)&&(se.flags|=256),zI(se,v,i,g,e),L3(Q_(E,i));break e}}g=E=Q_(E,i),ca!==4&&(ca=2),jy===null?jy=[g]:jy.push(g),g=v;do{switch(g.tag){case 3:g.flags|=65536,e&=-e,g.lanes|=e;var J=MR(g,E,e);MI(g,J);break e;case 1:i=E;var te=g.type,le=g.stateNode;if(!(g.flags&128)&&(typeof te.getDerivedStateFromError=="function"||le!==null&&typeof le.componentDidCatch=="function"&&(Cp===null||!Cp.has(le)))){g.flags|=65536,e&=-e,g.lanes|=e;var ye=IR(g,i,e);MI(g,ye);break e}}g=g.return}while(g!==null)}KR(s)}catch(Ne){e=Ne,Go===s&&s!==null&&(Go=s=s.return);continue}break}while(!0)}function WR(){var t=gb.current;return gb.current=mb,t===null?mb:t}function Y3(){(ca===0||ca===3||ca===2)&&(ca=4),wa===null||!(tg&268435455)&&!(Kb&268435455)||ap(wa,za)}function vb(t,e){var s=Xi;Xi|=2;var a=WR();(wa!==t||za!==e)&&(Zd=null,Zm(t,e));do try{mV();break}catch(d){HR(t,d)}while(!0);if(R3(),Xi=s,gb.current=a,Go!==null)throw Error(zn(261));return wa=null,za=0,ca}function mV(){for(;Go!==null;)ZR(Go)}function gV(){for(;Go!==null&&!U7();)ZR(Go)}function ZR(t){var e=YR(t.alternate,t,Bc);t.memoizedProps=t.pendingProps,e===null?KR(t):Go=e,H3.current=null}function KR(t){var e=t;do{var s=e.alternate;if(t=e.return,e.flags&32768){if(s=cV(s,e),s!==null){s.flags&=32767,Go=s;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ca=6,Go=null;return}}else if(s=lV(s,e,Bc),s!==null){Go=s;return}if(e=e.sibling,e!==null){Go=e;return}Go=e=t}while(e!==null);ca===0&&(ca=5)}function Rm(t,e,s){var a=us,d=wu.transition;try{wu.transition=null,us=1,_V(t,e,s,a)}finally{wu.transition=d,us=a}return null}function _V(t,e,s,a){do T_();while(xp!==null);if(Xi&6)throw Error(zn(327));s=t.finishedWork;var d=t.finishedLanes;if(s===null)return null;if(t.finishedWork=null,t.finishedLanes=0,s===t.current)throw Error(zn(177));t.callbackNode=null,t.callbackPriority=0;var g=s.lanes|s.childLanes;if(Y7(t,g),t===wa&&(Go=wa=null,za=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||ox||(ox=!0,JR(eb,function(){return T_(),null})),g=(s.flags&15990)!==0,s.subtreeFlags&15990||g){g=wu.transition,wu.transition=null;var v=us;us=1;var i=Xi;Xi|=4,H3.current=null,hV(t,s),qR(s,t),zU(DS),nb=!!RS,DS=RS=null,t.current=s,dV(s),V7(),Xi=i,us=v,wu.transition=g}else t.current=s;if(ox&&(ox=!1,xp=t,yb=d),g=t.pendingLanes,g===0&&(Cp=null),G7(s.stateNode),_c(t,Lo()),e!==null)for(a=t.onRecoverableError,s=0;s<e.length;s++)d=e[s],a(d.value,{componentStack:d.stack,digest:d.digest});if(_b)throw _b=!1,t=eT,eT=null,t;return yb&1&&t.tag!==0&&T_(),g=t.pendingLanes,g&1?t===tT?Uy++:(Uy=0,tT=t):Uy=0,Up(),null}function T_(){if(xp!==null){var t=Mk(yb),e=wu.transition,s=us;try{if(wu.transition=null,us=16>t?16:t,xp===null)var a=!1;else{if(t=xp,xp=null,yb=0,Xi&6)throw Error(zn(331));var d=Xi;for(Xi|=4,dr=t.current;dr!==null;){var g=dr,v=g.child;if(dr.flags&16){var i=g.deletions;if(i!==null){for(var E=0;E<i.length;E++){var k=i[E];for(dr=k;dr!==null;){var O=dr;switch(O.tag){case 0:case 11:case 15:By(8,O,g)}var z=O.child;if(z!==null)z.return=O,dr=z;else for(;dr!==null;){O=dr;var G=O.sibling,U=O.return;if(jR(O),O===k){dr=null;break}if(G!==null){G.return=U,dr=G;break}dr=U}}}var ie=g.alternate;if(ie!==null){var Q=ie.child;if(Q!==null){ie.child=null;do{var se=Q.sibling;Q.sibling=null,Q=se}while(Q!==null)}}dr=g}}if(g.subtreeFlags&2064&&v!==null)v.return=g,dr=v;else e:for(;dr!==null;){if(g=dr,g.flags&2048)switch(g.tag){case 0:case 11:case 15:By(9,g,g.return)}var J=g.sibling;if(J!==null){J.return=g.return,dr=J;break e}dr=g.return}}var te=t.current;for(dr=te;dr!==null;){v=dr;var le=v.child;if(v.subtreeFlags&2064&&le!==null)le.return=v,dr=le;else e:for(v=te;dr!==null;){if(i=dr,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:Zb(9,i)}}catch(Ne){vo(i,i.return,Ne)}if(i===v){dr=null;break e}var ye=i.sibling;if(ye!==null){ye.return=i.return,dr=ye;break e}dr=i.return}}if(Xi=d,Up(),nd&&typeof nd.onPostCommitFiberRoot=="function")try{nd.onPostCommitFiberRoot(jb,t)}catch{}a=!0}return a}finally{us=s,wu.transition=e}}return!1}function XI(t,e,s){e=Q_(s,e),e=MR(t,e,1),t=Ep(t,e,1),e=jl(),t!==null&&(Av(t,1,e),_c(t,e))}function vo(t,e,s){if(t.tag===3)XI(t,t,s);else for(;e!==null;){if(e.tag===3){XI(e,t,s);break}else if(e.tag===1){var a=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Cp===null||!Cp.has(a))){t=Q_(s,t),t=IR(e,t,1),e=Ep(e,t,1),t=jl(),e!==null&&(Av(e,1,t),_c(e,t));break}}e=e.return}}function yV(t,e,s){var a=t.pingCache;a!==null&&a.delete(e),e=jl(),t.pingedLanes|=t.suspendedLanes&s,wa===t&&(za&s)===s&&(ca===4||ca===3&&(za&130023424)===za&&500>Lo()-Z3?Zm(t,0):W3|=s),_c(t,e)}function XR(t,e){e===0&&(t.mode&1?(e=X1,X1<<=1,!(X1&130023424)&&(X1=4194304)):e=1);var s=jl();t=cf(t,e),t!==null&&(Av(t,e,s),_c(t,s))}function vV(t){var e=t.memoizedState,s=0;e!==null&&(s=e.retryLane),XR(t,s)}function xV(t,e){var s=0;switch(t.tag){case 13:var a=t.stateNode,d=t.memoizedState;d!==null&&(s=d.retryLane);break;case 19:a=t.stateNode;break;default:throw Error(zn(314))}a!==null&&a.delete(e),XR(t,s)}var YR;YR=function(t,e,s){if(t!==null)if(t.memoizedProps!==e.pendingProps||mc.current)pc=!0;else{if(!(t.lanes&s)&&!(e.flags&128))return pc=!1,aV(t,e,s);pc=!!(t.flags&131072)}else pc=!1,eo&&e.flags&1048576&&tR(e,cb,e.index);switch(e.lanes=0,e.tag){case 2:var a=e.type;Dx(t,e),t=e.pendingProps;var d=K_(e,dl.current);S_(e,s),d=U3(null,e,a,t,d,s);var g=V3();return e.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,gc(a)?(g=!0,ab(e)):g=!1,e.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,O3(e),d.updater=Wb,e.stateNode=d,d._reactInternals=e,qS(e,a,t,s),e=HS(null,e,a,!0,g,s)):(e.tag=0,eo&&g&&M3(e),Bl(null,e,d,s),e=e.child),e;case 16:a=e.elementType;e:{switch(Dx(t,e),t=e.pendingProps,d=a._init,a=d(a._payload),e.type=a,d=e.tag=wV(a),t=rh(a,t),d){case 0:e=GS(null,e,a,t,s);break e;case 1:e=jI(null,e,a,t,s);break e;case 11:e=FI(null,e,a,t,s);break e;case 14:e=BI(null,e,a,rh(a.type,t),s);break e}throw Error(zn(306,a,""))}return e;case 0:return a=e.type,d=e.pendingProps,d=e.elementType===a?d:rh(a,d),GS(t,e,a,d,s);case 1:return a=e.type,d=e.pendingProps,d=e.elementType===a?d:rh(a,d),jI(t,e,a,d,s);case 3:e:{if(DR(e),t===null)throw Error(zn(387));a=e.pendingProps,g=e.memoizedState,d=g.element,aR(t,e),db(e,a,null,s);var v=e.memoizedState;if(a=v.element,g.isDehydrated)if(g={element:a,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},e.updateQueue.baseState=g,e.memoizedState=g,e.flags&256){d=Q_(Error(zn(423)),e),e=UI(t,e,a,s,d);break e}else if(a!==d){d=Q_(Error(zn(424)),e),e=UI(t,e,a,s,d);break e}else for(Vc=Ap(e.stateNode.containerInfo.firstChild),$c=e,eo=!0,lh=null,s=sR(e,null,a,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(X_(),a===d){e=uf(t,e,s);break e}Bl(t,e,a,s)}e=e.child}return e;case 5:return lR(e),t===null&&jS(e),a=e.type,d=e.pendingProps,g=t!==null?t.memoizedProps:null,v=d.children,NS(a,d)?v=null:g!==null&&NS(a,g)&&(e.flags|=32),RR(t,e),Bl(t,e,v,s),e.child;case 6:return t===null&&jS(e),null;case 13:return NR(t,e,s);case 4:return z3(e,e.stateNode.containerInfo),a=e.pendingProps,t===null?e.child=Y_(e,null,a,s):Bl(t,e,a,s),e.child;case 11:return a=e.type,d=e.pendingProps,d=e.elementType===a?d:rh(a,d),FI(t,e,a,d,s);case 7:return Bl(t,e,e.pendingProps,s),e.child;case 8:return Bl(t,e,e.pendingProps.children,s),e.child;case 12:return Bl(t,e,e.pendingProps.children,s),e.child;case 10:e:{if(a=e.type._context,d=e.pendingProps,g=e.memoizedProps,v=d.value,ks(ub,a._currentValue),a._currentValue=v,g!==null)if(dh(g.value,v)){if(g.children===d.children&&!mc.current){e=uf(t,e,s);break e}}else for(g=e.child,g!==null&&(g.return=e);g!==null;){var i=g.dependencies;if(i!==null){v=g.child;for(var E=i.firstContext;E!==null;){if(E.context===a){if(g.tag===1){E=sf(-1,s&-s),E.tag=2;var k=g.updateQueue;if(k!==null){k=k.shared;var O=k.pending;O===null?E.next=E:(E.next=O.next,O.next=E),k.pending=E}}g.lanes|=s,E=g.alternate,E!==null&&(E.lanes|=s),US(g.return,s,e),i.lanes|=s;break}E=E.next}}else if(g.tag===10)v=g.type===e.type?null:g.child;else if(g.tag===18){if(v=g.return,v===null)throw Error(zn(341));v.lanes|=s,i=v.alternate,i!==null&&(i.lanes|=s),US(v,s,e),v=g.sibling}else v=g.child;if(v!==null)v.return=g;else for(v=g;v!==null;){if(v===e){v=null;break}if(g=v.sibling,g!==null){g.return=v.return,v=g;break}v=v.return}g=v}Bl(t,e,d.children,s),e=e.child}return e;case 9:return d=e.type,a=e.pendingProps.children,S_(e,s),d=Tu(d),a=a(d),e.flags|=1,Bl(t,e,a,s),e.child;case 14:return a=e.type,d=rh(a,e.pendingProps),d=rh(a.type,d),BI(t,e,a,d,s);case 15:return LR(t,e,e.type,e.pendingProps,s);case 17:return a=e.type,d=e.pendingProps,d=e.elementType===a?d:rh(a,d),Dx(t,e),e.tag=1,gc(a)?(t=!0,ab(e)):t=!1,S_(e,s),PR(e,a,d),qS(e,a,d,s),HS(null,e,a,!0,t,s);case 19:return OR(t,e,s);case 22:return kR(t,e,s)}throw Error(zn(156,e.tag))};function JR(t,e){return Ak(t,e)}function bV(t,e,s,a){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bu(t,e,s,a){return new bV(t,e,s,a)}function J3(t){return t=t.prototype,!(!t||!t.isReactComponent)}function wV(t){if(typeof t=="function")return J3(t)?1:0;if(t!=null){if(t=t.$$typeof,t===_3)return 11;if(t===y3)return 14}return 2}function Mp(t,e){var s=t.alternate;return s===null?(s=bu(t.tag,e,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=e,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&14680064,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,e=t.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s}function zx(t,e,s,a,d,g){var v=2;if(a=t,typeof t=="function")J3(t)&&(v=1);else if(typeof t=="string")v=5;else e:switch(t){case o_:return Km(s.children,d,g,e);case g3:v=8,d|=8;break;case fS:return t=bu(12,s,e,d|2),t.elementType=fS,t.lanes=g,t;case pS:return t=bu(13,s,e,d),t.elementType=pS,t.lanes=g,t;case mS:return t=bu(19,s,e,d),t.elementType=mS,t.lanes=g,t;case lk:return Xb(s,d,g,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ok:v=10;break e;case ak:v=9;break e;case _3:v=11;break e;case y3:v=14;break e;case rp:v=16,a=null;break e}throw Error(zn(130,t==null?t:typeof t,""))}return e=bu(v,s,e,d),e.elementType=t,e.type=a,e.lanes=g,e}function Km(t,e,s,a){return t=bu(7,t,a,e),t.lanes=s,t}function Xb(t,e,s,a){return t=bu(22,t,a,e),t.elementType=lk,t.lanes=s,t.stateNode={isHidden:!1},t}function P5(t,e,s){return t=bu(6,t,null,e),t.lanes=s,t}function M5(t,e,s){return e=bu(4,t.children!==null?t.children:[],t.key,e),e.lanes=s,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function SV(t,e,s,a,d){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=c5(0),this.expirationTimes=c5(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=c5(0),this.identifierPrefix=a,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function Q3(t,e,s,a,d,g,v,i,E){return t=new SV(t,e,s,i,E),e===1?(e=1,g===!0&&(e|=8)):e=0,g=bu(3,null,null,e),t.current=g,g.stateNode=t,g.memoizedState={element:a,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},O3(g),t}function TV(t,e,s){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s_,key:a==null?null:""+a,children:t,containerInfo:e,implementation:s}}function QR(t){if(!t)return Lp;t=t._reactInternals;e:{if(cg(t)!==t||t.tag!==1)throw Error(zn(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(gc(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(zn(171))}if(t.tag===1){var s=t.type;if(gc(s))return Qk(t,s,e)}return e}function eD(t,e,s,a,d,g,v,i,E){return t=Q3(s,a,!0,t,d,g,v,i,E),t.context=QR(null),s=t.current,a=jl(),d=Pp(s),g=sf(a,d),g.callback=e??null,Ep(s,g,d),t.current.lanes=d,Av(t,d,a),_c(t,a),t}function Yb(t,e,s,a){var d=e.current,g=jl(),v=Pp(d);return s=QR(s),e.context===null?e.context=s:e.pendingContext=s,e=sf(g,v),e.payload={element:t},a=a===void 0?null:a,a!==null&&(e.callback=a),t=Ep(d,e,v),t!==null&&(hh(t,d,v,g),Lx(t,d,v)),v}function xb(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function YI(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<e?s:e}}function eA(t,e){YI(t,e),(t=t.alternate)&&YI(t,e)}function AV(){return null}var tD=typeof reportError=="function"?reportError:function(t){console.error(t)};function tA(t){this._internalRoot=t}Jb.prototype.render=tA.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(zn(409));Yb(t,e,null,null)};Jb.prototype.unmount=tA.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ng(function(){Yb(null,t,null,null)}),e[lf]=null}};function Jb(t){this._internalRoot=t}Jb.prototype.unstable_scheduleHydration=function(t){if(t){var e=kk();t={blockedOn:null,target:t,priority:e};for(var s=0;s<op.length&&e!==0&&e<op[s].priority;s++);op.splice(s,0,t),s===0&&Dk(t)}};function nA(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Qb(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function JI(){}function EV(t,e,s,a,d){if(d){if(typeof a=="function"){var g=a;a=function(){var k=xb(v);g.call(k)}}var v=eD(e,a,t,0,null,!1,!1,"",JI);return t._reactRootContainer=v,t[lf]=v.current,nv(t.nodeType===8?t.parentNode:t),ng(),v}for(;d=t.lastChild;)t.removeChild(d);if(typeof a=="function"){var i=a;a=function(){var k=xb(E);i.call(k)}}var E=Q3(t,0,!1,null,null,!1,!1,"",JI);return t._reactRootContainer=E,t[lf]=E.current,nv(t.nodeType===8?t.parentNode:t),ng(function(){Yb(e,E,s,a)}),E}function ew(t,e,s,a,d){var g=s._reactRootContainer;if(g){var v=g;if(typeof d=="function"){var i=d;d=function(){var E=xb(v);i.call(E)}}Yb(e,v,t,d)}else v=EV(s,e,t,d,a);return xb(v)}Ik=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var s=Ey(e.pendingLanes);s!==0&&(b3(e,s|1),_c(e,Lo()),!(Xi&6)&&(e0=Lo()+500,Up()))}break;case 13:ng(function(){var a=cf(t,1);if(a!==null){var d=jl();hh(a,t,1,d)}}),eA(t,1)}};w3=function(t){if(t.tag===13){var e=cf(t,134217728);if(e!==null){var s=jl();hh(e,t,134217728,s)}eA(t,134217728)}};Lk=function(t){if(t.tag===13){var e=Pp(t),s=cf(t,e);if(s!==null){var a=jl();hh(s,t,e,a)}eA(t,e)}};kk=function(){return us};Rk=function(t,e){var s=us;try{return us=t,e()}finally{us=s}};AS=function(t,e,s){switch(e){case"input":if(yS(t,s),e=s.name,s.type==="radio"&&e!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<s.length;e++){var a=s[e];if(a!==t&&a.form===t.form){var d=$b(a);if(!d)throw Error(zn(90));uk(a),yS(a,d)}}}break;case"textarea":dk(t,s);break;case"select":e=s.value,e!=null&&v_(t,!!s.multiple,e,!1)}};vk=K3;xk=ng;var CV={usingClientEntryPoint:!1,Events:[Cv,u_,$b,_k,yk,K3]},_y={findFiberByHostInstance:Fm,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},PV={bundleType:_y.bundleType,version:_y.version,rendererPackageName:_y.rendererPackageName,rendererConfig:_y.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mf.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Sk(t),t===null?null:t.stateNode},findFiberByHostInstance:_y.findFiberByHostInstance||AV,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ax=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ax.isDisabled&&ax.supportsFiber)try{jb=ax.inject(PV),nd=ax}catch{}}Zc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CV;Zc.createPortal=function(t,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nA(e))throw Error(zn(200));return TV(t,e,null,s)};Zc.createRoot=function(t,e){if(!nA(t))throw Error(zn(299));var s=!1,a="",d=tD;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(a=e.identifierPrefix),e.onRecoverableError!==void 0&&(d=e.onRecoverableError)),e=Q3(t,1,!1,null,null,s,!1,a,d),t[lf]=e.current,nv(t.nodeType===8?t.parentNode:t),new tA(e)};Zc.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(zn(188)):(t=Object.keys(t).join(","),Error(zn(268,t)));return t=Sk(e),t=t===null?null:t.stateNode,t};Zc.flushSync=function(t){return ng(t)};Zc.hydrate=function(t,e,s){if(!Qb(e))throw Error(zn(200));return ew(null,t,e,!0,s)};Zc.hydrateRoot=function(t,e,s){if(!nA(t))throw Error(zn(405));var a=s!=null&&s.hydratedSources||null,d=!1,g="",v=tD;if(s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onRecoverableError!==void 0&&(v=s.onRecoverableError)),e=eD(e,null,t,1,s??null,d,!1,g,v),t[lf]=e.current,nv(t),a)for(t=0;t<a.length;t++)s=a[t],d=s._getVersion,d=d(s._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[s,d]:e.mutableSourceEagerHydrationData.push(s,d);return new Jb(e)};Zc.render=function(t,e,s){if(!Qb(e))throw Error(zn(200));return ew(null,t,e,!1,s)};Zc.unmountComponentAtNode=function(t){if(!Qb(t))throw Error(zn(40));return t._reactRootContainer?(ng(function(){ew(null,null,t,!1,function(){t._reactRootContainer=null,t[lf]=null})}),!0):!1};Zc.unstable_batchedUpdates=K3;Zc.unstable_renderSubtreeIntoContainer=function(t,e,s,a){if(!Qb(s))throw Error(zn(200));if(t==null||t._reactInternals===void 0)throw Error(zn(38));return ew(t,e,s,!1,a)};Zc.version="18.3.1-next-f1338f8080-20240426";function nD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(nD)}catch(t){console.error(t)}}nD(),nk.exports=Zc;var ug=nk.exports;const MV=l3(ug);var rD,QI=ug;rD=QI.createRoot,QI.hydrateRoot;function IV(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var s,a,d,g,v=[],i="",E=t.split("/");for(E[0]||E.shift();d=E.shift();)s=d[0],s==="*"?(v.push(s),i+=d[1]==="?"?"(?:/(.*))?":"/(.*)"):s===":"?(a=d.indexOf("?",1),g=d.indexOf(".",1),v.push(d.substring(1,~a?a:~g?g:d.length)),i+=~a&&!~g?"(?:/([^/]+?))?":"/([^/]+?)",~g&&(i+=(~a?"?":"")+"\\"+d.substring(g))):i+="/"+d;return{keys:v,pattern:new RegExp("^"+i+(e?"(?=$|/)":"/?$"),"i")}}var iD={exports:{}},sD={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t0=ge;function LV(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var kV=typeof Object.is=="function"?Object.is:LV,RV=t0.useState,DV=t0.useEffect,NV=t0.useLayoutEffect,OV=t0.useDebugValue;function zV(t,e){var s=e(),a=RV({inst:{value:s,getSnapshot:e}}),d=a[0].inst,g=a[1];return NV(function(){d.value=s,d.getSnapshot=e,I5(d)&&g({inst:d})},[t,s,e]),DV(function(){return I5(d)&&g({inst:d}),t(function(){I5(d)&&g({inst:d})})},[t]),OV(s),s}function I5(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!kV(t,s)}catch{return!0}}function FV(t,e){return e()}var BV=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?FV:zV;sD.useSyncExternalStore=t0.useSyncExternalStore!==void 0?t0.useSyncExternalStore:BV;iD.exports=sD;var jV=iD.exports;const UV=ek.useInsertionEffect,VV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",qV=VV?ge.useLayoutEffect:ge.useEffect,$V=UV||qV,oD=t=>{const e=ge.useRef([t,(...s)=>e[0](...s)]).current;return $V(()=>{e[0]=t}),e[1]},GV="popstate",rA="pushState",iA="replaceState",HV="hashchange",e4=[GV,rA,iA,HV],WV=t=>{for(const e of e4)addEventListener(e,t);return()=>{for(const e of e4)removeEventListener(e,t)}},aD=(t,e)=>jV.useSyncExternalStore(WV,t,e),ZV=()=>location.search,KV=({ssrSearch:t=""}={})=>aD(ZV,()=>t),t4=()=>location.pathname,XV=({ssrPath:t}={})=>aD(t4,t?()=>t:t4),YV=(t,{replace:e=!1,state:s=null}={})=>history[e?iA:rA](s,"",t),JV=(t={})=>[XV(t),YV],n4=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[n4]>"u"){for(const t of[rA,iA]){const e=history[t];history[t]=function(){const s=e.apply(this,arguments),a=new Event(t);return a.arguments=arguments,dispatchEvent(a),s}}Object.defineProperty(window,n4,{value:!0})}const QV=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",lD=(t="")=>t==="/"?"":t,e9=(t,e)=>t[0]==="~"?t.slice(1):lD(e)+t,t9=(t="",e)=>QV(r4(lD(t)),r4(e)),r4=t=>{try{return decodeURI(t)}catch{return t}},cD={hook:JV,searchHook:KV,parser:IV,base:"",ssrPath:void 0,ssrSearch:void 0,hrefs:t=>t},uD=ge.createContext(cD),Mv=()=>ge.useContext(uD),hD={},dD=ge.createContext(hD),n9=()=>ge.useContext(dD),tw=t=>{const[e,s]=t.hook(t);return[t9(t.base,e),oD((a,d)=>s(e9(a,t.base),d))]},sA=()=>tw(Mv()),fD=(t,e,s,a)=>{const{pattern:d,keys:g}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",a),v=d.exec(s)||[],[i,...E]=v;return i!==void 0?[!0,(()=>{const k=g!==!1?Object.fromEntries(g.map((z,G)=>[z,E[G]])):v.groups;let O={...E};return k&&Object.assign(O,k),O})(),...a?[i]:[]]:[!1,null]},r9=({children:t,...e})=>{var O,z;const s=Mv(),a=e.hook?cD:s;let d=a;const[g,v]=((O=e.ssrPath)==null?void 0:O.split("?"))??[];v&&(e.ssrSearch=v,e.ssrPath=g),e.hrefs=e.hrefs??((z=e.hook)==null?void 0:z.hrefs);let i=ge.useRef({}),E=i.current,k=E;for(let G in a){const U=G==="base"?a[G]+(e[G]||""):e[G]||a[G];E===k&&U!==k[G]&&(i.current=k={...k}),k[G]=U,U!==a[G]&&(d=k)}return ge.createElement(uD.Provider,{value:d,children:t})},i4=({children:t,component:e},s)=>e?ge.createElement(e,{params:s}):typeof t=="function"?t(s):t,i9=t=>{let e=ge.useRef(hD),s=e.current;for(const a in t)t[a]!==s[a]&&(s=t);return Object.keys(t).length===0&&(s=t),e.current=s},yy=({path:t,nest:e,match:s,...a})=>{const d=Mv(),[g]=tw(d),[v,i,E]=s??fD(d.parser,t,g,e),k=i9({...n9(),...i});if(!v)return null;const O=E?ge.createElement(r9,{base:E},i4(a,k)):i4(a,k);return ge.createElement(dD.Provider,{value:k,children:O})},Wg=ge.forwardRef((t,e)=>{const s=Mv(),[a,d]=tw(s),{to:g="",href:v=g,onClick:i,asChild:E,children:k,className:O,replace:z,state:G,...U}=t,ie=oD(se=>{se.ctrlKey||se.metaKey||se.altKey||se.shiftKey||se.button!==0||(i==null||i(se),se.defaultPrevented||(se.preventDefault(),d(v,t)))}),Q=s.hrefs(v[0]==="~"?v.slice(1):s.base+v,s);return E&&ge.isValidElement(k)?ge.cloneElement(k,{onClick:ie,href:Q}):ge.createElement("a",{...U,onClick:ie,href:Q,className:O!=null&&O.call?O(a===v):O,children:k,ref:e})}),pD=t=>Array.isArray(t)?t.flatMap(e=>pD(e&&e.type===ge.Fragment?e.props.children:e)):[t],s9=({children:t,location:e})=>{const s=Mv(),[a]=tw(s);for(const d of pD(t)){let g=0;if(ge.isValidElement(d)&&(g=fD(s.parser,d.props.path,e||a,d.props.nest))[0])return ge.cloneElement(d,{match:g})}return null};var a0=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},rg=typeof window>"u"||"Deno"in globalThis;function mu(){}function o9(t,e){return typeof t=="function"?t(e):t}function iT(t){return typeof t=="number"&&t>=0&&t!==1/0}function mD(t,e){return Math.max(t+(e||0)-Date.now(),0)}function A_(t,e){return typeof t=="function"?t(e):t}function ch(t,e){return typeof t=="function"?t(e):t}function s4(t,e){const{type:s="all",exact:a,fetchStatus:d,predicate:g,queryKey:v,stale:i}=t;if(v){if(a){if(e.queryHash!==oA(v,e.options))return!1}else if(!hv(e.queryKey,v))return!1}if(s!=="all"){const E=e.isActive();if(s==="active"&&!E||s==="inactive"&&E)return!1}return!(typeof i=="boolean"&&e.isStale()!==i||d&&d!==e.state.fetchStatus||g&&!g(e))}function o4(t,e){const{exact:s,status:a,predicate:d,mutationKey:g}=t;if(g){if(!e.options.mutationKey)return!1;if(s){if(ig(e.options.mutationKey)!==ig(g))return!1}else if(!hv(e.options.mutationKey,g))return!1}return!(a&&e.state.status!==a||d&&!d(e))}function oA(t,e){return((e==null?void 0:e.queryKeyHashFn)||ig)(t)}function ig(t){return JSON.stringify(t,(e,s)=>sT(s)?Object.keys(s).sort().reduce((a,d)=>(a[d]=s[d],a),{}):s)}function hv(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(s=>!hv(t[s],e[s])):!1}function gD(t,e){if(t===e)return t;const s=a4(t)&&a4(e);if(s||sT(t)&&sT(e)){const a=s?t:Object.keys(t),d=a.length,g=s?e:Object.keys(e),v=g.length,i=s?[]:{};let E=0;for(let k=0;k<v;k++){const O=s?k:g[k];(!s&&a.includes(O)||s)&&t[O]===void 0&&e[O]===void 0?(i[O]=void 0,E++):(i[O]=gD(t[O],e[O]),i[O]===t[O]&&t[O]!==void 0&&E++)}return d===v&&E===d?t:i}return e}function bb(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}function a4(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function sT(t){if(!l4(t))return!1;const e=t.constructor;if(e===void 0)return!0;const s=e.prototype;return!(!l4(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function l4(t){return Object.prototype.toString.call(t)==="[object Object]"}function a9(t){return new Promise(e=>{setTimeout(e,t)})}function oT(t,e,s){return typeof s.structuralSharing=="function"?s.structuralSharing(t,e):s.structuralSharing!==!1?gD(t,e):e}function l9(t,e,s=0){const a=[...t,e];return s&&a.length>s?a.slice(1):a}function c9(t,e,s=0){const a=[e,...t];return s&&a.length>s?a.slice(0,-1):a}var aA=Symbol();function _D(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===aA?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var Um,up,N_,DL,u9=(DL=class extends a0{constructor(){super();Br(this,Um);Br(this,up);Br(this,N_);hr(this,N_,e=>{if(!rg&&window.addEventListener){const s=()=>e();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}})}onSubscribe(){zt(this,up)||this.setEventListener(zt(this,N_))}onUnsubscribe(){var e;this.hasListeners()||((e=zt(this,up))==null||e.call(this),hr(this,up,void 0))}setEventListener(e){var s;hr(this,N_,e),(s=zt(this,up))==null||s.call(this),hr(this,up,e(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(e){zt(this,Um)!==e&&(hr(this,Um,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(s=>{s(e)})}isFocused(){var e;return typeof zt(this,Um)=="boolean"?zt(this,Um):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Um=new WeakMap,up=new WeakMap,N_=new WeakMap,DL),lA=new u9,O_,hp,z_,NL,h9=(NL=class extends a0{constructor(){super();Br(this,O_,!0);Br(this,hp);Br(this,z_);hr(this,z_,e=>{if(!rg&&window.addEventListener){const s=()=>e(!0),a=()=>e(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",a)}}})}onSubscribe(){zt(this,hp)||this.setEventListener(zt(this,z_))}onUnsubscribe(){var e;this.hasListeners()||((e=zt(this,hp))==null||e.call(this),hr(this,hp,void 0))}setEventListener(e){var s;hr(this,z_,e),(s=zt(this,hp))==null||s.call(this),hr(this,hp,e(this.setOnline.bind(this)))}setOnline(e){zt(this,O_)!==e&&(hr(this,O_,e),this.listeners.forEach(a=>{a(e)}))}isOnline(){return zt(this,O_)}},O_=new WeakMap,hp=new WeakMap,z_=new WeakMap,NL),wb=new h9;function aT(){let t,e;const s=new Promise((d,g)=>{t=d,e=g});s.status="pending",s.catch(()=>{});function a(d){Object.assign(s,d),delete s.resolve,delete s.reject}return s.resolve=d=>{a({status:"fulfilled",value:d}),t(d)},s.reject=d=>{a({status:"rejected",reason:d}),e(d)},s}function d9(t){return Math.min(1e3*2**t,3e4)}function yD(t){return(t??"online")==="online"?wb.isOnline():!0}var vD=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function L5(t){return t instanceof vD}function xD(t){let e=!1,s=0,a=!1,d;const g=aT(),v=Q=>{var se;a||(G(new vD(Q)),(se=t.abort)==null||se.call(t))},i=()=>{e=!0},E=()=>{e=!1},k=()=>lA.isFocused()&&(t.networkMode==="always"||wb.isOnline())&&t.canRun(),O=()=>yD(t.networkMode)&&t.canRun(),z=Q=>{var se;a||(a=!0,(se=t.onSuccess)==null||se.call(t,Q),d==null||d(),g.resolve(Q))},G=Q=>{var se;a||(a=!0,(se=t.onError)==null||se.call(t,Q),d==null||d(),g.reject(Q))},U=()=>new Promise(Q=>{var se;d=J=>{(a||k())&&Q(J)},(se=t.onPause)==null||se.call(t)}).then(()=>{var Q;d=void 0,a||(Q=t.onContinue)==null||Q.call(t)}),ie=()=>{if(a)return;let Q;const se=s===0?t.initialPromise:void 0;try{Q=se??t.fn()}catch(J){Q=Promise.reject(J)}Promise.resolve(Q).then(z).catch(J=>{var rt;if(a)return;const te=t.retry??(rg?0:3),le=t.retryDelay??d9,ye=typeof le=="function"?le(s,J):le,Ne=te===!0||typeof te=="number"&&s<te||typeof te=="function"&&te(s,J);if(e||!Ne){G(J);return}s++,(rt=t.onFail)==null||rt.call(t,s,J),a9(ye).then(()=>k()?void 0:U()).then(()=>{e?G(J):ie()})})};return{promise:g,cancel:v,continue:()=>(d==null||d(),g),cancelRetry:i,continueRetry:E,canStart:O,start:()=>(O()?ie():U().then(ie),g)}}function f9(){let t=[],e=0,s=i=>{i()},a=i=>{i()},d=i=>setTimeout(i,0);const g=i=>{e?t.push(i):d(()=>{s(i)})},v=()=>{const i=t;t=[],i.length&&d(()=>{a(()=>{i.forEach(E=>{s(E)})})})};return{batch:i=>{let E;e++;try{E=i()}finally{e--,e||v()}return E},batchCalls:i=>(...E)=>{g(()=>{i(...E)})},schedule:g,setNotifyFunction:i=>{s=i},setBatchNotifyFunction:i=>{a=i},setScheduler:i=>{d=i}}}var la=f9(),Vm,OL,bD=(OL=class{constructor(){Br(this,Vm)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),iT(this.gcTime)&&hr(this,Vm,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(rg?1/0:5*60*1e3))}clearGcTimeout(){zt(this,Vm)&&(clearTimeout(zt(this,Vm)),hr(this,Vm,void 0))}},Vm=new WeakMap,OL),F_,B_,pu,ll,xv,qm,sh,Wd,zL,p9=(zL=class extends bD{constructor(e){super();Br(this,sh);Br(this,F_);Br(this,B_);Br(this,pu);Br(this,ll);Br(this,xv);Br(this,qm);hr(this,qm,!1),hr(this,xv,e.defaultOptions),this.setOptions(e.options),this.observers=[],hr(this,pu,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,hr(this,F_,m9(this.options)),this.state=e.state??zt(this,F_),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=zt(this,ll))==null?void 0:e.promise}setOptions(e){this.options={...zt(this,xv),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&zt(this,pu).remove(this)}setData(e,s){const a=oT(this.state.data,e,this.options);return wi(this,sh,Wd).call(this,{data:a,type:"success",dataUpdatedAt:s==null?void 0:s.updatedAt,manual:s==null?void 0:s.manual}),a}setState(e,s){wi(this,sh,Wd).call(this,{type:"setState",state:e,setStateOptions:s})}cancel(e){var a,d;const s=(a=zt(this,ll))==null?void 0:a.promise;return(d=zt(this,ll))==null||d.cancel(e),s?s.then(mu).catch(mu):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(zt(this,F_))}isActive(){return this.observers.some(e=>ch(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===aA||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!mD(this.state.dataUpdatedAt,e)}onFocus(){var s;const e=this.observers.find(a=>a.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(s=zt(this,ll))==null||s.continue()}onOnline(){var s;const e=this.observers.find(a=>a.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(s=zt(this,ll))==null||s.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),zt(this,pu).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(s=>s!==e),this.observers.length||(zt(this,ll)&&(zt(this,qm)?zt(this,ll).cancel({revert:!0}):zt(this,ll).cancelRetry()),this.scheduleGc()),zt(this,pu).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||wi(this,sh,Wd).call(this,{type:"invalidate"})}fetch(e,s){var E,k,O;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(s!=null&&s.cancelRefetch))this.cancel({silent:!0});else if(zt(this,ll))return zt(this,ll).continueRetry(),zt(this,ll).promise}if(e&&this.setOptions(e),!this.options.queryFn){const z=this.observers.find(G=>G.options.queryFn);z&&this.setOptions(z.options)}const a=new AbortController,d=z=>{Object.defineProperty(z,"signal",{enumerable:!0,get:()=>(hr(this,qm,!0),a.signal)})},g=()=>{const z=_D(this.options,s),G={queryKey:this.queryKey,meta:this.meta};return d(G),hr(this,qm,!1),this.options.persister?this.options.persister(z,G,this):z(G)},v={fetchOptions:s,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:g};d(v),(E=this.options.behavior)==null||E.onFetch(v,this),hr(this,B_,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((k=v.fetchOptions)==null?void 0:k.meta))&&wi(this,sh,Wd).call(this,{type:"fetch",meta:(O=v.fetchOptions)==null?void 0:O.meta});const i=z=>{var G,U,ie,Q;L5(z)&&z.silent||wi(this,sh,Wd).call(this,{type:"error",error:z}),L5(z)||((U=(G=zt(this,pu).config).onError)==null||U.call(G,z,this),(Q=(ie=zt(this,pu).config).onSettled)==null||Q.call(ie,this.state.data,z,this)),this.scheduleGc()};return hr(this,ll,xD({initialPromise:s==null?void 0:s.initialPromise,fn:v.fetchFn,abort:a.abort.bind(a),onSuccess:z=>{var G,U,ie,Q;if(z===void 0){i(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(z)}catch(se){i(se);return}(U=(G=zt(this,pu).config).onSuccess)==null||U.call(G,z,this),(Q=(ie=zt(this,pu).config).onSettled)==null||Q.call(ie,z,this.state.error,this),this.scheduleGc()},onError:i,onFail:(z,G)=>{wi(this,sh,Wd).call(this,{type:"failed",failureCount:z,error:G})},onPause:()=>{wi(this,sh,Wd).call(this,{type:"pause"})},onContinue:()=>{wi(this,sh,Wd).call(this,{type:"continue"})},retry:v.options.retry,retryDelay:v.options.retryDelay,networkMode:v.options.networkMode,canRun:()=>!0})),zt(this,ll).start()}},F_=new WeakMap,B_=new WeakMap,pu=new WeakMap,ll=new WeakMap,xv=new WeakMap,qm=new WeakMap,sh=new WeakSet,Wd=function(e){const s=a=>{switch(e.type){case"failed":return{...a,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...wD(a.data,this.options),fetchMeta:e.meta??null};case"success":return{...a,data:e.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const d=e.error;return L5(d)&&d.revert&&zt(this,B_)?{...zt(this,B_),fetchStatus:"idle"}:{...a,error:d,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:d,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...e.state}}};this.state=s(this.state),la.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),zt(this,pu).notify({query:this,type:"updated",action:e})})},zL);function wD(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:yD(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function m9(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,s=e!==void 0,a=s?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:s?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var Zh,FL,g9=(FL=class extends a0{constructor(e={}){super();Br(this,Zh);this.config=e,hr(this,Zh,new Map)}build(e,s,a){const d=s.queryKey,g=s.queryHash??oA(d,s);let v=this.get(g);return v||(v=new p9({cache:this,queryKey:d,queryHash:g,options:e.defaultQueryOptions(s),state:a,defaultOptions:e.getQueryDefaults(d)}),this.add(v)),v}add(e){zt(this,Zh).has(e.queryHash)||(zt(this,Zh).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const s=zt(this,Zh).get(e.queryHash);s&&(e.destroy(),s===e&&zt(this,Zh).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){la.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return zt(this,Zh).get(e)}getAll(){return[...zt(this,Zh).values()]}find(e){const s={exact:!0,...e};return this.getAll().find(a=>s4(s,a))}findAll(e={}){const s=this.getAll();return Object.keys(e).length>0?s.filter(a=>s4(e,a)):s}notify(e){la.batch(()=>{this.listeners.forEach(s=>{s(e)})})}onFocus(){la.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){la.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Zh=new WeakMap,FL),Kh,zl,$m,Xh,Jf,BL,_9=(BL=class extends bD{constructor(e){super();Br(this,Xh);Br(this,Kh);Br(this,zl);Br(this,$m);this.mutationId=e.mutationId,hr(this,zl,e.mutationCache),hr(this,Kh,[]),this.state=e.state||SD(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){zt(this,Kh).includes(e)||(zt(this,Kh).push(e),this.clearGcTimeout(),zt(this,zl).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){hr(this,Kh,zt(this,Kh).filter(s=>s!==e)),this.scheduleGc(),zt(this,zl).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){zt(this,Kh).length||(this.state.status==="pending"?this.scheduleGc():zt(this,zl).remove(this))}continue(){var e;return((e=zt(this,$m))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var d,g,v,i,E,k,O,z,G,U,ie,Q,se,J,te,le,ye,Ne,rt,xe;hr(this,$m,xD({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(Me,it)=>{wi(this,Xh,Jf).call(this,{type:"failed",failureCount:Me,error:it})},onPause:()=>{wi(this,Xh,Jf).call(this,{type:"pause"})},onContinue:()=>{wi(this,Xh,Jf).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>zt(this,zl).canRun(this)}));const s=this.state.status==="pending",a=!zt(this,$m).canStart();try{if(!s){wi(this,Xh,Jf).call(this,{type:"pending",variables:e,isPaused:a}),await((g=(d=zt(this,zl).config).onMutate)==null?void 0:g.call(d,e,this));const it=await((i=(v=this.options).onMutate)==null?void 0:i.call(v,e));it!==this.state.context&&wi(this,Xh,Jf).call(this,{type:"pending",context:it,variables:e,isPaused:a})}const Me=await zt(this,$m).start();return await((k=(E=zt(this,zl).config).onSuccess)==null?void 0:k.call(E,Me,e,this.state.context,this)),await((z=(O=this.options).onSuccess)==null?void 0:z.call(O,Me,e,this.state.context)),await((U=(G=zt(this,zl).config).onSettled)==null?void 0:U.call(G,Me,null,this.state.variables,this.state.context,this)),await((Q=(ie=this.options).onSettled)==null?void 0:Q.call(ie,Me,null,e,this.state.context)),wi(this,Xh,Jf).call(this,{type:"success",data:Me}),Me}catch(Me){try{throw await((J=(se=zt(this,zl).config).onError)==null?void 0:J.call(se,Me,e,this.state.context,this)),await((le=(te=this.options).onError)==null?void 0:le.call(te,Me,e,this.state.context)),await((Ne=(ye=zt(this,zl).config).onSettled)==null?void 0:Ne.call(ye,void 0,Me,this.state.variables,this.state.context,this)),await((xe=(rt=this.options).onSettled)==null?void 0:xe.call(rt,void 0,Me,e,this.state.context)),Me}finally{wi(this,Xh,Jf).call(this,{type:"error",error:Me})}}finally{zt(this,zl).runNext(this)}}},Kh=new WeakMap,zl=new WeakMap,$m=new WeakMap,Xh=new WeakSet,Jf=function(e){const s=a=>{switch(e.type){case"failed":return{...a,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...a,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:e.error,failureCount:a.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=s(this.state),la.batch(()=>{zt(this,Kh).forEach(a=>{a.onMutationUpdate(e)}),zt(this,zl).notify({mutation:this,type:"updated",action:e})})},BL);function SD(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Fc,bv,jL,y9=(jL=class extends a0{constructor(e={}){super();Br(this,Fc);Br(this,bv);this.config=e,hr(this,Fc,new Map),hr(this,bv,Date.now())}build(e,s,a){const d=new _9({mutationCache:this,mutationId:++$1(this,bv)._,options:e.defaultMutationOptions(s),state:a});return this.add(d),d}add(e){const s=lx(e),a=zt(this,Fc).get(s)??[];a.push(e),zt(this,Fc).set(s,a),this.notify({type:"added",mutation:e})}remove(e){var a;const s=lx(e);if(zt(this,Fc).has(s)){const d=(a=zt(this,Fc).get(s))==null?void 0:a.filter(g=>g!==e);d&&(d.length===0?zt(this,Fc).delete(s):zt(this,Fc).set(s,d))}this.notify({type:"removed",mutation:e})}canRun(e){var a;const s=(a=zt(this,Fc).get(lx(e)))==null?void 0:a.find(d=>d.state.status==="pending");return!s||s===e}runNext(e){var a;const s=(a=zt(this,Fc).get(lx(e)))==null?void 0:a.find(d=>d!==e&&d.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}clear(){la.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...zt(this,Fc).values()].flat()}find(e){const s={exact:!0,...e};return this.getAll().find(a=>o4(s,a))}findAll(e={}){return this.getAll().filter(s=>o4(e,s))}notify(e){la.batch(()=>{this.listeners.forEach(s=>{s(e)})})}resumePausedMutations(){const e=this.getAll().filter(s=>s.state.isPaused);return la.batch(()=>Promise.all(e.map(s=>s.continue().catch(mu))))}},Fc=new WeakMap,bv=new WeakMap,jL);function lx(t){var e;return((e=t.options.scope)==null?void 0:e.id)??String(t.mutationId)}function c4(t){return{onFetch:(e,s)=>{var O,z,G,U,ie;const a=e.options,d=(G=(z=(O=e.fetchOptions)==null?void 0:O.meta)==null?void 0:z.fetchMore)==null?void 0:G.direction,g=((U=e.state.data)==null?void 0:U.pages)||[],v=((ie=e.state.data)==null?void 0:ie.pageParams)||[];let i={pages:[],pageParams:[]},E=0;const k=async()=>{let Q=!1;const se=le=>{Object.defineProperty(le,"signal",{enumerable:!0,get:()=>(e.signal.aborted?Q=!0:e.signal.addEventListener("abort",()=>{Q=!0}),e.signal)})},J=_D(e.options,e.fetchOptions),te=async(le,ye,Ne)=>{if(Q)return Promise.reject();if(ye==null&&le.pages.length)return Promise.resolve(le);const rt={queryKey:e.queryKey,pageParam:ye,direction:Ne?"backward":"forward",meta:e.options.meta};se(rt);const xe=await J(rt),{maxPages:Me}=e.options,it=Ne?c9:l9;return{pages:it(le.pages,xe,Me),pageParams:it(le.pageParams,ye,Me)}};if(d&&g.length){const le=d==="backward",ye=le?v9:u4,Ne={pages:g,pageParams:v},rt=ye(a,Ne);i=await te(Ne,rt,le)}else{const le=t??g.length;do{const ye=E===0?v[0]??a.initialPageParam:u4(a,i);if(E>0&&ye==null)break;i=await te(i,ye),E++}while(E<le)}return i};e.options.persister?e.fetchFn=()=>{var Q,se;return(se=(Q=e.options).persister)==null?void 0:se.call(Q,k,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},s)}:e.fetchFn=k}}}function u4(t,{pages:e,pageParams:s}){const a=e.length-1;return e.length>0?t.getNextPageParam(e[a],e,s[a],s):void 0}function v9(t,{pages:e,pageParams:s}){var a;return e.length>0?(a=t.getPreviousPageParam)==null?void 0:a.call(t,e[0],e,s[0],s):void 0}var _o,dp,fp,j_,U_,pp,V_,q_,UL,x9=(UL=class{constructor(t={}){Br(this,_o);Br(this,dp);Br(this,fp);Br(this,j_);Br(this,U_);Br(this,pp);Br(this,V_);Br(this,q_);hr(this,_o,t.queryCache||new g9),hr(this,dp,t.mutationCache||new y9),hr(this,fp,t.defaultOptions||{}),hr(this,j_,new Map),hr(this,U_,new Map),hr(this,pp,0)}mount(){$1(this,pp)._++,zt(this,pp)===1&&(hr(this,V_,lA.subscribe(async t=>{t&&(await this.resumePausedMutations(),zt(this,_o).onFocus())})),hr(this,q_,wb.subscribe(async t=>{t&&(await this.resumePausedMutations(),zt(this,_o).onOnline())})))}unmount(){var t,e;$1(this,pp)._--,zt(this,pp)===0&&((t=zt(this,V_))==null||t.call(this),hr(this,V_,void 0),(e=zt(this,q_))==null||e.call(this),hr(this,q_,void 0))}isFetching(t){return zt(this,_o).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return zt(this,dp).findAll({...t,status:"pending"}).length}getQueryData(t){var s;const e=this.defaultQueryOptions({queryKey:t});return(s=zt(this,_o).get(e.queryHash))==null?void 0:s.state.data}ensureQueryData(t){const e=this.getQueryData(t.queryKey);if(e===void 0)return this.fetchQuery(t);{const s=this.defaultQueryOptions(t),a=zt(this,_o).build(this,s);return t.revalidateIfStale&&a.isStaleByTime(A_(s.staleTime,a))&&this.prefetchQuery(s),Promise.resolve(e)}}getQueriesData(t){return zt(this,_o).findAll(t).map(({queryKey:e,state:s})=>{const a=s.data;return[e,a]})}setQueryData(t,e,s){const a=this.defaultQueryOptions({queryKey:t}),d=zt(this,_o).get(a.queryHash),g=d==null?void 0:d.state.data,v=o9(e,g);if(v!==void 0)return zt(this,_o).build(this,a).setData(v,{...s,manual:!0})}setQueriesData(t,e,s){return la.batch(()=>zt(this,_o).findAll(t).map(({queryKey:a})=>[a,this.setQueryData(a,e,s)]))}getQueryState(t){var s;const e=this.defaultQueryOptions({queryKey:t});return(s=zt(this,_o).get(e.queryHash))==null?void 0:s.state}removeQueries(t){const e=zt(this,_o);la.batch(()=>{e.findAll(t).forEach(s=>{e.remove(s)})})}resetQueries(t,e){const s=zt(this,_o),a={type:"active",...t};return la.batch(()=>(s.findAll(t).forEach(d=>{d.reset()}),this.refetchQueries(a,e)))}cancelQueries(t={},e={}){const s={revert:!0,...e},a=la.batch(()=>zt(this,_o).findAll(t).map(d=>d.cancel(s)));return Promise.all(a).then(mu).catch(mu)}invalidateQueries(t={},e={}){return la.batch(()=>{if(zt(this,_o).findAll(t).forEach(a=>{a.invalidate()}),t.refetchType==="none")return Promise.resolve();const s={...t,type:t.refetchType??t.type??"active"};return this.refetchQueries(s,e)})}refetchQueries(t={},e){const s={...e,cancelRefetch:(e==null?void 0:e.cancelRefetch)??!0},a=la.batch(()=>zt(this,_o).findAll(t).filter(d=>!d.isDisabled()).map(d=>{let g=d.fetch(void 0,s);return s.throwOnError||(g=g.catch(mu)),d.state.fetchStatus==="paused"?Promise.resolve():g}));return Promise.all(a).then(mu)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const s=zt(this,_o).build(this,e);return s.isStaleByTime(A_(e.staleTime,s))?s.fetch(e):Promise.resolve(s.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(mu).catch(mu)}fetchInfiniteQuery(t){return t.behavior=c4(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(mu).catch(mu)}ensureInfiniteQueryData(t){return t.behavior=c4(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return wb.isOnline()?zt(this,dp).resumePausedMutations():Promise.resolve()}getQueryCache(){return zt(this,_o)}getMutationCache(){return zt(this,dp)}getDefaultOptions(){return zt(this,fp)}setDefaultOptions(t){hr(this,fp,t)}setQueryDefaults(t,e){zt(this,j_).set(ig(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...zt(this,j_).values()];let s={};return e.forEach(a=>{hv(t,a.queryKey)&&(s={...s,...a.defaultOptions})}),s}setMutationDefaults(t,e){zt(this,U_).set(ig(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...zt(this,U_).values()];let s={};return e.forEach(a=>{hv(t,a.mutationKey)&&(s={...s,...a.defaultOptions})}),s}defaultQueryOptions(t){if(t._defaulted)return t;const e={...zt(this,fp).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=oA(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.enabled!==!0&&e.queryFn===aA&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...zt(this,fp).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){zt(this,_o).clear(),zt(this,dp).clear()}},_o=new WeakMap,dp=new WeakMap,fp=new WeakMap,j_=new WeakMap,U_=new WeakMap,pp=new WeakMap,V_=new WeakMap,q_=new WeakMap,UL),cc,Bi,wv,Fl,Gm,$_,mp,Yh,Sv,G_,H_,Hm,Wm,gp,W_,os,Py,lT,cT,uT,hT,dT,fT,pT,TD,VL,b9=(VL=class extends a0{constructor(e,s){super();Br(this,os);Br(this,cc);Br(this,Bi);Br(this,wv);Br(this,Fl);Br(this,Gm);Br(this,$_);Br(this,mp);Br(this,Yh);Br(this,Sv);Br(this,G_);Br(this,H_);Br(this,Hm);Br(this,Wm);Br(this,gp);Br(this,W_,new Set);this.options=s,hr(this,cc,e),hr(this,Yh,null),hr(this,mp,aT()),this.options.experimental_prefetchInRender||zt(this,mp).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(zt(this,Bi).addObserver(this),h4(zt(this,Bi),this.options)?wi(this,os,Py).call(this):this.updateResult(),wi(this,os,hT).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return mT(zt(this,Bi),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return mT(zt(this,Bi),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,wi(this,os,dT).call(this),wi(this,os,fT).call(this),zt(this,Bi).removeObserver(this)}setOptions(e,s){const a=this.options,d=zt(this,Bi);if(this.options=zt(this,cc).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ch(this.options.enabled,zt(this,Bi))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");wi(this,os,pT).call(this),zt(this,Bi).setOptions(this.options),a._defaulted&&!bb(this.options,a)&&zt(this,cc).getQueryCache().notify({type:"observerOptionsUpdated",query:zt(this,Bi),observer:this});const g=this.hasListeners();g&&d4(zt(this,Bi),d,this.options,a)&&wi(this,os,Py).call(this),this.updateResult(s),g&&(zt(this,Bi)!==d||ch(this.options.enabled,zt(this,Bi))!==ch(a.enabled,zt(this,Bi))||A_(this.options.staleTime,zt(this,Bi))!==A_(a.staleTime,zt(this,Bi)))&&wi(this,os,lT).call(this);const v=wi(this,os,cT).call(this);g&&(zt(this,Bi)!==d||ch(this.options.enabled,zt(this,Bi))!==ch(a.enabled,zt(this,Bi))||v!==zt(this,gp))&&wi(this,os,uT).call(this,v)}getOptimisticResult(e){const s=zt(this,cc).getQueryCache().build(zt(this,cc),e),a=this.createResult(s,e);return S9(this,a)&&(hr(this,Fl,a),hr(this,$_,this.options),hr(this,Gm,zt(this,Bi).state)),a}getCurrentResult(){return zt(this,Fl)}trackResult(e,s){const a={};return Object.keys(e).forEach(d=>{Object.defineProperty(a,d,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(d),s==null||s(d),e[d])})}),a}trackProp(e){zt(this,W_).add(e)}getCurrentQuery(){return zt(this,Bi)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=zt(this,cc).defaultQueryOptions(e),a=zt(this,cc).getQueryCache().build(zt(this,cc),s);return a.fetch().then(()=>this.createResult(a,s))}fetch(e){return wi(this,os,Py).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),zt(this,Fl)))}createResult(e,s){var Me;const a=zt(this,Bi),d=this.options,g=zt(this,Fl),v=zt(this,Gm),i=zt(this,$_),k=e!==a?e.state:zt(this,wv),{state:O}=e;let z={...O},G=!1,U;if(s._optimisticResults){const it=this.hasListeners(),ot=!it&&h4(e,s),ve=it&&d4(e,a,s,d);(ot||ve)&&(z={...z,...wD(O.data,e.options)}),s._optimisticResults==="isRestoring"&&(z.fetchStatus="idle")}let{error:ie,errorUpdatedAt:Q,status:se}=z;if(s.select&&z.data!==void 0)if(g&&z.data===(v==null?void 0:v.data)&&s.select===zt(this,Sv))U=zt(this,G_);else try{hr(this,Sv,s.select),U=s.select(z.data),U=oT(g==null?void 0:g.data,U,s),hr(this,G_,U),hr(this,Yh,null)}catch(it){hr(this,Yh,it)}else U=z.data;if(s.placeholderData!==void 0&&U===void 0&&se==="pending"){let it;if(g!=null&&g.isPlaceholderData&&s.placeholderData===(i==null?void 0:i.placeholderData))it=g.data;else if(it=typeof s.placeholderData=="function"?s.placeholderData((Me=zt(this,H_))==null?void 0:Me.state.data,zt(this,H_)):s.placeholderData,s.select&&it!==void 0)try{it=s.select(it),hr(this,Yh,null)}catch(ot){hr(this,Yh,ot)}it!==void 0&&(se="success",U=oT(g==null?void 0:g.data,it,s),G=!0)}zt(this,Yh)&&(ie=zt(this,Yh),U=zt(this,G_),Q=Date.now(),se="error");const J=z.fetchStatus==="fetching",te=se==="pending",le=se==="error",ye=te&&J,Ne=U!==void 0,xe={status:se,fetchStatus:z.fetchStatus,isPending:te,isSuccess:se==="success",isError:le,isInitialLoading:ye,isLoading:ye,data:U,dataUpdatedAt:z.dataUpdatedAt,error:ie,errorUpdatedAt:Q,failureCount:z.fetchFailureCount,failureReason:z.fetchFailureReason,errorUpdateCount:z.errorUpdateCount,isFetched:z.dataUpdateCount>0||z.errorUpdateCount>0,isFetchedAfterMount:z.dataUpdateCount>k.dataUpdateCount||z.errorUpdateCount>k.errorUpdateCount,isFetching:J,isRefetching:J&&!te,isLoadingError:le&&!Ne,isPaused:z.fetchStatus==="paused",isPlaceholderData:G,isRefetchError:le&&Ne,isStale:cA(e,s),refetch:this.refetch,promise:zt(this,mp)};if(this.options.experimental_prefetchInRender){const it=Le=>{xe.status==="error"?Le.reject(xe.error):xe.data!==void 0&&Le.resolve(xe.data)},ot=()=>{const Le=hr(this,mp,xe.promise=aT());it(Le)},ve=zt(this,mp);switch(ve.status){case"pending":e.queryHash===a.queryHash&&it(ve);break;case"fulfilled":(xe.status==="error"||xe.data!==ve.value)&&ot();break;case"rejected":(xe.status!=="error"||xe.error!==ve.reason)&&ot();break}}return xe}updateResult(e){const s=zt(this,Fl),a=this.createResult(zt(this,Bi),this.options);if(hr(this,Gm,zt(this,Bi).state),hr(this,$_,this.options),zt(this,Gm).data!==void 0&&hr(this,H_,zt(this,Bi)),bb(a,s))return;hr(this,Fl,a);const d={},g=()=>{if(!s)return!0;const{notifyOnChangeProps:v}=this.options,i=typeof v=="function"?v():v;if(i==="all"||!i&&!zt(this,W_).size)return!0;const E=new Set(i??zt(this,W_));return this.options.throwOnError&&E.add("error"),Object.keys(zt(this,Fl)).some(k=>{const O=k;return zt(this,Fl)[O]!==s[O]&&E.has(O)})};(e==null?void 0:e.listeners)!==!1&&g()&&(d.listeners=!0),wi(this,os,TD).call(this,{...d,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&wi(this,os,hT).call(this)}},cc=new WeakMap,Bi=new WeakMap,wv=new WeakMap,Fl=new WeakMap,Gm=new WeakMap,$_=new WeakMap,mp=new WeakMap,Yh=new WeakMap,Sv=new WeakMap,G_=new WeakMap,H_=new WeakMap,Hm=new WeakMap,Wm=new WeakMap,gp=new WeakMap,W_=new WeakMap,os=new WeakSet,Py=function(e){wi(this,os,pT).call(this);let s=zt(this,Bi).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(mu)),s},lT=function(){wi(this,os,dT).call(this);const e=A_(this.options.staleTime,zt(this,Bi));if(rg||zt(this,Fl).isStale||!iT(e))return;const a=mD(zt(this,Fl).dataUpdatedAt,e)+1;hr(this,Hm,setTimeout(()=>{zt(this,Fl).isStale||this.updateResult()},a))},cT=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(zt(this,Bi)):this.options.refetchInterval)??!1},uT=function(e){wi(this,os,fT).call(this),hr(this,gp,e),!(rg||ch(this.options.enabled,zt(this,Bi))===!1||!iT(zt(this,gp))||zt(this,gp)===0)&&hr(this,Wm,setInterval(()=>{(this.options.refetchIntervalInBackground||lA.isFocused())&&wi(this,os,Py).call(this)},zt(this,gp)))},hT=function(){wi(this,os,lT).call(this),wi(this,os,uT).call(this,wi(this,os,cT).call(this))},dT=function(){zt(this,Hm)&&(clearTimeout(zt(this,Hm)),hr(this,Hm,void 0))},fT=function(){zt(this,Wm)&&(clearInterval(zt(this,Wm)),hr(this,Wm,void 0))},pT=function(){const e=zt(this,cc).getQueryCache().build(zt(this,cc),this.options);if(e===zt(this,Bi))return;const s=zt(this,Bi);hr(this,Bi,e),hr(this,wv,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},TD=function(e){la.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(zt(this,Fl))}),zt(this,cc).getQueryCache().notify({query:zt(this,Bi),type:"observerResultsUpdated"})})},VL);function w9(t,e){return ch(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function h4(t,e){return w9(t,e)||t.state.data!==void 0&&mT(t,e,e.refetchOnMount)}function mT(t,e,s){if(ch(e.enabled,t)!==!1){const a=typeof s=="function"?s(t):s;return a==="always"||a!==!1&&cA(t,e)}return!1}function d4(t,e,s,a){return(t!==e||ch(a.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&cA(t,s)}function cA(t,e){return ch(e.enabled,t)!==!1&&t.isStaleByTime(A_(e.staleTime,t))}function S9(t,e){return!bb(t.getCurrentResult(),e)}var _p,yp,uc,Yd,of,Fx,gT,qL,T9=(qL=class extends a0{constructor(s,a){super();Br(this,of);Br(this,_p);Br(this,yp);Br(this,uc);Br(this,Yd);hr(this,_p,s),this.setOptions(a),this.bindMethods(),wi(this,of,Fx).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var d;const a=this.options;this.options=zt(this,_p).defaultMutationOptions(s),bb(this.options,a)||zt(this,_p).getMutationCache().notify({type:"observerOptionsUpdated",mutation:zt(this,uc),observer:this}),a!=null&&a.mutationKey&&this.options.mutationKey&&ig(a.mutationKey)!==ig(this.options.mutationKey)?this.reset():((d=zt(this,uc))==null?void 0:d.state.status)==="pending"&&zt(this,uc).setOptions(this.options)}onUnsubscribe(){var s;this.hasListeners()||(s=zt(this,uc))==null||s.removeObserver(this)}onMutationUpdate(s){wi(this,of,Fx).call(this),wi(this,of,gT).call(this,s)}getCurrentResult(){return zt(this,yp)}reset(){var s;(s=zt(this,uc))==null||s.removeObserver(this),hr(this,uc,void 0),wi(this,of,Fx).call(this),wi(this,of,gT).call(this)}mutate(s,a){var d;return hr(this,Yd,a),(d=zt(this,uc))==null||d.removeObserver(this),hr(this,uc,zt(this,_p).getMutationCache().build(zt(this,_p),this.options)),zt(this,uc).addObserver(this),zt(this,uc).execute(s)}},_p=new WeakMap,yp=new WeakMap,uc=new WeakMap,Yd=new WeakMap,of=new WeakSet,Fx=function(){var a;const s=((a=zt(this,uc))==null?void 0:a.state)??SD();hr(this,yp,{...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset})},gT=function(s){la.batch(()=>{var a,d,g,v,i,E,k,O;if(zt(this,Yd)&&this.hasListeners()){const z=zt(this,yp).variables,G=zt(this,yp).context;(s==null?void 0:s.type)==="success"?((d=(a=zt(this,Yd)).onSuccess)==null||d.call(a,s.data,z,G),(v=(g=zt(this,Yd)).onSettled)==null||v.call(g,s.data,null,z,G)):(s==null?void 0:s.type)==="error"&&((E=(i=zt(this,Yd)).onError)==null||E.call(i,s.error,z,G),(O=(k=zt(this,Yd)).onSettled)==null||O.call(k,void 0,s.error,z,G))}this.listeners.forEach(z=>{z(zt(this,yp))})})},qL),AD=ge.createContext(void 0),ED=t=>{const e=ge.useContext(AD);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},A9=({client:t,children:e})=>(ge.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),V.jsx(AD.Provider,{value:t,children:e})),CD=ge.createContext(!1),E9=()=>ge.useContext(CD);CD.Provider;function C9(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var P9=ge.createContext(C9()),M9=()=>ge.useContext(P9);function PD(t,e){return typeof t=="function"?t(...e):!!t}function _T(){}var I9=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},L9=t=>{ge.useEffect(()=>{t.clearReset()},[t])},k9=({result:t,errorResetBoundary:e,throwOnError:s,query:a})=>t.isError&&!e.isReset()&&!t.isFetching&&a&&PD(s,[t.error,a]),R9=t=>{t.suspense&&(t.staleTime===void 0&&(t.staleTime=1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},D9=(t,e)=>t.isLoading&&t.isFetching&&!e,N9=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,f4=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function O9(t,e,s){var O,z,G,U,ie;const a=ED(),d=E9(),g=M9(),v=a.defaultQueryOptions(t);(z=(O=a.getDefaultOptions().queries)==null?void 0:O._experimental_beforeQuery)==null||z.call(O,v),v._optimisticResults=d?"isRestoring":"optimistic",R9(v),I9(v,g),L9(g);const i=!a.getQueryCache().get(v.queryHash),[E]=ge.useState(()=>new e(a,v)),k=E.getOptimisticResult(v);if(ge.useSyncExternalStore(ge.useCallback(Q=>{const se=d?_T:E.subscribe(la.batchCalls(Q));return E.updateResult(),se},[E,d]),()=>E.getCurrentResult(),()=>E.getCurrentResult()),ge.useEffect(()=>{E.setOptions(v,{listeners:!1})},[v,E]),N9(v,k))throw f4(v,E,g);if(k9({result:k,errorResetBoundary:g,throwOnError:v.throwOnError,query:a.getQueryCache().get(v.queryHash)}))throw k.error;if((U=(G=a.getDefaultOptions().queries)==null?void 0:G._experimental_afterQuery)==null||U.call(G,v,k),v.experimental_prefetchInRender&&!rg&&D9(k,d)){const Q=i?f4(v,E,g):(ie=a.getQueryCache().get(v.queryHash))==null?void 0:ie.promise;Q==null||Q.catch(_T).finally(()=>{E.updateResult()})}return v.notifyOnChangeProps?k:E.trackResult(k)}function dc(t,e){return O9(t,b9)}function MD(t,e){const s=ED(),[a]=ge.useState(()=>new T9(s,t));ge.useEffect(()=>{a.setOptions(t)},[a,t]);const d=ge.useSyncExternalStore(ge.useCallback(v=>a.subscribe(la.batchCalls(v)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),g=ge.useCallback((v,i)=>{a.mutate(v,i).catch(_T)},[a]);if(d.error&&PD(a.options.throwOnError,[d.error]))throw d.error;return{...d,mutate:g,mutateAsync:d.mutate}}async function ID(t){if(!t.ok){const e=await t.text()||t.statusText;throw new Error(`${t.status}: ${e}`)}}async function LD(t,e,s){const a=await fetch(e,{method:t,headers:{},body:void 0,credentials:"include"});return await ID(a),a}const z9=({on401:t})=>async({queryKey:e})=>{const s=await fetch(e[0],{credentials:"include"});return t==="returnNull"&&s.status===401?null:(await ID(s),await s.json())},F9=new x9({defaultOptions:{queries:{queryFn:z9({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:2},mutations:{retry:!1}}}),B9=1,j9=1e6;let k5=0;function U9(){return k5=(k5+1)%Number.MAX_SAFE_INTEGER,k5.toString()}const R5=new Map,p4=t=>{if(R5.has(t))return;const e=setTimeout(()=>{R5.delete(t),Vy({type:"REMOVE_TOAST",toastId:t})},j9);R5.set(t,e)},V9=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,B9)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(s=>s.id===e.toast.id?{...s,...e.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=e;return s?p4(s):t.toasts.forEach(a=>{p4(a.id)}),{...t,toasts:t.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(s=>s.id!==e.toastId)}}},Bx=[];let jx={toasts:[]};function Vy(t){jx=V9(jx,t),Bx.forEach(e=>{e(jx)})}function q9({...t}){const e=U9(),s=d=>Vy({type:"UPDATE_TOAST",toast:{...d,id:e}}),a=()=>Vy({type:"DISMISS_TOAST",toastId:e});return Vy({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:d=>{d||a()}}}),{id:e,dismiss:a,update:s}}function l0(){const[t,e]=ge.useState(jx);return ge.useEffect(()=>(Bx.push(e),()=>{const s=Bx.indexOf(e);s>-1&&Bx.splice(s,1)}),[t]),{...t,toast:q9,dismiss:s=>Vy({type:"DISMISS_TOAST",toastId:s})}}function nr(t,e,{checkForDefaultPrevented:s=!0}={}){return function(d){if(t==null||t(d),s===!1||!d.defaultPrevented)return e==null?void 0:e(d)}}function $9(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function nw(...t){return e=>t.forEach(s=>$9(s,e))}function ji(...t){return ge.useCallback(nw(...t),t)}function G9(t,e=[]){let s=[];function a(g,v){const i=ge.createContext(v),E=s.length;s=[...s,v];function k(z){const{scope:G,children:U,...ie}=z,Q=(G==null?void 0:G[t][E])||i,se=ge.useMemo(()=>ie,Object.values(ie));return V.jsx(Q.Provider,{value:se,children:U})}function O(z,G){const U=(G==null?void 0:G[t][E])||i,ie=ge.useContext(U);if(ie)return ie;if(v!==void 0)return v;throw new Error(`\`${z}\` must be used within \`${g}\``)}return k.displayName=g+"Provider",[k,O]}const d=()=>{const g=s.map(v=>ge.createContext(v));return function(i){const E=(i==null?void 0:i[t])||g;return ge.useMemo(()=>({[`__scope${t}`]:{...i,[t]:E}}),[i,E])}};return d.scopeName=t,[a,H9(d,...e)]}function H9(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const a=t.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(g){const v=a.reduce((i,{useScope:E,scopeName:k})=>{const z=E(g)[`__scope${k}`];return{...i,...z}},{});return ge.useMemo(()=>({[`__scope${e.scopeName}`]:v}),[v])}};return s.scopeName=e.scopeName,s}var kp=ge.forwardRef((t,e)=>{const{children:s,...a}=t,d=ge.Children.toArray(s),g=d.find(Z9);if(g){const v=g.props.children,i=d.map(E=>E===g?ge.Children.count(v)>1?ge.Children.only(null):ge.isValidElement(v)?v.props.children:null:E);return V.jsx(yT,{...a,ref:e,children:ge.isValidElement(v)?ge.cloneElement(v,void 0,i):null})}return V.jsx(yT,{...a,ref:e,children:s})});kp.displayName="Slot";var yT=ge.forwardRef((t,e)=>{const{children:s,...a}=t;if(ge.isValidElement(s)){const d=X9(s);return ge.cloneElement(s,{...K9(a,s.props),ref:e?nw(e,d):d})}return ge.Children.count(s)>1?ge.Children.only(null):null});yT.displayName="SlotClone";var W9=({children:t})=>V.jsx(V.Fragment,{children:t});function Z9(t){return ge.isValidElement(t)&&t.type===W9}function K9(t,e){const s={...e};for(const a in e){const d=t[a],g=e[a];/^on[A-Z]/.test(a)?d&&g?s[a]=(...i)=>{g(...i),d(...i)}:d&&(s[a]=d):a==="style"?s[a]={...d,...g}:a==="className"&&(s[a]=[d,g].filter(Boolean).join(" "))}return{...t,...s}}function X9(t){var a,d;let e=(a=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:a.get,s=e&&"isReactWarning"in e&&e.isReactWarning;return s?t.ref:(e=(d=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:d.get,s=e&&"isReactWarning"in e&&e.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}function Iv(t){const e=t+"CollectionProvider",[s,a]=G9(e),[d,g]=s(e,{collectionRef:{current:null},itemMap:new Map}),v=U=>{const{scope:ie,children:Q}=U,se=Vs.useRef(null),J=Vs.useRef(new Map).current;return V.jsx(d,{scope:ie,itemMap:J,collectionRef:se,children:Q})};v.displayName=e;const i=t+"CollectionSlot",E=Vs.forwardRef((U,ie)=>{const{scope:Q,children:se}=U,J=g(i,Q),te=ji(ie,J.collectionRef);return V.jsx(kp,{ref:te,children:se})});E.displayName=i;const k=t+"CollectionItemSlot",O="data-radix-collection-item",z=Vs.forwardRef((U,ie)=>{const{scope:Q,children:se,...J}=U,te=Vs.useRef(null),le=ji(ie,te),ye=g(k,Q);return Vs.useEffect(()=>(ye.itemMap.set(te,{ref:te,...J}),()=>void ye.itemMap.delete(te))),V.jsx(kp,{[O]:"",ref:le,children:se})});z.displayName=k;function G(U){const ie=g(t+"CollectionConsumer",U);return Vs.useCallback(()=>{const se=ie.collectionRef.current;if(!se)return[];const J=Array.from(se.querySelectorAll(`[${O}]`));return Array.from(ie.itemMap.values()).sort((ye,Ne)=>J.indexOf(ye.ref.current)-J.indexOf(Ne.ref.current))},[ie.collectionRef,ie.itemMap])}return[{Provider:v,Slot:E,ItemSlot:z},G,a]}function Y9(t,e){const s=ge.createContext(e),a=g=>{const{children:v,...i}=g,E=ge.useMemo(()=>i,Object.values(i));return V.jsx(s.Provider,{value:E,children:v})};a.displayName=t+"Provider";function d(g){const v=ge.useContext(s);if(v)return v;if(e!==void 0)return e;throw new Error(`\`${g}\` must be used within \`${t}\``)}return[a,d]}function Vp(t,e=[]){let s=[];function a(g,v){const i=ge.createContext(v),E=s.length;s=[...s,v];const k=z=>{var J;const{scope:G,children:U,...ie}=z,Q=((J=G==null?void 0:G[t])==null?void 0:J[E])||i,se=ge.useMemo(()=>ie,Object.values(ie));return V.jsx(Q.Provider,{value:se,children:U})};k.displayName=g+"Provider";function O(z,G){var Q;const U=((Q=G==null?void 0:G[t])==null?void 0:Q[E])||i,ie=ge.useContext(U);if(ie)return ie;if(v!==void 0)return v;throw new Error(`\`${z}\` must be used within \`${g}\``)}return[k,O]}const d=()=>{const g=s.map(v=>ge.createContext(v));return function(i){const E=(i==null?void 0:i[t])||g;return ge.useMemo(()=>({[`__scope${t}`]:{...i,[t]:E}}),[i,E])}};return d.scopeName=t,[a,J9(d,...e)]}function J9(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const a=t.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(g){const v=a.reduce((i,{useScope:E,scopeName:k})=>{const z=E(g)[`__scope${k}`];return{...i,...z}},{});return ge.useMemo(()=>({[`__scope${e.scopeName}`]:v}),[v])}};return s.scopeName=e.scopeName,s}var Q9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Zr=Q9.reduce((t,e)=>{const s=ge.forwardRef((a,d)=>{const{asChild:g,...v}=a,i=g?kp:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),V.jsx(i,{...v,ref:d})});return s.displayName=`Primitive.${e}`,{...t,[e]:s}},{});function uA(t,e){t&&ug.flushSync(()=>t.dispatchEvent(e))}function fl(t){const e=ge.useRef(t);return ge.useEffect(()=>{e.current=t}),ge.useMemo(()=>(...s)=>{var a;return(a=e.current)==null?void 0:a.call(e,...s)},[])}function eq(t,e=globalThis==null?void 0:globalThis.document){const s=fl(t);ge.useEffect(()=>{const a=d=>{d.key==="Escape"&&s(d)};return e.addEventListener("keydown",a,{capture:!0}),()=>e.removeEventListener("keydown",a,{capture:!0})},[s,e])}var tq="DismissableLayer",vT="dismissableLayer.update",nq="dismissableLayer.pointerDownOutside",rq="dismissableLayer.focusOutside",m4,kD=ge.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Lv=ge.forwardRef((t,e)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:a,onPointerDownOutside:d,onFocusOutside:g,onInteractOutside:v,onDismiss:i,...E}=t,k=ge.useContext(kD),[O,z]=ge.useState(null),G=(O==null?void 0:O.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,U]=ge.useState({}),ie=ji(e,xe=>z(xe)),Q=Array.from(k.layers),[se]=[...k.layersWithOutsidePointerEventsDisabled].slice(-1),J=Q.indexOf(se),te=O?Q.indexOf(O):-1,le=k.layersWithOutsidePointerEventsDisabled.size>0,ye=te>=J,Ne=sq(xe=>{const Me=xe.target,it=[...k.branches].some(ot=>ot.contains(Me));!ye||it||(d==null||d(xe),v==null||v(xe),xe.defaultPrevented||i==null||i())},G),rt=oq(xe=>{const Me=xe.target;[...k.branches].some(ot=>ot.contains(Me))||(g==null||g(xe),v==null||v(xe),xe.defaultPrevented||i==null||i())},G);return eq(xe=>{te===k.layers.size-1&&(a==null||a(xe),!xe.defaultPrevented&&i&&(xe.preventDefault(),i()))},G),ge.useEffect(()=>{if(O)return s&&(k.layersWithOutsidePointerEventsDisabled.size===0&&(m4=G.body.style.pointerEvents,G.body.style.pointerEvents="none"),k.layersWithOutsidePointerEventsDisabled.add(O)),k.layers.add(O),g4(),()=>{s&&k.layersWithOutsidePointerEventsDisabled.size===1&&(G.body.style.pointerEvents=m4)}},[O,G,s,k]),ge.useEffect(()=>()=>{O&&(k.layers.delete(O),k.layersWithOutsidePointerEventsDisabled.delete(O),g4())},[O,k]),ge.useEffect(()=>{const xe=()=>U({});return document.addEventListener(vT,xe),()=>document.removeEventListener(vT,xe)},[]),V.jsx(Zr.div,{...E,ref:ie,style:{pointerEvents:le?ye?"auto":"none":void 0,...t.style},onFocusCapture:nr(t.onFocusCapture,rt.onFocusCapture),onBlurCapture:nr(t.onBlurCapture,rt.onBlurCapture),onPointerDownCapture:nr(t.onPointerDownCapture,Ne.onPointerDownCapture)})});Lv.displayName=tq;var iq="DismissableLayerBranch",RD=ge.forwardRef((t,e)=>{const s=ge.useContext(kD),a=ge.useRef(null),d=ji(e,a);return ge.useEffect(()=>{const g=a.current;if(g)return s.branches.add(g),()=>{s.branches.delete(g)}},[s.branches]),V.jsx(Zr.div,{...t,ref:d})});RD.displayName=iq;function sq(t,e=globalThis==null?void 0:globalThis.document){const s=fl(t),a=ge.useRef(!1),d=ge.useRef(()=>{});return ge.useEffect(()=>{const g=i=>{if(i.target&&!a.current){let E=function(){DD(nq,s,k,{discrete:!0})};const k={originalEvent:i};i.pointerType==="touch"?(e.removeEventListener("click",d.current),d.current=E,e.addEventListener("click",d.current,{once:!0})):E()}else e.removeEventListener("click",d.current);a.current=!1},v=window.setTimeout(()=>{e.addEventListener("pointerdown",g)},0);return()=>{window.clearTimeout(v),e.removeEventListener("pointerdown",g),e.removeEventListener("click",d.current)}},[e,s]),{onPointerDownCapture:()=>a.current=!0}}function oq(t,e=globalThis==null?void 0:globalThis.document){const s=fl(t),a=ge.useRef(!1);return ge.useEffect(()=>{const d=g=>{g.target&&!a.current&&DD(rq,s,{originalEvent:g},{discrete:!1})};return e.addEventListener("focusin",d),()=>e.removeEventListener("focusin",d)},[e,s]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function g4(){const t=new CustomEvent(vT);document.dispatchEvent(t)}function DD(t,e,s,{discrete:a}){const d=s.originalEvent.target,g=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:s});e&&d.addEventListener(t,e,{once:!0}),a?uA(d,g):d.dispatchEvent(g)}var aq=Lv,lq=RD,pl=globalThis!=null&&globalThis.document?ge.useLayoutEffect:()=>{},cq="Portal",kv=ge.forwardRef((t,e)=>{var i;const{container:s,...a}=t,[d,g]=ge.useState(!1);pl(()=>g(!0),[]);const v=s||d&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return v?MV.createPortal(V.jsx(Zr.div,{...a,ref:e}),v):null});kv.displayName=cq;function uq(t,e){return ge.useReducer((s,a)=>e[s][a]??s,t)}var cd=t=>{const{present:e,children:s}=t,a=hq(e),d=typeof s=="function"?s({present:a.isPresent}):ge.Children.only(s),g=ji(a.ref,dq(d));return typeof s=="function"||a.isPresent?ge.cloneElement(d,{ref:g}):null};cd.displayName="Presence";function hq(t){const[e,s]=ge.useState(),a=ge.useRef({}),d=ge.useRef(t),g=ge.useRef("none"),v=t?"mounted":"unmounted",[i,E]=uq(v,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ge.useEffect(()=>{const k=cx(a.current);g.current=i==="mounted"?k:"none"},[i]),pl(()=>{const k=a.current,O=d.current;if(O!==t){const G=g.current,U=cx(k);t?E("MOUNT"):U==="none"||(k==null?void 0:k.display)==="none"?E("UNMOUNT"):E(O&&G!==U?"ANIMATION_OUT":"UNMOUNT"),d.current=t}},[t,E]),pl(()=>{if(e){let k;const O=e.ownerDocument.defaultView??window,z=U=>{const Q=cx(a.current).includes(U.animationName);if(U.target===e&&Q&&(E("ANIMATION_END"),!d.current)){const se=e.style.animationFillMode;e.style.animationFillMode="forwards",k=O.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=se)})}},G=U=>{U.target===e&&(g.current=cx(a.current))};return e.addEventListener("animationstart",G),e.addEventListener("animationcancel",z),e.addEventListener("animationend",z),()=>{O.clearTimeout(k),e.removeEventListener("animationstart",G),e.removeEventListener("animationcancel",z),e.removeEventListener("animationend",z)}}else E("ANIMATION_END")},[e,E]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:ge.useCallback(k=>{k&&(a.current=getComputedStyle(k)),s(k)},[])}}function cx(t){return(t==null?void 0:t.animationName)||"none"}function dq(t){var a,d;let e=(a=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:a.get,s=e&&"isReactWarning"in e&&e.isReactWarning;return s?t.ref:(e=(d=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:d.get,s=e&&"isReactWarning"in e&&e.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}function hf({prop:t,defaultProp:e,onChange:s=()=>{}}){const[a,d]=fq({defaultProp:e,onChange:s}),g=t!==void 0,v=g?t:a,i=fl(s),E=ge.useCallback(k=>{if(g){const z=typeof k=="function"?k(t):k;z!==t&&i(z)}else d(k)},[g,t,d,i]);return[v,E]}function fq({defaultProp:t,onChange:e}){const s=ge.useState(t),[a]=s,d=ge.useRef(a),g=fl(e);return ge.useEffect(()=>{d.current!==a&&(g(a),d.current=a)},[a,d,g]),s}var pq="VisuallyHidden",rw=ge.forwardRef((t,e)=>V.jsx(Zr.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));rw.displayName=pq;var hA="ToastProvider",[dA,mq,gq]=Iv("Toast"),[ND,WQ]=Vp("Toast",[gq]),[_q,iw]=ND(hA),OD=t=>{const{__scopeToast:e,label:s="Notification",duration:a=5e3,swipeDirection:d="right",swipeThreshold:g=50,children:v}=t,[i,E]=ge.useState(null),[k,O]=ge.useState(0),z=ge.useRef(!1),G=ge.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${hA}\`. Expected non-empty \`string\`.`),V.jsx(dA.Provider,{scope:e,children:V.jsx(_q,{scope:e,label:s,duration:a,swipeDirection:d,swipeThreshold:g,toastCount:k,viewport:i,onViewportChange:E,onToastAdd:ge.useCallback(()=>O(U=>U+1),[]),onToastRemove:ge.useCallback(()=>O(U=>U-1),[]),isFocusedToastEscapeKeyDownRef:z,isClosePausedRef:G,children:v})})};OD.displayName=hA;var zD="ToastViewport",yq=["F8"],xT="toast.viewportPause",bT="toast.viewportResume",FD=ge.forwardRef((t,e)=>{const{__scopeToast:s,hotkey:a=yq,label:d="Notifications ({hotkey})",...g}=t,v=iw(zD,s),i=mq(s),E=ge.useRef(null),k=ge.useRef(null),O=ge.useRef(null),z=ge.useRef(null),G=ji(e,z,v.onViewportChange),U=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),ie=v.toastCount>0;ge.useEffect(()=>{const se=J=>{var le;a.length!==0&&a.every(ye=>J[ye]||J.code===ye)&&((le=z.current)==null||le.focus())};return document.addEventListener("keydown",se),()=>document.removeEventListener("keydown",se)},[a]),ge.useEffect(()=>{const se=E.current,J=z.current;if(ie&&se&&J){const te=()=>{if(!v.isClosePausedRef.current){const rt=new CustomEvent(xT);J.dispatchEvent(rt),v.isClosePausedRef.current=!0}},le=()=>{if(v.isClosePausedRef.current){const rt=new CustomEvent(bT);J.dispatchEvent(rt),v.isClosePausedRef.current=!1}},ye=rt=>{!se.contains(rt.relatedTarget)&&le()},Ne=()=>{se.contains(document.activeElement)||le()};return se.addEventListener("focusin",te),se.addEventListener("focusout",ye),se.addEventListener("pointermove",te),se.addEventListener("pointerleave",Ne),window.addEventListener("blur",te),window.addEventListener("focus",le),()=>{se.removeEventListener("focusin",te),se.removeEventListener("focusout",ye),se.removeEventListener("pointermove",te),se.removeEventListener("pointerleave",Ne),window.removeEventListener("blur",te),window.removeEventListener("focus",le)}}},[ie,v.isClosePausedRef]);const Q=ge.useCallback(({tabbingDirection:se})=>{const te=i().map(le=>{const ye=le.ref.current,Ne=[ye,...Lq(ye)];return se==="forwards"?Ne:Ne.reverse()});return(se==="forwards"?te.reverse():te).flat()},[i]);return ge.useEffect(()=>{const se=z.current;if(se){const J=te=>{var Ne,rt,xe;const le=te.altKey||te.ctrlKey||te.metaKey;if(te.key==="Tab"&&!le){const Me=document.activeElement,it=te.shiftKey;if(te.target===se&&it){(Ne=k.current)==null||Ne.focus();return}const Le=Q({tabbingDirection:it?"backwards":"forwards"}),dt=Le.findIndex(Je=>Je===Me);D5(Le.slice(dt+1))?te.preventDefault():it?(rt=k.current)==null||rt.focus():(xe=O.current)==null||xe.focus()}};return se.addEventListener("keydown",J),()=>se.removeEventListener("keydown",J)}},[i,Q]),V.jsxs(lq,{ref:E,role:"region","aria-label":d.replace("{hotkey}",U),tabIndex:-1,style:{pointerEvents:ie?void 0:"none"},children:[ie&&V.jsx(wT,{ref:k,onFocusFromOutsideViewport:()=>{const se=Q({tabbingDirection:"forwards"});D5(se)}}),V.jsx(dA.Slot,{scope:s,children:V.jsx(Zr.ol,{tabIndex:-1,...g,ref:G})}),ie&&V.jsx(wT,{ref:O,onFocusFromOutsideViewport:()=>{const se=Q({tabbingDirection:"backwards"});D5(se)}})]})});FD.displayName=zD;var BD="ToastFocusProxy",wT=ge.forwardRef((t,e)=>{const{__scopeToast:s,onFocusFromOutsideViewport:a,...d}=t,g=iw(BD,s);return V.jsx(rw,{"aria-hidden":!0,tabIndex:0,...d,ref:e,style:{position:"fixed"},onFocus:v=>{var k;const i=v.relatedTarget;!((k=g.viewport)!=null&&k.contains(i))&&a()}})});wT.displayName=BD;var sw="Toast",vq="toast.swipeStart",xq="toast.swipeMove",bq="toast.swipeCancel",wq="toast.swipeEnd",jD=ge.forwardRef((t,e)=>{const{forceMount:s,open:a,defaultOpen:d,onOpenChange:g,...v}=t,[i=!0,E]=hf({prop:a,defaultProp:d,onChange:g});return V.jsx(cd,{present:s||i,children:V.jsx(Aq,{open:i,...v,ref:e,onClose:()=>E(!1),onPause:fl(t.onPause),onResume:fl(t.onResume),onSwipeStart:nr(t.onSwipeStart,k=>{k.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:nr(t.onSwipeMove,k=>{const{x:O,y:z}=k.detail.delta;k.currentTarget.setAttribute("data-swipe","move"),k.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${O}px`),k.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${z}px`)}),onSwipeCancel:nr(t.onSwipeCancel,k=>{k.currentTarget.setAttribute("data-swipe","cancel"),k.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),k.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),k.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),k.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:nr(t.onSwipeEnd,k=>{const{x:O,y:z}=k.detail.delta;k.currentTarget.setAttribute("data-swipe","end"),k.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),k.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),k.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${O}px`),k.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${z}px`),E(!1)})})})});jD.displayName=sw;var[Sq,Tq]=ND(sw,{onClose(){}}),Aq=ge.forwardRef((t,e)=>{const{__scopeToast:s,type:a="foreground",duration:d,open:g,onClose:v,onEscapeKeyDown:i,onPause:E,onResume:k,onSwipeStart:O,onSwipeMove:z,onSwipeCancel:G,onSwipeEnd:U,...ie}=t,Q=iw(sw,s),[se,J]=ge.useState(null),te=ji(e,Je=>J(Je)),le=ge.useRef(null),ye=ge.useRef(null),Ne=d||Q.duration,rt=ge.useRef(0),xe=ge.useRef(Ne),Me=ge.useRef(0),{onToastAdd:it,onToastRemove:ot}=Q,ve=fl(()=>{var yt;(se==null?void 0:se.contains(document.activeElement))&&((yt=Q.viewport)==null||yt.focus()),v()}),Le=ge.useCallback(Je=>{!Je||Je===1/0||(window.clearTimeout(Me.current),rt.current=new Date().getTime(),Me.current=window.setTimeout(ve,Je))},[ve]);ge.useEffect(()=>{const Je=Q.viewport;if(Je){const yt=()=>{Le(xe.current),k==null||k()},St=()=>{const jt=new Date().getTime()-rt.current;xe.current=xe.current-jt,window.clearTimeout(Me.current),E==null||E()};return Je.addEventListener(xT,St),Je.addEventListener(bT,yt),()=>{Je.removeEventListener(xT,St),Je.removeEventListener(bT,yt)}}},[Q.viewport,Ne,E,k,Le]),ge.useEffect(()=>{g&&!Q.isClosePausedRef.current&&Le(Ne)},[g,Ne,Q.isClosePausedRef,Le]),ge.useEffect(()=>(it(),()=>ot()),[it,ot]);const dt=ge.useMemo(()=>se?WD(se):null,[se]);return Q.viewport?V.jsxs(V.Fragment,{children:[dt&&V.jsx(Eq,{__scopeToast:s,role:"status","aria-live":a==="foreground"?"assertive":"polite","aria-atomic":!0,children:dt}),V.jsx(Sq,{scope:s,onClose:ve,children:ug.createPortal(V.jsx(dA.ItemSlot,{scope:s,children:V.jsx(aq,{asChild:!0,onEscapeKeyDown:nr(i,()=>{Q.isFocusedToastEscapeKeyDownRef.current||ve(),Q.isFocusedToastEscapeKeyDownRef.current=!1}),children:V.jsx(Zr.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":g?"open":"closed","data-swipe-direction":Q.swipeDirection,...ie,ref:te,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:nr(t.onKeyDown,Je=>{Je.key==="Escape"&&(i==null||i(Je.nativeEvent),Je.nativeEvent.defaultPrevented||(Q.isFocusedToastEscapeKeyDownRef.current=!0,ve()))}),onPointerDown:nr(t.onPointerDown,Je=>{Je.button===0&&(le.current={x:Je.clientX,y:Je.clientY})}),onPointerMove:nr(t.onPointerMove,Je=>{if(!le.current)return;const yt=Je.clientX-le.current.x,St=Je.clientY-le.current.y,jt=!!ye.current,et=["left","right"].includes(Q.swipeDirection),Qe=["left","up"].includes(Q.swipeDirection)?Math.min:Math.max,Xe=et?Qe(0,yt):0,Vt=et?0:Qe(0,St),be=Je.pointerType==="touch"?10:2,Re={x:Xe,y:Vt},Fe={originalEvent:Je,delta:Re};jt?(ye.current=Re,ux(xq,z,Fe,{discrete:!1})):_4(Re,Q.swipeDirection,be)?(ye.current=Re,ux(vq,O,Fe,{discrete:!1}),Je.target.setPointerCapture(Je.pointerId)):(Math.abs(yt)>be||Math.abs(St)>be)&&(le.current=null)}),onPointerUp:nr(t.onPointerUp,Je=>{const yt=ye.current,St=Je.target;if(St.hasPointerCapture(Je.pointerId)&&St.releasePointerCapture(Je.pointerId),ye.current=null,le.current=null,yt){const jt=Je.currentTarget,et={originalEvent:Je,delta:yt};_4(yt,Q.swipeDirection,Q.swipeThreshold)?ux(wq,U,et,{discrete:!0}):ux(bq,G,et,{discrete:!0}),jt.addEventListener("click",Qe=>Qe.preventDefault(),{once:!0})}})})})}),Q.viewport)})]}):null}),Eq=t=>{const{__scopeToast:e,children:s,...a}=t,d=iw(sw,e),[g,v]=ge.useState(!1),[i,E]=ge.useState(!1);return Mq(()=>v(!0)),ge.useEffect(()=>{const k=window.setTimeout(()=>E(!0),1e3);return()=>window.clearTimeout(k)},[]),i?null:V.jsx(kv,{asChild:!0,children:V.jsx(rw,{...a,children:g&&V.jsxs(V.Fragment,{children:[d.label," ",s]})})})},Cq="ToastTitle",UD=ge.forwardRef((t,e)=>{const{__scopeToast:s,...a}=t;return V.jsx(Zr.div,{...a,ref:e})});UD.displayName=Cq;var Pq="ToastDescription",VD=ge.forwardRef((t,e)=>{const{__scopeToast:s,...a}=t;return V.jsx(Zr.div,{...a,ref:e})});VD.displayName=Pq;var qD="ToastAction",$D=ge.forwardRef((t,e)=>{const{altText:s,...a}=t;return s.trim()?V.jsx(HD,{altText:s,asChild:!0,children:V.jsx(fA,{...a,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${qD}\`. Expected non-empty \`string\`.`),null)});$D.displayName=qD;var GD="ToastClose",fA=ge.forwardRef((t,e)=>{const{__scopeToast:s,...a}=t,d=Tq(GD,s);return V.jsx(HD,{asChild:!0,children:V.jsx(Zr.button,{type:"button",...a,ref:e,onClick:nr(t.onClick,d.onClose)})})});fA.displayName=GD;var HD=ge.forwardRef((t,e)=>{const{__scopeToast:s,altText:a,...d}=t;return V.jsx(Zr.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,...d,ref:e})});function WD(t){const e=[];return Array.from(t.childNodes).forEach(a=>{if(a.nodeType===a.TEXT_NODE&&a.textContent&&e.push(a.textContent),Iq(a)){const d=a.ariaHidden||a.hidden||a.style.display==="none",g=a.dataset.radixToastAnnounceExclude==="";if(!d)if(g){const v=a.dataset.radixToastAnnounceAlt;v&&e.push(v)}else e.push(...WD(a))}}),e}function ux(t,e,s,{discrete:a}){const d=s.originalEvent.currentTarget,g=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:s});e&&d.addEventListener(t,e,{once:!0}),a?uA(d,g):d.dispatchEvent(g)}var _4=(t,e,s=0)=>{const a=Math.abs(t.x),d=Math.abs(t.y),g=a>d;return e==="left"||e==="right"?g&&a>s:!g&&d>s};function Mq(t=()=>{}){const e=fl(t);pl(()=>{let s=0,a=0;return s=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(a)}},[e])}function Iq(t){return t.nodeType===t.ELEMENT_NODE}function Lq(t){const e=[],s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const d=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||d?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)e.push(s.currentNode);return e}function D5(t){const e=document.activeElement;return t.some(s=>s===e?!0:(s.focus(),document.activeElement!==e))}var kq=OD,ZD=FD,KD=jD,XD=UD,YD=VD,JD=$D,QD=fA;function eN(t){var e,s,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(s=eN(t[e]))&&(a&&(a+=" "),a+=s);else for(e in t)t[e]&&(a&&(a+=" "),a+=e);return a}function Rq(){for(var t,e,s=0,a="";s<arguments.length;)(t=arguments[s++])&&(e=eN(t))&&(a&&(a+=" "),a+=e);return a}const y4=t=>typeof t=="boolean"?"".concat(t):t===0?"0":t,v4=Rq,pA=(t,e)=>s=>{var a;if((e==null?void 0:e.variants)==null)return v4(t,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:d,defaultVariants:g}=e,v=Object.keys(d).map(k=>{const O=s==null?void 0:s[k],z=g==null?void 0:g[k];if(O===null)return null;const G=y4(O)||y4(z);return d[k][G]}),i=s&&Object.entries(s).reduce((k,O)=>{let[z,G]=O;return G===void 0||(k[z]=G),k},{}),E=e==null||(a=e.compoundVariants)===null||a===void 0?void 0:a.reduce((k,O)=>{let{class:z,className:G,...U}=O;return Object.entries(U).every(ie=>{let[Q,se]=ie;return Array.isArray(se)?se.includes({...g,...i}[Q]):{...g,...i}[Q]===se})?[...k,z,G]:k},[]);return v4(t,v,E,s==null?void 0:s.class,s==null?void 0:s.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dq=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),tN=(...t)=>t.filter((e,s,a)=>!!e&&a.indexOf(e)===s).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Nq={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oq=ge.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:d="",children:g,iconNode:v,...i},E)=>ge.createElement("svg",{ref:E,...Nq,width:e,height:e,stroke:t,strokeWidth:a?Number(s)*24/Number(e):s,className:tN("lucide",d),...i},[...v.map(([k,O])=>ge.createElement(k,O)),...Array.isArray(g)?g:[g]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ho=(t,e)=>{const s=ge.forwardRef(({className:a,...d},g)=>ge.createElement(Oq,{ref:g,iconNode:e,className:tN(`lucide-${Dq(t)}`,a),...d}));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ux=ho("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x4=ho("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zq=ho("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fq=ho("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bq=ho("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mA=ho("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nN=ho("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jq=ho("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uq=ho("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vq=ho("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qq=ho("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b4=ho("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $q=ho("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rN=ho("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gq=ho("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hq=ho("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wq=ho("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zq=ho("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kq=ho("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xq=ho("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w4=ho("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yq=ho("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gA=ho("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function iN(t){var e,s,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var d=t.length;for(e=0;e<d;e++)t[e]&&(s=iN(t[e]))&&(a&&(a+=" "),a+=s)}else for(s in t)t[s]&&(a&&(a+=" "),a+=s);return a}function Jq(){for(var t,e,s=0,a="",d=arguments.length;s<d;s++)(t=arguments[s])&&(e=iN(t))&&(a&&(a+=" "),a+=e);return a}const _A="-",Qq=t=>{const e=t$(t),{conflictingClassGroups:s,conflictingClassGroupModifiers:a}=t;return{getClassGroupId:v=>{const i=v.split(_A);return i[0]===""&&i.length!==1&&i.shift(),sN(i,e)||e$(v)},getConflictingClassGroupIds:(v,i)=>{const E=s[v]||[];return i&&a[v]?[...E,...a[v]]:E}}},sN=(t,e)=>{var v;if(t.length===0)return e.classGroupId;const s=t[0],a=e.nextPart.get(s),d=a?sN(t.slice(1),a):void 0;if(d)return d;if(e.validators.length===0)return;const g=t.join(_A);return(v=e.validators.find(({validator:i})=>i(g)))==null?void 0:v.classGroupId},S4=/^\[(.+)\]$/,e$=t=>{if(S4.test(t)){const e=S4.exec(t)[1],s=e==null?void 0:e.substring(0,e.indexOf(":"));if(s)return"arbitrary.."+s}},t$=t=>{const{theme:e,prefix:s}=t,a={nextPart:new Map,validators:[]};return r$(Object.entries(t.classGroups),s).forEach(([g,v])=>{ST(v,a,g,e)}),a},ST=(t,e,s,a)=>{t.forEach(d=>{if(typeof d=="string"){const g=d===""?e:T4(e,d);g.classGroupId=s;return}if(typeof d=="function"){if(n$(d)){ST(d(a),e,s,a);return}e.validators.push({validator:d,classGroupId:s});return}Object.entries(d).forEach(([g,v])=>{ST(v,T4(e,g),s,a)})})},T4=(t,e)=>{let s=t;return e.split(_A).forEach(a=>{s.nextPart.has(a)||s.nextPart.set(a,{nextPart:new Map,validators:[]}),s=s.nextPart.get(a)}),s},n$=t=>t.isThemeGetter,r$=(t,e)=>e?t.map(([s,a])=>{const d=a.map(g=>typeof g=="string"?e+g:typeof g=="object"?Object.fromEntries(Object.entries(g).map(([v,i])=>[e+v,i])):g);return[s,d]}):t,i$=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,s=new Map,a=new Map;const d=(g,v)=>{s.set(g,v),e++,e>t&&(e=0,a=s,s=new Map)};return{get(g){let v=s.get(g);if(v!==void 0)return v;if((v=a.get(g))!==void 0)return d(g,v),v},set(g,v){s.has(g)?s.set(g,v):d(g,v)}}},oN="!",s$=t=>{const{separator:e,experimentalParseClassName:s}=t,a=e.length===1,d=e[0],g=e.length,v=i=>{const E=[];let k=0,O=0,z;for(let se=0;se<i.length;se++){let J=i[se];if(k===0){if(J===d&&(a||i.slice(se,se+g)===e)){E.push(i.slice(O,se)),O=se+g;continue}if(J==="/"){z=se;continue}}J==="["?k++:J==="]"&&k--}const G=E.length===0?i:i.substring(O),U=G.startsWith(oN),ie=U?G.substring(1):G,Q=z&&z>O?z-O:void 0;return{modifiers:E,hasImportantModifier:U,baseClassName:ie,maybePostfixModifierPosition:Q}};return s?i=>s({className:i,parseClassName:v}):v},o$=t=>{if(t.length<=1)return t;const e=[];let s=[];return t.forEach(a=>{a[0]==="["?(e.push(...s.sort(),a),s=[]):s.push(a)}),e.push(...s.sort()),e},a$=t=>({cache:i$(t.cacheSize),parseClassName:s$(t),...Qq(t)}),l$=/\s+/,c$=(t,e)=>{const{parseClassName:s,getClassGroupId:a,getConflictingClassGroupIds:d}=e,g=[],v=t.trim().split(l$);let i="";for(let E=v.length-1;E>=0;E-=1){const k=v[E],{modifiers:O,hasImportantModifier:z,baseClassName:G,maybePostfixModifierPosition:U}=s(k);let ie=!!U,Q=a(ie?G.substring(0,U):G);if(!Q){if(!ie){i=k+(i.length>0?" "+i:i);continue}if(Q=a(G),!Q){i=k+(i.length>0?" "+i:i);continue}ie=!1}const se=o$(O).join(":"),J=z?se+oN:se,te=J+Q;if(g.includes(te))continue;g.push(te);const le=d(Q,ie);for(let ye=0;ye<le.length;++ye){const Ne=le[ye];g.push(J+Ne)}i=k+(i.length>0?" "+i:i)}return i};function u$(){let t=0,e,s,a="";for(;t<arguments.length;)(e=arguments[t++])&&(s=aN(e))&&(a&&(a+=" "),a+=s);return a}const aN=t=>{if(typeof t=="string")return t;let e,s="";for(let a=0;a<t.length;a++)t[a]&&(e=aN(t[a]))&&(s&&(s+=" "),s+=e);return s};function h$(t,...e){let s,a,d,g=v;function v(E){const k=e.reduce((O,z)=>z(O),t());return s=a$(k),a=s.cache.get,d=s.cache.set,g=i,i(E)}function i(E){const k=a(E);if(k)return k;const O=c$(E,s);return d(E,O),O}return function(){return g(u$.apply(null,arguments))}}const js=t=>{const e=s=>s[t]||[];return e.isThemeGetter=!0,e},lN=/^\[(?:([a-z-]+):)?(.+)\]$/i,d$=/^\d+\/\d+$/,f$=new Set(["px","full","screen"]),p$=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,m$=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,g$=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,_$=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,y$=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Gd=t=>E_(t)||f$.has(t)||d$.test(t),Zf=t=>c0(t,"length",E$),E_=t=>!!t&&!Number.isNaN(Number(t)),N5=t=>c0(t,"number",E_),vy=t=>!!t&&Number.isInteger(Number(t)),v$=t=>t.endsWith("%")&&E_(t.slice(0,-1)),_i=t=>lN.test(t),Kf=t=>p$.test(t),x$=new Set(["length","size","percentage"]),b$=t=>c0(t,x$,cN),w$=t=>c0(t,"position",cN),S$=new Set(["image","url"]),T$=t=>c0(t,S$,P$),A$=t=>c0(t,"",C$),xy=()=>!0,c0=(t,e,s)=>{const a=lN.exec(t);return a?a[1]?typeof e=="string"?a[1]===e:e.has(a[1]):s(a[2]):!1},E$=t=>m$.test(t)&&!g$.test(t),cN=()=>!1,C$=t=>_$.test(t),P$=t=>y$.test(t),M$=()=>{const t=js("colors"),e=js("spacing"),s=js("blur"),a=js("brightness"),d=js("borderColor"),g=js("borderRadius"),v=js("borderSpacing"),i=js("borderWidth"),E=js("contrast"),k=js("grayscale"),O=js("hueRotate"),z=js("invert"),G=js("gap"),U=js("gradientColorStops"),ie=js("gradientColorStopPositions"),Q=js("inset"),se=js("margin"),J=js("opacity"),te=js("padding"),le=js("saturate"),ye=js("scale"),Ne=js("sepia"),rt=js("skew"),xe=js("space"),Me=js("translate"),it=()=>["auto","contain","none"],ot=()=>["auto","hidden","clip","visible","scroll"],ve=()=>["auto",_i,e],Le=()=>[_i,e],dt=()=>["",Gd,Zf],Je=()=>["auto",E_,_i],yt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],St=()=>["solid","dashed","dotted","double","none"],jt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],et=()=>["start","end","center","between","around","evenly","stretch"],Qe=()=>["","0",_i],Xe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Vt=()=>[E_,_i];return{cacheSize:500,separator:":",theme:{colors:[xy],spacing:[Gd,Zf],blur:["none","",Kf,_i],brightness:Vt(),borderColor:[t],borderRadius:["none","","full",Kf,_i],borderSpacing:Le(),borderWidth:dt(),contrast:Vt(),grayscale:Qe(),hueRotate:Vt(),invert:Qe(),gap:Le(),gradientColorStops:[t],gradientColorStopPositions:[v$,Zf],inset:ve(),margin:ve(),opacity:Vt(),padding:Le(),saturate:Vt(),scale:Vt(),sepia:Qe(),skew:Vt(),space:Le(),translate:Le()},classGroups:{aspect:[{aspect:["auto","square","video",_i]}],container:["container"],columns:[{columns:[Kf]}],"break-after":[{"break-after":Xe()}],"break-before":[{"break-before":Xe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...yt(),_i]}],overflow:[{overflow:ot()}],"overflow-x":[{"overflow-x":ot()}],"overflow-y":[{"overflow-y":ot()}],overscroll:[{overscroll:it()}],"overscroll-x":[{"overscroll-x":it()}],"overscroll-y":[{"overscroll-y":it()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[Q]}],"inset-x":[{"inset-x":[Q]}],"inset-y":[{"inset-y":[Q]}],start:[{start:[Q]}],end:[{end:[Q]}],top:[{top:[Q]}],right:[{right:[Q]}],bottom:[{bottom:[Q]}],left:[{left:[Q]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",vy,_i]}],basis:[{basis:ve()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",_i]}],grow:[{grow:Qe()}],shrink:[{shrink:Qe()}],order:[{order:["first","last","none",vy,_i]}],"grid-cols":[{"grid-cols":[xy]}],"col-start-end":[{col:["auto",{span:["full",vy,_i]},_i]}],"col-start":[{"col-start":Je()}],"col-end":[{"col-end":Je()}],"grid-rows":[{"grid-rows":[xy]}],"row-start-end":[{row:["auto",{span:[vy,_i]},_i]}],"row-start":[{"row-start":Je()}],"row-end":[{"row-end":Je()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",_i]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",_i]}],gap:[{gap:[G]}],"gap-x":[{"gap-x":[G]}],"gap-y":[{"gap-y":[G]}],"justify-content":[{justify:["normal",...et()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...et(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...et(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[te]}],px:[{px:[te]}],py:[{py:[te]}],ps:[{ps:[te]}],pe:[{pe:[te]}],pt:[{pt:[te]}],pr:[{pr:[te]}],pb:[{pb:[te]}],pl:[{pl:[te]}],m:[{m:[se]}],mx:[{mx:[se]}],my:[{my:[se]}],ms:[{ms:[se]}],me:[{me:[se]}],mt:[{mt:[se]}],mr:[{mr:[se]}],mb:[{mb:[se]}],ml:[{ml:[se]}],"space-x":[{"space-x":[xe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[xe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",_i,e]}],"min-w":[{"min-w":[_i,e,"min","max","fit"]}],"max-w":[{"max-w":[_i,e,"none","full","min","max","fit","prose",{screen:[Kf]},Kf]}],h:[{h:[_i,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[_i,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[_i,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[_i,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Kf,Zf]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",N5]}],"font-family":[{font:[xy]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",_i]}],"line-clamp":[{"line-clamp":["none",E_,N5]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Gd,_i]}],"list-image":[{"list-image":["none",_i]}],"list-style-type":[{list:["none","disc","decimal",_i]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[J]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[J]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...St(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Gd,Zf]}],"underline-offset":[{"underline-offset":["auto",Gd,_i]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Le()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",_i]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",_i]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[J]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...yt(),w$]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",b$]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},T$]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[ie]}],"gradient-via-pos":[{via:[ie]}],"gradient-to-pos":[{to:[ie]}],"gradient-from":[{from:[U]}],"gradient-via":[{via:[U]}],"gradient-to":[{to:[U]}],rounded:[{rounded:[g]}],"rounded-s":[{"rounded-s":[g]}],"rounded-e":[{"rounded-e":[g]}],"rounded-t":[{"rounded-t":[g]}],"rounded-r":[{"rounded-r":[g]}],"rounded-b":[{"rounded-b":[g]}],"rounded-l":[{"rounded-l":[g]}],"rounded-ss":[{"rounded-ss":[g]}],"rounded-se":[{"rounded-se":[g]}],"rounded-ee":[{"rounded-ee":[g]}],"rounded-es":[{"rounded-es":[g]}],"rounded-tl":[{"rounded-tl":[g]}],"rounded-tr":[{"rounded-tr":[g]}],"rounded-br":[{"rounded-br":[g]}],"rounded-bl":[{"rounded-bl":[g]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[J]}],"border-style":[{border:[...St(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[J]}],"divide-style":[{divide:St()}],"border-color":[{border:[d]}],"border-color-x":[{"border-x":[d]}],"border-color-y":[{"border-y":[d]}],"border-color-s":[{"border-s":[d]}],"border-color-e":[{"border-e":[d]}],"border-color-t":[{"border-t":[d]}],"border-color-r":[{"border-r":[d]}],"border-color-b":[{"border-b":[d]}],"border-color-l":[{"border-l":[d]}],"divide-color":[{divide:[d]}],"outline-style":[{outline:["",...St()]}],"outline-offset":[{"outline-offset":[Gd,_i]}],"outline-w":[{outline:[Gd,Zf]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:dt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[J]}],"ring-offset-w":[{"ring-offset":[Gd,Zf]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Kf,A$]}],"shadow-color":[{shadow:[xy]}],opacity:[{opacity:[J]}],"mix-blend":[{"mix-blend":[...jt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":jt()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[a]}],contrast:[{contrast:[E]}],"drop-shadow":[{"drop-shadow":["","none",Kf,_i]}],grayscale:[{grayscale:[k]}],"hue-rotate":[{"hue-rotate":[O]}],invert:[{invert:[z]}],saturate:[{saturate:[le]}],sepia:[{sepia:[Ne]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[E]}],"backdrop-grayscale":[{"backdrop-grayscale":[k]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[O]}],"backdrop-invert":[{"backdrop-invert":[z]}],"backdrop-opacity":[{"backdrop-opacity":[J]}],"backdrop-saturate":[{"backdrop-saturate":[le]}],"backdrop-sepia":[{"backdrop-sepia":[Ne]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[v]}],"border-spacing-x":[{"border-spacing-x":[v]}],"border-spacing-y":[{"border-spacing-y":[v]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",_i]}],duration:[{duration:Vt()}],ease:[{ease:["linear","in","out","in-out",_i]}],delay:[{delay:Vt()}],animate:[{animate:["none","spin","ping","pulse","bounce",_i]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ye]}],"scale-x":[{"scale-x":[ye]}],"scale-y":[{"scale-y":[ye]}],rotate:[{rotate:[vy,_i]}],"translate-x":[{"translate-x":[Me]}],"translate-y":[{"translate-y":[Me]}],"skew-x":[{"skew-x":[rt]}],"skew-y":[{"skew-y":[rt]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",_i]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",_i]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Le()}],"scroll-mx":[{"scroll-mx":Le()}],"scroll-my":[{"scroll-my":Le()}],"scroll-ms":[{"scroll-ms":Le()}],"scroll-me":[{"scroll-me":Le()}],"scroll-mt":[{"scroll-mt":Le()}],"scroll-mr":[{"scroll-mr":Le()}],"scroll-mb":[{"scroll-mb":Le()}],"scroll-ml":[{"scroll-ml":Le()}],"scroll-p":[{"scroll-p":Le()}],"scroll-px":[{"scroll-px":Le()}],"scroll-py":[{"scroll-py":Le()}],"scroll-ps":[{"scroll-ps":Le()}],"scroll-pe":[{"scroll-pe":Le()}],"scroll-pt":[{"scroll-pt":Le()}],"scroll-pr":[{"scroll-pr":Le()}],"scroll-pb":[{"scroll-pb":Le()}],"scroll-pl":[{"scroll-pl":Le()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",_i]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Gd,Zf,N5]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},I$=h$(M$);function jr(...t){return I$(Jq(t))}const L$=kq,uN=ge.forwardRef(({className:t,...e},s)=>V.jsx(ZD,{ref:s,className:jr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));uN.displayName=ZD.displayName;const k$=pA("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),hN=ge.forwardRef(({className:t,variant:e,...s},a)=>V.jsx(KD,{ref:a,className:jr(k$({variant:e}),t),...s}));hN.displayName=KD.displayName;const R$=ge.forwardRef(({className:t,...e},s)=>V.jsx(JD,{ref:s,className:jr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...e}));R$.displayName=JD.displayName;const dN=ge.forwardRef(({className:t,...e},s)=>V.jsx(QD,{ref:s,className:jr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:V.jsx(gA,{className:"h-4 w-4"})}));dN.displayName=QD.displayName;const fN=ge.forwardRef(({className:t,...e},s)=>V.jsx(XD,{ref:s,className:jr("text-sm font-semibold",t),...e}));fN.displayName=XD.displayName;const pN=ge.forwardRef(({className:t,...e},s)=>V.jsx(YD,{ref:s,className:jr("text-sm opacity-90",t),...e}));pN.displayName=YD.displayName;function D$(){const{toasts:t}=l0();return V.jsxs(L$,{children:[t.map(function({id:e,title:s,description:a,action:d,...g}){return V.jsxs(hN,{...g,children:[V.jsxs("div",{className:"grid gap-1",children:[s&&V.jsx(fN,{children:s}),a&&V.jsx(pN,{children:a})]}),d,V.jsx(dN,{})]},e)}),V.jsx(uN,{})]})}const Uc=ge.forwardRef(({className:t,...e},s)=>V.jsx("div",{ref:s,className:jr("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));Uc.displayName="Card";const yu=ge.forwardRef(({className:t,...e},s)=>V.jsx("div",{ref:s,className:jr("flex flex-col space-y-1.5 p-6",t),...e}));yu.displayName="CardHeader";const vu=ge.forwardRef(({className:t,...e},s)=>V.jsx("h3",{ref:s,className:jr("text-2xl font-semibold leading-none tracking-tight",t),...e}));vu.displayName="CardTitle";const xu=ge.forwardRef(({className:t,...e},s)=>V.jsx("p",{ref:s,className:jr("text-sm text-muted-foreground",t),...e}));xu.displayName="CardDescription";const Qh=ge.forwardRef(({className:t,...e},s)=>V.jsx("div",{ref:s,className:jr("p-6 pt-0",t),...e}));Qh.displayName="CardContent";const Jd=ge.forwardRef(({className:t,...e},s)=>V.jsx("div",{ref:s,className:jr("flex items-center p-6 pt-0",t),...e}));Jd.displayName="CardFooter";function N$(){return V.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:V.jsx(Uc,{className:"w-full max-w-md mx-4",children:V.jsxs(Qh,{className:"pt-6",children:[V.jsxs("div",{className:"flex mb-4 gap-2",children:[V.jsx(Vq,{className:"h-8 w-8 text-red-500"}),V.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),V.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const O$="modulepreload",z$=function(t){return"/"+t},A4={},ad=function(e,s,a){let d=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),i=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));d=Promise.allSettled(s.map(E=>{if(E=z$(E),E in A4)return;A4[E]=!0;const k=E.endsWith(".css"),O=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${E}"]${O}`))return;const z=document.createElement("link");if(z.rel=k?"stylesheet":O$,k||(z.as="script"),z.crossOrigin="",z.href=E,i&&z.setAttribute("nonce",i),document.head.appendChild(z),k)return new Promise((G,U)=>{z.addEventListener("load",G),z.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${E}`)))})}))}function g(v){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=v,window.dispatchEvent(i),!i.defaultPrevented)throw v}return d.then(v=>{for(const i of v||[])i.status==="rejected"&&g(i.reason);return e().catch(g)})};function F$(){const[t]=sA(),e=s=>t===s;return V.jsxs("div",{children:[V.jsxs("div",{className:"p-4 border-b border-slate-700",children:[V.jsx("div",{className:"flex justify-center mb-4",children:V.jsx("img",{src:"https://doc.vhseguros.com.br/files/public_html/LogoVH%2FVAN-HELDEN-cor.png",alt:"Van Helden Seguros",className:"h-10 w-auto"})}),V.jsx("h1",{className:"text-xl font-semibold",children:"Análise de Distância"}),V.jsx("p",{className:"text-sm text-slate-400",children:"Cliente-Prestador"})]}),V.jsx("nav",{className:"p-4",children:V.jsxs("ul",{className:"space-y-2",children:[V.jsx("li",{children:V.jsx(Wg,{href:"/",children:V.jsxs("div",{className:`flex items-center p-2 rounded-md cursor-pointer ${e("/")?"bg-slate-700 text-white":"text-slate-300 hover:bg-slate-700"}`,children:[V.jsx(Gq,{className:"h-5 w-5 mr-3"}),"Dashboard"]})})}),V.jsx("li",{children:V.jsx(Wg,{href:"/relatorios",children:V.jsxs("div",{className:`flex items-center p-2 rounded-md cursor-pointer ${e("/relatorios")?"bg-slate-700 text-white":"text-slate-300 hover:bg-slate-700"}`,children:[V.jsx(rN,{className:"h-5 w-5 mr-3"}),"Relatórios"]})})}),V.jsx("li",{children:V.jsx(Wg,{href:"/configuracoes",children:V.jsxs("div",{className:`flex items-center p-2 rounded-md cursor-pointer ${e("/configuracoes")?"bg-slate-700 text-white":"text-slate-300 hover:bg-slate-700"}`,children:[V.jsx(Xq,{className:"h-5 w-5 mr-3"}),"Configurações"]})})}),V.jsxs("li",{className:"pt-6",children:[V.jsx("p",{className:"text-xs text-slate-500 uppercase px-2 mb-2",children:"Cidades Principais"}),V.jsx(Wg,{href:"/?city=São Paulo",children:V.jsxs("div",{className:"flex items-center p-2 rounded-md text-slate-300 hover:bg-slate-700 cursor-pointer",children:[V.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 mr-3"}),"São Paulo"]})})]}),V.jsx("li",{children:V.jsx(Wg,{href:"/?city=Rio de Janeiro",children:V.jsxs("div",{className:"flex items-center p-2 rounded-md text-slate-300 hover:bg-slate-700 cursor-pointer",children:[V.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500 mr-3"}),"Rio de Janeiro"]})})}),V.jsx("li",{children:V.jsx(Wg,{href:"/?city=Brasília",children:V.jsxs("div",{className:"flex items-center p-2 rounded-md text-slate-300 hover:bg-slate-700 cursor-pointer",children:[V.jsx("span",{className:"w-2 h-2 rounded-full bg-purple-500 mr-3"}),"Brasília"]})})})]})})]})}function yA({children:t}){const[e,s]=ge.useState(!0);return V.jsxs("div",{className:"flex h-screen overflow-hidden",children:[V.jsx("div",{className:`bg-slate-800 text-white w-64 flex-shrink-0 ${e?"block":"hidden"} md:block transition-all duration-300 ease-in-out`,children:V.jsx(F$,{})}),V.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[V.jsxs("header",{className:"bg-white border-b border-slate-200 flex items-center justify-between p-4",children:[V.jsxs("div",{className:"flex items-center",children:[V.jsx("button",{onClick:()=>s(!e),className:"md:hidden mr-4 text-slate-500",children:V.jsx(Kq,{className:"h-6 w-6"})}),V.jsxs("div",{className:"relative w-64",children:[V.jsx("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400",viewBox:"0 0 20 20",fill:"currentColor",children:V.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),V.jsx("input",{type:"text",className:"pl-10 pr-4 py-2 rounded-md border border-slate-300 w-full focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Buscar cliente ou prestador..."})]})]}),V.jsxs("div",{className:"flex items-center space-x-4",children:[V.jsx("button",{className:"text-slate-500 hover:text-slate-700 focus:outline-none",children:V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),V.jsxs("div",{className:"flex items-center",children:[V.jsx("span",{className:"text-sm font-medium text-slate-700 mr-2",children:"Admin"}),V.jsx("div",{className:"rounded-full overflow-hidden border-2 border-slate-300 focus:outline-none focus:border-primary",children:V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 bg-slate-200 text-slate-600 p-1",viewBox:"0 0 20 20",fill:"currentColor",children:V.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})})]})]})]}),V.jsx("main",{className:"flex-1 overflow-y-auto p-4 bg-slate-50",children:t})]})]})}function hx({title:t,value:e,icon:s,trend:a,iconBgColor:d="bg-blue-100"}){return V.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[V.jsxs("div",{className:"flex items-center justify-between",children:[V.jsxs("div",{children:[V.jsx("p",{className:"text-sm text-slate-500",children:t}),V.jsx("h3",{className:"text-2xl font-bold text-slate-800",children:e})]}),V.jsx("div",{className:`rounded-full ${d} p-2`,children:s})]}),a&&V.jsx("div",{className:"mt-2",children:V.jsxs("div",{className:"flex items-center",children:[V.jsxs("span",{className:`${a.isPositive?"text-green-500":"text-orange-500"} text-sm flex items-center`,children:[a.isPositive?V.jsx(zq,{className:"h-4 w-4"}):V.jsx(Ux,{className:"h-4 w-4"}),a.value,"%"]}),V.jsx("span",{className:"text-slate-500 text-xs ml-1",children:a.label})]})})]})}var mN={exports:{}};(function(t,e){(function(s,a){t.exports=a()})(Hc,function(){var s,a,d;function g(i,E){if(!s)s=E;else if(!a)a=E;else{var k="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",O={};s(O),d=E(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}g(["exports"],function(i){function E(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var k,O={},z={};function G(){if(k)return z;k=1,Object.defineProperty(z,"__esModule",{value:!0}),z.setMatrixArrayType=function(f){z.ARRAY_TYPE=n=f},z.toRadian=function(f){return f*u},z.equals=function(f,h){return Math.abs(f-h)<=c*Math.max(1,Math.abs(f),Math.abs(h))},z.RANDOM=z.ARRAY_TYPE=z.EPSILON=void 0;var c=1e-6;z.EPSILON=c;var n=typeof Float32Array<"u"?Float32Array:Array;z.ARRAY_TYPE=n;var o=Math.random;z.RANDOM=o;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var f=0,h=arguments.length;h--;)f+=arguments[h]*arguments[h];return Math.sqrt(f)}),z}var U,ie={};function Q(){if(U)return ie;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},c(h)}U=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.create=function(){var h=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},ie.clone=function(h){var _=new n.ARRAY_TYPE(4);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_},ie.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h},ie.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},ie.fromValues=function(h,_,w,T){var P=new n.ARRAY_TYPE(4);return P[0]=h,P[1]=_,P[2]=w,P[3]=T,P},ie.set=function(h,_,w,T,P){return h[0]=_,h[1]=w,h[2]=T,h[3]=P,h},ie.transpose=function(h,_){if(h===_){var w=_[1];h[1]=_[2],h[2]=w}else h[0]=_[0],h[1]=_[2],h[2]=_[1],h[3]=_[3];return h},ie.invert=function(h,_){var w=_[0],T=_[1],P=_[2],x=_[3],A=w*x-P*T;return A?(h[0]=x*(A=1/A),h[1]=-T*A,h[2]=-P*A,h[3]=w*A,h):null},ie.adjoint=function(h,_){var w=_[0];return h[0]=_[3],h[1]=-_[1],h[2]=-_[2],h[3]=w,h},ie.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},ie.multiply=u,ie.rotate=function(h,_,w){var T=_[0],P=_[1],x=_[2],A=_[3],I=Math.sin(w),C=Math.cos(w);return h[0]=T*C+x*I,h[1]=P*C+A*I,h[2]=T*-I+x*C,h[3]=P*-I+A*C,h},ie.scale=function(h,_,w){var T=_[1],P=_[2],x=_[3],A=w[0],I=w[1];return h[0]=_[0]*A,h[1]=T*A,h[2]=P*I,h[3]=x*I,h},ie.fromRotation=function(h,_){var w=Math.sin(_),T=Math.cos(_);return h[0]=T,h[1]=w,h[2]=-w,h[3]=T,h},ie.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=_[1],h},ie.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},ie.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},ie.LDU=function(h,_,w,T){return h[2]=T[2]/T[0],w[0]=T[0],w[1]=T[1],w[3]=T[3]-h[2]*w[1],[h,_,w]},ie.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h},ie.subtract=f,ie.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]},ie.equals=function(h,_){var w=h[0],T=h[1],P=h[2],x=h[3],A=_[0],I=_[1],C=_[2],M=_[3];return Math.abs(w-A)<=n.EPSILON*Math.max(1,Math.abs(w),Math.abs(A))&&Math.abs(T-I)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs(I))&&Math.abs(P-C)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(C))&&Math.abs(x-M)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(M))},ie.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h},ie.multiplyScalarAndAdd=function(h,_,w,T){return h[0]=_[0]+w[0]*T,h[1]=_[1]+w[1]*T,h[2]=_[2]+w[2]*T,h[3]=_[3]+w[3]*T,h},ie.sub=ie.mul=void 0;var n=function(h,_){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=o(void 0);if(w&&w.has(h))return w.get(h);var T={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var A=P?Object.getOwnPropertyDescriptor(h,x):null;A&&(A.get||A.set)?Object.defineProperty(T,x,A):T[x]=h[x]}return T.default=h,w&&w.set(h,T),T}(G());function o(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(o=function(T){return T?w:_})(h)}function u(h,_,w){var T=_[0],P=_[1],x=_[2],A=_[3],I=w[0],C=w[1],M=w[2],R=w[3];return h[0]=T*I+x*C,h[1]=P*I+A*C,h[2]=T*M+x*R,h[3]=P*M+A*R,h}function f(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h}return ie.mul=u,ie.sub=f,ie}var se,J={};function te(){if(se)return J;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},c(h)}se=1,Object.defineProperty(J,"__esModule",{value:!0}),J.create=function(){var h=new n.ARRAY_TYPE(6);return n.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},J.clone=function(h){var _=new n.ARRAY_TYPE(6);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_[4]=h[4],_[5]=h[5],_},J.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h[4]=_[4],h[5]=_[5],h},J.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},J.fromValues=function(h,_,w,T,P,x){var A=new n.ARRAY_TYPE(6);return A[0]=h,A[1]=_,A[2]=w,A[3]=T,A[4]=P,A[5]=x,A},J.set=function(h,_,w,T,P,x,A){return h[0]=_,h[1]=w,h[2]=T,h[3]=P,h[4]=x,h[5]=A,h},J.invert=function(h,_){var w=_[0],T=_[1],P=_[2],x=_[3],A=_[4],I=_[5],C=w*x-T*P;return C?(h[0]=x*(C=1/C),h[1]=-T*C,h[2]=-P*C,h[3]=w*C,h[4]=(P*I-x*A)*C,h[5]=(T*A-w*I)*C,h):null},J.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},J.multiply=u,J.rotate=function(h,_,w){var T=_[0],P=_[1],x=_[2],A=_[3],I=_[4],C=_[5],M=Math.sin(w),R=Math.cos(w);return h[0]=T*R+x*M,h[1]=P*R+A*M,h[2]=T*-M+x*R,h[3]=P*-M+A*R,h[4]=I,h[5]=C,h},J.scale=function(h,_,w){var T=_[1],P=_[2],x=_[3],A=_[4],I=_[5],C=w[0],M=w[1];return h[0]=_[0]*C,h[1]=T*C,h[2]=P*M,h[3]=x*M,h[4]=A,h[5]=I,h},J.translate=function(h,_,w){var T=_[0],P=_[1],x=_[2],A=_[3],I=_[4],C=_[5],M=w[0],R=w[1];return h[0]=T,h[1]=P,h[2]=x,h[3]=A,h[4]=T*M+x*R+I,h[5]=P*M+A*R+C,h},J.fromRotation=function(h,_){var w=Math.sin(_),T=Math.cos(_);return h[0]=T,h[1]=w,h[2]=-w,h[3]=T,h[4]=0,h[5]=0,h},J.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=_[1],h[4]=0,h[5]=0,h},J.fromTranslation=function(h,_){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=_[0],h[5]=_[1],h},J.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},J.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},J.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h[4]=_[4]+w[4],h[5]=_[5]+w[5],h},J.subtract=f,J.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h[4]=_[4]*w,h[5]=_[5]*w,h},J.multiplyScalarAndAdd=function(h,_,w,T){return h[0]=_[0]+w[0]*T,h[1]=_[1]+w[1]*T,h[2]=_[2]+w[2]*T,h[3]=_[3]+w[3]*T,h[4]=_[4]+w[4]*T,h[5]=_[5]+w[5]*T,h},J.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]&&h[4]===_[4]&&h[5]===_[5]},J.equals=function(h,_){var w=h[0],T=h[1],P=h[2],x=h[3],A=h[4],I=h[5],C=_[0],M=_[1],R=_[2],j=_[3],$=_[4],Y=_[5];return Math.abs(w-C)<=n.EPSILON*Math.max(1,Math.abs(w),Math.abs(C))&&Math.abs(T-M)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs(M))&&Math.abs(P-R)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(R))&&Math.abs(x-j)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(j))&&Math.abs(A-$)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs($))&&Math.abs(I-Y)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(Y))},J.sub=J.mul=void 0;var n=function(h,_){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=o(void 0);if(w&&w.has(h))return w.get(h);var T={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var A=P?Object.getOwnPropertyDescriptor(h,x):null;A&&(A.get||A.set)?Object.defineProperty(T,x,A):T[x]=h[x]}return T.default=h,w&&w.set(h,T),T}(G());function o(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(o=function(T){return T?w:_})(h)}function u(h,_,w){var T=_[0],P=_[1],x=_[2],A=_[3],I=_[4],C=_[5],M=w[0],R=w[1],j=w[2],$=w[3],Y=w[4],X=w[5];return h[0]=T*M+x*R,h[1]=P*M+A*R,h[2]=T*j+x*$,h[3]=P*j+A*$,h[4]=T*Y+x*X+I,h[5]=P*Y+A*X+C,h}function f(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h[4]=_[4]-w[4],h[5]=_[5]-w[5],h}return J.mul=u,J.sub=f,J}var le,ye={};function Ne(){if(le)return ye;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},c(h)}le=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.create=function(){var h=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},ye.fromMat4=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[4],h[4]=_[5],h[5]=_[6],h[6]=_[8],h[7]=_[9],h[8]=_[10],h},ye.clone=function(h){var _=new n.ARRAY_TYPE(9);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_[4]=h[4],_[5]=h[5],_[6]=h[6],_[7]=h[7],_[8]=h[8],_},ye.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h[4]=_[4],h[5]=_[5],h[6]=_[6],h[7]=_[7],h[8]=_[8],h},ye.fromValues=function(h,_,w,T,P,x,A,I,C){var M=new n.ARRAY_TYPE(9);return M[0]=h,M[1]=_,M[2]=w,M[3]=T,M[4]=P,M[5]=x,M[6]=A,M[7]=I,M[8]=C,M},ye.set=function(h,_,w,T,P,x,A,I,C,M){return h[0]=_,h[1]=w,h[2]=T,h[3]=P,h[4]=x,h[5]=A,h[6]=I,h[7]=C,h[8]=M,h},ye.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},ye.transpose=function(h,_){if(h===_){var w=_[1],T=_[2],P=_[5];h[1]=_[3],h[2]=_[6],h[3]=w,h[5]=_[7],h[6]=T,h[7]=P}else h[0]=_[0],h[1]=_[3],h[2]=_[6],h[3]=_[1],h[4]=_[4],h[5]=_[7],h[6]=_[2],h[7]=_[5],h[8]=_[8];return h},ye.invert=function(h,_){var w=_[0],T=_[1],P=_[2],x=_[3],A=_[4],I=_[5],C=_[6],M=_[7],R=_[8],j=R*A-I*M,$=-R*x+I*C,Y=M*x-A*C,X=w*j+T*$+P*Y;return X?(h[0]=j*(X=1/X),h[1]=(-R*T+P*M)*X,h[2]=(I*T-P*A)*X,h[3]=$*X,h[4]=(R*w-P*C)*X,h[5]=(-I*w+P*x)*X,h[6]=Y*X,h[7]=(-M*w+T*C)*X,h[8]=(A*w-T*x)*X,h):null},ye.adjoint=function(h,_){var w=_[0],T=_[1],P=_[2],x=_[3],A=_[4],I=_[5],C=_[6],M=_[7],R=_[8];return h[0]=A*R-I*M,h[1]=P*M-T*R,h[2]=T*I-P*A,h[3]=I*C-x*R,h[4]=w*R-P*C,h[5]=P*x-w*I,h[6]=x*M-A*C,h[7]=T*C-w*M,h[8]=w*A-T*x,h},ye.determinant=function(h){var _=h[3],w=h[4],T=h[5],P=h[6],x=h[7],A=h[8];return h[0]*(A*w-T*x)+h[1]*(-A*_+T*P)+h[2]*(x*_-w*P)},ye.multiply=u,ye.translate=function(h,_,w){var T=_[0],P=_[1],x=_[2],A=_[3],I=_[4],C=_[5],M=_[6],R=_[7],j=_[8],$=w[0],Y=w[1];return h[0]=T,h[1]=P,h[2]=x,h[3]=A,h[4]=I,h[5]=C,h[6]=$*T+Y*A+M,h[7]=$*P+Y*I+R,h[8]=$*x+Y*C+j,h},ye.rotate=function(h,_,w){var T=_[0],P=_[1],x=_[2],A=_[3],I=_[4],C=_[5],M=_[6],R=_[7],j=_[8],$=Math.sin(w),Y=Math.cos(w);return h[0]=Y*T+$*A,h[1]=Y*P+$*I,h[2]=Y*x+$*C,h[3]=Y*A-$*T,h[4]=Y*I-$*P,h[5]=Y*C-$*x,h[6]=M,h[7]=R,h[8]=j,h},ye.scale=function(h,_,w){var T=w[0],P=w[1];return h[0]=T*_[0],h[1]=T*_[1],h[2]=T*_[2],h[3]=P*_[3],h[4]=P*_[4],h[5]=P*_[5],h[6]=_[6],h[7]=_[7],h[8]=_[8],h},ye.fromTranslation=function(h,_){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=_[0],h[7]=_[1],h[8]=1,h},ye.fromRotation=function(h,_){var w=Math.sin(_),T=Math.cos(_);return h[0]=T,h[1]=w,h[2]=0,h[3]=-w,h[4]=T,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},ye.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=0,h[4]=_[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},ye.fromMat2d=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=0,h[3]=_[2],h[4]=_[3],h[5]=0,h[6]=_[4],h[7]=_[5],h[8]=1,h},ye.fromQuat=function(h,_){var w=_[0],T=_[1],P=_[2],x=_[3],A=w+w,I=T+T,C=P+P,M=w*A,R=T*A,j=T*I,$=P*A,Y=P*I,X=P*C,Z=x*A,re=x*I,ae=x*C;return h[0]=1-j-X,h[3]=R-ae,h[6]=$+re,h[1]=R+ae,h[4]=1-M-X,h[7]=Y-Z,h[2]=$-re,h[5]=Y+Z,h[8]=1-M-j,h},ye.normalFromMat4=function(h,_){var w=_[0],T=_[1],P=_[2],x=_[3],A=_[4],I=_[5],C=_[6],M=_[7],R=_[8],j=_[9],$=_[10],Y=_[11],X=_[12],Z=_[13],re=_[14],ae=_[15],ue=w*I-T*A,Ce=w*C-P*A,we=w*M-x*A,Se=T*C-P*I,He=T*M-x*I,Pe=P*M-x*C,We=R*Z-j*X,st=R*re-$*X,tt=R*ae-Y*X,ft=j*re-$*Z,ht=j*ae-Y*Z,bt=$*ae-Y*re,gt=ue*bt-Ce*ht+we*ft+Se*tt-He*st+Pe*We;return gt?(h[0]=(I*bt-C*ht+M*ft)*(gt=1/gt),h[1]=(C*tt-A*bt-M*st)*gt,h[2]=(A*ht-I*tt+M*We)*gt,h[3]=(P*ht-T*bt-x*ft)*gt,h[4]=(w*bt-P*tt+x*st)*gt,h[5]=(T*tt-w*ht-x*We)*gt,h[6]=(Z*Pe-re*He+ae*Se)*gt,h[7]=(re*we-X*Pe-ae*Ce)*gt,h[8]=(X*He-Z*we+ae*ue)*gt,h):null},ye.projection=function(h,_,w){return h[0]=2/_,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/w,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},ye.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},ye.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},ye.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h[4]=_[4]+w[4],h[5]=_[5]+w[5],h[6]=_[6]+w[6],h[7]=_[7]+w[7],h[8]=_[8]+w[8],h},ye.subtract=f,ye.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h[4]=_[4]*w,h[5]=_[5]*w,h[6]=_[6]*w,h[7]=_[7]*w,h[8]=_[8]*w,h},ye.multiplyScalarAndAdd=function(h,_,w,T){return h[0]=_[0]+w[0]*T,h[1]=_[1]+w[1]*T,h[2]=_[2]+w[2]*T,h[3]=_[3]+w[3]*T,h[4]=_[4]+w[4]*T,h[5]=_[5]+w[5]*T,h[6]=_[6]+w[6]*T,h[7]=_[7]+w[7]*T,h[8]=_[8]+w[8]*T,h},ye.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]&&h[4]===_[4]&&h[5]===_[5]&&h[6]===_[6]&&h[7]===_[7]&&h[8]===_[8]},ye.equals=function(h,_){var w=h[0],T=h[1],P=h[2],x=h[3],A=h[4],I=h[5],C=h[6],M=h[7],R=h[8],j=_[0],$=_[1],Y=_[2],X=_[3],Z=_[4],re=_[5],ae=_[6],ue=_[7],Ce=_[8];return Math.abs(w-j)<=n.EPSILON*Math.max(1,Math.abs(w),Math.abs(j))&&Math.abs(T-$)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs($))&&Math.abs(P-Y)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(Y))&&Math.abs(x-X)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(X))&&Math.abs(A-Z)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(Z))&&Math.abs(I-re)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(re))&&Math.abs(C-ae)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(ae))&&Math.abs(M-ue)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(ue))&&Math.abs(R-Ce)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ce))},ye.sub=ye.mul=void 0;var n=function(h,_){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=o(void 0);if(w&&w.has(h))return w.get(h);var T={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var A=P?Object.getOwnPropertyDescriptor(h,x):null;A&&(A.get||A.set)?Object.defineProperty(T,x,A):T[x]=h[x]}return T.default=h,w&&w.set(h,T),T}(G());function o(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(o=function(T){return T?w:_})(h)}function u(h,_,w){var T=_[0],P=_[1],x=_[2],A=_[3],I=_[4],C=_[5],M=_[6],R=_[7],j=_[8],$=w[0],Y=w[1],X=w[2],Z=w[3],re=w[4],ae=w[5],ue=w[6],Ce=w[7],we=w[8];return h[0]=$*T+Y*A+X*M,h[1]=$*P+Y*I+X*R,h[2]=$*x+Y*C+X*j,h[3]=Z*T+re*A+ae*M,h[4]=Z*P+re*I+ae*R,h[5]=Z*x+re*C+ae*j,h[6]=ue*T+Ce*A+we*M,h[7]=ue*P+Ce*I+we*R,h[8]=ue*x+Ce*C+we*j,h}function f(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h[4]=_[4]-w[4],h[5]=_[5]-w[5],h[6]=_[6]-w[6],h[7]=_[7]-w[7],h[8]=_[8]-w[8],h}return ye.mul=u,ye.sub=f,ye}var rt,xe={};function Me(){if(rt)return xe;function c(x){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},c(x)}rt=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.create=function(){var x=new n.ARRAY_TYPE(16);return n.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},xe.clone=function(x){var A=new n.ARRAY_TYPE(16);return A[0]=x[0],A[1]=x[1],A[2]=x[2],A[3]=x[3],A[4]=x[4],A[5]=x[5],A[6]=x[6],A[7]=x[7],A[8]=x[8],A[9]=x[9],A[10]=x[10],A[11]=x[11],A[12]=x[12],A[13]=x[13],A[14]=x[14],A[15]=x[15],A},xe.copy=function(x,A){return x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x[4]=A[4],x[5]=A[5],x[6]=A[6],x[7]=A[7],x[8]=A[8],x[9]=A[9],x[10]=A[10],x[11]=A[11],x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15],x},xe.fromValues=function(x,A,I,C,M,R,j,$,Y,X,Z,re,ae,ue,Ce,we){var Se=new n.ARRAY_TYPE(16);return Se[0]=x,Se[1]=A,Se[2]=I,Se[3]=C,Se[4]=M,Se[5]=R,Se[6]=j,Se[7]=$,Se[8]=Y,Se[9]=X,Se[10]=Z,Se[11]=re,Se[12]=ae,Se[13]=ue,Se[14]=Ce,Se[15]=we,Se},xe.set=function(x,A,I,C,M,R,j,$,Y,X,Z,re,ae,ue,Ce,we,Se){return x[0]=A,x[1]=I,x[2]=C,x[3]=M,x[4]=R,x[5]=j,x[6]=$,x[7]=Y,x[8]=X,x[9]=Z,x[10]=re,x[11]=ae,x[12]=ue,x[13]=Ce,x[14]=we,x[15]=Se,x},xe.identity=u,xe.transpose=function(x,A){if(x===A){var I=A[1],C=A[2],M=A[3],R=A[6],j=A[7],$=A[11];x[1]=A[4],x[2]=A[8],x[3]=A[12],x[4]=I,x[6]=A[9],x[7]=A[13],x[8]=C,x[9]=R,x[11]=A[14],x[12]=M,x[13]=j,x[14]=$}else x[0]=A[0],x[1]=A[4],x[2]=A[8],x[3]=A[12],x[4]=A[1],x[5]=A[5],x[6]=A[9],x[7]=A[13],x[8]=A[2],x[9]=A[6],x[10]=A[10],x[11]=A[14],x[12]=A[3],x[13]=A[7],x[14]=A[11],x[15]=A[15];return x},xe.invert=function(x,A){var I=A[0],C=A[1],M=A[2],R=A[3],j=A[4],$=A[5],Y=A[6],X=A[7],Z=A[8],re=A[9],ae=A[10],ue=A[11],Ce=A[12],we=A[13],Se=A[14],He=A[15],Pe=I*$-C*j,We=I*Y-M*j,st=I*X-R*j,tt=C*Y-M*$,ft=C*X-R*$,ht=M*X-R*Y,bt=Z*we-re*Ce,gt=Z*Se-ae*Ce,At=Z*He-ue*Ce,en=re*Se-ae*we,Jt=re*He-ue*we,An=ae*He-ue*Se,on=Pe*An-We*Jt+st*en+tt*At-ft*gt+ht*bt;return on?(x[0]=($*An-Y*Jt+X*en)*(on=1/on),x[1]=(M*Jt-C*An-R*en)*on,x[2]=(we*ht-Se*ft+He*tt)*on,x[3]=(ae*ft-re*ht-ue*tt)*on,x[4]=(Y*At-j*An-X*gt)*on,x[5]=(I*An-M*At+R*gt)*on,x[6]=(Se*st-Ce*ht-He*We)*on,x[7]=(Z*ht-ae*st+ue*We)*on,x[8]=(j*Jt-$*At+X*bt)*on,x[9]=(C*At-I*Jt-R*bt)*on,x[10]=(Ce*ft-we*st+He*Pe)*on,x[11]=(re*st-Z*ft-ue*Pe)*on,x[12]=($*gt-j*en-Y*bt)*on,x[13]=(I*en-C*gt+M*bt)*on,x[14]=(we*We-Ce*tt-Se*Pe)*on,x[15]=(Z*tt-re*We+ae*Pe)*on,x):null},xe.adjoint=function(x,A){var I=A[0],C=A[1],M=A[2],R=A[3],j=A[4],$=A[5],Y=A[6],X=A[7],Z=A[8],re=A[9],ae=A[10],ue=A[11],Ce=A[12],we=A[13],Se=A[14],He=A[15];return x[0]=$*(ae*He-ue*Se)-re*(Y*He-X*Se)+we*(Y*ue-X*ae),x[1]=-(C*(ae*He-ue*Se)-re*(M*He-R*Se)+we*(M*ue-R*ae)),x[2]=C*(Y*He-X*Se)-$*(M*He-R*Se)+we*(M*X-R*Y),x[3]=-(C*(Y*ue-X*ae)-$*(M*ue-R*ae)+re*(M*X-R*Y)),x[4]=-(j*(ae*He-ue*Se)-Z*(Y*He-X*Se)+Ce*(Y*ue-X*ae)),x[5]=I*(ae*He-ue*Se)-Z*(M*He-R*Se)+Ce*(M*ue-R*ae),x[6]=-(I*(Y*He-X*Se)-j*(M*He-R*Se)+Ce*(M*X-R*Y)),x[7]=I*(Y*ue-X*ae)-j*(M*ue-R*ae)+Z*(M*X-R*Y),x[8]=j*(re*He-ue*we)-Z*($*He-X*we)+Ce*($*ue-X*re),x[9]=-(I*(re*He-ue*we)-Z*(C*He-R*we)+Ce*(C*ue-R*re)),x[10]=I*($*He-X*we)-j*(C*He-R*we)+Ce*(C*X-R*$),x[11]=-(I*($*ue-X*re)-j*(C*ue-R*re)+Z*(C*X-R*$)),x[12]=-(j*(re*Se-ae*we)-Z*($*Se-Y*we)+Ce*($*ae-Y*re)),x[13]=I*(re*Se-ae*we)-Z*(C*Se-M*we)+Ce*(C*ae-M*re),x[14]=-(I*($*Se-Y*we)-j*(C*Se-M*we)+Ce*(C*Y-M*$)),x[15]=I*($*ae-Y*re)-j*(C*ae-M*re)+Z*(C*Y-M*$),x},xe.determinant=function(x){var A=x[0],I=x[1],C=x[2],M=x[3],R=x[4],j=x[5],$=x[6],Y=x[7],X=x[8],Z=x[9],re=x[10],ae=x[11],ue=x[12],Ce=x[13],we=x[14],Se=x[15];return(A*j-I*R)*(re*Se-ae*we)-(A*$-C*R)*(Z*Se-ae*Ce)+(A*Y-M*R)*(Z*we-re*Ce)+(I*$-C*j)*(X*Se-ae*ue)-(I*Y-M*j)*(X*we-re*ue)+(C*Y-M*$)*(X*Ce-Z*ue)},xe.multiply=f,xe.translate=function(x,A,I){var C,M,R,j,$,Y,X,Z,re,ae,ue,Ce,we=I[0],Se=I[1],He=I[2];return A===x?(x[12]=A[0]*we+A[4]*Se+A[8]*He+A[12],x[13]=A[1]*we+A[5]*Se+A[9]*He+A[13],x[14]=A[2]*we+A[6]*Se+A[10]*He+A[14],x[15]=A[3]*we+A[7]*Se+A[11]*He+A[15]):(M=A[1],R=A[2],j=A[3],$=A[4],Y=A[5],X=A[6],Z=A[7],re=A[8],ae=A[9],ue=A[10],Ce=A[11],x[0]=C=A[0],x[1]=M,x[2]=R,x[3]=j,x[4]=$,x[5]=Y,x[6]=X,x[7]=Z,x[8]=re,x[9]=ae,x[10]=ue,x[11]=Ce,x[12]=C*we+$*Se+re*He+A[12],x[13]=M*we+Y*Se+ae*He+A[13],x[14]=R*we+X*Se+ue*He+A[14],x[15]=j*we+Z*Se+Ce*He+A[15]),x},xe.scale=function(x,A,I){var C=I[0],M=I[1],R=I[2];return x[0]=A[0]*C,x[1]=A[1]*C,x[2]=A[2]*C,x[3]=A[3]*C,x[4]=A[4]*M,x[5]=A[5]*M,x[6]=A[6]*M,x[7]=A[7]*M,x[8]=A[8]*R,x[9]=A[9]*R,x[10]=A[10]*R,x[11]=A[11]*R,x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15],x},xe.rotate=function(x,A,I,C){var M,R,j,$,Y,X,Z,re,ae,ue,Ce,we,Se,He,Pe,We,st,tt,ft,ht,bt,gt,At,en,Jt=C[0],An=C[1],on=C[2],hn=Math.hypot(Jt,An,on);return hn<n.EPSILON?null:(Jt*=hn=1/hn,An*=hn,on*=hn,M=Math.sin(I),R=Math.cos(I),Y=A[1],X=A[2],Z=A[3],ae=A[5],ue=A[6],Ce=A[7],Se=A[9],He=A[10],Pe=A[11],We=Jt*Jt*(j=1-R)+R,ft=Jt*An*j-on*M,ht=An*An*j+R,bt=on*An*j+Jt*M,gt=Jt*on*j+An*M,At=An*on*j-Jt*M,en=on*on*j+R,x[0]=($=A[0])*We+(re=A[4])*(st=An*Jt*j+on*M)+(we=A[8])*(tt=on*Jt*j-An*M),x[1]=Y*We+ae*st+Se*tt,x[2]=X*We+ue*st+He*tt,x[3]=Z*We+Ce*st+Pe*tt,x[4]=$*ft+re*ht+we*bt,x[5]=Y*ft+ae*ht+Se*bt,x[6]=X*ft+ue*ht+He*bt,x[7]=Z*ft+Ce*ht+Pe*bt,x[8]=$*gt+re*At+we*en,x[9]=Y*gt+ae*At+Se*en,x[10]=X*gt+ue*At+He*en,x[11]=Z*gt+Ce*At+Pe*en,A!==x&&(x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15]),x)},xe.rotateX=function(x,A,I){var C=Math.sin(I),M=Math.cos(I),R=A[4],j=A[5],$=A[6],Y=A[7],X=A[8],Z=A[9],re=A[10],ae=A[11];return A!==x&&(x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15]),x[4]=R*M+X*C,x[5]=j*M+Z*C,x[6]=$*M+re*C,x[7]=Y*M+ae*C,x[8]=X*M-R*C,x[9]=Z*M-j*C,x[10]=re*M-$*C,x[11]=ae*M-Y*C,x},xe.rotateY=function(x,A,I){var C=Math.sin(I),M=Math.cos(I),R=A[0],j=A[1],$=A[2],Y=A[3],X=A[8],Z=A[9],re=A[10],ae=A[11];return A!==x&&(x[4]=A[4],x[5]=A[5],x[6]=A[6],x[7]=A[7],x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15]),x[0]=R*M-X*C,x[1]=j*M-Z*C,x[2]=$*M-re*C,x[3]=Y*M-ae*C,x[8]=R*C+X*M,x[9]=j*C+Z*M,x[10]=$*C+re*M,x[11]=Y*C+ae*M,x},xe.rotateZ=function(x,A,I){var C=Math.sin(I),M=Math.cos(I),R=A[0],j=A[1],$=A[2],Y=A[3],X=A[4],Z=A[5],re=A[6],ae=A[7];return A!==x&&(x[8]=A[8],x[9]=A[9],x[10]=A[10],x[11]=A[11],x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15]),x[0]=R*M+X*C,x[1]=j*M+Z*C,x[2]=$*M+re*C,x[3]=Y*M+ae*C,x[4]=X*M-R*C,x[5]=Z*M-j*C,x[6]=re*M-$*C,x[7]=ae*M-Y*C,x},xe.fromTranslation=function(x,A){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=A[0],x[13]=A[1],x[14]=A[2],x[15]=1,x},xe.fromScaling=function(x,A){return x[0]=A[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=A[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=A[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xe.fromRotation=function(x,A,I){var C,M,R,j=I[0],$=I[1],Y=I[2],X=Math.hypot(j,$,Y);return X<n.EPSILON?null:(j*=X=1/X,$*=X,Y*=X,C=Math.sin(A),M=Math.cos(A),x[0]=j*j*(R=1-M)+M,x[1]=$*j*R+Y*C,x[2]=Y*j*R-$*C,x[3]=0,x[4]=j*$*R-Y*C,x[5]=$*$*R+M,x[6]=Y*$*R+j*C,x[7]=0,x[8]=j*Y*R+$*C,x[9]=$*Y*R-j*C,x[10]=Y*Y*R+M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},xe.fromXRotation=function(x,A){var I=Math.sin(A),C=Math.cos(A);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=C,x[6]=I,x[7]=0,x[8]=0,x[9]=-I,x[10]=C,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xe.fromYRotation=function(x,A){var I=Math.sin(A),C=Math.cos(A);return x[0]=C,x[1]=0,x[2]=-I,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=I,x[9]=0,x[10]=C,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xe.fromZRotation=function(x,A){var I=Math.sin(A),C=Math.cos(A);return x[0]=C,x[1]=I,x[2]=0,x[3]=0,x[4]=-I,x[5]=C,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xe.fromRotationTranslation=h,xe.fromQuat2=function(x,A){var I=new n.ARRAY_TYPE(3),C=-A[0],M=-A[1],R=-A[2],j=A[3],$=A[4],Y=A[5],X=A[6],Z=A[7],re=C*C+M*M+R*R+j*j;return re>0?(I[0]=2*($*j+Z*C+Y*R-X*M)/re,I[1]=2*(Y*j+Z*M+X*C-$*R)/re,I[2]=2*(X*j+Z*R+$*M-Y*C)/re):(I[0]=2*($*j+Z*C+Y*R-X*M),I[1]=2*(Y*j+Z*M+X*C-$*R),I[2]=2*(X*j+Z*R+$*M-Y*C)),h(x,A,I),x},xe.getTranslation=function(x,A){return x[0]=A[12],x[1]=A[13],x[2]=A[14],x},xe.getScaling=_,xe.getRotation=function(x,A){var I=new n.ARRAY_TYPE(3);_(I,A);var C=1/I[0],M=1/I[1],R=1/I[2],j=A[0]*C,$=A[1]*M,Y=A[2]*R,X=A[4]*C,Z=A[5]*M,re=A[6]*R,ae=A[8]*C,ue=A[9]*M,Ce=A[10]*R,we=j+Z+Ce,Se=0;return we>0?(Se=2*Math.sqrt(we+1),x[3]=.25*Se,x[0]=(re-ue)/Se,x[1]=(ae-Y)/Se,x[2]=($-X)/Se):j>Z&&j>Ce?(Se=2*Math.sqrt(1+j-Z-Ce),x[3]=(re-ue)/Se,x[0]=.25*Se,x[1]=($+X)/Se,x[2]=(ae+Y)/Se):Z>Ce?(Se=2*Math.sqrt(1+Z-j-Ce),x[3]=(ae-Y)/Se,x[0]=($+X)/Se,x[1]=.25*Se,x[2]=(re+ue)/Se):(Se=2*Math.sqrt(1+Ce-j-Z),x[3]=($-X)/Se,x[0]=(ae+Y)/Se,x[1]=(re+ue)/Se,x[2]=.25*Se),x},xe.fromRotationTranslationScale=function(x,A,I,C){var M=A[0],R=A[1],j=A[2],$=A[3],Y=M+M,X=R+R,Z=j+j,re=M*Y,ae=M*X,ue=M*Z,Ce=R*X,we=R*Z,Se=j*Z,He=$*Y,Pe=$*X,We=$*Z,st=C[0],tt=C[1],ft=C[2];return x[0]=(1-(Ce+Se))*st,x[1]=(ae+We)*st,x[2]=(ue-Pe)*st,x[3]=0,x[4]=(ae-We)*tt,x[5]=(1-(re+Se))*tt,x[6]=(we+He)*tt,x[7]=0,x[8]=(ue+Pe)*ft,x[9]=(we-He)*ft,x[10]=(1-(re+Ce))*ft,x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x},xe.fromRotationTranslationScaleOrigin=function(x,A,I,C,M){var R=A[0],j=A[1],$=A[2],Y=A[3],X=R+R,Z=j+j,re=$+$,ae=R*X,ue=R*Z,Ce=R*re,we=j*Z,Se=j*re,He=$*re,Pe=Y*X,We=Y*Z,st=Y*re,tt=C[0],ft=C[1],ht=C[2],bt=M[0],gt=M[1],At=M[2],en=(1-(we+He))*tt,Jt=(ue+st)*tt,An=(Ce-We)*tt,on=(ue-st)*ft,hn=(1-(ae+He))*ft,rn=(Se+Pe)*ft,jn=(Ce+We)*ht,Sn=(Se-Pe)*ht,kn=(1-(ae+we))*ht;return x[0]=en,x[1]=Jt,x[2]=An,x[3]=0,x[4]=on,x[5]=hn,x[6]=rn,x[7]=0,x[8]=jn,x[9]=Sn,x[10]=kn,x[11]=0,x[12]=I[0]+bt-(en*bt+on*gt+jn*At),x[13]=I[1]+gt-(Jt*bt+hn*gt+Sn*At),x[14]=I[2]+At-(An*bt+rn*gt+kn*At),x[15]=1,x},xe.fromQuat=function(x,A){var I=A[0],C=A[1],M=A[2],R=A[3],j=I+I,$=C+C,Y=M+M,X=I*j,Z=C*j,re=C*$,ae=M*j,ue=M*$,Ce=M*Y,we=R*j,Se=R*$,He=R*Y;return x[0]=1-re-Ce,x[1]=Z+He,x[2]=ae-Se,x[3]=0,x[4]=Z-He,x[5]=1-X-Ce,x[6]=ue+we,x[7]=0,x[8]=ae+Se,x[9]=ue-we,x[10]=1-X-re,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xe.frustum=function(x,A,I,C,M,R,j){var $=1/(I-A),Y=1/(M-C),X=1/(R-j);return x[0]=2*R*$,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*R*Y,x[6]=0,x[7]=0,x[8]=(I+A)*$,x[9]=(M+C)*Y,x[10]=(j+R)*X,x[11]=-1,x[12]=0,x[13]=0,x[14]=j*R*2*X,x[15]=0,x},xe.perspectiveNO=w,xe.perspectiveZO=function(x,A,I,C,M){var R,j=1/Math.tan(A/2);return x[0]=j/I,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=j,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,M!=null&&M!==1/0?(x[10]=M*(R=1/(C-M)),x[14]=M*C*R):(x[10]=-1,x[14]=-C),x},xe.perspectiveFromFieldOfView=function(x,A,I,C){var M=Math.tan(A.upDegrees*Math.PI/180),R=Math.tan(A.downDegrees*Math.PI/180),j=Math.tan(A.leftDegrees*Math.PI/180),$=Math.tan(A.rightDegrees*Math.PI/180),Y=2/(j+$),X=2/(M+R);return x[0]=Y,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=X,x[6]=0,x[7]=0,x[8]=-(j-$)*Y*.5,x[9]=(M-R)*X*.5,x[10]=C/(I-C),x[11]=-1,x[12]=0,x[13]=0,x[14]=C*I/(I-C),x[15]=0,x},xe.orthoNO=T,xe.orthoZO=function(x,A,I,C,M,R,j){var $=1/(A-I),Y=1/(C-M),X=1/(R-j);return x[0]=-2*$,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*Y,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=X,x[11]=0,x[12]=(A+I)*$,x[13]=(M+C)*Y,x[14]=R*X,x[15]=1,x},xe.lookAt=function(x,A,I,C){var M,R,j,$,Y,X,Z,re,ae,ue,Ce=A[0],we=A[1],Se=A[2],He=C[0],Pe=C[1],We=C[2],st=I[0],tt=I[1],ft=I[2];return Math.abs(Ce-st)<n.EPSILON&&Math.abs(we-tt)<n.EPSILON&&Math.abs(Se-ft)<n.EPSILON?u(x):(Z=Ce-st,re=we-tt,ae=Se-ft,M=Pe*(ae*=ue=1/Math.hypot(Z,re,ae))-We*(re*=ue),R=We*(Z*=ue)-He*ae,j=He*re-Pe*Z,(ue=Math.hypot(M,R,j))?(M*=ue=1/ue,R*=ue,j*=ue):(M=0,R=0,j=0),$=re*j-ae*R,Y=ae*M-Z*j,X=Z*R-re*M,(ue=Math.hypot($,Y,X))?($*=ue=1/ue,Y*=ue,X*=ue):($=0,Y=0,X=0),x[0]=M,x[1]=$,x[2]=Z,x[3]=0,x[4]=R,x[5]=Y,x[6]=re,x[7]=0,x[8]=j,x[9]=X,x[10]=ae,x[11]=0,x[12]=-(M*Ce+R*we+j*Se),x[13]=-($*Ce+Y*we+X*Se),x[14]=-(Z*Ce+re*we+ae*Se),x[15]=1,x)},xe.targetTo=function(x,A,I,C){var M=A[0],R=A[1],j=A[2],$=C[0],Y=C[1],X=C[2],Z=M-I[0],re=R-I[1],ae=j-I[2],ue=Z*Z+re*re+ae*ae;ue>0&&(Z*=ue=1/Math.sqrt(ue),re*=ue,ae*=ue);var Ce=Y*ae-X*re,we=X*Z-$*ae,Se=$*re-Y*Z;return(ue=Ce*Ce+we*we+Se*Se)>0&&(Ce*=ue=1/Math.sqrt(ue),we*=ue,Se*=ue),x[0]=Ce,x[1]=we,x[2]=Se,x[3]=0,x[4]=re*Se-ae*we,x[5]=ae*Ce-Z*Se,x[6]=Z*we-re*Ce,x[7]=0,x[8]=Z,x[9]=re,x[10]=ae,x[11]=0,x[12]=M,x[13]=R,x[14]=j,x[15]=1,x},xe.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},xe.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},xe.add=function(x,A,I){return x[0]=A[0]+I[0],x[1]=A[1]+I[1],x[2]=A[2]+I[2],x[3]=A[3]+I[3],x[4]=A[4]+I[4],x[5]=A[5]+I[5],x[6]=A[6]+I[6],x[7]=A[7]+I[7],x[8]=A[8]+I[8],x[9]=A[9]+I[9],x[10]=A[10]+I[10],x[11]=A[11]+I[11],x[12]=A[12]+I[12],x[13]=A[13]+I[13],x[14]=A[14]+I[14],x[15]=A[15]+I[15],x},xe.subtract=P,xe.multiplyScalar=function(x,A,I){return x[0]=A[0]*I,x[1]=A[1]*I,x[2]=A[2]*I,x[3]=A[3]*I,x[4]=A[4]*I,x[5]=A[5]*I,x[6]=A[6]*I,x[7]=A[7]*I,x[8]=A[8]*I,x[9]=A[9]*I,x[10]=A[10]*I,x[11]=A[11]*I,x[12]=A[12]*I,x[13]=A[13]*I,x[14]=A[14]*I,x[15]=A[15]*I,x},xe.multiplyScalarAndAdd=function(x,A,I,C){return x[0]=A[0]+I[0]*C,x[1]=A[1]+I[1]*C,x[2]=A[2]+I[2]*C,x[3]=A[3]+I[3]*C,x[4]=A[4]+I[4]*C,x[5]=A[5]+I[5]*C,x[6]=A[6]+I[6]*C,x[7]=A[7]+I[7]*C,x[8]=A[8]+I[8]*C,x[9]=A[9]+I[9]*C,x[10]=A[10]+I[10]*C,x[11]=A[11]+I[11]*C,x[12]=A[12]+I[12]*C,x[13]=A[13]+I[13]*C,x[14]=A[14]+I[14]*C,x[15]=A[15]+I[15]*C,x},xe.exactEquals=function(x,A){return x[0]===A[0]&&x[1]===A[1]&&x[2]===A[2]&&x[3]===A[3]&&x[4]===A[4]&&x[5]===A[5]&&x[6]===A[6]&&x[7]===A[7]&&x[8]===A[8]&&x[9]===A[9]&&x[10]===A[10]&&x[11]===A[11]&&x[12]===A[12]&&x[13]===A[13]&&x[14]===A[14]&&x[15]===A[15]},xe.equals=function(x,A){var I=x[0],C=x[1],M=x[2],R=x[3],j=x[4],$=x[5],Y=x[6],X=x[7],Z=x[8],re=x[9],ae=x[10],ue=x[11],Ce=x[12],we=x[13],Se=x[14],He=x[15],Pe=A[0],We=A[1],st=A[2],tt=A[3],ft=A[4],ht=A[5],bt=A[6],gt=A[7],At=A[8],en=A[9],Jt=A[10],An=A[11],on=A[12],hn=A[13],rn=A[14],jn=A[15];return Math.abs(I-Pe)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(Pe))&&Math.abs(C-We)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(We))&&Math.abs(M-st)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(st))&&Math.abs(R-tt)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(tt))&&Math.abs(j-ft)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(ft))&&Math.abs($-ht)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(ht))&&Math.abs(Y-bt)<=n.EPSILON*Math.max(1,Math.abs(Y),Math.abs(bt))&&Math.abs(X-gt)<=n.EPSILON*Math.max(1,Math.abs(X),Math.abs(gt))&&Math.abs(Z-At)<=n.EPSILON*Math.max(1,Math.abs(Z),Math.abs(At))&&Math.abs(re-en)<=n.EPSILON*Math.max(1,Math.abs(re),Math.abs(en))&&Math.abs(ae-Jt)<=n.EPSILON*Math.max(1,Math.abs(ae),Math.abs(Jt))&&Math.abs(ue-An)<=n.EPSILON*Math.max(1,Math.abs(ue),Math.abs(An))&&Math.abs(Ce-on)<=n.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(on))&&Math.abs(we-hn)<=n.EPSILON*Math.max(1,Math.abs(we),Math.abs(hn))&&Math.abs(Se-rn)<=n.EPSILON*Math.max(1,Math.abs(Se),Math.abs(rn))&&Math.abs(He-jn)<=n.EPSILON*Math.max(1,Math.abs(He),Math.abs(jn))},xe.sub=xe.mul=xe.ortho=xe.perspective=void 0;var n=function(x,A){if(x&&x.__esModule)return x;if(x===null||c(x)!=="object"&&typeof x!="function")return{default:x};var I=o(void 0);if(I&&I.has(x))return I.get(x);var C={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var j=M?Object.getOwnPropertyDescriptor(x,R):null;j&&(j.get||j.set)?Object.defineProperty(C,R,j):C[R]=x[R]}return C.default=x,I&&I.set(x,C),C}(G());function o(x){if(typeof WeakMap!="function")return null;var A=new WeakMap,I=new WeakMap;return(o=function(C){return C?I:A})(x)}function u(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function f(x,A,I){var C=A[0],M=A[1],R=A[2],j=A[3],$=A[4],Y=A[5],X=A[6],Z=A[7],re=A[8],ae=A[9],ue=A[10],Ce=A[11],we=A[12],Se=A[13],He=A[14],Pe=A[15],We=I[0],st=I[1],tt=I[2],ft=I[3];return x[0]=We*C+st*$+tt*re+ft*we,x[1]=We*M+st*Y+tt*ae+ft*Se,x[2]=We*R+st*X+tt*ue+ft*He,x[3]=We*j+st*Z+tt*Ce+ft*Pe,x[4]=(We=I[4])*C+(st=I[5])*$+(tt=I[6])*re+(ft=I[7])*we,x[5]=We*M+st*Y+tt*ae+ft*Se,x[6]=We*R+st*X+tt*ue+ft*He,x[7]=We*j+st*Z+tt*Ce+ft*Pe,x[8]=(We=I[8])*C+(st=I[9])*$+(tt=I[10])*re+(ft=I[11])*we,x[9]=We*M+st*Y+tt*ae+ft*Se,x[10]=We*R+st*X+tt*ue+ft*He,x[11]=We*j+st*Z+tt*Ce+ft*Pe,x[12]=(We=I[12])*C+(st=I[13])*$+(tt=I[14])*re+(ft=I[15])*we,x[13]=We*M+st*Y+tt*ae+ft*Se,x[14]=We*R+st*X+tt*ue+ft*He,x[15]=We*j+st*Z+tt*Ce+ft*Pe,x}function h(x,A,I){var C=A[0],M=A[1],R=A[2],j=A[3],$=C+C,Y=M+M,X=R+R,Z=C*$,re=C*Y,ae=C*X,ue=M*Y,Ce=M*X,we=R*X,Se=j*$,He=j*Y,Pe=j*X;return x[0]=1-(ue+we),x[1]=re+Pe,x[2]=ae-He,x[3]=0,x[4]=re-Pe,x[5]=1-(Z+we),x[6]=Ce+Se,x[7]=0,x[8]=ae+He,x[9]=Ce-Se,x[10]=1-(Z+ue),x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x}function _(x,A){var I=A[4],C=A[5],M=A[6],R=A[8],j=A[9],$=A[10];return x[0]=Math.hypot(A[0],A[1],A[2]),x[1]=Math.hypot(I,C,M),x[2]=Math.hypot(R,j,$),x}function w(x,A,I,C,M){var R,j=1/Math.tan(A/2);return x[0]=j/I,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=j,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,M!=null&&M!==1/0?(x[10]=(M+C)*(R=1/(C-M)),x[14]=2*M*C*R):(x[10]=-1,x[14]=-2*C),x}function T(x,A,I,C,M,R,j){var $=1/(A-I),Y=1/(C-M),X=1/(R-j);return x[0]=-2*$,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*Y,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*X,x[11]=0,x[12]=(A+I)*$,x[13]=(M+C)*Y,x[14]=(j+R)*X,x[15]=1,x}function P(x,A,I){return x[0]=A[0]-I[0],x[1]=A[1]-I[1],x[2]=A[2]-I[2],x[3]=A[3]-I[3],x[4]=A[4]-I[4],x[5]=A[5]-I[5],x[6]=A[6]-I[6],x[7]=A[7]-I[7],x[8]=A[8]-I[8],x[9]=A[9]-I[9],x[10]=A[10]-I[10],x[11]=A[11]-I[11],x[12]=A[12]-I[12],x[13]=A[13]-I[13],x[14]=A[14]-I[14],x[15]=A[15]-I[15],x}return xe.perspective=w,xe.ortho=T,xe.mul=f,xe.sub=P,xe}var it,ot={},ve={};function Le(){if(it)return ve;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},c(M)}it=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.create=u,ve.clone=function(M){var R=new n.ARRAY_TYPE(3);return R[0]=M[0],R[1]=M[1],R[2]=M[2],R},ve.length=f,ve.fromValues=function(M,R,j){var $=new n.ARRAY_TYPE(3);return $[0]=M,$[1]=R,$[2]=j,$},ve.copy=function(M,R){return M[0]=R[0],M[1]=R[1],M[2]=R[2],M},ve.set=function(M,R,j,$){return M[0]=R,M[1]=j,M[2]=$,M},ve.add=function(M,R,j){return M[0]=R[0]+j[0],M[1]=R[1]+j[1],M[2]=R[2]+j[2],M},ve.subtract=h,ve.multiply=_,ve.divide=w,ve.ceil=function(M,R){return M[0]=Math.ceil(R[0]),M[1]=Math.ceil(R[1]),M[2]=Math.ceil(R[2]),M},ve.floor=function(M,R){return M[0]=Math.floor(R[0]),M[1]=Math.floor(R[1]),M[2]=Math.floor(R[2]),M},ve.min=function(M,R,j){return M[0]=Math.min(R[0],j[0]),M[1]=Math.min(R[1],j[1]),M[2]=Math.min(R[2],j[2]),M},ve.max=function(M,R,j){return M[0]=Math.max(R[0],j[0]),M[1]=Math.max(R[1],j[1]),M[2]=Math.max(R[2],j[2]),M},ve.round=function(M,R){return M[0]=Math.round(R[0]),M[1]=Math.round(R[1]),M[2]=Math.round(R[2]),M},ve.scale=function(M,R,j){return M[0]=R[0]*j,M[1]=R[1]*j,M[2]=R[2]*j,M},ve.scaleAndAdd=function(M,R,j,$){return M[0]=R[0]+j[0]*$,M[1]=R[1]+j[1]*$,M[2]=R[2]+j[2]*$,M},ve.distance=T,ve.squaredDistance=P,ve.squaredLength=x,ve.negate=function(M,R){return M[0]=-R[0],M[1]=-R[1],M[2]=-R[2],M},ve.inverse=function(M,R){return M[0]=1/R[0],M[1]=1/R[1],M[2]=1/R[2],M},ve.normalize=function(M,R){var j=R[0],$=R[1],Y=R[2],X=j*j+$*$+Y*Y;return X>0&&(X=1/Math.sqrt(X)),M[0]=R[0]*X,M[1]=R[1]*X,M[2]=R[2]*X,M},ve.dot=A,ve.cross=function(M,R,j){var $=R[0],Y=R[1],X=R[2],Z=j[0],re=j[1],ae=j[2];return M[0]=Y*ae-X*re,M[1]=X*Z-$*ae,M[2]=$*re-Y*Z,M},ve.lerp=function(M,R,j,$){var Y=R[0],X=R[1],Z=R[2];return M[0]=Y+$*(j[0]-Y),M[1]=X+$*(j[1]-X),M[2]=Z+$*(j[2]-Z),M},ve.hermite=function(M,R,j,$,Y,X){var Z=X*X,re=Z*(2*X-3)+1,ae=Z*(X-2)+X,ue=Z*(X-1),Ce=Z*(3-2*X);return M[0]=R[0]*re+j[0]*ae+$[0]*ue+Y[0]*Ce,M[1]=R[1]*re+j[1]*ae+$[1]*ue+Y[1]*Ce,M[2]=R[2]*re+j[2]*ae+$[2]*ue+Y[2]*Ce,M},ve.bezier=function(M,R,j,$,Y,X){var Z=1-X,re=Z*Z,ae=X*X,ue=re*Z,Ce=3*X*re,we=3*ae*Z,Se=ae*X;return M[0]=R[0]*ue+j[0]*Ce+$[0]*we+Y[0]*Se,M[1]=R[1]*ue+j[1]*Ce+$[1]*we+Y[1]*Se,M[2]=R[2]*ue+j[2]*Ce+$[2]*we+Y[2]*Se,M},ve.random=function(M,R){R=R||1;var j=2*n.RANDOM()*Math.PI,$=2*n.RANDOM()-1,Y=Math.sqrt(1-$*$)*R;return M[0]=Math.cos(j)*Y,M[1]=Math.sin(j)*Y,M[2]=$*R,M},ve.transformMat4=function(M,R,j){var $=R[0],Y=R[1],X=R[2],Z=j[3]*$+j[7]*Y+j[11]*X+j[15];return M[0]=(j[0]*$+j[4]*Y+j[8]*X+j[12])/(Z=Z||1),M[1]=(j[1]*$+j[5]*Y+j[9]*X+j[13])/Z,M[2]=(j[2]*$+j[6]*Y+j[10]*X+j[14])/Z,M},ve.transformMat3=function(M,R,j){var $=R[0],Y=R[1],X=R[2];return M[0]=$*j[0]+Y*j[3]+X*j[6],M[1]=$*j[1]+Y*j[4]+X*j[7],M[2]=$*j[2]+Y*j[5]+X*j[8],M},ve.transformQuat=function(M,R,j){var $=j[0],Y=j[1],X=j[2],Z=R[0],re=R[1],ae=R[2],ue=Y*ae-X*re,Ce=X*Z-$*ae,we=$*re-Y*Z,Se=Y*we-X*Ce,He=X*ue-$*we,Pe=$*Ce-Y*ue,We=2*j[3];return Ce*=We,we*=We,He*=2,Pe*=2,M[0]=Z+(ue*=We)+(Se*=2),M[1]=re+Ce+He,M[2]=ae+we+Pe,M},ve.rotateX=function(M,R,j,$){var Y=[],X=[];return Y[0]=R[0]-j[0],Y[1]=R[1]-j[1],Y[2]=R[2]-j[2],X[0]=Y[0],X[1]=Y[1]*Math.cos($)-Y[2]*Math.sin($),X[2]=Y[1]*Math.sin($)+Y[2]*Math.cos($),M[0]=X[0]+j[0],M[1]=X[1]+j[1],M[2]=X[2]+j[2],M},ve.rotateY=function(M,R,j,$){var Y=[],X=[];return Y[0]=R[0]-j[0],Y[1]=R[1]-j[1],Y[2]=R[2]-j[2],X[0]=Y[2]*Math.sin($)+Y[0]*Math.cos($),X[1]=Y[1],X[2]=Y[2]*Math.cos($)-Y[0]*Math.sin($),M[0]=X[0]+j[0],M[1]=X[1]+j[1],M[2]=X[2]+j[2],M},ve.rotateZ=function(M,R,j,$){var Y=[],X=[];return Y[0]=R[0]-j[0],Y[1]=R[1]-j[1],Y[2]=R[2]-j[2],X[0]=Y[0]*Math.cos($)-Y[1]*Math.sin($),X[1]=Y[0]*Math.sin($)+Y[1]*Math.cos($),X[2]=Y[2],M[0]=X[0]+j[0],M[1]=X[1]+j[1],M[2]=X[2]+j[2],M},ve.angle=function(M,R){var j=M[0],$=M[1],Y=M[2],X=R[0],Z=R[1],re=R[2],ae=Math.sqrt(j*j+$*$+Y*Y)*Math.sqrt(X*X+Z*Z+re*re),ue=ae&&A(M,R)/ae;return Math.acos(Math.min(Math.max(ue,-1),1))},ve.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},ve.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},ve.exactEquals=function(M,R){return M[0]===R[0]&&M[1]===R[1]&&M[2]===R[2]},ve.equals=function(M,R){var j=M[0],$=M[1],Y=M[2],X=R[0],Z=R[1],re=R[2];return Math.abs(j-X)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(X))&&Math.abs($-Z)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(Z))&&Math.abs(Y-re)<=n.EPSILON*Math.max(1,Math.abs(Y),Math.abs(re))},ve.forEach=ve.sqrLen=ve.len=ve.sqrDist=ve.dist=ve.div=ve.mul=ve.sub=void 0;var n=function(M,R){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var j=o(void 0);if(j&&j.has(M))return j.get(M);var $={},Y=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var X in M)if(X!=="default"&&Object.prototype.hasOwnProperty.call(M,X)){var Z=Y?Object.getOwnPropertyDescriptor(M,X):null;Z&&(Z.get||Z.set)?Object.defineProperty($,X,Z):$[X]=M[X]}return $.default=M,j&&j.set(M,$),$}(G());function o(M){if(typeof WeakMap!="function")return null;var R=new WeakMap,j=new WeakMap;return(o=function($){return $?j:R})(M)}function u(){var M=new n.ARRAY_TYPE(3);return n.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function f(M){return Math.hypot(M[0],M[1],M[2])}function h(M,R,j){return M[0]=R[0]-j[0],M[1]=R[1]-j[1],M[2]=R[2]-j[2],M}function _(M,R,j){return M[0]=R[0]*j[0],M[1]=R[1]*j[1],M[2]=R[2]*j[2],M}function w(M,R,j){return M[0]=R[0]/j[0],M[1]=R[1]/j[1],M[2]=R[2]/j[2],M}function T(M,R){return Math.hypot(R[0]-M[0],R[1]-M[1],R[2]-M[2])}function P(M,R){var j=R[0]-M[0],$=R[1]-M[1],Y=R[2]-M[2];return j*j+$*$+Y*Y}function x(M){var R=M[0],j=M[1],$=M[2];return R*R+j*j+$*$}function A(M,R){return M[0]*R[0]+M[1]*R[1]+M[2]*R[2]}ve.sub=h,ve.mul=_,ve.div=w,ve.dist=T,ve.sqrDist=P,ve.len=f,ve.sqrLen=x;var I,C=(I=u(),function(M,R,j,$,Y,X){var Z,re;for(R||(R=3),j||(j=0),re=$?Math.min($*R+j,M.length):M.length,Z=j;Z<re;Z+=R)I[0]=M[Z],I[1]=M[Z+1],I[2]=M[Z+2],Y(I,I,X),M[Z]=I[0],M[Z+1]=I[1],M[Z+2]=I[2];return M});return ve.forEach=C,ve}var dt,Je,yt={};function St(){if(dt)return yt;function c(C){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(C)}dt=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.create=u,yt.clone=function(C){var M=new n.ARRAY_TYPE(4);return M[0]=C[0],M[1]=C[1],M[2]=C[2],M[3]=C[3],M},yt.fromValues=function(C,M,R,j){var $=new n.ARRAY_TYPE(4);return $[0]=C,$[1]=M,$[2]=R,$[3]=j,$},yt.copy=function(C,M){return C[0]=M[0],C[1]=M[1],C[2]=M[2],C[3]=M[3],C},yt.set=function(C,M,R,j,$){return C[0]=M,C[1]=R,C[2]=j,C[3]=$,C},yt.add=function(C,M,R){return C[0]=M[0]+R[0],C[1]=M[1]+R[1],C[2]=M[2]+R[2],C[3]=M[3]+R[3],C},yt.subtract=f,yt.multiply=h,yt.divide=_,yt.ceil=function(C,M){return C[0]=Math.ceil(M[0]),C[1]=Math.ceil(M[1]),C[2]=Math.ceil(M[2]),C[3]=Math.ceil(M[3]),C},yt.floor=function(C,M){return C[0]=Math.floor(M[0]),C[1]=Math.floor(M[1]),C[2]=Math.floor(M[2]),C[3]=Math.floor(M[3]),C},yt.min=function(C,M,R){return C[0]=Math.min(M[0],R[0]),C[1]=Math.min(M[1],R[1]),C[2]=Math.min(M[2],R[2]),C[3]=Math.min(M[3],R[3]),C},yt.max=function(C,M,R){return C[0]=Math.max(M[0],R[0]),C[1]=Math.max(M[1],R[1]),C[2]=Math.max(M[2],R[2]),C[3]=Math.max(M[3],R[3]),C},yt.round=function(C,M){return C[0]=Math.round(M[0]),C[1]=Math.round(M[1]),C[2]=Math.round(M[2]),C[3]=Math.round(M[3]),C},yt.scale=function(C,M,R){return C[0]=M[0]*R,C[1]=M[1]*R,C[2]=M[2]*R,C[3]=M[3]*R,C},yt.scaleAndAdd=function(C,M,R,j){return C[0]=M[0]+R[0]*j,C[1]=M[1]+R[1]*j,C[2]=M[2]+R[2]*j,C[3]=M[3]+R[3]*j,C},yt.distance=w,yt.squaredDistance=T,yt.length=P,yt.squaredLength=x,yt.negate=function(C,M){return C[0]=-M[0],C[1]=-M[1],C[2]=-M[2],C[3]=-M[3],C},yt.inverse=function(C,M){return C[0]=1/M[0],C[1]=1/M[1],C[2]=1/M[2],C[3]=1/M[3],C},yt.normalize=function(C,M){var R=M[0],j=M[1],$=M[2],Y=M[3],X=R*R+j*j+$*$+Y*Y;return X>0&&(X=1/Math.sqrt(X)),C[0]=R*X,C[1]=j*X,C[2]=$*X,C[3]=Y*X,C},yt.dot=function(C,M){return C[0]*M[0]+C[1]*M[1]+C[2]*M[2]+C[3]*M[3]},yt.cross=function(C,M,R,j){var $=R[0]*j[1]-R[1]*j[0],Y=R[0]*j[2]-R[2]*j[0],X=R[0]*j[3]-R[3]*j[0],Z=R[1]*j[2]-R[2]*j[1],re=R[1]*j[3]-R[3]*j[1],ae=R[2]*j[3]-R[3]*j[2],ue=M[0],Ce=M[1],we=M[2],Se=M[3];return C[0]=Ce*ae-we*re+Se*Z,C[1]=-ue*ae+we*X-Se*Y,C[2]=ue*re-Ce*X+Se*$,C[3]=-ue*Z+Ce*Y-we*$,C},yt.lerp=function(C,M,R,j){var $=M[0],Y=M[1],X=M[2],Z=M[3];return C[0]=$+j*(R[0]-$),C[1]=Y+j*(R[1]-Y),C[2]=X+j*(R[2]-X),C[3]=Z+j*(R[3]-Z),C},yt.random=function(C,M){var R,j,$,Y,X,Z;M=M||1;do X=(R=2*n.RANDOM()-1)*R+(j=2*n.RANDOM()-1)*j;while(X>=1);do Z=($=2*n.RANDOM()-1)*$+(Y=2*n.RANDOM()-1)*Y;while(Z>=1);var re=Math.sqrt((1-X)/Z);return C[0]=M*R,C[1]=M*j,C[2]=M*$*re,C[3]=M*Y*re,C},yt.transformMat4=function(C,M,R){var j=M[0],$=M[1],Y=M[2],X=M[3];return C[0]=R[0]*j+R[4]*$+R[8]*Y+R[12]*X,C[1]=R[1]*j+R[5]*$+R[9]*Y+R[13]*X,C[2]=R[2]*j+R[6]*$+R[10]*Y+R[14]*X,C[3]=R[3]*j+R[7]*$+R[11]*Y+R[15]*X,C},yt.transformQuat=function(C,M,R){var j=M[0],$=M[1],Y=M[2],X=R[0],Z=R[1],re=R[2],ae=R[3],ue=ae*j+Z*Y-re*$,Ce=ae*$+re*j-X*Y,we=ae*Y+X*$-Z*j,Se=-X*j-Z*$-re*Y;return C[0]=ue*ae+Se*-X+Ce*-re-we*-Z,C[1]=Ce*ae+Se*-Z+we*-X-ue*-re,C[2]=we*ae+Se*-re+ue*-Z-Ce*-X,C[3]=M[3],C},yt.zero=function(C){return C[0]=0,C[1]=0,C[2]=0,C[3]=0,C},yt.str=function(C){return"vec4("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+")"},yt.exactEquals=function(C,M){return C[0]===M[0]&&C[1]===M[1]&&C[2]===M[2]&&C[3]===M[3]},yt.equals=function(C,M){var R=C[0],j=C[1],$=C[2],Y=C[3],X=M[0],Z=M[1],re=M[2],ae=M[3];return Math.abs(R-X)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(X))&&Math.abs(j-Z)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(Z))&&Math.abs($-re)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(re))&&Math.abs(Y-ae)<=n.EPSILON*Math.max(1,Math.abs(Y),Math.abs(ae))},yt.forEach=yt.sqrLen=yt.len=yt.sqrDist=yt.dist=yt.div=yt.mul=yt.sub=void 0;var n=function(C,M){if(C&&C.__esModule)return C;if(C===null||c(C)!=="object"&&typeof C!="function")return{default:C};var R=o(void 0);if(R&&R.has(C))return R.get(C);var j={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Y in C)if(Y!=="default"&&Object.prototype.hasOwnProperty.call(C,Y)){var X=$?Object.getOwnPropertyDescriptor(C,Y):null;X&&(X.get||X.set)?Object.defineProperty(j,Y,X):j[Y]=C[Y]}return j.default=C,R&&R.set(C,j),j}(G());function o(C){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(o=function(j){return j?R:M})(C)}function u(){var C=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[3]=0),C}function f(C,M,R){return C[0]=M[0]-R[0],C[1]=M[1]-R[1],C[2]=M[2]-R[2],C[3]=M[3]-R[3],C}function h(C,M,R){return C[0]=M[0]*R[0],C[1]=M[1]*R[1],C[2]=M[2]*R[2],C[3]=M[3]*R[3],C}function _(C,M,R){return C[0]=M[0]/R[0],C[1]=M[1]/R[1],C[2]=M[2]/R[2],C[3]=M[3]/R[3],C}function w(C,M){return Math.hypot(M[0]-C[0],M[1]-C[1],M[2]-C[2],M[3]-C[3])}function T(C,M){var R=M[0]-C[0],j=M[1]-C[1],$=M[2]-C[2],Y=M[3]-C[3];return R*R+j*j+$*$+Y*Y}function P(C){return Math.hypot(C[0],C[1],C[2],C[3])}function x(C){var M=C[0],R=C[1],j=C[2],$=C[3];return M*M+R*R+j*j+$*$}yt.sub=f,yt.mul=h,yt.div=_,yt.dist=w,yt.sqrDist=T,yt.len=P,yt.sqrLen=x;var A,I=(A=u(),function(C,M,R,j,$,Y){var X,Z;for(M||(M=4),R||(R=0),Z=j?Math.min(j*M+R,C.length):C.length,X=R;X<Z;X+=M)A[0]=C[X],A[1]=C[X+1],A[2]=C[X+2],A[3]=C[X+3],$(A,A,Y),C[X]=A[0],C[X+1]=A[1],C[X+2]=A[2],C[X+3]=A[3];return C});return yt.forEach=I,yt}function jt(){if(Je)return ot;function c(Pe){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(We){return typeof We}:function(We){return We&&typeof Symbol=="function"&&We.constructor===Symbol&&We!==Symbol.prototype?"symbol":typeof We},c(Pe)}Je=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.create=w,ot.identity=function(Pe){return Pe[0]=0,Pe[1]=0,Pe[2]=0,Pe[3]=1,Pe},ot.setAxisAngle=T,ot.getAxisAngle=function(Pe,We){var st=2*Math.acos(We[3]),tt=Math.sin(st/2);return tt>n.EPSILON?(Pe[0]=We[0]/tt,Pe[1]=We[1]/tt,Pe[2]=We[2]/tt):(Pe[0]=1,Pe[1]=0,Pe[2]=0),st},ot.getAngle=function(Pe,We){var st=R(Pe,We);return Math.acos(2*st*st-1)},ot.multiply=P,ot.rotateX=function(Pe,We,st){st*=.5;var tt=We[0],ft=We[1],ht=We[2],bt=We[3],gt=Math.sin(st),At=Math.cos(st);return Pe[0]=tt*At+bt*gt,Pe[1]=ft*At+ht*gt,Pe[2]=ht*At-ft*gt,Pe[3]=bt*At-tt*gt,Pe},ot.rotateY=function(Pe,We,st){st*=.5;var tt=We[0],ft=We[1],ht=We[2],bt=We[3],gt=Math.sin(st),At=Math.cos(st);return Pe[0]=tt*At-ht*gt,Pe[1]=ft*At+bt*gt,Pe[2]=ht*At+tt*gt,Pe[3]=bt*At-ft*gt,Pe},ot.rotateZ=function(Pe,We,st){st*=.5;var tt=We[0],ft=We[1],ht=We[2],bt=We[3],gt=Math.sin(st),At=Math.cos(st);return Pe[0]=tt*At+ft*gt,Pe[1]=ft*At-tt*gt,Pe[2]=ht*At+bt*gt,Pe[3]=bt*At-ht*gt,Pe},ot.calculateW=function(Pe,We){var st=We[0],tt=We[1],ft=We[2];return Pe[0]=st,Pe[1]=tt,Pe[2]=ft,Pe[3]=Math.sqrt(Math.abs(1-st*st-tt*tt-ft*ft)),Pe},ot.exp=x,ot.ln=A,ot.pow=function(Pe,We,st){return A(Pe,We),M(Pe,Pe,st),x(Pe,Pe),Pe},ot.slerp=I,ot.random=function(Pe){var We=n.RANDOM(),st=n.RANDOM(),tt=n.RANDOM(),ft=Math.sqrt(1-We),ht=Math.sqrt(We);return Pe[0]=ft*Math.sin(2*Math.PI*st),Pe[1]=ft*Math.cos(2*Math.PI*st),Pe[2]=ht*Math.sin(2*Math.PI*tt),Pe[3]=ht*Math.cos(2*Math.PI*tt),Pe},ot.invert=function(Pe,We){var st=We[0],tt=We[1],ft=We[2],ht=We[3],bt=st*st+tt*tt+ft*ft+ht*ht,gt=bt?1/bt:0;return Pe[0]=-st*gt,Pe[1]=-tt*gt,Pe[2]=-ft*gt,Pe[3]=ht*gt,Pe},ot.conjugate=function(Pe,We){return Pe[0]=-We[0],Pe[1]=-We[1],Pe[2]=-We[2],Pe[3]=We[3],Pe},ot.fromMat3=C,ot.fromEuler=function(Pe,We,st,tt){var ft=.5*Math.PI/180;We*=ft,st*=ft,tt*=ft;var ht=Math.sin(We),bt=Math.cos(We),gt=Math.sin(st),At=Math.cos(st),en=Math.sin(tt),Jt=Math.cos(tt);return Pe[0]=ht*At*Jt-bt*gt*en,Pe[1]=bt*gt*Jt+ht*At*en,Pe[2]=bt*At*en-ht*gt*Jt,Pe[3]=bt*At*Jt+ht*gt*en,Pe},ot.str=function(Pe){return"quat("+Pe[0]+", "+Pe[1]+", "+Pe[2]+", "+Pe[3]+")"},ot.setAxes=ot.sqlerp=ot.rotationTo=ot.equals=ot.exactEquals=ot.normalize=ot.sqrLen=ot.squaredLength=ot.len=ot.length=ot.lerp=ot.dot=ot.scale=ot.mul=ot.add=ot.set=ot.copy=ot.fromValues=ot.clone=void 0;var n=_(G()),o=_(Ne()),u=_(Le()),f=_(St());function h(Pe){if(typeof WeakMap!="function")return null;var We=new WeakMap,st=new WeakMap;return(h=function(tt){return tt?st:We})(Pe)}function _(Pe,We){if(Pe&&Pe.__esModule)return Pe;if(Pe===null||c(Pe)!=="object"&&typeof Pe!="function")return{default:Pe};var st=h(We);if(st&&st.has(Pe))return st.get(Pe);var tt={},ft=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ht in Pe)if(ht!=="default"&&Object.prototype.hasOwnProperty.call(Pe,ht)){var bt=ft?Object.getOwnPropertyDescriptor(Pe,ht):null;bt&&(bt.get||bt.set)?Object.defineProperty(tt,ht,bt):tt[ht]=Pe[ht]}return tt.default=Pe,st&&st.set(Pe,tt),tt}function w(){var Pe=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(Pe[0]=0,Pe[1]=0,Pe[2]=0),Pe[3]=1,Pe}function T(Pe,We,st){st*=.5;var tt=Math.sin(st);return Pe[0]=tt*We[0],Pe[1]=tt*We[1],Pe[2]=tt*We[2],Pe[3]=Math.cos(st),Pe}function P(Pe,We,st){var tt=We[0],ft=We[1],ht=We[2],bt=We[3],gt=st[0],At=st[1],en=st[2],Jt=st[3];return Pe[0]=tt*Jt+bt*gt+ft*en-ht*At,Pe[1]=ft*Jt+bt*At+ht*gt-tt*en,Pe[2]=ht*Jt+bt*en+tt*At-ft*gt,Pe[3]=bt*Jt-tt*gt-ft*At-ht*en,Pe}function x(Pe,We){var st=We[0],tt=We[1],ft=We[2],ht=We[3],bt=Math.sqrt(st*st+tt*tt+ft*ft),gt=Math.exp(ht),At=bt>0?gt*Math.sin(bt)/bt:0;return Pe[0]=st*At,Pe[1]=tt*At,Pe[2]=ft*At,Pe[3]=gt*Math.cos(bt),Pe}function A(Pe,We){var st=We[0],tt=We[1],ft=We[2],ht=We[3],bt=Math.sqrt(st*st+tt*tt+ft*ft),gt=bt>0?Math.atan2(bt,ht)/bt:0;return Pe[0]=st*gt,Pe[1]=tt*gt,Pe[2]=ft*gt,Pe[3]=.5*Math.log(st*st+tt*tt+ft*ft+ht*ht),Pe}function I(Pe,We,st,tt){var ft,ht,bt,gt,At,en=We[0],Jt=We[1],An=We[2],on=We[3],hn=st[0],rn=st[1],jn=st[2],Sn=st[3];return(ht=en*hn+Jt*rn+An*jn+on*Sn)<0&&(ht=-ht,hn=-hn,rn=-rn,jn=-jn,Sn=-Sn),1-ht>n.EPSILON?(ft=Math.acos(ht),bt=Math.sin(ft),gt=Math.sin((1-tt)*ft)/bt,At=Math.sin(tt*ft)/bt):(gt=1-tt,At=tt),Pe[0]=gt*en+At*hn,Pe[1]=gt*Jt+At*rn,Pe[2]=gt*An+At*jn,Pe[3]=gt*on+At*Sn,Pe}function C(Pe,We){var st,tt=We[0]+We[4]+We[8];if(tt>0)st=Math.sqrt(tt+1),Pe[3]=.5*st,Pe[0]=(We[5]-We[7])*(st=.5/st),Pe[1]=(We[6]-We[2])*st,Pe[2]=(We[1]-We[3])*st;else{var ft=0;We[4]>We[0]&&(ft=1),We[8]>We[3*ft+ft]&&(ft=2);var ht=(ft+1)%3,bt=(ft+2)%3;st=Math.sqrt(We[3*ft+ft]-We[3*ht+ht]-We[3*bt+bt]+1),Pe[ft]=.5*st,Pe[3]=(We[3*ht+bt]-We[3*bt+ht])*(st=.5/st),Pe[ht]=(We[3*ht+ft]+We[3*ft+ht])*st,Pe[bt]=(We[3*bt+ft]+We[3*ft+bt])*st}return Pe}ot.clone=f.clone,ot.fromValues=f.fromValues,ot.copy=f.copy,ot.set=f.set,ot.add=f.add,ot.mul=P;var M=f.scale;ot.scale=M;var R=f.dot;ot.dot=R,ot.lerp=f.lerp;var j=f.length;ot.length=j,ot.len=j;var $=f.squaredLength;ot.squaredLength=$,ot.sqrLen=$;var Y=f.normalize;ot.normalize=Y,ot.exactEquals=f.exactEquals,ot.equals=f.equals;var X,Z,re,ae=(X=u.create(),Z=u.fromValues(1,0,0),re=u.fromValues(0,1,0),function(Pe,We,st){var tt=u.dot(We,st);return tt<-.999999?(u.cross(X,Z,We),u.len(X)<1e-6&&u.cross(X,re,We),u.normalize(X,X),T(Pe,X,Math.PI),Pe):tt>.999999?(Pe[0]=0,Pe[1]=0,Pe[2]=0,Pe[3]=1,Pe):(u.cross(X,We,st),Pe[0]=X[0],Pe[1]=X[1],Pe[2]=X[2],Pe[3]=1+tt,Y(Pe,Pe))});ot.rotationTo=ae;var ue,Ce,we=(ue=w(),Ce=w(),function(Pe,We,st,tt,ft,ht){return I(ue,We,ft,ht),I(Ce,st,tt,ht),I(Pe,ue,Ce,2*ht*(1-ht)),Pe});ot.sqlerp=we;var Se,He=(Se=o.create(),function(Pe,We,st,tt){return Se[0]=st[0],Se[3]=st[1],Se[6]=st[2],Se[1]=tt[0],Se[4]=tt[1],Se[7]=tt[2],Se[2]=-We[0],Se[5]=-We[1],Se[8]=-We[2],Y(Pe,C(Pe,Se))});return ot.setAxes=He,ot}var et,Qe={};function Xe(){if(et)return Qe;function c(I){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(I)}et=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.create=function(){var I=new n.ARRAY_TYPE(8);return n.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},Qe.clone=function(I){var C=new n.ARRAY_TYPE(8);return C[0]=I[0],C[1]=I[1],C[2]=I[2],C[3]=I[3],C[4]=I[4],C[5]=I[5],C[6]=I[6],C[7]=I[7],C},Qe.fromValues=function(I,C,M,R,j,$,Y,X){var Z=new n.ARRAY_TYPE(8);return Z[0]=I,Z[1]=C,Z[2]=M,Z[3]=R,Z[4]=j,Z[5]=$,Z[6]=Y,Z[7]=X,Z},Qe.fromRotationTranslationValues=function(I,C,M,R,j,$,Y){var X=new n.ARRAY_TYPE(8);X[0]=I,X[1]=C,X[2]=M,X[3]=R;var Z=.5*j,re=.5*$,ae=.5*Y;return X[4]=Z*R+re*M-ae*C,X[5]=re*R+ae*I-Z*M,X[6]=ae*R+Z*C-re*I,X[7]=-Z*I-re*C-ae*M,X},Qe.fromRotationTranslation=_,Qe.fromTranslation=function(I,C){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*C[0],I[5]=.5*C[1],I[6]=.5*C[2],I[7]=0,I},Qe.fromRotation=function(I,C){return I[0]=C[0],I[1]=C[1],I[2]=C[2],I[3]=C[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},Qe.fromMat4=function(I,C){var M=o.create();u.getRotation(M,C);var R=new n.ARRAY_TYPE(3);return u.getTranslation(R,C),_(I,M,R),I},Qe.copy=w,Qe.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},Qe.set=function(I,C,M,R,j,$,Y,X,Z){return I[0]=C,I[1]=M,I[2]=R,I[3]=j,I[4]=$,I[5]=Y,I[6]=X,I[7]=Z,I},Qe.getDual=function(I,C){return I[0]=C[4],I[1]=C[5],I[2]=C[6],I[3]=C[7],I},Qe.setDual=function(I,C){return I[4]=C[0],I[5]=C[1],I[6]=C[2],I[7]=C[3],I},Qe.getTranslation=function(I,C){var M=C[4],R=C[5],j=C[6],$=C[7],Y=-C[0],X=-C[1],Z=-C[2],re=C[3];return I[0]=2*(M*re+$*Y+R*Z-j*X),I[1]=2*(R*re+$*X+j*Y-M*Z),I[2]=2*(j*re+$*Z+M*X-R*Y),I},Qe.translate=function(I,C,M){var R=C[0],j=C[1],$=C[2],Y=C[3],X=.5*M[0],Z=.5*M[1],re=.5*M[2],ae=C[4],ue=C[5],Ce=C[6],we=C[7];return I[0]=R,I[1]=j,I[2]=$,I[3]=Y,I[4]=Y*X+j*re-$*Z+ae,I[5]=Y*Z+$*X-R*re+ue,I[6]=Y*re+R*Z-j*X+Ce,I[7]=-R*X-j*Z-$*re+we,I},Qe.rotateX=function(I,C,M){var R=-C[0],j=-C[1],$=-C[2],Y=C[3],X=C[4],Z=C[5],re=C[6],ae=C[7],ue=X*Y+ae*R+Z*$-re*j,Ce=Z*Y+ae*j+re*R-X*$,we=re*Y+ae*$+X*j-Z*R,Se=ae*Y-X*R-Z*j-re*$;return o.rotateX(I,C,M),I[4]=ue*(Y=I[3])+Se*(R=I[0])+Ce*($=I[2])-we*(j=I[1]),I[5]=Ce*Y+Se*j+we*R-ue*$,I[6]=we*Y+Se*$+ue*j-Ce*R,I[7]=Se*Y-ue*R-Ce*j-we*$,I},Qe.rotateY=function(I,C,M){var R=-C[0],j=-C[1],$=-C[2],Y=C[3],X=C[4],Z=C[5],re=C[6],ae=C[7],ue=X*Y+ae*R+Z*$-re*j,Ce=Z*Y+ae*j+re*R-X*$,we=re*Y+ae*$+X*j-Z*R,Se=ae*Y-X*R-Z*j-re*$;return o.rotateY(I,C,M),I[4]=ue*(Y=I[3])+Se*(R=I[0])+Ce*($=I[2])-we*(j=I[1]),I[5]=Ce*Y+Se*j+we*R-ue*$,I[6]=we*Y+Se*$+ue*j-Ce*R,I[7]=Se*Y-ue*R-Ce*j-we*$,I},Qe.rotateZ=function(I,C,M){var R=-C[0],j=-C[1],$=-C[2],Y=C[3],X=C[4],Z=C[5],re=C[6],ae=C[7],ue=X*Y+ae*R+Z*$-re*j,Ce=Z*Y+ae*j+re*R-X*$,we=re*Y+ae*$+X*j-Z*R,Se=ae*Y-X*R-Z*j-re*$;return o.rotateZ(I,C,M),I[4]=ue*(Y=I[3])+Se*(R=I[0])+Ce*($=I[2])-we*(j=I[1]),I[5]=Ce*Y+Se*j+we*R-ue*$,I[6]=we*Y+Se*$+ue*j-Ce*R,I[7]=Se*Y-ue*R-Ce*j-we*$,I},Qe.rotateByQuatAppend=function(I,C,M){var R=M[0],j=M[1],$=M[2],Y=M[3],X=C[0],Z=C[1],re=C[2],ae=C[3];return I[0]=X*Y+ae*R+Z*$-re*j,I[1]=Z*Y+ae*j+re*R-X*$,I[2]=re*Y+ae*$+X*j-Z*R,I[3]=ae*Y-X*R-Z*j-re*$,I[4]=(X=C[4])*Y+(ae=C[7])*R+(Z=C[5])*$-(re=C[6])*j,I[5]=Z*Y+ae*j+re*R-X*$,I[6]=re*Y+ae*$+X*j-Z*R,I[7]=ae*Y-X*R-Z*j-re*$,I},Qe.rotateByQuatPrepend=function(I,C,M){var R=C[0],j=C[1],$=C[2],Y=C[3],X=M[0],Z=M[1],re=M[2],ae=M[3];return I[0]=R*ae+Y*X+j*re-$*Z,I[1]=j*ae+Y*Z+$*X-R*re,I[2]=$*ae+Y*re+R*Z-j*X,I[3]=Y*ae-R*X-j*Z-$*re,I[4]=R*(ae=M[7])+Y*(X=M[4])+j*(re=M[6])-$*(Z=M[5]),I[5]=j*ae+Y*Z+$*X-R*re,I[6]=$*ae+Y*re+R*Z-j*X,I[7]=Y*ae-R*X-j*Z-$*re,I},Qe.rotateAroundAxis=function(I,C,M,R){if(Math.abs(R)<n.EPSILON)return w(I,C);var j=Math.hypot(M[0],M[1],M[2]);R*=.5;var $=Math.sin(R),Y=$*M[0]/j,X=$*M[1]/j,Z=$*M[2]/j,re=Math.cos(R),ae=C[0],ue=C[1],Ce=C[2],we=C[3];I[0]=ae*re+we*Y+ue*Z-Ce*X,I[1]=ue*re+we*X+Ce*Y-ae*Z,I[2]=Ce*re+we*Z+ae*X-ue*Y,I[3]=we*re-ae*Y-ue*X-Ce*Z;var Se=C[4],He=C[5],Pe=C[6],We=C[7];return I[4]=Se*re+We*Y+He*Z-Pe*X,I[5]=He*re+We*X+Pe*Y-Se*Z,I[6]=Pe*re+We*Z+Se*X-He*Y,I[7]=We*re-Se*Y-He*X-Pe*Z,I},Qe.add=function(I,C,M){return I[0]=C[0]+M[0],I[1]=C[1]+M[1],I[2]=C[2]+M[2],I[3]=C[3]+M[3],I[4]=C[4]+M[4],I[5]=C[5]+M[5],I[6]=C[6]+M[6],I[7]=C[7]+M[7],I},Qe.multiply=T,Qe.scale=function(I,C,M){return I[0]=C[0]*M,I[1]=C[1]*M,I[2]=C[2]*M,I[3]=C[3]*M,I[4]=C[4]*M,I[5]=C[5]*M,I[6]=C[6]*M,I[7]=C[7]*M,I},Qe.lerp=function(I,C,M,R){var j=1-R;return P(C,M)<0&&(R=-R),I[0]=C[0]*j+M[0]*R,I[1]=C[1]*j+M[1]*R,I[2]=C[2]*j+M[2]*R,I[3]=C[3]*j+M[3]*R,I[4]=C[4]*j+M[4]*R,I[5]=C[5]*j+M[5]*R,I[6]=C[6]*j+M[6]*R,I[7]=C[7]*j+M[7]*R,I},Qe.invert=function(I,C){var M=A(C);return I[0]=-C[0]/M,I[1]=-C[1]/M,I[2]=-C[2]/M,I[3]=C[3]/M,I[4]=-C[4]/M,I[5]=-C[5]/M,I[6]=-C[6]/M,I[7]=C[7]/M,I},Qe.conjugate=function(I,C){return I[0]=-C[0],I[1]=-C[1],I[2]=-C[2],I[3]=C[3],I[4]=-C[4],I[5]=-C[5],I[6]=-C[6],I[7]=C[7],I},Qe.normalize=function(I,C){var M=A(C);if(M>0){M=Math.sqrt(M);var R=C[0]/M,j=C[1]/M,$=C[2]/M,Y=C[3]/M,X=C[4],Z=C[5],re=C[6],ae=C[7],ue=R*X+j*Z+$*re+Y*ae;I[0]=R,I[1]=j,I[2]=$,I[3]=Y,I[4]=(X-R*ue)/M,I[5]=(Z-j*ue)/M,I[6]=(re-$*ue)/M,I[7]=(ae-Y*ue)/M}return I},Qe.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},Qe.exactEquals=function(I,C){return I[0]===C[0]&&I[1]===C[1]&&I[2]===C[2]&&I[3]===C[3]&&I[4]===C[4]&&I[5]===C[5]&&I[6]===C[6]&&I[7]===C[7]},Qe.equals=function(I,C){var M=I[0],R=I[1],j=I[2],$=I[3],Y=I[4],X=I[5],Z=I[6],re=I[7],ae=C[0],ue=C[1],Ce=C[2],we=C[3],Se=C[4],He=C[5],Pe=C[6],We=C[7];return Math.abs(M-ae)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(ae))&&Math.abs(R-ue)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(ue))&&Math.abs(j-Ce)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ce))&&Math.abs($-we)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(we))&&Math.abs(Y-Se)<=n.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Se))&&Math.abs(X-He)<=n.EPSILON*Math.max(1,Math.abs(X),Math.abs(He))&&Math.abs(Z-Pe)<=n.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Pe))&&Math.abs(re-We)<=n.EPSILON*Math.max(1,Math.abs(re),Math.abs(We))},Qe.sqrLen=Qe.squaredLength=Qe.len=Qe.length=Qe.dot=Qe.mul=Qe.setReal=Qe.getReal=void 0;var n=h(G()),o=h(jt()),u=h(Me());function f(I){if(typeof WeakMap!="function")return null;var C=new WeakMap,M=new WeakMap;return(f=function(R){return R?M:C})(I)}function h(I,C){if(I&&I.__esModule)return I;if(I===null||c(I)!=="object"&&typeof I!="function")return{default:I};var M=f(C);if(M&&M.has(I))return M.get(I);var R={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var $ in I)if($!=="default"&&Object.prototype.hasOwnProperty.call(I,$)){var Y=j?Object.getOwnPropertyDescriptor(I,$):null;Y&&(Y.get||Y.set)?Object.defineProperty(R,$,Y):R[$]=I[$]}return R.default=I,M&&M.set(I,R),R}function _(I,C,M){var R=.5*M[0],j=.5*M[1],$=.5*M[2],Y=C[0],X=C[1],Z=C[2],re=C[3];return I[0]=Y,I[1]=X,I[2]=Z,I[3]=re,I[4]=R*re+j*Z-$*X,I[5]=j*re+$*Y-R*Z,I[6]=$*re+R*X-j*Y,I[7]=-R*Y-j*X-$*Z,I}function w(I,C){return I[0]=C[0],I[1]=C[1],I[2]=C[2],I[3]=C[3],I[4]=C[4],I[5]=C[5],I[6]=C[6],I[7]=C[7],I}function T(I,C,M){var R=C[0],j=C[1],$=C[2],Y=C[3],X=M[4],Z=M[5],re=M[6],ae=M[7],ue=C[4],Ce=C[5],we=C[6],Se=C[7],He=M[0],Pe=M[1],We=M[2],st=M[3];return I[0]=R*st+Y*He+j*We-$*Pe,I[1]=j*st+Y*Pe+$*He-R*We,I[2]=$*st+Y*We+R*Pe-j*He,I[3]=Y*st-R*He-j*Pe-$*We,I[4]=R*ae+Y*X+j*re-$*Z+ue*st+Se*He+Ce*We-we*Pe,I[5]=j*ae+Y*Z+$*X-R*re+Ce*st+Se*Pe+we*He-ue*We,I[6]=$*ae+Y*re+R*Z-j*X+we*st+Se*We+ue*Pe-Ce*He,I[7]=Y*ae-R*X-j*Z-$*re+Se*st-ue*He-Ce*Pe-we*We,I}Qe.getReal=o.copy,Qe.setReal=o.copy,Qe.mul=T;var P=o.dot;Qe.dot=P;var x=o.length;Qe.length=x,Qe.len=x;var A=o.squaredLength;return Qe.squaredLength=A,Qe.sqrLen=A,Qe}var Vt,be,Re={};function Fe(){if(Vt)return Re;function c(C){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(C)}Vt=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.create=u,Re.clone=function(C){var M=new n.ARRAY_TYPE(2);return M[0]=C[0],M[1]=C[1],M},Re.fromValues=function(C,M){var R=new n.ARRAY_TYPE(2);return R[0]=C,R[1]=M,R},Re.copy=function(C,M){return C[0]=M[0],C[1]=M[1],C},Re.set=function(C,M,R){return C[0]=M,C[1]=R,C},Re.add=function(C,M,R){return C[0]=M[0]+R[0],C[1]=M[1]+R[1],C},Re.subtract=f,Re.multiply=h,Re.divide=_,Re.ceil=function(C,M){return C[0]=Math.ceil(M[0]),C[1]=Math.ceil(M[1]),C},Re.floor=function(C,M){return C[0]=Math.floor(M[0]),C[1]=Math.floor(M[1]),C},Re.min=function(C,M,R){return C[0]=Math.min(M[0],R[0]),C[1]=Math.min(M[1],R[1]),C},Re.max=function(C,M,R){return C[0]=Math.max(M[0],R[0]),C[1]=Math.max(M[1],R[1]),C},Re.round=function(C,M){return C[0]=Math.round(M[0]),C[1]=Math.round(M[1]),C},Re.scale=function(C,M,R){return C[0]=M[0]*R,C[1]=M[1]*R,C},Re.scaleAndAdd=function(C,M,R,j){return C[0]=M[0]+R[0]*j,C[1]=M[1]+R[1]*j,C},Re.distance=w,Re.squaredDistance=T,Re.length=P,Re.squaredLength=x,Re.negate=function(C,M){return C[0]=-M[0],C[1]=-M[1],C},Re.inverse=function(C,M){return C[0]=1/M[0],C[1]=1/M[1],C},Re.normalize=function(C,M){var R=M[0],j=M[1],$=R*R+j*j;return $>0&&($=1/Math.sqrt($)),C[0]=M[0]*$,C[1]=M[1]*$,C},Re.dot=function(C,M){return C[0]*M[0]+C[1]*M[1]},Re.cross=function(C,M,R){var j=M[0]*R[1]-M[1]*R[0];return C[0]=C[1]=0,C[2]=j,C},Re.lerp=function(C,M,R,j){var $=M[0],Y=M[1];return C[0]=$+j*(R[0]-$),C[1]=Y+j*(R[1]-Y),C},Re.random=function(C,M){M=M||1;var R=2*n.RANDOM()*Math.PI;return C[0]=Math.cos(R)*M,C[1]=Math.sin(R)*M,C},Re.transformMat2=function(C,M,R){var j=M[0],$=M[1];return C[0]=R[0]*j+R[2]*$,C[1]=R[1]*j+R[3]*$,C},Re.transformMat2d=function(C,M,R){var j=M[0],$=M[1];return C[0]=R[0]*j+R[2]*$+R[4],C[1]=R[1]*j+R[3]*$+R[5],C},Re.transformMat3=function(C,M,R){var j=M[0],$=M[1];return C[0]=R[0]*j+R[3]*$+R[6],C[1]=R[1]*j+R[4]*$+R[7],C},Re.transformMat4=function(C,M,R){var j=M[0],$=M[1];return C[0]=R[0]*j+R[4]*$+R[12],C[1]=R[1]*j+R[5]*$+R[13],C},Re.rotate=function(C,M,R,j){var $=M[0]-R[0],Y=M[1]-R[1],X=Math.sin(j),Z=Math.cos(j);return C[0]=$*Z-Y*X+R[0],C[1]=$*X+Y*Z+R[1],C},Re.angle=function(C,M){var R=C[0],j=C[1],$=M[0],Y=M[1],X=Math.sqrt(R*R+j*j)*Math.sqrt($*$+Y*Y);return Math.acos(Math.min(Math.max(X&&(R*$+j*Y)/X,-1),1))},Re.zero=function(C){return C[0]=0,C[1]=0,C},Re.str=function(C){return"vec2("+C[0]+", "+C[1]+")"},Re.exactEquals=function(C,M){return C[0]===M[0]&&C[1]===M[1]},Re.equals=function(C,M){var R=C[0],j=C[1],$=M[0],Y=M[1];return Math.abs(R-$)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs($))&&Math.abs(j-Y)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(Y))},Re.forEach=Re.sqrLen=Re.sqrDist=Re.dist=Re.div=Re.mul=Re.sub=Re.len=void 0;var n=function(C,M){if(C&&C.__esModule)return C;if(C===null||c(C)!=="object"&&typeof C!="function")return{default:C};var R=o(void 0);if(R&&R.has(C))return R.get(C);var j={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Y in C)if(Y!=="default"&&Object.prototype.hasOwnProperty.call(C,Y)){var X=$?Object.getOwnPropertyDescriptor(C,Y):null;X&&(X.get||X.set)?Object.defineProperty(j,Y,X):j[Y]=C[Y]}return j.default=C,R&&R.set(C,j),j}(G());function o(C){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(o=function(j){return j?R:M})(C)}function u(){var C=new n.ARRAY_TYPE(2);return n.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0),C}function f(C,M,R){return C[0]=M[0]-R[0],C[1]=M[1]-R[1],C}function h(C,M,R){return C[0]=M[0]*R[0],C[1]=M[1]*R[1],C}function _(C,M,R){return C[0]=M[0]/R[0],C[1]=M[1]/R[1],C}function w(C,M){return Math.hypot(M[0]-C[0],M[1]-C[1])}function T(C,M){var R=M[0]-C[0],j=M[1]-C[1];return R*R+j*j}function P(C){return Math.hypot(C[0],C[1])}function x(C){var M=C[0],R=C[1];return M*M+R*R}Re.len=P,Re.sub=f,Re.mul=h,Re.div=_,Re.dist=w,Re.sqrDist=T,Re.sqrLen=x;var A,I=(A=u(),function(C,M,R,j,$,Y){var X,Z;for(M||(M=2),R||(R=0),Z=j?Math.min(j*M+R,C.length):C.length,X=R;X<Z;X+=M)A[0]=C[X],A[1]=C[X+1],$(A,A,Y),C[X]=A[0],C[X+1]=A[1];return C});return Re.forEach=I,Re}function ut(){if(be)return O;function c(C){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(C)}be=1,Object.defineProperty(O,"__esModule",{value:!0}),O.vec4=O.vec3=O.vec2=O.quat2=O.quat=O.mat4=O.mat3=O.mat2d=O.mat2=O.glMatrix=void 0;var n=I(G());O.glMatrix=n;var o=I(Q());O.mat2=o;var u=I(te());O.mat2d=u;var f=I(Ne());O.mat3=f;var h=I(Me());O.mat4=h;var _=I(jt());O.quat=_;var w=I(Xe());O.quat2=w;var T=I(Fe());O.vec2=T;var P=I(Le());O.vec3=P;var x=I(St());function A(C){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(A=function(j){return j?R:M})(C)}function I(C,M){if(C&&C.__esModule)return C;if(C===null||c(C)!=="object"&&typeof C!="function")return{default:C};var R=A(M);if(R&&R.has(C))return R.get(C);var j={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Y in C)if(Y!=="default"&&Object.prototype.hasOwnProperty.call(C,Y)){var X=$?Object.getOwnPropertyDescriptor(C,Y):null;X&&(X.get||X.set)?Object.defineProperty(j,Y,X):j[Y]=C[Y]}return j.default=C,R&&R.set(C,j),j}return O.vec4=x,O}var Et,Ct,Wt,Ft,me=ut(),dn=function(){if(Ct)return Et;function c(n,o,u,f){this.cx=3*n,this.bx=3*(u-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=o,this.p2x=u,this.p2y=f}return Ct=1,Et=c,c.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,o){if(o===void 0&&(o=1e-6),n<0)return 0;if(n>1)return 1;for(var u=n,f=0;f<8;f++){var h=this.sampleCurveX(u)-n;if(Math.abs(h)<o)return u;var _=this.sampleCurveDerivativeX(u);if(Math.abs(_)<1e-6)break;u-=h/_}var w=0,T=1;for(u=n,f=0;f<20&&(h=this.sampleCurveX(u),!(Math.abs(h-n)<o));f++)n>h?w=u:T=u,u=.5*(T-w)+w;return u},solve:function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))}},Et}(),Cn=E(dn);function On(){if(Ft)return Wt;function c(n,o){this.x=n,this.y=o}return Ft=1,Wt=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,o){return this.clone()._rotateAround(n,o)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var o=n.x-this.x,u=n.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,o){return Math.atan2(this.x*o-this.y*n,this.x*n+this.y*o)},_matMult:function(n){var o=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=o,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var o=Math.cos(n),u=Math.sin(n),f=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=f,this},_rotateAround:function(n,o){var u=Math.cos(n),f=Math.sin(n),h=o.y+f*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-f*(this.y-o.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(n){return n instanceof c?n:Array.isArray(n)?new c(n[0],n[1]):n},Wt}var $t=E(On());function cn(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let o=0;o<c.length;o++)if(!cn(c[o],n[o]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const o in c)if(!cn(c[o],n[o]))return!1;return!0}return c===n}const _t=Math.PI/180,yr=180/Math.PI;function En(c){return c*_t}function bn(c){return c*yr}const Fn=[[0,0],[1,0],[1,1],[0,1]];function Gn(c){if(c<=0)return 0;if(c>=1)return 1;const n=c*c,o=n*c;return 4*(c<.5?o:3*(c-n)+o-.75)}function Un(c,n,o,u){const f=new Cn(c,n,o,u);return function(h){return f.solve(h)}}const pr=Un(.25,.1,.25,1);function Ln(c,n,o){return Math.min(o,Math.max(n,c))}function br(c,n,o){return(o=Ln((o-c)/(n-c),0,1))*o*(3-2*o)}function Kr(c,n,o){const u=o-n,f=((c-n)%u+u)%u+n;return f===n?o:f}function hi(c,n,o){if(!c.length)return o(null,[]);let u=c.length;const f=new Array(c.length);let h=null;c.forEach((_,w)=>{n(_,(T,P)=>{T&&(h=T),f[w]=P,--u==0&&o(h,f)})})}function si(c,...n){for(const o of n)for(const u in o)c[u]=o[u];return c}let wr=1;function Ur(){return wr++}function Kn(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Hs(c,n){c.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function fi(c,n,o){const u={};for(const f in c)u[f]=n.call(this,c[f],f,c);return u}function xo(c,n,o){const u={};for(const f in c)n.call(this,c[f],f,c)&&(u[f]=c[f]);return u}function di(c){return Array.isArray(c)?c.map(di):typeof c=="object"&&c?fi(c,di):c}const Hi={};function pi(c){Hi[c]||(typeof console<"u"&&console.warn(c),Hi[c]=!0)}function lr(c,n,o){return(o.y-c.y)*(n.x-c.x)>(n.y-c.y)*(o.x-c.x)}function ml(c){let n=0;for(let o,u,f=0,h=c.length,_=h-1;f<h;_=f++)o=c[f],u=c[_],n+=(u.x-o.x)*(o.y+u.y);return n}function Yi([c,n,o]){const u=En(n+90),f=En(o);return{x:c*Math.cos(u)*Math.sin(f),y:c*Math.sin(u)*Math.sin(f),z:c*Math.cos(f),azimuthal:n,polar:o}}function as(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ho(c){const n={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,f,h)=>{const _=f||h;return n[u]=!_||_.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let ns=null;function Rr(c,n){return[c[4*n],c[4*n+1],c[4*n+2],c[4*n+3]]}function Ii(c,n,o,u){for(;n<o;){const f=n+o>>1;c[f]<u?n=f+1:o=f}return n}function $l(c,n,o,u){for(;n<o;){const f=n+o>>1;c[f]<=u?n=f+1:o=f}return n}function Rs(c){return c>0?1/(1.001-c):1+c}function Dt(c){return c>0?1-1/(1.001-c):-c}const he={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!he.API_URL)return null;try{const c=new URL(he.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function _e(c){return he.API_URL_REGEX.test(c)}function Oe(c){return he.API_SPRITE_REGEX.test(c)}let Ye,qe,at,wt,ct,Mt;function Nt(){return Ye==null&&(Ye=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ye}const Lt={now:()=>wt!==void 0?wt:performance.now(),setNow(c){wt=c},restoreNow(){wt=void 0},frame(c){const n=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(c,n=0){const{width:o,height:u}=c;ct||(ct=document.createElement("canvas"));const f=ct.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(o>ct.width||u>ct.height)&&(ct.width=o,ct.height=u),f.clearRect(-n,-n,o+2*n,u+2*n),f.drawImage(c,0,0,o,u),f.getImageData(-n,-n,o+2*n,u+2*n)},resolveURL:c=>(qe||(qe=document.createElement("a")),qe.href=c,qe.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(at==null&&(at=window.matchMedia("(prefers-reduced-motion: reduce)")),at.matches)},hasCanvasFingerprintNoise(){if(Mt!==void 0)return Mt;if(!Nt())return Mt=!1,!1;const c=new OffscreenCanvas(85,1),n=c.getContext("2d",{willReadFrequently:!0});let o=0;for(let f=0;f<c.width;++f)n.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,n.fillRect(f,0,1,1);const u=n.getImageData(0,0,c.width,c.height);o=0;for(let f=0;f<u.data.length;++f)if(f%4!=3&&o++!==u.data[f])return Mt=!0,!0;return Mt=!1,!1}};function sn(c,n){const o=c.indexOf("?");if(o<0)return`${c}?${new URLSearchParams(n).toString()}`;const u=new URLSearchParams(c.slice(o));for(const f in n)u.set(f,n[f]);return`${c.slice(0,o)}?${u.toString()}`}function pn(c,n={persistentParams:[]}){const o=c.indexOf("?");if(o<0)return c;const u=new URLSearchParams,f=new URLSearchParams(c.slice(o));for(const _ of n.persistentParams){const w=f.get(_);w&&u.set(_,w)}const h=u.toString();return`${c.slice(0,o)}${h.length>0?`?${h}`:""}`}const yn="mapbox-tiles";let $n=500,er=50;const or=["language","worldview","jobid"];let ur,li;function Si(){try{return caches}catch{}}function mr(){const c=Si();c&&ur==null&&(ur=c.open(yn))}let Vr=1/0;const Xr={supported:!1,testSupport:function(c){!ms&&Oi&&(to?fo(c):ti=c)}};let ti,Oi,ms=!1,to=!1;const No=typeof self<"u"?self:{};function fo(c){const n=c.createTexture();c.bindTexture(c.TEXTURE_2D,n);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Oi),c.isContextLost())return;Xr.supported=!0}catch{}c.deleteTexture(n),ms=!0}No.document&&(Oi=No.document.createElement("img"),Oi.onload=function(){ti&&fo(ti),ti=null,to=!0},Oi.onerror=function(){ms=!0,ti=null},Oi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const gs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(gs);class Ds extends Error{constructor(n,o,u){o===401&&_e(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const gl=as()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ua=function(c,n){if(!(/^file:/.test(o=c.url)||/^file:/.test(gl())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,f){const h=new AbortController,_=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:gl(),referrerPolicy:u.referrerPolicy,signal:h.signal});let w=!1,T=!1;const P=(x=_.url).indexOf("sku=")>0&&_e(x);var x;u.type==="json"&&_.headers.set("Accept","application/json");const A=(C,M,R)=>{if(T)return;if(C&&C.message!=="SecurityError"&&pi(C.toString()),M&&R)return I(M);const j=Date.now();fetch(_).then($=>{if($.ok){const Y=P?$.clone():null;return I($,Y,j)}return f(new Ds($.statusText,$.status,u.url))}).catch($=>{$.name!=="AbortError"&&f(new Error(`${$.message} ${u.url}`))})},I=(C,M,R)=>{(u.type==="arrayBuffer"?C.arrayBuffer():u.type==="json"?C.json():C.text()).then(j=>{T||(M&&R&&function($,Y,X){if(mr(),ur==null)return;const Z=Ho(Y.headers.get("Cache-Control")||"");if(Z["no-store"])return;const re={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((Ce,we)=>re.headers.set(we,Ce)),Z["max-age"]&&re.headers.set("Expires",new Date(X+1e3*Z["max-age"]).toUTCString());const ae=re.headers.get("Expires");if(!ae||new Date(ae).getTime()-X<42e4)return;let ue=pn($.url,{persistentParams:or});if(Y.status===206){const Ce=$.headers.get("Range");if(!Ce)return;re.status=200,ue=sn(ue,{range:Ce})}(function(Ce,we){if(li===void 0)try{new Response(new ReadableStream),li=!0}catch{li=!1}li?we(Ce.body):Ce.blob().then(we)})(Y,Ce=>{const we=new Response((Se=Y.status)!==200&&Se!==404&&[101,103,204,205,304].includes(Se)?null:Ce,re);var Se;mr(),ur!=null&&ur.then(He=>He.put(ue,we)).catch(He=>pi(He.message))})}(_,M,R),w=!0,f(null,j,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(j=>{T||f(new Error(j.message))})};return P?function(C,M){if(mr(),ur==null)return M(null);ur.then(R=>{let j=pn(C.url,{persistentParams:or});const $=C.headers.get("Range");$&&(j=sn(j,{range:$})),R.match(j).then(Y=>{const X=function(Z){if(!Z)return!1;const re=new Date(Z.headers.get("Expires")||0),ae=Ho(Z.headers.get("Cache-Control")||"");return re>Date.now()&&!ae["no-cache"]}(Y);R.delete(j),X&&R.put(j,Y.clone()),M(null,Y,X)}).catch(M)}).catch(M)}(_,A):A(null,null),{cancel:()=>{T=!0,w||h.abort()}}}(c,n);if(as()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,n,void 0,!0)}var o;return function(u,f){const h=new XMLHttpRequest;h.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const _ in u.headers)h.setRequestHeader(_,u.headers[_]);return u.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=u.credentials==="include",h.onerror=()=>{f(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let _=h.response;if(u.type==="json")try{_=JSON.parse(h.response)}catch(w){return f(w)}f(null,_,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else f(new Ds(h.statusText,h.status,u.url))},h.send(u.body),{cancel:()=>h.abort()}}(c,n)},Wi=function(c,n){return ua(si(c,{type:"arrayBuffer"}),n)};function yh(c){const n=document.createElement("a");return n.href=c,n.protocol===location.protocol&&n.host===location.host}const Eu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xc,Gl;Xc=[],Gl=0;const dd=function(c,n){if(Xr.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Gl>=he.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:c,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Xc.push(h),h}Gl++;let o=!1;const u=()=>{if(!o)for(o=!0,Gl--;Xc.length&&Gl<he.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Xc.shift(),{requestParameters:_,callback:w,cancelled:T}=h;T||(h.cancel=dd(_,w).cancel)}},f=Wi(c,(h,_,w,T)=>{u(),h?n(h):_&&(self.createImageBitmap?function(P,x){const A=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(A).then(I=>{x(null,I)}).catch(I=>{x(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(P,x)=>n(P,x,w,T)):function(P,x){const A=new Image;A.onload=()=>{x(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=Eu})},A.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(P)],{type:"image/png"});A.src=P.byteLength?URL.createObjectURL(I):Eu}(_,(P,x)=>n(P,x,w,T)))});return{cancel:()=>{f.cancel(),u()}}};var Ba,Cu,Oo,Hl={exports:{}},zo={exports:{}},Sa={exports:{}},_l=function(){if(Oo)return Hl.exports;Oo=1;var c=(Ba||(Ba=1,zo.exports=function(o,u){var f,h,_,w,T,P,x,A;for(h=o.length-(f=3&o.length),_=u,T=3432918353,P=461845907,A=0;A<h;)x=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24,++A,_=27492+(65535&(w=5*(65535&(_=(_^=x=(65535&(x=(x=(65535&x)*T+(((x>>>16)*T&65535)<<16)&4294967295)<<15|x>>>17))*P+(((x>>>16)*P&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(x=0,f){case 3:x^=(255&o.charCodeAt(A+2))<<16;case 2:x^=(255&o.charCodeAt(A+1))<<8;case 1:_^=x=(65535&(x=(x=(65535&(x^=255&o.charCodeAt(A)))*T+(((x>>>16)*T&65535)<<16)&4294967295)<<15|x>>>17))*P+(((x>>>16)*P&65535)<<16)&4294967295}return _^=o.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),zo.exports),n=(Cu||(Cu=1,Sa.exports=function(o,u){for(var f,h=o.length,_=u^h,w=0;h>=4;)f=1540483477*(65535&(f=255&o.charCodeAt(w)|(255&o.charCodeAt(++w))<<8|(255&o.charCodeAt(++w))<<16|(255&o.charCodeAt(++w))<<24))+((1540483477*(f>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),h-=4,++w;switch(h){case 3:_^=(255&o.charCodeAt(w+2))<<16;case 2:_^=(255&o.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&o.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Sa.exports);return Hl.exports=c,Hl.exports.murmur3=c,Hl.exports.murmur2=n,Hl.exports}(),Wo=E(_l);class bo{constructor(n,...o){si(this,o[0]||{}),this.type=n}}class Yc extends bo{constructor(n,o={}){super("error",si({error:n},o))}}function Pu(c,n,o){o[c]&&o[c].indexOf(n)!==-1||(o[c]=o[c]||[],o[c].push(n))}function vh(c,n,o){if(o&&o[c]){const u=o[c].indexOf(n);u!==-1&&o[c].splice(u,1)}}class Ta{on(n,o){return this._listeners=this._listeners||{},Pu(n,o,this._listeners),this}off(n,o){return vh(n,o,this._listeners),vh(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Pu(n,o,this._oneTimeListeners),this):new Promise(u=>{this.once(n,u)})}fire(n,o){const u=typeof n=="string"?new bo(n,o):n,f=u.type;if(this.listens(f)){u.target=this;const h=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of h)T.call(this,u);const _=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of _)vh(f,T,this._oneTimeListeners),T.call(this,u);const w=this._eventedParent;w&&(si(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(u))}else u instanceof Yc&&console.error(u.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}class wo{constructor(n){typeof n=="string"?this.name=n:(this.name=n.name,this.iconsetId=n.iconsetId)}static from(n){return new wo(n)}static toString(n){return n.iconsetId?`${n.name}${n.iconsetId}`:n.name}static parse(n){const[o,u]=n.split("");return new wo({name:o,iconsetId:u})}static isEqual(n,o){return n.name===o.name&&n.iconsetId===o.iconsetId}toString(){return wo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Wl,Jc={},So=function(){if(Wl)return Jc;Wl=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(h){return(h=Math.round(h))<0?0:h>255?255:h}function o(h){return n(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function u(h){return(_=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:_>1?1:_;var _}function f(h,_,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?h+(_-h)*w*6:2*w<1?_:3*w<2?h+(_-h)*(2/3-w)*6:h}try{Jc.parseCSSColor=function(h){var _,w=h.replace(/ /g,"").toLowerCase();if(w in c)return c[w].slice();if(w[0]==="#")return w.length===4?(_=parseInt(w.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:w.length===7&&(_=parseInt(w.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var T=w.indexOf("("),P=w.indexOf(")");if(T!==-1&&P+1===w.length){var x=w.substr(0,T),A=w.substr(T+1,P-(T+1)).split(","),I=1;switch(x){case"rgba":if(A.length!==4)return null;I=u(A.pop());case"rgb":return A.length!==3?null:[o(A[0]),o(A[1]),o(A[2]),I];case"hsla":if(A.length!==4)return null;I=u(A.pop());case"hsl":if(A.length!==3)return null;var C=(parseFloat(A[0])%360+360)%360/360,M=u(A[1]),R=u(A[2]),j=R<=.5?R*(M+1):R+M-R*M,$=2*R-j;return[n(255*f($,j,C+1/3)),n(255*f($,j,C)),n(255*f($,j,C-1/3)),I];default:return null}}return null}}catch{}return Jc}();class qr{constructor(n,o,u,f=1){this.r=n,this.g=o,this.b=u,this.a=f}static parse(n){if(!n)return;if(n instanceof qr)return n;if(typeof n!="string")return;const o=So.parseCSSColor(n);return o?new qr(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toStringPremultipliedAlpha(){const[n,o,u,f]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(u)},${f})`}toString(){const[n,o,u,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*n)},${Math.round(255*o)},${Math.round(255*u)},${f})`}toRenderColor(n){const{r:o,g:u,b:f,a:h}=this;return new po(n,o,u,f,h)}clone(){return new qr(this.r,this.g,this.b,this.a)}}class po{constructor(n,o,u,f,h){if(n){const _=n.image.height,w=_*_;o=h===0?0:o/h*(_-1),u=h===0?0:u/h*(_-1),f=h===0?0:f/h*(_-1);const T=Math.floor(o),P=Math.floor(u),x=Math.floor(f),A=Math.ceil(o),I=Math.ceil(u),C=Math.ceil(f),M=o-T,R=u-P,j=f-x,$=n.image.data,Y=4*(T+P*w+x*_),X=4*(T+P*w+C*_),Z=4*(T+I*w+x*_),re=4*(T+I*w+C*_),ae=4*(A+P*w+x*_),ue=4*(A+P*w+C*_),Ce=4*(A+I*w+x*_),we=4*(A+I*w+C*_);if(Y<0||we>=$.length)throw new Error("out of range");this.r=Bn(Bn(Bn($[Y],$[X],j),Bn($[Z],$[re],j),R),Bn(Bn($[ae],$[ue],j),Bn($[Ce],$[we],j),R),M)/255*h,this.g=Bn(Bn(Bn($[Y+1],$[X+1],j),Bn($[Z+1],$[re+1],j),R),Bn(Bn($[ae+1],$[ue+1],j),Bn($[Ce+1],$[we+1],j),R),M)/255*h,this.b=Bn(Bn(Bn($[Y+2],$[X+2],j),Bn($[Z+2],$[re+2],j),R),Bn(Bn($[ae+2],$[ue+2],j),Bn($[Ce+2],$[we+2],j),R),M)/255*h,this.a=h}else this.r=o,this.g=u,this.b=f,this.a=h}toArray(){const{r:n,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[255*n/f,255*o/f,255*u/f,f]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:n,g:o,b:u,a:f}=this,h=Math.min(Math.max(n/f,0),1),_=Math.min(Math.max(o/f,0),1),w=Math.min(Math.max(u/f,0),1),T=Math.min(h,_,w),P=Math.max(h,_,w),x=(T+P)/2;if(T===P)return[0,0,100*x,f];const A=P-T,I=x>.5?A/(2-P-T):A/(P+T);let C=0;return P===h?C=(_-w)/A+(_<w?6:0):P===_?C=(w-h)/A+2:P===w&&(C=(h-_)/A+4),C*=60,[Math.min(Math.max(C,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*x,0),100),f]}toArray01(){const{r:n,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[n/f,o/f,u/f,f]}toArray01Scaled(n){const{r:o,g:u,b:f,a:h}=this;return h===0?[0,0,0]:[o/h*n,u/h*n,f/h*n]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:u,a:f}=this;return[n,o,u,f]}toArray01Linear(){const{r:n,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[Math.pow(n/f,2.2),Math.pow(o/f,2.2),Math.pow(u/f,2.2),f]}}function Bn(c,n,o){return c*(1-o)+n*o}function fd(c,n,o){return c.map((u,f)=>Bn(u,n[f],o))}function $r(c){return c*c*c*c*c}qr.black=new qr(0,0,0,1),qr.white=new qr(1,1,1,1),qr.transparent=new qr(0,0,0,0),qr.red=new qr(1,0,0,1),qr.blue=new qr(0,0,1,1);var Mu=Object.freeze({__proto__:null,array:fd,color:function(c,n,o){return new qr(Bn(c.r,n.r,o),Bn(c.g,n.g,o),Bn(c.b,n.b,o),Bn(c.a,n.a,o))},easeIn:$r,number:Bn});function zr(c,...n){for(const o of n)for(const u in o)c[u]=o[u];return c}class Ns extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class Iu{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[u,f]of o)this.bindings[u]=f}concat(n){return new Iu(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const vc={kind:"null"},In={kind:"number"},Fr={kind:"string"},Dr={kind:"boolean"},no={kind:"color"},Qc={kind:"object"},Pr={kind:"value"},Zo={kind:"collator"},ja={kind:"formatted"},yl={kind:"resolvedImage"};function hs(c,n){return{kind:"array",itemType:c,N:n}}function Ui(c){if(c.kind==="array"){const n=Ui(c.itemType);return typeof c.N=="number"?`array<${n}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${n}>`}return c.kind}const Fo=[vc,In,Fr,Dr,no,ja,Qc,hs(Pr),yl];function xc(c,n){if(n.kind==="error")return null;if(c.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!xc(c.itemType,n.itemType))&&(typeof c.N!="number"||c.N===n.N))return null}else{if(c.kind===n.kind)return null;if(c.kind==="value"){for(const o of Fo)if(!xc(o,n))return null}}return`Expected ${Ui(c)} but found ${Ui(n)} instead.`}function xh(c,n){return n.some(o=>o.kind===c.kind)}function bc(c,n){return n.some(o=>o==="null"?c===null:o==="array"?Array.isArray(c):o==="object"?c&&!Array.isArray(c)&&typeof c=="object":o===typeof c)}class Lu{constructor(n,o,u){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ha{constructor(n,o,u,f,h){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=u,this.fontStack=f,this.textColor=h}}class ls{constructor(n){this.sections=n}static fromString(n){return new ls([new ha(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||!!n.image&&n.image.hasPrimary())}static factory(n){return n instanceof ls?n:ls.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){const f=o.image.getPrimary().id.toString();n.push(["image",f]);continue}n.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),n.push(u)}return n}}class Ua{constructor(n,o={}){if(this.id=wo.from(n),this.options=Object.assign({},o),o.transform){const{a:u,b:f,c:h,d:_,e:w,f:T}=o.transform;this.options.transform=new DOMMatrix([u,f,h,_,w,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:n,b:o,c:u,d:f,e:h,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:n,b:o,c:u,d:f,e:h,f:_}})}static parse(n){let o,u,f,h;try{({name:o,iconsetId:u,params:f,transform:h}=JSON.parse(n)||{})}catch{return null}if(!o)return null;const{a:_,b:w,c:T,d:P,e:x,f:A}=h||{};return new Ua({name:o,iconsetId:u},{params:f,transform:new DOMMatrix([_,w,T,P,x,A])})}scaleSelf(n){return this.options.transform.scaleSelf(n),this}}class ds{constructor(n,o,u,f,h=!1){this.primaryId=wo.from(n),this.primaryOptions=o,u&&(this.secondaryId=wo.from(u)),this.secondaryOptions=f,this.available=h}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ua(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ua(this.secondaryId,this.secondaryOptions):null}static from(n){return typeof n=="string"?ds.build({name:n}):n}static build(n,o,u,f){return!n||typeof n=="object"&&!("name"in n)?null:new ds(n,u,o,f)}}function Ko(c,n,o,u){return typeof c=="number"&&c>=0&&c<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,n,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,n,o,u]:[c,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xo(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof qr||c instanceof Lu||c instanceof ls||c instanceof ds)return!0;if(Array.isArray(c)){for(const n of c)if(!Xo(n))return!1;return!0}if(typeof c=="object"){for(const n in c)if(!Xo(c[n]))return!1;return!0}return!1}function Zi(c){if(c===null)return vc;if(typeof c=="string")return Fr;if(typeof c=="boolean")return Dr;if(typeof c=="number")return In;if(c instanceof qr)return no;if(c instanceof Lu)return Zo;if(c instanceof ls)return ja;if(c instanceof ds)return yl;if(Array.isArray(c)){const n=c.length;let o;for(const u of c){const f=Zi(u);if(o){if(o===f)continue;o=Pr;break}o=f}return hs(o||Pr,n)}return Qc}function As(c){const n=typeof c;return c===null?"":n==="string"||n==="number"||n==="boolean"?String(c):c instanceof qr?c.toStringPremultipliedAlpha():c instanceof ls||c instanceof ds?c.toString():JSON.stringify(c)}class da{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Xo(n[1]))return o.error("invalid value");const u=n[1];let f=Zi(u);const h=o.expectedType;return f.kind!=="array"||f.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(f=h),new da(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof qr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ls?this.value.serialize():this.value}}class Ji{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const ku={string:Fr,number:In,boolean:Dr,object:Qc};class To{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u,f=1;const h=n[0];if(h==="array"){let w,T;if(n.length>2){const P=n[1];if(typeof P!="string"||!(P in ku)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);w=ku[P],f++}else w=Pr;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);T=n[2],f++}u=hs(w,T)}else u=ku[h];const _=[];for(;f<n.length;f++){const w=o.parse(n[f],f,Pr);if(!w)return null;_.push(w)}return new To(u,_)}evaluate(n){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(n);if(!xc(this.type,Zi(u)))return u;if(o===this.args.length-1)throw new Ji(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${Ui(Zi(u))} but was expected to be of type ${Ui(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const f=n.N;(typeof f=="number"||this.args.length>1)&&o.push(f)}}return o.concat(this.args.map(u=>u.serialize()))}}class wc{constructor(n){this.type=ja,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const f=[];let h=!1;for(let _=1;_<=n.length-1;++_){const w=n[_];if(h&&typeof w=="object"&&!Array.isArray(w)){h=!1;let T=null;if(w["font-scale"]&&(T=o.parseObjectValue(w["font-scale"],_,"font-scale",In),!T))return null;let P=null;if(w["text-font"]&&(P=o.parseObjectValue(w["text-font"],_,"text-font",hs(Fr)),!P))return null;let x=null;if(w["text-color"]&&(x=o.parseObjectValue(w["text-color"],_,"text-color",no),!x))return null;const A=f[f.length-1];A.scale=T,A.font=P,A.textColor=x}else{const T=o.parse(n[_],_,Pr);if(!T)return null;const P=T.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new wc(f)}evaluate(n){return new ls(this.sections.map(o=>{const u=o.content.evaluate(n);return Zi(u)===yl?new ha("",u,null,null,null):new ha(As(u),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),n.push(u)}return n}}class Aa{constructor(n,o,u,f){this._imageWarnHistory={},this.type=yl,this.namePrimary=n,this.nameSecondary=o,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),f&&(this.paramsSecondary=f.params,this.iconsetIdSecondary=f.iconset?f.iconset.id:void 0)}static parse(n,o){if(n.length<2)return o.error("Expected two or more arguments.");let u=1;const f=[];function h(){if(u<n.length){const w=o.parse(n[u],u++,Fr);return w?(f.push({image:w,options:{}}),!0):(o.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(u<n.length){const T=n[u];if((w=T)===null||typeof w!="object"||Array.isArray(w))return!0;const P=T.params,x=T.iconset,A=o.concat(u);if(!P&&!x)return u++,!0;if(P){if(typeof P!="object"||P.constructor!==Object)return A.error('Image options "params" should be an object'),!1;const I={},C=A.concat(void 0,"params");for(const M in P){if(!M)return C.error("Image parameter name should be non-empty"),!1;const R=C.concat(void 0,M).parse(P[M],void 0,no,void 0,{typeAnnotation:"coerce"});if(!R)return!1;I[M]=R}f[f.length-1].options.params=I}if(x){if(typeof x!="object"||x.constructor!==Object)return A.error('Image options "iconset" should be an object'),!1;if(!x.id)return A.error('Image options "iconset" should have an "id" property'),!1;f[f.length-1].options.iconset=x}return u++,!0}var w;return!0}for(let w=0;w<2;w++)if(!h()||!_())return;return new Aa(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(n,o){const u={};if(o){for(const f in o)if(o[f])try{u[f]=o[f].evaluate(n)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(n){const o={name:this.namePrimary.evaluate(n),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(n),iconsetId:this.iconsetIdSecondary}:void 0,f=ds.build(o,u,this.paramsPrimary?this.evaluateParams(n,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(n,this.paramsSecondary):void 0);if(f&&n.availableImages){const h=f.getPrimary().id;if(f.available=n.availableImages.some(_=>wo.isEqual(_,h)),f.available){const _=f.getSecondary()?f.getSecondary().id:null;_&&(f.available=n.availableImages.some(w=>wo.isEqual(w,_)))}}return f}eachChild(n){if(n(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&n(this.paramsPrimary[o]);if(this.nameSecondary&&(n(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&n(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(n,o){const u={};if(o&&(u.iconset={id:o}),n){u.params={};for(const f in n)n[f]&&(u.params[f]=n[f].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const n=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&n.push(o)}if(this.nameSecondary&&(n.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&n.push(o)}return n}}function Ea(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const pd={"to-boolean":Dr,"to-color":no,"to-number":In,"to-string":Fr};class Va{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[0],f=[];let h=vc;if(u==="to-array"){if(!Array.isArray(n[1]))return null;const _=n[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);h=hs(o.expectedType.itemType,_)}else{if(!(_>0&&Xo(n[1][0])))return null;h=hs(Zi(n[1][0]),_)}for(let w=0;w<_;w++){const T=n[1][w];let P;if(Ea(T)==="array")P=o.parse(T,void 0,h.itemType);else{const x=Ea(T);if(x!==h.itemType.kind)return o.error(`Expected ${h.itemType.kind} but found ${x}.`);P=o.registry.literal.parse(["literal",T===void 0?null:T],o)}if(!P)return null;f.push(P)}}else{if((u==="to-boolean"||u==="to-string")&&n.length!==2)return o.error("Expected one argument.");h=pd[u];for(let _=1;_<n.length;_++){const w=o.parse(n[_],_,Pr);if(!w)return null;f.push(w)}}return new Va(h,f)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,u;for(const f of this.args){if(o=f.evaluate(n),u=null,o instanceof qr)return o;if(typeof o=="string"){const h=n.parseColor(o);if(h)return h}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Ko(o[0],o[1],o[2],o[3]),!u))return new qr(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ji(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(n),o===null)return 0;const f=Number(o);if(!isNaN(f))return f}throw new Ji(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?ls.fromString(As(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?ds.build(As(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(o=>o.evaluate(n)):As(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new wc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Aa(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}const Hp=["Unknown","Point","LineString","Polygon"];class Sc{constructor(n,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-n[0])+this.featureDistanceData.bearing[1]*(f*o-n[1])}return 0}parseColor(n){let o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=qr.parse(n)),o}getConfig(n){return this.options?this.options.get(n):null}}class Es{constructor(n,o,u,f,h){this.name=n,this.type=o,this._evaluate=u,this.args=f,this._overloadIndex=h}evaluate(n){if(!this._evaluate){const o=Es.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const u=n[0],f=Es.definitions[u];if(!f)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(f)?f[0]:f.type,_=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=[];let T=null,P=-1;for(const[x,A]of _){if(Array.isArray(x)&&x.length!==n.length-1)continue;w.push(x),P++,T=new Sl(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const I=[];let C=!1;for(let M=1;M<n.length;M++){const R=n[M],j=Array.isArray(x)?x[M-1]:x.type,$=T.parse(R,1+I.length,j);if(!$){C=!0;break}I.push($)}if(!C)if(Array.isArray(x)&&x.length!==I.length)T.error(`Expected ${x.length} arguments, but found ${I.length} instead.`);else{for(let M=0;M<I.length;M++){const R=Array.isArray(x)?x[M]:x.type,j=I[M];T.concat(M+1).checkSubtype(R,j.type)}if(T.errors.length===0)return new Es(u,h,A,I,P)}}if(w.length===1)o.errors.push(...T.errors);else{const x=(w.length?w:_.map(([I])=>I)).map(md).join(" | "),A=[];for(let I=1;I<n.length;I++){const C=o.parse(n[I],1+A.length);if(!C)return null;A.push(Ui(C.type))}o.error(`Expected arguments of type ${x}, but found (${A.join(", ")}) instead.`)}return null}static register(n,o){Es.definitions=o;for(const u in o)n[u]=Es}}function md(c){return Array.isArray(c)?`(${c.map(Ui).join(", ")})`:`(${Ui(c.type)}...)`}class fa{constructor(n,o,u){this.type=Zo,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const f=u["case-sensitive"]===void 0?o.parse(!1,1,Dr):o.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Dr);if(!f)return null;const h=u["diacritic-sensitive"]===void 0?o.parse(!1,1,Dr):o.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Dr);if(!h)return null;let _=null;return u.locale&&(_=o.parseObjectValue(u.locale,1,"locale",Fr),!_)?null:new fa(f,h,_)}evaluate(n){return new Lu(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function bh(c,n,o=0,u=c.length-1,f=Ee){for(;u>o;){if(u-o>600){const T=u-o+1,P=n-o+1,x=Math.log(T),A=.5*Math.exp(2*x/3),I=.5*Math.sqrt(x*A*(T-A)/T)*(P-T/2<0?-1:1);bh(c,n,Math.max(o,Math.floor(n-P*A/T+I)),Math.min(u,Math.floor(n+(T-P)*A/T+I)),f)}const h=c[n];let _=o,w=u;for(K(c,o,n),f(c[u],h)>0&&K(c,o,u);_<w;){for(K(c,_,w),_++,w--;f(c[_],h)<0;)_++;for(;f(c[w],h)>0;)w--}f(c[o],h)===0?K(c,o,w):(w++,K(c,w,u)),w<=n&&(o=w+1),n<=w&&(u=w-1)}}function K(c,n,o){const u=c[n];c[n]=c[o],c[o]=u}function Ee(c,n){return c<n?-1:c>n?1:0}function pt(c){let n=0;for(let o,u,f=0,h=c.length,_=h-1;f<h;_=f++)o=c[f],u=c[_],n+=(u.x-o.x)*(o.y+u.y);return n}function It(c,n){c[0]=Math.min(c[0],n[0]),c[1]=Math.min(c[1],n[1]),c[2]=Math.max(c[2],n[0]),c[3]=Math.max(c[3],n[1])}function Yt(c,n){return!(c[0]<=n[0]||c[2]>=n[2]||c[1]<=n[1]||c[3]>=n[3])}function fn(c,n,o){const u=c[0]-n[0],f=c[1]-n[1],h=c[0]-o[0],_=c[1]-o[1];return u*_-h*f==0&&u*h<=0&&f*_<=0}function Mn(c,n,o=!1){let u=!1;for(let w=0,T=n.length;w<T;w++){const P=n[w];for(let x=0,A=P.length,I=A-1;x<A;I=x++){const C=P[I],M=P[x];if(fn(c,C,M))return o;(h=C)[1]>(f=c)[1]!=(_=M)[1]>f[1]&&f[0]<(_[0]-h[0])*(f[1]-h[1])/(_[1]-h[1])+h[0]&&(u=!u)}}var f,h,_;return u}function Wn(c,n,o,u){const f=u[0]-o[0],h=u[1]-o[1],_=(c[0]-o[0])*h-f*(c[1]-o[1]),w=(n[0]-o[0])*h-f*(n[1]-o[1]);return _>0&&w<0||_<0&&w>0}function vr(c,n,o,u){return(f=[u[0]-o[0],u[1]-o[1]])[0]*(h=[n[0]-c[0],n[1]-c[1]])[1]-f[1]*h[0]!=0&&!(!Wn(c,n,o,u)||!Wn(o,u,c,n));var f,h}const Mr=8192;function Gr(c,n){const o=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,f=Math.pow(2,n.z);return[Math.round(o*f*Mr),Math.round(u*f*Mr)]}function Ci(c,n){for(let o=0;o<n.length;o++)if(Mn(c,n[o]))return!0;return!1}function _s(c,n,o){for(const u of o)for(let f=0,h=u.length,_=h-1;f<h;_=f++)if(vr(c,n,u[_],u[f]))return!0;return!1}function ys(c,n){for(let o=0;o<c.length;++o)if(!Mn(c[o],n))return!1;for(let o=0;o<c.length-1;++o)if(_s(c[o],c[o+1],n))return!1;return!0}function Ws(c,n){for(let o=0;o<n.length;o++)if(ys(c,n[o]))return!0;return!1}function vs(c,n,o){const u=[];for(let f=0;f<c.length;f++){const h=[];for(let _=0;_<c[f].length;_++){const w=Gr(c[f][_],o);It(n,w),h.push(w)}u.push(h)}return u}function Jn(c,n,o){const u=[];for(let f=0;f<c.length;f++){const h=vs(c[f],n,o);u.push(h)}return u}function Rn(c,n,o,u){if(c[0]<o[0]||c[0]>o[2]){const f=.5*u;let h=c[0]-o[0]>f?-u:o[0]-c[0]>f?u:0;h===0&&(h=c[0]-o[2]>f?-u:o[2]-c[0]>f?u:0),c[0]+=h}It(n,c)}function Bo(c,n,o,u){const f=Math.pow(2,u.z)*Mr,h=[u.x*Mr,u.y*Mr],_=[];if(!c)return _;for(const w of c)for(const T of w){const P=[T.x+h[0],T.y+h[1]];Rn(P,n,o,f),_.push(P)}return _}function Hn(c,n,o,u){const f=Math.pow(2,u.z)*Mr,h=[u.x*Mr,u.y*Mr],_=[];if(!c)return _;for(const T of c){const P=[];for(const x of T){const A=[x.x+h[0],x.y+h[1]];It(n,A),P.push(A)}_.push(P)}if(n[2]-n[0]<=f/2){(w=n)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of _)for(const P of T)Rn(P,n,o,f)}var w;return _}class qa{constructor(n,o){this.type=Dr,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Xo(n[1])){const u=n[1];if(u.type==="FeatureCollection")for(let f=0;f<u.features.length;++f){const h=u.features[f].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new qa(u,u.features[f].geometry)}else if(u.type==="Feature"){const f=u.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new qa(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new qa(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if(u.type==="Polygon"){const w=vs(u.coordinates,h,_),T=Bo(o.geometry(),f,h,_);if(!Yt(f,h))return!1;for(const P of T)if(!Mn(P,w))return!1}if(u.type==="MultiPolygon"){const w=Jn(u.coordinates,h,_),T=Bo(o.geometry(),f,h,_);if(!Yt(f,h))return!1;for(const P of T)if(!Ci(P,w))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if(u.type==="Polygon"){const w=vs(u.coordinates,h,_),T=Hn(o.geometry(),f,h,_);if(!Yt(f,h))return!1;for(const P of T)if(!ys(P,w))return!1}if(u.type==="MultiPolygon"){const w=Jn(u.coordinates,h,_),T=Hn(o.geometry(),f,h,_);if(!Yt(f,h))return!1;for(const P of T)if(!Ws(P,w))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Zl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Xn=1/298.257223563,eu=Xn*(2-Xn),vl=Math.PI/180;class Kl{static fromTile(n,o,u){const f=Math.PI*(1-2*(n+.5)/Math.pow(2,o)),h=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/vl;return new Kl(h,u)}static get units(){return Zl}constructor(n,o){if(n===void 0)throw new Error("No latitude given.");if(o&&!Zl[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Zl).join(", ")}`);const u=6378.137*vl*(o?Zl[o]:1),f=Math.cos(n*vl),h=1/(1-eu*(1-f*f)),_=Math.sqrt(h);this.kx=u*_*f,this.ky=u*_*h*(1-eu)}distance(n,o){const u=Di(n[0]-o[0])*this.kx,f=(n[1]-o[1])*this.ky;return Math.sqrt(u*u+f*f)}bearing(n,o){const u=Di(o[0]-n[0])*this.kx;return Math.atan2(u,(o[1]-n[1])*this.ky)/vl}destination(n,o,u){const f=u*vl;return this.offset(n,Math.sin(f)*o,Math.cos(f)*o)}offset(n,o,u){return[n[0]+o/this.kx,n[1]+u/this.ky]}lineDistance(n){let o=0;for(let u=0;u<n.length-1;u++)o+=this.distance(n[u],n[u+1]);return o}area(n){let o=0;for(let u=0;u<n.length;u++){const f=n[u];for(let h=0,_=f.length,w=_-1;h<_;w=h++)o+=Di(f[h][0]-f[w][0])*(f[h][1]+f[w][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(n,o){let u=0;if(o<=0)return n[0];for(let f=0;f<n.length-1;f++){const h=n[f],_=n[f+1],w=this.distance(h,_);if(u+=w,u>o)return Cs(h,_,(o-(u-w))/w)}return n[n.length-1]}pointToSegmentDistance(n,o,u){let[f,h]=o,_=Di(u[0]-f)*this.kx,w=(u[1]-h)*this.ky;if(_!==0||w!==0){const T=(Di(n[0]-f)*this.kx*_+(n[1]-h)*this.ky*w)/(_*_+w*w);T>1?(f=u[0],h=u[1]):T>0&&(f+=_/this.kx*T,h+=w/this.ky*T)}return _=Di(n[0]-f)*this.kx,w=(n[1]-h)*this.ky,Math.sqrt(_*_+w*w)}pointOnLine(n,o){let u=1/0,f=n[0][0],h=n[0][1],_=0,w=0;for(let T=0;T<n.length-1;T++){let P=n[T][0],x=n[T][1],A=Di(n[T+1][0]-P)*this.kx,I=(n[T+1][1]-x)*this.ky,C=0;A===0&&I===0||(C=(Di(o[0]-P)*this.kx*A+(o[1]-x)*this.ky*I)/(A*A+I*I),C>1?(P=n[T+1][0],x=n[T+1][1]):C>0&&(P+=A/this.kx*C,x+=I/this.ky*C)),A=Di(o[0]-P)*this.kx,I=(o[1]-x)*this.ky;const M=A*A+I*I;M<u&&(u=M,f=P,h=x,_=T,w=C)}return{point:[f,h],index:_,t:Math.max(0,Math.min(1,w))}}lineSlice(n,o,u){let f=this.pointOnLine(u,n),h=this.pointOnLine(u,o);if(f.index>h.index||f.index===h.index&&f.t>h.t){const P=f;f=h,h=P}const _=[f.point],w=f.index+1,T=h.index;!tu(u[w],_[0])&&w<=T&&_.push(u[w]);for(let P=w+1;P<=T;P++)_.push(u[P]);return tu(u[T],h.point)||_.push(h.point),_}lineSliceAlong(n,o,u){let f=0;const h=[];for(let _=0;_<u.length-1;_++){const w=u[_],T=u[_+1],P=this.distance(w,T);if(f+=P,f>n&&h.length===0&&h.push(Cs(w,T,(n-(f-P))/P)),f>=o)return h.push(Cs(w,T,(o-(f-P))/P)),h;f>n&&h.push(T)}return h}bufferPoint(n,o){const u=o/this.ky,f=o/this.kx;return[n[0]-f,n[1]-u,n[0]+f,n[1]+u]}bufferBBox(n,o){const u=o/this.ky,f=o/this.kx;return[n[0]-f,n[1]-u,n[2]+f,n[3]+u]}insideBBox(n,o){return Di(n[0]-o[0])>=0&&Di(n[0]-o[2])<=0&&n[1]>=o[1]&&n[1]<=o[3]}}function tu(c,n){return c[0]===n[0]&&c[1]===n[1]}function Cs(c,n,o){const u=Di(n[0]-c[0]);return[c[0]+u*o,c[1]+(n[1]-c[1])*o]}function Di(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Xl{constructor(n=[],o=(u,f)=>u<f?-1:u>f?1:0){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:u}=this,f=o[n];for(;n>0;){const h=n-1>>1,_=o[h];if(u(f,_)>=0)break;o[n]=_,n=h}o[n]=f}_down(n){const{data:o,compare:u}=this,f=this.length>>1,h=o[n];for(;n<f;){let _=1+(n<<1);const w=_+1;if(w<this.length&&u(o[w],o[_])<0&&(_=w),u(o[_],h)>=0)break;o[n]=o[_],n=_}o[n]=h}}var un=8192;function nu(c,n){return n.dist-c.dist}const Ps=100,Zs=50;function wh(c){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==c.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==c[o])return!1;return!0}function Ru(c){return c[1]-c[0]+1}function Ks(c,n){const o=c[1]>=c[0]&&c[1]<n;return o||console.warn("Distance Expression: Index is out of range"),o}function xl(c,n){if(c[0]>c[1])return[null,null];const o=Ru(c);if(n){if(o===2)return[c,null];const u=Math.floor(o/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(o===1)return[c,null];const u=Math.floor(o/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function bl(c,n){const o=[1/0,1/0,-1/0,-1/0];if(!Ks(n,c.length))return o;for(let u=n[0];u<=n[1];++u)It(o,c[u]);return o}function Tc(c){const n=[1/0,1/0,-1/0,-1/0];for(let o=0;o<c.length;++o)for(let u=0;u<c[o].length;++u)It(n,c[o][u]);return n}function Ca(c,n,o){if(wh(c)||wh(n))return NaN;let u=0,f=0;return c[2]<n[0]&&(u=n[0]-c[2]),c[0]>n[2]&&(u=c[0]-n[2]),c[1]>n[3]&&(f=c[1]-n[3]),c[3]<n[1]&&(f=n[1]-c[3]),o.distance([0,0],[u,f])}function Du(c){return 360*c-180}function pa(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Ao(c,n){const o=Math.pow(2,n.z),u=(c.y/un+n.y)/o;return[Du((c.x/un+n.x)/o),pa(u)]}function Ac(c,n){const o=[];for(let u=0;u<c.length;++u)o.push(Ao(c[u],n));return o}function Yl(c,n,o){const u=o.pointOnLine(n,c).point;return o.distance(c,u)}function Jl(c,n,o,u,f){const h=o.slice(u[0],u[1]+1);let _=1/0;for(let w=n[0];w<=n[1];++w)if((_=Math.min(_,Yl(c[w],h,f)))===0)return 0;return _}function Ec(c,n,o,u,f){const h=Math.min(f.pointToSegmentDistance(c,o,u),f.pointToSegmentDistance(n,o,u)),_=Math.min(f.pointToSegmentDistance(o,c,n),f.pointToSegmentDistance(u,c,n));return Math.min(h,_)}function Cc(c,n,o,u,f){if(!Ks(n,c.length)||!Ks(u,o.length))return NaN;let h=1/0;for(let _=n[0];_<n[1];++_)for(let w=u[0];w<u[1];++w){if(vr(c[_],c[_+1],o[w],o[w+1]))return 0;h=Math.min(h,Ec(c[_],c[_+1],o[w],o[w+1],f))}return h}function Qi(c,n,o,u,f){if(!Ks(n,c.length)||!Ks(u,o.length))return NaN;let h=1/0;for(let _=n[0];_<=n[1];++_)for(let w=u[0];w<=u[1];++w)if((h=Math.min(h,f.distance(c[_],o[w])))===0)return h;return h}function gd(c,n,o){if(Mn(c,n,!0))return 0;let u=1/0;for(const f of n){const h=f.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[h-1]&&(u=Math.min(u,o.pointToSegmentDistance(c,f[h-1],f[0])))===0||(u=Math.min(u,Yl(c,f,o)))===0)return u}return u}function Yo(c,n,o,u){if(!Ks(n,c.length))return NaN;for(let h=n[0];h<=n[1];++h)if(Mn(c[h],o,!0))return 0;let f=1/0;for(let h=n[0];h<n[1];++h)for(const _ of o)for(let w=0,T=_.length,P=T-1;w<T;P=w++){if(vr(c[h],c[h+1],_[P],_[w]))return 0;f=Math.min(f,Ec(c[h],c[h+1],_[P],_[w],u))}return f}function Jo(c,n){for(const o of c)for(let u=0;u<=o.length-1;++u)if(Mn(o[u],n,!0))return!0;return!1}function Nu(c,n,o,u=1/0){const f=Tc(c),h=Tc(n);if(u!==1/0&&Ca(f,h,o)>=u)return u;if(Yt(f,h)){if(Jo(c,n))return 0}else if(Jo(n,c))return 0;let _=u;for(const w of c)for(let T=0,P=w.length,x=P-1;T<P;x=T++)for(const A of n)for(let I=0,C=A.length,M=C-1;I<C;M=I++){if(vr(w[x],w[T],A[M],A[I]))return 0;_=Math.min(_,Ec(w[x],w[T],A[M],A[I],o))}return _}function ru(c,n,o,u,f,h,_){if(h===null||_===null)return;const w=Ca(bl(u,h),bl(f,_),o);w<n&&c.push({dist:w,range1:h,range2:_})}function Qo(c,n,o,u,f=1/0){let h=Math.min(u.distance(c[0],o[0][0]),f);if(h===0)return h;const _=new Xl([{dist:0,range1:[0,c.length-1],range2:[0,0]}],nu),w=n?Zs:Ps,T=Tc(o);for(;_.length;){const P=_.pop();if(P.dist>=h)continue;const x=P.range1;if(Ru(x)<=w){if(!Ks(x,c.length))return NaN;if(n){const A=Yo(c,x,o,u);if((h=Math.min(h,A))===0)return h}else for(let A=x[0];A<=x[1];++A){const I=gd(c[A],o,u);if((h=Math.min(h,I))===0)return h}}else{const A=xl(x,n);if(A[0]!==null){const I=Ca(bl(c,A[0]),T,u);I<h&&_.push({dist:I,range1:A[0],range2:[0,0]})}if(A[1]!==null){const I=Ca(bl(c,A[1]),T,u);I<h&&_.push({dist:I,range1:A[1],range2:[0,0]})}}}return h}function Pc(c,n,o,u,f,h=1/0){let _=Math.min(h,f.distance(c[0],o[0]));if(_===0)return _;const w=new Xl([{dist:0,range1:[0,c.length-1],range2:[0,o.length-1]}],nu),T=n?Zs:Ps,P=u?Zs:Ps;for(;w.length;){const x=w.pop();if(x.dist>=_)continue;const A=x.range1,I=x.range2;if(Ru(A)<=T&&Ru(I)<=P){if(!Ks(A,c.length)||!Ks(I,o.length))return NaN;if(n&&u?_=Math.min(_,Cc(c,A,o,I,f)):n||u?n&&!u?_=Math.min(_,Jl(o,I,c,A,f)):!n&&u&&(_=Math.min(_,Jl(c,A,o,I,f))):_=Math.min(_,Qi(c,A,o,I,f)),_===0)return _}else{const C=xl(A,n),M=xl(I,u);ru(w,_,f,c,o,C[0],M[0]),ru(w,_,f,c,o,C[0],M[1]),ru(w,_,f,c,o,C[1],M[0]),ru(w,_,f,c,o,C[1],M[1])}}return _}function Ql(c,n,o,u,f=1/0){let h=f;const _=bl(c,[0,c.length-1]);for(const w of o)if(!(h!==1/0&&Ca(_,bl(w,[0,w.length-1]),u)>=h)&&(h=Math.min(h,Pc(c,n,w,!0,u,h)),h===0))return h;return h}function $a(c,n,o,u,f=1/0){let h=f;const _=bl(c,[0,c.length-1]);for(const w of o){if(h!==1/0&&Ca(_,Tc(w),u)>=h)continue;const T=Qo(c,n,w,u,h);if(isNaN(T))return T;if((h=Math.min(h,T))===0)return h}return h}function ec(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Pa{constructor(n,o){this.type=In,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(Xo(n[1])){const u=n[1];if(u.type==="FeatureCollection"){for(let f=0;f<u.features.length;++f)if(ec(u.features[f].geometry.type))return new Pa(u,u.features[f].geometry)}else if(u.type==="Feature"){if(ec(u.geometry.type))return new Pa(u,u.geometry)}else if(ec(u.type))return new Pa(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const o=n.geometry(),u=n.canonicalID();if(o!=null&&u!=null){if(n.geometryType()==="Point")return function(f,h,_){const w=[];for(const P of f)for(const x of P)w.push(Ao(x,h));const T=new Kl(w[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?Pc(w,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",T):_.type==="MultiLineString"?Ql(w,!1,_.coordinates,T):_.type==="Polygon"||_.type==="MultiPolygon"?$a(w,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,T):null}(o,u,this.geometries);if(n.geometryType()==="LineString")return function(f,h,_){const w=[];for(const P of f){const x=[];for(const A of P)x.push(Ao(A,h));w.push(x)}const T=new Kl(w[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Ql(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,T);if(_.type==="MultiLineString"){let P=1/0;for(let x=0;x<_.coordinates.length;x++){const A=Ql(_.coordinates[x],!0,w,T,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}if(_.type==="Polygon"||_.type==="MultiPolygon"){let P=1/0;for(let x=0;x<w.length;x++){const A=$a(w[x],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,T,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}return null}(o,u,this.geometries);if(n.geometryType()==="Polygon")return function(f,h,_){const w=[];for(const P of function(x,A){const I=x.length;if(I<=1)return[x];const C=[];let M,R;for(let j=0;j<I;j++){const $=pt(x[j]);$!==0&&(x[j].area=Math.abs($),R===void 0&&(R=$<0),R===$<0?(M&&C.push(M),M=[x[j]]):M.push(x[j]))}return M&&C.push(M),C}(f)){const x=[];for(let A=0;A<P.length;++A)x.push(Ac(P[A],h));w.push(x)}const T=new Kl(w[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return $a(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,T);if(_.type==="MultiLineString"){let P=1/0;for(let x=0;x<_.coordinates.length;x++){const A=$a(_.coordinates[x],!0,w,T,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}return _.type==="Polygon"||_.type==="MultiPolygon"?function(P,x,A){let I=1/0;for(const C of P)for(const M of x){const R=Nu(C,M,A,I);if(isNaN(R))return R;if((I=Math.min(I,R))===0)return I}return I}(_.type==="Polygon"?[_.coordinates]:_.coordinates,w,T):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function tc(c,n){switch(c){case"string":return As(n);case"number":return+n;case"boolean":return!!n;case"color":return qr.parse(n);case"formatted":return ls.fromString(As(n));case"resolvedImage":return ds.build(As(n))}return n}function nc(c,n,o,u){return u!==void 0&&(c=u*Math.round(c/u)),n!==void 0&&c<n&&(c=n),o!==void 0&&c>o&&(c=o),c}class wl{constructor(n,o,u){this.type=n,this.key=o,this.scope=u}static parse(n,o){let u=o.expectedType;if(u==null&&(u=Pr),n.length<2||n.length>3)return o.error("Invalid number of arguments for 'config' expression.");const f=o.parse(n[1],1);if(!(f instanceof da))return o.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const h=o.parse(n[2],2);return h instanceof da?new wl(u,As(f.value),As(h.value)):o.error("Scope of 'config' expression must be a string literal.")}return new wl(u,As(f.value))}evaluate(n){const o=[this.key,this.scope,n.scope].filter(Boolean).join(""),u=n.getConfig(o);if(!u)return null;const{type:f,value:h,values:_,minValue:w,maxValue:T,stepValue:P}=u,x=u.default.evaluate(n);let A=x;if(h){const I=n.scope;n.scope=(I||"").split("").slice(1).join(""),A=h.evaluate(n),n.scope=I}return f&&(A=tc(f,A)),A===void 0||w===void 0&&T===void 0&&P===void 0||(typeof A=="number"?A=nc(A,w,T,P):Array.isArray(A)&&(A=A.map(I=>typeof I=="number"?nc(I,w,T,P):I))),h!==void 0&&A!==void 0&&_&&!_.includes(A)&&(A=x,f&&(A=tc(f,A))),(f&&f!==this.type||A!==void 0&&Zi(A)!==this.type)&&(A=tc(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function Eo(c){if(c instanceof Es&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof qa||c instanceof Pa)return!1;let n=!0;return c.eachChild(o=>{n&&!Eo(o)&&(n=!1)}),n}function jo(c){if(c instanceof Es&&c.name==="feature-state")return!1;let n=!0;return c.eachChild(o=>{n&&!jo(o)&&(n=!1)}),n}function Vi(c){if(c instanceof wl)return new Set([c.key]);let n=new Set;return c.eachChild(o=>{n=new Set([...n,...Vi(o)])}),n}function Pi(c,n){if(c instanceof Es&&n.indexOf(c.name)>=0)return!1;let o=!0;return c.eachChild(u=>{o&&!Pi(u,n)&&(o=!1)}),o}class es{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=n[1];return o.scope.has(u)?new es(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class fs{constructor(n,o=[],u,f=new Iu,h=[],_,w){this.registry=n,this.path=o,this.key=o.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=f,this.errors=h,this.expectedType=u,this._scope=_,this.options=w}parse(n,o,u,f,h={}){return o||u?this.concat(o,null,u,f)._parse(n,h):this._parse(n,h)}parseObjectValue(n,o,u,f,h,_={}){return this.concat(o,u,f,h)._parse(n,_)}_parse(n,o){function u(f,h,_){return _==="assert"?new To(h,[f]):_==="coerce"?new Va(h,[f]):f}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(f){let h=f.parse(n,this);if(!h)return null;if(this.expectedType){const _=this.expectedType,w=h.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(_,w))return null}else h=u(h,_,o.typeAnnotation||"coerce");else h=u(h,_,o.typeAnnotation||"assert")}if(!(h instanceof da)&&h.type.kind!=="resolvedImage"&&iu(h)){const _=new Sc(this._scope,this.options);try{h=new da(h.type,h.evaluate(_))}catch(w){return this.error(w.message),null}}return h}return Va.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,u,f){let h=typeof n=="number"?this.path.concat(n):this.path;h=typeof o=="string"?h.concat(o):h;const _=f?this.scope.concat(f):this.scope;return new fs(this.registry,h,u||null,_,this.errors,this._scope,this.options)}error(n,...o){const u=`${this.key}${o.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ns(u,n))}checkSubtype(n,o){const u=xc(n,o);return u&&this.error(u),u}}var Sl=fs;function iu(c){if(c instanceof es)return iu(c.boundExpression);if(c instanceof Es&&c.name==="error"||c instanceof fa||c instanceof qa||c instanceof Pa||c instanceof wl)return!1;const n=c instanceof Va||c instanceof To;let o=!0;return c.eachChild(u=>{o=n?o&&iu(u):o&&u instanceof da}),!!o&&Eo(c)&&Pi(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function rc(c,n){const o=c.length-1;let u,f,h=0,_=o,w=0;for(;h<=_;)if(w=Math.floor((h+_)/2),u=c[w],f=c[w+1],u<=n){if(w===o||n<f)return w;h=w+1}else{if(!(u>n))throw new Ji("Input is not a number.");_=w-1}return 0}class Ma{constructor(n,o,u){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[f,h]of u)this.labels.push(f),this.outputs.push(h)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(n[1],1,In);if(!u)return null;const f=[];let h=null;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(let _=1;_<n.length;_+=2){const w=_===1?-1/0:n[_],T=n[_+1],P=_,x=_+1;if(typeof w!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(f.length&&f[f.length-1][0]>=w)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const A=o.parse(T,x,h);if(!A)return null;h=h||A.type,f.push([w,A])}return new Ma(h,u,f)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const f=this.input.evaluate(n);if(f<=o[0])return u[0].evaluate(n);const h=o.length;return f>=o[h-1]?u[h-1].evaluate(n):u[rc(o,f)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}const Tr=.95047,_d=1.08883,ma=4/29,Co=6/29,Sh=3*Co*Co,gf=Co*Co*Co,Li=Math.PI/180,_f=180/Math.PI;function Th(c){return c>gf?Math.pow(c,1/3):c/Sh+ma}function yd(c){return c>Co?c*c*c:Sh*(c-ma)}function yf(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function vd(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function vf(c){const n=vd(c.r),o=vd(c.g),u=vd(c.b),f=Th((.4124564*n+.3575761*o+.1804375*u)/Tr),h=Th((.2126729*n+.7151522*o+.072175*u)/1);return{l:116*h-16,a:500*(f-h),b:200*(h-Th((.0193339*n+.119192*o+.9503041*u)/_d)),alpha:c.a}}function xd(c){let n=(c.l+16)/116,o=isNaN(c.a)?n:n+c.a/500,u=isNaN(c.b)?n:n-c.b/200;return n=1*yd(n),o=Tr*yd(o),u=_d*yd(u),new qr(yf(3.2404542*o-1.5371385*n-.4985314*u),yf(-.969266*o+1.8760108*n+.041556*u),yf(.0556434*o-.2040259*n+1.0572252*u),c.alpha)}function Wp(c,n,o){const u=n-c;return c+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const bd={forward:vf,reverse:xd,interpolate:function(c,n,o){return{l:Bn(c.l,n.l,o),a:Bn(c.a,n.a,o),b:Bn(c.b,n.b,o),alpha:Bn(c.alpha,n.alpha,o)}}},wd={forward:function(c){const{l:n,a:o,b:u}=vf(c),f=Math.atan2(u,o)*_f;return{h:f<0?f+360:f,c:Math.sqrt(o*o+u*u),l:n,alpha:c.a}},reverse:function(c){const n=c.h*Li,o=c.c;return xd({l:c.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:c.alpha})},interpolate:function(c,n,o){return{h:Wp(c.h,n.h,o),c:Bn(c.c,n.c,o),l:Bn(c.l,n.l,o),alpha:Bn(c.alpha,n.alpha,o)}}};var Zp=Object.freeze({__proto__:null,hcl:wd,lab:bd});class Ia{constructor(n,o,u,f,h){this.type=n,this.operator=o,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[_,w]of h)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(n,o,u,f){let h=0;if(n.name==="exponential")h=Kp(o,n.base,u,f);else if(n.name==="linear")h=Kp(o,1,u,f);else if(n.name==="cubic-bezier"){const _=n.controlPoints;h=new Cn(_[0],_[1],_[2],_[3]).solve(Kp(o,1,u,f))}return h}static parse(n,o){let[u,f,h,..._]=n;if(!Array.isArray(f)||f.length===0)return o.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const P=f[1];if(typeof P!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:P}}else{if(f[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const P=f.slice(1);if(P.length!==4||P.some(x=>typeof x!="number"||x<0||x>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length-1>3&&(n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(h=o.parse(h,2,In),!h)return null;const w=[];let T=null;u==="interpolate-hcl"||u==="interpolate-lab"?T=no:o.expectedType&&o.expectedType.kind!=="value"&&(T=o.expectedType);for(let P=0;P<_.length;P+=2){const x=_[P],A=_[P+1],I=P+3,C=P+4;if(typeof x!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(w.length&&w[w.length-1][0]>=x)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const M=o.parse(A,C,T);if(!M)return null;T=T||M.type,w.push([x,M])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Ia(T,u,f,h,w):o.error(`Type ${Ui(T)} is not interpolatable.`)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const f=this.input.evaluate(n);if(f<=o[0])return u[0].evaluate(n);const h=o.length;if(f>=o[h-1])return u[h-1].evaluate(n);const _=rc(o,f),w=Ia.interpolationFactor(this.interpolation,f,o[_],o[_+1]),T=u[_].evaluate(n),P=u[_+1].evaluate(n);return this.operator==="interpolate"?Mu[this.type.kind.toLowerCase()](T,P,w):this.operator==="interpolate-hcl"?wd.reverse(wd.interpolate(wd.forward(T),wd.forward(P),w)):bd.reverse(bd.interpolate(bd.forward(T),bd.forward(P),w))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,n,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function Kp(c,n,o,u){const f=u-o,h=c-o;return f===0?0:n===1?h/f:(Math.pow(n,h)-1)/(Math.pow(n,f)-1)}class xf{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let u=null;const f=o.expectedType;f&&f.kind!=="value"&&(u=f);const h=[];for(const w of n.slice(1)){const T=o.parse(w,1+h.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,h.push(T)}const _=f&&h.some(w=>xc(f,w.type));return new xf(_?Pr:u,h)}evaluate(n){let o,u=null,f=0;for(const h of this.args){if(f++,u=h.evaluate(n),u&&u instanceof ds&&!u.available&&(o||(o=u),u=null,f===this.args.length))return o;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class bf{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let h=1;h<n.length-1;h+=2){const _=n[h];if(typeof _!="string")return o.error(`Expected string, but found ${typeof _} instead.`,h);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);const w=o.parse(n[h+1],h+1);if(!w)return null;u.push([_,w])}const f=o.parse(n[n.length-1],n.length-1,o.expectedType,u);return f?new bf(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,u]of this.bindings)n.push(o,u.serialize());return n.push(this.result.serialize()),n}}class Xp{constructor(n,o,u){this.type=n,this.index=o,this.input=u}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,In),f=o.parse(n[2],2,hs(o.expectedType||Pr));return u&&f?new Xp(f.type.itemType,u,f):null}evaluate(n){const o=this.index.evaluate(n),u=this.input.evaluate(n);if(o<0)throw new Ji(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new Ji(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new Ji(`Array index must be an integer, but found ${o} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Sd{constructor(n,o,u){this.type=n,this.index=o,this.input=u}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,In),f=o.parse(n[2],2,hs(o.expectedType||Pr));return u&&f?new Sd(f.type.itemType,u,f):null}evaluate(n){const o=this.index.evaluate(n),u=this.input.evaluate(n);if(o<0)throw new Ji(`Array index out of bounds: ${o} < 0.`);if(o>u.length-1)throw new Ji(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o===Math.floor(o))return u[o];const f=Math.floor(o),h=Math.ceil(o),_=u[f],w=u[h];if(typeof _!="number"||typeof w!="number")throw new Ji(`Cannot interpolate between non-number values at index ${o}.`);const T=o-f;return _*(1-T)+w*T}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Td{constructor(n,o){this.type=Dr,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,Pr),f=o.parse(n[2],2,Pr);return u&&f?xh(u.type,[Dr,Fr,In,vc,Pr])?new Td(u,f):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(u.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!bc(o,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(Zi(o))} instead.`);if(!bc(u,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${Ui(Zi(u))} instead.`);return u.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class su{constructor(n,o,u){this.type=In,this.needle=n,this.haystack=o,this.fromIndex=u}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,Pr),f=o.parse(n[2],2,Pr);if(!u||!f)return null;if(!xh(u.type,[Dr,Fr,In,vc,Pr]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(u.type)} instead`);if(n.length===4){const h=o.parse(n[3],3,In);return h?new su(u,f,h):null}return new su(u,f)}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!bc(o,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(Zi(o))} instead.`);if(!bc(u,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${Ui(Zi(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(n);return u.indexOf(o,f)}return u.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Yp{constructor(n,o,u,f,h,_){this.inputType=n,this.type=o,this.input=u,this.cases=f,this.outputs=h,this.otherwise=_}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let u,f;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);const h={},_=[];for(let P=2;P<n.length-1;P+=2){let x=n[P];const A=n[P+1];Array.isArray(x)||(x=[x]);const I=o.concat(P);if(x.length===0)return I.error("Expected at least one branch label.");for(const M of x){if(typeof M!="number"&&typeof M!="string")return I.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return I.error("Numeric branch labels must be integer values.");if(u){if(I.checkSubtype(u,Zi(M)))return null}else u=Zi(M);if(h[String(M)]!==void 0)return I.error("Branch labels must be unique.");h[String(M)]=_.length}const C=o.parse(A,P,f);if(!C)return null;f=f||C.type,_.push(C)}const w=o.parse(n[1],1,Pr);if(!w)return null;const T=o.parse(n[n.length-1],n.length-1,f);return T?w.type.kind!=="value"&&o.concat(1).checkSubtype(u,w.type)?null:new Yp(u,f,w,h,_,T):null}evaluate(n){const o=this.input.evaluate(n);return(Zi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],f={};for(const _ of o){const w=f[this.cases[_]];w===void 0?(f[this.cases[_]]=u.length,u.push([this.cases[_],[_]])):u[w][1].push(_)}const h=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,w]of u)n.push(w.length===1?h(w[0]):w.map(h)),n.push(this.outputs[_].serialize());return n.push(this.otherwise.serialize()),n}}class Jp{constructor(n,o,u){this.type=n,this.branches=o,this.otherwise=u}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const f=[];for(let _=1;_<n.length-1;_+=2){const w=o.parse(n[_],_,Dr);if(!w)return null;const T=o.parse(n[_+1],_+1,u);if(!T)return null;f.push([w,T]),u=u||T.type}const h=o.parse(n[n.length-1],n.length-1,u);return h?new Jp(u,f,h):null}evaluate(n){for(const[o,u]of this.branches)if(o.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,u]of this.branches)n(o),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class Ad{constructor(n,o,u,f){this.type=n,this.input=o,this.beginIndex=u,this.endIndex=f}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,Pr),f=o.parse(n[2],2,In);if(!u||!f)return null;if(!xh(u.type,[hs(Pr),Fr,Pr]))return o.error(`Expected first argument to be of type array or string, but found ${Ui(u.type)} instead`);if(n.length===4){const h=o.parse(n[3],3,In);return h?new Ad(u.type,u,f,h):null}return new Ad(u.type,u,f)}evaluate(n){const o=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!bc(o,["string","array"]))throw new Ji(`Expected first argument to be of type array or string, but found ${Ui(Zi(o))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(n);return o.slice(u,f)}return o.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function mg(c,n){return c==="=="||c==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function gg(c,n,o,u){return u.compare(n,o)===0}function Ah(c,n,o){const u=c!=="=="&&c!=="!=";return class gN{constructor(h,_,w){this.type=Dr,this.lhs=h,this.rhs=_,this.collator=w,this.hasUntypedArgument=h.type.kind==="value"||_.type.kind==="value"}static parse(h,_){if(h.length!==3&&h.length!==4)return _.error("Expected two or three arguments.");const w=h[0];let T=_.parse(h[1],1,Pr);if(!T)return null;if(!mg(w,T.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${Ui(T.type)}'.`);let P=_.parse(h[2],2,Pr);if(!P)return null;if(!mg(w,P.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${Ui(P.type)}'.`);if(T.type.kind!==P.type.kind&&T.type.kind!=="value"&&P.type.kind!=="value")return _.error(`Cannot compare types '${Ui(T.type)}' and '${Ui(P.type)}'.`);u&&(T.type.kind==="value"&&P.type.kind!=="value"?T=new To(P.type,[T]):T.type.kind!=="value"&&P.type.kind==="value"&&(P=new To(T.type,[P])));let x=null;if(h.length===4){if(T.type.kind!=="string"&&P.type.kind!=="string"&&T.type.kind!=="value"&&P.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(x=_.parse(h[3],3,Zo),!x)return null}return new gN(T,P,x)}evaluate(h){const _=this.lhs.evaluate(h),w=this.rhs.evaluate(h);if(u&&this.hasUntypedArgument){const T=Zi(_),P=Zi(w);if(T.kind!==P.kind||T.kind!=="string"&&T.kind!=="number")throw new Ji(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${T.kind}, ${P.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=Zi(_),P=Zi(w);if(T.kind!=="string"||P.kind!=="string")return n(h,_,w)}return this.collator?o(h,_,w,this.collator.evaluate(h)):n(h,_,w)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[c];return this.eachChild(_=>{h.push(_.serialize())}),h}}}const g0=Ah("==",function(c,n,o){return n===o},gg),ou=Ah("!=",function(c,n,o){return n!==o},function(c,n,o,u){return!gg(0,n,o,u)}),Tl=Ah("<",function(c,n,o){return n<o},function(c,n,o,u){return u.compare(n,o)<0}),Mc=Ah(">",function(c,n,o){return n>o},function(c,n,o,u){return u.compare(n,o)>0}),_0=Ah("<=",function(c,n,o){return n<=o},function(c,n,o,u){return u.compare(n,o)<=0}),_g=Ah(">=",function(c,n,o){return n>=o},function(c,n,o,u){return u.compare(n,o)>=0});class Ga{constructor(n,o,u,f,h,_){this.type=Fr,this.number=n,this.locale=o,this.currency=u,this.unit=f,this.minFractionDigits=h,this.maxFractionDigits=_}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const u=o.parse(n[1],1,In);if(!u)return null;const f=n[2];if(typeof f!="object"||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");let h=null;if(f.locale&&(h=o.parseObjectValue(f.locale,2,"locale",Fr),!h))return null;let _=null;if(f.currency&&(_=o.parseObjectValue(f.currency,2,"currency",Fr),!_))return null;let w=null;if(f.unit&&(w=o.parseObjectValue(f.unit,2,"unit",Fr),!w))return null;let T=null;if(f["min-fraction-digits"]&&(T=o.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",In),!T))return null;let P=null;return f["max-fraction-digits"]&&(P=o.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",In),!P)?null:new Ga(u,h,_,w,T,P)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class ga{constructor(n){this.type=In,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=o.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Ui(u.type)} instead.`):new ga(u):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ji(`Expected value to be of type string or array, but found ${Ui(Zi(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}function Qp(c){return function(){c=1831565813+(c|=0)|0;let n=Math.imul(c^c>>>15,1|c);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Eh={"==":g0,"!=":ou,">":Mc,"<":Tl,">=":_g,"<=":_0,array:To,at:Xp,"at-interpolated":Sd,boolean:To,case:Jp,coalesce:xf,collator:fa,format:wc,image:Aa,in:Td,"index-of":su,interpolate:Ia,"interpolate-hcl":Ia,"interpolate-lab":Ia,length:ga,let:bf,literal:da,match:Yp,number:To,"number-format":Ga,object:To,slice:Ad,step:Ma,string:To,"to-boolean":Va,"to-color":Va,"to-number":Va,"to-string":Va,var:es,within:qa,distance:Pa,config:wl};function em(c,[n,o,u,f]){n=n.evaluate(c),o=o.evaluate(c),u=u.evaluate(c);const h=f?f.evaluate(c):1,_=Ko(n,o,u,h);if(_)throw new Ji(_);return new qr(n/255*h,o/255*h,u/255*h,h)}function tm(c,[n,o,u,f]){n=n.evaluate(c),o=o.evaluate(c),u=u.evaluate(c);const h=f?f.evaluate(c):1,_=function(P,x,A,I){return typeof P=="number"&&P>=0&&P<=360?typeof x=="number"&&x>=0&&x<=100&&typeof A=="number"&&A>=0&&A<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[P,x,A,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[P,x,A,I]:[P,x,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[P,x,A,I]:[P,x,A]).join(", ")}]: 'h' must be between 0 and 360.`}(n,o,u,h);if(_)throw new Ji(_);const w=`hsla(${n}, ${o}%, ${u}%, ${h})`,T=qr.parse(w);if(!T)throw new Ji(`Failed to parse HSLA color: ${w}`);return T}function wf(c,n){return c in n}function Ed(c,n){const o=n[c];return o===void 0?null:o}function Ha(c){return{type:c}}function Ch(c){return{result:"success",value:c}}function Wa(c){return{result:"error",value:c}}function Ou(c,n){return!!c&&!!c.parameters&&c.parameters.indexOf(n)>-1}function au(c){return c["property-type"]==="data-driven"}function Cd(c){return Ou(c.expression,"measure-light")}function yg(c){return Ou(c.expression,"zoom")}function Sf(c){return!!c.expression&&c.expression.interpolated}function Tf(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function vg(c){return c}function xg(c,n){const o=n.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",f=u||!(u||c.property!==void 0),h=c.type||(Sf(n)?"exponential":"interval");if(o&&((c=zr({},c)).stops&&(c.stops=c.stops.map(P=>[P[0],qr.parse(P[1])])),c.default=qr.parse(c.default?c.default:n.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!Zp[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let _,w,T;if(h==="exponential")_=Af;else if(h==="interval")_=bg;else if(h==="categorical"){_=y0,w=Object.create(null);for(const P of c.stops)w[P[0]]=P[1];T=typeof c.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);_=zu}if(u){const P={},x=[];for(let C=0;C<c.stops.length;C++){const M=c.stops[C],R=M[0].zoom;P[R]===void 0&&(P[R]={zoom:R,type:c.type,property:c.property,default:c.default,stops:[]},x.push(R)),P[R].stops.push([M[0].value,M[1]])}const A=[];for(const C of x)A.push([P[C].zoom,xg(P[C],n)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Ia.interpolationFactor.bind(void 0,I),zoomStops:A.map(C=>C[0]),evaluate:({zoom:C},M)=>Af({stops:A,base:c.base},n,C).evaluate(C,M)}}if(f){const P=h==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Ia.interpolationFactor.bind(void 0,P),zoomStops:c.stops.map(x=>x[0]),evaluate:({zoom:x})=>_(c,n,x,w,T)}}return{kind:"source",evaluate(P,x){const A=x&&x.properties?x.properties[c.property]:void 0;return A===void 0?Pd(c.default,n.default):_(c,n,A,w,T)}}}function Pd(c,n,o){return c!==void 0?c:n!==void 0?n:o!==void 0?o:void 0}function y0(c,n,o,u,f){return Pd(typeof o===f?u[o]:void 0,c.default,n.default)}function bg(c,n,o){if(Ea(o)!=="number")return Pd(c.default,n.default);const u=c.stops.length;if(u===1||o<=c.stops[0][0])return c.stops[0][1];if(o>=c.stops[u-1][0])return c.stops[u-1][1];const f=rc(c.stops.map(h=>h[0]),o);return c.stops[f][1]}function Af(c,n,o){const u=c.base!==void 0?c.base:1;if(Ea(o)!=="number")return Pd(c.default,n.default);const f=c.stops.length;if(f===1||o<=c.stops[0][0])return c.stops[0][1];if(o>=c.stops[f-1][0])return c.stops[f-1][1];const h=rc(c.stops.map(x=>x[0]),o),_=function(x,A,I,C){const M=C-I,R=x-I;return M===0?0:A===1?R/M:(Math.pow(A,R)-1)/(Math.pow(A,M)-1)}(o,u,c.stops[h][0],c.stops[h+1][0]),w=c.stops[h][1],T=c.stops[h+1][1];let P=Mu[n.type]||vg;if(c.colorSpace&&c.colorSpace!=="rgb"){const x=Zp[c.colorSpace];P=(A,I)=>x.reverse(x.interpolate(x.forward(A),x.forward(I),_))}return typeof w.evaluate=="function"?{evaluate(...x){const A=w.evaluate.apply(void 0,x),I=T.evaluate.apply(void 0,x);if(A!==void 0&&I!==void 0)return P(A,I,_)}}:P(w,T,_)}function zu(c,n,o){return n.type==="color"?o=qr.parse(o):n.type==="formatted"?o=ls.fromString(o.toString()):n.type==="resolvedImage"?o=ds.build(o.toString()):Ea(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),Pd(o,c.default,n.default)}Es.register(Eh,{error:[{kind:"error"},[Fr],(c,[n])=>{throw new Ji(n.evaluate(c))}],typeof:[Fr,[Pr],(c,[n])=>Ui(Zi(n.evaluate(c)))],"to-rgba":[hs(In,4),[no],(c,[n])=>n.evaluate(c).toRenderColor(null).toArray()],"to-hsla":[hs(In,4),[no],(c,[n])=>n.evaluate(c).toRenderColor(null).toHslaArray()],rgb:[no,[In,In,In],em],rgba:[no,[In,In,In,In],em],hsl:[no,[In,In,In],tm],hsla:[no,[In,In,In,In],tm],has:{type:Dr,overloads:[[[Fr],(c,[n])=>wf(n.evaluate(c),c.properties())],[[Fr,Qc],(c,[n,o])=>wf(n.evaluate(c),o.evaluate(c))]]},get:{type:Pr,overloads:[[[Fr],(c,[n])=>Ed(n.evaluate(c),c.properties())],[[Fr,Qc],(c,[n,o])=>Ed(n.evaluate(c),o.evaluate(c))]]},"feature-state":[Pr,[Fr],(c,[n])=>Ed(n.evaluate(c),c.featureState||{})],properties:[Qc,[],c=>c.properties()],"geometry-type":[Fr,[],c=>c.geometryType()],id:[Pr,[],c=>c.id()],zoom:[In,[],c=>c.globals.zoom],pitch:[In,[],c=>c.globals.pitch||0],"distance-from-center":[In,[],c=>c.distanceFromCenter()],"measure-light":[In,[Fr],(c,[n])=>c.measureLight(n.evaluate(c))],"heatmap-density":[In,[],c=>c.globals.heatmapDensity||0],"line-progress":[In,[],c=>c.globals.lineProgress||0],"raster-value":[In,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[In,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[In,[],c=>c.globals.skyRadialProgress||0],accumulated:[Pr,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[In,Ha(In),(c,n)=>{let o=0;for(const u of n)o+=u.evaluate(c);return o}],"*":[In,Ha(In),(c,n)=>{let o=1;for(const u of n)o*=u.evaluate(c);return o}],"-":{type:In,overloads:[[[In,In],(c,[n,o])=>n.evaluate(c)-o.evaluate(c)],[[In],(c,[n])=>-n.evaluate(c)]]},"/":[In,[In,In],(c,[n,o])=>n.evaluate(c)/o.evaluate(c)],"%":[In,[In,In],(c,[n,o])=>n.evaluate(c)%o.evaluate(c)],ln2:[In,[],()=>Math.LN2],pi:[In,[],()=>Math.PI],e:[In,[],()=>Math.E],"^":[In,[In,In],(c,[n,o])=>Math.pow(n.evaluate(c),o.evaluate(c))],sqrt:[In,[In],(c,[n])=>Math.sqrt(n.evaluate(c))],log10:[In,[In],(c,[n])=>Math.log(n.evaluate(c))/Math.LN10],ln:[In,[In],(c,[n])=>Math.log(n.evaluate(c))],log2:[In,[In],(c,[n])=>Math.log(n.evaluate(c))/Math.LN2],sin:[In,[In],(c,[n])=>Math.sin(n.evaluate(c))],cos:[In,[In],(c,[n])=>Math.cos(n.evaluate(c))],tan:[In,[In],(c,[n])=>Math.tan(n.evaluate(c))],asin:[In,[In],(c,[n])=>Math.asin(n.evaluate(c))],acos:[In,[In],(c,[n])=>Math.acos(n.evaluate(c))],atan:[In,[In],(c,[n])=>Math.atan(n.evaluate(c))],min:[In,Ha(In),(c,n)=>Math.min(...n.map(o=>o.evaluate(c)))],max:[In,Ha(In),(c,n)=>Math.max(...n.map(o=>o.evaluate(c)))],abs:[In,[In],(c,[n])=>Math.abs(n.evaluate(c))],round:[In,[In],(c,[n])=>{const o=n.evaluate(c);return o<0?-Math.round(-o):Math.round(o)}],floor:[In,[In],(c,[n])=>Math.floor(n.evaluate(c))],ceil:[In,[In],(c,[n])=>Math.ceil(n.evaluate(c))],"filter-==":[Dr,[Fr,Pr],(c,[n,o])=>c.properties()[n.value]===o.value],"filter-id-==":[Dr,[Pr],(c,[n])=>c.id()===n.value],"filter-type-==":[Dr,[Fr],(c,[n])=>c.geometryType()===n.value],"filter-<":[Dr,[Fr,Pr],(c,[n,o])=>{const u=c.properties()[n.value],f=o.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Dr,[Pr],(c,[n])=>{const o=c.id(),u=n.value;return typeof o==typeof u&&o<u}],"filter->":[Dr,[Fr,Pr],(c,[n,o])=>{const u=c.properties()[n.value],f=o.value;return typeof u==typeof f&&u>f}],"filter-id->":[Dr,[Pr],(c,[n])=>{const o=c.id(),u=n.value;return typeof o==typeof u&&o>u}],"filter-<=":[Dr,[Fr,Pr],(c,[n,o])=>{const u=c.properties()[n.value],f=o.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Dr,[Pr],(c,[n])=>{const o=c.id(),u=n.value;return typeof o==typeof u&&o<=u}],"filter->=":[Dr,[Fr,Pr],(c,[n,o])=>{const u=c.properties()[n.value],f=o.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Dr,[Pr],(c,[n])=>{const o=c.id(),u=n.value;return typeof o==typeof u&&o>=u}],"filter-has":[Dr,[Pr],(c,[n])=>n.value in c.properties()],"filter-has-id":[Dr,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Dr,[hs(Fr)],(c,[n])=>n.value.indexOf(c.geometryType())>=0],"filter-id-in":[Dr,[hs(Pr)],(c,[n])=>n.value.indexOf(c.id())>=0],"filter-in-small":[Dr,[Fr,hs(Pr)],(c,[n,o])=>o.value.indexOf(c.properties()[n.value])>=0],"filter-in-large":[Dr,[Fr,hs(Pr)],(c,[n,o])=>function(u,f,h,_){for(;h<=_;){const w=h+_>>1;if(f[w]===u)return!0;f[w]>u?_=w-1:h=w+1}return!1}(c.properties()[n.value],o.value,0,o.value.length-1)],all:{type:Dr,overloads:[[[Dr,Dr],(c,[n,o])=>n.evaluate(c)&&o.evaluate(c)],[Ha(Dr),(c,n)=>{for(const o of n)if(!o.evaluate(c))return!1;return!0}]]},any:{type:Dr,overloads:[[[Dr,Dr],(c,[n,o])=>n.evaluate(c)||o.evaluate(c)],[Ha(Dr),(c,n)=>{for(const o of n)if(o.evaluate(c))return!0;return!1}]]},"!":[Dr,[Dr],(c,[n])=>!n.evaluate(c)],"is-supported-script":[Dr,[Fr],(c,[n])=>{const o=c.globals&&c.globals.isSupportedScript;return!o||o(n.evaluate(c))}],upcase:[Fr,[Fr],(c,[n])=>n.evaluate(c).toUpperCase()],downcase:[Fr,[Fr],(c,[n])=>n.evaluate(c).toLowerCase()],concat:[Fr,Ha(Pr),(c,n)=>n.map(o=>As(o.evaluate(c))).join("")],"resolved-locale":[Fr,[Zo],(c,[n])=>n.evaluate(c).resolvedLocale()],random:[In,[In,In,Pr],(c,n)=>{const[o,u,f]=n.map(_=>_.evaluate(c));if(o>u||o===u)return o;let h;if(typeof f=="string")h=function(_){let w=0;if(_.length===0)return w;for(let T=0;T<_.length;T++)w=(w<<5)-w+_.charCodeAt(T),w|=0;return w}(f);else{if(typeof f!="number")throw new Ji(`Invalid seed input: ${f}`);h=f}return o+Qp(h)()*(u-o)}]});class nm{constructor(n,o,u,f){this.expression=n,this._warningHistory={},this._evaluator=new Sc(u,f),this._defaultValue=o?function(h){return h.type==="color"&&(Tf(h.default)||Array.isArray(h.default))?new qr(0,0,0,0):h.type==="color"?qr.parse(h.default)||null:h.default===void 0?null:h.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=Vi(n)}evaluateWithoutErrorHandling(n,o,u,f,h,_,w,T){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,u,f,h,_,w,T){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function Ef(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Eh}function Fu(c,n,o,u){const f=new Sl(Eh,[],n?function(_){const w={color:no,string:Fr,number:In,enum:Fr,boolean:Dr,formatted:ja,resolvedImage:yl};return _.type==="array"?hs(w[_.value]||Pr,_.length):w[_.type]}(n):void 0,void 0,void 0,o,u),h=f.parse(c,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Ch(new nm(h,n,o,u)):Wa(f.errors)}class D{constructor(n,o,u,f){this.kind=n,this._styleExpression=o,this.isLightConstant=u,this.isLineProgressConstant=f,this.isStateDependent=n!=="constant"&&!jo(o.expression),this.configDependencies=Vi(o.expression)}evaluateWithoutErrorHandling(n,o,u,f,h,_){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,f,h,_)}evaluate(n,o,u,f,h,_){return this._styleExpression.evaluate(n,o,u,f,h,_)}}class q{constructor(n,o,u,f,h,_){this.kind=n,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!jo(o.expression),this.isLightConstant=h,this.isLineProgressConstant=_,this.configDependencies=Vi(o.expression),this.interpolationType=f}evaluateWithoutErrorHandling(n,o,u,f,h,_){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,f,h,_)}evaluate(n,o,u,f,h,_){return this._styleExpression.evaluate(n,o,u,f,h,_)}interpolationFactor(n,o,u){return this.interpolationType?Ia.interpolationFactor(this.interpolationType,n,o,u):0}}function ne(c,n,o,u){if((c=Fu(c,n,o,u)).result==="error")return c;const f=c.value.expression,h=Eo(f);if(!h&&!au(n))return Wa([new Ns("","data expressions not supported")]);const _=Pi(f,["zoom","pitch","distance-from-center"]);if(!_&&!yg(n))return Wa([new Ns("","zoom expressions not supported")]);const w=Pi(f,["measure-light"]);if(!w&&!Cd(n))return Wa([new Ns("","measure-light expression not supported")]);const T=Pi(f,["line-progress"]);if(!T&&!function(A){return Ou(A.expression,"line-progress")}(n))return Wa([new Ns("","line-progress expression not supported")]);const P=n.expression&&n.expression.relaxZoomRestriction,x=Ae(f);return x||_||P?x instanceof Ns?Wa([x]):x instanceof Ia&&!Sf(n)?Wa([new Ns("",'"interpolate" expressions cannot be used with this property')]):Ch(x?new q(h&&T?"camera":"composite",c.value,x.labels,x instanceof Ia?x.interpolation:void 0,w,T):new D(h&&T?"constant":"source",c.value,w,T)):Wa([new Ns("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class de{constructor(n,o){this._parameters=n,this._specification=o,zr(this,xg(this._parameters,this._specification))}static deserialize(n){return new de(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Ae(c){let n=null;if(c instanceof bf)n=Ae(c.result);else if(c instanceof xf){for(const o of c.args)if(n=Ae(o),n)break}else(c instanceof Ma||c instanceof Ia)&&c.input instanceof Es&&c.input.name==="zoom"&&(n=c);return n instanceof Ns||c.eachChild(o=>{const u=Ae(o);u instanceof Ns?n=u:n&&u&&n!==u&&(n=new Ns("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var ke,ze,Ve=function(){if(ze)return ke;ze=1,ke=n;var c=3;function n(o,u,f){var h=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var _=new Int32Array(this.arrayBuffer);o=_[0],this.d=(u=_[1])+2*(f=_[2]);for(var w=0;w<this.d*this.d;w++){var T=_[c+w],P=_[c+w+1];h.push(T===P?null:_.subarray(T,P))}var x=_[c+h.length+1];this.keys=_.subarray(_[c+h.length],x),this.bboxes=_.subarray(x),this.insert=this._insertReadonly}else{this.d=u+2*f;for(var A=0;A<this.d*this.d;A++)h.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=f,this.scale=u/o,this.uid=0;var I=f/u*o;this.min=-I,this.max=o+I}return n.prototype.insert=function(o,u,f,h,_){this._forEachCell(u,f,h,_,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(h),this.bboxes.push(_)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(o,u,f,h,_,w){this.cells[_].push(w)},n.prototype.query=function(o,u,f,h,_){var w=this.min,T=this.max;if(o<=w&&u<=w&&T<=f&&T<=h&&!_)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(o,u,f,h,this._queryCell,P,{},_),P},n.prototype._queryCell=function(o,u,f,h,_,w,T,P){var x=this.cells[_];if(x!==null)for(var A=this.keys,I=this.bboxes,C=0;C<x.length;C++){var M=x[C];if(T[M]===void 0){var R=4*M;(P?P(I[R+0],I[R+1],I[R+2],I[R+3]):o<=I[R+2]&&u<=I[R+3]&&f>=I[R+0]&&h>=I[R+1])?(T[M]=!0,w.push(A[M])):T[M]=!1}}},n.prototype._forEachCell=function(o,u,f,h,_,w,T,P){for(var x=this._convertToCellCoord(o),A=this._convertToCellCoord(u),I=this._convertToCellCoord(f),C=this._convertToCellCoord(h),M=x;M<=I;M++)for(var R=A;R<=C;R++){var j=this.d*R+M;if((!P||P(this._convertFromCellCoord(M),this._convertFromCellCoord(R),this._convertFromCellCoord(M+1),this._convertFromCellCoord(R+1)))&&_.call(this,o,u,f,h,j,w,T,P))return}},n.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},n.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=c+this.cells.length+1+1,f=0,h=0;h<this.cells.length;h++)f+=this.cells[h].length;var _=new Int32Array(u+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var w=u,T=0;T<o.length;T++){var P=o[T];_[c+T]=w,_.set(P,w),w+=P.length}return _[c+o.length]=w,_.set(this.keys,w),_[c+o.length+1]=w+=this.keys.length,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer},ke}(),$e=E(Ve);const lt={};function Ze(c,n,o={}){Object.defineProperty(c,"_classRegistryKey",{value:n,writable:!1}),lt[n]={klass:c,omit:o.omit||[]}}Ze(Object,"Object"),$e.serialize=function(c,n){const o=c.toArrayBuffer();return n&&n.add(o),{buffer:o}},$e.deserialize=function(c){return new $e(c.buffer)},Object.defineProperty($e,"name",{value:"Grid"}),Ze($e,"Grid"),typeof DOMMatrix<"u"&&Ze(DOMMatrix,"DOMMatrix"),Ze(qr,"Color"),Ze(Error,"Error"),Ze(ls,"Formatted"),Ze(ha,"FormattedSection"),Ze(Ds,"AJAXError"),Ze(ds,"ResolvedImage"),Ze(de,"StylePropertyFunction"),Ze(nm,"StyleExpression",{omit:["_evaluator"]}),Ze(wo,"ImageId"),Ze(Ua,"ImageVariant"),Ze(q,"ZoomDependentExpression"),Ze(D,"ZoomConstantExpression"),Ze(Es,"CompoundExpression",{omit:["_evaluate"]});for(const c in Eh)lt[Eh[c]._classRegistryKey]||Ze(Eh[c],`Expression${c}`);function tn(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function nn(c){return self.ImageBitmap&&c instanceof ImageBitmap}function qt(c,n){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(tn(c)||nn(c))return n&&n.add(c),c;if(ArrayBuffer.isView(c))return n&&n.add(c.buffer),c;if(c instanceof ImageData)return n&&n.add(c.data.buffer),c;if(Array.isArray(c)){const o=[];for(const u of c)o.push(qt(u,n));return o}if(c instanceof Map){const o={$name:"Map",entries:[]};for(const[u,f]of c.entries())o.entries.push(qt(u),qt(f));return o}if(c instanceof Set){const o={$name:"Set"};let u=0;for(const f of c.values())o[++u]=qt(f);return o}if(c instanceof DOMMatrix){const o={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const f of u)o[f]=c[f];return o}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const o=c.constructor,u=o._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const f=o.serialize?o.serialize(c,n):{};if(!o.serialize){for(const h in c)c.hasOwnProperty(h)&&(lt[u].omit.indexOf(h)>=0||(f[h]=qt(c[h],n)));c instanceof Error&&(f.message=c.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof c)}function mn(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||tn(c)||nn(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(mn);if(typeof c=="object"){const n=c.$name||"Object";if(n==="Map"){const f=c.entries||[],h=new Map;for(let _=0;_<f.length;_+=2)h.set(mn(f[_]),mn(f[_+1]));return h}if(n==="Set"){const f=new Set;for(const h of Object.keys(c))h!=="$name"&&f.add(mn(c[h]));return f}if(n==="DOMMatrix"){let f;return f=c.is2D?[c.a,c.b,c.c,c.d,c.e,c.f]:[c.m11,c.m12,c.m13,c.m14,c.m21,c.m22,c.m23,c.m24,c.m31,c.m32,c.m33,c.m34,c.m41,c.m42,c.m43,c.m44],new DOMMatrix(f)}if(n==="BigInt")return BigInt(c.value);const{klass:o}=lt[n];if(!o)throw new Error(`Can't deserialize unregistered class "${n}".`);if(o.deserialize)return o.deserialize(c);const u=Object.create(o.prototype);for(const f of Object.keys(c))f!=="$name"&&(u[f]=mn(c[f]));return u}throw new Error("can't deserialize object of type "+typeof c)}const Pt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function Ot(c){for(const n of c)if(Pn(n.charCodeAt(0)))return!0;return!1}function Ut(c){for(const n of c)if(!wn(n.charCodeAt(0)))return!1;return!0}function wn(c){return!(Pt.Arabic(c)||Pt["Arabic Supplement"](c)||Pt["Arabic Extended-A"](c)||Pt["Arabic Presentation Forms-A"](c)||Pt["Arabic Presentation Forms-B"](c))}function Pn(c){return!(c!==746&&c!==747&&(c<4352||!(Pt["Bopomofo Extended"](c)||Pt.Bopomofo(c)||Pt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Pt["CJK Compatibility Ideographs"](c)||Pt["CJK Compatibility"](c)||Pt["CJK Radicals Supplement"](c)||Pt["CJK Strokes"](c)||!(!Pt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Pt["CJK Unified Ideographs Extension A"](c)||Pt["CJK Unified Ideographs"](c)||Pt["Enclosed CJK Letters and Months"](c)||Pt["Hangul Compatibility Jamo"](c)||Pt["Hangul Jamo Extended-A"](c)||Pt["Hangul Jamo Extended-B"](c)||Pt["Hangul Jamo"](c)||Pt["Hangul Syllables"](c)||Pt.Hiragana(c)||Pt["Ideographic Description Characters"](c)||Pt.Kanbun(c)||Pt["Kangxi Radicals"](c)||Pt["Katakana Phonetic Extensions"](c)||Pt.Katakana(c)&&c!==12540||!(!Pt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Pt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Pt["Unified Canadian Aboriginal Syllabics"](c)||Pt["Unified Canadian Aboriginal Syllabics Extended"](c)||Pt["Vertical Forms"](c)||Pt["Yijing Hexagram Symbols"](c)||Pt["Yi Syllables"](c)||Pt["Yi Radicals"](c))))}function Tn(c){return!(Pn(c)||function(n){return!!(Pt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Pt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Pt["Letterlike Symbols"](n)||Pt["Number Forms"](n)||Pt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Pt["Control Pictures"](n)&&n!==9251||Pt["Optical Character Recognition"](n)||Pt["Enclosed Alphanumerics"](n)||Pt["Geometric Shapes"](n)||Pt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Pt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Pt["CJK Symbols and Punctuation"](n)||Pt.Katakana(n)||Pt["Private Use Area"](n)||Pt["CJK Compatibility Forms"](n)||Pt["Small Form Variants"](n)||Pt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(c))}function rr(c){return Pt.Arabic(c)||Pt["Arabic Supplement"](c)||Pt["Arabic Extended-A"](c)||Pt["Arabic Presentation Forms-A"](c)||Pt["Arabic Presentation Forms-B"](c)}function qn(c){return c>=1424&&c<=2303||Pt["Arabic Presentation Forms-A"](c)||Pt["Arabic Presentation Forms-B"](c)}function Ar(c,n){return!(!n&&qn(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Pt.Khmer(c))}function Zn(c){for(const n of c)if(qn(n.charCodeAt(0)))return!0;return!1}const ki="deferred",mi="loading",Ti="loaded";let gi=null,oi="unavailable",Ai=null;const Hr=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(oi="error"),gi&&gi(c)};function xs(){ro.fire(new bo("pluginStateChange",{pluginStatus:oi,pluginURL:Ai}))}const ro=new Ta,bs=function(){return oi},ea=function(){if(oi!==ki||!Ai)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");oi=mi,xs(),Ai&&Wi({url:Ai},c=>{c?Hr(c):(oi=Ti,xs())})},ci={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>oi===Ti||ci.applyArabicShaping!=null,isLoading:()=>oi===mi,setState(c){oi=c.pluginStatus,Ai=c.pluginURL},isParsed:()=>ci.applyArabicShaping!=null&&ci.processBidirectionalText!=null&&ci.processStyledBidirectionalText!=null,getPluginURL:()=>Ai};class Nr{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(o,u){for(const f of o)if(!Ar(f.charCodeAt(0),u))return!1;return!0}(n,ci.isLoaded())}}class mo{constructor(n,o,u,f){this.property=n,this.value=o,this.expression=function(h,_,w,T){if(Tf(h))return new de(h,_);if(Ef(h)||Array.isArray(h)&&h.length>0){const P=ne(h,_,w,T);if(P.result==="error")throw new Error(P.value.map(x=>`${x.key}: ${x.message}`).join(", "));return P.value}{let P=h;return typeof h=="string"&&_.type==="color"&&(P=qr.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}}(o===void 0?n.specification.default:o,n.specification,u,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,u){return this.property.possiblyEvaluate(this,n,o,u)}}class Xs{constructor(n,o,u){this.property=n,this.value=new mo(n,void 0,o,u)}transitioned(n,o){return new go(this.property,this.value,o,si({},n.transition,this.transition),n.now)}untransitioned(){return new go(this.property,this.value,null,{},0)}}class io{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return di(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Xs(this._values[n].property,this._scope,this._options)),this._values[n].value=new mo(this._values[n].property,o===null?void 0:di(o),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,o){o&&(this._options=o);const u=this._properties.properties;if(n)for(const f in n){const h=n[f];if(f.endsWith("-transition")){const _=f.slice(0,-11);u[_]&&this.setTransition(_,h)}else u.hasOwnProperty(f)&&this.setValue(f,h)}}getTransition(n){return di(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Xs(this._values[n].property)),this._values[n].transition=di(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u);const f=this.getTransition(o);f!==void 0&&(n[`${o}-transition`]=f)}return n}transitioned(n,o){const u=new Uo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(n,o._values[f]);return u}untransitioned(){const n=new Uo(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class go{constructor(n,o,u,f,h){const _=f.delay||0,w=f.duration||0;h=h||0,this.property=n,this.value=o,this.begin=h+_,this.end=this.begin+w,n.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(n,o,u){const f=n.now||0,h=this.value.possiblyEvaluate(n,o,u),_=this.prior;if(_){if(f>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(f<this.begin)return _.possiblyEvaluate(n,o,u);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,o,u),h,Gn(w))}}return h}}class Uo{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,u){const f=new _a(this._properties);for(const h of Object.keys(this._values))f._values[h]=this._values[h].possiblyEvaluate(n,o,u);return f}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class ta{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return di(this._values[n].value)}setValue(n,o){this._values[n]=new mo(this._values[n].property,o===null?void 0:di(o),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u)}return n}possiblyEvaluate(n,o,u){const f=new _a(this._properties);for(const h of Object.keys(this._values))f._values[h]=this._values[h].possiblyEvaluate(n,o,u);return f}}class ws{constructor(n,o,u){this.property=n,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,u,f){return this.property.evaluate(this.value,this.parameters,n,o,u,f)}}class _a{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class an{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,u){const f=Mu[this.specification.type];return f?f(n,o,u):n}}class vn{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,u,f){return new ws(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},u,f)}:n.expression,o)}interpolate(n,o,u){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new ws(this,{kind:"constant",value:void 0},n.parameters);const f=Mu[this.specification.type];return f?new ws(this,{kind:"constant",value:f(n.value.value,o.value.value,u)},n.parameters):n}evaluate(n,o,u,f,h,_){return n.kind==="constant"?n.value:n.evaluate(o,u,f,h,_)}}class La{constructor(n){this.specification=n}possiblyEvaluate(n,o,u,f){return!!n.expression.evaluate(o,null,{},u,f)}interpolate(){return!1}}class Ir{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Nr(0,{});for(const u in n){const f=n[u];f.specification.overridable&&this.overridableProperties.push(u);const h=this.defaultPropertyValues[u]=new mo(f,void 0),_=this.defaultTransitionablePropertyValues[u]=new Xs(f);this.defaultTransitioningPropertyValues[u]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=h.possiblyEvaluate(o)}}}Ze(vn,"DataDrivenProperty"),Ze(an,"DataConstantProperty"),Ze(La,"ColorRampProperty");var Tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function rm(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Md(c){if(Array.isArray(c))return c.map(Md);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const n={};for(const o in c)n[o]=Md(c[o]);return n}return rm(c)}function Ph(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const n of c.slice(1))if(!Ph(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function Bu(c,n="",o=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ph(c)||(c=kd(c));const f=c;let h=!0;try{h=function(x){if(!Al(x))return x;let A=Md(x);return Za(A),A=Id(A),A}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let _=null,w=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){w=Tt[`filter_${u}`];const x=Fu(h,w,n,o);if(x.result==="error")throw new Error(x.value.map(A=>`${A.key}: ${A.message}`).join(", "));_=(A,I,C)=>x.value.evaluate(A,I,{},C)}let T=null,P=null;if(h!==f){const x=Fu(f,w,n,o);if(x.result==="error")throw new Error(x.value.map(A=>`${A.key}: ${A.message}`).join(", "));T=(A,I,C,M,R)=>x.value.evaluate(A,I,{},C,void 0,void 0,M,R),P=!Eo(x.value.expression)}return{filter:_,dynamicFilter:T||void 0,needGeometry:Ld(h),needFeature:!!P}}function Id(c){if(!Array.isArray(c))return c;const n=function(o){if(Mh.has(o[0])){for(let u=1;u<o.length;u++)if(Al(o[u]))return!0}return o}(c);return n===!0?n:n.map(o=>Id(o))}function Za(c){let n=!1;const o=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)n=n||Al(c[u]),o.push(c[u+1]);o.push(c[c.length-1])}else if(c[0]==="match"){n=n||Al(c[1]);for(let u=2;u<c.length-1;u+=2)o.push(c[u+1]);o.push(c[c.length-1])}else if(c[0]==="step"){n=n||Al(c[1]);for(let u=1;u<c.length-1;u+=2)o.push(c[u+1])}n&&(c.length=0,c.push("any",...o));for(let u=1;u<c.length;u++)Za(c[u])}function Al(c){if(!Array.isArray(c))return!1;if((n=c[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<c.length;o++)if(Al(c[o]))return!0;return!1}const Mh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wg(c,n){return c<n?-1:c>n?1:0}function Ld(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let n=1;n<c.length;n++)if(Ld(c[n]))return!0;return!1}function kd(c){if(!c)return!0;const n=c[0];return c.length<=1?n!=="any":n==="=="?El(c[1],c[2],"=="):n==="!="?Cl(El(c[1],c[2],"==")):n==="<"||n===">"||n==="<="||n===">="?El(c[1],c[2],n):n==="any"?(o=c.slice(1),["any"].concat(o.map(kd))):n==="all"?["all"].concat(c.slice(1).map(kd)):n==="none"?["all"].concat(c.slice(1).map(kd).map(Cl)):n==="in"?Rd(c[1],c.slice(2)):n==="!in"?Cl(Rd(c[1],c.slice(2))):n==="has"?Ih(c[1]):n!=="!has"||Cl(Ih(c[1]));var o}function El(c,n,o){switch(c){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,c,n]}}function Rd(c,n){if(n.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",c,["literal",n.sort(wg)]]:["filter-in-small",c,["literal",n]]}}function Ih(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Cl(c){return["!",c]}const Cf="";function Lh(c,n){return n?`${c}${Cf}${n}`:c}const Pl="-transition",Ic=new Set(["fill","line","background","hillshade","raster"]);class Ys extends Ta{constructor(n,o,u,f,h){if(super(),this.id=n.id,this.fqid=Lh(this.id,u),this.type=n.type,this.scope=u,this.lut=f,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"){if(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type&&n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"){this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter;const _=Fu(this.filter,Tt[`filter_${n.type}`]);_.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,..._.value.configDependencies]))}if(n.slot&&(this.slot=n.slot),o.layout&&(this._unevaluatedLayout=new ta(o.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint){this._transitionablePaint=new io(o.paint,this.scope,h);for(const _ in n.paint)this.setPaintProperty(_,n.paint[_]);for(const _ in n.layout)this.setLayoutProperty(_,n.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _a(o.paint)}}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D(!0)&&Ic.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o){if(this.type==="custom"&&n==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[n]&&(u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(n){return n.endsWith(Pl)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o){const u=this._transitionablePaint,f=u._properties.properties;if(n.endsWith(Pl)){const A=n.slice(0,-11);return f[A]&&u.setTransition(A,o||void 0),!1}if(!f[n])return!1;const h=u._values[n],_=h.value.isDataDriven(),w=h.value;u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const T=u._values[n].value,P=T.isDataDriven(),x=n.endsWith("pattern")||n==="line-dasharray";return P||_||x||this._handleOverridablePaintPropertyUpdate(n,w,T)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,o,u){return null}_handleOverridablePaintPropertyUpdate(n,o,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){return xo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}is3D(n){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof ws&&au(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=Bu(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,o,u,f,h,_,w,T,P){}}const v0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Dd{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class vi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Or(c,n=1){let o=0,u=0;return{members:c.map(f=>{const h=v0[f.type].BYTES_PER_ELEMENT,_=o=im(o,Math.max(n,h)),w=f.components||1;return u=Math.max(u,h),o+=h*w,{name:f.name,type:f.type,components:w,offset:_}}),size:im(o,Math.max(u,n)),alignment:n}}function im(c,n){return Math.ceil(c/n)*n}class ic extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const f=2*n;return this.int16[f+0]=o,this.int16[f+1]=u,n}}ic.prototype.bytesPerElement=4,Ze(ic,"StructArrayLayout2i4");class Lc extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){const h=3*n;return this.int16[h+0]=o,this.int16[h+1]=u,this.int16[h+2]=f,n}}Lc.prototype.bytesPerElement=6,Ze(Lc,"StructArrayLayout3i6");class Ml extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u,f)}emplace(n,o,u,f,h){const _=4*n;return this.int16[_+0]=o,this.int16[_+1]=u,this.int16[_+2]=f,this.int16[_+3]=h,n}}Ml.prototype.bytesPerElement=8,Ze(Ml,"StructArrayLayout4i8");class Il extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}Il.prototype.bytesPerElement=4,Ze(Il,"StructArrayLayout1f4");class kh extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){const h=4*n,_=2*n;return this.int16[h+0]=o,this.int16[h+1]=u,this.float32[_+1]=f,n}}kh.prototype.bytesPerElement=8,Ze(kh,"StructArrayLayout2i1f8");class sm extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){const h=4*n;return this.int16[h+0]=o,this.int16[h+1]=u,this.int16[h+2]=f,n}}sm.prototype.bytesPerElement=8,Ze(sm,"StructArrayLayout3i8");class na extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,u,f,h)}emplace(n,o,u,f,h,_){const w=5*n;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=f,this.int16[w+3]=h,this.int16[w+4]=_,n}}na.prototype.bytesPerElement=10,Ze(na,"StructArrayLayout5i10");class Pf extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,n,o,u,f,h,_,w)}emplace(n,o,u,f,h,_,w,T){const P=6*n,x=12*n,A=3*n;return this.int16[P+0]=o,this.int16[P+1]=u,this.uint8[x+4]=f,this.uint8[x+5]=h,this.uint8[x+6]=_,this.uint8[x+7]=w,this.float32[A+2]=T,n}}Pf.prototype.bytesPerElement=12,Ze(Pf,"StructArrayLayout2i4ub1f12");class ka extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){const h=3*n;return this.float32[h+0]=o,this.float32[h+1]=u,this.float32[h+2]=f,n}}ka.prototype.bytesPerElement=12,Ze(ka,"StructArrayLayout3f12");class ra extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,u,f,h)}emplace(n,o,u,f,h,_){const w=6*n,T=3*n;return this.uint16[w+0]=o,this.uint16[w+1]=u,this.uint16[w+2]=f,this.uint16[w+3]=h,this.float32[T+2]=_,n}}ra.prototype.bytesPerElement=12,Ze(ra,"StructArrayLayout4ui1f12");class Nd extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,f){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u,f)}emplace(n,o,u,f,h){const _=4*n;return this.uint16[_+0]=o,this.uint16[_+1]=u,this.uint16[_+2]=f,this.uint16[_+3]=h,n}}Nd.prototype.bytesPerElement=8,Ze(Nd,"StructArrayLayout4ui8");class Od extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,f,h,_)}emplace(n,o,u,f,h,_,w){const T=6*n;return this.int16[T+0]=o,this.int16[T+1]=u,this.int16[T+2]=f,this.int16[T+3]=h,this.int16[T+4]=_,this.int16[T+5]=w,n}}Od.prototype.bytesPerElement=12,Ze(Od,"StructArrayLayout6i12");class om extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w,T,P,x,A,I){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,u,f,h,_,w,T,P,x,A,I)}emplace(n,o,u,f,h,_,w,T,P,x,A,I,C){const M=12*n;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=f,this.int16[M+3]=h,this.uint16[M+4]=_,this.uint16[M+5]=w,this.uint16[M+6]=T,this.uint16[M+7]=P,this.int16[M+8]=x,this.int16[M+9]=A,this.int16[M+10]=I,this.int16[M+11]=C,n}}om.prototype.bytesPerElement=24,Ze(om,"StructArrayLayout4i4ui4i24");class Mf extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,f,h,_)}emplace(n,o,u,f,h,_,w){const T=10*n,P=5*n;return this.int16[T+0]=o,this.int16[T+1]=u,this.int16[T+2]=f,this.float32[P+2]=h,this.float32[P+3]=_,this.float32[P+4]=w,n}}Mf.prototype.bytesPerElement=20,Ze(Mf,"StructArrayLayout3i3f20");class Ka extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u,f)}emplace(n,o,u,f,h){const _=4*n;return this.float32[_+0]=o,this.float32[_+1]=u,this.float32[_+2]=f,this.float32[_+3]=h,n}}Ka.prototype.bytesPerElement=16,Ze(Ka,"StructArrayLayout4f16");class am extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}am.prototype.bytesPerElement=4,Ze(am,"StructArrayLayout1ul4");class kc extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const f=2*n;return this.uint16[f+0]=o,this.uint16[f+1]=u,n}}kc.prototype.bytesPerElement=4,Ze(kc,"StructArrayLayout2ui4");class lm extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w,T,P,x,A,I,C){const M=this.length;return this.resize(M+1),this.emplace(M,n,o,u,f,h,_,w,T,P,x,A,I,C)}emplace(n,o,u,f,h,_,w,T,P,x,A,I,C,M){const R=20*n,j=10*n;return this.int16[R+0]=o,this.int16[R+1]=u,this.int16[R+2]=f,this.int16[R+3]=h,this.int16[R+4]=_,this.float32[j+3]=w,this.float32[j+4]=T,this.float32[j+5]=P,this.float32[j+6]=x,this.int16[R+14]=A,this.uint32[j+8]=I,this.uint16[R+18]=C,this.uint16[R+19]=M,n}}lm.prototype.bytesPerElement=40,Ze(lm,"StructArrayLayout5i4f1i1ul2ui40");class Rh extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,n,o,u,f,h,_,w)}emplace(n,o,u,f,h,_,w,T){const P=8*n;return this.int16[P+0]=o,this.int16[P+1]=u,this.int16[P+2]=f,this.int16[P+4]=h,this.int16[P+5]=_,this.int16[P+6]=w,this.int16[P+7]=T,n}}Rh.prototype.bytesPerElement=16,Ze(Rh,"StructArrayLayout3i2i2i16");class cm extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,u,f,h)}emplace(n,o,u,f,h,_){const w=4*n,T=8*n;return this.float32[w+0]=o,this.float32[w+1]=u,this.float32[w+2]=f,this.int16[T+6]=h,this.int16[T+7]=_,n}}cm.prototype.bytesPerElement=16,Ze(cm,"StructArrayLayout2f1f2i16");class ju extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,f,h,_)}emplace(n,o,u,f,h,_,w){const T=20*n,P=5*n;return this.uint8[T+0]=o,this.uint8[T+1]=u,this.float32[P+1]=f,this.float32[P+2]=h,this.float32[P+3]=_,this.float32[P+4]=w,n}}ju.prototype.bytesPerElement=20,Ze(ju,"StructArrayLayout2ub4f20");class Os extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,u)}emplace(n,o,u,f){const h=3*n;return this.uint16[h+0]=o,this.uint16[h+1]=u,this.uint16[h+2]=f,n}}Os.prototype.bytesPerElement=6,Ze(Os,"StructArrayLayout3ui6");class Uu extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$,Y,X,Z,re){const ae=this.length;return this.resize(ae+1),this.emplace(ae,n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$,Y,X,Z,re)}emplace(n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$,Y,X,Z,re,ae){const ue=30*n,Ce=15*n,we=60*n;return this.int16[ue+0]=o,this.int16[ue+1]=u,this.int16[ue+2]=f,this.float32[Ce+2]=h,this.float32[Ce+3]=_,this.uint16[ue+8]=w,this.uint16[ue+9]=T,this.uint32[Ce+5]=P,this.uint32[Ce+6]=x,this.uint32[Ce+7]=A,this.uint16[ue+16]=I,this.uint16[ue+17]=C,this.uint16[ue+18]=M,this.float32[Ce+10]=R,this.float32[Ce+11]=j,this.uint8[we+48]=$,this.uint8[we+49]=Y,this.uint8[we+50]=X,this.uint32[Ce+13]=Z,this.int16[ue+28]=re,this.uint8[we+58]=ae,n}}Uu.prototype.bytesPerElement=60,Ze(Uu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Xa extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$,Y,X,Z,re,ae,ue,Ce,we,Se,He,Pe,We,st,tt,ft,ht){const bt=this.length;return this.resize(bt+1),this.emplace(bt,n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$,Y,X,Z,re,ae,ue,Ce,we,Se,He,Pe,We,st,tt,ft,ht)}emplace(n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$,Y,X,Z,re,ae,ue,Ce,we,Se,He,Pe,We,st,tt,ft,ht,bt){const gt=20*n,At=40*n,en=80*n;return this.float32[gt+0]=o,this.float32[gt+1]=u,this.int16[At+4]=f,this.int16[At+5]=h,this.int16[At+6]=_,this.int16[At+7]=w,this.int16[At+8]=T,this.int16[At+9]=P,this.int16[At+10]=x,this.int16[At+11]=A,this.int16[At+12]=I,this.uint16[At+13]=C,this.uint16[At+14]=M,this.uint16[At+15]=R,this.uint16[At+16]=j,this.uint16[At+17]=$,this.uint16[At+18]=Y,this.uint16[At+19]=X,this.uint16[At+20]=Z,this.uint16[At+21]=re,this.uint16[At+22]=ae,this.uint16[At+23]=ue,this.uint16[At+24]=Ce,this.uint16[At+25]=we,this.uint16[At+26]=Se,this.uint16[At+27]=He,this.uint32[gt+14]=Pe,this.float32[gt+15]=We,this.float32[gt+16]=st,this.float32[gt+17]=tt,this.float32[gt+18]=ft,this.uint8[en+76]=ht,this.uint16[At+39]=bt,n}}Xa.prototype.bytesPerElement=80,Ze(Xa,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class zs extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,u,f,h)}emplace(n,o,u,f,h,_){const w=5*n;return this.float32[w+0]=o,this.float32[w+1]=u,this.float32[w+2]=f,this.float32[w+3]=h,this.float32[w+4]=_,n}}zs.prototype.bytesPerElement=20,Ze(zs,"StructArrayLayout5f20");class Ll extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,n,o,u,f,h,_,w)}emplace(n,o,u,f,h,_,w,T){const P=7*n;return this.float32[P+0]=o,this.float32[P+1]=u,this.float32[P+2]=f,this.float32[P+3]=h,this.float32[P+4]=_,this.float32[P+5]=w,this.float32[P+6]=T,n}}Ll.prototype.bytesPerElement=28,Ze(Ll,"StructArrayLayout7f28");class Dh extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w,T,P,x,A){const I=this.length;return this.resize(I+1),this.emplace(I,n,o,u,f,h,_,w,T,P,x,A)}emplace(n,o,u,f,h,_,w,T,P,x,A,I){const C=11*n;return this.float32[C+0]=o,this.float32[C+1]=u,this.float32[C+2]=f,this.float32[C+3]=h,this.float32[C+4]=_,this.float32[C+5]=w,this.float32[C+6]=T,this.float32[C+7]=P,this.float32[C+8]=x,this.float32[C+9]=A,this.float32[C+10]=I,n}}Dh.prototype.bytesPerElement=44,Ze(Dh,"StructArrayLayout11f44");class zd extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w,T,P){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,u,f,h,_,w,T,P)}emplace(n,o,u,f,h,_,w,T,P,x){const A=9*n;return this.float32[A+0]=o,this.float32[A+1]=u,this.float32[A+2]=f,this.float32[A+3]=h,this.float32[A+4]=_,this.float32[A+5]=w,this.float32[A+6]=T,this.float32[A+7]=P,this.float32[A+8]=x,n}}zd.prototype.bytesPerElement=36,Ze(zd,"StructArrayLayout9f36");class Vu extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const f=2*n;return this.float32[f+0]=o,this.float32[f+1]=u,n}}Vu.prototype.bytesPerElement=8,Ze(Vu,"StructArrayLayout2f8");class Fd extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,f){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u,f)}emplace(n,o,u,f,h){const _=6*n;return this.uint32[3*n+0]=o,this.uint16[_+2]=u,this.uint16[_+3]=f,this.uint16[_+4]=h,n}}Fd.prototype.bytesPerElement=12,Ze(Fd,"StructArrayLayout1ul3ui12");class Nh extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}Nh.prototype.bytesPerElement=2,Ze(Nh,"StructArrayLayout1ui2");class Oh extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j){const $=this.length;return this.resize($+1),this.emplace($,n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j)}emplace(n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$){const Y=16*n;return this.float32[Y+0]=o,this.float32[Y+1]=u,this.float32[Y+2]=f,this.float32[Y+3]=h,this.float32[Y+4]=_,this.float32[Y+5]=w,this.float32[Y+6]=T,this.float32[Y+7]=P,this.float32[Y+8]=x,this.float32[Y+9]=A,this.float32[Y+10]=I,this.float32[Y+11]=C,this.float32[Y+12]=M,this.float32[Y+13]=R,this.float32[Y+14]=j,this.float32[Y+15]=$,n}}Oh.prototype.bytesPerElement=64,Ze(Oh,"StructArrayLayout16f64");class Sg extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,f,h,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,n,o,u,f,h,_,w)}emplace(n,o,u,f,h,_,w,T){const P=10*n,x=5*n;return this.uint16[P+0]=o,this.uint16[P+1]=u,this.uint16[P+2]=f,this.uint16[P+3]=h,this.float32[x+2]=_,this.float32[x+3]=w,this.float32[x+4]=T,n}}Sg.prototype.bytesPerElement=20,Ze(Sg,"StructArrayLayout4ui3f20");class Tg extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.int16[1*n+0]=o,n}}Tg.prototype.bytesPerElement=2,Ze(Tg,"StructArrayLayout1i2");class x0 extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint8[1*n+0]=o,n}}x0.prototype.bytesPerElement=1,Ze(x0,"StructArrayLayout1ub1");class b0 extends Dd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}b0.prototype.size=40;class um extends lm{get(n){return new b0(this,n)}}Ze(um,"CollisionBoxArray");class jv extends Dd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}jv.prototype.size=60;class Uv extends Uu{get(n){return new jv(this,n)}}Ze(Uv,"PlacedSymbolArray");class Vv extends Dd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Vv.prototype.size=80;class qv extends Xa{get(n){return new Vv(this,n)}}Ze(qv,"SymbolInstanceArray");class $v extends Il{getoffsetX(n){return this.float32[1*n+0]}}Ze($v,"GlyphOffsetArray");class hm extends ic{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Ze(hm,"SymbolLineVertexArray");class dm extends Dd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}dm.prototype.size=12;class Ya extends Fd{get(n){return new dm(this,n)}}Ze(Ya,"FeatureIndexArray");class fm extends kc{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Ze(fm,"FillExtrusionCentroidArray");class Gv extends Dd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Gv.prototype.size=6;class Hv extends Lc{get(n){return new Gv(this,n)}}Ze(Hv,"FillExtrusionWallArray");const kw=Or([{name:"a_pos",components:2,type:"Int16"}],4),Rw=Or([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class qi{constructor(n=[]){this.segments=n}_prepareSegment(n,o,u,f){let h=this.segments[this.segments.length-1];return n>qi.MAX_VERTEX_ARRAY_LENGTH&&pi(`Max vertices per segment is ${qi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!h||h.vertexLength+n>qi.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==f)&&(h={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},f!==void 0&&(h.sortKey=f),this.segments.push(h)),h}prepareSegment(n,o,u,f){return this._prepareSegment(n,o.length,u.length,f)}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,u,f){return new qi([{vertexOffset:n,primitiveOffset:o,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}function Wv(c,n){return 256*(c=Ln(Math.floor(c),0,255))+Ln(Math.floor(n),0,255)}qi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ze(qi,"SegmentVector");const w0=Or([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Dw=Or([{name:"a_dash",components:4,type:"Uint16"}]);class pm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,o,u,f){this.ids.push(S0(n)),this.positions.push(o,u,f)}eachPosition(n,o){const u=S0(n);let f=0,h=this.ids.length-1;for(;f<h;){const _=f+h>>1;this.ids[_]>=u?h=_:f=_+1}for(;this.ids[f]===u;)o(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(n,o){const u=new Float64Array(n.ids),f=new Uint32Array(n.positions);return mm(u,f,0,u.length-1),o&&(o.add(u.buffer),o.add(f.buffer)),{ids:u,positions:f}}static deserialize(n){const o=new pm;let u;o.ids=n.ids,o.positions=n.positions;for(const f of o.ids)f!==u&&o.uniqueIds.push(f),u=f;return o.indexed=!0,o}}function S0(c){const n=+c;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Wo(String(c))}function mm(c,n,o,u){for(;o<u;){const f=c[o+u>>1];let h=o-1,_=u+1;for(;;){do h++;while(c[h]<f);do _--;while(c[_]>f);if(h>=_)break;Ag(c,h,_),Ag(n,3*h,3*_),Ag(n,3*h+1,3*_+1),Ag(n,3*h+2,3*_+2)}_-o<u-_?(mm(c,n,o,_),o=_+1):(mm(c,n,_+1,u),u=_)}}function Ag(c,n,o){const u=c[n];c[n]=c[o],c[o]=u}Ze(pm,"FeaturePositionMap");class lu{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}set(n,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class gm extends lu{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Ss extends lu{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class sc extends lu{constructor(n){super(n),this.current=[0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class If extends lu{constructor(n){super(n),this.current=[0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class _m extends lu{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Zv extends lu{constructor(n){super(n),this.current=qr.transparent.toRenderColor(null)}set(n,o,u){this.fetchUniformLocation(n,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const Kv=new Float32Array(16);class ym extends lu{constructor(n){super(n),this.current=Kv}set(n,o,u){if(this.fetchUniformLocation(n,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let f=1;f<16;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const T0=new Float32Array(9),Nw=new Float32Array(4);class A0 extends lu{constructor(n){super(n),this.current=Nw}set(n,o,u){if(this.fetchUniformLocation(n,o)){for(let f=0;f<4;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function E0(c){return[Wv(255*c.r,255*c.g),Wv(255*c.b,255*c.a)]}class vm{constructor(n,o,u,f){this.value=n,this.uniformNames=o.map(h=>`u_${h}`),this.type=u,this.context=f}setUniform(n,o,u,f,h){const _=f.constantOr(this.value);o.set(n,h,_ instanceof qr?_.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(n,o){return this.type==="color"?new Zv(n):new Ss(n)}}class Bd{constructor(n,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,o,u,f,h){const _=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;_&&o.set(n,h,_)}getBinding(n,o){return o==="u_pattern"||o==="u_dash"?new _m(n):new Ss(n)}}class qu{constructor(n,o,u,f){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(h=>({name:`a_${h}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(n,o,u,f,h,_,w){const T=this.paintVertexArray.length,P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Nr(0,{brightness:_}),o,{},h,f,w):this.expression.kind==="constant"&&this.expression.value,x=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Nr(0,{brightness:_}),o,{},h,f,w):this.lutExpression.value)==="none";this.paintVertexArray.resize(n),this._setPaintValue(T,n,P,x?null:this.context.lut)}updatePaintArray(n,o,u,f,h,_,w){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w},u,f,void 0,h):this.expression.kind==="constant"&&this.expression.value,P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Nr(0,{brightness:w}),u,f,void 0,h):this.lutExpression.value)==="none";this._setPaintValue(n,o,T,P?null:this.context.lut)}_setPaintValue(n,o,u,f){if(this.type==="color"){const h=E0(u.toRenderColor(f));for(let _=n;_<o;_++)this.paintVertexArray.emplace(_,h[0],h[1])}else{for(let h=n;h<o;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rc{constructor(n,o,u,f,h,_){this.expression=n,this.uniformNames=o.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=f,this.context=h,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,o,u,f,h,_,w){const T=this.expression.evaluate(new Nr(this.context.zoom,{brightness:_}),o,{},h,f,w),P=this.expression.evaluate(new Nr(this.context.zoom+1,{brightness:_}),o,{},h,f,w),x=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Nr(0,{brightness:_}),o,{},h,f,w):this.lutExpression.value)==="none",A=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(A,n,T,P,x?null:this.context.lut)}updatePaintArray(n,o,u,f,h,_,w){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:w},u,f,void 0,h),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},u,f,void 0,h),x=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Nr(0,{brightness:w}),u,f,void 0,h):this.lutExpression.value)==="none";this._setPaintValue(n,o,T,P,x?null:this.context.lut)}_setPaintValue(n,o,u,f,h){if(this.type==="color"){const _=E0(u.toRenderColor(h)),w=E0(u.toRenderColor(h));for(let T=n;T<o;T++)this.paintVertexArray.emplace(T,_[0],_[1],w[0],w[1])}else{for(let _=n;_<o;_++)this.paintVertexArray.emplace(_,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,u,f,h){const _=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,w=Ln(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);o.set(n,h,w)}getBinding(n,o){return new Ss(n)}}class zh{constructor(n,o,u,f,h){this.expression=n,this.layerId=h,this.paintVertexAttributes=(u==="array"?Dw:w0).members;for(let _=0;_<o.length;++_);this.paintVertexArray=new f}populatePaintArray(n,o,u,f){const h=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(h,n,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(n,o,u,f,h,_,w){this._setPaintValues(n,o,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(n,o,u,f){if(!f||!u)return;const h=f[u];if(!h)return;const{tl:_,br:w,pixelRatio:T}=h;for(let P=n;P<o;P++)this.paintVertexArray.emplace(P,_[0],_[1],w[0],w[1],T)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jd{constructor(n,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const f=[];for(const h in n.paint._values){const _=n.paint.get(h);if(h.endsWith("-use-theme")||!u(h)||!(_ instanceof ws&&au(_.property.specification)))continue;const w=zw(h,n.type),T=_.value,P=_.property.specification.type,x=!!_.property.useIntegerZoom,A=h==="line-dasharray"||h.endsWith("pattern"),I=n.paint.get(`${h}-use-theme`),C=h==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant"||I&&I.value.kind!=="constant";if(T.kind!=="constant"||C)if(T.kind==="source"||C||A){const M=Xv(h,P,"source");this.binders[h]=A?new zh(T,w,P,M,n.id):new qu(T,w,P,M),f.push(`/a_${h}`)}else{const M=Xv(h,P,"composite");this.binders[h]=new Rc(T,w,P,x,o,M),f.push(`/z_${h}`)}else this.binders[h]=A?new Bd(T.value,w):new vm(T.value,w,P,o),f.push(`/u_${h}`);I&&(this.binders[h].lutExpression=I.value)}this.cacheKey=f.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof qu||o instanceof Rc?o.maxValue:0}populatePaintArrays(n,o,u,f,h,_,w){for(const T in this.binders){const P=this.binders[T];P.context=this.context,(P instanceof qu||P instanceof Rc||P instanceof zh)&&P.populatePaintArray(n,o,u,f,h,_,w)}}setConstantPatternPositions(n){for(const o in this.binders){const u=this.binders[o];u instanceof Bd&&u.setConstantPatternPositions(n)}}updatePaintArrays(n,o,u,f,h,_,w,T,P){let x=!1;const A=Object.keys(n),I=A.length!==0&&!T,C=I?A:o.uniqueIds;this.context.lut=h.lut;for(const M in this.binders){const R=this.binders[M];if(R.context=this.context,(R instanceof qu||R instanceof Rc||R instanceof zh)&&R.expression&&R.expression.kind&&R.expression.kind!=="constant"&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const j=h.paint.get(M);R.expression=j.value;for(const $ of C){const Y=n[$.toString()];o.eachPosition($,(X,Z,re)=>{const ae=f.feature(X);R.updatePaintArray(Z,re,ae,Y,_,w,P)})}if(!I)for(const $ of u.uniqueIds){const Y=n[$.toString()];u.eachPosition($,(X,Z,re)=>{const ae=f.feature(X);R.updatePaintArray(Z,re,ae,Y,_,w,P)})}x=!0}}return x}defines(){const n=[];for(const o in this.binders){const u=this.binders[o];(u instanceof vm||u instanceof Bd)&&n.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof qu||u instanceof Rc||u instanceof zh)for(let f=0;f<u.paintVertexAttributes.length;f++)n.push(u.paintVertexAttributes[f].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof vm||u instanceof Bd||u instanceof Rc)for(const f of u.uniformNames)n.push(f)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof vm||f instanceof Bd||f instanceof Rc)for(const h of f.uniformNames)o.push({name:h,property:u,binding:f.getBinding(n,h)})}return o}setUniforms(n,o,u,f,h){for(const{name:_,property:w,binding:T}of u)this.binders[w].setUniform(n,T,h,f.get(w),_)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof qu||o instanceof Rc||o instanceof zh)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(n){for(const o in this.binders){const u=this.binders[o];(u instanceof qu||u instanceof Rc||u instanceof zh)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof qu||o instanceof Rc||o instanceof zh)&&o.destroy()}}}class Fh{constructor(n,o,u=()=>!0){this.programConfigurations={};for(const f of n)this.programConfigurations[f.id]=new jd(f,o,u);this.needsUpload=!1,this._featureMap=new pm,this._featureMapWithoutIds=new pm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,o,u,f,h,_,w,T){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(n,o,f,h,_,w,T);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,u,f,h,_,w){for(const T of u)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,o,T,f,h,_,w||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const Ow={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function zw(c,n){return Ow[c]||[c.replace(`${n}-`,"").replace(/-/g,"_")]}const Fw={"line-pattern":{source:ra,composite:ra},"fill-pattern":{source:ra,composite:ra},"fill-extrusion-pattern":{source:ra,composite:ra},"line-dasharray":{source:Nd,composite:Nd}},Eg={color:{source:Vu,composite:Ka},number:{source:Il,composite:Vu}};function Xv(c,n,o){const u=Fw[c];return u&&u[o]||Eg[n][o]}Ze(vm,"ConstantBinder"),Ze(Bd,"PatternConstantBinder"),Ze(qu,"SourceExpressionBinder"),Ze(zh,"PatternCompositeBinder"),Ze(Rc,"CompositeExpressionBinder"),Ze(jd,"ProgramConfiguration",{omit:["_buffers"]}),Ze(Fh,"ProgramConfigurationSet");const ya=un/Math.PI/2,Lf=5,Yv=6,Jv=16383,kf=64,Cg=[kf,32,16],kl=-ya,Rl=ya;function Rf(c,n,o,u=ya){return o=En(o),[c*Math.sin(o)*u,-n*u,c*Math.cos(o)*u]}function Ud(c,n,o){return Rf(Math.cos(En(c)),Math.sin(En(c)),n,o)}const Vd=63710088e-1,C0=2*Math.PI*Vd;class ni{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ni(Kr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,u=this.lat*o,f=n.lat*o,h=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((n.lng-this.lng)*o);return Vd*Math.acos(Math.min(h,1))}toBounds(n=0){const o=360*n/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Bh({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(n){return Ud(this.lat,this.lng,ya+n*ya/Vd)}static convert(n){if(n instanceof ni)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new ni(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new ni(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Bh{constructor(n,o){if(n)if(o)this.setSouthWest(n).setNorthEast(o);else if(n.length===4){const u=n;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=n;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(n){return this._ne=n instanceof ni?new ni(n.lng,n.lat):ni.convert(n),this}setSouthWest(n){return this._sw=n instanceof ni?new ni(n.lng,n.lat):ni.convert(n),this}extend(n){const o=this._sw,u=this._ne;let f,h;if(n instanceof ni)f=n,h=n;else{if(!(n instanceof Bh))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Bh.convert(n)):this.extend(ni.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(ni.convert(n)):this;if(f=n._sw,h=n._ne,!f||!h)return this}return o||u?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),u.lng=Math.max(h.lng,u.lng),u.lat=Math.max(h.lat,u.lat)):(this._sw=new ni(f.lng,f.lat),this._ne=new ni(h.lng,h.lat)),this}getCenter(){return new ni((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ni(this.getWest(),this.getNorth())}getSouthEast(){return new ni(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:u}=ni.convert(n);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(n){if(n)return n instanceof Bh?n:new Bh(n)}}const Bw=0,jw=25.5;function Pg(c){return C0*Math.cos(c*Math.PI/180)}function cu(c){return(180+c)/360}function Ja(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Vo(c,n){return c/Pg(n)}function Qa(c){return 360*c-180}function Po(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function P0(c,n){return c*Pg(Po(n))}const ps=85.051129;function Qv(c){return Math.cos(En(Ln(c,-ps,ps)))}function jh(c,n){const o=Ln(n,Bw,jw),u=Math.pow(2,o);return Qv(c)*C0/(512*u)}function Uw(c){return 1/Math.cos(c*Math.PI/180)}function m(c,n=0){const o=Math.exp(Math.PI*(1-(c.y+n/un)/(1<<c.z)*2));return 80150034*o/(o*o+1)/un/(1<<c.z)}class r{constructor(n,o,u=0){this.x=+n,this.y=+o,this.z=+u}static fromLngLat(n,o=0){const u=ni.convert(n);return new r(cu(u.lng),Ja(u.lat),Vo(o,u.lat))}toLngLat(){return new ni(Qa(this.x),Po(this.y))}toAltitude(){return P0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/C0*Uw(Po(this.y))}}function l(c,n,o,u,f,h,_,w,T){const P=(n+u)/2,x=(o+f)/2,A=new $t(P,x);w(A),function(I,C,M,R,j,$){const Y=M-j,X=R-$;return Math.abs((R-C)*Y-(M-I)*X)/Math.hypot(Y,X)}(A.x,A.y,h.x,h.y,_.x,_.y)>=T?(l(c,n,o,P,x,h,A,w,T),l(c,P,x,u,f,A,_,w,T)):c.push(_)}function p(c,n,o){let u=c[0],f=u.x,h=u.y;n(u);const _=[u];for(let w=1;w<c.length;w++){const T=c[w],{x:P,y:x}=T;n(T),l(_,f,h,P,x,u,T,n,o),f=P,h=x,u=T}return _}function y(c,n,o,u){if(u(n,o)){const f=n.add(o)._mult(.5);y(c,n,f,u),y(c,f,o,u)}else c.push(o)}function b(c,n){let o=c[0];const u=[o];for(let f=1;f<c.length;f++){const h=c[f];y(u,o,h,n),o=h}return u}const S=Math.pow(2,14)-1,L=-S-1;function N(c,n){const o=Math.round(c.x*n),u=Math.round(c.y*n);return c.x=Ln(o,L,S),c.y=Ln(u,L,S),(o<c.x||o>c.x+1||u<c.y||u>c.y+1)&&pi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function F(c,n,o){const u=c.loadGeometry(),f=c.extent,h=un/f;if(n&&o&&o.projection.isReprojectedInTileSpace){const _=1<<n.z,{scale:w,x:T,y:P,projection:x}=o,A=I=>{const C=Qa((n.x+I.x/f)/_),M=Po((n.y+I.y/f)/_),R=x.project(C,M);I.x=(R.x*w-T)*f,I.y=(R.y*w-P)*f};for(let I=0;I<u.length;I++)if(c.type!==1)u[I]=p(u[I],A,1);else{const C=[];for(const M of u[I])M.x<0||M.x>=f||M.y<0||M.y>=f||(A(M),C.push(M));u[I]=C}}for(const _ of u)for(const w of _)N(w,h);return u}function B(c,n){return{type:c.type,id:c.id,properties:c.properties,geometry:n?F(c):[]}}function H(c,n,o,u,f){c.emplaceBack(2*n+(u+1)/2,2*o+(f+1)/2)}function W(c,n,o){c.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class ee{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new ic,this.indexArray=new Os,this.segments=new qi,this.programConfigurations=new Fh(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(n,o){}populate(n,o,u,f){const h=this.layers[0],_=[];let w=null;h.type==="circle"&&(w=h.layout.get("circle-sort-key"));for(const{feature:P,id:x,index:A,sourceLayerIndex:I}of n){const C=this.layers[0]._featureFilter.needGeometry,M=B(P,C);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom),M,u))continue;const R=w?w.evaluate(M,{},u):void 0,j={id:x,properties:P.properties,type:P.type,sourceLayerIndex:I,index:A,geometry:C?M.geometry:F(P,u,f),patterns:{},sortKey:R};_.push(j)}w&&_.sort((P,x)=>P.sortKey-x.sortKey);let T=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new Od,T=f.projection);for(const P of _){const{geometry:x,index:A,sourceLayerIndex:I}=P,C=n[A].feature;this.addFeature(P,x,A,o.availableImages,u,T,o.brightness),o.featureIndex.insert(C,x,A,I,this.index)}}update(n,o,u,f,h,_,w){this.programConfigurations.updatePaintArrays(n,o,h,u,f,_,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,kw.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,Rw.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,u,f,h,_,w){for(const T of o)for(const P of T){const x=P.x,A=P.y;if(x<0||x>=un||A<0||A>=un)continue;if(_){const M=_.projectTilePoint(x,A,h),R=_.upVector(h,x,A),j=this.globeExtVertexArray;W(j,M,R),W(j,M,R),W(j,M,R),W(j,M,R)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),C=I.vertexLength;H(this.layoutVertexArray,x,A,-1,-1),H(this.layoutVertexArray,x,A,1,-1),H(this.layoutVertexArray,x,A,1,1),H(this.layoutVertexArray,x,A,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},f,h,w)}}function ce(c,n){for(let o=0;o<c.length;o++)if(je(n,c[o]))return!0;for(let o=0;o<n.length;o++)if(je(c,n[o]))return!0;return!!Te(c,n)}function oe(c,n,o){return!!je(c,n)||!!Ie(n,c,o)}function fe(c,n){if(c.length===1)return Be(n,c[0]);for(let o=0;o<n.length;o++){const u=n[o];for(let f=0;f<u.length;f++)if(je(c,u[f]))return!0}for(let o=0;o<c.length;o++)if(Be(n,c[o]))return!0;for(let o=0;o<n.length;o++)if(Te(c,n[o]))return!0;return!1}function pe(c,n,o){if(c.length>1){if(Te(c,n))return!0;for(let u=0;u<n.length;u++)if(Ie(n[u],c,o))return!0}for(let u=0;u<c.length;u++)if(Ie(c[u],n,o))return!0;return!1}function Te(c,n){if(c.length===0||n.length===0)return!1;for(let o=0;o<c.length-1;o++){const u=c[o],f=c[o+1];for(let h=0;h<n.length-1;h++)if(De(u,f,n[h],n[h+1]))return!0}return!1}function De(c,n,o,u){return lr(c,o,u)!==lr(n,o,u)&&lr(c,n,o)!==lr(c,n,u)}function Ie(c,n,o){const u=o*o;if(n.length===1)return c.distSqr(n[0])<u;for(let f=1;f<n.length;f++)if(Ge(c,n[f-1],n[f])<u)return!0;return!1}function Ge(c,n,o){const u=n.distSqr(o);if(u===0)return c.distSqr(n);const f=((c.x-n.x)*(o.x-n.x)+(c.y-n.y)*(o.y-n.y))/u;return c.distSqr(f<0?n:f>1?o:o.sub(n)._mult(f)._add(n))}function Be(c,n){let o,u,f,h=!1;for(let _=0;_<c.length;_++){o=c[_];for(let w=0,T=o.length-1;w<o.length;T=w++)u=o[w],f=o[T],u.y>n.y!=f.y>n.y&&n.x<(f.x-u.x)*(n.y-u.y)/(f.y-u.y)+u.x&&(h=!h)}return h}function je(c,n){let o=!1;for(let u=0,f=c.length-1;u<c.length;f=u++){const h=c[u],_=c[f];h.y>n.y!=_.y>n.y&&n.x<(_.x-h.x)*(n.y-h.y)/(_.y-h.y)+h.x&&(o=!o)}return o}function Ue(c,n,o,u,f){for(const _ of c)if(n<=_.x&&o<=_.y&&u>=_.x&&f>=_.y)return!0;const h=[new $t(n,o),new $t(n,f),new $t(u,f),new $t(u,o)];if(c.length>2){for(const _ of h)if(je(c,_))return!0}for(let _=0;_<c.length-1;_++)if(Ke(c[_],c[_+1],h))return!0;return!1}function Ke(c,n,o){const u=o[0],f=o[2];if(c.x<u.x&&n.x<u.x||c.x>f.x&&n.x>f.x||c.y<u.y&&n.y<u.y||c.y>f.y&&n.y>f.y)return!1;const h=lr(c,n,o[0]);return h!==lr(c,n,o[1])||h!==lr(c,n,o[2])||h!==lr(c,n,o[3])}function nt(c,n,o,u,f,h){let _=n.y-c.y,w=c.x-n.x;if(h=h||0){const T=_*_+w*w;if(T===0)return!0;const P=Math.sqrt(T);_/=P,w/=P}return!((o.x-c.x)*_+(o.y-c.y)*w-h<0||(u.x-c.x)*_+(u.y-c.y)*w-h<0||(f.x-c.x)*_+(f.y-c.y)*w-h<0)}function kt(c,n,o,u,f,h,_){return!(nt(c,n,u,f,h,_)||nt(n,o,u,f,h,_)||nt(o,c,u,f,h,_)||nt(u,f,c,n,o,_)||nt(f,h,c,n,o,_)||nt(h,u,c,n,o,_))}function xt(c,n,o){const u=n.paint.get(c).value;return u.kind==="constant"?u.value:o.programConfigurations.get(n.id).getMaxValue(c)}function Zt(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Kt(c,n,o,u,f){if(!n[0]&&!n[1])return c;const h=$t.convert(n)._mult(f);o==="viewport"&&h._rotate(-u);const _=[];for(let w=0;w<c.length;w++)_.push(c[w].sub(h));return _}function ln(c,n,o,u){const f=$t.convert(c)._mult(u);return n==="viewport"&&f._rotate(-o),f}let vt,Ht;Ze(ee,"CircleBucket",{omit:["layers"]});var mt,Gt={exports:{}},Bt=(mt||(mt=1,function(c,n){(function(o){function u(h,_,w){var T=f(256*h,256*(_=Math.pow(2,w)-_-1),w),P=f(256*(h+1),256*(_+1),w);return T[0]+","+T[1]+","+P[0]+","+P[1]}function f(h,_,w){var T=2*Math.PI*6378137/256/Math.pow(2,w);return[h*T-2*Math.PI*6378137/2,_*T-2*Math.PI*6378137/2]}o.getURL=function(h,_,w,T,P,x){return x=x||{},h+"?"+["bbox="+u(w,T,P),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+_].join("&")},o.getTileBBox=u,o.getMercCoords=f,Object.defineProperty(o,"__esModule",{value:!0})})(n)}(0,Gt.exports)),Gt.exports);class Xt{constructor(n,o,u){this.z=n,this.x=o,this.y=u,this.key=gn(0,n,n,o,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const u=Bt.getTileBBox(this.x,this.y,this.z),f=function(h,_,w){let T,P="";for(let x=h;x>0;x--)T=1<<x-1,P+=(_&T?1:0)+(w&T?2:0);return P}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Rt{constructor(n,o){this.wrap=n,this.canonical=o,this.key=gn(n,o.z,o.z,o.x,o.y)}}class Qt{constructor(n,o,u,f,h){this.overscaledZ=n,this.wrap=o,this.canonical=new Xt(u,+f,+h),this.key=o===0&&n===u?this.canonical.key:gn(o,n,u,f,h)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new Qt(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qt(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return gn(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-n;return gn(this.wrap*+o,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new Qt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Qt(o,this.wrap,o,u,f),new Qt(o,this.wrap,o,u+1,f),new Qt(o,this.wrap,o,u,f+1),new Qt(o,this.wrap,o,u+1,f+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Qt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Qt(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Rt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function gn(c,n,o,u,f){const h=1<<Math.min(o,22);let _=h*(f%h)+u%h;return c&&o<22&&(_+=h*h*((c<0?-2*c-1:2*c)%(1<<2*(22-o)))),16*(32*_+o)+(n-o)}const _n=[c=>{let n=c.canonical.x-1,o=c.wrap;return n<0&&(n=(1<<c.canonical.z)-1,o--),new Qt(c.overscaledZ,o,c.canonical.z,n,c.canonical.y)},c=>{let n=c.canonical.x+1,o=c.wrap;return n===1<<c.canonical.z&&(n=0,o++),new Qt(c.overscaledZ,o,c.canonical.z,n,c.canonical.y)},c=>new Qt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new Qt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];Ze(Xt,"CanonicalTileID"),Ze(Qt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const xn=Or([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Dn}=xn,ar=Or([{name:"a_pos_3",components:3,type:"Int16"}]);var Vn=Or([{name:"a_pos",type:"Int16",components:2}]);class ir{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,u){const f=me.vec2.dot(o,this.dir);if(Math.abs(f)<1e-6)return!1;const h=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1])/f;return u[0]=this.pos[0]+this.dir[0]*h,u[1]=this.pos[1]+this.dir[1]*h,!0}}class Yn{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,u){const f=me.vec3.dot(o,this.dir);if(Math.abs(f)<1e-6)return!1;const h=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/f;return u[0]=this.pos[0]+this.dir[0]*h,u[1]=this.pos[1]+this.dir[1]*h,u[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(n,o,u){if(me.vec3.equals(this.pos,n)||o===0)return u[0]=u[1]=u[2]=0,!1;const[f,h,_]=this.dir,w=this.pos[0]-n[0],T=this.pos[1]-n[1],P=this.pos[2]-n[2],x=f*f+h*h+_*_,A=2*(w*f+T*h+P*_),I=A*A-4*x*(w*w+T*T+P*P-o*o);if(I<0){const C=Math.max(-A/2,0),M=w+f*C,R=T+h*C,j=P+_*C,$=Math.hypot(M,R,j);return u[0]=M*o/$,u[1]=R*o/$,u[2]=j*o/$,!1}{const C=(-A-Math.sqrt(I))/(2*x);if(C<0){const M=Math.hypot(w,T,P);return u[0]=w*o/M,u[1]=T*o/M,u[2]=P*o/M,!1}return u[0]=w+f*C,u[1]=T+h*C,u[2]=P+_*C,!0}}}class Cr{constructor(n,o,u,f,h){this.TL=n,this.TR=o,this.BR=u,this.BL=f,this.horizon=h}static fromInvProjectionMatrix(n,o,u){const f=[-1,1,1],h=[1,1,1],_=[1,-1,1],w=[-1,-1,1],T=me.vec3.transformMat4(f,f,n),P=me.vec3.transformMat4(h,h,n),x=me.vec3.transformMat4(_,_,n),A=me.vec3.transformMat4(w,w,n);return new Cr(T,P,x,A,o/u)}}function ri(c,n,o){let u=1/0,f=-1/0;const h=[];for(const _ of c){me.vec3.sub(h,_,n);const w=me.vec3.dot(h,o);u=Math.min(u,w),f=Math.max(f,w)}return[u,f]}function Mi(c,n){let o=!0;for(let u=0;u<c.planes.length;u++){const f=c.planes[u];let h=0;for(let _=0;_<n.length;_++)h+=me.vec3.dot(f,n[_])+f[3]>=0;if(h===0)return 0;h!==n.length&&(o=!1)}return o?2:1}function xr(c,n){for(const o of c.projections){const u=ri(n,c.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function $i(c,n){let o=0;const u=[0,0,0,0];for(let f=0;f<c.length;f++)u[0]=c[f][0],u[1]=c[f][1],u[2]=c[f][2],u[3]=1,me.vec4.dot(u,n)>=0&&o++;return o}class cr{constructor(n,o){this.points=n||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Nn.fromPoints(this.points),this.projections=[],this.frustumEdges=[me.vec3.sub([],this.points[2],this.points[3]),me.vec3.sub([],this.points[0],this.points[3]),me.vec3.sub([],this.points[4],this.points[0]),me.vec3.sub([],this.points[5],this.points[1]),me.vec3.sub([],this.points[6],this.points[2]),me.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const f=[0,-u[2],u[1]],h=[u[2],0,-u[0]];this.projections.push({axis:f,projection:ri(this.points,this.points[0],f)}),this.projections.push({axis:h,projection:ri(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(n,o,u,f){const h=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const x=me.vec4.transformMat4([],P,n),A=1/x[3]/o*h;return me.vec4.mul(x,x,[A,A,f?1/x[3]:A,A])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const x=me.vec3.sub([],_[P[0]],_[P[1]]),A=me.vec3.sub([],_[P[2]],_[P[1]]),I=me.vec3.normalize([],me.vec3.cross([],x,A)),C=-me.vec3.dot(I,_[P[1]]);return I.concat(C)}),T=[];for(let P=0;P<_.length;P++)T.push([_[P][0],_[P][1],_[P][2]]);return new cr(T,w)}intersectsPrecise(n,o,u){for(let f=0;f<o.length;f++)if(!$i(n,o[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!$i(n,this.planes[f]))return 0;for(const f of u)for(const h of this.frustumEdges){const _=me.vec3.cross([],f,h),w=me.vec3.length(_);if(w===0)continue;me.vec3.scale(_,_,1/w);const T=ri(this.points,this.points[0],_),P=ri(n,this.points[0],_);if(T[0]>P[1]||P[0]>T[1])return 0}return 1}containsPoint(n){for(const o of this.planes){const u=o[3];if(me.vec3.dot([o[0],o[1],o[2]],n)+u<0)return!1}return!0}}class Nn{static fromPoints(n){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of n)me.vec3.min(o,o,f),me.vec3.max(u,u,f);return new Nn(o,u)}static fromTileIdAndHeight(n,o,u){const f=1<<n.canonical.z,h=n.canonical.x,_=n.canonical.y;return new Nn([h/f,_/f,o],[(h+1)/f,(_+1)/f,u])}static applyTransform(n,o){const u=n.getCorners();for(let f=0;f<u.length;++f)me.vec3.transformMat4(u[f],u[f],o);return Nn.fromPoints(u)}static applyTransformFast(n,o){const u=[o[12],o[13],o[14]],f=[...u];for(let h=0;h<3;h++)for(let _=0;_<3;_++){const w=o[4*_+h],T=w*n.min[_],P=w*n.max[_];u[h]+=Math.min(T,P),f[h]+=Math.max(T,P)}return new Nn(u,f)}static projectAabbCorners(n,o){const u=n.getCorners();for(let f=0;f<u.length;++f)me.vec3.transformMat4(u[f],u[f],o);return u}constructor(n,o){this.min=n,this.max=o,this.center=me.vec3.scale([],me.vec3.add([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],u=me.vec3.clone(this.min),f=me.vec3.clone(this.max);for(let h=0;h<o.length;h++)u[h]=o[h]?this.min[h]:this.center[h],f[h]=o[h]?this.center[h]:this.max[h];return f[2]=this.max[2],new Nn(u,f)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?Mi(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?Mi(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,o){return o||this.intersects(n)?xr(n,this.getCorners()):0}intersectsPreciseFlat(n,o){return o||this.intersectsFlat(n)?xr(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let o=0;o<3;++o)if(this.min[o]>n.max[o]||n.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n.min[o]),this.max[o]=Math.max(this.max[o],n.max[o])}encapsulatePoint(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n[o]),this.max[o]=Math.max(this.max[o],n[o])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}function Lr(c){return c*ya/Vd}Ze(Nn,"Aabb");const ai=[new Nn([kl,kl,kl],[Rl,Rl,Rl]),new Nn([kl,kl,kl],[0,0,Rl]),new Nn([0,kl,kl],[Rl,0,Rl]),new Nn([kl,0,kl],[0,Rl,Rl]),new Nn([0,0,kl],[Rl,Rl,Rl])];function Yr(c,n,o,u=!0){const f=me.vec3.scale([],c._camera.position,c.worldSize),h=[n,o,1,1];me.vec4.transformMat4(h,h,c.pixelMatrixInverse),me.vec4.scale(h,h,1/h[3]);const _=me.vec3.sub([],h,f),w=me.vec3.normalize([],_),T=c.globeMatrix,P=[T[12],T[13],T[14]],x=me.vec3.sub([],P,f),A=me.vec3.length(x),I=me.vec3.normalize([],x),C=c.worldSize/(2*Math.PI),M=me.vec3.dot(I,w),R=Math.asin(C/A);if(R<Math.acos(M)){if(!u)return null;const He=[],Pe=[];me.vec3.scale(He,w,A/M),me.vec3.normalize(Pe,me.vec3.sub(Pe,He,x)),me.vec3.normalize(w,me.vec3.add(w,x,me.vec3.scale(w,Pe,Math.tan(R)*A)))}const j=[];new Yn(f,w).closestPointOnSphere(P,C,j);const $=me.vec3.normalize([],Rr(T,0)),Y=me.vec3.normalize([],Rr(T,1)),X=me.vec3.normalize([],Rr(T,2)),Z=me.vec3.dot($,j),re=me.vec3.dot(Y,j),ae=me.vec3.dot(X,j),ue=bn(Math.asin(-re/C));let Ce=bn(Math.atan2(Z,ae));Ce=c.center.lng+function(He,Pe){const We=(Pe-He+180)%360-180;return We<-180?We+360:We}(c.center.lng,Ce);const we=cu(Ce),Se=Ln(Ja(ue),0,1);return new r(we,Se)}class rs{constructor(n,o,u){this.a=me.vec3.sub([],n,u),this.b=me.vec3.sub([],o,u),this.center=u;const f=me.vec3.normalize([],this.a),h=me.vec3.normalize([],this.b);this.angle=Math.acos(me.vec3.dot(f,h))}}function Ms(c,n){if(c.angle===0)return null;let o;return o=c.a[n]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[n]/c.a[n]/Math.sin(c.angle)-1/Math.tan(c.angle)),o<0||o>1?null:function(u,f,h,_){const w=Math.sin(h);return u*(Math.sin((1-_)*h)/w)+f*(Math.sin(_*h)/w)}(c.a[n],c.b[n],c.angle,Ln(o,0,1))+c.center[n]}function Js(c){if(c.z<=1)return ai[c.z+2*c.y+c.x];const n=Gi(Wr(c));return Nn.fromPoints(n)}function so(c,n,o){return me.vec3.scale(c,c,1-o),me.vec3.scaleAndAdd(c,c,n,o)}function Dl(c,n,o){for(const u of c)me.vec3.transformMat4(u,u,n),me.vec3.scale(u,u,o)}function ia(c,n,o,u){const f=n/c.worldSize,h=c.globeMatrix;if(o.z<=1){const we=Js(o).getCorners();return Dl(we,h,f),Nn.fromPoints(we)}const _=Wr(o,u),w=Gi(_,ya+Lr(c._tileCoverLift));Dl(w,h,f);const T=Number.MAX_VALUE,P=[-T,-T,-T],x=[T,T,T];if(_.contains(c.center)){for(const He of w)me.vec3.min(x,x,He),me.vec3.max(P,P,He);P[2]=0;const we=c.point,Se=[we.x*f,we.y*f,0];return me.vec3.min(x,x,Se),me.vec3.max(P,P,Se),new Nn(x,P)}if(c._tileCoverLift>0){for(const we of w)me.vec3.min(x,x,we),me.vec3.max(P,P,we);return new Nn(x,P)}const A=[h[12]*f,h[13]*f,h[14]*f],I=_.getCenter(),C=Ln(c.center.lat,-ps,ps),M=Ln(I.lat,-ps,ps),R=cu(c.center.lng),j=Ja(C);let $=R-cu(I.lng);const Y=j-Ja(M);$>.5?$-=1:$<-.5&&($+=1);let X=0;if(Math.abs($)>Math.abs(Y))X=$>=0?1:3;else{X=Y>=0?0:2;const we=[h[4]*f,h[5]*f,h[6]*f],Se=-Math.sin(En(Y>=0?_.getSouth():_.getNorth()))*ya;me.vec3.scaleAndAdd(A,A,we,Se)}const Z=w[X],re=w[(X+1)%4],ae=new rs(Z,re,A),ue=[Ms(ae,0)||Z[0],Ms(ae,1)||Z[1],Ms(ae,2)||Z[2]],Ce=Ra(c.zoom);if(Ce>0){const we=function({x:He,y:Pe,z:We},st,tt,ft,ht){const bt=1/(1<<We);let gt=He*bt,At=gt+bt,en=Pe*bt,Jt=en+bt,An=0;const on=(gt+At)/2-ft;return on>.5?An=-1:on<-.5&&(An=1),gt=((gt+An)*st-(ft*=st))*tt+ft,At=((At+An)*st-ft)*tt+ft,en=(en*st-(ht*=st))*tt+ht,Jt=(Jt*st-ht)*tt+ht,[[gt,Jt,0],[At,Jt,0],[At,en,0],[gt,en,0]]}(o,n,c._pixelsPerMercatorPixel,R,j);for(let He=0;He<w.length;He++)so(w[He],we[He],Ce);const Se=me.vec3.add([],we[X],we[(X+1)%4]);me.vec3.scale(Se,Se,.5),so(ue,Se,Ce)}for(const we of w)me.vec3.min(x,x,we),me.vec3.max(P,P,we);return x[2]=Math.min(Z[2],re[2]),me.vec3.min(x,x,ue),me.vec3.max(P,P,ue),new Nn(x,P)}function Wr({x:c,y:n,z:o},u=!1){const f=1/(1<<o),h=new ni(Qa(c*f),n===(1<<o)-1&&u?-90:Po((n+1)*f)),_=new ni(Qa((c+1)*f),n===0&&u?90:Po(n*f));return new Bh(h,_)}function Gi(c,n=ya){const o=En(c.getNorth()),u=En(c.getSouth()),f=Math.cos(o),h=Math.cos(u),_=Math.sin(o),w=Math.sin(u),T=c.getWest(),P=c.getEast();return[Rf(h,w,T,n),Rf(h,w,P,n),Rf(f,_,P,n),Rf(f,_,T,n)]}function ii(c,n,o,u){const f=1<<o.z,h=(c/un+o.x)/f;return Ud(Po((n/un+o.y)/f),Qa(h),u)}function xi({min:c,max:n}){return Jv/Math.max(n[0]-c[0],n[1]-c[1],n[2]-c[2])}const Mo=new Float64Array(16);function zi(c){const n=xi(c),o=me.mat4.fromScaling(Mo,[n,n,n]);return me.mat4.translate(o,o,me.vec3.negate([],c.min))}function Qs(c){const n=me.mat4.fromTranslation(Mo,c.min),o=1/xi(c);return me.mat4.scale(n,n,[o,o,o])}function uu(c){const n=un/(2*Math.PI);return c/(2*Math.PI)/n}function el(c,n){return un/(512*Math.pow(2,c))*xi(Js(n))}function oc(c,n,o,u,f){const h=uu(o),_=[c,n,-o/(2*Math.PI)],w=me.mat4.identity(new Float64Array(16));return me.mat4.translate(w,w,_),me.mat4.scale(w,w,[h,h,h]),me.mat4.rotateX(w,w,En(-f)),me.mat4.rotateY(w,w,En(-u)),w}function Ra(c){return br(Lf,Yv,c)}function ac(c,n){const o=Ud(n.lat,n.lng),u=function(h){const _=Ud(h._center.lat,h._center.lng),w=me.vec3.fromValues(0,1,0);let T=me.vec3.cross([],w,_);const P=me.mat4.fromRotation([],-h.angle,_);T=me.vec3.transformMat4(T,T,P),me.mat4.fromRotation(P,-h._pitch,T);const x=me.vec3.normalize([],_);return me.vec3.scale(x,x,Lr(h.cameraToCenterDistance/h.pixelsPerMeter)),me.vec3.transformMat4(x,x,P),me.vec3.add([],_,x)}(c),f=me.vec3.subtract([],u,o);return me.vec3.angle(f,o)}function tl(c,n){return ac(c,n)>Math.PI/2*1.01}const $u=En(85),hu=Math.cos($u),Gu=Math.sin($u),M0=me.mat4.create(),Df=c=>{const n=[];return c.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function Mg(c,n,o,u,f,h,_,w,T){if(h&&c.queryGeometry.isAboveHorizon)return!1;h&&(T*=c.pixelToTileUnitsFactor);const P=c.tileID.canonical,x=o.projection.upVectorScale(P,o.center.lat,o.worldSize).metersToTile;for(const A of n)for(const I of A){const C=I.add(w),M=f&&o.elevation?o.elevation.exaggeration()*f.getElevationAt(C.x,C.y,!0):0,R=o.projection.projectTilePoint(C.x,C.y,P);if(M>0){const X=o.projection.upVector(P,C.x,C.y);R.x+=X[0]*x*M,R.y+=X[1]*x*M,R.z+=X[2]*x*M}const j=h?C:I0(R.x,R.y,R.z,u),$=h?c.tilespaceRays.map(X=>rB(X,M)):c.queryGeometry.screenGeometry,Y=me.vec4.transformMat4([],[R.x,R.y,R.z,1],u);if(!_&&h?T*=Y[3]/o.cameraToCenterDistance:_&&!h&&(T*=o.cameraToCenterDistance/Y[3]),h){const X=Po((I.y/un+P.y)/(1<<P.z));T/=o.projection.pixelsPerMeter(X,1)/Vo(1,X)}if(oe($,j,T))return!0}return!1}function I0(c,n,o,u){const f=me.vec4.transformMat4([],[c,n,o,1],u);return new $t(f[0]/f[3],f[1]/f[3])}const uE=me.vec3.fromValues(0,0,0),nB=me.vec3.fromValues(0,0,1);function rB(c,n){const o=me.vec3.create();return uE[2]=n,c.intersectsPlane(uE,nB,o),new $t(o[0],o[1])}class hE extends ee{}let dE,fE,pE,mE;function gE(c,{width:n,height:o},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==n*o*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(n*o*u);return c.width=n,c.height=o,c.data=f,c}function _E(c,n,o){const{width:u,height:f}=n;u===c.width&&f===c.height||(Vw(c,n,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,f)},o,null),c.width=u,c.height=f,c.data=n.data)}function Vw(c,n,o,u,f,h,_,w){if(f.width===0||f.height===0)return n;if(f.width>c.width||f.height>c.height||o.x>c.width-f.width||o.y>c.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>n.width||f.height>n.height||u.x>n.width-f.width||u.y>n.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const T=c.data,P=n.data,x=h===4&&w;for(let A=0;A<f.height;A++){const I=((o.y+A)*c.width+o.x)*h,C=((u.y+A)*n.width+u.x)*h;if(x)for(let M=0;M<f.width;M++){const R=I+M*h+3,j=C+M*h;P[j+0]=255,P[j+1]=255,P[j+2]=255,P[j+3]=T[R]}else if(_)for(let M=0;M<f.width;M++){const R=I+M*h,j=C+M*h,$=T[R+3],Y=new qr(T[R+0]/255*$,T[R+1]/255*$,T[R+2]/255*$,$).toRenderColor(_).toArray();P[j+0]=Y[0],P[j+1]=Y[1],P[j+2]=Y[2],P[j+3]=Y[3]}else for(let M=0;M<f.width*h;M++)P[C+M]=T[I+M]}return n}Ze(hE,"HeatmapBucket",{omit:["layers"]});class Nf{constructor(n,o){gE(this,n,1,o)}resize(n){_E(this,new Nf(n),1)}clone(){return new Nf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,f,h){Vw(n,o,u,f,h,1,null)}}class qo{constructor(n,o){gE(this,n,4,o)}resize(n){_E(this,new qo(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,f,h,_,w){Vw(n,o,u,f,h,4,_,w)}}class yE{constructor(n,o){this.width=n.width,this.height=n.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function L0(c){const n={},o=c.resolution||256,u=c.clips?c.clips.length:1,f=c.image||new qo({width:o,height:u}),h=(_,w,T)=>{n[c.evaluationKey]=T;const P=c.expression.evaluate(n);P&&(f.data[_+w+0]=Math.floor(255*P.r/P.a),f.data[_+w+1]=Math.floor(255*P.g/P.a),f.data[_+w+2]=Math.floor(255*P.b/P.a),f.data[_+w+3]=Math.floor(255*P.a))};if(c.clips)for(let _=0,w=0;_<u;++_,w+=4*o)for(let T=0,P=0;T<o;T++,P+=4){const x=T/(o-1),{start:A,end:I}=c.clips[_];h(w,P,A*(1-x)+I*x)}else for(let _=0,w=0;_<o;_++,w+=4)h(0,w,_/(o-1));return f}Ze(Nf,"AlphaImage"),Ze(qo,"RGBAImage");const iB=Or([{name:"a_pos",components:2,type:"Int16"}],4),sB=Or([{name:"a_road_z_offset",components:1,type:"Float32"}],4),oB=Or([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),aB=Or([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function k0(c,n,o=2){const u=n&&n.length,f=u?n[0]*o:c.length;let h=vE(c,0,f,o,!0);const _=[];if(!h||h.next===h.prev)return _;let w,T,P;if(u&&(h=function(x,A,I,C){const M=[];for(let R=0,j=A.length;R<j;R++){const $=vE(x,A[R]*C,R<j-1?A[R+1]*C:x.length,C,!1);$===$.next&&($.steiner=!0),M.push(mB($))}M.sort(dB);for(let R=0;R<M.length;R++)I=fB(M[R],I);return I}(c,n,h,o)),c.length>80*o){w=1/0,T=1/0;let x=-1/0,A=-1/0;for(let I=o;I<f;I+=o){const C=c[I],M=c[I+1];C<w&&(w=C),M<T&&(T=M),C>x&&(x=C),M>A&&(A=M)}P=Math.max(x-w,A-T),P=P!==0?32767/P:0}return R0(h,_,o,w,T,P,0),_}function vE(c,n,o,u,f){let h;if(f===function(_,w,T,P){let x=0;for(let A=w,I=T-P;A<T;A+=P)x+=(_[I]-_[A])*(_[A+1]+_[I+1]),I=A;return x}(c,n,o,u)>0)for(let _=n;_<o;_+=u)h=wE(_/u|0,c[_],c[_+1],h);else for(let _=o-u;_>=n;_-=u)h=wE(_/u|0,c[_],c[_+1],h);return h&&e1(h,h.next)&&(N0(h),h=h.next),h}function xm(c,n){if(!c)return c;n||(n=c);let o,u=c;do if(o=!1,u.steiner||!e1(u,u.next)&&oo(u.prev,u,u.next)!==0)u=u.next;else{if(N0(u),u=n=u.prev,u===u.next)break;o=!0}while(o||u!==n);return n}function R0(c,n,o,u,f,h,_){if(!c)return;!_&&h&&function(T,P,x,A){let I=T;do I.z===0&&(I.z=qw(I.x,I.y,P,x,A)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==T);I.prevZ.nextZ=null,I.prevZ=null,function(C){let M,R=1;do{let j,$=C;C=null;let Y=null;for(M=0;$;){M++;let X=$,Z=0;for(let ae=0;ae<R&&(Z++,X=X.nextZ,X);ae++);let re=R;for(;Z>0||re>0&&X;)Z!==0&&(re===0||!X||$.z<=X.z)?(j=$,$=$.nextZ,Z--):(j=X,X=X.nextZ,re--),Y?Y.nextZ=j:C=j,j.prevZ=Y,Y=j;$=X}Y.nextZ=null,R*=2}while(M>1)}(I)}(c,u,f,h);let w=c;for(;c.prev!==c.next;){const T=c.prev,P=c.next;if(h?cB(c,u,f,h):lB(c))n.push(T.i,c.i,P.i),N0(c),c=P.next,w=P.next;else if((c=P)===w){_?_===1?R0(c=uB(xm(c),n),n,o,u,f,h,2):_===2&&hB(c,n,o,u,f,h):R0(xm(c),n,o,u,f,h,1);break}}}function lB(c){const n=c.prev,o=c,u=c.next;if(oo(n,o,u)>=0)return!1;const f=n.x,h=o.x,_=u.x,w=n.y,T=o.y,P=u.y,x=f<h?f<_?f:_:h<_?h:_,A=w<T?w<P?w:P:T<P?T:P,I=f>h?f>_?f:_:h>_?h:_,C=w>T?w>P?w:P:T>P?T:P;let M=u.next;for(;M!==n;){if(M.x>=x&&M.x<=I&&M.y>=A&&M.y<=C&&Ig(f,w,h,T,_,P,M.x,M.y)&&oo(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function cB(c,n,o,u){const f=c.prev,h=c,_=c.next;if(oo(f,h,_)>=0)return!1;const w=f.x,T=h.x,P=_.x,x=f.y,A=h.y,I=_.y,C=w<T?w<P?w:P:T<P?T:P,M=x<A?x<I?x:I:A<I?A:I,R=w>T?w>P?w:P:T>P?T:P,j=x>A?x>I?x:I:A>I?A:I,$=qw(C,M,n,o,u),Y=qw(R,j,n,o,u);let X=c.prevZ,Z=c.nextZ;for(;X&&X.z>=$&&Z&&Z.z<=Y;){if(X.x>=C&&X.x<=R&&X.y>=M&&X.y<=j&&X!==f&&X!==_&&Ig(w,x,T,A,P,I,X.x,X.y)&&oo(X.prev,X,X.next)>=0||(X=X.prevZ,Z.x>=C&&Z.x<=R&&Z.y>=M&&Z.y<=j&&Z!==f&&Z!==_&&Ig(w,x,T,A,P,I,Z.x,Z.y)&&oo(Z.prev,Z,Z.next)>=0))return!1;Z=Z.nextZ}for(;X&&X.z>=$;){if(X.x>=C&&X.x<=R&&X.y>=M&&X.y<=j&&X!==f&&X!==_&&Ig(w,x,T,A,P,I,X.x,X.y)&&oo(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;Z&&Z.z<=Y;){if(Z.x>=C&&Z.x<=R&&Z.y>=M&&Z.y<=j&&Z!==f&&Z!==_&&Ig(w,x,T,A,P,I,Z.x,Z.y)&&oo(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function uB(c,n){let o=c;do{const u=o.prev,f=o.next.next;!e1(u,f)&&xE(u,o,o.next,f)&&D0(u,f)&&D0(f,u)&&(n.push(u.i,o.i,f.i),N0(o),N0(o.next),o=c=f),o=o.next}while(o!==c);return xm(o)}function hB(c,n,o,u,f,h){let _=c;do{let w=_.next.next;for(;w!==_.prev;){if(_.i!==w.i&&gB(_,w)){let T=bE(_,w);return _=xm(_,_.next),T=xm(T,T.next),R0(_,n,o,u,f,h,0),void R0(T,n,o,u,f,h,0)}w=w.next}_=_.next}while(_!==c)}function dB(c,n){return c.x-n.x}function fB(c,n){const o=function(f,h){let _=h;const w=f.x,T=f.y;let P,x=-1/0;do{if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const R=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(R<=w&&R>x&&(x=R,P=_.x<_.next.x?_:_.next,R===w))return P}_=_.next}while(_!==h);if(!P)return null;const A=P,I=P.x,C=P.y;let M=1/0;_=P;do{if(w>=_.x&&_.x>=I&&w!==_.x&&Ig(T<C?w:x,T,I,C,T<C?x:w,T,_.x,_.y)){const R=Math.abs(T-_.y)/(w-_.x);D0(_,f)&&(R<M||R===M&&(_.x>P.x||_.x===P.x&&pB(P,_)))&&(P=_,M=R)}_=_.next}while(_!==A);return P}(c,n);if(!o)return n;const u=bE(o,c);return xm(u,u.next),xm(o,o.next)}function pB(c,n){return oo(c.prev,c,n.prev)<0&&oo(n.next,c,c.next)<0}function qw(c,n,o,u,f){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-o)*f|0)|c<<8))|c<<4))|c<<2))|c<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function mB(c){let n=c,o=c;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==c);return o}function Ig(c,n,o,u,f,h,_,w){return(f-_)*(n-w)>=(c-_)*(h-w)&&(c-_)*(u-w)>=(o-_)*(n-w)&&(o-_)*(h-w)>=(f-_)*(u-w)}function gB(c,n){return c.next.i!==n.i&&c.prev.i!==n.i&&!function(o,u){let f=o;do{if(f.i!==o.i&&f.next.i!==o.i&&f.i!==u.i&&f.next.i!==u.i&&xE(f,f.next,o,u))return!0;f=f.next}while(f!==o);return!1}(c,n)&&(D0(c,n)&&D0(n,c)&&function(o,u){let f=o,h=!1;const _=(o.x+u.x)/2,w=(o.y+u.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&_<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(h=!h),f=f.next;while(f!==o);return h}(c,n)&&(oo(c.prev,c,n.prev)||oo(c,n.prev,n))||e1(c,n)&&oo(c.prev,c,c.next)>0&&oo(n.prev,n,n.next)>0)}function oo(c,n,o){return(n.y-c.y)*(o.x-n.x)-(n.x-c.x)*(o.y-n.y)}function e1(c,n){return c.x===n.x&&c.y===n.y}function xE(c,n,o,u){const f=n1(oo(c,n,o)),h=n1(oo(c,n,u)),_=n1(oo(o,u,c)),w=n1(oo(o,u,n));return f!==h&&_!==w||!(f!==0||!t1(c,o,n))||!(h!==0||!t1(c,u,n))||!(_!==0||!t1(o,c,u))||!(w!==0||!t1(o,n,u))}function t1(c,n,o){return n.x<=Math.max(c.x,o.x)&&n.x>=Math.min(c.x,o.x)&&n.y<=Math.max(c.y,o.y)&&n.y>=Math.min(c.y,o.y)}function n1(c){return c>0?1:c<0?-1:0}function D0(c,n){return oo(c.prev,c,c.next)<0?oo(c,n,c.next)>=0&&oo(c,c.prev,n)>=0:oo(c,n,c.prev)<0||oo(c,c.next,n)<0}function bE(c,n){const o=$w(c.i,c.x,c.y),u=$w(n.i,n.x,n.y),f=c.next,h=n.prev;return c.next=n,n.prev=c,o.next=f,f.prev=o,u.next=o,o.prev=u,h.next=u,u.prev=h,u}function wE(c,n,o,u){const f=$w(c,n,o);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function N0(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function $w(c,n,o){return{i:c,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function r1(c,n){const o=c.length;if(o<=1)return[c];const u=[];let f,h;for(let _=0;_<o;_++){const w=ml(c[_]);w!==0&&(c[_].area=Math.abs(w),h===void 0&&(h=w<0),h===w<0?(f&&u.push(f),f=[c[_]]):f.push(c[_]))}if(f&&u.push(f),n>1)for(let _=0;_<u.length;_++)u[_].length<=n||(bh(u[_],n,1,u[_].length-1,_B),u[_]=u[_].slice(0,n));return u}function _B(c,n){return n.area-c.area}function SE(c,n,o=1){if(!c)return null;const u=typeof c=="string"?ds.from(c).getPrimary():c.getPrimary(),f=u.id.toString();return n.has(f)||n.set(f,[]),u.scaleSelf(o),n.get(f).push(u),u.toString()}function Gw(c,n,o,u){const f=u.patternDependencies;let h=!1;for(const _ of n){const w=_.paint.get(`${c}-pattern`);w.isConstant()||(h=!0),SE(w.constantOr(null),f,o)&&(h=!0)}return h}function Hw(c,n,o,u,f,h){const _=h.patternDependencies;for(const w of n){const T=w.paint.get(`${c}-pattern`).value;if(T.kind!=="constant"){let P=T.evaluate({zoom:u},o,{},h.availableImages);P=P&&P.name?P.name:P;const x=SE(P,_,f);x&&(o.patterns[w.id]=x)}}return o}var Ww,TE,Zw,AE,Kw,EE,CE,i1={};function PE(){if(TE)return Ww;TE=1;var c=On();function n(f,h,_,w,T){this.properties={},this.extent=_,this.type=0,this._pbf=f,this._geometry=-1,this._keys=w,this._values=T,f.readFields(o,this,h)}function o(f,h,_){f==1?h.id=_.readVarint():f==2?function(w,T){for(var P=w.readVarint()+w.pos;w.pos<P;){var x=T._keys[w.readVarint()],A=T._values[w.readVarint()];T.properties[x]=A}}(_,h):f==3?h.type=_.readVarint():f==4&&(h._geometry=_.pos)}function u(f){for(var h,_,w=0,T=0,P=f.length,x=P-1;T<P;x=T++)w+=((_=f[x]).x-(h=f[T]).x)*(h.y+_.y);return w}return Ww=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var h,_=f.readVarint()+f.pos,w=1,T=0,P=0,x=0,A=[];f.pos<_;){if(T<=0){var I=f.readVarint();w=7&I,T=I>>3}if(T--,w===1||w===2)P+=f.readSVarint(),x+=f.readSVarint(),w===1&&(h&&A.push(h),h=[]),h.push(new c(P,x));else{if(w!==7)throw new Error("unknown command "+w);h&&h.push(h[0].clone())}}return h&&A.push(h),A},n.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var h=f.readVarint()+f.pos,_=1,w=0,T=0,P=0,x=1/0,A=-1/0,I=1/0,C=-1/0;f.pos<h;){if(w<=0){var M=f.readVarint();_=7&M,w=M>>3}if(w--,_===1||_===2)(T+=f.readSVarint())<x&&(x=T),T>A&&(A=T),(P+=f.readSVarint())<I&&(I=P),P>C&&(C=P);else if(_!==7)throw new Error("unknown command "+_)}return[x,I,A,C]},n.prototype.toGeoJSON=function(f,h,_){var w,T,P=this.extent*Math.pow(2,_),x=this.extent*f,A=this.extent*h,I=this.loadGeometry(),C=n.types[this.type];function M($){for(var Y=0;Y<$.length;Y++){var X=$[Y];$[Y]=[360*(X.x+x)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+A)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(w=0;w<I.length;w++)R[w]=I[w][0];M(I=R);break;case 2:for(w=0;w<I.length;w++)M(I[w]);break;case 3:for(I=function($){var Y=$.length;if(Y<=1)return[$];for(var X,Z,re=[],ae=0;ae<Y;ae++){var ue=u($[ae]);ue!==0&&(Z===void 0&&(Z=ue<0),Z===ue<0?(X&&re.push(X),X=[$[ae]]):X.push($[ae]))}return X&&re.push(X),re}(I),w=0;w<I.length;w++)for(T=0;T<I[w].length;T++)M(I[w][T])}I.length===1?I=I[0]:C="Multi"+C;var j={type:"Feature",geometry:{type:C,coordinates:I},properties:this.properties};return"id"in this&&(j.id=this.id),j},Ww}function ME(){if(AE)return Zw;AE=1;var c=PE();function n(u,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,f),this.length=this._features.length}function o(u,f,h){u===15?f.version=h.readVarint():u===1?f.name=h.readString():u===5?f.extent=h.readVarint():u===2?f._features.push(h.pos):u===3?f._keys.push(h.readString()):u===4&&f._values.push(function(_){for(var w=null,T=_.readVarint()+_.pos;_.pos<T;){var P=_.readVarint()>>3;w=P===1?_.readString():P===2?_.readFloat():P===3?_.readDouble():P===4?_.readVarint64():P===5?_.readVarint():P===6?_.readSVarint():P===7?_.readBoolean():null}return w}(h))}return Zw=n,n.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var f=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,f,this.extent,this._keys,this._values)},Zw}function IE(){return CE||(CE=1,i1.VectorTile=function(){if(EE)return Kw;EE=1;var c=ME();function n(o,u,f){if(o===3){var h=new c(f,f.readVarint()+f.pos);h.length&&(u[h.name]=h)}}return Kw=function(o,u){this.layers=o.readFields(n,{},u)},Kw}(),i1.VectorTileFeature=PE(),i1.VectorTileLayer=ME()),i1}var Of=IE();const bm="3d_elevation_id",LE="level";class yB{constructor(){this._valid=!1}reset(n){return this.feature=n,this._valid=!0,this._geometry=n.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(n,o){return this._valid&&n(o(this._geometry)),this}require(n,o,u){return this.get(n,!0,o,u)}optional(n,o,u){return this.get(n,!1,o,u)}success(){return this._valid}get(n,o,u,f){const h=this.feature.properties.hasOwnProperty(n)?+this.feature.properties[n]:void 0;return this._valid&&h!==void 0?u(f?f(h):h):o&&(this._valid=!1),this}}class kE{constructor(n,o){this.featureFunc=n,this.vertexFunc=o}parseFeature(n,o,u){return this.featureFunc(n,o,u)}parseVertex(n,o,u){return this.vertexFunc(n,o,u)}}const vB=new kE((c,n,o)=>c.reset(n).require(bm,u=>{o.id=u}).optional("fixed_height_relative",u=>{o.constantHeight=u},qd.decodeRelativeHeight).geometry(u=>{o.bounds=u},qd.computeBounds).success(),(c,n,o)=>c.reset(n).require(bm,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height_relative",u=>{o.height=u},qd.decodeRelativeHeight).geometry(u=>{o.position=u},qd.getPoint).success()),xB=new kE((c,n,o)=>c.reset(n).require(bm,u=>{o.id=u}).optional("fixed_height",u=>{o.constantHeight=u},qd.decodeMetricHeight).geometry(u=>{o.bounds=u},qd.computeBounds).success(),(c,n,o)=>c.reset(n).require(bm,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height",u=>{o.height=u},qd.decodeMetricHeight).geometry(u=>{o.position=u},qd.getPoint).success());class qd{static computeBounds(n){const o=new $t(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=new $t(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const f of n[0])o.x>f.x&&(o.x=f.x),o.y>f.y&&(o.y=f.y),u.x<f.x&&(u.x=f.x),u.y<f.y&&(u.y=f.y);return{min:o,max:u}}static getPoint(n){return me.vec2.fromValues(n[0][0].x,n[0][0].y)}static decodeRelativeHeight(n){return 1e-4*n*5}static decodeMetricHeight(n){return 1e-4*n}static parse(n){const o=[],u=[],f=n.length,h=new yB;for(let w=0;w<f;w++){const T=n.feature(w),P=T.properties.hasOwnProperty("version")?String(T.properties.version):void 0,x=(_=P)?_==="1.0.1"?xB:void 0:vB;if(x===void 0){pi(`Unknown elevation feature version number ${P||"(unknown)"}`);continue}const A=T.properties.hasOwnProperty("type")?T.properties.type:void 0;if(A){if(Of.VectorTileFeature.types[T.type]==="Point"&&A==="curve_point"){const I={};x.parseVertex(h,T,I)&&o.push(I)}else if(Of.VectorTileFeature.types[T.type]==="Polygon"&&A==="curve_meta"){const I={};x.parseFeature(h,T,I)&&u.push(I)}}}var _;return{vertices:o,features:u}}}class Xw{constructor(n,o,u,f,h,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=n,this.heightRange={min:u,max:u},this.safeArea=o,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||f.length!==0)){this.vertices=f,this.edges=h,this.edges=this.edges.filter(w=>w.a<this.vertices.length&&w.b<this.vertices.length&&!me.vec2.exactEquals(this.vertices[w.a].position,this.vertices[w.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:me.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const T=this.vertices[w.a].position,P=this.vertices[w.b].position,x=me.vec2.subtract(me.vec2.create(),P,T),A=me.vec2.length(x),I=me.vec2.scale(me.vec2.create(),x,1/A);this.edgeProps.push({vec:x,dir:I,len:A});const C=this.vertexProps[w.a].dir,M=this.vertexProps[w.b].dir;me.vec2.add(C,C,I),me.vec2.add(M,M,I)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||me.vec2.normalize(w.dir,w.dir);this.tessellate(_)}}pointElevation(n){if(this.constantHeight!=null)return this.constantHeight;const o=this.getClosestEdge(n);if(o==null)return 0;const[u,f]=o;return((h,_,w)=>(1-w)*h+w*_)(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,f)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(n){if(this.edges.length===0)return;let o=0,u=Number.POSITIVE_INFINITY,f=0;const h=me.vec2.fromValues(n.x,n.y);for(let _=0;_<this.edges.length;_++){const w=this.edges[_],T=this.edgeProps[_].dir,P=new ir(h,this.edgeProps[_].dir),x=this.vertices[w.a].position,A=this.vertices[w.b].position,I=me.vec2.create(),C=me.vec2.create(),M=P.intersectsPlane(x,this.vertexProps[w.a].dir,I),R=P.intersectsPlane(A,this.vertexProps[w.b].dir,C);if(!M||!R)continue;const j=me.vec2.subtract(me.vec2.create(),C,I),$=me.vec2.subtract(me.vec2.create(),h,I),Y=me.vec2.dot(j,j),X=Y>0?me.vec2.dot($,j)/Y:0,Z=Ln(X,0,1),re=Math.abs((X-Z)*this.edgeProps[_].len),ae=me.vec2.subtract(me.vec2.create(),h,x),ue=re+Math.abs(me.vec2.dot(ae,me.vec2.fromValues(T[1],-T[0])));ue<u&&(o=_,u=ue,f=Z)}return[o,f]}tessellate(n){for(let o=this.edges.length-1;o>=0;--o){const u=this.edges[o].a,f=this.edges[o].b,{position:h,height:_,extent:w}=this.vertices[u],{position:T,height:P,extent:x}=this.vertices[f],A=this.vertexProps[u].dir,I=this.vertexProps[f].dir,C=me.vec3.fromValues(h[0]/n,h[1]/n,_),M=me.vec3.fromValues(T[0]/n,T[1]/n,P),R=me.vec3.fromValues(A[1],-A[0],0);me.vec3.scale(R,R,w);const j=me.vec3.fromValues(I[1],-I[0],0);if(me.vec3.scale(j,j,x),this.distSqLines(me.vec3.fromValues(C[0]+.5*R[0],C[1]+.5*R[1],C[2]+.5*R[2]),me.vec3.fromValues(M[0]-.5*j[0],M[1]-.5*j[1],M[2]-.5*j[2]),me.vec3.fromValues(C[0]-.5*R[0],C[1]-.5*R[1],C[2]-.5*R[2]),me.vec3.fromValues(M[0]+.5*j[0],M[1]+.5*j[1],M[2]+.5*j[2]))<=.05*.05)continue;const $=this.vertices.length,Y=me.vec2.add(me.vec2.create(),h,T);this.vertices.push({position:me.vec2.scale(Y,Y,.5),height:.5*(_+P),extent:.5*(w+x)});const X=me.vec2.add(me.vec2.create(),A,I);this.vertexProps.push({dir:me.vec2.normalize(X,X)}),this.edges.splice(o,1),this.edgeProps.splice(o,1),this.edges.push({a:u,b:$}),this.edges.push({a:$,b:f});const Z=me.vec2.subtract(me.vec2.create(),this.vertices[$].position,h),re=me.vec2.length(Z),ae={vec:Z,dir:me.vec2.scale(me.vec2.create(),Z,1/re),len:re};this.edgeProps.push(ae),this.edgeProps.push(ae)}}distSqLines(n,o,u,f){const h=me.vec3.subtract(me.vec3.create(),o,n),_=me.vec3.subtract(me.vec3.create(),f,u),w=me.vec3.subtract(me.vec3.create(),n,u),T=me.vec3.dot(h,h),P=me.vec3.dot(h,_),x=me.vec3.dot(h,w),A=me.vec3.dot(_,_),I=me.vec3.dot(_,w),C=T*A-P*P;if(C===0){const Y=me.vec3.dot(w,_)/me.vec3.dot(_,_),X=me.vec3.lerp(me.vec3.create(),u,f,Y);return me.vec3.squaredDistance(X,n)}const M=(P*I-x*A)/C,R=(T*I-P*x)/C,j=me.vec3.lerp(me.vec3.create(),n,o,M),$=me.vec3.lerp(me.vec3.create(),u,f,R);return me.vec3.squaredDistance(j,$)}}class bB{constructor(n,o){this.zScale=1,this.xOffset=0,this.yOffset=0,n.equals(o)||(this.zScale=Math.pow(2,o.z-n.z),this.xOffset=(n.x*this.zScale-o.x)*un,this.yOffset=(n.y*this.zScale-o.y)*un)}constantElevation(n,o){if(n.constantHeight!=null)return this.computeBiasedHeight(n.constantHeight,o)}pointElevation(n,o,u){const f=this.constantElevation(o,u);return f??(n.x=n.x*this.zScale+this.xOffset,n.y=n.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(n),u))}computeBiasedHeight(n,o){return o<=0?n:n+o*br(0,o,n>=0?n:Math.abs(.5*n))}}Ze(Xw,"ElevationFeature");class RE{constructor(){this.polygons=new Map}add(n,...o){this.polygons.has(n)?this.polygons.get(n).push(...o):this.polygons.set(n,o)}merge(n){for(const[o,u]of n.polygons)this.add(o,...u)}}class wm{constructor(){this.portals=[]}static evaluate(n){if(n.length===0)return new wm;let o=[];for(const P of n)o.push(...P.portals);if(o.length===0)return new wm;const u=(P,x)=>P<=0&&x<=0||P>=un&&x>=un;for(const P of o){const x=P.va,A=P.vb;(u(x.x,A.x)||u(x.y,A.y))&&(P.type="border")}const f=o.filter(P=>P.type!=="unevaluated"),h=o.filter(P=>P.type==="unevaluated");if(h.length===0)return new wm;h.sort((P,x)=>P.hash===x.hash?P.isTunnel===x.isTunnel?0:P.isTunnel?-1:1:P.hash<x.hash?1:-1),o=f.concat(h);let _=f.length,w=_,T=_;do if(w++,w===o.length||o[_].hash!==o[w].hash){if(w-_==2){T<_&&(o[T]=o[_],o[_]=null);const P=o[T],x=o[w-1];P.type=P.isTunnel!==x.isTunnel?"tunnel":"polygon",P.connection={a:P.connection.a,b:x.connection.a},T++}_=w}while(_!==o.length);return o.splice(T),o.sort((P,x)=>P.hash<x.hash?1:-1),{portals:o}}}Ze(wm,"ElevationPortalGraph"),Ze(RE,"ElevationPolygons");class wB{constructor(n,o,u){this.outPositions=n,this.outNormals=o,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(n,o,u){let f=n[2];u!=null&&(f*=u);const h=this.getVec3Bits(n)<<96n|this.getVec3Bits(o),_=this.vertexLookup.get(h);if(_!=null)return _;const w=this.outPositions.length;this.vertexLookup.set(h,w);const T=Math.trunc(16384*o[0]),P=Math.trunc(16384*o[1]),x=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(n[0],n[1],f),this.outNormals.emplaceBack(T,P,x),w}addVertices(n,o,...u){const f=[];for(const h of u){const _=this.addVertex(h,n,o);f.push(_)}return f}addTriangles(n,o,u){if(o&&u){const f=u.length===1,h=me.vec3.fromValues(0,0,0);for(let _=0;_<n.length;_+=3){const w=o[n[_+0]],T=o[n[_+1]],P=o[n[_+2]],x=f?u[0]:u[n[_+1]],A=f?u[0]:u[n[_+2]],I=this.addVertex(me.vec3.fromValues(w.x,w.y,f?u[0]:u[n[_+0]]),h),C=this.addVertex(me.vec3.fromValues(T.x,T.y,x),h),M=this.addVertex(me.vec3.fromValues(P.x,P.y,A),h);this.outIndices.emplaceBack(I,C,M)}}else for(let f=0;f<n.length;f+=3)this.outIndices.emplaceBack(n[f+0],n[f+1],n[f+2])}addQuad(n,o){const u=this.addVertices(o,void 0,...n.map(T=>me.vec3.fromValues(T.coord.x,T.coord.y,T.height))),[f,h,_,w]=u;this.addTriangles([f,h,_,_,w,f])}getBits(n){return this.view.setFloat32(0,n),BigInt(this.view.getUint32(0))}getVec3Bits(n){return this.getBits(n[0])<<64n|this.getBits(n[1])<<32n|this.getBits(n[2])}}class Hu{constructor(n){this.unevaluatedPortals=new wm,this.portalPolygons=new RE,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new kh,this.vertexNormals=new sm,this.indexArray=new Os,this.tileToMeters=m(n)}addVertices(n,o){const u=this.unevalVertices.length;for(let f=0;f<n.length;f++)this.unevalVertices.push(n[f]),this.unevalHeights.push(o[f]);return u}addTriangles(n,o,u){const f=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const h of n)f.push(h+o)}addRenderableRing(n,o,u,f,h){const _=[new $t(h.min.x,h.min.y),new $t(h.max.x,h.min.y),new $t(h.max.x,h.max.y),new $t(h.min.x,h.max.y)];for(let w=0;w<u-1;w++){const T=o+w,P=T+1,x=this.unevalVertices[T],A=this.unevalVertices[P];if(!(x.x>=h.min.x&&x.x<=h.max.x&&x.y>=h.min.y&&x.y<=h.max.y||A.x>=h.min.x&&A.x<=h.max.x&&A.y>=h.min.y&&A.y<=h.max.y||Ke(x,A,_))||this.isOnBorder(x.x,A.x)||this.isOnBorder(x.y,A.y))continue;const I=Hu.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[P]);let C,M=this.vertexHashLookup.get(Hu.computePosHash(x));M!=null?C=M.next:(M=this.vertexHashLookup.get(Hu.computePosHash(A)),C=M!=null?M.prev:I),this.unevalEdges.push({polygonIdx:n,a:T,b:P,hash:I,portalHash:C,isTunnel:f,type:"unevaluated"})}}addPortalCandidates(n,o,u,f,h){if(o.length===0)return;this.portalPolygons.add(n,{geometry:o,zLevel:h});const _=o[0];this.vertexHashLookup.clear();let w=Hu.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let T=0;T<_.length-1;T++){const P=_[T+0],x=_[T+1],A=me.vec2.fromValues(x.x-P.x,x.y-P.y),I=me.vec2.length(A);if(I===0)continue;let C="unevaluated";const M=f.pointElevation(P),R=f.pointElevation(x);Math.abs(M)<.01&&Math.abs(R)<.01?C="entrance":(this.isOnBorder(P.x,x.x)||this.isOnBorder(P.y,x.y))&&(C="border");const j=Hu.computeEdgeHash(P,x);this.unevaluatedPortals.portals.push({connection:{a:n,b:void 0},va:P,vb:x,vab:A,length:I,hash:j,isTunnel:u,type:C});const $=Hu.computePosHash(P);this.vertexHashLookup.set($,{prev:w,next:j}),w=j}}construct(n){if(this.unevalVertices.length===0)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=A=>{A.primitiveLength=this.indexArray.length-A.primitiveOffset},f=new wB(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(n.portals,this.unevalEdges);const h=o(),_=o(),w=o(),T=(A,I)=>{A.sort((M,R)=>M.type===I&&R.type!==I?-1:M.type!==I&&R.type===I?1:0);const C=A.findIndex(M=>M.type!==I);return C>=0?C:A.length};let P=0;this.unevalEdges.length>0&&(P=T(this.unevalEdges,"none"),this.constructBridgeStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:P},this.tileToMeters));const x=o();if(this.unevalEdges.length>0){const A=this.unevalEdges.splice(P),I=T(A,"tunnel")+P;this.unevalEdges.push(...A),this.constructTunnelStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:P},{min:P,max:I})}u(w),f.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(x),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(_),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(h),this.maskSegments=qi.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.depthSegments=qi.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableSegments=qi.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.shadowCasterSegments=qi.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength)}upload(n){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=n.createVertexBuffer(this.vertexPositions,oB.members),this.vertexBufferNormal=n.createVertexBuffer(this.vertexNormals,aB.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(n,o,u,f){const h=new Map;for(let _=u;_<f;_++){const w=o[_],T=w.a,P=w.b;h.has(T)||h.set(T,{}),h.has(P)||h.set(P,{});const x=h.get(T),A=h.get(P);n[P]>0&&(x.to=P),n[T]>0&&(A.from=T)}return h}constructBridgeStructures(n,o,u,f,h,_){const w=this.computeVertexConnections(u,f,h.min,h.max),T=1/_,P=.5*T,x=I=>me.vec3.fromValues(o[I].x,o[I].y,u[I]*T),A=I=>{const C=w.get(I),M=C.from,R=C.to;if(!M||!R)return;const j=x(M),$=x(I),Y=x(R),X=me.vec3.fromValues(0,0,0);if(!me.vec3.exactEquals(j,$)){const re=me.vec3.sub(me.vec3.create(),$,j);me.vec3.add(X,X,me.vec3.normalize(re,re))}if(!me.vec3.exactEquals(Y,$)){const re=me.vec3.sub(me.vec3.create(),Y,$);me.vec3.add(X,X,me.vec3.normalize(re,re))}const Z=me.vec3.len(X);return Z>0?me.vec3.scale(X,X,1/Z):void 0};for(let I=h.min;I<h.max;I++){const C=f[I],M=this.prepareEdgePoints(o,u,C,(rn,jn)=>rn>=jn);if(M==null)continue;const R=M[0],j=M[1],$=me.vec3.fromValues(R.coord.x,R.coord.y,T*R.height),Y=me.vec3.fromValues(j.coord.x,j.coord.y,T*j.height);if(me.vec3.exactEquals($,Y))continue;const X=me.vec3.sub(me.vec3.create(),Y,$);me.vec3.normalize(X,X);const Z=rn=>me.vec3.normalize(rn,rn),re=A(C.a)||X,ae=A(C.b)||X,ue=Z(me.vec3.fromValues(re[1],-re[0],0)),Ce=Z(me.vec3.fromValues(ae[1],-ae[0],0)),we=Z(me.vec3.cross(me.vec3.create(),ue,re)),Se=Z(me.vec3.cross(me.vec3.create(),Ce,ae)),He=me.vec3.create(),Pe=[me.vec3.add(me.vec3.create(),$,me.vec3.scale(He,me.vec3.sub(He,ue,we),P)),me.vec3.add(me.vec3.create(),$,me.vec3.scale(He,me.vec3.add(He,ue,we),P)),me.vec3.add(me.vec3.create(),$,me.vec3.scale(He,we,P)),$],We=[me.vec3.add(me.vec3.create(),Y,me.vec3.scale(He,me.vec3.sub(He,Ce,Se),P)),me.vec3.add(me.vec3.create(),Y,me.vec3.scale(He,me.vec3.add(He,Ce,Se),P)),me.vec3.add(me.vec3.create(),Y,me.vec3.scale(He,Se,P)),Y],[st,tt]=n.addVertices(ue,_,Pe[0],Pe[1]),[ft,ht]=n.addVertices(Ce,_,We[0],We[1]);n.addTriangles([st,tt,ft,tt,ht,ft]);const[bt,gt]=n.addVertices(we,_,Pe[1],Pe[2]),[At,en]=n.addVertices(Se,_,We[1],We[2]);n.addTriangles([bt,gt,At,gt,en,At]);const[Jt,An]=n.addVertices(me.vec3.negate(ue,ue),_,Pe[2],Pe[3]),[on,hn]=n.addVertices(me.vec3.negate(Ce,Ce),_,We[2],We[3]);n.addTriangles([Jt,An,on,An,hn,on])}}constructTunnelStructures(n,o,u,f,h,_){const w=T=>me.vec3.normalize(T,T);for(let T=h.min;T<h.max;T++){const P=this.prepareEdgePoints(o,u,f[T],(C,M)=>C<=M);if(P==null)continue;const[x,A]=P,I=w(me.vec3.fromValues(A.coord.y-x.coord.y,-(A.coord.x-x.coord.x),0));n.addQuad([x,A,{coord:A.coord,height:f[T].isTunnel?-.1:0},{coord:x.coord,height:f[T].isTunnel?-.1:0}],I)}for(let T=_.min;T<_.max;T++){const P=f[T],x=o[P.a],A=o[P.b],I=w(me.vec3.fromValues(A.y-x.y,-(A.x-x.x),0));n.addQuad([{coord:A,height:0},{coord:x,height:0},{coord:x,height:u[P.a]+4},{coord:A,height:u[P.b]+4}],I),n.addQuad([{coord:x,height:0},{coord:A,height:0},{coord:A,height:u[P.b]+4},{coord:x,height:u[P.a]+4}],I)}}prepareEdgePoints(n,o,u,f){const h=n[u.a],_=n[u.b];let w=o[u.a],T=o[u.b];if(!(w!==0&&f(w,0)||T!==0&&f(T,0)))return;const P=h.clone(),x=_.clone();if(f(w,0)){if(!f(T,0)){const A=T/(T-w);x.x=Bn(x.x,P.x,A),x.y=Bn(x.y,P.y,A),T=Bn(T,w,A)}}else{const A=w/(w-T);P.x=Bn(P.x,x.x,A),P.y=Bn(P.y,x.y,A),w=Bn(w,T,A)}return[{coord:P,height:w},{coord:x,height:T}]}prepareEdges(n,o){if(o.length===0)return;o.sort((w,T)=>w.hash===T.hash?T.polygonIdx-w.polygonIdx:T.hash>w.hash?1:-1);let u=0,f=0,h=0,_=o[u].polygonIdx;do f++,(f===o.length||o[u].hash!==o[f].hash)&&((f-u==1||o[f-1].polygonIdx!==_)&&(h<u&&(o[h]=o[u],o[u]=null),o[h].type="none",h++),u=f,u!==o.length&&(_=o[u].polygonIdx));while(u!==o.length);if(o.splice(h),o.length!==0&&n.length!==0){o.sort((P,x)=>P.hash<x.hash?1:-1);let w=0,T=0;for(;w!==o.length&&T!==n.length;){const P=o[w],x=n[T];P.portalHash>x.hash?w++:x.hash>P.portalHash?T++:(P.type=x.type,w++)}}}isOnBorder(n,o){return n<=0&&o<=0||n>=un&&o>=un}static computeEdgeHash(n,o){return(n.y===o.y&&n.x>o.x||n.y>o.y)&&([n,o]=[o,n]),BigInt(Hu.computePosHash(n))<<32n|BigInt(Hu.computePosHash(o))}static computePosHash(n){return((65535&n.x)<<16|65535&n.y)>>>0}}class Yw{constructor(n,o){this.layoutVertexArray=new ic,this.indexArray=new Os,this.lineIndexArray=new kc,this.triangleSegments=new qi,this.lineSegments=new qi,this.programConfigurations=new Fh(n.layers,{zoom:n.zoom,lut:n.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new Il)}update(n,o,u,f,h,_,w){this.programConfigurations.updatePaintArrays(n,o,h,u,f,_,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,iB.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.lineIndexBuffer=n.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,sB.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(n,o,u,f,h,_){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,o,u,f,h,_)}}class Jw{constructor(n){this.zoom=n.zoom,this.pixelRatio=n.pixelRatio,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new Yw(n,!1),this.elevationBufferData=new Yw(n,!0),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(n,o){}populate(n,o,u,f){this.hasPattern=Gw("fill",this.layers,this.pixelRatio,o);const h=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:w,id:T,index:P,sourceLayerIndex:x}of n){const A=this.layers[0]._featureFilter.needGeometry,I=B(w,A);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom),I,u))continue;const C=h?h.evaluate(I,{},u,o.availableImages):void 0,M={id:T,properties:w.properties,type:w.type,sourceLayerIndex:x,index:P,geometry:A?I.geometry:F(w,u,f),patterns:{},sortKey:C};_.push(M)}h&&_.sort((w,T)=>w.sortKey-T.sortKey);for(const w of _){const{geometry:T,index:P,sourceLayerIndex:x}=w;if(this.hasPattern){const A=Hw("fill",this.layers,w,this.zoom,this.pixelRatio,o);this.patternFeatures.push(A)}else this.addFeature(w,T,P,u,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(n[P].feature,T,P,x,this.index)}}update(n,o,u,f,h,_,w){this.bufferData.update(n,o,u,f,h,_,w),this.elevationBufferData.update(n,o,u,f,h,_,w)}addFeatures(n,o,u,f,h,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,o,u,f,_,n.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(n){this.bufferData.upload(n),this.elevationBufferData.upload(n),this.elevatedStructures&&this.elevatedStructures.upload(n)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(n,o,u,f,h,_=[],w,T){const P=r1(o,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(n,P,f,u,T):this.addGeometry(P,this.bufferData),this.bufferData.populatePaintArrays(n,u,h,_,f,w),this.elevationBufferData.populatePaintArrays(n,u,h,_,f,w)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(n){this.elevatedStructures&&this.elevatedStructures.construct(n)}addElevatedRoadFeature(n,o,u,f,h){const _=new Array,w=this.getElevationFeature(n,h);if(w){_.push({polygons:o,elevationFeature:w,elevationTileID:u});for(const T of _)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Hu(T.elevationTileID));const x=T.elevationFeature.isTunnel();let A=0;n.properties.hasOwnProperty(LE)&&(A=+n.properties[LE]);for(const I of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,I,x,T.elevationFeature,A)}const P=new bB(u,T.elevationTileID);this.addElevatedGeometry(T.polygons,P,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,f)}}else this.addGeometry(o,this.bufferData)}addElevatedGeometry(n,o,u,f,h){const _={elevation:u,elevationSampler:o,bias:f,index:h},[w,T]=this.addGeometry(n,this.elevationBufferData,_);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(n,o,u){let f=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,_=null;u&&(_=u.elevationSampler.constantElevation(u.elevation,u.bias),_!=null&&(f=_,h=_));const w=(T,P,x)=>{if(u!=null)if(P.push(T),_!=null)o.elevatedLayoutVertexArray.emplaceBack(_),x.push(_);else{const A=u.elevationSampler.pointElevation(T,u.elevation,u.bias);o.elevatedLayoutVertexArray.emplaceBack(A),x.push(A),f=Math.min(f,A),h=Math.max(h,A)}};for(const T of n){let P=0;for(const X of T)P+=X.length;const x=o.triangleSegments.prepareSegment(P,o.layoutVertexArray,o.indexArray),A=x.vertexLength,I=[],C=[],M=[],R=[],j=[],$=o.layoutVertexArray.length;for(const X of T){if(X.length===0)continue;X!==T[0]&&C.push(I.length/2);const Z=o.lineSegments.prepareSegment(X.length,o.layoutVertexArray,o.lineIndexArray),re=Z.vertexLength;u&&j.push(o.layoutVertexArray.length-$),w(X[0],M,R),o.layoutVertexArray.emplaceBack(X[0].x,X[0].y),o.lineIndexArray.emplaceBack(re+X.length-1,re),I.push(X[0].x),I.push(X[0].y);for(let ae=1;ae<X.length;ae++)w(X[ae],M,R),o.layoutVertexArray.emplaceBack(X[ae].x,X[ae].y),o.lineIndexArray.emplaceBack(re+ae-1,re+ae),I.push(X[ae].x),I.push(X[ae].y);Z.vertexLength+=X.length,Z.primitiveLength+=X.length}const Y=k0(I,C);for(let X=0;X<Y.length;X+=3)o.indexArray.emplaceBack(A+Y[X],A+Y[X+1],A+Y[X+2]);if(u&&this.elevationMode==="hd-road-base"){const X=u.elevation.isTunnel(),Z=u.elevation.safeArea,re=this.elevatedStructures.addVertices(M,R);this.elevatedStructures.addTriangles(Y,re,X);const ae=j.length;if(ae>0){for(let ue=0;ue<ae-1;ue++)this.elevatedStructures.addRenderableRing(u.index,j[ue]+re,j[ue+1]-j[ue],X,Z);this.elevatedStructures.addRenderableRing(u.index,j[ae-1]+re,M.length-j[ae-1],X,Z)}}x.vertexLength+=P,x.primitiveLength+=Y.length/3}return[f,h]}getElevationFeature(n,o){if(!o)return;const u=+n.properties[bm];return u!=null?o.find(f=>f.id===u):void 0}}let DE,NE,OE,zE;Ze(Jw,"FillBucket",{omit:["layers","patternFeatures"]}),Ze(Yw,"FillBufferData"),Ze(Hu,"ElevatedStructures");class Qw{constructor(n,o,u,f){if(this.triangleCount=o.length/3,this.min=new $t(0,0),this.max=new $t(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[h,_]=[n[0].clone(),n[0].clone()];for(let A=1;A<n.length;++A){const I=n[A];h.x=Math.min(h.x,I.x),h.y=Math.min(h.y,I.y),_.x=Math.max(_.x,I.x),_.y=Math.max(_.y,I.y)}if(f){const A=Math.ceil(Math.max(_.x-h.x,_.y-h.y)/f);u=Math.max(u,A)}if(u===0)return;this.min=h,this.max=_;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const T=Math.max(w.x,w.y)/u;this.cellsX=Math.max(1,Math.ceil(w.x/T)),this.cellsY=Math.max(1,Math.ceil(w.y/T)),this.xScale=1/T,this.yScale=1/T;const P=[];for(let A=0;A<this.triangleCount;A++){const I=n[o[3*A+0]].sub(this.min),C=n[o[3*A+1]].sub(this.min),M=n[o[3*A+2]].sub(this.min),R=Uh(Math.floor(Math.min(I.x,C.x,M.x)),this.xScale,this.cellsX),j=Uh(Math.floor(Math.max(I.x,C.x,M.x)),this.xScale,this.cellsX),$=Uh(Math.floor(Math.min(I.y,C.y,M.y)),this.yScale,this.cellsY),Y=Uh(Math.floor(Math.max(I.y,C.y,M.y)),this.yScale,this.cellsY),X=new $t(0,0),Z=new $t(0,0),re=new $t(0,0),ae=new $t(0,0);for(let ue=$;ue<=Y;++ue){X.y=Z.y=ue*T,re.y=ae.y=(ue+1)*T;for(let Ce=R;Ce<=j;++Ce)X.x=re.x=Ce*T,Z.x=ae.x=(Ce+1)*T,(kt(I,C,M,X,Z,ae)||kt(I,C,M,X,ae,re))&&P.push({cellIdx:ue*this.cellsX+Ce,triIdx:A})}}if(P.length===0)return;P.sort((A,I)=>A.cellIdx-I.cellIdx||A.triIdx-I.triIdx);let x=0;for(;x<P.length;){const A=P[x].cellIdx,I={start:this.payload.length,len:0};for(;x<P.length&&P[x].cellIdx===A;)++I.len,this.payload.push(P[x++].triIdx);this.cells[A]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,o){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const u=Uh(n.x-this.min.x,this.xScale,this.cellsX),f=Uh(n.y-this.min.y,this.yScale,this.cellsY),h=this.cells[f*this.cellsX+u];if(h){this._lazyInitLookup();for(let _=0;_<h.len;_++){const w=this.payload[h.start+_],T=Math.floor(w/8),P=1<<w%8;if(!(this.lookup[T]&P)&&(this.lookup[T]|=P,o.push(w),o.length===this.triangleCount))return}}}query(n,o,u){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>o.x||n.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const f=Uh(n.x-this.min.x,this.xScale,this.cellsX),h=Uh(o.x-this.min.x,this.xScale,this.cellsX),_=Uh(n.y-this.min.y,this.yScale,this.cellsY),w=Uh(o.y-this.min.y,this.yScale,this.cellsY);for(let T=_;T<=w;T++)for(let P=f;P<=h;P++){const x=this.cells[T*this.cellsX+P];if(x)for(let A=0;A<x.len;A++){const I=this.payload[x.start+A],C=Math.floor(I/8),M=1<<I%8;if(!(this.lookup[C]&M)&&(this.lookup[C]|=M,u.push(I),u.length===this.triangleCount))return}}}}function Uh(c,n,o){return Math.max(0,Math.min(o-1,Math.floor(c*n)))}Ze(Qw,"TriangleGridIndex");class FE{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(n,o){for(const u of this.footprints)o.push({footprint:u,id:n})}populate(n,o,u,f){const h=[];for(const{feature:_,id:w,index:T,sourceLayerIndex:P}of n){const x=this.layers[0]._featureFilter.needGeometry,A=B(_,x);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom),A,u))continue;const I={id:w,properties:_.properties,type:_.type,sourceLayerIndex:P,index:T,geometry:x?A.geometry:F(_,u,f),patterns:{}};h.push(I)}for(const _ of h){const{geometry:w,index:T,sourceLayerIndex:P}=_;this.addFeature(_,w,T,u,{},o.availableImages,o.brightness),o.featureIndex.insert(n[T].feature,w,T,P,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,o,u,f,h,_,w){}destroy(){}addFeature(n,o,u,f,h,_=[],w){for(const T of r1(o,2)){const P=[],x=[],A=[],I=new $t(1/0,1/0),C=new $t(-1/0,-1/0);for(const j of T)if(j.length!==0){j!==T[0]&&A.push(x.length/2);for(let $=0;$<j.length;$++)x.push(j[$].x),x.push(j[$].y),P.push(j[$]),I.x=Math.min(I.x,j[$].x),I.y=Math.min(I.y,j[$].y),C.x=Math.max(C.x,j[$].x),C.y=Math.max(C.y,j[$].y)}const M=k0(x,A),R=new Qw(P,M,8,256);this.footprints.push({vertices:P,indices:M,grid:R,min:I,max:C})}}}Ze(FE,"ClipBucket",{omit:["layers"]});const SB=Or([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),TB=Or([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),AB=Or([{name:"a_centroid_pos",components:2,type:"Uint16"}]),EB=Or([{name:"a_join_normal_inside",components:3,type:"Int16"}]),CB=Or([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),PB=Or([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:MB}=SB;class Sm extends $t{constructor(n,o,u){super(n,o),this.z=u}}class BE extends Sm{constructor(n,o,u,f){super(n,o,u),this.w=f}}function s1(c,n,o,u){const f=[],h=u===0?(_,w,T,P,x,A)=>{_.push(new $t(A,T+(A-w)/(P-w)*(x-T)))}:(_,w,T,P,x,A)=>{_.push(new $t(w+(A-T)/(x-T)*(P-w),A))};for(const _ of c){const w=[];for(const T of _){if(T.length<=2)continue;const P=[];for(let I=0;I<T.length-1;I++){const C=T[I].x,M=T[I].y,R=T[I+1].x,j=T[I+1].y,$=u===0?C:M,Y=u===0?R:j;$<n?Y>n&&h(P,C,M,R,j,n):$>o?Y<o&&h(P,C,M,R,j,o):P.push(T[I]),Y<n&&$>=n&&h(P,C,M,R,j,n),Y>o&&$<=o&&h(P,C,M,R,j,o)}let x=T[T.length-1];const A=u===0?x.x:x.y;A>=n&&A<=o&&P.push(x),P.length&&(x=P[P.length-1],P[0].x===x.x&&P[0].y===x.y||P.push(P[0]),w.push(P))}w.length&&f.push(w)}return f}function jE(c,n,o,u){const f=o==="x"?"y":"x",h=(u-c[o])/(n[o]-c[o]);c[f]=c[f]+(n[f]-c[f])*h,c[o]=u,c.hasOwnProperty("z")&&(c.z=Bn(c.z,n.z,h)),c.hasOwnProperty("w")&&(c.w=Bn(c.w,n.w,h))}function UE(c,n,o,u){const f=o,h=u;for(const _ of["x","y"]){let w=c,T=n;w[_]>=T[_]&&(w=n,T=c),w[_]<f&&T[_]>f&&jE(w,T,_,f),w[_]<h&&T[_]>h&&jE(T,w,_,h)}}const o1=Number.MAX_SAFE_INTEGER;function VE(c,n,o,u){return c.order<n||c.order===o1||!(c.clipMask&o)||function(f,h){return h.length!==0&&h.find(_=>_===f)===void 0}(u,c.clipScope)}function a1(c,n){return c.x-n.x||c.y-n.y}function qE(c,n){return a1(c.min,n.min)===0&&a1(c.max,n.max)===0}function e2(c,n){return!(c.min.x>n.max.x||c.max.x<n.min.x||c.min.y>n.max.y||c.max.y<n.min.y)}function t2(c,n){if(c.length!==n.length)return!1;for(let o=0;o<c.length;o++)if(c[o].sourceId!==n[o].sourceId||!qE(c[o],n[o])||c[o].order!==n[o].order||c[o].clipMask!==n[o].clipMask||!cn(c[o].clipScope,n[o].clipScope))return!1;return!0}function $E(c,n,o){const u=1/un,f=1/(1<<o.canonical.z),h=(n.x*u+o.canonical.x)*f+o.wrap,_=(n.y*u+o.canonical.y)*f;return{min:new $t((c.x*u+o.canonical.x)*f+o.wrap,(c.y*u+o.canonical.y)*f),max:new $t(h,_)}}function IB(c,n,o){const u=1<<o.canonical.z,f=((n.x-o.wrap)*u-o.canonical.x)*un,h=(n.y*u-o.canonical.y)*un;return{min:new $t(((c.x-o.wrap)*u-o.canonical.x)*un,(c.y*u-o.canonical.y)*un),max:new $t(f,h)}}function GE(c,n,o,u,f,h,_){const w=c.indices,T=c.vertices,P=[];for(let x=u;x<u+f;x+=3){const A=n[o[x+0]+h],I=n[o[x+1]+h],C=n[o[x+2]+h],M=Math.min(A.x,I.x,C.x),R=Math.max(A.x,I.x,C.x),j=Math.min(A.y,I.y,C.y),$=Math.max(A.y,I.y,C.y);P.length=0,c.grid.query(new $t(M,j),new $t(R,$),P);for(let Y=0;Y<P.length;Y++){const X=P[Y];if(kt(T[w[3*X+0]],T[w[3*X+1]],T[w[3*X+2]],A,I,C,_))return!0}}return!1}function HE(c,n,o,u){if(!c||!o)return!1;let f=c.vertices;if(!n.canonical.equals(u.canonical)||n.wrap!==u.wrap){if(o.vertices.length<c.vertices.length)return HE(o,u,c,n);const h=n.canonical,_=u.canonical,w=Math.pow(2,_.z-h.z);f=c.vertices.map(T=>new $t((T.x+h.x*un)*w-_.x*un,(T.y+h.y*un)*w-_.y*un))}return GE(o,f,c.indices,0,c.indices.length,0,0)}function WE(c,n,o,u){const f=Math.pow(2,u.z-o.z);return new $t((c+o.x*un)*f-u.x*un,(n+o.y*un)*f-u.y*un)}function ZE(c,n){const o=[];n.grid.queryPoint(c,o);const u=n.indices,f=n.vertices;for(let h=0;h<o.length;h++){const _=o[h];if(je([f[u[3*_+0]],f[u[3*_+1]],f[u[3*_+2]]],c))return!0}return!1}const n2=[new $t(0,0),new $t(un,0),new $t(un,un),new $t(0,un)];function KE(c,n){const o=[];let u=[];if(!n||c.length<2)return[c];if(c.length===2)return Ke(c[0],c[1],n2)?[c]:[];for(let f=0;f<c.length+2;f++){const h=c[f%c.length],_=c[(f+1)%c.length],w=Ke(f===0?c[c.length-1]:c[(f-1)%c.length],h,n2),T=Ke(h,_,n2),P=w||T;P&&u.push(h),P&&T||u.length>0&&(u.length>1&&o.push(u),u=[])}return u.length>1&&o.push(u),o}const r2=Of.VectorTileFeature.types,LB=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],kB=["fill-extrusion-flood-light-ground-radius"],RB=Math.pow(2,13),DB=Math.pow(2,15)-1,XE=new $t(0,1),zf=2147483648;function O0(c,n,o,u,f,h,_,w){c.emplaceBack((n<<1)+_,(o<<1)+h,(Math.floor(u*RB)<<1)+f,Math.round(w))}function z0(c,n,o){c.emplaceBack(n.x*un,n.y*un,o?1:0)}function l1(c,n,o,u,f,h){c.emplaceBack(n.x,n.y,(o.x<<1)+u,(o.y<<1)+f,h)}function F0(c,n,o){c.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class YE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class JE{constructor(){this.centroidXY=new $t(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new $t(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new $t(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new $t(this.max.x-this.min.x,this.max.y-this.min.y)}}class QE{constructor(){this.acc=new $t(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,o){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=o.x,n.min.y=n.max.y=o.y)}appendEdge(n,o,u){this.accCount++,this.acc._add(o);let f=!!this.borders;o.x<n.min.x?(n.min.x=o.x,f=!0):o.x>n.max.x&&(n.max.x=o.x,f=!0),o.y<n.min.y?(n.min.y=o.y,f=!0):o.y>n.max.y&&(n.max.y=o.y,f=!0),((o.x===0||o.x===un)&&o.x===u.x)!=((o.y===0||o.y===un)&&o.y===u.y)&&this.processBorderOverlap(o,u),f&&this.checkBorderIntersection(o,u)}checkBorderIntersection(n,o){o.x<0!=n.x<0&&this.addBorderIntersection(0,Bn(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>un!=n.x>un&&this.addBorderIntersection(1,Bn(o.y,n.y,(un-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,Bn(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>un!=n.y>un&&this.addBorderIntersection(3,Bn(o.x,n.x,(un-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[n];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const u=n.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,n.y)}else{const u=n.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,n.x)}}centroid(){return this.accCount===0?new $t(0,0):new $t(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0):0}}function eC(c,n){const o=c.add(n)._unit(),u=Ln(c.x*o.x+c.y*o.y,-1,1);var f,h,_;return _=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(_)))/4*DB*((f=c).x*(h=n).y-f.y*h.x<0?-1:1)}const NB=[c=>c.x<0,c=>c.x>un,c=>c.y<0,c=>c.y>un];function OB(c,n,o,u){const f=[4];if(u===0)return f;o._mult(u);const h=c.sub(o),_=n.sub(o),w=[c,n,h,_];for(let T=0;T<4;T++)for(const P of w)if(NB[T](P)){f.push(T);break}return f}class tC{constructor(n){this.vertexArray=new na,this.indexArray=new Os,this.programConfigurations=new Fh(n.layers,{zoom:n.zoom,lut:n.lut},o=>kB.includes(o)),this._segments=new qi,this.hiddenByLandmarkVertexArray=new x0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new qi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,o,u,f=!1){const h=n.length;if(h>2){let _=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let T;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const P=n[0],x=n[1];T=eC(P.sub(n[h-1])._perp()._unit(),x.sub(P)._perp()._unit())}for(let P=0;P<h;P++){const x=P===h-1?0:P+1,A=n[P],I=n[x],C=n[x===h-1?0:x+1],M=I.sub(A)._perp()._unit(),R=eC(M,C.sub(I)._perp()._unit()),j=T,$=R;if(i2(A,I,o)||f&&iC(A,o)&&iC(I,o)){T=R;continue}const Y=w.vertexLength;l1(this.vertexArray,A,I,1,1,j),l1(this.vertexArray,A,I,1,0,j),l1(this.vertexArray,A,I,0,1,$),l1(this.vertexArray,A,I,0,0,$),w.vertexLength+=4;const X=OB(A,I,M,u);for(const Z of X)this._segmentToGroundQuads[_].push({id:Y,region:Z}),this._segmentToRegionTriCounts[_][Z]+=2,w.primitiveLength+=2;T=R}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),o=n.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((f,h)=>f.region-h.region);for(let u=0;u<o;u++){const f=this._segmentToGroundQuads[u],h=n[u],_=this._segmentToRegionTriCounts[u];_.reduce((T,P)=>T+P,0);let w=0;for(let T=0;T<=4;T++){const P=_[T];if(P!==0){let x=this.regionSegments[T];x||(x=this.regionSegments[T]=new qi);const A={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+w,vertexLength:h.vertexLength,primitiveLength:P};x.get().push(A)}w+=P}for(let T=0;T<f.length;T++){const P=f[T].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,o,u,f,h,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,o,u,f,h,_)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,TB.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,o,u,f,h,_,w){this.hasData()&&this.programConfigurations.updatePaintArrays(n,o,u,f,h,_,w)}updateHiddenByLandmark(n){if(!this.hasData())return;const o=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const u=n.flags&zf?1:0;for(let f=n.groundVertexArrayOffset;f<o;++f)this.hiddenByLandmarkVertexArray.emplace(f,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,CB.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const o=this.regionSegments[n];o&&o.destroy()}}}}class c1{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.pixelRatio=n.pixelRatio,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Os,this.footprintVertices=new ic,this.footprintSegments=[],this.layoutVertexArray=new Ml,this.centroidVertexArray=new fm,this.wallVertexArray=new Hv,this.indexArray=new Os,this.programConfigurations=new Fh(n.layers,{zoom:n.zoom,lut:n.lut},o=>LB.includes(o)),this.segments=new qi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new tC(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,o){}populate(n,o,u,f){this.features=[],this.hasPattern=Gw("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=m(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:_,index:w,sourceLayerIndex:T}of n){const P=this.layers[0]._featureFilter.needGeometry,x=B(h,P);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom),x,u))continue;const A={id:_,sourceLayerIndex:T,index:w,geometry:P?x.geometry:F(h,u,f),properties:h.properties,type:h.type,patterns:{}},I=this.layoutVertexArray.length,C=r2[A.type]==="Polygon";if(this.hasPattern)this.features.push(Hw("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,o));else if(this.wallMode)for(const M of A.geometry)for(const R of KE(M,C))this.addFeature(A,[R],w,u,{},o.availableImages,f,o.brightness);else this.addFeature(A,A.geometry,w,u,{},o.availableImages,f,o.brightness);o.featureIndex.insert(h,A.geometry,w,T,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,o,u,f,h,_){for(const w of this.features){const T=r2[w.type]==="Polygon",{geometry:P}=w;if(this.wallMode)for(const x of P)for(const A of KE(x,T))this.addFeature(w,[A],w.index,o,u,f,h,_);else this.addFeature(w,P,w.index,o,u,f,h,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,o,u,f,h,_,w){this.programConfigurations.updatePaintArrays(n,o,h,u,f,_,w),this.groundEffect.update(n,o,h,u,f,_,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,MB),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,EB.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,PB.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,AB.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,u,f,h,_,w,T){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,x=[new $t(0,0),new $t(un,un)],A=w.projection,I=A.name==="globe",C=this.wallMode||r2[n.type]==="Polygon",M=new QE;M.centroidDataIndex=this.centroidData.length;const R=new JE,j=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},f)<=0,$=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},f);let Y;if(R.height=$,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Od),this.wallMode){if(I)return void pi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;Y=function(Se){const He=Se[0].x===Se[Se.length-1].x&&Se[0].y===Se[Se.length-1].y;(function(hn){let rn=0;const jn=hn.length;for(let Sn=0;Sn<jn;Sn++)rn+=(hn[(Sn+1)%jn].x-hn[Sn].x)*(hn[(Sn+1)%jn].y+hn[Sn].y);return rn>=0})(Se)||(Se=Se.reverse());const We={geometry:[],joinNormals:[],indices:[]},st=[],tt=[],ft=[];let ht=Se.length;for(;ht>=2&&Se[ht-1].equals(Se[ht-2]);)ht--;if(ht<(He?3:2))return We;let bt,gt,At,en,Jt,An=0;for(;An<ht-1&&Se[An].equals(Se[An+1]);)An++;He&&(bt=Se[ht-2],Jt=Se[An].sub(bt)._unit()._perp());for(let hn=An;hn<ht;hn++){if(At=hn===ht-1?He?Se[An+1]:void 0:Se[hn+1],At&&Se[hn].equals(At))continue;Jt&&(en=Jt),bt&&(gt=bt),bt=Se[hn],Jt=At?At.sub(bt)._unit()._perp():en,en=en||Jt;let rn=en.add(Jt);rn.x===0&&rn.y===0||rn._unit();const jn=rn.x*Jt.x+rn.y*Jt.y,Sn=jn!==0?1/jn:1/0,kn=en.x*Jt.y-en.y*Jt.x>0;let Qn="miter";const gr=2;Qn==="miter"&&Sn>gr&&(Qn="bevel"),Qn==="bevel"&&(Sn>100&&(Qn="flipbevel"),Sn<gr&&(Qn="miter"));const sr=(Sr,fr,Er,Jr)=>{const Ei=new $t(Sr.x,Sr.y),tr=new $t(Sr.x,Sr.y);Ei.x+=fr.x*Jr,Ei.y+=fr.y*Jr,tr.x-=fr.x*Math.max(Er,1),tr.y-=fr.y*Math.max(Er,1),ft.push(fr),st.push(Ei),tt.push(tr)};if(Qn==="miter")rn._mult(Sn),sr(bt,rn,0,0);else if(Qn==="flipbevel")rn=Jt.mult(-1),sr(bt,rn,0,0),sr(bt,rn.mult(-1),0,0);else{const Sr=-Math.sqrt(Sn*Sn-1),fr=kn?Sr:0,Er=kn?0:Sr;gt&&sr(bt,en,fr,Er),At&&sr(bt,Jt,fr,Er)}}We.geometry=[...st,...tt.reverse(),st[0]],We.joinNormals=[...ft,...ft.reverse(),ft[ft.length-1]];const on=We.geometry.length-1;for(let hn=0;hn<on/2;hn++)if(hn+1<on/2){let rn=hn,jn=hn+1,Sn=on-1-hn,kn=on-2-hn;rn=rn===0?on-1:rn-1,jn=jn===0?on-1:jn-1,Sn=Sn===0?on-1:Sn-1,kn=kn===0?on-1:kn-1,We.indices.push(Sn),We.indices.push(jn),We.indices.push(rn),We.indices.push(Sn),We.indices.push(kn),We.indices.push(jn)}return We}(o[0]),o=[Y.geometry]}const X=(Se,He)=>Se<(He.length-1)/2||Se===He.length-1,Z=this.wallMode?[o]:r1(o,500);for(let Se=Z.length-1;Se>=0;Se--){const He=Z[Se];(He.length===0||(re=He[0]).every(Pe=>Pe.x<=0)||re.every(Pe=>Pe.x>=un)||re.every(Pe=>Pe.y<=0)||re.every(Pe=>Pe.y>=un))&&Z.splice(Se,1)}var re;let ae;if(I)ae=lC(Z,x,f);else{ae=[];for(const Se of Z)ae.push({polygon:Se,bounds:x})}const ue=C?this.edgeRadius:0,Ce=ue>0&&this.zoom<17,we=(Se,He)=>{if(Se.length===0)return!1;const Pe=Se[Se.length-1];return He.x===Pe.x&&He.y===Pe.y};for(const{polygon:Se,bounds:He}of ae){let Pe=0,We=0;for(const ht of Se)C&&!ht[0].equals(ht[ht.length-1])&&ht.push(ht[0]),We+=C?ht.length-1:ht.length;const st=this.segments.prepareSegment((C?5:4)*We,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const tt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ft=new YE;if(ft.vertexOffset=this.footprintVertices.length,ft.indexOffset=3*this.footprintIndices.length,ft.ringIndices=[],C){const ht=[],bt=[];Pe=st.vertexLength;for(let At=0;At<Se.length;At++){const en=Se[At];en.length&&At!==0&&bt.push(ht.length/2);const Jt=[];let An,on;An=en[1].sub(en[0])._perp()._unit(),ft.ringIndices.push(en.length-1);for(let hn=1;hn<en.length;hn++){const rn=en[hn],jn=en[hn===en.length-1?1:hn+1],Sn=rn.clone();if(ue){on=jn.sub(rn)._perp()._unit();const kn=An.add(on)._unit(),Qn=ue*Math.min(4,1/(An.x*kn.x+An.y*kn.y));Sn.x+=Qn*kn.x,Sn.y+=Qn*kn.y,Sn.x=Math.round(Sn.x),Sn.y=Math.round(Sn.y),An=on}if(!j||ue!==0&&!Ce||we(Jt,Sn)||Jt.push(Sn),O0(this.layoutVertexArray,Sn.x,Sn.y,0,0,1,1,0),this.wallMode){const kn=X(hn,en);z0(this.wallVertexArray,Y.joinNormals[hn],!kn)}st.vertexLength++,this.footprintVertices.emplaceBack(rn.x,rn.y),ht.push(rn.x,rn.y),I&&F0(this.layoutVertexExtArray,A.projectTilePoint(Sn.x,Sn.y,f),A.upVector(f,Sn.x,Sn.y))}j&&(ue===0||Ce)&&(Jt.length!==0&&we(Jt,Jt[0])&&Jt.pop(),this.groundEffect.addData(Jt,He,P))}const gt=this.wallMode?Y.indices:k0(ht,bt);for(let At=0;At<gt.length;At+=3)this.footprintIndices.emplaceBack(ft.vertexOffset+gt[At+0],ft.vertexOffset+gt[At+1],ft.vertexOffset+gt[At+2]),this.indexArray.emplaceBack(Pe+gt[At],Pe+gt[At+2],Pe+gt[At+1]),st.primitiveLength++;ft.indexCount+=gt.length,ft.vertexCount+=this.footprintVertices.length-ft.vertexOffset}for(let ht=0;ht<Se.length;ht++){const bt=Se[ht];M.startRing(R,bt[0]);let gt=bt.length>4&&sC(bt[bt.length-2],bt[0],bt[1]),At=ue?zB(bt[bt.length-2],bt[0],bt[1],ue):0;const en=[];let Jt,An,on;An=bt[1].sub(bt[0])._perp()._unit();let hn=!0;for(let rn=1,jn=0;rn<bt.length;rn++){let Sn=bt[rn-1],kn=bt[rn];const Qn=bt[rn===bt.length-1?1:rn+1];if(M.appendEdge(R,kn,Sn),i2(kn,Sn,He)){ue&&(An=Qn.sub(kn)._perp()._unit(),hn=!hn);continue}const gr=kn.sub(Sn)._perp(),sr=gr.x/(Math.abs(gr.x)+Math.abs(gr.y)),Sr=gr.y>0?1:0,fr=Sn.dist(kn);if(jn+fr>32768&&(jn=0),ue){on=Qn.sub(kn)._perp()._unit();let tr=rC(Sn,kn,Qn,nC(An,on),ue);isNaN(tr)&&(tr=0);const kr=kn.sub(Sn)._unit();Sn=Sn.add(kr.mult(At))._round(),kn=kn.add(kr.mult(-tr))._round(),At=tr,An=on,j&&this.zoom>=17&&(we(en,Sn)||en.push(Sn),we(en,kn)||en.push(kn))}const Er=st.vertexLength,Jr=bt.length>4&&sC(Sn,kn,Qn);let Ei=oC(jn,gt,hn);if(O0(this.layoutVertexArray,Sn.x,Sn.y,sr,Sr,0,0,Ei),O0(this.layoutVertexArray,Sn.x,Sn.y,sr,Sr,0,1,Ei),this.wallMode){const tr=X(rn-1,bt),kr=Y.joinNormals[rn-1];z0(this.wallVertexArray,kr,tr),z0(this.wallVertexArray,kr,tr)}if(jn+=fr,Ei=oC(jn,Jr,!hn),gt=Jr,O0(this.layoutVertexArray,kn.x,kn.y,sr,Sr,0,0,Ei),O0(this.layoutVertexArray,kn.x,kn.y,sr,Sr,0,1,Ei),this.wallMode){const tr=X(rn,bt),kr=Y.joinNormals[rn];z0(this.wallVertexArray,kr,tr),z0(this.wallVertexArray,kr,tr)}if(st.vertexLength+=4,this.indexArray.emplaceBack(Er+0,Er+1,Er+2),this.indexArray.emplaceBack(Er+1,Er+3,Er+2),st.primitiveLength+=2,ue){const tr=Pe+(rn===1?bt.length-2:rn-2),kr=rn===1?Pe:tr+1;if(this.indexArray.emplaceBack(Er+1,tr,Er+3),this.indexArray.emplaceBack(tr,kr,Er+3),st.primitiveLength+=2,Jt===void 0&&(Jt=Er),!i2(Qn,bt[rn],He)){const Fi=rn===bt.length-1?Jt:st.vertexLength;this.indexArray.emplaceBack(Er+2,Er+3,Fi),this.indexArray.emplaceBack(Er+3,Fi+1,Fi),this.indexArray.emplaceBack(Er+3,kr,Fi+1),st.primitiveLength+=3}hn=!hn}if(I){const tr=this.layoutVertexExtArray,kr=A.projectTilePoint(Sn.x,Sn.y,f),Fi=A.projectTilePoint(kn.x,kn.y,f),Ki=A.upVector(f,Sn.x,Sn.y),ts=A.upVector(f,kn.x,kn.y);F0(tr,kr,Ki),F0(tr,kr,Ki),F0(tr,Fi,ts),F0(tr,Fi,ts)}}C&&(Pe+=bt.length-1),j&&ue&&this.zoom>=17&&(en.length!==0&&we(en,en[0])&&en.pop(),this.groundEffect.addData(en,He,P,ue>0))}this.footprintSegments.push(ft),tt.triangleCount=this.indexArray.length-tt.triangleArrayOffset,this.polygonSegments.push(tt),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=M.borders?XE:this.encodeCentroid(M,R),this.centroidData.push(R),M.borders){this.featuresOnBorder.push(M);const Se=this.featuresOnBorder.length-1;for(let He=0;He<M.borders.length;He++)M.borders[He][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[He].push(Se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,h,_,f,T),this.groundEffect.addPaintPropertiesData(n,u,h,_,f,T),this.maxHeight=Math.max(this.maxHeight,$)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((o,u)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}splitToSubtiles(){const n=[];for(let w=0;w<this.centroidData.length;w++){const T=this.centroidData[w],P=+(T.min.y+T.max.y>un),x=2*P+(+(T.min.x+T.max.x>un)^P);for(let A=0;A<T.polygonSegLen;A++){const I=T.polygonSegIdx+A;n.push({centroidIdx:w,subtile:x,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const o=new Os;n.sort((w,T)=>w.triangleSegmentIdx===T.triangleSegmentIdx?w.subtile-T.subtile:w.triangleSegmentIdx-T.triangleSegmentIdx);let u=0,f=0,h=0;for(const w of n){if(w.triangleSegmentIdx!==u)break;h++}const _=n.length;for(;f!==n.length;){u=n[f].triangleSegmentIdx;let w=0,T=f,P=f;for(let x=T;x<h&&n[x].subtile===w;x++)P++;for(;T!==h;){const x=n[T];w=x.subtile;const A=this.centroidData[x.centroidIdx].min.clone(),I=this.centroidData[x.centroidIdx].max.clone(),C={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=T;M<P;M++){const R=n[M],j=this.polygonSegments[R.polygonSegmentIdx],$=this.centroidData[R.centroidIdx].min,Y=this.centroidData[R.centroidIdx].max,X=this.indexArray.uint16;for(let Z=j.triangleArrayOffset;Z<j.triangleArrayOffset+j.triangleCount;Z++)o.emplaceBack(X[3*Z],X[3*Z+1],X[3*Z+2]);C.primitiveLength+=j.triangleCount,A.x=Math.min(A.x,$.x),A.y=Math.min(A.y,$.y),I.x=Math.max(I.x,Y.x),I.y=Math.max(I.y,Y.y)}C.primitiveLength>0&&this.triangleSubSegments.push({segment:C,min:A,max:I}),T=P;for(let M=T;M<h&&n[M].subtile===n[T].subtile;M++)P++}f=h;for(let x=f;x<_&&n[x].triangleSegmentIdx===n[f].triangleSegmentIdx;x++)h++}o._trim(),this.indexArray=o}getVisibleSegments(n,o,u){const f=new qi;if(this.wallMode){for(const R of this.triangleSubSegments)f.segments.push(R.segment);return f}let h=0,_=0;const w=1<<n.canonical.z;if(o){const R=o.getMinMaxForTile(n);R&&(h=R.min,_=R.max)}_+=this.maxHeight;const T=n.toUnwrapped();let P;const x=[T.canonical.x/w+T.wrap,T.canonical.y/w],A=[(T.canonical.x+1)/w+T.wrap,(T.canonical.y+1)/w],I=(R,j,$)=>[R[0]*(1-$[0])+j[0]*$[0],R[1]*(1-$[1])+j[1]*$[1]],C=[],M=[];for(const R of this.triangleSubSegments){C[0]=R.min.x/un,C[1]=R.min.y/un,M[0]=R.max.x/un,M[1]=R.max.y/un;const j=I(x,A,C),$=I(x,A,M);if(new Nn([j[0],j[1],h],[$[0],$[1],_]).intersectsPrecise(u)===0){P&&(f.segments.push(P),P=void 0);continue}const Y=R.segment;P&&P.vertexOffset!==Y.vertexOffset&&(f.segments.push(P),P=void 0),P?(P.vertexLength+=Y.vertexLength,P.primitiveLength+=Y.primitiveLength):P={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&f.segments.push(P),f}encodeCentroid(n,o){const u=n.centroid(),f=o.span(),h=Math.min(7,Math.round(f.x*this.tileToMeter/10)),_=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new $t(Ln(u.x,1,un-1)<<3|h,Ln(u.y,1,un-1)<<3|_)}encodeBorderCentroid(n){if(!n.borders)return new $t(0,0);const o=n.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const f=o[0][0]!==u?0:1;return new $t(6|(o[0][0]!==u?0:65528),(o[f][0]+o[f][1])/2<<3|6)}{const f=o[2][0]!==u?2:3;return new $t((o[f][0]+o[f][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(n){const o=this.centroidData[n.centroidDataIndex];o.flags&=zf,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const o=n.vertexArrayOffset,u=n.vertexCount+n.vertexArrayOffset,f=n.flags&zf?XE:n.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==f.y||h!==f.x){for(let _=o;_<u;++_)this.centroidVertexArray.emplace(_,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const f=o.getReplacementRegionsForTile(n.toUnwrapped());if(t2(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const h=[];for(const _ of this.activeReplacements){if(_.order<u)continue;const w=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-n.canonical.z));for(const T of this.centroidData)if(!(T.flags&zf||_.min.x>T.max.x||T.min.x>_.max.x||_.min.y>T.max.y||T.min.y>_.max.y))for(let P=0;P<T.footprintSegLen;P++){const x=this.footprintSegments[T.footprintSegIdx+P];if(h.length=0,FB(this.footprintVertices,x.vertexOffset,x.vertexCount,_.footprintTileId.canonical,n.canonical,h),GE(_.footprint,h,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-w)){T.flags|=zf;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,o,u){let f=!1;for(let h=0;h<u.footprintSegLen;h++){const _=this.footprintSegments[u.footprintSegIdx+h];let w=0;for(const T of _.ringIndices){for(let P=w,x=T+w-1;P<T+w;x=P++){const A=this.footprintVertices.int16[2*(P+_.vertexOffset)+0],I=this.footprintVertices.int16[2*(P+_.vertexOffset)+1],C=this.footprintVertices.int16[2*(x+_.vertexOffset)+1];I>o!=C>o&&n<(this.footprintVertices.int16[2*(x+_.vertexOffset)+0]-A)*(o-I)/(C-I)+A&&(f=!f)}w=T}}return f}getHeightAtTileCoord(n,o){let u=Number.NEGATIVE_INFINITY,f=!0;const h=4*(n+un)*un+(o+un);if(this.partLookup.hasOwnProperty(h)){const _=this.partLookup[h];return _?{height:_.height,hidden:!!(_.flags&zf)}:void 0}for(const _ of this.centroidData)n>_.max.x||_.min.x>n||o>_.max.y||_.min.y>o||this.footprintContainsPoint(n,o,_)&&_&&_.height>u&&(u=_.height,this.partLookup[h]=_,f=!!(_.flags&zf));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:f};this.partLookup[h]=void 0}}function nC(c,n){const o=c.add(n)._unit();return c.x*o.x+c.y*o.y}function zB(c,n,o,u){const f=n.sub(c)._perp()._unit(),h=o.sub(n)._perp()._unit();return rC(c,n,o,nC(f,h),u)}function rC(c,n,o,u,f){const h=Math.sqrt(1-u*u);return Math.min(c.dist(n)/3,n.dist(o)/3,f*h/u)}function i2(c,n,o){return c.x<o[0].x&&n.x<o[0].x||c.x>o[1].x&&n.x>o[1].x||c.y<o[0].y&&n.y<o[0].y||c.y>o[1].y&&n.y>o[1].y}function iC(c,n){return c.x<n[0].x||c.x>n[1].x||c.y<n[0].y||c.y>n[1].y}function sC(c,n,o){if(c.x<0||c.x>=un||n.x<0||n.x>=un||o.x<0||o.x>=un)return!1;const u=o.sub(n),f=u.perp(),h=c.sub(n);return(u.x*h.x+u.y*h.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(h.x*h.x+h.y*h.y))>-.866&&f.x*h.x+f.y*h.y<0}function oC(c,n,o){const u=n?2|c:-3&c;return o?1|u:-2&u}function aC(){const c=Math.PI/32,n=Math.tan(c),o=Vd;return o*Math.sqrt(1+2*n*n)-o}function lC(c,n,o){const u=1<<o.z,f=Qa(o.x/u),h=Qa((o.x+1)/u),_=Po(o.y/u),w=Po((o.y+1)/u);return function(T,P,x,A,I=0,C){const M=[];if(!T.length||!x||!A)return M;const R=(ae,ue)=>{for(const Ce of ae)M.push({polygon:Ce,bounds:ue})},j=Math.ceil(Math.log2(x)),$=Math.ceil(Math.log2(A)),Y=j-$,X=[];for(let ae=0;ae<Math.abs(Y);ae++)X.push(Y>0?0:1);for(let ae=0;ae<Math.min(j,$);ae++)X.push(0),X.push(1);let Z=T;if(Z=s1(Z,P[0].y-I,P[1].y+I,1),Z=s1(Z,P[0].x-I,P[1].x+I,0),!Z.length)return M;const re=[];for(X.length?re.push({polygons:Z,bounds:P,depth:0}):R(Z,P);re.length;){const ae=re.pop(),ue=ae.depth,Ce=X[ue],we=ae.bounds[0],Se=ae.bounds[1],He=Ce===0?we.x:we.y,Pe=Ce===0?Se.x:Se.y,We=C?C(Ce,He,Pe):.5*(He+Pe),st=s1(ae.polygons,He-I,We+I,Ce),tt=s1(ae.polygons,We-I,Pe+I,Ce);if(st.length){const ft=[we,new $t(Ce===0?We:Se.x,Ce===1?We:Se.y)];X.length>ue+1?re.push({polygons:st,bounds:ft,depth:ue+1}):R(st,ft)}if(tt.length){const ft=[new $t(Ce===0?We:we.x,Ce===1?We:we.y),Se];X.length>ue+1?re.push({polygons:tt,bounds:ft,depth:ue+1}):R(tt,ft)}}return M}(c,n,Math.ceil((h-f)/11.25),Math.ceil((_-w)/11.25),1,(T,P,x)=>{if(T===0)return .5*(P+x);{const A=Po((o.y+P/un)/u);return(Ja(.5*(Po((o.y+x/un)/u)+A))*u-o.y)*un}})}function FB(c,n,o,u,f,h){const _=Math.pow(2,u.z-f.z);for(let w=0;w<o;w++){let T=c.int16[2*(w+n)+0],P=c.int16[2*(w+n)+1];T=(T+f.x*un)*_-u.x*un,P=(P+f.y*un)*_-u.y*un,h.push(new $t(T,P))}}let cC,uC;function B0(c,n){return c.x*n.x+c.y*n.y}function hC(c,n){if(c.length===1){let o=0;const u=n[o++];let f;for(;!f||u.equals(f);)if(f=n[o++],!f)return 1/0;for(;o<n.length;o++){const h=n[o],_=c[0],w=f.sub(u),T=h.sub(u),P=_.sub(u),x=B0(w,w),A=B0(w,T),I=B0(T,T),C=B0(P,w),M=B0(P,T),R=x*I-A*A,j=(I*C-A*M)/R,$=(x*M-A*C)/R,Y=u.z*(1-j-$)+f.z*j+h.z*$;if(isFinite(Y))return Y}return 1/0}{let o=1/0;for(const u of n)o=Math.min(o,u.z);return o}}function dC(c,n,o,u,f,h,_,w){const T=_*f.getElevationAt(c,n,!0,!0),P=h[0]!==0,x=P?h[1]===0?_*(h[0]/7-450):_*function(A,I,C){const M=Math.floor(I[0]/8),R=Math.floor(I[1]/8),j=10*(I[0]-8*M),$=10*(I[1]-8*R),Y=A.getElevationAt(M,R,!0,!0),X=A.getMeterToDEM(C),Z=Math.floor(.5*(j*X-1)),re=Math.floor(.5*($*X-1)),ae=A.tileCoordToPixel(M,R),ue=2*Z+1,Ce=2*re+1,we=function(tt,ft,ht,bt,gt){return[tt.getElevationAtPixel(ft,ht,!0),tt.getElevationAtPixel(ft+gt,ht,!0),tt.getElevationAtPixel(ft,ht+gt,!0),tt.getElevationAtPixel(ft+bt,ht+gt,!0)]}(A,ae.x-Z,ae.y-re,ue,Ce),Se=Math.abs(we[0]-we[1]),He=Math.abs(we[2]-we[3]),Pe=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),We=Math.min(.25,.5*X*(Se+He)/ue),st=Math.min(.25,.5*X*Pe/Ce);return Y+Math.max(We*j,st*$)}(f,h,w):T;return{base:T+(o===0?-1:o),top:P?Math.max(x+u,T+o+2):T+u}}Ze(c1,"FillExtrusionBucket",{omit:["layers","features"]}),Ze(JE,"PartData"),Ze(YE,"FootprintSegment"),Ze(QE,"BorderCentroidData"),Ze(tC,"GroundEffect");const BB=Or([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),jB=Or([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:UB}=BB,VB=Or([{name:"a_packed",components:3,type:"Float32"}]),{members:qB}=VB,$B=Or([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:GB}=$B;class fC{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new Nf({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const u=this.getKey(n,o);return this.positions[u]}trim(){const n=this.width,o=this.height=Kn(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,u){const f=[];let h=n.length%2==1?-n[n.length-1]*u:0,_=n[0]*u,w=!0;f.push({left:h,right:_,isDash:w,zeroLength:n[0]===0});let T=n[0];for(let P=1;P<n.length;P++){w=!w;const x=n[P];h=T*u,T+=x,_=T*u,f.push({left:h,right:_,isDash:w,zeroLength:x===0})}return f}addRoundDash(n,o,u){const f=o/2;for(let h=-u;h<=u;h++){const _=this.width*(this.nextRow+u+h);let w=0,T=n[w];for(let P=0;P<this.width;P++){P/T.right>1&&(T=n[++w]);const x=Math.abs(P-T.left),A=Math.abs(P-T.right),I=Math.min(x,A);let C;const M=h/u*(f+1);if(T.isDash){const R=f-Math.abs(M);C=Math.sqrt(I*I+R*R)}else C=f-Math.sqrt(I*I+M*M);this.image.data[_+P]=Math.max(0,Math.min(255,C+128))}}}addRegularDash(n,o){for(let T=n.length-1;T>=0;--T){const P=n[T],x=n[T+1];P.zeroLength?n.splice(T,1):x&&x.isDash===P.isDash&&(x.left=P.left,n.splice(T,1))}const u=n[0],f=n[n.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const h=this.width*this.nextRow;let _=0,w=n[_];for(let T=0;T<this.width;T++){T/w.right>1&&(w=n[++_]);const P=Math.abs(T-w.left),x=Math.abs(T-w.right),A=Math.min(P,x);this.image.data[h+T]=Math.max(0,Math.min(255,(w.isDash?A:-A)+o+128))}}addDash(n,o){const u=this.getKey(n,o);if(this.positions[u])return this.positions[u];const f=o==="round",h=f?7:0,_=2*h+1;if(this.nextRow+_>this.height)return pi("LineAtlas out of space"),null;n.length===0&&n.push(1);let w=0;for(let x=0;x<n.length;x++)n[x]<0&&(pi("Negative value is found in line dasharray, replacing values with 0"),n[x]=0),w+=n[x];if(w!==0){const x=this.width/w,A=this.getDashRanges(n,this.width,x);f?this.addRoundDash(A,x,h):this.addRegularDash(A,o==="square"?.5*x:0)}const T=this.nextRow+h;this.nextRow+=_;const P={tl:[T,h],br:[w,0]};return this.positions[u]=P,P}}Ze(fC,"LineAtlas");const HB=Of.VectorTileFeature.types,WB=Math.cos(Math.PI/180*37.5),ZB=Math.cos(Math.PI/180*5);class s2{constructor(n){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=n.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=n.overscaling,this.pixelRatio=n.pixelRatio,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Pf,this.layoutVertexArray2=new ka,this.patternVertexArray=new ka,this.indexArray=new Os,this.programConfigurations=new Fh(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new qi,this.maxLineLength=0,this.zOffsetVertexArray=new ka,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:un/64}updateFootprints(n,o){}populate(n,o,u,f){this.hasPattern=Gw("line",this.layers,this.pixelRatio,o);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=m(u);const _=this.layers[0].layout.get("line-z-offset"),w=_.isConstant()&&!_.constantOr(0),T=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=T==="sea"||T==="ground"||!w&&T==="none",this.hasZOffset&&T==="none"&&pi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const P=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&P!==void 0;const x=[];for(const{feature:M,id:R,index:j,sourceLayerIndex:$}of n){const Y=this.layers[0]._featureFilter.needGeometry,X=B(M,Y);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom),X,u))continue;const Z=h?h.evaluate(X,{},u):void 0,re={id:R,properties:M.properties,type:M.type,sourceLayerIndex:$,index:j,geometry:Y?X.geometry:F(M,u,f),patterns:{},sortKey:Z};x.push(re)}h&&x.sort((M,R)=>M.sortKey-R.sortKey);const{lineAtlas:A,featureIndex:I}=o,C=this.addConstantDashes(A);for(const M of x){const{geometry:R,index:j,sourceLayerIndex:$}=M;if(C&&this.addFeatureDashes(M,A),this.hasPattern){const Y=Hw("line",this.layers,M,this.zoom,this.pixelRatio,o);this.patternFeatures.push(Y)}else this.addFeature(M,R,j,u,A.positions,o.availableImages,o.brightness);I.insert(n[j].feature,R,j,$,this.index)}}addConstantDashes(n){let o=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,h=u.layout.get("line-cap").value;if(f.kind!=="constant"||h.kind!=="constant")o=!0;else{const _=h.value,w=f.value;if(!w)continue;n.addDash(w,_)}}return o}addFeatureDashes(n,o){const u=this.zoom;for(const f of this.layers){const h=f.paint.get("line-dasharray").value,_=f.layout.get("line-cap").value;if(h.kind==="constant"&&_.kind==="constant")continue;let w,T;if(h.kind==="constant"){if(w=h.value,!w)continue}else w=h.evaluate({zoom:u},n);T=_.kind==="constant"?_.value:_.evaluate({zoom:u},n),o.addDash(w,T),n.patterns[f.id]=o.getKey(w,T)}}update(n,o,u,f,h,_,w){this.programConfigurations.updatePaintArrays(n,o,h,u,f,_,w)}addFeatures(n,o,u,f,h,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,o,u,f,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,qB)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,GB)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,jB.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,UB),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,u,f,h,_,w){const T=this.layers[0].layout,P=T.get("line-join").evaluate(n,{}),x=T.get("line-cap").evaluate(n,{}),A=T.get("line-miter-limit"),I=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(n),this.lineFeature=n,this.zOffsetValue=T.get("line-z-offset").value;const C=this.layers[0].paint.get("line-width").value;C.kind!=="constant"&&C.isLineProgressConstant===!1&&(this.variableWidthValue=C);for(const M of o)this.addLine(M,n,f,P,x,A,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,h,_,f,w)}addLine(n,o,u,f,h,_,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=f==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<n.length-1;X++)this.totalDistance+=n[X].dist(n[X+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=HB[o.type]==="Polygon";let x=n.length;for(;x>=2&&n[x-1].equals(n[x-2]);)x--;let A=0;for(;A<x-1&&n[A].equals(n[A+1]);)A++;if(x<(P?3:2))return;f==="bevel"&&(_=1.05);const I=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let C,M,R,j,$,Y;this.e1=this.e2=-1,P&&(C=n[x-2],$=n[A].sub(C)._unit()._perp());for(let X=A;X<x;X++){if(R=X===x-1?P?n[A+1]:void 0:n[X+1],R&&n[X].equals(R))continue;$&&(j=$),C&&(M=C),C=n[X],Y=this.evaluateLineProgressFeatures(M?M.dist(C):0),$=R?R.sub(C)._unit()._perp():j,j=j||$;const Z=M&&R;let re=Z?f:P||T?"butt":h;const ae=j.x*$.x+j.y*$.y;if(T){const st=function(tt){if(tt.patternJoinNone){const ft=tt.segmentPoints.length/2,ht=tt.lineSoFar-tt.segmentStart;for(let bt=0;bt<ft;++bt){const gt=tt.segmentPoints[2*bt+1],At=Math.round(tt.segmentPoints[2*bt])+.5+.25*gt;tt.patternVertexArray.emplaceBack(At,ht,tt.segmentStart),tt.patternVertexArray.emplaceBack(At,ht,tt.segmentStart)}tt.segmentPoints.length=0}tt.e1=tt.e2=-1};if(Z&&ae<ZB){this.updateDistance(M,C),this.addCurrentVertex(C,j,1,1,I,Y),st(this),this.addCurrentVertex(C,$,-1,-1,I,Y);continue}if(M){if(!R){this.updateDistance(M,C),this.addCurrentVertex(C,j,1,1,I,Y),st(this);continue}re="miter"}}let ue=j.add($);ue.x===0&&ue.y===0||ue._unit();const Ce=ue.x*$.x+ue.y*$.y,we=Ce!==0?1/Ce:1/0,Se=2*Math.sqrt(2-2*Ce),He=Ce<WB&&M&&R,Pe=j.x*$.y-j.y*$.x>0,We=this.overscaling<=16?15*un/(512*this.overscaling):0;if(Z&&re==="round"){if(we<w)re="miter";else if(we<=2){const st=o2(C,-10,un+10);re=this.hasZOffset&&(st||this.hasCrossSlope)?"miter":"fakeround"}}if(re==="miter"&&we>_&&(re="bevel"),re==="bevel"&&(we>2&&(re="flipbevel"),we<_&&(re="miter")),M&&!(re==="miter"&&He)&&this.updateDistance(M,C),re==="miter")if(He){const st=C.dist(M);if(st>2*We){const ft=C.sub(C.sub(M)._mult(We/st)._round());this.updateDistance(M,ft),this.addCurrentVertex(ft,j,0,0,I,Y),M=ft}this.updateDistance(M,C),ue._mult(we),this.addCurrentVertex(C,ue,0,0,I,Y);const tt=C.dist(R);if(tt>2*We){const ft=C.add(R.sub(C)._mult(We/tt)._round());this.updateDistance(C,ft),this.addCurrentVertex(ft,$,0,0,I,Y),C=ft}}else ue._mult(we),this.addCurrentVertex(C,ue,0,0,I,Y);else if(re==="flipbevel"){if(we>100)ue=$.mult(-1);else{const st=we*j.add($).mag()/j.sub($).mag();ue._perp()._mult(st*(Pe?-1:1))}this.addCurrentVertex(C,ue,0,0,I,Y),this.addCurrentVertex(C,ue.mult(-1),0,0,I,Y)}else if(re==="bevel"||re==="fakeround"){Y!=null&&M&&this.addCurrentVertex(C,j,-1,-1,I,Y);const st=C.dist(M)<=2*We&&re!=="bevel",tt=ue.mult(Pe?1:-1);tt._mult(we);const ft=$.mult(Pe?-1:1),ht=j.mult(Pe?-1:1),bt=this.evaluateLineProgressFeatures(this.distance);if(Y==null&&(this.addHalfVertex(C,tt.x,tt.y,!1,!Pe,0,I,bt),st||this.addHalfVertex(C,tt.x+2*ht.x,tt.y+2*ht.y,!1,Pe,0,I,bt)),re==="fakeround"){const gt=Math.round(180*Se/Math.PI/20);this.addHalfVertex(C,ht.x,ht.y,!1,Pe,0,I,bt);for(let At=0;At<gt;At++){let en=At/gt;if(en!==.5){const An=en-.5;en+=en*An*(en-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*An*An+(.848013+ae*(.215638*ae-1.06021)))}const Jt=ft.sub(ht)._mult(en)._add(ht)._unit();this.addHalfVertex(C,Jt.x,Jt.y,!1,Pe,0,I,bt)}this.addHalfVertex(C,ft.x,ft.y,!1,Pe,0,I,bt)}st||Y!=null||this.addHalfVertex(C,tt.x+2*ft.x,tt.y+2*ft.y,!1,Pe,0,I,bt),Y!=null&&R&&this.addCurrentVertex(C,$,1,1,I,Y)}else re==="butt"?this.addCurrentVertex(C,ue,0,0,I,Y):re==="square"?(M||this.addCurrentVertex(C,ue,-1,-1,I,Y),this.addCurrentVertex(C,ue,0,0,I,Y),M&&this.addCurrentVertex(C,ue,1,1,I,Y)):re==="round"&&(M&&(this.addCurrentVertex(C,j,0,0,I,Y),this.addCurrentVertex(C,j,1,1,I,Y,!0)),R&&(this.addCurrentVertex(C,$,-1,-1,I,Y,!0),this.addCurrentVertex(C,$,0,0,I,Y)))}}addVerticesTo(n,o,u,f,h,_,w,T,P,x){const A=(o.w-n.w)/this.tessellationStep|0;let I=0;const C=this.scaledDistance;if(A>1){this.lineSoFar=n.w;const R=(o.x-n.x)/A,j=(o.y-n.y)/A,$=(o.z-n.z)/A,Y=(o.w-n.w)/A;for(let X=1;X<A;++X){n.x+=R,n.y+=j,n.z+=$,this.lineSoFar+=Y,I+=Y;const Z=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(n,u,f,x,!1,w,P,Z),this.addHalfVertex(n,h,_,x,!0,-T,P,Z)}}this.lineSoFar=o.w,this.scaledDistance=C;const M=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,u,f,x,!1,w,P,M),this.addHalfVertex(o,h,_,x,!0,-T,P,M)}evaluateLineProgressFeatures(n){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+n)/this.totalFeatureLength):pi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}:{zOffset:0,variableWidth:o}}addCurrentVertex(n,o,u,f,h,_,w=!1){const T=o.x+o.y*u,P=o.y-o.x*u,x=o.y*f-o.x,A=-o.y-o.x*f;if(_!=null){const I=this.hasZOffset,C=-10,M=un+10,R=_.zOffset,j=new BE(n.x,n.y,R,this.lineSoFar),$=!!I&&o2(n,C,M),Y=this.lineSoFar,X=this.distance;if(this.currentVertex)if($){const Z=this.currentVertexIsOutside,re=this.currentVertex,ae=new BE(n.x,n.y,R,this.lineSoFar);if(UE(re,ae,C,M),!o2(ae,C,M)){if(Z){this.e1=this.e2=-1,this.distance-=re.dist(j),this.lineSoFar=re.w;const ue=this.evaluateLineProgressFeatures(re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(re,T,P,w,!1,u,h,ue),this.addHalfVertex(re,x,A,w,!0,-f,h,ue),this.prevDistance=this.distance}this.distance=this.prevDistance+re.dist(ae),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(re,ae,T,P,x,A,u,f,h,w),this.distance=X,this.scaledDistance=this.distance/this.totalDistance}}else{const Z=this.currentVertex;if(this.currentVertexIsOutside){UE(Z,j,C,M),this.e1=this.e2=-1,this.distance-=Z.dist(j),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Z.w;const re=this.evaluateLineProgressFeatures(Z.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Z,T,P,w,!1,u,h,re),this.addHalfVertex(Z,x,A,w,!0,-f,h,re),this.prevDistance=this.distance,this.distance=X,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Z,j,T,P,x,A,u,f,h,w)}else $||(this.addHalfVertex(n,T,P,w,!1,u,h,_),this.addHalfVertex(n,x,A,w,!0,-f,h,_));this.currentVertex=j,this.currentVertexIsOutside=$,this.lineSoFar=Y}else this.addHalfVertex(n,T,P,w,!1,u,h,_),this.addHalfVertex(n,x,A,w,!0,-f,h,_)}addHalfVertex({x:n,y:o},u,f,h,_,w,T,P){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((n<<1)+(h?1:0),(o<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=Bn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const x=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),T.primitiveLength++),_?this.e2=x:this.e1=x,P!=null&&this.zOffsetVertexArray.emplaceBack(P.zOffset,P.variableWidth,P.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(n,o){this.prevDistance=this.distance,this.distance+=n.dist(o),this.updateScaledDistance()}}function o2(c,n,o){return c.x<n||c.x>o||c.y<n||c.y>o}let pC,mC;function gC(c,n,o){return n*(un/(c.tileSize*Math.pow(2,o-c.tileID.overscaledZ)))}Ze(s2,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const _C=(c,n,o)=>(1-o)*c+o*n;function yC(c,n){return 1/gC(c,1,n.tileZoom)}function vC(c,n,o,u){return c.translatePosMatrix(u||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const xC=c=>{const n=[];bC(c)&&n.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const o=c.paint.get("line-trim-offset");o[0]===0&&o[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const u=c.layout.get("line-join").constantOr("miter")==="none",f=!!c.paint.get("line-pattern").constantOr(1);return u&&f&&n.push("LINE_JOIN_NONE"),n};function bC(c){const n=c.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}let a2;const wC=()=>a2||(a2={layout:pC||(pC=new Ir({"line-cap":new vn(Tt.layout_line["line-cap"]),"line-join":new vn(Tt.layout_line["line-join"]),"line-miter-limit":new an(Tt.layout_line["line-miter-limit"]),"line-round-limit":new an(Tt.layout_line["line-round-limit"]),"line-sort-key":new vn(Tt.layout_line["line-sort-key"]),"line-z-offset":new vn(Tt.layout_line["line-z-offset"]),"line-elevation-reference":new an(Tt.layout_line["line-elevation-reference"]),"line-cross-slope":new an(Tt.layout_line["line-cross-slope"]),visibility:new an(Tt.layout_line.visibility),"line-width-unit":new an(Tt.layout_line["line-width-unit"])})),paint:mC||(mC=new Ir({"line-opacity":new vn(Tt.paint_line["line-opacity"]),"line-color":new vn(Tt.paint_line["line-color"]),"line-translate":new an(Tt.paint_line["line-translate"]),"line-translate-anchor":new an(Tt.paint_line["line-translate-anchor"]),"line-width":new vn(Tt.paint_line["line-width"]),"line-gap-width":new vn(Tt.paint_line["line-gap-width"]),"line-offset":new vn(Tt.paint_line["line-offset"]),"line-blur":new vn(Tt.paint_line["line-blur"]),"line-dasharray":new vn(Tt.paint_line["line-dasharray"]),"line-pattern":new vn(Tt.paint_line["line-pattern"]),"line-gradient":new La(Tt.paint_line["line-gradient"]),"line-trim-offset":new an(Tt.paint_line["line-trim-offset"]),"line-trim-fade-range":new an(Tt.paint_line["line-trim-fade-range"]),"line-trim-color":new an(Tt.paint_line["line-trim-color"]),"line-emissive-strength":new an(Tt.paint_line["line-emissive-strength"]),"line-border-width":new vn(Tt.paint_line["line-border-width"]),"line-border-color":new vn(Tt.paint_line["line-border-color"]),"line-occlusion-opacity":new an(Tt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},a2);class KB extends vn{possiblyEvaluate(n,o){return o=new Nr(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(n,o)}evaluate(n,o,u,f){return o=si({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,u,f)}}let j0;function SC(c,n){return n>0?n+2*c:c}const XB=Or([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),YB=Or([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),JB=Or([{name:"a_projected_pos",components:4,type:"Float32"}],4);Or([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const QB=Or([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),ej=Or([{name:"a_texb",components:2,type:"Uint16"}]),tj=Or([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),nj=Or([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Or([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const TC=Or([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rj=Or([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Or([{name:"triangle",components:3,type:"Uint16"}]),Or([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Or([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Or([{type:"Float32",name:"offsetX"}]),Or([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var $o=24;const Wu=128;function AC(c,n,o,u,f){if(c.kind==="camera")return c.maxSize;if(c.kind==="composite"){const h=n.possiblyEvaluate(new Nr(c.maxZoom),o).evaluate(f,{},o),_=n.possiblyEvaluate(new Nr(c.minZoom),o).evaluate(f,{},o);return Math.max(h,_)}return n.possiblyEvaluate(new Nr(u)).evaluate(f,{},o)}function l2(c,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Nr(c+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:f}=o;let h=0;for(;h<u.length&&u[h]<=c;)h++;h=Math.max(0,h-1);let _=h;for(;_<u.length&&u[_]<c+1;)_++;_=Math.min(u.length-1,_);const w=u[h],T=u[_];return o.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:T,minSize:o.evaluate(new Nr(w)),maxSize:o.evaluate(new Nr(T)),interpolationType:f}}}function u1(c,{uSize:n,uSizeT:o},{lowerSize:u,upperSize:f}){return c.kind==="source"?u/Wu:c.kind==="composite"?Bn(u/Wu,f/Wu,o):n}function Lg(c,n,o=1){let u=0,f=0;if(c.kind==="constant")f=c.layoutSize*o;else if(c.kind!=="source"){const{interpolationType:h,minZoom:_,maxZoom:w}=c,T=h?Ln(Ia.interpolationFactor(h,n,_,w),0,1):0;c.kind==="camera"?f=Bn(c.minSize,c.maxSize,T)*o:u=T*o}return{uSizeT:u,uSize:f}}var ij=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Wu,evaluateSizeForFeature:u1,evaluateSizeForZoom:Lg,getRasterizedIconSize:AC,getSizeData:l2});function sj(c,n,o){return c.sections.forEach(u=>{u.text=function(f,h,_){const w=h.layout.get("text-transform").evaluate(_,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),ci.applyArabicShaping&&(f=ci.applyArabicShaping(f)),f}(u.text,n,o)}),c}const U0={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function oj(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function aj(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var EC,c2,CC,u2={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function lj(){return EC||(EC=1,u2.read=function(c,n,o,u,f){var h,_,w=8*f-u-1,T=(1<<w)-1,P=T>>1,x=-7,A=o?f-1:0,I=o?-1:1,C=c[n+A];for(A+=I,h=C&(1<<-x)-1,C>>=-x,x+=w;x>0;h=256*h+c[n+A],A+=I,x-=8);for(_=h&(1<<-x)-1,h>>=-x,x+=u;x>0;_=256*_+c[n+A],A+=I,x-=8);if(h===0)h=1-P;else{if(h===T)return _?NaN:1/0*(C?-1:1);_+=Math.pow(2,u),h-=P}return(C?-1:1)*_*Math.pow(2,h-u)},u2.write=function(c,n,o,u,f,h){var _,w,T,P=8*h-f-1,x=(1<<P)-1,A=x>>1,I=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=u?0:h-1,M=u?1:-1,R=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(w=isNaN(n)?1:0,_=x):(_=Math.floor(Math.log(n)/Math.LN2),n*(T=Math.pow(2,-_))<1&&(_--,T*=2),(n+=_+A>=1?I/T:I*Math.pow(2,1-A))*T>=2&&(_++,T/=2),_+A>=x?(w=0,_=x):_+A>=1?(w=(n*T-1)*Math.pow(2,f),_+=A):(w=n*Math.pow(2,A-1)*Math.pow(2,f),_=0));f>=8;c[o+C]=255&w,C+=M,w/=256,f-=8);for(_=_<<f|w,P+=f;P>0;c[o+C]=255&_,C+=M,_/=256,P-=8);c[o+C-M]|=128*R}),u2}function PC(){if(CC)return c2;CC=1,c2=n;var c=lj();function n(Z){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Z)?Z:new Uint8Array(Z||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var o=4294967296,u=1/o,f=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(Z){return Z.type===n.Bytes?Z.readVarint()+Z.pos:Z.pos+1}function _(Z,re,ae){return ae?4294967296*re+(Z>>>0):4294967296*(re>>>0)+(Z>>>0)}function w(Z,re,ae){var ue=re<=16383?1:re<=2097151?2:re<=268435455?3:Math.floor(Math.log(re)/(7*Math.LN2));ae.realloc(ue);for(var Ce=ae.pos-1;Ce>=Z;Ce--)ae.buf[Ce+ue]=ae.buf[Ce]}function T(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeVarint(Z[ae])}function P(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeSVarint(Z[ae])}function x(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeFloat(Z[ae])}function A(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeDouble(Z[ae])}function I(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeBoolean(Z[ae])}function C(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeFixed32(Z[ae])}function M(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeSFixed32(Z[ae])}function R(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeFixed64(Z[ae])}function j(Z,re){for(var ae=0;ae<Z.length;ae++)re.writeSFixed64(Z[ae])}function $(Z,re){return(Z[re]|Z[re+1]<<8|Z[re+2]<<16)+16777216*Z[re+3]}function Y(Z,re,ae){Z[ae]=re,Z[ae+1]=re>>>8,Z[ae+2]=re>>>16,Z[ae+3]=re>>>24}function X(Z,re){return(Z[re]|Z[re+1]<<8|Z[re+2]<<16)+(Z[re+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(Z,re,ae){for(ae=ae||this.length;this.pos<ae;){var ue=this.readVarint(),Ce=ue>>3,we=this.pos;this.type=7&ue,Z(Ce,re,this),this.pos===we&&this.skip(ue)}return re},readMessage:function(Z,re){return this.readFields(Z,re,this.readVarint()+this.pos)},readFixed32:function(){var Z=$(this.buf,this.pos);return this.pos+=4,Z},readSFixed32:function(){var Z=X(this.buf,this.pos);return this.pos+=4,Z},readFixed64:function(){var Z=$(this.buf,this.pos)+$(this.buf,this.pos+4)*o;return this.pos+=8,Z},readSFixed64:function(){var Z=$(this.buf,this.pos)+X(this.buf,this.pos+4)*o;return this.pos+=8,Z},readFloat:function(){var Z=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Z},readDouble:function(){var Z=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Z},readVarint:function(Z){var re,ae,ue=this.buf;return re=127&(ae=ue[this.pos++]),ae<128?re:(re|=(127&(ae=ue[this.pos++]))<<7,ae<128?re:(re|=(127&(ae=ue[this.pos++]))<<14,ae<128?re:(re|=(127&(ae=ue[this.pos++]))<<21,ae<128?re:function(Ce,we,Se){var He,Pe,We=Se.buf;if(He=(112&(Pe=We[Se.pos++]))>>4,Pe<128||(He|=(127&(Pe=We[Se.pos++]))<<3,Pe<128)||(He|=(127&(Pe=We[Se.pos++]))<<10,Pe<128)||(He|=(127&(Pe=We[Se.pos++]))<<17,Pe<128)||(He|=(127&(Pe=We[Se.pos++]))<<24,Pe<128)||(He|=(1&(Pe=We[Se.pos++]))<<31,Pe<128))return _(Ce,He,we);throw new Error("Expected varint not more than 10 bytes")}(re|=(15&(ae=ue[this.pos]))<<28,Z,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Z=this.readVarint();return Z%2==1?(Z+1)/-2:Z/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Z=this.readVarint()+this.pos,re=this.pos;return this.pos=Z,Z-re>=12&&f?function(ae,ue,Ce){return f.decode(ae.subarray(ue,Ce))}(this.buf,re,Z):function(ae,ue,Ce){for(var we="",Se=ue;Se<Ce;){var He,Pe,We,st=ae[Se],tt=null,ft=st>239?4:st>223?3:st>191?2:1;if(Se+ft>Ce)break;ft===1?st<128&&(tt=st):ft===2?(192&(He=ae[Se+1]))==128&&(tt=(31&st)<<6|63&He)<=127&&(tt=null):ft===3?(Pe=ae[Se+2],(192&(He=ae[Se+1]))==128&&(192&Pe)==128&&((tt=(15&st)<<12|(63&He)<<6|63&Pe)<=2047||tt>=55296&&tt<=57343)&&(tt=null)):ft===4&&(Pe=ae[Se+2],We=ae[Se+3],(192&(He=ae[Se+1]))==128&&(192&Pe)==128&&(192&We)==128&&((tt=(15&st)<<18|(63&He)<<12|(63&Pe)<<6|63&We)<=65535||tt>=1114112)&&(tt=null)),tt===null?(tt=65533,ft=1):tt>65535&&(tt-=65536,we+=String.fromCharCode(tt>>>10&1023|55296),tt=56320|1023&tt),we+=String.fromCharCode(tt),Se+=ft}return we}(this.buf,re,Z)},readBytes:function(){var Z=this.readVarint()+this.pos,re=this.buf.subarray(this.pos,Z);return this.pos=Z,re},readPackedVarint:function(Z,re){if(this.type!==n.Bytes)return Z.push(this.readVarint(re));var ae=h(this);for(Z=Z||[];this.pos<ae;)Z.push(this.readVarint(re));return Z},readPackedSVarint:function(Z){if(this.type!==n.Bytes)return Z.push(this.readSVarint());var re=h(this);for(Z=Z||[];this.pos<re;)Z.push(this.readSVarint());return Z},readPackedBoolean:function(Z){if(this.type!==n.Bytes)return Z.push(this.readBoolean());var re=h(this);for(Z=Z||[];this.pos<re;)Z.push(this.readBoolean());return Z},readPackedFloat:function(Z){if(this.type!==n.Bytes)return Z.push(this.readFloat());var re=h(this);for(Z=Z||[];this.pos<re;)Z.push(this.readFloat());return Z},readPackedDouble:function(Z){if(this.type!==n.Bytes)return Z.push(this.readDouble());var re=h(this);for(Z=Z||[];this.pos<re;)Z.push(this.readDouble());return Z},readPackedFixed32:function(Z){if(this.type!==n.Bytes)return Z.push(this.readFixed32());var re=h(this);for(Z=Z||[];this.pos<re;)Z.push(this.readFixed32());return Z},readPackedSFixed32:function(Z){if(this.type!==n.Bytes)return Z.push(this.readSFixed32());var re=h(this);for(Z=Z||[];this.pos<re;)Z.push(this.readSFixed32());return Z},readPackedFixed64:function(Z){if(this.type!==n.Bytes)return Z.push(this.readFixed64());var re=h(this);for(Z=Z||[];this.pos<re;)Z.push(this.readFixed64());return Z},readPackedSFixed64:function(Z){if(this.type!==n.Bytes)return Z.push(this.readSFixed64());var re=h(this);for(Z=Z||[];this.pos<re;)Z.push(this.readSFixed64());return Z},skip:function(Z){var re=7&Z;if(re===n.Varint)for(;this.buf[this.pos++]>127;);else if(re===n.Bytes)this.pos=this.readVarint()+this.pos;else if(re===n.Fixed32)this.pos+=4;else{if(re!==n.Fixed64)throw new Error("Unimplemented type: "+re);this.pos+=8}},writeTag:function(Z,re){this.writeVarint(Z<<3|re)},realloc:function(Z){for(var re=this.length||16;re<this.pos+Z;)re*=2;if(re!==this.length){var ae=new Uint8Array(re);ae.set(this.buf),this.buf=ae,this.length=re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Z){this.realloc(4),Y(this.buf,Z,this.pos),this.pos+=4},writeSFixed32:function(Z){this.realloc(4),Y(this.buf,Z,this.pos),this.pos+=4},writeFixed64:function(Z){this.realloc(8),Y(this.buf,-1&Z,this.pos),Y(this.buf,Math.floor(Z*u),this.pos+4),this.pos+=8},writeSFixed64:function(Z){this.realloc(8),Y(this.buf,-1&Z,this.pos),Y(this.buf,Math.floor(Z*u),this.pos+4),this.pos+=8},writeVarint:function(Z){(Z=+Z||0)>268435455||Z<0?function(re,ae){var ue,Ce;if(re>=0?(ue=re%4294967296|0,Ce=re/4294967296|0):(Ce=~(-re/4294967296),4294967295^(ue=~(-re%4294967296))?ue=ue+1|0:(ue=0,Ce=Ce+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ae.realloc(10),function(we,Se,He){He.buf[He.pos++]=127&we|128,we>>>=7,He.buf[He.pos++]=127&we|128,we>>>=7,He.buf[He.pos++]=127&we|128,we>>>=7,He.buf[He.pos++]=127&we|128,He.buf[He.pos]=127&(we>>>=7)}(ue,0,ae),function(we,Se){var He=(7&we)<<4;Se.buf[Se.pos++]|=He|((we>>>=3)?128:0),we&&(Se.buf[Se.pos++]=127&we|((we>>>=7)?128:0),we&&(Se.buf[Se.pos++]=127&we|((we>>>=7)?128:0),we&&(Se.buf[Se.pos++]=127&we|((we>>>=7)?128:0),we&&(Se.buf[Se.pos++]=127&we|((we>>>=7)?128:0),we&&(Se.buf[Se.pos++]=127&we)))))}(Ce,ae)}(Z,this):(this.realloc(4),this.buf[this.pos++]=127&Z|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=127&(Z>>>=7)|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=127&(Z>>>=7)|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=Z>>>7&127))))},writeSVarint:function(Z){this.writeVarint(Z<0?2*-Z-1:2*Z)},writeBoolean:function(Z){this.writeVarint(!!Z)},writeString:function(Z){Z=String(Z),this.realloc(4*Z.length),this.pos++;var re=this.pos;this.pos=function(ue,Ce,we){for(var Se,He,Pe=0;Pe<Ce.length;Pe++){if((Se=Ce.charCodeAt(Pe))>55295&&Se<57344){if(!He){Se>56319||Pe+1===Ce.length?(ue[we++]=239,ue[we++]=191,ue[we++]=189):He=Se;continue}if(Se<56320){ue[we++]=239,ue[we++]=191,ue[we++]=189,He=Se;continue}Se=He-55296<<10|Se-56320|65536,He=null}else He&&(ue[we++]=239,ue[we++]=191,ue[we++]=189,He=null);Se<128?ue[we++]=Se:(Se<2048?ue[we++]=Se>>6|192:(Se<65536?ue[we++]=Se>>12|224:(ue[we++]=Se>>18|240,ue[we++]=Se>>12&63|128),ue[we++]=Se>>6&63|128),ue[we++]=63&Se|128)}return we}(this.buf,Z,this.pos);var ae=this.pos-re;ae>=128&&w(re,ae,this),this.pos=re-1,this.writeVarint(ae),this.pos+=ae},writeFloat:function(Z){this.realloc(4),c.write(this.buf,Z,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Z){this.realloc(8),c.write(this.buf,Z,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Z){var re=Z.length;this.writeVarint(re),this.realloc(re);for(var ae=0;ae<re;ae++)this.buf[this.pos++]=Z[ae]},writeRawMessage:function(Z,re){this.pos++;var ae=this.pos;Z(re,this);var ue=this.pos-ae;ue>=128&&w(ae,ue,this),this.pos=ae-1,this.writeVarint(ue),this.pos+=ue},writeMessage:function(Z,re,ae){this.writeTag(Z,n.Bytes),this.writeRawMessage(re,ae)},writePackedVarint:function(Z,re){re.length&&this.writeMessage(Z,T,re)},writePackedSVarint:function(Z,re){re.length&&this.writeMessage(Z,P,re)},writePackedBoolean:function(Z,re){re.length&&this.writeMessage(Z,I,re)},writePackedFloat:function(Z,re){re.length&&this.writeMessage(Z,x,re)},writePackedDouble:function(Z,re){re.length&&this.writeMessage(Z,A,re)},writePackedFixed32:function(Z,re){re.length&&this.writeMessage(Z,C,re)},writePackedSFixed32:function(Z,re){re.length&&this.writeMessage(Z,M,re)},writePackedFixed64:function(Z,re){re.length&&this.writeMessage(Z,R,re)},writePackedSFixed64:function(Z,re){re.length&&this.writeMessage(Z,j,re)},writeBytesField:function(Z,re){this.writeTag(Z,n.Bytes),this.writeBytes(re)},writeFixed32Field:function(Z,re){this.writeTag(Z,n.Fixed32),this.writeFixed32(re)},writeSFixed32Field:function(Z,re){this.writeTag(Z,n.Fixed32),this.writeSFixed32(re)},writeFixed64Field:function(Z,re){this.writeTag(Z,n.Fixed64),this.writeFixed64(re)},writeSFixed64Field:function(Z,re){this.writeTag(Z,n.Fixed64),this.writeSFixed64(re)},writeVarintField:function(Z,re){this.writeTag(Z,n.Varint),this.writeVarint(re)},writeSVarintField:function(Z,re){this.writeTag(Z,n.Varint),this.writeSVarint(re)},writeStringField:function(Z,re){this.writeTag(Z,n.Bytes),this.writeString(re)},writeFloatField:function(Z,re){this.writeTag(Z,n.Fixed32),this.writeFloat(re)},writeDoubleField:function(Z,re){this.writeTag(Z,n.Fixed64),this.writeDouble(re)},writeBooleanField:function(Z,re){this.writeVarintField(Z,!!re)}},c2}var h1=E(PC());const h2=3;function cj(c,n,o){n.glyphs=[],c===1&&o.readMessage(uj,n)}function uj(c,n,o){if(c===3){const{id:u,bitmap:f,width:h,height:_,left:w,top:T,advance:P}=o.readMessage(hj,{});n.glyphs.push({id:u,bitmap:new Nf({width:h+2*h2,height:_+2*h2},f),metrics:{width:h,height:_,left:w,top:T,advance:P}})}else c===4?n.ascender=o.readSVarint():c===5&&(n.descender=o.readSVarint())}function hj(c,n,o){c===1?n.id=o.readVarint():c===2?n.bitmap=o.readBytes():c===3?n.width=o.readVarint():c===4?n.height=o.readVarint():c===5?n.left=o.readSVarint():c===6?n.top=o.readSVarint():c===7&&(n.advance=o.readVarint())}const MC=h2,Nl={horizontal:1,vertical:2,horizontalOnly:3};class V0{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(n,o){const u=new V0;return u.scale=n||1,u.fontStack=o,u}static forImage(n){const o=new V0;return o.image=n,o}}class kg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o,u){const f=new kg;for(let h=0;h<n.sections.length;h++){const _=n.sections[h];_.image?f.addImageSection(_,u):f.addTextSection(_,o)}return f}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(o,u){let f="";for(let h=0;h<o.length;h++){const _=o.charCodeAt(h+1)||null,w=o.charCodeAt(h-1)||null;f+=!u&&(_&&Tn(_)&&!U0[o[h+1]]||w&&Tn(w)&&!U0[o[h-1]])||!U0[o[h]]?o[h]:U0[o[h]]}return f}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&d1[this.text.charCodeAt(u)];u++)n++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&d1[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const u=new kg;return u.text=this.text.substring(n,o),u.sectionIndex=this.sectionIndex.slice(n,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(V0.forText(n.scale,n.fontStack||o));const u=this.sections.length-1;for(let f=0;f<n.text.length;++f)this.sectionIndex.push(u)}addImageSection(n,o){const u=n.image?n.image.getPrimary():null;if(!u)return void pi("Can't add FormattedSection with an empty image.");u.scaleSelf(o);const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCodePoint(f),this.sections.push(V0.forImage(u)),this.sectionIndex.push(this.sections.length-1)):pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function d2(c,n,o,u,f,h,_,w,T,P,x,A,I,C,M,R=1){const j=kg.fromFeature(c,f,R);A===Nl.vertical&&j.verticalizePunctuation(I);let $=[];const Y=function(ue,Ce,we,Se,He,Pe){if(!ue)return[];const We=[],st=function(bt,gt,At,en,Jt,An){let on=0;for(let hn=0;hn<bt.length();hn++){const rn=bt.getSection(hn);on+=IC(bt.getCodePoint(hn),rn,en,Jt,gt,An)}return on/Math.max(1,Math.ceil(on/At))}(ue,Ce,we,Se,He,Pe),tt=ue.text.indexOf("​")>=0;let ft=0;for(let bt=0;bt<ue.length();bt++){const gt=ue.getSection(bt),At=ue.getCodePoint(bt);if(d1[At]||(ft+=IC(At,gt,Se,He,Ce,Pe)),bt<ue.length()-1){const en=!((ht=At)<11904||!(Pt["Bopomofo Extended"](ht)||Pt.Bopomofo(ht)||Pt["CJK Compatibility Forms"](ht)||Pt["CJK Compatibility Ideographs"](ht)||Pt["CJK Compatibility"](ht)||Pt["CJK Radicals Supplement"](ht)||Pt["CJK Strokes"](ht)||Pt["CJK Symbols and Punctuation"](ht)||Pt["CJK Unified Ideographs Extension A"](ht)||Pt["CJK Unified Ideographs"](ht)||Pt["Enclosed CJK Letters and Months"](ht)||Pt["Halfwidth and Fullwidth Forms"](ht)||Pt.Hiragana(ht)||Pt["Ideographic Description Characters"](ht)||Pt["Kangxi Radicals"](ht)||Pt["Katakana Phonetic Extensions"](ht)||Pt.Katakana(ht)||Pt["Vertical Forms"](ht)||Pt["Yi Radicals"](ht)||Pt["Yi Syllables"](ht)));(dj[At]||en||gt.image)&&We.push(kC(bt+1,ft,st,We,fj(At,ue.getCodePoint(bt+1),en&&tt),!1))}}var ht;return RC(kC(ue.length(),ft,st,We,0,!0))}(j,P,h,n,u,C),{processBidirectionalText:X,processStyledBidirectionalText:Z}=ci;if(X&&j.sections.length===1){const ue=X(j.toString(),Y);for(const Ce of ue){const we=new kg;we.text=Ce,we.sections=j.sections;for(let Se=0;Se<Ce.length;Se++)we.sectionIndex.push(0);$.push(we)}}else if(Z){const ue=Z(j.text,j.sectionIndex,Y);for(const Ce of ue){const we=new kg;we.text=Ce[0],we.sectionIndex=Ce[1],we.sections=j.sections,$.push(we)}}else $=function(ue,Ce){const we=[],Se=ue.text;let He=0;for(const Pe of Ce)we.push(ue.substring(He,Pe)),He=Pe;return He<Se.length&&we.push(ue.substring(He,Se.length)),we}(j,Y);const re=[],ae={positionedLines:re,text:j.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ue,Ce,we,Se,He,Pe,We,st,tt,ft,ht,bt){let gt=0,At=0,en=0;const Jt=st==="right"?1:st==="left"?0:.5;let An=!1;for(const kn of He){const Qn=kn.getSections();for(const gr of Qn){if(gr.image)continue;const sr=Ce[gr.fontStack];if(sr&&(An=sr.ascender!==void 0&&sr.descender!==void 0,!An))break}if(!An)break}let on=0;for(const kn of He){kn.trim();const Qn=kn.getMaxScale(),gr=(Qn-1)*$o,sr={positionedGlyphs:[],lineOffset:0};ue.positionedLines[on]=sr;const Sr=sr.positionedGlyphs;let fr=0;if(!kn.length()){At+=Pe,++on;continue}let Er=0,Jr=0;for(let tr=0;tr<kn.length();tr++){const kr=kn.getSection(tr),Fi=kn.getSectionIndex(tr),Ki=kn.getCodePoint(tr);let ts=kr.scale,is=null,bi=null,ao=null,Da=$o,Is=0;tt===Nl.vertical&&((hn=Ki)===12312||hn===12313||hn===12316||hn===12540||hn===12448)&&(tt=Nl.horizontal);const Bs=!(tt===Nl.horizontal||!ht&&!Pn(Ki)||ht&&(d1[Ki]||rr(Ki)));if(kr.image){const sa=Se.get(kr.image.toString());if(!sa)continue;ao=kr.image,ue.iconsInText=ue.iconsInText||!0,bi=sa.paddedRect;const Io=sa.displaySize;ts=ts*$o/bt,is={width:Io[0],height:Io[1],left:0,top:-MC,advance:Bs?Io[1]:Io[0],localGlyph:!1},Is=An?-is.height*ts:Qn*$o-17-Io[1]*ts,Da=is.advance;const Nc=(Bs?Io[0]:Io[1])*ts-$o*Qn;Nc>0&&Nc>fr&&(fr=Nc)}else{const sa=we[kr.fontStack];if(!sa)continue;sa[Ki]&&(bi=sa[Ki]);const Io=Ce[kr.fontStack];if(!Io)continue;const Nc=Io.glyphs[Ki];if(!Nc)continue;if(is=Nc.metrics,Da=Ki!==8203?$o:0,An){const qf=Io.ascender!==void 0?Math.abs(Io.ascender):0,fu=Io.descender!==void 0?Math.abs(Io.descender):0,Ju=(qf+fu)*ts;Er<Ju&&(Er=Ju,Jr=(qf-fu)/2*ts),Is=-qf*ts}else Is=(Qn-ts)*$o-17}Bs?(ue.verticalizable=!0,Sr.push({glyph:Ki,image:ao,x:gt,y:At+Is,vertical:Bs,scale:ts,localGlyph:is.localGlyph,fontStack:kr.fontStack,sectionIndex:Fi,metrics:is,rect:bi}),gt+=Da*ts+ft):(Sr.push({glyph:Ki,image:ao,x:gt,y:At+Is,vertical:Bs,scale:ts,localGlyph:is.localGlyph,fontStack:kr.fontStack,sectionIndex:Fi,metrics:is,rect:bi}),gt+=is.advance*ts+ft)}Sr.length!==0&&(en=Math.max(gt-ft,en),An?DC(Sr,Jt,fr,Jr,Pe*Qn/2):DC(Sr,Jt,fr,0,Pe/2)),gt=0;const Ei=Pe*Qn+fr;sr.lineOffset=Math.max(fr,gr),At+=Ei,++on}var hn;const rn=At,{horizontalAlign:jn,verticalAlign:Sn}=f2(We);(function(kn,Qn,gr,sr,Sr,fr){const Er=(Qn-gr)*Sr,Jr=-fr*sr;for(const Ei of kn)for(const tr of Ei.positionedGlyphs)tr.x+=Er,tr.y+=Jr})(ue.positionedLines,Jt,jn,Sn,en,rn),ue.top+=-Sn*rn,ue.bottom=ue.top+rn,ue.left+=-jn*en,ue.right=ue.left+en,ue.hasBaseline=An}(ae,n,o,u,$,_,w,T,A,P,I,M),!function(ue){for(const Ce of ue)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(re))return ae}const d1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dj={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function IC(c,n,o,u,f,h){if(n.image){const _=u.get(n.image.toString());return _?_.displaySize[0]*n.scale*$o/h+f:0}{const _=o[n.fontStack],w=_&&_.glyphs[c];return w?w.metrics.advance*n.scale+f:0}}function LC(c,n,o,u){const f=Math.pow(c-n,2);return u?c<n?f/2:2*f:f+Math.abs(o)*o}function fj(c,n,o){let u=0;return c===10&&(u-=1e4),o&&(u+=150),c!==40&&c!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function kC(c,n,o,u,f,h){let _=null,w=LC(n,o,f,h);for(const T of u){const P=LC(n-T.x,o,f,h)+T.badness;P<=w&&(_=T,w=P)}return{index:c,x:n,priorBreak:_,badness:w}}function RC(c){return c?RC(c.priorBreak).concat(c.index):[]}function f2(c){let n=.5,o=.5;switch(c){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function DC(c,n,o,u,f){if(!(n||o||u||f))return;const h=c.length-1,_=c[h],w=(_.x+_.metrics.advance*_.scale)*n;for(let T=0;T<=h;T++)c[T].x-=w,c[T].y+=o+u+f}function pj(c,n,o,u){const{horizontalAlign:f,verticalAlign:h}=f2(u),_=o[0]-c.displaySize[0]*f,w=o[1]-c.displaySize[1]*h;return{imagePrimary:c,imageSecondary:n,top:w,bottom:w+c.displaySize[1],left:_,right:_+c.displaySize[0]}}function NC(c,n,o,u,f,h){const _=c.imagePrimary;let w;if(_.content){const j=_.content,$=_.pixelRatio||1;w=[j[0]/$,j[1]/$,_.displaySize[0]-j[2]/$,_.displaySize[1]-j[3]/$]}const T=n.left*h,P=n.right*h;let x,A,I,C;o==="width"||o==="both"?(C=f[0]+T-u[3],A=f[0]+P+u[1]):(C=f[0]+(T+P-_.displaySize[0])/2,A=C+_.displaySize[0]);const M=n.top*h,R=n.bottom*h;return o==="height"||o==="both"?(x=f[1]+M-u[0],I=f[1]+R+u[2]):(x=f[1]+(M+R-_.displaySize[1])/2,I=x+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:x,right:A,bottom:I,left:C,collisionPadding:w}}class $d extends $t{constructor(n,o,u,f,h){super(n,o),this.angle=f,this.z=u,h!==void 0&&(this.segment=h)}clone(){return new $d(this.x,this.y,this.z,this.angle,this.segment)}}function OC(c,n,o,u,f){if(n.segment===void 0)return!0;let h=n,_=n.segment+1,w=0;for(;w>-o/2;){if(_--,_<0)return!1;w-=c[_].dist(h),h=c[_]}w+=c[_].dist(c[_+1]),_++;const T=[];let P=0;for(;w<o/2;){const x=c[_],A=c[_+1];if(!A)return!1;let I=c[_-1].angleTo(x)-x.angleTo(A);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:I}),P+=I;w-T[0].distance>u;)P-=T.shift().angleDelta;if(P>f)return!1;_++,w+=x.dist(A)}return!0}function zC(c){let n=0;for(let o=0;o<c.length-1;o++)n+=c[o].dist(c[o+1]);return n}function FC(c,n,o){return c?.6*n*o:0}function BC(c,n){return Math.max(c?c.right-c.left:0,n?n.right-n.left:0)}function mj(c,n,o,u,f,h){const _=FC(o,f,h),w=BC(o,u)*h;let T=0;const P=zC(c)/2;for(let x=0;x<c.length-1;x++){const A=c[x],I=c[x+1],C=A.dist(I);if(T+C>P){const M=(P-T)/C,R=Bn(A.x,I.x,M),j=Bn(A.y,I.y,M),$=new $d(R,j,0,I.angleTo(A),x);return!_||OC(c,$,w,_,n)?$:void 0}T+=C}}function gj(c,n,o,u,f,h,_,w,T){const P=FC(u,h,_),x=BC(u,f),A=x*_,I=c[0].x===0||c[0].x===T||c[0].y===0||c[0].y===T;return n-A<n/4&&(n=A+n/4),jC(c,I?n/2*w%n:(x/2+2*h)*_*w%n,n,P,o,A,I,!1,T)}function jC(c,n,o,u,f,h,_,w,T){const P=h/2,x=zC(c);let A=0,I=n-o,C=[];for(let M=0;M<c.length-1;M++){const R=c[M],j=c[M+1],$=R.dist(j),Y=j.angleTo(R);for(;I+o<A+$;){I+=o;const X=(I-A)/$,Z=Bn(R.x,j.x,X),re=Bn(R.y,j.y,X);if(Z>=0&&Z<T&&re>=0&&re<T&&I-P>=0&&I+P<=x){const ae=new $d(Z,re,0,Y,M);u&&!OC(c,ae,h,u,f)||C.push(ae)}}A+=$}return w||C.length||_||(C=jC(c,A/2,o,u,f,h,_,!0,T)),C}function UC(c,n,o,u,f){const h=[];for(let _=0;_<c.length;_++){const w=c[_];let T;for(let P=0;P<w.length-1;P++){let x=w[P],A=w[P+1];x.x<n&&A.x<n||(x.x<n?x=new $t(n,x.y+(n-x.x)/(A.x-x.x)*(A.y-x.y))._round():A.x<n&&(A=new $t(n,x.y+(n-x.x)/(A.x-x.x)*(A.y-x.y))._round()),x.y<o&&A.y<o||(x.y<o?x=new $t(x.x+(o-x.y)/(A.y-x.y)*(A.x-x.x),o)._round():A.y<o&&(A=new $t(x.x+(o-x.y)/(A.y-x.y)*(A.x-x.x),o)._round()),x.x>=u&&A.x>=u||(x.x>=u?x=new $t(u,x.y+(u-x.x)/(A.x-x.x)*(A.y-x.y))._round():A.x>=u&&(A=new $t(u,x.y+(u-x.x)/(A.x-x.x)*(A.y-x.y))._round()),x.y>=f&&A.y>=f||(x.y>=f?x=new $t(x.x+(f-x.y)/(A.y-x.y)*(A.x-x.x),f)._round():A.y>=f&&(A=new $t(x.x+(f-x.y)/(A.y-x.y)*(A.x-x.x),f)._round()),T&&x.equals(T[T.length-1])||(T=[x],h.push(T)),T.push(A)))))}}return h}function VC(c){let n=0,o=0;for(const _ of c)n+=_.w*_.h,o=Math.max(o,_.w);c.sort((_,w)=>w.h-_.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let f=0,h=0;for(const _ of c)for(let w=u.length-1;w>=0;w--){const T=u[w];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,h=Math.max(h,_.y+_.h),f=Math.max(f,_.x+_.w),_.w===T.w&&_.h===T.h){const P=u.pop();w<u.length&&(u[w]=P)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(u.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:f,h,fill:n/(f*h)||0}}Ze($d,"Anchor");const Rg=1;class q0{static getImagePositionScale(n,o,u){if(o&&n&&n.options&&n.options.transform){const f=n.options.transform;return{x:f.a,y:f.d}}return{x:u,y:u}}constructor(n,o,u,f){this.paddedRect=n;const{pixelRatio:h,version:_,stretchX:w,stretchY:T,content:P,sdf:x,usvg:A}=o;this.pixelRatio=h,this.stretchX=w,this.stretchY=T,this.content=P,this.version=_,this.padding=u,this.sdf=x,this.scale=q0.getImagePositionScale(f,A,h)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function qC(c,n,o){const u=Ua.parse(c),f=function(h,_,w=[1,1]){return{x:0,y:0,w:(h.data?h.data.width:h.width*w[0])+2*_,h:(h.data?h.data.height:h.height*w[1])+2*_}}(n,o,[u.options.transform.a,u.options.transform.d]);return{bin:f,imagePosition:new q0(f,n,o,u),imageVariant:u}}class $C{constructor(n,o,u){const f=new Map,h=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(n,f,Rg,_),this.addImages(o,h,2,_);const{w,h:T}=VC(_),P=new qo({width:w||1,height:T||1});for(const[x,A]of n.entries()){const I=f.get(x).paddedRect;qo.copy(A.data,P,{x:0,y:0},{x:I.x+Rg,y:I.y+Rg},A.data,u,A.sdf)}for(const[x,A]of o.entries()){const I=h.get(x),C=I.paddedRect;let M=I.padding;const R=C.x+M,j=C.y+M,$=A.data.width,Y=A.data.height;M=M>1?M-1:M,qo.copy(A.data,P,{x:0,y:0},{x:R,y:j},A.data,u),qo.copy(A.data,P,{x:0,y:Y-M},{x:R,y:j-M},{width:$,height:M},u),qo.copy(A.data,P,{x:0,y:0},{x:R,y:j+Y},{width:$,height:M},u),qo.copy(A.data,P,{x:$-M,y:0},{x:R-M,y:j},{width:M,height:Y},u),qo.copy(A.data,P,{x:0,y:0},{x:R+$,y:j},{width:M,height:Y},u),qo.copy(A.data,P,{x:$-M,y:Y-M},{x:R-M,y:j-M},{width:M,height:M},u),qo.copy(A.data,P,{x:0,y:Y-M},{x:R+$,y:j-M},{width:M,height:M},u),qo.copy(A.data,P,{x:0,y:0},{x:R+$,y:j+Y},{width:M,height:M},u),qo.copy(A.data,P,{x:$-M,y:0},{x:R-M,y:j+Y},{width:M,height:M},u)}this.lut=u,this.image=P,this.iconPositions=f,this.patternPositions=h}addImages(n,o,u,f){for(const[h,_]of n.entries()){const{bin:w,imagePosition:T,imageVariant:P}=qC(h,_,u);o.set(h,T),f.push(w),_.hasRenderCallback&&this.haveRenderCallbacks.push(P.id)}}patchUpdatedImages(n,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>n.hasImage(f,u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const f of n.getUpdatedImages(u)){for(const h of this.iconPositions.keys()){const _=Ua.parse(h);if(wo.isEqual(_.id,f)){const w=n.getImage(f,u);this.patchUpdatedImage(this.iconPositions.get(h),w,o)}}for(const h of this.patternPositions.keys()){const _=Ua.parse(h);if(wo.isEqual(_.id,f)){const w=n.getImage(f,u);this.patchUpdatedImage(this.patternPositions.get(h),w,o)}}}}patchUpdatedImage(n,o,u){if(!n||!o||n.version===o.version)return;n.version=o.version;const[f,h]=n.tl,_=n.sdf;if(this.lut||_){const w={width:o.data.width,height:o.data.height},T=new qo(w);qo.copy(o.data,T,{x:0,y:0},{x:0,y:0},w,this.lut,_),u.update(T,{position:{x:f,y:h}})}else u.update(o.data,{position:{x:f,y:h}})}}Ze(q0,"ImagePosition"),Ze($C,"ImageAtlas");const $0=1e20;function GC(c,n,o,u,f,h,_,w,T){for(let P=n;P<n+u;P++)HC(c,o*h+P,h,f,_,w,T);for(let P=o;P<o+f;P++)HC(c,P*h+n,1,u,_,w,T)}function HC(c,n,o,u,f,h,_){h[0]=0,_[0]=-$0,_[1]=$0,f[0]=c[n];for(let w=1,T=0,P=0;w<u;w++){f[w]=c[n+w*o];const x=w*w;do{const A=h[T];P=(f[w]-f[A]+x-A*A)/(w-A)/2}while(P<=_[T]&&--T>-1);T++,h[T]=w,_[T]=P,_[T+1]=$0}for(let w=0,T=0;w<u;w++){for(;_[T+1]<w;)T++;const P=h[T],x=w-P;c[n+w*o]=f[P]+x*x}}const Zu=2,p2={none:0,ideographs:1,all:2};class Dg{constructor(n,o,u){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,o){this.urls[o]=n}getGlyphs(n,o,u){const f=[],h=this.urls[o]||he.GLYPHS_URL;for(const _ in n)for(const w of n[_])f.push({stack:_,id:w});hi(f,({stack:_,id:w},T)=>{let P=this.entries[_];P||(P=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=P.glyphs[w];if(x!==void 0)return void T(null,{stack:_,id:w,glyph:x});if(x=this._tinySDF(P,_,w),x)return P.glyphs[w]=x,void T(null,{stack:_,id:w,glyph:x});const A=Math.floor(w/256);if(256*A>65535)return pi("glyphs > 65535 not supported"),void T(null,{stack:_,id:w,glyph:x});if(P.ranges[A])return void T(null,{stack:_,id:w,glyph:x});let I=P.requests[A];I||(I=P.requests[A]=[],Dg.loadGlyphRange(_,A,h,this.requestManager,(C,M)=>{if(M){P.ascender=M.ascender,P.descender=M.descender;for(const R in M.glyphs)this._doesCharSupportLocalGlyph(+R)||(P.glyphs[+R]=M.glyphs[+R]);P.ranges[A]=!0}for(const R of I)R(C,M);delete P.requests[A]})),I.push((C,M)=>{C?T(C):M&&T(null,{stack:_,id:w,glyph:M.glyphs[w]||null})})},(_,w)=>{if(_)u(_);else if(w){const T={};for(const{stack:P,id:x,glyph:A}of w)T[P]===void 0&&(T[P]={}),T[P].glyphs===void 0&&(T[P].glyphs={}),T[P].glyphs[x]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},T[P].ascender=this.entries[P].ascender,T[P].descender=this.entries[P].descender;u(null,T)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==p2.none&&(this.localGlyphMode===p2.all?!!this.localFontFamily:!!this.localFontFamily&&(Pt["CJK Unified Ideographs"](n)||Pt["Hangul Syllables"](n)||Pt.Hiragana(n)||Pt.Katakana(n)||Pt["CJK Symbols and Punctuation"](n)||Pt["CJK Unified Ideographs Extension A"](n)||Pt["CJK Unified Ideographs Extension B"](n)||Pt.Osage(n)))}_tinySDF(n,o,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let h=n.tinySDF;if(!h){let R="400";/bold/i.test(o)?R="900":/medium/i.test(o)?R="500":/light/i.test(o)&&(R="200"),h=n.tinySDF=new Dg.TinySDF({fontFamily:f,fontWeight:R,fontSize:24*Zu,buffer:3*Zu,radius:8*Zu}),h.fontWeight=R}if(this.localGlyphs[h.fontWeight][u])return this.localGlyphs[h.fontWeight][u];const _=String.fromCodePoint(u),{data:w,width:T,height:P,glyphWidth:x,glyphHeight:A,glyphLeft:I,glyphTop:C,glyphAdvance:M}=h.draw(_);return this.localGlyphs[h.fontWeight][u]={id:u,bitmap:new Nf({width:T,height:P},w),metrics:{width:x/Zu,height:A/Zu,left:I/Zu,top:C/Zu-27,advance:M/Zu,localGlyph:!0}}}}Dg.loadGlyphRange=function(c,n,o,u,f){const h=256*n,_=h+255,w=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",c).replace("{range}",`${h}-${_}`),gs.Glyphs);Wi(w,(T,P)=>{if(T)f(T);else if(P){const x={},A=function(I){return new h1(I).readFields(cj,{})}(P);for(const I of A.glyphs)x[I.id]=I;f(null,{glyphs:x,ascender:A.ascender,descender:A.descender})}})},Dg.TinySDF=class{constructor({fontSize:c=24,buffer:n=3,radius:o=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:h="normal",fontStyle:_="normal"}={}){this.buffer=n,this.cutoff=u,this.radius=o;const w=this.size=c+4*n,T=this._createCanvas(w),P=this.ctx=T.getContext("2d",{willReadFrequently:!0});P.font=`${_} ${h} ${c}px ${f}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(c){const n=document.createElement("canvas");return n.width=n.height=c,n}draw(c){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:h}=this.ctx.measureText(c),_=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-f))),T=Math.min(this.size-this.buffer,_+Math.ceil(u)),P=w+2*this.buffer,x=T+2*this.buffer,A=Math.max(P*x,0),I=new Uint8ClampedArray(A),C={data:I,width:P,height:x,glyphWidth:w,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:n};if(w===0||T===0)return C;const{ctx:M,buffer:R,gridInner:j,gridOuter:$}=this;M.clearRect(R,R,w,T),M.fillText(c,R,R+_);const Y=M.getImageData(R,R,w,T);$.fill($0,0,A),j.fill(0,0,A);for(let X=0;X<T;X++)for(let Z=0;Z<w;Z++){const re=Y.data[4*(X*w+Z)+3]/255;if(re===0)continue;const ae=(X+R)*P+Z+R;if(re===1)$[ae]=0,j[ae]=$0;else{const ue=.5-re;$[ae]=ue>0?ue*ue:0,j[ae]=ue<0?ue*ue:0}}GC($,0,0,P,x,P,this.f,this.v,this.z),GC(j,R,R,w,T,P,this.f,this.v,this.z);for(let X=0;X<A;X++){const Z=Math.sqrt($[X])-Math.sqrt(j[X]);I[X]=Math.round(255-255*(Z/this.radius+this.cutoff))}return C}};const Ff=Rg;function WC(c,n){return c+n[1]-n[0]}function ZC(c,n,o,u,f=1){const h=[],_=c.imagePrimary,w=_.pixelRatio,T=_.paddedRect.w-2*Ff,P=_.paddedRect.h-2*Ff,x=(c.right-c.left)*f,A=(c.bottom-c.top)*f,I=_.stretchX||[[0,T]],C=_.stretchY||[[0,P]],M=I.reduce(WC,0),R=C.reduce(WC,0),j=T-M,$=P-R;let Y=0,X=M,Z=0,re=R,ae=0,ue=j,Ce=0,we=$;if(_.content&&u){const He=_.content;Y=f1(I,0,He[0]),Z=f1(C,0,He[1]),X=f1(I,He[0],He[2]),re=f1(C,He[1],He[3]),ae=He[0]-Y,Ce=He[1]-Z,ue=He[2]-He[0]-X,we=He[3]-He[1]-re}const Se=(He,Pe,We,st)=>{const tt=p1(He.stretch-Y,X,x,c.left*f),ft=m1(He.fixed-ae,ue,He.stretch,M),ht=p1(Pe.stretch-Z,re,A,c.top*f),bt=m1(Pe.fixed-Ce,we,Pe.stretch,R),gt=p1(We.stretch-Y,X,x,c.left*f),At=m1(We.fixed-ae,ue,We.stretch,M),en=p1(st.stretch-Z,re,A,c.top*f),Jt=m1(st.fixed-Ce,we,st.stretch,R),An=new $t(tt,ht),on=new $t(gt,ht),hn=new $t(gt,en),rn=new $t(tt,en),jn=new $t(ft/w,bt/w),Sn=new $t(At/w,Jt/w),kn=n*Math.PI/180;if(kn){const Er=Math.sin(kn),Jr=Math.cos(kn),Ei=[Jr,-Er,Er,Jr];An._matMult(Ei),on._matMult(Ei),rn._matMult(Ei),hn._matMult(Ei)}const Qn=He.stretch+He.fixed,gr=We.stretch+We.fixed,sr=Pe.stretch+Pe.fixed,Sr=st.stretch+st.fixed,fr=c.imageSecondary;return{tl:An,tr:on,bl:rn,br:hn,texPrimary:{x:_.paddedRect.x+Ff+Qn,y:_.paddedRect.y+Ff+sr,w:gr-Qn,h:Sr-sr},texSecondary:fr?{x:fr.paddedRect.x+Ff+Qn,y:fr.paddedRect.y+Ff+sr,w:gr-Qn,h:Sr-sr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jn,pixelOffsetBR:Sn,minFontScaleX:ue/w/x,minFontScaleY:we/w/A,isSDF:o}};if(u&&(_.stretchX||_.stretchY)){const He=KC(I,j,M),Pe=KC(C,$,R);for(let We=0;We<He.length-1;We++){const st=He[We],tt=He[We+1];for(let ft=0;ft<Pe.length-1;ft++)h.push(Se(st,Pe[ft],tt,Pe[ft+1]))}}else h.push(Se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:P+1}));return h}function f1(c,n,o){let u=0;for(const f of c)u+=Math.max(n,Math.min(o,f[1]))-Math.max(n,Math.min(o,f[0]));return u}function KC(c,n,o){const u=[{fixed:-Ff,stretch:0}];for(const[f,h]of c){const _=u[u.length-1];u.push({fixed:f-_.stretch,stretch:_.stretch}),u.push({fixed:f-_.stretch,stretch:_.stretch+(h-f)})}return u.push({fixed:n+Ff,stretch:o}),u}function p1(c,n,o,u){return c/n*o+u}function m1(c,n,o,u){return c-n*o/u}function _j(c,n,o,u){const f=n+c.positionedLines[u].lineOffset;return u===0?o+f/2:o+(f+(n+c.positionedLines[u-1].lineOffset))/2}function yj(c,n=1,o=!1){let u=1/0,f=1/0,h=-1/0,_=-1/0;const w=c[0];for(let C=0;C<w.length;C++){const M=w[C];(!C||M.x<u)&&(u=M.x),(!C||M.y<f)&&(f=M.y),(!C||M.x>h)&&(h=M.x),(!C||M.y>_)&&(_=M.y)}const T=Math.min(h-u,_-f);let P=T/2;const x=new Xl([],vj);if(T===0)return new $t(u,f);for(let C=u;C<h;C+=T)for(let M=f;M<_;M+=T)x.push(new Ng(C+P,M+P,P,c));let A=function(C){let M=0,R=0,j=0;const $=C[0];for(let Y=0,X=$.length,Z=X-1;Y<X;Z=Y++){const re=$[Y],ae=$[Z],ue=re.x*ae.y-ae.x*re.y;R+=(re.x+ae.x)*ue,j+=(re.y+ae.y)*ue,M+=3*ue}return new Ng(R/M,j/M,0,C)}(c),I=x.length;for(;x.length;){const C=x.pop();(C.d>A.d||!A.d)&&(A=C,o&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,I)),C.max-A.d<=n||(P=C.h/2,x.push(new Ng(C.p.x-P,C.p.y-P,P,c)),x.push(new Ng(C.p.x+P,C.p.y-P,P,c)),x.push(new Ng(C.p.x-P,C.p.y+P,P,c)),x.push(new Ng(C.p.x+P,C.p.y+P,P,c)),I+=4)}return o&&(console.log(`num probes: ${I}`),console.log(`best distance: ${A.d}`)),A.p}function vj(c,n){return n.max-c.max}class Ng{constructor(n,o,u,f){this.p=new $t(n,o),this.h=u,this.d=function(h,_){let w=!1,T=1/0;for(let P=0;P<_.length;P++){const x=_[P];for(let A=0,I=x.length,C=I-1;A<I;C=A++){const M=x[A],R=x[C];M.y>h.y!=R.y>h.y&&h.x<(R.x-M.x)*(h.y-M.y)/(R.y-M.y)+M.x&&(w=!w),T=Math.min(T,Ge(h,M,R))}}return(w?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const m2=Number.POSITIVE_INFINITY,xj=Math.sqrt(2);function XC(c,[n,o]){let u=0,f=0;if(o===m2){n<0&&(n=0);const h=n/xj;switch(c){case"top-right":case"top-left":f=h-7;break;case"bottom-right":case"bottom-left":f=7-h;break;case"bottom":f=7-n;break;case"top":f=n-7}switch(c){case"top-right":case"bottom-right":u=-h;break;case"top-left":case"bottom-left":u=h;break;case"left":u=n;break;case"right":u=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),c){case"top-right":case"top-left":case"top":f=o-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-o}switch(c){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}}return[u,f]}function YC(c,n,o,u,f,h,_,w){if(!c)return;const T=AC(n,o,u,f,h);return c.scaleSelf(T*w*_)}function JC(c,n,o,u,f,h,_,w){return{iconPrimary:YC(c.getPrimary(),n,o,u,f,h,_,w),iconSecondary:YC(c.getSecondary(),n,o,u,f,h,_,w)}}function QC(c,n,o,u){if(!c)return;const f=n.get(o.toString());if(c.imagePrimary=f,u){const h=n.get(u.toString());c.imageSecondary=h}}function bj(c,n){for(const o in c.horizontal)eP(c.horizontal[o],n);eP(c.vertical,n)}function eP(c,n){if(c){for(const o of c.positionedLines)for(const u of o.positionedGlyphs)if(u.image!==null){const f=u.image.toString();u.rect=n.get(f).paddedRect}}}function g2(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wj(c,n,o,u,f,h,_,w,T){const P=_2(h.horizontal)||h.vertical,x=o.get("icon-text-fit-padding").evaluate(u,{},f);let A,I=n;return n&&T!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(A=NC(n,h.vertical,T,x,w,_)),P&&(I=NC(n,P,T,x,w,_))),{defaultShapedIcon:I,verticallyShapedIcon:A}}function Sj(c,n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$,Y,X){let Z=_.textMaxSize.evaluate(n,{},I);Z===void 0?Z=w*_.textScaleFactor:Z*=_.textScaleFactor;const re=c.layers[0].layout,ae=_2(o.horizontal)||o.vertical,ue=C.name==="globe",Ce=$o,we=c.tilePixelRatio*Z/Ce,Se=(ft=c.overscaling,c.zoom>18&&ft>2&&(ft>>=1),Math.max(un/(512*ft),1)*re.get("symbol-spacing")),He=re.get("text-padding")*c.tilePixelRatio,Pe=re.get("icon-padding")*c.tilePixelRatio,We=En(re.get("text-max-angle")),st=re.get("icon-rotation-alignment")==="map"&&X!=="point",tt=Se/2;var ft;c.hasAnyIconTextFit===!1&&j!=="none"&&(c.hasAnyIconTextFit=!0);const ht=n.properties?+n.properties[bm]:null,bt=ht&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(ht):65535,gt=(At,en,Jt)=>{if(en.x<0||en.x>=un||en.y<0||en.y>=un)return;let An=null;if(ue){const{x:on,y:hn,z:rn}=C.projectTilePoint(en.x,en.y,Jt);An={anchor:new $d(on,hn,rn,0,void 0),up:C.upVector(Jt,en.x,en.y)}}(function(on,hn,rn,jn,Sn,kn,Qn,gr,sr,Sr,fr,Er,Jr,Ei,tr,kr,Fi,Ki,ts,is,bi,ao,Da,Is,Bs,sa,Io,Nc,qf){const fu=on.addToLineVertexArray(hn,jn);let Ju,$f,Gf,Pm,OM,zM,FM,BM=0,jM=0,UM=0,VM=0,X2=-1,Y2=-1;const Vh={};let qM=Wo("");const Mm=rn?rn.anchor:hn,J2=Nc!=="none";let Q2=0,e5=0;if(sr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Q2,e5]=sr.layout.get("text-offset").evaluate(bi,{},Bs).map(Oc=>Oc*$o):(Q2=sr.layout.get("text-radial-offset").evaluate(bi,{},Bs)*$o,e5=m2),on.allowVerticalPlacement&&Sn.vertical){const Oc=Sn.vertical;if(tr)zM=y2(Oc),gr&&(FM=y2(gr));else{const Ol=sr.layout.get("text-rotate").evaluate(bi,{},Bs)+90;Gf=g1(Sr,Mm,hn,fr,Er,Jr,Oc,Ei,Ol,kr),gr&&(Pm=g1(Sr,Mm,hn,fr,Er,Jr,gr,Ki,Ol))}}if(kn){const Oc=on.iconSizeData,Ol=sr.layout.get("icon-rotate").evaluate(bi,{},Bs),cy=ZC(kn,Ol,Da,J2,ao.iconScaleFactor),n5=gr?ZC(gr,Ol,Da,J2,ao.iconScaleFactor):void 0;$f=g1(Sr,Mm,hn,fr,Er,Jr,kn,Ki,Ol,null),BM=4*cy.length;let Im=null;Oc.kind==="source"?(Im=[Wu*sr.layout.get("icon-size").evaluate(bi,{},Bs)*ao.iconScaleFactor],Im[0]>Bf&&pi(`${on.layerIds[0]}: Value for "icon-size" is >= ${G0}. Reduce your "icon-size".`)):Oc.kind==="composite"&&(Im=[Wu*ao.compositeIconSizes[0].evaluate(bi,{},Bs)*ao.iconScaleFactor,Wu*ao.compositeIconSizes[1].evaluate(bi,{},Bs)*ao.iconScaleFactor],(Im[0]>Bf||Im[1]>Bf)&&pi(`${on.layerIds[0]}: Value for "icon-size" is >= ${G0}. Reduce your "icon-size".`)),on.addSymbols(on.icon,cy,Im,is,ts,bi,!1,rn,hn,fu.lineStartIndex,fu.lineLength,-1,Is,Bs,sa,Io),X2=on.icon.placedSymbolArray.length-1,n5&&(jM=4*n5.length,on.addSymbols(on.icon,n5,Im,is,ts,bi,Nl.vertical,rn,hn,fu.lineStartIndex,fu.lineLength,-1,Is,Bs,sa,Io),Y2=on.icon.placedSymbolArray.length-1)}for(const Oc in Sn.horizontal){const Ol=Sn.horizontal[Oc];Ju||(qM=Wo(Ol.text),tr?OM=y2(Ol):Ju=g1(Sr,Mm,hn,fr,Er,Jr,Ol,Ei,sr.layout.get("text-rotate").evaluate(bi,{},Bs),kr));const cy=Ol.positionedLines.length===1;if(UM+=tP(on,rn,hn,Ol,Qn,sr,tr,bi,kr,fu,Sn.vertical?Nl.horizontal:Nl.horizontalOnly,cy?Object.keys(Sn.horizontal):[Oc],Vh,X2,ao,Is,Bs,sa),cy)break}Sn.vertical&&(VM+=tP(on,rn,hn,Sn.vertical,Qn,sr,tr,bi,kr,fu,Nl.vertical,["vertical"],Vh,Y2,ao,Is,Bs,sa));let Hf=-1;const t5=(Oc,Ol)=>Oc?Math.max(Oc,Ol):Ol;Hf=t5(OM,Hf),Hf=t5(zM,Hf),Hf=t5(FM,Hf);const t7=Hf>-1?1:0;on.glyphOffsetArray.length>=65535&&pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bi.sortKey!==void 0&&on.addToSortKeyRanges(on.symbolInstances.length,bi.sortKey),on.symbolInstances.emplaceBack(hn.x,hn.y,Mm.x,Mm.y,Mm.z,Vh.right>=0?Vh.right:-1,Vh.center>=0?Vh.center:-1,Vh.left>=0?Vh.left:-1,Vh.vertical>=0?Vh.vertical:-1,X2,Y2,qM,Ju!==void 0?Ju:on.collisionBoxArray.length,Ju!==void 0?Ju+1:on.collisionBoxArray.length,Gf!==void 0?Gf:on.collisionBoxArray.length,Gf!==void 0?Gf+1:on.collisionBoxArray.length,$f!==void 0?$f:on.collisionBoxArray.length,$f!==void 0?$f+1:on.collisionBoxArray.length,Pm||on.collisionBoxArray.length,Pm?Pm+1:on.collisionBoxArray.length,fr,UM,VM,BM,jM,t7,0,Q2,e5,Hf,0,J2?1:0,qf)})(c,en,An,At,o,u,h,f,c.layers[0],c.collisionBoxArray,n.index,n.sourceLayerIndex,c.index,He,Y,P,0,Pe,st,$,n,_,x,A,I,M,R,j,bt)};if(X==="line")for(const At of UC(n.geometry,0,0,un,un)){const en=gj(At,Se,We,o.vertical||ae,u,Ce,we,c.overscaling,un);for(const Jt of en)ae&&Tj(c,ae.text,tt,Jt)||gt(At,Jt,I)}else if(X==="line-center"){for(const At of n.geometry)if(At.length>1){const en=mj(At,We,o.vertical||ae,u,Ce,we);en&&gt(At,en,I)}}else if(n.type==="Polygon")for(const At of r1(n.geometry,0)){const en=yj(At,16);gt(At[0],new $d(en.x,en.y,0,0,void 0),I)}else if(n.type==="LineString")for(const At of n.geometry)gt(At,new $d(At[0].x,At[0].y,0,0,void 0),I);else if(n.type==="Point")for(const At of n.geometry)for(const en of At)gt([en],new $d(en.x,en.y,0,0,void 0),I)}const G0=255,Bf=G0*Wu;function tP(c,n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j,$){const Y=function(re,ae,ue,Ce,we,Se,He,Pe){const We=[];if(ae.positionedLines.length===0)return We;const st=Ce.layout.get("text-rotate").evaluate(Se,{})*Math.PI/180,tt=function(At){const en=At[0],Jt=At[1],An=en*Jt;return An>0?[en,-Jt]:An<0?[-en,Jt]:en===0?[Jt,en]:[Jt,-en]}(ue);let ft=Math.abs(ae.top-ae.bottom);for(const At of ae.positionedLines)ft-=At.lineOffset;const ht=ae.positionedLines.length,bt=ft/ht;let gt=ae.top-ue[1];for(let At=0;At<ht;++At){const en=ae.positionedLines[At];gt=_j(ae,bt,gt,At);for(const Jt of en.positionedGlyphs){if(!Jt.rect)continue;const An=Jt.rect||{};let on=MC+1,hn=!0,rn=1,jn=0;if(Jt.image){const bi=He.get(Jt.image.toString());if(!bi)continue;if(bi.sdf){pi("SDF images are not supported in formatted text and will be ignored.");continue}hn=!1,rn=bi.pixelRatio,on=Rg/rn}const Sn=(we||Pe)&&Jt.vertical,kn=Jt.metrics.advance*Jt.scale/2,Qn=Jt.metrics,gr=Jt.rect;if(gr===null)continue;Pe&&ae.verticalizable&&(jn=Jt.image?kn-Jt.metrics.width*Jt.scale/2:0);const sr=we?[Jt.x+kn,Jt.y]:[0,0];let Sr=[0,0],fr=[0,0],Er=!1;we||(Sn?(fr=[Jt.x+kn+tt[0],Jt.y+tt[1]-jn],Er=!0):Sr=[Jt.x+kn+ue[0],Jt.y+ue[1]-jn]);const Jr=gr.w*Jt.scale/(rn*(Jt.localGlyph?Zu:1)),Ei=gr.h*Jt.scale/(rn*(Jt.localGlyph?Zu:1));let tr,kr,Fi,Ki;if(Sn){const bi=Jt.y-gt,ao=new $t(-kn,kn-bi),Da=-Math.PI/2,Is=new $t(...fr);tr=new $t(-kn+Sr[0],Sr[1]),tr._rotateAround(Da,ao)._add(Is),tr.x+=-bi+kn,tr.y-=(Qn.left-on)*Jt.scale;const Bs=Jt.image?Qn.advance*Jt.scale:$o*Jt.scale,sa=String.fromCodePoint(Jt.glyph);oj(sa)?tr.x+=(1-on)*Jt.scale:aj(sa)?tr.x+=Bs-Qn.height*Jt.scale+(-on-1)*Jt.scale:tr.x+=Jt.image||Qn.width+2*on===gr.w&&Qn.height+2*on===gr.h?(Bs-Ei)/2:(Bs-(Qn.height+2*on)*Jt.scale)/2,kr=new $t(tr.x,tr.y-Jr),Fi=new $t(tr.x+Ei,tr.y),Ki=new $t(tr.x+Ei,tr.y-Jr)}else{const bi=(Qn.left-on)*Jt.scale-kn+Sr[0],ao=(-Qn.top-on)*Jt.scale+Sr[1],Da=bi+Jr,Is=ao+Ei;tr=new $t(bi,ao),kr=new $t(Da,ao),Fi=new $t(bi,Is),Ki=new $t(Da,Is)}if(st){let bi;bi=we?new $t(0,0):Er?new $t(tt[0],tt[1]):new $t(ue[0],ue[1]),tr._rotateAround(st,bi),kr._rotateAround(st,bi),Fi._rotateAround(st,bi),Ki._rotateAround(st,bi)}const ts=new $t(0,0),is=new $t(0,0);We.push({tl:tr,tr:kr,bl:Fi,br:Ki,texPrimary:An,texSecondary:void 0,writingMode:ae.writingMode,glyphOffset:sr,sectionIndex:Jt.sectionIndex,isSDF:hn,pixelOffsetTL:ts,pixelOffsetBR:is,minFontScaleX:0,minFontScaleY:0})}}return We}(0,u,T,h,_,w,f,c.allowVerticalPlacement),X=c.textSizeData;let Z=null;X.kind==="source"?(Z=[Wu*h.layout.get("text-size").evaluate(w,{},j)*M.textScaleFactor],Z[0]>Bf&&pi(`${c.layerIds[0]}: Value for "text-size" is >= ${G0}. Reduce your "text-size".`)):X.kind==="composite"&&(Z=[Wu*M.compositeTextSizes[0].evaluate(w,{},j)*M.textScaleFactor,Wu*M.compositeTextSizes[1].evaluate(w,{},j)*M.textScaleFactor],(Z[0]>Bf||Z[1]>Bf)&&pi(`${c.layerIds[0]}: Value for "text-size" is >= ${G0}. Reduce your "text-size".`)),c.addSymbols(c.text,Y,Z,T,_,w,x,n,o,P.lineStartIndex,P.lineLength,C,R,j,$,!1);for(const re of A)I[re]=c.text.placedSymbolArray.length-1;return 4*Y.length}function _2(c){for(const n in c)return c[n];return null}function g1(c,n,o,u,f,h,_,w,T,P){let x=_.top,A=_.bottom,I=_.left,C=_.right;const M=_.collisionPadding;if(M&&(I-=M[0],x-=M[1],C+=M[2],A+=M[3]),T){const R=new $t(I,x),j=new $t(C,x),$=new $t(I,A),Y=new $t(C,A),X=En(T);let Z=new $t(0,0);P&&(Z=new $t(P[0],P[1])),R._rotateAround(X,Z),j._rotateAround(X,Z),$._rotateAround(X,Z),Y._rotateAround(X,Z),I=Math.min(R.x,j.x,$.x,Y.x),C=Math.max(R.x,j.x,$.x,Y.x),x=Math.min(R.y,j.y,$.y,Y.y),A=Math.max(R.y,j.y,$.y,Y.y)}return c.emplaceBack(n.x,n.y,n.z,o.x,o.y,I,x,C,A,w,u,f,h),c.length-1}function y2(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const n=c.bottom-c.top;return n>0?Math.max(10,n):null}function Tj(c,n,o,u){const f=c.compareText;if(n in f){const h=f[n];for(let _=h.length-1;_>=0;_--)if(u.dist(h[_])<o)return!0}else f[n]=[];return f[n].push(u),!1}function nP(c,n){const o=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*n:0,f=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),h=Math.sin(o)*f/Math.sin(Math.max(Math.PI/2-c._pitch-o,.01));let _=Math.sin(c._pitch)*h+f;const w=f*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let T=Math.max(c.zoom-17,0);c.isOrthographic&&(T/=10),_*=1+T}return Math.min(1.01*_,w)}function H0(c,n){if(!n.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:n};const o=Math.pow(2,-c.z),u=c.x*o,f=(c.x+1)*o,h=c.y*o,_=(c.y+1)*o,w=Qa(u),T=Qa(f),P=Po(h),x=Po(_),A=n.project(w,P),I=n.project(T,P),C=n.project(T,x),M=n.project(w,x);let R=Math.min(A.x,I.x,C.x,M.x),j=Math.min(A.y,I.y,C.y,M.y),$=Math.max(A.x,I.x,C.x,M.x),Y=Math.max(A.y,I.y,C.y,M.y);const X=o/16;function Z(ae,ue,Ce,we,Se,He){const Pe=(Ce+Se)/2,We=(we+He)/2,st=n.project(Qa(Pe),Po(We)),tt=Math.max(0,R-st.x,j-st.y,st.x-$,st.y-Y);R=Math.min(R,st.x),$=Math.max($,st.x),j=Math.min(j,st.y),Y=Math.max(Y,st.y),tt>X&&(Z(ae,st,Ce,we,Pe,We),Z(st,ue,Pe,We,Se,He))}Z(A,I,u,h,f,h),Z(I,C,f,h,f,_),Z(C,M,f,_,u,_),Z(M,A,u,_,u,h),R-=X,j-=X,$+=X,Y+=X;const re=1/Math.max($-R,Y-j);return{scale:re,x:R*re,y:j*re,x2:$*re,y2:Y*re,projection:n}}function rP(c,{x:n,y:o},u=0){return new $t(((n-u)*c.scale-c.x)*un,(o*c.scale-c.y)*un)}const Aj=me.mat4.identity(new Float32Array(16));class jf{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new ni(0,0)}projectTilePoint(n,o,u){return{x:n,y:o,z:0}}locationPoint(n,o,u,f=!0){return n._coordinatePoint(n.locationCoordinate(o,u),f)}pixelsPerMeter(n,o){return Vo(1,n)*o}pixelSpaceConversion(n,o,u){return 1}farthestPixelDistance(n){return nP(n,n.pixelsPerMeter)}pointCoordinate(n,o,u,f){const h=n.horizonLineFromTop(!1),_=new $t(o,Math.max(h,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(_,f))}pointCoordinate3D(n,o,u){const f=new $t(o,u);if(n.elevation)return n.elevation.pointCoordinate(f);{const h=this.pointCoordinate(n,f.x,f.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(n,o){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,o.x,o.y);const u=n.horizonLineFromTop();return o.y<u}createInversionMatrix(n,o){return Aj}createTileMatrix(n,o,u){let f,h,_;const w=u.canonical,T=me.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=H0(w,this);f=1,h=P.x+u.wrap*P.scale,_=P.y,me.mat4.scale(T,T,[f/P.scale,f/P.scale,n.pixelsPerMeter/o])}else f=o/n.zoomScale(w.z),h=(w.x+Math.pow(2,w.z)*u.wrap)*f,_=w.y*f;return me.mat4.translate(T,T,[h,_,0]),me.mat4.scale(T,T,[f/un,f/un,1]),T}upVector(n,o,u){return[0,0,1]}upVectorScale(n,o,u){return{metersToTile:1}}}class Ej extends jf{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,u]=this.parallels=n.parallels||[29.5,45.5],f=Math.sin(En(o));this.n=(f+Math.sin(En(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:u,c:f,r0:h}=this,_=En(n-this.center[0]),w=En(o),T=Math.sqrt(f-2*u*Math.sin(w))/u;return{x:T*Math.sin(_*u),y:T*Math.cos(_*u)-h,z:0}}unproject(n,o){const{n:u,c:f,r0:h}=this,_=h+o;let w=Math.atan2(n,Math.abs(_))*Math.sign(_);_*u<0&&(w-=Math.PI*Math.sign(n)*Math.sign(_));const T=En(this.center[0])*u;w=Kr(w,-Math.PI-T,Math.PI-T);const P=Ln(bn(w/u)+this.center[0],-180,180),x=Math.asin(Ln((f-(n*n+_*_)*u*u)/(2*u),-1,1)),A=Ln(bn(x),-ps,ps);return new ni(P,A)}}const W0=1.340264,Z0=-.081106,K0=893e-6,X0=.003796,_1=Math.sqrt(3)/2;class Cj extends jf{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const u=Math.asin(_1*Math.sin(o)),f=u*u,h=f*f*f;return{x:.5*(n*Math.cos(u)/(_1*(W0+3*Z0*f+h*(7*K0+9*X0*f)))/Math.PI+.5),y:1-.5*(u*(W0+Z0*f+h*(K0+X0*f))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,f=u*u,h=f*f*f;for(let x,A,I,C=0;C<12&&(A=u*(W0+Z0*f+h*(K0+X0*f))-o,I=W0+3*Z0*f+h*(7*K0+9*X0*f),x=A/I,u=Ln(u-x,-Math.PI/3,Math.PI/3),f=u*u,h=f*f*f,!(Math.abs(x)<1e-12));++C);const _=_1*n*(W0+3*Z0*f+h*(7*K0+9*X0*f))/Math.cos(u),w=Math.asin(Math.sin(u)/_1),T=Ln(180*_/Math.PI,-180,180),P=Ln(180*w/Math.PI,-ps,ps);return new ni(T,P)}}class Pj extends jf{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const u=360*(n-.5),f=Ln(360*(.5-o),-ps,ps);return new ni(u,f)}}const Og=Math.PI/2;function y1(c){return Math.tan((Og+c)/2)}class Mj extends jf{constructor(n){super(n),this.center=n.center||[0,30];const[o,u]=this.parallels=n.parallels||[30,30];let f=En(o),h=En(u);this.southernCenter=f+h<0,this.southernCenter&&(f=-f,h=-h);const _=Math.cos(f),w=y1(f);this.n=f===h?Math.sin(f):Math.log(_/Math.cos(h))/Math.log(y1(h)/w),this.f=_*Math.pow(y1(f),this.n)/this.n}project(n,o){o=En(o),this.southernCenter&&(o=-o),n=En(n-this.center[0]);const u=1e-6,{n:f,f:h}=this;h>0?o<-Og+u&&(o=-Og+u):o>Og-u&&(o=Og-u);const _=h/Math.pow(y1(o),f);let w=_*Math.sin(f*n),T=h-_*Math.cos(f*n);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f}=this,h=f-o,_=Math.sign(h),w=Math.sign(u)*Math.sqrt(n*n+h*h);let T=Math.atan2(n,Math.abs(h))*_;h*u<0&&(T-=Math.PI*Math.sign(n)*_);const P=Ln(bn(T/u)+this.center[0],-180,180),x=Ln(bn(2*Math.atan(Math.pow(f/w,1/u))-Og),-ps,ps);return new ni(P,this.southernCenter?-x:x)}}class iP extends jf{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:cu(n),y:Ja(o),z:0}}unproject(n,o){const u=Qa(n),f=Po(o);return new ni(u,f)}}const sP=En(ps);class Ij extends jf{project(n,o){const u=(o=En(o))*o,f=u*u;return{x:.5*((n=En(n))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,f=25,h=0,_=u*u;do{_=u*u;const P=_*_;h=(u*(1.007226+_*(.015085+P*(.028874*_-.044475-.005916*P)))-o)/(1.007226+_*(.045255+P*(.259866*_-.311325-.005916*11*P))),u=Ln(u-h,-sP,sP)}while(Math.abs(h)>1e-6&&--f>0);_=u*u;const w=Ln(bn(n/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=bn(u);return new ni(w,T)}}const oP=En(ps);class Lj extends jf{project(n,o){o=En(o),n=En(n);const u=Math.cos(o),f=2/Math.PI,h=Math.acos(u*Math.cos(n/2)),_=Math.sin(h)/h,w=.5*(n*f+2*u*Math.sin(n/2)/_)||0,T=.5*(o+Math.sin(o)/_)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(n,o){let u=n=(2*n-.5)*Math.PI,f=o=(2*(1-o)-1)*Math.PI,h=25;const _=1e-6;let w=0,T=0;do{const P=Math.cos(f),x=Math.sin(f),A=2*x*P,I=x*x,C=P*P,M=Math.cos(u/2),R=Math.sin(u/2),j=2*M*R,$=R*R,Y=1-C*M*M,X=Y?1/Y:0,Z=Y?Math.acos(P*M)*Math.sqrt(1/Y):0,re=.5*(2*Z*P*R+2*u/Math.PI)-n,ae=.5*(Z*x+f)-o,ue=.5*X*(C*$+Z*P*M*I)+1/Math.PI,Ce=X*(j*A/4-Z*x*R),we=.125*X*(A*R-Z*x*C*j),Se=.5*X*(I*M+Z*$*P)+.5,He=Ce*we-Se*ue;w=(ae*Ce-re*Se)/He,T=(re*we-ae*ue)/He,u=Ln(u-w,-Math.PI,Math.PI),f=Ln(f-T,-oP,oP)}while((Math.abs(w)>_||Math.abs(T)>_)&&--h>0);return new ni(bn(u),bn(f))}}class aP extends jf{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(En(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:u,cosPhi:f}=this;return{x:En(n)*f*u+.5,y:-Math.sin(En(o))/f*u+.5,z:0}}unproject(n,o){const{scale:u,cosPhi:f}=this,h=-(o-.5)/u,_=Ln(bn((n-.5)/u)/f,-180,180),w=Math.asin(Ln(h*f,-1,1)),T=Ln(bn(w),-ps,ps);return new ni(_,T)}}class kj extends iP{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,u){const f=ii(n,o,u),h=zi(Js(u));return me.vec3.transformMat4(f,f,h),{x:f[0],y:f[1],z:f[2]}}locationPoint(n,o,u){const f=Ud(o.lat,o.lng),h=me.vec3.normalize([],f),_=u?n._centerAltitude+u:n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude,w=Vo(1,0)*un*_;me.vec3.scaleAndAdd(f,f,h,w);const T=me.mat4.identity(new Float64Array(16));return me.mat4.multiply(T,n.pixelMatrix,n.globeMatrix),me.vec3.transformMat4(f,f,T),new $t(f[0],f[1])}pixelsPerMeter(n,o){return Vo(1,0)*o}pixelSpaceConversion(n,o,u){const f=Vo(1,n)*o,h=Bn(Vo(1,45)*o,f,u);return this.pixelsPerMeter(n,o)/h}createTileMatrix(n,o,u){const f=Qs(Js(u.canonical));return me.mat4.multiply(new Float64Array(16),n.globeMatrix,f)}createInversionMatrix(n,o){const{center:u}=n,f=zi(Js(o));return me.mat4.rotateY(f,f,En(u.lng)),me.mat4.rotateX(f,f,En(u.lat)),me.mat4.scale(f,f,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(n,o,u,f){return Yr(n,o,u,!0)||new r(0,0)}pointCoordinate3D(n,o,u){const f=this.pointCoordinate(n,o,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(n,o){return!Yr(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(f,h){const _=f.cameraToCenterDistance,w=f._centerAltitude*h,T=f._camera,P=f._camera.forward(),x=me.vec3.add([],me.vec3.scale([],P,-_),[0,0,w]),A=f.worldSize/(2*Math.PI),I=[0,0,-A],C=f.width/f.height,M=Math.tan(f.fovAboveCenter),R=me.vec3.scale([],T.up(),M),j=me.vec3.scale([],T.right(),M*C),$=me.vec3.normalize([],me.vec3.add([],me.vec3.add([],P,R),j)),Y=[];let X;if(new Yn(x,$).closestPointOnSphere(I,A,Y)){const Z=me.vec3.add([],Y,I),re=me.vec3.sub([],Z,x);X=Math.cos(f.fovAboveCenter)*me.vec3.length(re)}else{const Z=me.vec3.sub([],x,I),re=me.vec3.sub([],I,x);me.vec3.normalize(re,re);const ae=me.vec3.length(Z)-A;X=Math.sqrt(ae*(ae+2*A));const ue=Math.acos(X/(A+ae))-Math.acos(me.vec3.dot(P,re));X*=Math.cos(ue)}return 1.01*X}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),u=Ra(n.zoom);if(u>0){const f=nP(n,Vo(1,n.center.lat)*n.worldSize),h=n.worldSize/(2*Math.PI),_=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Bn(o,f+h*(1-Math.cos(_)),Math.pow(u,10))}return o}upVector(n,o,u){return ii(o,u,n,1)}upVectorScale(n){return{metersToTile:Lr(xi(Js(n)))}}}function lP(c){const n=c.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(c.name){case"mercator":return new iP(c);case"equirectangular":return new Pj(c);case"naturalEarth":return new Ij(c);case"equalEarth":return new Cj(c);case"winkelTripel":return new Lj(c);case"albers":return o?new aP(c):new Ej(c);case"lambertConformalConic":return o?new aP(c):new Mj(c);case"globe":return new kj(c)}throw new Error(`Invalid projection name: ${c.name}`)}const Rj=Of.VectorTileFeature.types,Dj=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function v1(c,n,o,u,f,h,_,w,T,P,x,A,I){const C=w?Math.min(Bf,Math.round(w[0])):0,M=w?Math.min(Bf,Math.round(w[1])):0;c.emplaceBack(n,o,Math.round(32*u),Math.round(32*f),h,_,(C<<1)+(T?1:0),M,16*P,16*x,256*A,256*I)}function x1(c,n,o){c.emplaceBack(n,o)}function b1(c,n,o,u,f,h,_){c.emplaceBack(n,o,u,f,h,_)}function w1(c,n,o,u,f){c.emplaceBack(n,o,u,f),c.emplaceBack(n,o,u,f),c.emplaceBack(n,o,u,f),c.emplaceBack(n,o,u,f)}function Nj(c){for(const n of c.sections)if(Zn(n.text))return!0;return!1}class v2{constructor(n){this.layoutVertexArray=new om,this.indexArray=new Os,this.programConfigurations=n,this.segments=new qi,this.dynamicLayoutVertexArray=new Ka,this.opacityVertexArray=new am,this.placedSymbolArray=new Uv,this.iconTransitioningVertexArray=new kc,this.globeExtVertexArray=new Mf,this.zOffsetVertexArray=new Il}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,o,u,f,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,XB.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,JB.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Dj,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,ej.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,YB.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,QB.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ze(v2,"SymbolBuffers");class x2{constructor(n,o,u){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new u,this.segments=new qi,this.collisionVertexArray=new ju,this.collisionVertexArrayExt=new Ka}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,tj.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,nj.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ze(x2,"CollisionBuffers");class S1{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=me.mat4.identity([]),this.placementViewportMatrix=me.mat4.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=l2(this.zoom,o["text-size"]),this.iconSizeData=l2(this.zoom,o["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),h=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(_=>Nl[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new v2(new Fh(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new v2(new Fh(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new $v,this.lineVertexArray=new hm,this.symbolInstances=new qv}calculateGlyphDependencies(n,o,u,f,h){for(const _ of n){const w=_.codePointAt(0);if(w===void 0)break;if(o[w]=!0,f&&h&&w<=65535){const T=U0[_];T&&(o[T.charCodeAt(0)]=!0)}}}updateFootprints(n,o){}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!t2(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(n,o,u,f){const h=this.layers[0],_=h.layout,w=this.projection.name==="globe",T=_.get("text-font"),P=_.get("text-field"),x=_.get("icon-image"),[A,I]=_.get("icon-size-scale-range"),C=Ln(o.scaleFactor||1,A,I),M=(P.value.kind!=="constant"||P.value.value instanceof ls&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),R=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,j=_.get("symbol-sort-key");if(this.features=[],!M&&!R)return;const $=o.iconDependencies,Y=o.glyphDependencies,X=o.availableImages,Z=new Nr(this.zoom);for(const{feature:re,id:ae,index:ue,sourceLayerIndex:Ce}of n){const we=h._featureFilter.needGeometry,Se=B(re,we);if(!h._featureFilter.filter(Z,Se,u))continue;if(we||(Se.geometry=F(re,u,f)),w&&re.type!==1&&u.z<=5){const tt=Se.geometry,ft=.98078528056,ht=(bt,gt)=>{const At=ii(bt.x,bt.y,u,1),en=ii(gt.x,gt.y,u,1);return me.vec3.dot(At,en)<ft};for(let bt=0;bt<tt.length;bt++)tt[bt]=b(tt[bt],ht)}let He,Pe;if(M){const tt=h.getValueAndResolveTokens("text-field",Se,u,X),ft=ls.factory(tt);Nj(ft)&&(this.hasRTLText=!0),(!this.hasRTLText||bs()==="unavailable"||this.hasRTLText&&ci.isParsed())&&(He=sj(ft,h,Se))}if(R){const tt=h.getValueAndResolveTokens("icon-image",Se,u,X);Pe=tt instanceof ds?tt:ds.build(tt)}if(!He&&!Pe)continue;const We=this.sortFeaturesByKey?j.evaluate(Se,{},u):void 0,st={id:ae,text:He,icon:Pe,index:ue,sourceLayerIndex:Ce,geometry:Se.geometry,properties:re.properties,type:Rj[re.type],sortKey:We};if(this.features.push(st),Pe){const tt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:ft,iconSecondary:ht}=JC(Pe,this.iconSizeData,tt["icon-size"],u,this.zoom,st,this.pixelRatio,C),bt=ft.id.toString();if($.has(bt)?$.get(bt).push(ft):$.set(bt,[ft]),ht){const gt=ht.id.toString();$.has(gt)?$.get(gt).push(ht):$.set(gt,[ht])}}if(He){const tt=T.evaluate(Se,{},u).join(","),ft=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Nl.vertical)>=0;for(const ht of He.sections)if(ht.image){const bt=ht.image.getPrimary().scaleSelf(this.pixelRatio),gt=bt.id.toString(),At=$.get(gt)||[];At.push(bt),$.set(gt,At)}else{const bt=Ot(He.toString()),gt=ht.fontStack||tt,At=Y[gt]=Y[gt]||{};this.calculateGlyphDependencies(ht.text,At,ft,this.allowVerticalPlacement,bt)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(re){const ae={},ue={},Ce=[];let we=0;function Se(st){Ce.push(re[st]),we++}function He(st,tt,ft){const ht=ue[st];return delete ue[st],ue[tt]=ht,Ce[ht].geometry[0].pop(),Ce[ht].geometry[0]=Ce[ht].geometry[0].concat(ft[0]),ht}function Pe(st,tt,ft){const ht=ae[tt];return delete ae[tt],ae[st]=ht,Ce[ht].geometry[0].shift(),Ce[ht].geometry[0]=ft[0].concat(Ce[ht].geometry[0]),ht}function We(st,tt,ft){const ht=ft?tt[0][tt[0].length-1]:tt[0][0];return`${st}:${ht.x}:${ht.y}`}for(let st=0;st<re.length;st++){const tt=re[st],ft=tt.geometry,ht=tt.text?tt.text.toString():null;if(!ht){Se(st);continue}const bt=We(ht,ft),gt=We(ht,ft,!0);if(bt in ue&&gt in ae&&ue[bt]!==ae[gt]){const At=Pe(bt,gt,ft),en=He(bt,gt,Ce[At].geometry);delete ae[bt],delete ue[gt],ue[We(ht,Ce[en].geometry,!0)]=en,Ce[At].geometry=null}else bt in ue?He(bt,gt,ft):gt in ae?Pe(bt,gt,ft):(Se(st),ae[bt]=we-1,ue[gt]=we-1)}return Ce.filter(st=>st.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const re of o.elevationFeatures)this.elevationFeatureIdToIndex.set(re.id,this.elevationFeatures.length),this.elevationFeatures.push(re)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((re,ae)=>re.sortKey-ae.sortKey)}update(n,o,u,f,h,_,w){this.text.programConfigurations.updatePaintArrays(n,o,h,u,f,_,w),this.icon.programConfigurations.updatePaintArrays(n,o,h,u,f,_,w)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);if(u.elevationFeatureIndex===65535)continue;const f=this.elevationFeatures[u.elevationFeatureIndex];if(f){const h=.05+f.pointElevation(new $t(u.tileAnchorX,u.tileAnchorY));u.zOffset!==h&&(n=!0,u.zOffset=h)}}n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const n=(h,_,w)=>{u+=_,u>h.length&&h.resize(u);for(let T=-_;T<0;T++)h.emplace(T+u,w)},o=(h,_,w)=>{f+=_,f>h.length&&h.resize(f);for(let T=-_;T<0;T++)h.emplace(T+f,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,f=0;for(let h=0;h<this.symbolInstances.length;h++){const _=this.symbolInstances.get(h),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:T,numIconVertices:P}=_,x=_.zOffset,A=P>0;if((w>0||T>0)&&(n(this.text.zOffsetVertexArray,w,x),n(this.text.zOffsetVertexArray,T,x)),A){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:C}=_;I>=0&&o(this.icon.zOffsetVertexArray,P,x),C>=0&&o(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=lP(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const u=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:f,y:h}of o)this.lineVertexArray.emplaceBack(f,h);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,o,u,f,h,_,w,T,P,x,A,I,C,M,R,j){const $=n.indexArray,Y=n.layoutVertexArray,X=n.globeExtVertexArray,Z=n.segments.prepareSegment(4*o.length,Y,$,this.canOverlap?_.sortKey:void 0),re=this.glyphOffsetArray.length,ae=Z.vertexLength,ue=this.allowVerticalPlacement&&w===Nl.vertical?Math.PI/2:0,Ce=_.text&&_.text.sections;for(let Se=0;Se<o.length;Se++){const{tl:He,tr:Pe,bl:We,br:st,texPrimary:tt,texSecondary:ft,pixelOffsetTL:ht,pixelOffsetBR:bt,minFontScaleX:gt,minFontScaleY:At,glyphOffset:en,isSDF:Jt,sectionIndex:An}=o[Se],on=Z.vertexLength,hn=en[1];if(v1(Y,P.x,P.y,He.x,hn+He.y,tt.x,tt.y,u,Jt,ht.x,ht.y,gt,At),v1(Y,P.x,P.y,Pe.x,hn+Pe.y,tt.x+tt.w,tt.y,u,Jt,bt.x,ht.y,gt,At),v1(Y,P.x,P.y,We.x,hn+We.y,tt.x,tt.y+tt.h,u,Jt,ht.x,bt.y,gt,At),v1(Y,P.x,P.y,st.x,hn+st.y,tt.x+tt.w,tt.y+tt.h,u,Jt,bt.x,bt.y,gt,At),T){const{x:rn,y:jn,z:Sn}=T.anchor,[kn,Qn,gr]=T.up;b1(X,rn,jn,Sn,kn,Qn,gr),b1(X,rn,jn,Sn,kn,Qn,gr),b1(X,rn,jn,Sn,kn,Qn,gr),b1(X,rn,jn,Sn,kn,Qn,gr),w1(n.dynamicLayoutVertexArray,rn,jn,Sn,ue)}else w1(n.dynamicLayoutVertexArray,P.x,P.y,P.z,ue);if(j){const rn=ft||tt;x1(n.iconTransitioningVertexArray,rn.x,rn.y),x1(n.iconTransitioningVertexArray,rn.x+rn.w,rn.y),x1(n.iconTransitioningVertexArray,rn.x,rn.y+rn.h),x1(n.iconTransitioningVertexArray,rn.x+rn.w,rn.y+rn.h)}$.emplaceBack(on,on+1,on+2),$.emplaceBack(on+1,on+2,on+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(en[0]),Se!==o.length-1&&An===o[Se+1].sectionIndex||n.programConfigurations.populatePaintArrays(Y.length,_,_.index,{},C,M,R,Ce&&Ce[An])}const we=T?T.anchor:P;n.placedSymbolArray.emplaceBack(we.x,we.y,we.z,P.x,P.y,re,this.glyphOffsetArray.length-re,ae,x,A,P.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],w,0,!1,0,I,0)}_commitLayoutVertex(n,o,u,f,h,_,w){n.emplaceBack(o,u,f,h,_,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(n,o,u,f,h,_,w){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),P=T.vertexLength,x=w.tileAnchorX,A=w.tileAnchorY;for(let C=0;C<4;C++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,n.padding,w.zOffset),this._commitLayoutVertex(u.layoutVertexArray,f,h,_,x,A,new $t(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,h,_,x,A,new $t(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,h,_,x,A,new $t(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,h,_,x,A,new $t(n.x1,n.y2)),T.vertexLength+=4;const I=u.indexArray;I.emplaceBack(P,P+1),I.emplaceBack(P+1,P+2),I.emplaceBack(P+2,P+3),I.emplaceBack(P+3,P),T.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,u,f,h,_){for(let w=f;w<h;w++){const T=u.get(w),P=this.getSymbolInstanceTextSize(n,_,o,w);this._addCollisionDebugVertices(T,P,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(n,o,u,f,h,_){for(let w=f;w<h;w++){const T=u.get(w),P=this.getSymbolInstanceIconSize(n,o,_.placedIconSymbolIndex);this._addCollisionDebugVertices(T,P,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(n,o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new x2(Rh,TC.members,kc),this.iconCollisionBox=new x2(Rh,TC.members,kc);const f=Lg(this.iconSizeData,n),h=Lg(this.textSizeData,n,u);for(let _=0;_<this.symbolInstances.length;_++){const w=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(h,n,o,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(h,n,o,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(f,n,o,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(f,n,o,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(n,o,u,f){const h=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:f),_=u1(this.textSizeData,n,h)/$o;return this.tilePixelRatio*_}getSymbolInstanceIconSize(n,o,u){const f=this.icon.placedSymbolArray.get(u),h=u1(this.iconSizeData,n,f);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(n,o,u,f){n.emplaceBack(o,-u,-u,f),n.emplaceBack(o,u,-u,f),n.emplaceBack(o,u,u,f),n.emplaceBack(o,-u,u,f)}_updateTextDebugCollisionBoxes(n,o,u,f,h,_,w){for(let T=f;T<h;T++){const P=u.get(T),x=this.getSymbolInstanceTextSize(n,_,o,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,P.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(n,o,u,f,h,_,w){for(let T=f;T<h;T++){const P=u.get(T),x=this.getSymbolInstanceIconSize(n,o,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,P.padding,_.zOffset)}}updateCollisionDebugBuffers(n,o,u,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Lg(this.iconSizeData,n,f),_=Lg(this.textSizeData,n,u);for(let w=0;w<this.symbolInstances.length;w++){const T=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(_,n,o,T.textBoxStartIndex,T.textBoxEndIndex,T,u),this._updateTextDebugCollisionBoxes(_,n,o,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,u),this._updateIconDebugCollisionBoxes(h,n,o,T.iconBoxStartIndex,T.iconBoxEndIndex,T,f),this._updateIconDebugCollisionBoxes(h,n,o,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,u,f,h,_,w,T,P){const x={};if(o<u){const{x1:A,y1:I,x2:C,y2:M,padding:R,projectedAnchorX:j,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:Z,featureIndex:re}=n.get(o);x.textBox={x1:A,y1:I,x2:C,y2:M,padding:R,projectedAnchorX:j,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:Z},x.textFeatureIndex=re}if(f<h){const{x1:A,y1:I,x2:C,y2:M,padding:R,projectedAnchorX:j,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:Z,featureIndex:re}=n.get(f);x.verticalTextBox={x1:A,y1:I,x2:C,y2:M,padding:R,projectedAnchorX:j,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:Z},x.verticalTextFeatureIndex=re}if(_<w){const{x1:A,y1:I,x2:C,y2:M,padding:R,projectedAnchorX:j,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:Z,featureIndex:re}=n.get(_);x.iconBox={x1:A,y1:I,x2:C,y2:M,padding:R,projectedAnchorX:j,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:Z},x.iconFeatureIndex=re}if(T<P){const{x1:A,y1:I,x2:C,y2:M,padding:R,projectedAnchorX:j,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:Z,featureIndex:re}=n.get(T);x.verticalIconBox={x1:A,y1:I,x2:C,y2:M,padding:R,projectedAnchorX:j,projectedAnchorY:$,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:Z},x.verticalIconFeatureIndex=re}return x}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,o){const u=n.placedSymbolArray.get(o),f=u.vertexStartIndex+4*u.numGlyphs;for(let h=u.vertexStartIndex;h<f;h+=4)n.indexArray.emplaceBack(h,h+1,h+2),n.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),u=Math.cos(n),f=[],h=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const T=this.symbolInstances.get(w);f.push(0|Math.round(o*T.tileAnchorX+u*T.tileAnchorY)),h.push(T.featureIndex)}return _.sort((w,T)=>f[w]-f[T]||h[T]-h[w]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:P}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),h>=0&&h!==f&&this.addIndicesForPlacedSymbol(this.text,h),_>=0&&_!==h&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let cP,uP,b2;Ze(S1,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),S1.addDynamicAttributes=w1;class hP{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:vc,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ze(hP,"FormatSectionOverride",{omit:["defaultValue"]});const w2=()=>b2||(b2={layout:cP||(cP=new Ir({"symbol-placement":new an(Tt.layout_symbol["symbol-placement"]),"symbol-spacing":new an(Tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new an(Tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vn(Tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new an(Tt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new an(Tt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new an(Tt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new an(Tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new an(Tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new an(Tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new an(Tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new vn(Tt.layout_symbol["icon-size"]),"icon-size-scale-range":new an(Tt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new vn(Tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vn(Tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new vn(Tt.layout_symbol["icon-image"]),"icon-rotate":new vn(Tt.layout_symbol["icon-rotate"]),"icon-padding":new an(Tt.layout_symbol["icon-padding"]),"icon-keep-upright":new an(Tt.layout_symbol["icon-keep-upright"]),"icon-offset":new vn(Tt.layout_symbol["icon-offset"]),"icon-anchor":new vn(Tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new an(Tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new an(Tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new an(Tt.layout_symbol["text-rotation-alignment"]),"text-field":new vn(Tt.layout_symbol["text-field"]),"text-font":new vn(Tt.layout_symbol["text-font"]),"text-size":new vn(Tt.layout_symbol["text-size"]),"text-size-scale-range":new an(Tt.layout_symbol["text-size-scale-range"]),"text-max-width":new vn(Tt.layout_symbol["text-max-width"]),"text-line-height":new vn(Tt.layout_symbol["text-line-height"]),"text-letter-spacing":new vn(Tt.layout_symbol["text-letter-spacing"]),"text-justify":new vn(Tt.layout_symbol["text-justify"]),"text-radial-offset":new vn(Tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new an(Tt.layout_symbol["text-variable-anchor"]),"text-anchor":new vn(Tt.layout_symbol["text-anchor"]),"text-max-angle":new an(Tt.layout_symbol["text-max-angle"]),"text-writing-mode":new an(Tt.layout_symbol["text-writing-mode"]),"text-rotate":new vn(Tt.layout_symbol["text-rotate"]),"text-padding":new an(Tt.layout_symbol["text-padding"]),"text-keep-upright":new an(Tt.layout_symbol["text-keep-upright"]),"text-transform":new vn(Tt.layout_symbol["text-transform"]),"text-offset":new vn(Tt.layout_symbol["text-offset"]),"text-allow-overlap":new an(Tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new an(Tt.layout_symbol["text-ignore-placement"]),"text-optional":new an(Tt.layout_symbol["text-optional"]),visibility:new an(Tt.layout_symbol.visibility)})),paint:uP||(uP=new Ir({"icon-opacity":new vn(Tt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new vn(Tt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new vn(Tt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new vn(Tt.paint_symbol["text-emissive-strength"]),"icon-color":new vn(Tt.paint_symbol["icon-color"]),"icon-halo-color":new vn(Tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new vn(Tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vn(Tt.paint_symbol["icon-halo-blur"]),"icon-translate":new an(Tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new an(Tt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new vn(Tt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new vn(Tt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new vn(Tt.paint_symbol["text-occlusion-opacity"]),"text-color":new vn(Tt.paint_symbol["text-color"],{runtimeType:no,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new vn(Tt.paint_symbol["text-halo-color"]),"text-halo-width":new vn(Tt.paint_symbol["text-halo-width"]),"text-halo-blur":new vn(Tt.paint_symbol["text-halo-blur"]),"text-translate":new an(Tt.paint_symbol["text-translate"]),"text-translate-anchor":new an(Tt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new an(Tt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new an(Tt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new an(Tt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new an(Tt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new vn(Tt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},b2);class T1 extends Ys{constructor(n,o,u,f){super(n,w2(),o,u,f),this._colorAdjustmentMatrix=me.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const h of u)f.indexOf(h)<0&&f.push(h);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,o,u,f){return this._saturation===n&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(h,_,w,T){h=Dt(h),_=Rs(_);const P=me.mat4.create(),x=h/3,A=1-2*x,I=[A,x,x,0,x,A,x,0,x,x,A,0,0,0,0,1],C=.5-.5*_,M=T-w;return me.mat4.multiply(P,[M,0,0,0,0,M,0,0,0,0,M,0,w,w,w,1],[_,0,0,0,0,_,0,0,0,0,_,0,C,C,C,1]),me.mat4.multiply(P,P,I),P}(n,o,u,f),this._saturation=n,this._contrast=o,this._brightnessMin=u,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,o,u,f){const h=this.layout.get(n).evaluate(o,{},u,f),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Ef(_.value)||!h?h:function(w,T){return T.replace(/{([^{}]+)}/g,(P,x)=>x in w?String(w[x]):"")}(o.properties,h)}createBucket(n){return new S1(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of w2().paint.overridableProperties){if(!T1.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),u=new hP(o),f=new nm(u,o.property.specification,this.scope,this.options);let h=null;h=o.value.kind==="constant"||o.value.kind==="source"?new D("source",f):new q("composite",f,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new ws(o.property,h,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&T1.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const u=n.get("text-field"),f=w2().paint.properties[o];let h=!1;const _=w=>{for(const T of w)if(f.overrides&&f.overrides.hasOverride(T))return void(h=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ls)_(u.value.value.sections);else if(u.value.kind==="source"){const w=P=>{h||(P instanceof da&&Zi(P.value)===ja?_(P.value.sections):P instanceof wc?_(P.sections):P.eachChild(w))},T=u.value;T._styleExpression&&w(T._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,o,u){return{config:new jd(this,{zoom:o,lut:u}),overrideFog:!1}}}let dP,fP,pP,mP;var S2=Or([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function T2(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function A2(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class E2{constructor(n,o,u,f){this.context=n,this.format=u,this.useMipmap=f&&f.useMipmap,this.texture=n.gl.createTexture(),this.update(o,{premultiply:f&&f.premultiply})}update(n,o){const u=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,f=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:h}=this,{gl:_}=h,{x:w,y:T}=o&&o.position?o.position:{x:0,y:0},P=w+u,x=T+f;!this.size||this.size[0]===P&&this.size[1]===x||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!o||o.premultiply!==!1));const A=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&P>0&&x>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(P,x)))+1:1;_.texStorage2D(_.TEXTURE_2D,I,this.format,P,x),this.size=[P,x]}if(this.size)if(A)_.texSubImage2D(_.TEXTURE_2D,0,w,T,T2(this.format),A2(this.format),n);else{const I=n.data;I&&_.texSubImage2D(_.TEXTURE_2D,0,w,T,u,f,T2(this.format),A2(this.format),I)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(n,o,u=!1){const{context:f}=this,{gl:h}=f;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!u?n===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(n,o,u,f){const{context:h}=this,{gl:_}=h;_.bindTexture(_.TEXTURE_2D,this.texture),o!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o),this.magFilter=o),n!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?n===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),u!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),this.wrapS=u),f!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,f),this.wrapT=f)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class A1{constructor(n,o){this.context=n,this.texture=o}bind(n,o){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,n),this.minFilter=n),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrapS=o)}}function E1(c,n,o,u,f,h,_,w){const T=[c,n,1,o,u,1,f,h,1],P=[_,w,1],x=me.mat3.adjoint([],T),[A,I,C]=me.vec3.transformMat3(P,P,x);return me.mat3.multiply(T,T,[A,0,0,0,I,0,0,0,C])}function gP(c,n,o,u,f,h,_,w){const T=function(P,x,A,I,C,M,R,j){const $=E1(0,0,1,0,1,1,0,1),Y=E1(P,x,A,I,C,M,R,j),X=me.mat3.adjoint([],$);return me.mat3.multiply(Y,Y,X)}(c,n,o,u,f,h,_,w);return[T[2]/T[8]/un,T[5]/T[8]/un]}function C1(c){return[c[0],Math.min(Math.max(c[1],-ps),ps)]}class _P extends Ta{constructor(n,o,u,f){super(),this.id=n,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=o,this._dirty=!1}load(n,o){if(this._loaded=o||!1,this.fire(new bo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=dd(this.map._requestManager.transformRequest(this.url,gs.Image),(u,f)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Yc(u)):f&&(this.image=f instanceof HTMLImageElement?Lt.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new A1(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new bo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof A1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=n[0][1],u=n[0][1];for(const h of n)h[1]>u&&(u=h[1]),h[1]<o&&(o=h[1]);const f=(u+o)/2;if(f>ps?this.onNorthPole=!0:f<-ps&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=n.map(r.fromLngLat);this.tileID=function(_){let w=1/0,T=1/0,P=-1/0,x=-1/0;for(const R of _)w=Math.min(w,R.x),T=Math.min(T,R.y),P=Math.max(P,R.x),x=Math.max(x,R.y);const A=Math.max(P-w,x-T),I=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),C=Math.pow(2,I);let M=Math.floor((w+P)/2*C);return M>1&&(M-=1),new Xt(I,M,Math.floor((T+x)/2*C))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new bo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const $ in this.tiles){const Y=this.tiles[$];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=H0(new Xt(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const Y=$[1].x-$[0].x,X=$[1].y-$[0].y,Z=$[2].x-$[1].x,re=$[2].y-$[1].y,ae=$[3].x-$[2].x,ue=$[3].y-$[2].y,Ce=$[0].x-$[3].x,we=$[0].y-$[3].y,Se=Y*re-Z*X,He=Z*ue-ae*re,Pe=ae*we-Ce*ue,We=Ce*X-Y*we;return Se>0&&He>0&&Pe>0&&We>0||Se<0&&He<0&&Pe<0&&We<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=H0(this.tileID,this.map.transform.projection),[h,_,w,T]=this.coordinates.map($=>{const Y=f.projection.project($[0],$[1]);return rP(f,Y)._round()});this.perspectiveTransform=gP(h.x,h.y,_.x,_.y,w.x,w.y,T.x,T.y);const P=this._boundsArray=new Ml;P.emplaceBack(h.x,h.y,0,0),P.emplaceBack(_.x,_.y,un,0),P.emplaceBack(T.x,T.y,0,un),P.emplaceBack(w.x,w.y,un,un),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(P,S2.members),this.boundsSegments=qi.simpleSegment(0,0,4,2);const x=[],A=[C1((I=this.coordinates)[0]),C1(I[1]),C1(I[2]),C1(I[3])];var I;const[C,M,R,j]=function($){let Y=$[0][0],X=Y,Z=$[0][1],re=Z;for(let ae=1;ae<$.length;ae++)$[ae][0]<Y?Y=$[ae][0]:$[ae][0]>X&&(X=$[ae][0]),$[ae][1]<Z?Z=$[ae][1]:$[ae][1]>re&&(re=$[ae][1]);return[Y,Z,X-Y,re-Z]}(A);{const $=new Ml,[Y,X,Z,re]=function(ht){let bt=ht[0].x,gt=bt,At=ht[0].y,en=At;for(let Jt=1;Jt<ht.length;Jt++)ht[Jt].x<bt?bt=ht[Jt].x:ht[Jt].x>gt&&(gt=ht[Jt].x),ht[Jt].y<At?At=ht[Jt].y:ht[Jt].y>en&&(en=ht[Jt].y);return[bt,At,gt-bt,en-At]}(u),ae=ht=>[(ht.x-Y)/Z,(ht.y-X)/re],[ue,Ce,we,Se]=u.map(ae),He=function(ht,bt,gt,At,en,Jt,An,on){const hn=E1(0,0,1,0,1,1,0,1),rn=E1(ht,bt,gt,At,en,Jt,An,on),jn=me.mat3.adjoint([],rn);return me.mat3.multiply(hn,hn,jn)}(ue[0],ue[1],Ce[0],Ce[1],we[0],we[1],Se[0],Se[1]);this.elevatedGlobePerspectiveTransform=gP(ue[0],ue[1],Ce[0],Ce[1],we[0],we[1],Se[0],Se[1]);const Pe=(ht,bt)=>{x.push(ht.lng);const gt=Math.round((ht.lng-C)/R*un),At=Math.round((ht.lat-M)/j*un),en=ae(bt),Jt=me.vec3.transformMat3([],[en[0],en[1],1],He),An=Math.round(Jt[0]/Jt[2]*un),on=Math.round(Jt[1]/Jt[2]*un);$.emplaceBack(gt,At,An,on)},We=u[3].x-u[0].x,st=u[3].y-u[0].y,tt=u[2].x-u[1].x,ft=u[2].y-u[1].y;for(let ht=0;ht<65;ht++){const bt=ht/64,gt=[u[0].x+bt*We,u[0].y+bt*st],At=[u[1].x+bt*tt,u[1].y+bt*ft],en=At[0]-gt[0],Jt=At[1]-gt[1];for(let An=0;An<65;An++){const on=An/64,hn={x:gt[0]+en*on,y:gt[1]+Jt*on,z:0};Pe(o.projection.unproject(hn.x,hn.y),hn)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer($,S2.members)}{this.maxLongitudeTriangleSize=0;let $=[],Y=new Os;const X=(Z,re,ae)=>{Y.emplaceBack(Z,re,ae);const ue=x[Z],Ce=x[re],we=x[ae],Se=Math.min(Math.min(ue,Ce),we),He=Math.max(Math.max(ue,Ce),we)-Se;He>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=He),$.push(Se+He/2)};for(let Z=0;Z<64;Z++)for(let re=0;re<64;re++){const ae=65*Z+re,ue=ae+1,Ce=ae+65,we=Ce+1;X(ae,Ce,ue),X(ue,Ce,we)}[$,Y]=function(Z,re){const ae=Array.from({length:Z.length},(we,Se)=>Se);ae.sort((we,Se)=>Z[we]-Z[Se]);const ue=[],Ce=new Os;for(let we=0;we<ae.length;we++){const Se=ae[we];ue.push(Z[Se]);const He=3*Se,Pe=He+1;Ce.emplaceBack(re.uint16[He],re.uint16[Pe],re.uint16[Pe+1])}return[ue,Ce]}($,Y),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(Y)}this.elevatedGlobeSegments=qi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/un,0,j/un,0,0,M,C,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof A1||(this.texture?this.texture.update(this.image):(this.texture=new E2(o,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(o)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let f=(h=n+180)+360*Math.round((u[0]-h)/360);var h;const _=new qi,w=(A,I)=>{_.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:o.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-f)<=T){const A=$l(u,0,u.length,f+T);return A===u.length||w(A,Ii(u,A+1,u.length,f+360-T)-A),_}f<u[0]&&(f+=360);const P=Ii(u,0,u.length,f-T);if(P===u.length)return w(0,u.length),_;w(0,P-0);const x=$l(u,P+1,u.length,f+T);return x!==u.length&&w(x,u.length-x),_}}const Oj=(Math.pow(256,2)-1)/16907520;class yP extends Ys{constructor(n,o,u,f){super(n,{layout:pP||(pP=new Ir({visibility:new an(Tt.layout_raster.visibility)})),paint:mP||(mP=new Ir({"raster-opacity":new an(Tt.paint_raster["raster-opacity"]),"raster-color":new La(Tt.paint_raster["raster-color"]),"raster-color-mix":new an(Tt.paint_raster["raster-color-mix"]),"raster-color-range":new an(Tt.paint_raster["raster-color-range"]),"raster-hue-rotate":new an(Tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new an(Tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new an(Tt.paint_raster["raster-brightness-max"]),"raster-saturation":new an(Tt.paint_raster["raster-saturation"]),"raster-contrast":new an(Tt.paint_raster["raster-contrast"]),"raster-resampling":new an(Tt.paint_raster["raster-resampling"]),"raster-fade-duration":new an(Tt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new an(Tt.paint_raster["raster-emissive-strength"]),"raster-array-band":new an(Tt.paint_raster["raster-array-band"]),"raster-elevation":new an(Tt.paint_raster["raster-elevation"]),"raster-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},o,u,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof _P&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,f]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(f)||u===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=L0({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,f])}}let vP,xP,bP,wP,SP;class TP extends Ys{constructor(n,o,u,f){super(n,{layout:vP||(vP=new Ir({visibility:new an(Tt["layout_raster-particle"].visibility)})),paint:xP||(xP=new Ir({"raster-particle-array-band":new an(Tt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new an(Tt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new La(Tt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new an(Tt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new an(Tt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new an(Tt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new an(Tt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new an(Tt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},o,u,f),this._updateColorRamp(),this.lastInvalidatedAt=Lt.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=L0({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Lt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class zj extends Ys{constructor(n,o){super(n,{},o,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(n){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function C2(c,n,o){const u=[0,0,1],f=me.quat.identity([]);return me.quat.rotateY(f,f,o?-En(c)+Math.PI:En(c)),me.quat.rotateX(f,f,-En(n)),me.vec3.transformQuat(u,u,f),me.vec3.normalize(u,u)}function AP(c,n){const o=P1(c.projection,c.zoom,c.width,c.height),u=function(h,_,w,T,P){const x=new ni(w.lng-180*Uf,w.lat),A=new ni(w.lng+180*Uf,w.lat),I=h.project(x.lng,x.lat),C=h.project(A.lng,A.lat),M=-Math.atan2(C.y-I.y,C.x-I.x),R=r.fromLngLat(w);R.y=Ln(R.y,-1+Uf,1-Uf);const j=R.toLngLat(),$=h.project(j.lng,j.lat),Y=r.fromLngLat(j);Y.x+=Uf;const X=Y.toLngLat(),Z=h.project(X.lng,X.lat),re=CP(Z.x-$.x,Z.y-$.y,M),ae=r.fromLngLat(j);ae.y+=Uf;const ue=ae.toLngLat(),Ce=h.project(ue.lng,ue.lat),we=CP(Ce.x-$.x,Ce.y-$.y,M),Se=Math.abs(re.x)/Math.abs(we.y),He=me.mat4.identity([]);me.mat4.rotateZ(He,He,-M*(1-(P?0:T)));const Pe=me.mat4.identity([]);return me.mat4.scale(Pe,Pe,[1,1-(1-Se)*T,1]),Pe[4]=-we.x/we.y*T,me.mat4.rotateZ(Pe,Pe,M),me.mat4.multiply(Pe,He,Pe),Pe}(c.projection,0,c.center,o,n),f=EP(c);return me.mat4.scale(u,u,[f,f,1]),u}function EP(c){const n=c.projection,o=P1(c.projection,c.zoom,c.width,c.height),u=P2(n,c.center),f=P2(n,ni.convert(n.center));return Math.pow(2,u*o+(1-o)*f)}function P1(c,n,o,u,f=1/0){const h=c.range;if(!h)return 0;const _=Math.min(f,Math.max(o,u)),w=Math.log(_/1024)/Math.LN2;return br(h[0]+w,h[1]+w,n)}const Uf=1/4e4;function P2(c,n){const o=Ln(n.lat,-ps,ps),u=new ni(n.lng-180*Uf,o),f=new ni(n.lng+180*Uf,o),h=c.project(u.lng,o),_=c.project(f.lng,o),w=r.fromLngLat(u),T=r.fromLngLat(f),P=_.x-h.x,x=_.y-h.y,A=T.x-w.x,I=T.y-w.y,C=Math.sqrt((A*A+I*I)/(P*P+x*x));return Math.log(C)/Math.LN2}function CP(c,n,o){const u=Math.cos(o),f=Math.sin(o);return{x:c*u-n*f,y:c*f+n*u}}function PP(c,n,o){me.mat4.identity(c),me.mat4.rotateZ(c,c,En(n[2])),me.mat4.rotateX(c,c,En(n[0])),me.mat4.rotateY(c,c,En(n[1])),me.mat4.scale(c,c,o),me.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function M1(c,n,o,u,f,h,_,w){const T=[o[0]-n[0],o[1]-n[1],0],P=[u[0]-n[0],u[1]-n[1],0];if(me.vec3.length(T)<1e-12||me.vec3.length(P)<1e-12)return me.quat.identity(c);const x=me.vec3.cross([],T,P);me.vec3.normalize(x,x),me.vec3.subtract(P,u,n),T[2]=(h-f)*w,P[2]=(_-f)*w;const A=T;return me.vec3.cross(A,T,P),me.vec3.normalize(A,A),me.quat.rotationTo(c,x,A)}function M2(c,n,o=!1){const u=Ra(n.zoom),f=function(h,_,w){const T=_.worldSize,P=[h[12],h[13],h[14]],x=Po(P[1]/T),A=Qa(P[0]/T),I=me.mat4.identity([]),C=Vo(1,x)*T,M=Vo(1,0)*T*jh(x,_.zoom),R=1/uu(T);let j=M*R;if(w){const Z=P1(_.projection,_.zoom,_.width,_.height,1024);j=R*_.projection.pixelSpaceConversion(_.center.lat,T,Z)}const $=Ud(x,A);me.vec3.add($,$,me.vec3.scale([],me.vec3.normalize([],$),C*j*P[2]));const Y=function(Z){const re=[Z[0],Z[1],Z[2]];let ae=[0,1,0];const ue=me.vec3.cross([],ae,re);return me.vec3.cross(ae,re,ue),me.vec3.squaredLength(ae)===0&&(ae=[0,1,0],me.vec3.cross(ue,re,ae)),me.vec3.normalize(ue,ue),me.vec3.normalize(ae,ae),me.vec3.normalize(re,re),[ue[0],ue[1],ue[2],0,ae[0],ae[1],ae[2],0,re[0],re[1],re[2],0,Z[0],Z[1],Z[2],1]}($);me.mat4.scale(I,I,[j,j,j*C]),me.mat4.translate(I,I,[-P[0],-P[1],-P[2]]);const X=me.mat4.multiply([],_.globeMatrix,Y);return me.mat4.multiply(X,X,I),me.mat4.multiply(X,X,h),X}(c,n,o);if(u>0){const h=function(_,w){const T=w.worldSize,P=Vo(1,0)*T*jh(w.center.lat,w.zoom)/uu(T),x=Vo(1,w.center.lat)*T,A=me.mat4.identity([]);return me.mat4.rotateY(A,A,En(w.center.lng)),me.mat4.rotateX(A,A,En(w.center.lat)),me.mat4.translate(A,A,[0,0,ya]),me.mat4.scale(A,A,[P,P,P*x]),me.mat4.translate(A,A,[w.point.x-.5*T,w.point.y-.5*T,0]),me.mat4.multiply(A,A,_),me.mat4.multiply(A,w.globeMatrix,A)}(c,n);return function(_,w,T){const P=(M,R,j)=>{const $=me.vec3.length(M),Y=me.vec3.length(R),X=so(M,R,j);return me.vec3.scale(X,X,1/me.vec3.length(X)*Bn($,Y,j))},x=P([_[0],_[1],_[2]],[w[0],w[1],w[2]],T),A=P([_[4],_[5],_[6]],[w[4],w[5],w[6]],T),I=P([_[8],_[9],_[10]],[w[8],w[9],w[10]],T),C=so([_[12],_[13],_[14]],[w[12],w[13],w[14]],T);return[x[0],x[1],x[2],0,A[0],A[1],A[2],0,I[0],I[1],I[2],0,C[0],C[1],C[2],1]}(f,h,u)}return f}function MP(c,n,o,u){const f=Nn.projectAabbCorners(u,o);let h=Number.MAX_VALUE,_=-1;for(let P=0;P<f.length;++P){const x=f[P];x[0]=(.5*x[0]+.5)*n.width,x[1]=(.5-.5*x[1])*n.height,x[2]<h&&(_=P,h=x[2])}const w=P=>new $t(f[P][0],f[P][1]);let T;switch(_){case 0:case 6:T=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:T=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:T=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:T=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(ce(c,T))return h}const Fj=Or([{name:"a_pos_3f",components:3,type:"Float32"}]),Bj=Or([{name:"a_color_3f",components:3,type:"Float32"}]),jj=Or([{name:"a_color_4f",components:4,type:"Float32"}]),Uj=Or([{name:"a_uv_2f",components:2,type:"Float32"}]),Vj=Or([{name:"a_normal_3f",components:3,type:"Float32"}]),qj=Or([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),$j=Or([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),IP={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class I1{constructor(n,o,u,f){this.message=(n?`${n}: `:"")+u,f&&(this.identifier=f),o!=null&&o.__line__&&(this.line=o.__line__)}}function LP(c,n){const o=c.indexOf("://")===-1;try{return new URL(c,o&&n?"http://example.com":void 0),!0}catch{return!1}}class kP{constructor(n,o){this.feature=n,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class RP{constructor(){this.instancedDataArray=new Oh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class I2{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,o){}populate(n,o,u,f){this.tileToMeter=m(u);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:w,index:T,sourceLayerIndex:P}of n){const x=w??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),A=B(_,h);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom),A,u))continue;const I={id:x,sourceLayerIndex:P,index:T,geometry:h?A.geometry:F(_,u,f),properties:_.properties,type:_.type,patterns:{}},C=this.addFeature(I,I.geometry,A);C&&o.featureIndex.insert(_,I.geometry,T,P,this.index,this.instancesPerModel[C].instancedDataArray.length,un/32)}this.lookup=null}update(n,o,u,f){for(const h in this.instancesPerModel){const _=this.instancesPerModel[h];for(const w in n)_.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(_.features[_.idToFeaturesIndex[w]],n[w],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const f of u.features){const h=this.layers[0],_=f.feature,w=this.canonical,T=h.paint.get("model-rotation").evaluate(_,{},w),P=h.paint.get("model-scale").evaluate(_,{},w),x=h.paint.get("model-translation").evaluate(_,{},w);me.vec3.exactEquals(f.rotation,T)&&me.vec3.exactEquals(f.scale,P)&&me.vec3.exactEquals(f.translation,x)||(this.evaluate(f,f.featureStates,u,!0),n=!0)}}return n}updateReplacement(n,o,u,f){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(t2(this.activeReplacements,h))return!1;this.activeReplacements=h;let _=!1;for(const w in this.instancesPerModel){const T=this.instancesPerModel[w],P=T.instancedDataArray;for(const x of T.features){const A=x.instancedDataOffset,I=x.instancedDataCount;for(let C=0;C<I;C++){const M=16*(C+A);let R=P.float32[M+0];const j=R>un;R=j?R-un:R;const $=Math.floor(R),Y=P.float32[M+1];let X=!1;for(const Z of this.activeReplacements)if(!VE(Z,u,IP.Model,f)&&!(Z.min.x>$||$>Z.max.x||Z.min.y>Y||Y>Z.max.y)&&(X=ZE(WE($,Y,n.canonical,Z.footprintTileId.canonical),Z.footprint),X))break;P.float32[M]=X?R+un:R,_=_||X!==j}}}return _}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=n.createVertexBuffer(u.instancedDataArray,qj.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const o of this.modelUris)n.removeModel(o,"")}addFeature(n,o,u){const f=this.layers[0],h=f.layout.get("model-id").evaluate(u,{},this.canonical);if(!h)return pi(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),h;LP(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new RP);const _=this.instancesPerModel[h],w=_.instancedDataArray,T=new kP(u,w.length);for(const P of o)for(const x of P){if(x.x<0||x.x>=un||x.y<0||x.y>=un)continue;const A=(this.lookupDim-1)/un,I=this.lookupDim*(x.y*A|0)+x.x*A|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const C=w.length;w.resize(C+1),_.instancesEvaluatedElevation.push(0),w.float32[16*C]=x.x,w.float32[16*C+1]=x.y}return T.instancedDataCount=_.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(n.id&&(_.idToFeaturesIndex[n.id]=_.features.length),_.features.push(T),this.evaluate(T,{},_,!1)),h}getModelUris(){return this.modelUris}evaluate(n,o,u,f){const h=this.layers[0],_=n.feature,w=this.canonical,T=n.rotation=h.paint.get("model-rotation").evaluate(_,o,w),P=n.scale=h.paint.get("model-scale").evaluate(_,o,w),x=n.translation=h.paint.get("model-translation").evaluate(_,o,w),A=h.paint.get("model-color").evaluate(_,o,w);A.a=h.paint.get("model-color-mix-intensity").evaluate(_,o,w);const I=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),PP(I,T,P);const C=Math.round(100*A.a)+A.b/1.05;for(let M=0;M<n.instancedDataCount;++M){const R=n.instancedDataOffset+M,j=16*R,$=u.instancedDataArray.float32;let Y=0;f&&(Y=$[j+6]-u.instancesEvaluatedElevation[R]);const X=0|$[j+1];$[j]=(0|$[j])+A.r/1.05,$[j+1]=X+A.g/1.05,$[j+2]=C,$[j+3]=1/(w.z>10?this.tileToMeter:m(w,X)),$[j+4]=x[0],$[j+5]=x[1],$[j+6]=x[2]+Y,$[j+7]=I[0],$[j+8]=I[1],$[j+9]=I[2],$[j+10]=I[4],$[j+11]=I[5],$[j+12]=I[6],$[j+13]=I[8],$[j+14]=I[9],$[j+15]=I[10],u.instancesEvaluatedElevation[R]=x[2]}}}let DP,NP;Ze(I2,"ModelBucket",{omit:["layers"]}),Ze(RP,"PerModelAttributes"),Ze(kP,"ModelFeature");const Tm=64,zg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function OP(c,n,o,u,f,h,_,w,T,P=!1){const x=o.zoom,A=o.project(u),I=jh(u.lat,x),C=1/I;me.mat4.identity(c),me.mat4.translate(c,c,[A.x+_[0]*C,A.y+_[1]*C,_[2]]);let M=1,R=1;const j=o.worldSize;if(P){if(o.projection.name==="mercator"){let Z=0;o.elevation&&(Z=o.elevation.getAtPointOrZero(new r(A.x/j,A.y/j),0));const re=me.vec4.transformMat4([],[A.x,A.y,Z,1],o.projMatrix)[3]/o.cameraToCenterDistance;M=re,R=re*jh(o.center.lat,x)}else if(o.projection.name==="globe"){const Z=M2(c,o),re=me.mat4.multiply([],o.projMatrix,Z),ae=[0,0,0,1];me.vec4.transformMat4(ae,ae,re);const ue=ae[3]/o.cameraToCenterDistance,Ce=Ra(x),we=o.projection.pixelsPerMeter(u.lat,j)*jh(u.lat,x),Se=o.projection.pixelsPerMeter(o.center.lat,j)*jh(o.center.lat,x);M=ue/Bn(we,Qv(o.center.lat),Ce),R=ue*I/we,M*=Se,R*=Se}}else M=C;me.mat4.scale(c,c,[M,M,R]);const $=[...c],Y=n.orientation,X=[];if(PP(X,[Y[0]+f[0],Y[1]+f[1],Y[2]+f[2]],h),me.mat4.multiply(c,$,X),w&&o.elevation){let Z=0;const re=[];if(T&&o.elevation){Z=function(Ce,we,Se,He,Pe){const We=we.elevation;if(!We)return 0;const st=Nn.projectAabbCorners(Se,He),tt=Vo(1,Pe.lat)*we.worldSize,ft=function(jn,Sn){const kn=[0,0,1],Qn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const gr of Qn){const sr=jn[gr.corners[0]],Sr=jn[gr.corners[1]],fr=jn[gr.corners[2]],Er=[Sr[0]-sr[0],Sr[1]-sr[1],Sn*(Sr[2]-sr[2])],Jr=me.vec3.cross(Er,Er,[fr[0]-sr[0],fr[1]-sr[1],Sn*(fr[2]-sr[2])]);me.vec3.normalize(Jr,Jr),gr.dotProductWithUp=me.vec3.dot(Jr,kn)}return Qn.sort((gr,sr)=>gr.dotProductWithUp-sr.dotProductWithUp),Qn[0].corners}(st,tt),ht=st[ft[0]],bt=st[ft[1]],gt=st[ft[2]],At=st[ft[3]],en=We.getAtPointOrZero(new r(ht[0]/we.worldSize,ht[1]/we.worldSize),0),Jt=We.getAtPointOrZero(new r(bt[0]/we.worldSize,bt[1]/we.worldSize),0),An=We.getAtPointOrZero(new r(gt[0]/we.worldSize,gt[1]/we.worldSize),0),on=We.getAtPointOrZero(new r(At[0]/we.worldSize,At[1]/we.worldSize),0),hn=(en+on)/2,rn=(Jt+An)/2;return hn>rn?Jt<An?M1(Ce,bt,At,ht,Jt,on,en,tt):M1(Ce,gt,ht,At,An,en,on,tt):en<on?M1(Ce,ht,bt,gt,en,Jt,An,tt):M1(Ce,At,gt,bt,on,An,Jt,tt),Math.max(hn,rn)}(re,o,n.aabb,c,u);const ae=me.mat4.fromQuat([],re),ue=me.mat4.multiply([],ae,X);me.mat4.multiply(c,$,ue)}else Z=o.elevation.getAtPointOrZero(new r(A.x/j,A.y/j),0);Z!==0&&(c[14]+=Z)}}function Y0(c,n,o=!1){c.uploaded||(c.gfxTexture=new E2(n,c.image,o?n.gl.R8:n.gl.RGBA8,{useMipmap:c.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function Gj(c,n,o){c.indexBuffer=n.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=n.createVertexBuffer(c.vertexArray,Fj.members,!1,!0),c.normalArray&&(c.normalBuffer=n.createVertexBuffer(c.normalArray,Vj.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=n.createVertexBuffer(c.texcoordArray,Uj.members,!1,!0)),c.colorArray&&(c.colorBuffer=n.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?Bj:jj).members,!1,!0)),c.featureArray&&(c.pbrBuffer=n.createVertexBuffer(c.featureArray,$j.members,!0)),c.segments=qi.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const u=c.material;u.pbrMetallicRoughness.baseColorTexture&&Y0(u.pbrMetallicRoughness.baseColorTexture,n),u.pbrMetallicRoughness.metallicRoughnessTexture&&Y0(u.pbrMetallicRoughness.metallicRoughnessTexture,n),u.normalTexture&&Y0(u.normalTexture,n),u.occlusionTexture&&Y0(u.occlusionTexture,n,o),u.emissionTexture&&Y0(u.emissionTexture,n)}function L2(c,n,o){if(c.meshes)for(const u of c.meshes)Gj(u,n,o);if(c.children)for(const u of c.children)L2(u,n,o)}function L1(c){if(c.meshes)for(const n of c.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(c.children)for(const n of c.children)L1(n)}function k2(c){if(c.meshes)for(const o of c.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((n=o.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(c.children)for(const o of c.children)k2(o)}class Fg{constructor(n,o,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(n,o,u){const f=u||n.findDEMTileFor(o);if(!f||!f.dem)return;const h=f.dem,_=f.tileID,w=1<<o.canonical.z-_.canonical.z;return new Fg(f,h.dim/un/w,[(o.canonical.x/w-_.canonical.x)*h.dim,(o.canonical.y/w-_.canonical.y)*h.dim])}tileCoordToPixel(n,o){const u=o*this._scale+this._offset[1],f=Math.floor(n*this._scale+this._offset[0]),h=Math.floor(u);return new $t(f,h)}getElevationAt(n,o,u,f){const h=n*this._scale+this._offset[0],_=o*this._scale+this._offset[1],w=Math.floor(h),T=Math.floor(_),P=this._dem;return f=!!f,u?Bn(Bn(P.get(w,T,f),P.get(w,T+1,f),_-T),Bn(P.get(w+1,T,f),P.get(w+1,T+1,f),_-T),h-w):P.get(w,T,f)}getElevationAtPixel(n,o,u){return this._dem.get(n,o,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Vo(1,n)*this._dem.stride}}const R2=new Float32Array(262144),Am=new Uint8Array(262144);function zP(c){let n=0;if(c.meshes)for(const o of c.meshes)n=Math.max(n,o.aabb.max[2]);if(c.children)for(const o of c.children)n=Math.max(n,zP(o));return n}function FP(c,n,o){if(c.meshes)for(const u of c.meshes){if(u.aabb.min[0]===1/0)continue;const f=Nn.applyTransform(u.aabb,c.matrix);o.insert(n,f.min[0],f.min[1],f.max[0],f.max[1])}if(c.children)for(const u of c.children)FP(u,n,o)}const BP=["","wall","door","roof","window","lamp","logo"];class jP{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:zP(n)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const o=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==n&&(u.transformedAabb=Nn.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),n++;this.aabb=o}return this.aabb}}class k1{constructor(n,o,u,f,h,_,w){this.id=u,this.layers=n,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=zg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=zg.HasMapboxMeshFeatures),h&&(this.modelTraits|=zg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of o)this.nodesInfo.push(new jP(T)),FP(T,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(n,o){for(const u of this.getNodesInfo()){const f=u.node;f.footprint&&o.push({footprint:f.footprint,id:n})}}update(n){const o=Object.keys(n).length!==0;if(o&&!this.stateDependentLayers.length)return;const u=o?this.stateDependentLayers:this.layers;if(!cn(n,this.states))for(const f of u)this.evaluate(f,n);this.states=structuredClone(n)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const f=u.node;this.uploaded?this.updatePbrBuffer(f):L2(f,n,!0)}for(const u of o)L1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let o=!1;if(!n.meshes)return o;for(const u of n.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(n,o,u){const f=n.transform.projectionOptions,h=n.style.getBrightness(),_=this.brightness!==h;if(!this.uploaded||this.dirty||f.name!==this.projection.name||J0(u.paint.get("model-color").value,_)||J0(u.paint.get("model-color-mix-intensity").value,_)||J0(u.paint.get("model-roughness").value,_)||J0(u.paint.get("model-emissive-strength").value,_)||J0(u.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=f,this.brightness=h;const w=this.getNodesInfo();for(const T of w)T.state=null;return!0}return!1}evaluateScale(n,o){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const u=this.getNodesInfo(),f=this.id.canonical;for(const h of u){const _=h.feature;h.evaluatedScale=o.paint.get("model-scale").evaluate(_,{},f)}}evaluate(n,o){const u=this.getNodesInfo();for(const f of u){if(!f.node.meshes)continue;const h=f.feature,_=o&&o[h.id];if(cn(_,f.state))continue;f.state=structuredClone(_);const w=f.node.meshes&&f.node.meshes[0].featureData,T=f.evaluatedColor[2],P=f.evaluatedRMEA[2],x=this.id.canonical;if(f.hasTranslucentParts=!1,w){for(let A=0;A<BP.length;A++){const I=BP[A];I.length&&(h.properties.part=I);const C=n.paint.get("model-color").evaluate(h,_,x).toRenderColor(null),M=n.paint.get("model-color-mix-intensity").evaluate(h,_,x);f.evaluatedColor[A]=[C.r,C.g,C.b,M],f.evaluatedRMEA[A][0]=n.paint.get("model-roughness").evaluate(h,_,x),f.evaluatedRMEA[A][2]=n.paint.get("model-emissive-strength").evaluate(h,_,x),f.evaluatedRMEA[A][3]=C.a,f.emissionHeightBasedParams[A]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,_,x),!f.hasTranslucentParts&&C.a<1&&(f.hasTranslucentParts=!0)}delete h.properties.part,Wj(f,T!==f.evaluatedColor[2]||P!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(h,_,x);f.evaluatedScale=n.paint.get("model-scale").evaluate(h,_,x),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,o,u,f){const h=n.findDEMTileFor(u);if(h&&(h.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const _=Fg.create(n,u,h);if(!_)return;this.modelTraits&zg.HasMapboxMeshFeatures&&this.updateDEM(n,_,u,f);for(const w of this.getNodesInfo()){const T=w.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const P=T.footprint.vertices;let x=_.getElevationAt(P[0].x,P[0].y,!0,!0);for(let A=1;A<P.length;A++)x=Math.min(x,_.getElevationAt(P[A].x,P[A].y,!0,!0));T.elevation=x}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=o}}updateDEM(n,o,u,f){let h=o._dem._modifiedForSources[f];if(h===void 0&&(o._dem._modifiedForSources[f]=[],h=o._dem._modifiedForSources[f]),h.includes(u.canonical))return;const _=o._dem.dim;h.push(u.canonical);let w=!1;for(const T of this.getNodesInfo()){const P=T.node;if(!P.footprint||!P.footprint.grid)continue;const x=P.footprint.grid,A=o.tileCoordToPixel(x.min.x,x.min.y),I=o.tileCoordToPixel(x.max.x,x.max.y),C=Math.min(Math.min(_-I.y,A.x),Math.min(A.y,_-I.x));if(C<0)continue;const M=Ln(C,2,5);let R=Math.max(0,A.x-M),j=Math.max(0,A.y-M),$=Math.min(I.x+M,_-1),Y=Math.min(I.y+M,_-1);for(let ae=j;ae<=Y;++ae)for(let ue=R;ue<=$;++ue)Am[ae*_+ue]=255;let X=0,Z=0;for(let ae=0;ae<x.cellsY;++ae)for(let ue=0;ue<x.cellsX;++ue){if(!x.cells[ae*x.cellsX+ue])continue;const Ce=o.tileCoordToPixel(x.min.x+ue/x.xScale,x.min.y+ae/x.yScale),we=o.tileCoordToPixel(x.min.x+(ue+1)/x.xScale,x.min.y+(ae+1)/x.yScale);for(let Se=Ce.y;Se<=Math.min(we.y+1,_-1);++Se)for(let He=Ce.x;He<=Math.min(we.x+1,_-1);++He)Am[Se*_+He]===255&&(Am[Se*_+He]=0,X+=o.getElevationAtPixel(He,Se),Z++)}const re=X/Z;R=Math.max(1,A.x-M),j=Math.max(1,A.y-M),$=Math.min(I.x+M,_-2),Y=Math.min(I.y+M,_-2),w=!0;for(let ae=j;ae<=Y;++ae)for(let ue=R;ue<=$;++ue)Am[ae*_+ue]===0&&(R2[ae*_+ue]=o._dem.set(ue,ae,re));for(let ae=1;ae<M;++ae){R=Math.max(1,A.x-ae),j=Math.max(1,A.y-ae),$=Math.min(I.x+ae,_-2),Y=Math.min(I.y+ae,_-2);for(let ue=j;ue<=Y;++ue)for(let Ce=R;Ce<=$;++Ce){const we=ue*_+Ce;if(Am[we]===255){let Se=0,He=0,Pe=-1,We=-1;for(let st=-1;st<=1;++st)for(let tt=-1;tt<=1;++tt){const ft=(ue+st)*_+Ce+tt;if(Am[ft]>=ae)continue;const ht=R2[ft],bt=Math.abs(ht);bt>He&&(Se=ht,He=bt,Pe=tt,We=st)}if(He>.1){const st=1-(ae+.5*Math.abs(Pe*We))/M;let tt=o._dem.get(Ce,ue)+Se*st;const ft=o._dem.get(Ce+Pe,ue+We),ht=o._dem.get(Ce-Pe,ue-We,!0);(tt-ft)*(tt-ht)>0&&(tt=(ft+ht)/2),R2[we]=o._dem.set(Ce,ue,tt),Am[we]=ae}}}}}w&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Lt.now())}setFilter(n){this.filter=n?Bu(n):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(n=>this.filter.filter(new Nr(this.id.overscaledZ),n.feature,this.id.canonical)):this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const o of n)L1(o.node),k2(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped()),f=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const _=f[h].node;f[h].hiddenByReplacement=!!_.footprint&&!u.find(w=>w.footprint===_.footprint)}}getHeightAtTileCoord(n,o){const u=this.getNodesInfo(),f=[],h=[0,0,0],_=me.mat4.identity([]);for(let w=0;w<this.nodesInfo.length;w++){const T=u[w],P=T.node.meshes[0],x=P.transformedAabb;if(n<x.min[0]||o<x.min[1]||n>x.max[0]||o>x.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};me.mat4.invert(_,T.node.matrix),h[0]=n,h[1]=o,me.vec3.transformMat4(h,h,_);const A=(h[0]-P.aabb.min[0])/(P.aabb.max[0]-P.aabb.min[0])*Tm|0,I=Math.min(63,(h[1]-P.aabb.min[1])/(P.aabb.max[1]-P.aabb.min[1])*Tm|0)*Tm+Math.min(63,A),C=P.heightmap[I];if(!(C<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:C,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new $t(n,o),new $t(n,o),f),f.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function J0(c,n){return!c.isLightConstant&&n}function Hj(c,n,o,u,f,h,_,w){let T=(61440&n|(61440&n)>>4)>>8,P=(3840&n|(3840&n)>>4)>>4,x=240&n|(240&n)>>4;o[3]>0&&(T=Bn(T,255*o[0],o[3]),P=Bn(P,255*o[1],o[3]),x=Bn(x,255*o[2],o[3]));const A=T<<8|P,I=x<<8|Math.floor(255*u[3]),C=function(ae){const ue=Ln(ae,0,2);return Math.min(Math.round(.5*ue*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],M=Ln(f[0],0,1),R=Ln(f[1],0,1),j=Ln(f[2],0,1),$=Ln(f[3],0,1);let Y,X,Z,re;if(M!==R&&_!==h&&R!==M){const ae=_-h;X=1/(ae*(R-M)),Z=-(h+ae*M)/(ae*(R-M));const ue=Ln(f[4],-1,1);re=Math.pow(10,ue),Y=255*j<<8|255*$}else Y=65535,X=0,Z=1,re=1;if(c.emplaceBack(A,I,C,Y,X,Z,re),w){const ae=w.length;w.clear();for(let ue=0;ue<ae;ue++)w.emplaceBack(A,I,C,Y,X,Z,re)}}function Wj(c,n,o){const u=c.node;let f=0;const h=o&zg.HasMeshoptCompression;for(const _ of u.meshes){if(u.lights&&u.lightMeshIndex===f||!_.featureData)continue;_.featureArray=new Sg,_.featureArray.reserve(_.featureData.length);let w=n;for(const T of _.featureData){const P=h?65535&T:T>>16&65535,x=h?T>>16&65535:65535&T,A=(15&x)<8?15&x:0,I=c.evaluatedRMEA[A],C=c.evaluatedColor[A],M=c.emissionHeightBasedParams[A];let R;if(w&&A===2&&u.lights&&(R=new Sg,R.resize(10*u.lights.length)),Hj(_.featureArray,P,C,I,M,_.aabb.min[2],_.aabb.max[2],R),R&&w){w=!1;const j=u.meshes[u.lightMeshIndex];j.featureArray=R,j.featureArray._trim()}}_.featureArray._trim(),f++}}function UP(c,n,o,u){const f=1<<c.z;n.lat=Po((u/un+c.y)/f),n.lng=Qa((o/un+c.x)/f)}Ze(k1,"Tiled3dModelBucket",{omit:["layers"]}),Ze(jP,"Tiled3dModelFeature");const Zj={circle:class extends Ys{constructor(c,n,o,u){super(c,{layout:vt||(vt=new Ir({"circle-sort-key":new vn(Tt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new an(Tt.layout_circle["circle-elevation-reference"]),visibility:new an(Tt.layout_circle.visibility)})),paint:Ht||(Ht=new Ir({"circle-radius":new vn(Tt.paint_circle["circle-radius"]),"circle-color":new vn(Tt.paint_circle["circle-color"]),"circle-blur":new vn(Tt.paint_circle["circle-blur"]),"circle-opacity":new vn(Tt.paint_circle["circle-opacity"]),"circle-translate":new an(Tt.paint_circle["circle-translate"]),"circle-translate-anchor":new an(Tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new an(Tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new an(Tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vn(Tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vn(Tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vn(Tt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new an(Tt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u)}createBucket(c){return new ee(c)}queryRadius(c){const n=c;return xt("circle-radius",this,n)+xt("circle-stroke-width",this,n)+Zt(this.paint.get("circle-translate"))}queryIntersectsFeature(c,n,o,u,f,h,_,w){const T=ln(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return Mg(c,u,h,_,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,n,o){const u=Df(this);return{config:new jd(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}},heatmap:class extends Ys{createBucket(c){return new hE(c)}constructor(c,n,o,u){super(c,{layout:dE||(dE=new Ir({visibility:new an(Tt.layout_heatmap.visibility)})),paint:fE||(fE=new Ir({"heatmap-radius":new vn(Tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vn(Tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new an(Tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new La(Tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new an(Tt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=L0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return xt("heatmap-radius",this,c)}queryIntersectsFeature(c,n,o,u,f,h,_,w){const T=this.paint.get("heatmap-radius").evaluate(n,o);return Mg(c,u,h,_,w,!0,!0,new $t(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,n,o){return c==="heatmap"?{config:new jd(this,{zoom:n,lut:o}),overrideFog:!1}:{}}},hillshade:class extends Ys{constructor(c,n,o,u){super(c,{layout:pE||(pE=new Ir({visibility:new an(Tt.layout_hillshade.visibility)})),paint:mE||(mE=new Ir({"hillshade-illumination-direction":new an(Tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new an(Tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new an(Tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new an(Tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new an(Tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new an(Tt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new an(Tt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,n,o){return{overrideFog:!1}}},fill:class extends Ys{constructor(c,n,o,u){super(c,{layout:DE||(DE=new Ir({"fill-sort-key":new vn(Tt.layout_fill["fill-sort-key"]),visibility:new an(Tt.layout_fill.visibility),"fill-elevation-reference":new an(Tt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new vn(Tt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:NE||(NE=new Ir({"fill-antialias":new an(Tt.paint_fill["fill-antialias"]),"fill-opacity":new vn(Tt.paint_fill["fill-opacity"]),"fill-color":new vn(Tt.paint_fill["fill-color"]),"fill-outline-color":new vn(Tt.paint_fill["fill-outline-color"]),"fill-translate":new an(Tt.paint_fill["fill-translate"]),"fill-translate-anchor":new an(Tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new vn(Tt.paint_fill["fill-pattern"]),"fill-emissive-strength":new an(Tt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new vn(Tt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new vn(Tt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new vn(Tt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u)}getProgramIds(){const c=this.paint.get("fill-pattern"),n=c&&c.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(c,n,o){return{config:new jd(this,{zoom:n,lut:o}),overrideFog:!1}}recalculate(c,n){super.recalculate(c,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Jw(c)}queryRadius(){return Zt(this.paint.get("fill-translate"))}queryIntersectsFeature(c,n,o,u,f,h){return!c.queryGeometry.isAboveHorizon&&fe(Kt(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const n=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?n&&!c:n}},"fill-extrusion":class extends Ys{constructor(c,n,o,u){super(c,{layout:cC||(cC=new Ir({visibility:new an(Tt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new an(Tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:uC||(uC=new Ir({"fill-extrusion-opacity":new an(Tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vn(Tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new an(Tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new an(Tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vn(Tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vn(Tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vn(Tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new an(Tt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new an(Tt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new an(Tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new an(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new an(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new an(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new an(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new an(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new an(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new an(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new vn(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new vn(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new an(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new an(Tt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new an(Tt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new an(Tt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new vn(Tt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new vn(Tt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new an(Tt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new c1(c)}queryRadius(){return Zt(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,n,o,u,f,h,_,w,T){const P=ln(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(n,o),A=this.paint.get("fill-extrusion-base").evaluate(n,o),I=[0,0],C=w&&h.elevation,M=h.elevation?h.elevation.exaggeration():1,R=c.tile.getBucket(this);if(C&&R instanceof c1){const Z=R.centroidVertexArray,re=T+1;re<Z.length&&(I[0]=Z.geta_centroid_pos0(re),I[1]=Z.geta_centroid_pos1(re))}if(I[0]===0&&I[1]===1)return!1;h.projection.name==="globe"&&(u=lC([u],[new $t(0,0),new $t(un,un)],c.tileID.canonical).map(Z=>Z.polygon).flat());const j=C?w:null,[$,Y]=function(Z,re,ae,ue,Ce,we,Se,He,Pe,We,st){return Z.projection.name==="globe"?function(tt,ft,ht,bt,gt,At,en,Jt,An,on,hn){const rn=[],jn=[],Sn=tt.projection.upVectorScale(hn,tt.center.lat,tt.worldSize).metersToTile,kn=[0,0,0,1],Qn=[0,0,0,1],gr=(Sr,fr,Er,Jr)=>{Sr[0]=fr,Sr[1]=Er,Sr[2]=Jr,Sr[3]=1},sr=aC();ht>0&&(ht+=sr),bt+=sr;for(const Sr of ft){const fr=[],Er=[];for(const Jr of Sr){const Ei=Jr.x+gt.x,tr=Jr.y+gt.y,kr=tt.projection.projectTilePoint(Ei,tr,hn),Fi=tt.projection.upVector(hn,Jr.x,Jr.y);let Ki=ht,ts=bt;if(en){const is=dC(Ei,tr,ht,bt,en,Jt,An,on);Ki+=is.base,ts+=is.top}ht!==0?gr(kn,kr.x+Fi[0]*Sn*Ki,kr.y+Fi[1]*Sn*Ki,kr.z+Fi[2]*Sn*Ki):gr(kn,kr.x,kr.y,kr.z),gr(Qn,kr.x+Fi[0]*Sn*ts,kr.y+Fi[1]*Sn*ts,kr.z+Fi[2]*Sn*ts),me.vec3.transformMat4(kn,kn,At),me.vec3.transformMat4(Qn,Qn,At),fr.push(new Sm(kn[0],kn[1],kn[2])),Er.push(new Sm(Qn[0],Qn[1],Qn[2]))}rn.push(fr),jn.push(Er)}return[rn,jn]}(Z,re,ae,ue,Ce,we,Se,He,Pe,We,st):Se?function(tt,ft,ht,bt,gt,At,en,Jt,An){const on=[],hn=[],rn=[0,0,0,1];for(const jn of tt){const Sn=[],kn=[];for(const Qn of jn){const gr=Qn.x+bt.x,sr=Qn.y+bt.y,Sr=dC(gr,sr,ft,ht,At,en,Jt,An);rn[0]=gr,rn[1]=sr,rn[2]=Sr.base,rn[3]=1,me.vec4.transformMat4(rn,rn,gt),rn[3]=Math.max(rn[3],1e-5);const fr=new Sm(rn[0]/rn[3],rn[1]/rn[3],rn[2]/rn[3]);rn[0]=gr,rn[1]=sr,rn[2]=Sr.top,rn[3]=1,me.vec4.transformMat4(rn,rn,gt),rn[3]=Math.max(rn[3],1e-5);const Er=new Sm(rn[0]/rn[3],rn[1]/rn[3],rn[2]/rn[3]);Sn.push(fr),kn.push(Er)}on.push(Sn),hn.push(kn)}return[on,hn]}(re,ae,ue,Ce,we,Se,He,Pe,We):function(tt,ft,ht,bt,gt){const At=[],en=[],Jt=gt[8]*ft,An=gt[9]*ft,on=gt[10]*ft,hn=gt[11]*ft,rn=gt[8]*ht,jn=gt[9]*ht,Sn=gt[10]*ht,kn=gt[11]*ht;for(const Qn of tt){const gr=[],sr=[];for(const Sr of Qn){const fr=Sr.x+bt.x,Er=Sr.y+bt.y,Jr=gt[0]*fr+gt[4]*Er+gt[12],Ei=gt[1]*fr+gt[5]*Er+gt[13],tr=gt[2]*fr+gt[6]*Er+gt[14],kr=gt[3]*fr+gt[7]*Er+gt[15],Fi=Jr+Jt,Ki=Ei+An,ts=tr+on,is=Math.max(kr+hn,1e-5),bi=Jr+rn,ao=Ei+jn,Da=tr+Sn,Is=Math.max(kr+kn,1e-5);gr.push(new Sm(Fi/is,Ki/is,ts/is)),sr.push(new Sm(bi/Is,ao/Is,Da/Is))}At.push(gr),en.push(sr)}return[At,en]}(re,ae,ue,Ce,we)}(h,u,A,x,P,_,j,I,M,h.center.lat,c.tileID.canonical),X=c.queryGeometry;return function(Z,re,ae){let ue=1/0;fe(ae,re)&&(ue=hC(ae,re[0]));for(let Ce=0;Ce<re.length;Ce++){const we=re[Ce],Se=Z[Ce];for(let He=0;He<we.length-1;He++){const Pe=we[He],We=[Pe,we[He+1],Se[He+1],Se[He],Pe];ce(ae,We)&&(ue=Math.min(ue,hC(ae,We)))}}return ue!==1/0&&ue}($,Y,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Ys{constructor(c,n,o,u){const f=wC();super(c,f,n,o,u),f.layout&&(this.layout=new _a(f.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,n){super.recalculate(c,n),this.paint._values["line-floorwidth"]=(()=>{if(j0)return j0;const o=wC();return j0=new KB(o.paint.properties["line-width"].specification),j0.useIntegerZoom=!0,j0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new s2(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,n,o){const u=xC(this);return{config:new jd(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}queryRadius(c){const n=c,o=SC(xt("line-width",this,n),xt("line-gap-width",this,n)),u=xt("line-offset",this,n);return o/2+Math.abs(u)+Zt(this.paint.get("line-translate"))}queryIntersectsFeature(c,n,o,u,f,h){if(c.queryGeometry.isAboveHorizon)return!1;const _=Kt(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),w=c.pixelToTileUnitsFactor/2*SC(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),T=this.paint.get("line-offset").evaluate(n,o);return T&&(u=function(P,x){const A=[],I=new $t(0,0);for(let C=0;C<P.length;C++){const M=P[C],R=[];for(let j=0;j<M.length;j++){const $=M[j],Y=M[j+1],X=j===0?I:$.sub(M[j-1])._unit()._perp(),Z=j===M.length-1?I:Y.sub($)._unit()._perp(),re=X._add(Z)._unit();re._mult(1/(re.x*Z.x+re.y*Z.y)),R.push(re._mult(x)._add($))}A.push(R)}return A}(u,T*c.pixelToTileUnitsFactor)),function(P,x,A){for(let I=0;I<x.length;I++){const C=x[I];if(P.length>=3){for(let M=0;M<C.length;M++)if(je(P,C[M]))return!0}if(pe(P,C,A))return!0}return!1}(_,u,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets}},symbol:T1,background:class extends Ys{constructor(c,n,o,u){super(c,{layout:dP||(dP=new Ir({visibility:new an(Tt.layout_background.visibility)})),paint:fP||(fP=new Ir({"background-pitch-alignment":new an(Tt.paint_background["background-pitch-alignment"]),"background-color":new an(Tt.paint_background["background-color"]),"background-pattern":new an(Tt.paint_background["background-pattern"]),"background-opacity":new an(Tt.paint_background["background-opacity"]),"background-emissive-strength":new an(Tt.paint_background["background-emissive-strength"]),"background-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,n,o){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:yP,"raster-particle":TP,sky:class extends Ys{constructor(c,n,o,u){super(c,{layout:bP||(bP=new Ir({visibility:new an(Tt.layout_sky.visibility)})),paint:wP||(wP=new Ir({"sky-type":new an(Tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new an(Tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new an(Tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new an(Tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new an(Tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new La(Tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new an(Tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new an(Tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new an(Tt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=L0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(c,n){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),f=!u,h=c.style.light,_=h.properties.get("position");return f&&h.properties.get("anchor")==="viewport"&&pi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?C2(_.azimuthal,90-_.polar,n):C2(u[0],90-u[1],n)}const o=this.paint.get("sky-gradient-center");return C2(o[0],90-o[1],n)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends Ys{constructor(c,n,o,u){super(c,{paint:SP||(SP=new Ir({}))},n,null)}},model:class extends Ys{constructor(c,n,o,u){super(c,{layout:DP||(DP=new Ir({visibility:new an(Tt.layout_model.visibility),"model-id":new vn(Tt.layout_model["model-id"])})),paint:NP||(NP=new Ir({"model-opacity":new vn(Tt.paint_model["model-opacity"]),"model-rotation":new vn(Tt.paint_model["model-rotation"]),"model-scale":new vn(Tt.paint_model["model-scale"]),"model-translation":new vn(Tt.paint_model["model-translation"]),"model-color":new vn(Tt.paint_model["model-color"]),"model-color-mix-intensity":new vn(Tt.paint_model["model-color-mix-intensity"]),"model-type":new an(Tt.paint_model["model-type"]),"model-cast-shadows":new an(Tt.paint_model["model-cast-shadows"]),"model-receive-shadows":new an(Tt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new an(Tt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new vn(Tt.paint_model["model-emissive-strength"]),"model-roughness":new vn(Tt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new vn(Tt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new an(Tt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new an(Tt.paint_model["model-front-cutoff"]),"model-color-use-theme":new vn({type:"string",default:"default","property-type":"data-driven"})}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new I2(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof k1?un-1:0}queryIntersectsFeature(c,n,o,u,f,h){if(!this.modelManager)return!1;const _=this.modelManager,w=c.tile.getBucket(this);if(!(w&&w instanceof I2))return!1;for(const T in w.instancesPerModel){const P=w.instancesPerModel[T],x=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(P.idToFeaturesIndex.hasOwnProperty(x)){const A=P.features[P.idToFeaturesIndex[x]],I=_.getModel(T,this.scope);if(!I)return!1;let C=me.mat4.create();const M=new ni(0,0),R=w.canonical;let j=Number.MAX_VALUE;for(let $=0;$<A.instancedDataCount;++$){const Y=16*(A.instancedDataOffset+$),X=P.instancedDataArray.float32,Z=[X[Y+4],X[Y+5],X[Y+6]];UP(R,M,X[Y],0|X[Y+1]),OP(C,I,h,M,A.rotation,A.scale,Z,!1,!1,!1),h.projection.name==="globe"&&(C=M2(C,h));const re=me.mat4.multiply([],h.projMatrix,C),ae=c.queryGeometry,ue=MP(ae.isPointQuery()?ae.screenBounds:ae.screenGeometry,h,re,I.aabb);ue!=null&&(j=Math.min(ue,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(c,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const n=this._transitionablePaint._values[c];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof q}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ys{constructor(c,n,o,u){super(c,{layout:OE||(OE=new Ir({"clip-layer-types":new an(Tt.layout_clip["clip-layer-types"]),"clip-layer-scope":new an(Tt.layout_clip["clip-layer-scope"])})),paint:zE||(zE=new Ir({}))},n,o,u)}recalculate(c,n){super.recalculate(c,n)}createBucket(c){return new FE(c)}is3D(c){return!0}}};class Kj{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Xj{constructor(){this.tasks={},this.taskQueue=[],Hs(["process"],this),this.invoker=new Kj(this.process),this.nextId=0}add(n,o){const u=this.nextId++,f=function({type:h,isSymbolTile:_,zoom:w}){return w=w||0,h==="message"?0:h!=="maybePrepare"||_?h!=="parseTile"||_?h==="parseTile"&&_?300-w:h==="maybePrepare"&&_?400-w:500:200-w:100-w}(o);if(f===0){try{n()}finally{}return null}return this.tasks[u]={fn:n,metadata:o,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let f=0;f<this.taskQueue.length;f++){const h=this.tasks[this.taskQueue[f]];h.priority<o&&(o=h.priority,n=f)}if(n===null)return null;const u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}class VP{constructor(n,o,u){this.target=n,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Hs(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Xj}send(n,o,u,f,h=!1,_){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=_,this.callbacks[w]=u);const T=new Set;return this.target.postMessage({id:w,type:n,hasCallback:!!u,targetMapId:f,mustQueue:h,sourceMapId:this.mapId,data:qt(o,T)},T),{cancel:()=>{u&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(n){const o=n.data;if(!o)return;const u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f.cancel()}else if(o.mustQueue||as()){const f=this.callbacks[u],h=this.scheduler.add(()=>this.processTask(u,o),f&&f.metadata||{type:"message"});h&&(this.cancelCallbacks[u]=h)}else this.processTask(u,o)}processTask(n,o){if(delete this.cancelCallbacks[n],o.type==="<response>"){const u=this.callbacks[n];delete this.callbacks[n],u&&(o.error?u(mn(o.error)):u(null,mn(o.data)))}else{const u=new Set,f=o.hasCallback?(_,w)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:_?qt(_):null,data:qt(w,u)},u)}:()=>{},h=mn(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,h,f);else if(this.parent.getWorkerSource){const _=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,_[0],h.source,h.scope)[_[1]](h,f)}else f(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Q0={workerUrl:"",workerClass:null,workerParams:void 0};const D2="mapboxgl_preloaded_worker_pool";class Em{constructor(){this.active={}}acquire(n,o=Em.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;)this.workers.push(Q0.workerClass!=null?new Q0.workerClass:new self.Worker(Q0.workerUrl,Q0.workerParams));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[D2]}numActive(){return Object.keys(this.active).length}}Em.workerCount=2;class Bg{constructor(n,o,u="Worker",f=Em.workerCount){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Ur();const h=this.workerPool.acquire(this.id,f);for(let _=0;_<h.length;_++){const w=new Bg.Actor(h[_],o,this.id);w.name=`${u} ${_}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,u){hi(this.actors,(f,h)=>{f.send(n,o,h)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ey,N2;function R1(){return ey||(ey=new Em),ey}Bg.Actor=VP;const O2=new qr(0,0,0);var z2=(c=>(c[c.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",c[c.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",c[c.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",c))(z2||{}),D1=(c=>(c[c.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",c[c.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",c[c.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",c[c.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",c))(D1||{}),ty=(c=>(c[c.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",c[c.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",c[c.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",c[c.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",c[c.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",c))(ty||{}),qP=(c=>(c[c.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",c[c.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",c[c.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",c))(qP||{}),jg=(c=>(c[c.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",c[c.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",c[c.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",c[c.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",c[c.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",c[c.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",c))(jg||{}),$P=(c=>(c[c.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",c[c.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",c[c.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",c))($P||{});function Yj(c,n,o){c===1&&n.icons.push(function(u,f){return function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:_}=h;if(_.content_area){const{content_area:w}=_;w.top==null&&(w.top=w.left),w.width==null&&(w.width=h.usvg_tree.width),w.height==null&&(w.height=w.width)}return _.stretch_x&&_.stretch_x.length&&GP(_,"x"),_.stretch_y&&_.stretch_y.length&&GP(_,"y"),h}(u.readFields(Jj,{name:void 0},f))}(o,o.readVarint()+o.pos))}function GP(c,n){const o=[],u=c[`stretch_${n}`];let f=null;for(let h=0;h<u.length;h++)f===null?f=o.length===0?u[0]:o[o.length-1][1]+u[h]:(o.push([f,f+u[h]]),f=null);c[`stretch_${n}_areas`]=o}function Jj(c,n,o){c===1?n.name=o.readString():c===2?n.metadata=function(u,f){return u.readFields(Qj,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)}(o,o.readVarint()+o.pos):c===3&&(n.usvg_tree=function(u,f){return u.readFields(n8,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)}(o,o.readVarint()+o.pos),n.data="usvg_tree")}function Qj(c,n,o){c===1?n.stretch_x=o.readPackedVarint():c===2?n.stretch_y=o.readPackedVarint():c===3?n.content_area=function(u,f){return u.readFields(e8,{left:0},f)}(o,o.readVarint()+o.pos):c===4&&n.variables.push(function(u,f){return u.readFields(t8,{name:void 0},f)}(o,o.readVarint()+o.pos))}function e8(c,n,o){c===1?n.left=o.readVarint():c===2?n.width=o.readVarint():c===3?n.top=o.readVarint():c===4&&(n.height=o.readVarint())}function t8(c,n,o){c===1?n.name=o.readString():c===2&&(n.rgb_color=z1(o.readVarint()),n.value="rgb_color")}function n8(c,n,o){c===1?n.width=n.height=o.readVarint():c===2?n.height=o.readVarint():c===3?n.children.push(N1(o,o.readVarint()+o.pos)):c===4?n.linear_gradients.push(function(u,f){return u.readFields(c8,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)}(o,o.readVarint()+o.pos)):c===5?n.radial_gradients.push(function(u,f){return u.readFields(h8,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)}(o,o.readVarint()+o.pos)):c===7?n.clip_paths.push(function(u,f){return u.readFields(d8,{children:[]},f)}(o,o.readVarint()+o.pos)):c===8&&n.masks.push(function(u,f){const h=u.readFields(f8,{left:0,width:20,mask_type:1,children:[]},f);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h}(o,o.readVarint()+o.pos))}function N1(c,n){return c.readFields(r8,{},n)}function r8(c,n,o){c===1?(n.group=function(u,f){return u.readFields(i8,{opacity:255,children:[]},f)}(o,o.readVarint()+o.pos),n.node="group"):c===2&&(n.path=function(u,f){return u.readFields(o8,{paint_order:1,commands:[],step:1,diffs:[],rule:1},f)}(o,o.readVarint()+o.pos),n.node="path")}function i8(c,n,o){c===1?n.transform=O1(o,o.readVarint()+o.pos):c===2?n.opacity=o.readVarint():c===5?n.clip_path_idx=o.readVarint():c===6?n.mask_idx=o.readVarint():c===7&&n.children.push(N1(o,o.readVarint()+o.pos))}function O1(c,n){return c.readFields(s8,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},n)}function s8(c,n,o){c===1?n.sx=o.readFloat():c===2?n.ky=o.readFloat():c===3?n.kx=o.readFloat():c===4?n.sy=o.readFloat():c===5?n.tx=o.readFloat():c===6&&(n.ty=o.readFloat())}function o8(c,n,o){c===1?n.fill=function(u,f){return u.readFields(a8,{rgb_color:O2,paint:"rgb_color",opacity:255},f)}(o,o.readVarint()+o.pos):c===2?n.stroke=function(u,f){return u.readFields(l8,{rgb_color:O2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)}(o,o.readVarint()+o.pos):c===3?n.paint_order=o.readVarint():c===5?o.readPackedVarint(n.commands):c===6?n.step=o.readFloat():c===7?o.readPackedSVarint(n.diffs):c===8&&(n.rule=o.readVarint())}function a8(c,n,o){c===1?(n.rgb_color=z1(o.readVarint()),n.paint="rgb_color"):c===2?(n.linear_gradient_idx=o.readVarint(),n.paint="linear_gradient_idx"):c===3?(n.radial_gradient_idx=o.readVarint(),n.paint="radial_gradient_idx"):c===5&&(n.opacity=o.readVarint())}function z1(c){return new qr((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function l8(c,n,o){c===1?(n.rgb_color=z1(o.readVarint()),n.paint="rgb_color"):c===2?(n.linear_gradient_idx=o.readVarint(),n.paint="linear_gradient_idx"):c===3?(n.radial_gradient_idx=o.readVarint(),n.paint="radial_gradient_idx"):c===5?o.readPackedFloat(n.dasharray):c===6?n.dashoffset=o.readFloat():c===7?n.miterlimit=o.readFloat():c===8?n.opacity=o.readVarint():c===9?n.width=o.readFloat():c===10?n.linecap=o.readVarint():c===11&&(n.linejoin=o.readVarint())}function c8(c,n,o){c===1?n.transform=O1(o,o.readVarint()+o.pos):c===2?n.spread_method=o.readVarint():c===3?n.stops.push(HP(o,o.readVarint()+o.pos)):c===4?n.x1=o.readFloat():c===5?n.y1=o.readFloat():c===6?n.x2=o.readFloat():c===7&&(n.y2=o.readFloat())}function HP(c,n){return c.readFields(u8,{offset:0,opacity:255,rgb_color:O2},n)}function u8(c,n,o){c===1?n.offset=o.readFloat():c===2?n.opacity=o.readVarint():c===3&&(n.rgb_color=z1(o.readVarint()))}function h8(c,n,o){c===1?n.transform=O1(o,o.readVarint()+o.pos):c===2?n.spread_method=o.readVarint():c===3?n.stops.push(HP(o,o.readVarint()+o.pos)):c===4?n.cx=o.readFloat():c===5?n.cy=o.readFloat():c===6?n.r=o.readFloat():c===7?n.fx=o.readFloat():c===8?n.fy=o.readFloat():c===9&&(n.fr=o.readFloat())}function d8(c,n,o){c===1?n.transform=O1(o,o.readVarint()+o.pos):c===2?n.clip_path_idx=o.readVarint():c===3&&n.children.push(N1(o,o.readVarint()+o.pos))}function f8(c,n,o){c===1?n.left=n.top=o.readFloat():c===2?n.width=n.height=o.readFloat():c===3?n.top=o.readFloat():c===4?n.height=o.readFloat():c===5?n.mask_type=o.readVarint():c===6?n.mask_idx=o.readVarint():c===7&&n.children.push(N1(o,o.readVarint()+o.pos))}class p8{static calculate(n={},o=[]){const u=new Map,f=new Map;if(Object.keys(n).length===0)return u;o.forEach(h=>{f.set(h.name,h.rgb_color||new qr(0,0,0))});for(const[h,_]of Object.entries(n))f.has(h)?u.set(f.get(h).toStringPremultipliedAlpha(),_):console.warn(`Ignoring unknown image variable "${h}"`);return u}}function Ug(c,n=255,o){const u=n/255,f=c.toStringPremultipliedAlpha(),h=o.has(f)?o.get(f).clone():c.clone();return h.a*=u,h.toString()}function ny(c,n){if(!Nt()){const o=document.createElement("canvas");return o.width=c,o.height=n,o}return new OffscreenCanvas(c,n)}function m8(c,n){const o=p8.calculate(n.params,c.metadata?c.metadata.variables:[]),u=c.usvg_tree,f=u.width,h=u.height,_=n.transform?n.transform:new DOMMatrix,w=Math.max(1,Math.round(f*_.a)),T=Math.max(1,Math.round(h*_.d)),P=new DOMMatrix([w/f,0,0,T/h,0,0]),x=ny(w,T).getContext("2d");return F2(x,P,u,u,o),x.getImageData(0,0,w,T)}function F2(c,n,o,u,f){for(const h of u.children)WP(c,n,o,h,f)}function WP(c,n,o,u,f){u.group?(c.save(),function(h,_,w,T,P){const x=T.mask_idx!=null?w.masks[T.mask_idx]:null,A=T.clip_path_idx!=null?w.clip_paths[T.clip_path_idx]:null;if(T.transform&&(_=F1(T.transform).preMultiplySelf(_)),!function(M,R,j){return M.opacity!==255||R||j}(T,A!=null,x!=null))return void F2(h,_,w,T,P);const I=ny(h.canvas.width,h.canvas.height),C=I.getContext("2d");F2(C,_,w,T,P),A&&eM(C,_,w,A),x&&tM(C,_,w,x,P),h.globalAlpha=T.opacity/255,h.drawImage(I,0,0)}(c,n,o,u.group,f),c.restore()):u.path&&(c.save(),function(h,_,w,T,P){const x=nM(T);h.setTransform(_),T.paint_order===qP.PAINT_ORDER_FILL_AND_STROKE?(ZP(h,w,T,x,P),XP(h,w,T,x,P)):(XP(h,w,T,x,P),ZP(h,w,T,x,P))}(c,n,o,u.path,f),c.restore())}function ZP(c,n,o,u,f){const h=o.fill;if(!h)return;const _=h.opacity/255;switch(h.paint){case"rgb_color":c.fillStyle=Ug(h.rgb_color,h.opacity,f);break;case"linear_gradient_idx":c.fillStyle=YP(c,n.linear_gradients[h.linear_gradient_idx],_,f);break;case"radial_gradient_idx":c.fillStyle=JP(c,n.radial_gradients[h.radial_gradient_idx],_,f)}c.fill(u,KP(o))}function KP(c){return c.rule===z2.PATH_RULE_NON_ZERO?"nonzero":c.rule===z2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function XP(c,n,o,u,f){const h=o.stroke;if(!h)return;c.lineWidth=h.width,c.miterLimit=h.miterlimit,c.setLineDash(h.dasharray),c.lineDashOffset=h.dashoffset;const _=h.opacity/255;switch(h.paint){case"rgb_color":c.strokeStyle=Ug(h.rgb_color,h.opacity,f);break;case"linear_gradient_idx":c.strokeStyle=YP(c,n.linear_gradients[h.linear_gradient_idx],_,f);break;case"radial_gradient_idx":c.strokeStyle=JP(c,n.radial_gradients[h.radial_gradient_idx],_,f)}switch(h.linejoin){case ty.LINE_JOIN_MITER_CLIP:case ty.LINE_JOIN_MITER:c.lineJoin="miter";break;case ty.LINE_JOIN_ROUND:c.lineJoin="round";break;case ty.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(h.linecap){case D1.LINE_CAP_BUTT:c.lineCap="butt";break;case D1.LINE_CAP_ROUND:c.lineCap="round";break;case D1.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(u)}function YP(c,n,o,u){if(n.stops.length===1){const I=n.stops[0];return Ug(I.rgb_color,I.opacity*o,u)}const f=F1(n.transform),{x1:h,y1:_,x2:w,y2:T}=n,P=f.transformPoint(new DOMPoint(h,_)),x=f.transformPoint(new DOMPoint(w,T)),A=c.createLinearGradient(P.x,P.y,x.x,x.y);for(const I of n.stops)A.addColorStop(I.offset,Ug(I.rgb_color,I.opacity*o,u));return A}function JP(c,n,o,u){if(n.stops.length===1){const I=n.stops[0];return Ug(I.rgb_color,I.opacity*o,u)}const f=F1(n.transform),{fx:h,fy:_,cx:w,cy:T}=n,P=f.transformPoint(new DOMPoint(h,_)),x=f.transformPoint(new DOMPoint(w,T)),A=c.createRadialGradient(P.x,P.y,0,x.x,x.y,n.r*((f.a+f.d)/2));for(const I of n.stops)A.addColorStop(I.offset,Ug(I.rgb_color,I.opacity*o,u));return A}function QP(c,n,o,u){const f=u.transform?F1(u.transform).preMultiplySelf(n):n,h=ny(c.canvas.width,c.canvas.height),_=h.getContext("2d");for(const T of u.children)if(T.group)QP(_,f,o,T.group);else if(T.path){const P=T.path,x=new Path2D;x.addPath(nM(P),f),_.fill(x,KP(P))}const w=u.clip_path_idx!=null?o.clip_paths[u.clip_path_idx]:null;w&&eM(_,f,o,w),c.globalCompositeOperation="source-over",c.drawImage(h,0,0)}function eM(c,n,o,u){const f=ny(c.canvas.width,c.canvas.height);QP(f.getContext("2d"),n,o,u),c.globalCompositeOperation="destination-in",c.drawImage(f,0,0)}function tM(c,n,o,u,f){if(u.children.length===0)return;const h=u.mask_idx!=null?o.masks[u.mask_idx]:null;h&&tM(c,n,o,h,f);const _=c.canvas.width,w=c.canvas.height,T=ny(_,w),P=T.getContext("2d"),x=u.width,A=u.height,I=u.left,C=u.top,M=new Path2D,R=new Path2D;R.rect(I,C,x,A),M.addPath(R,n),P.clip(M);for(const Y of u.children)WP(P,n,o,Y,f);const j=P.getImageData(0,0,_,w),$=j.data;if(u.mask_type===$P.MASK_TYPE_LUMINANCE)for(let Y=0;Y<$.length;Y+=4)$[Y+3]=$[Y+3]/255*(.2126*$[Y]+.7152*$[Y+1]+.0722*$[Y+2]);P.putImageData(j,0,0),c.globalCompositeOperation="destination-in",c.drawImage(T,0,0)}function F1(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function nM(c){const n=new Path2D,o=c.step;let u=c.diffs[0]*o,f=c.diffs[1]*o;n.moveTo(u,f);for(let h=0,_=2;h<c.commands.length;h++)switch(c.commands[h]){case jg.PATH_COMMAND_MOVE:u+=c.diffs[_++]*o,f+=c.diffs[_++]*o,n.moveTo(u,f);break;case jg.PATH_COMMAND_LINE:u+=c.diffs[_++]*o,f+=c.diffs[_++]*o,n.lineTo(u,f);break;case jg.PATH_COMMAND_QUAD:{const w=u+c.diffs[_++]*o,T=f+c.diffs[_++]*o;u=w+c.diffs[_++]*o,f=T+c.diffs[_++]*o,n.quadraticCurveTo(w,T,u,f);break}case jg.PATH_COMMAND_CUBIC:{const w=u+c.diffs[_++]*o,T=f+c.diffs[_++]*o,P=w+c.diffs[_++]*o,x=T+c.diffs[_++]*o;u=P+c.diffs[_++]*o,f=x+c.diffs[_++]*o,n.bezierCurveTo(w,T,P,x,u,f);break}case jg.PATH_COMMAND_CLOSE:n.closePath()}return n}class B1{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const o=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,o),o}put(n,o){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,o)}delete(n){this.cache.delete(n)}}Ze(B1,"LRUCache");class B2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(n){return new qo(n,n.data)}getFromCache(n,o,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new B1(150)),this.cacheMap.get(u).get(Lh(n.toString(),o))}setInCache(n,o,u,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new B1(150));const h=this.cacheDependenciesMap.get(f),_=Lh(n.id.toString(),u);h.get(_)||h.set(_,new Set);const w=this.cacheMap.get(f),T=n.toString();h.get(_).add(T),w.put(Lh(n.toString(),u),o)}removeImagesFromCacheByIds(n,o,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const f=this.cacheMap.get(u),h=this.cacheDependenciesMap.get(u);for(const _ of n){const w=Lh(_.toString(),o);if(h.has(w)){for(const T of h.get(w))f.delete(T);h.delete(w)}}}rasterize(n,o,u,f,h=m8){const _=this.getFromCache(n,u,f);if(_)return _.clone();const w=h(o.icon,n.options),T=B2._getImage(w);return this.setInCache(n,T,u,f),T.clone()}}class rM{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const u=this.toIdx(n,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function iM(c,n,o,u){let f=0,h=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(u[_])<1e-15){if(o[_]<c[_]||o[_]>n[_])return null}else{const w=1/u[_];let T=(c[_]-o[_])*w,P=(n[_]-o[_])*w;if(T>P){const x=T;T=P,P=x}if(T>f&&(f=T),P<h&&(h=P),f>h)return null}return f}function sM(c,n,o,u,f,h,_,w,T,P,x){const A=u-c,I=f-n,C=h-o,M=_-c,R=w-n,j=T-o,$=x[1]*j-x[2]*R,Y=x[2]*M-x[0]*j,X=x[0]*R-x[1]*M,Z=A*$+I*Y+C*X;if(Math.abs(Z)<1e-15)return null;const re=1/Z,ae=P[0]-c,ue=P[1]-n,Ce=P[2]-o,we=(ae*$+ue*Y+Ce*X)*re;if(we<0||we>1)return null;const Se=ue*C-Ce*I,He=Ce*A-ae*C,Pe=ae*I-ue*A,We=(x[0]*Se+x[1]*He+x[2]*Pe)*re;return We<0||we+We>1?null:(M*Se+R*He+j*Pe)*re}function oM(c,n,o){return(c-n)/(o-n)}function aM(c,n,o,u,f,h,_,w,T){const P=1<<o,x=h-u,A=_-f,I=(c+1)/P*x+u,C=(n+0)/P*A+f,M=(n+1)/P*A+f;w[0]=(c+0)/P*x+u,w[1]=C,T[0]=I,T[1]=M}class lM{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(h){const _=Math.ceil(Math.log2(h.dim/8)),w=[];let T=Math.ceil(Math.pow(2,_));const P=1/T,x=(C,M,R,j,$)=>{const Y=j?1:0,X=(C+1)*R-Y,Z=M*R,re=(M+1)*R-Y;$[0]=C*R,$[1]=Z,$[2]=X,$[3]=re};let A=new rM(T);const I=[];for(let C=0;C<T*T;C++){x(C%T,Math.floor(C/T),P,!1,I);const M=Vf(I[0],I[1],h),R=Vf(I[2],I[1],h),j=Vf(I[2],I[3],h),$=Vf(I[0],I[3],h);A.minimums.push(Math.min(M,R,j,$)),A.maximums.push(Math.max(M,R,j,$)),A.leaves.push(1)}for(w.push(A),T/=2;T>=1;T/=2){const C=w[w.length-1];A=new rM(T);for(let M=0;M<T*T;M++){x(M%T,Math.floor(M/T),2,!0,I);const R=C.getElevation(I[0],I[1]),j=C.getElevation(I[2],I[1]),$=C.getElevation(I[2],I[3]),Y=C.getElevation(I[0],I[3]),X=C.isLeaf(I[0],I[1]),Z=C.isLeaf(I[2],I[1]),re=C.isLeaf(I[2],I[3]),ae=C.isLeaf(I[0],I[3]),ue=Math.min(R.min,j.min,$.min,Y.min),Ce=Math.max(R.max,j.max,$.max,Y.max),we=X&&Z&&re&&ae;A.maximums.push(Ce),A.minimums.push(ue),A.leaves.push(Ce-ue<=5&&we?1:0)}w.push(A)}return w}(this.dem),u=o.length-1,f=o[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(n,o,u,f,h,_,w=1){return iM([n,o,-100],[u,f,this.maximums[0]*w],h,_)}raycast(n,o,u,f,h,_,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(n,o,u,f,h,_,w);if(T==null)return null;const P=[],x=[],A=[],I=[],C=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;C.length>0;){const{idx:M,t:R,nodex:j,nodey:$,depth:Y}=C.pop();if(this.leaves[M]){aM(j,$,Y,n,o,u,f,A,I);const Z=1<<Y,re=(j+0)/Z,ae=(j+1)/Z,ue=($+0)/Z,Ce=($+1)/Z,we=Vf(re,ue,this.dem)*w,Se=Vf(ae,ue,this.dem)*w,He=Vf(ae,Ce,this.dem)*w,Pe=Vf(re,Ce,this.dem)*w,We=sM(A[0],A[1],we,I[0],A[1],Se,I[0],I[1],He,h,_),st=sM(I[0],I[1],He,A[0],I[1],Pe,A[0],A[1],we,h,_),tt=Math.min(We!==null?We:Number.MAX_VALUE,st!==null?st:Number.MAX_VALUE);if(tt!==Number.MAX_VALUE)return tt;{const ft=me.vec3.scaleAndAdd([],h,_,R);if(cM(we,Se,Pe,He,oM(ft[0],A[0],I[0]),oM(ft[1],A[1],I[1]))>=ft[2])return R}continue}let X=0;for(let Z=0;Z<this._siblingOffset.length;Z++){aM((j<<1)+this._siblingOffset[Z][0],($<<1)+this._siblingOffset[Z][1],Y+1,n,o,u,f,A,I),A[2]=-100,I[2]=this.maximums[this.childOffsets[M]+Z]*w;const re=iM(A,I,h,_);if(re!=null){const ae=re;P[Z]=ae;let ue=!1;for(let Ce=0;Ce<X&&!ue;Ce++)ae>=P[x[Ce]]&&(x.splice(Ce,0,Z),ue=!0);ue||(x[X]=Z),X++}}for(let Z=0;Z<X;Z++){const re=x[Z];C.push({idx:this.childOffsets[M]+re,t:P[re],nodex:(j<<1)+this._siblingOffset[re][0],nodey:($<<1)+this._siblingOffset[re][1],depth:Y+1})}}return null}_addNode(n,o,u){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,u,f,h){if(n[f].isLeaf(o,u)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const _=f-1,w=n[_];let T=0,P=0;for(let x=0;x<this._siblingOffset.length;x++){const A=2*o+this._siblingOffset[x][0],I=2*u+this._siblingOffset[x][1],C=w.getElevation(A,I),M=w.isLeaf(A,I),R=this._addNode(C.min,C.max,M);M&&(T|=1<<x),P||(P=R)}for(let x=0;x<this._siblingOffset.length;x++)T&1<<x||this._construct(n,2*o+this._siblingOffset[x][0],2*u+this._siblingOffset[x][1],_,P+x)}}function cM(c,n,o,u,f,h){return Bn(Bn(c,o,h),Bn(n,u,h),f)}function Vf(c,n,o){const u=o.dim,f=Ln(c*u-.5,0,u-1),h=Ln(n*u-.5,0,u-1),_=Math.floor(f),w=Math.floor(h),T=Math.min(_+1,u-1),P=Math.min(w+1,u-1);return cM(o.get(_,w),o.get(T,w),o.get(_,P),o.get(T,P),f-_,h-w)}const g8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function _8(c,n,o){return(256*c*256+256*n+o)/10-1e4}function y8(c,n,o){return 256*c+n+o/256-32768}class j1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,u,f=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void pi(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const h=this.dim=o.height-2,_=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let T=0;T<h;T++)_[this._idx(-1,T)]=_[this._idx(0,T)],_[this._idx(h,T)]=_[this._idx(h-1,T)],_[this._idx(T,-1)]=_[this._idx(T,0)],_[this._idx(T,h)]=_[this._idx(T,h-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(h,-1)]=_[this._idx(h-1,0)],_[this._idx(-1,h)]=_[this._idx(0,h-1)],_[this._idx(h,h)]=_[this._idx(h-1,h-1)]}const w=u==="terrarium"?y8:_8;for(let T=0;T<_.length;++T){const P=4*T;this.floatView[T]=w(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=Lt.now()}_buildQuadTree(){this._tree=new lM(this)}get(n,o,u=!1){u&&(n=Ln(n,-1,this.dim),o=Ln(o,-1,this.dim));const f=this._idx(n,o);return this.floatView[f]}set(n,o,u){const f=this._idx(n,o),h=this.floatView[f];return this.floatView[f]=u,u-h}static getUnpackVector(n){return g8[n]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const u=[0,0,0,0],f=j1.getUnpackVector(o);let h=Math.floor((n+f[3])/f[2]);return u[2]=h%256,h=Math.floor(h/256),u[1]=h%256,h=Math.floor(h/256),u[0]=h,u}getPixels(){return new yE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let f=o*this.dim,h=o*this.dim+this.dim,_=u*this.dim,w=u*this.dim+this.dim;switch(o){case-1:f=h-1;break;case 1:h=f+1}switch(u){case-1:_=w-1;break;case 1:w=_+1}const T=-o*this.dim,P=-u*this.dim;for(let x=_;x<w;x++)for(let A=f;A<h;A++){const I=4*this._idx(A,x),C=4*this._idx(A+T,x+P);this.pixels[I+0]=n.pixels[C+0],this.pixels[I+1]=n.pixels[C+1],this.pixels[I+2]=n.pixels[C+2],this.pixels[I+3]=n.pixels[C+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function v8(c,n,o){c===1?n.headerLength=o.readFixed32():c===2?n.x=o.readVarint():c===3?n.y=o.readVarint():c===4?n.z=o.readVarint():c===5&&n.layers.push(function(u,f){return u.readFields(T8,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(o,o.readVarint()+o.pos))}function x8(c,n,o){c===1?(n.delta_filter=function(u,f){return u.readFields(b8,{blockSize:0},f)}(o,o.readVarint()+o.pos),n.filter="delta_filter"):c===2?(o.readVarint(),n.filter="zigzag_filter"):c===3?(o.readVarint(),n.filter="bitshuffle_filter"):c===4&&(o.readVarint(),n.filter="byteshuffle_filter")}function b8(c,n,o){c===1&&(n.blockSize=o.readVarint())}function w8(c,n,o){c===1?(o.readVarint(),n.codec="gzip_data"):c===2?(o.readVarint(),n.codec="jpeg_image"):c===3?(o.readVarint(),n.codec="webp_image"):c===4&&(o.readVarint(),n.codec="png_image")}function S8(c,n,o){let u=0,f=0;c===1?n.firstByte=o.readFixed64():c===2?n.lastByte=o.readFixed64():c===3?n.filters.push(function(h,_){return h.readFields(x8,{},_)}(o,o.readVarint()+o.pos)):c===4?n.codec=function(h,_){return h.readFields(w8,{},_)}(o,o.readVarint()+o.pos):c===5?f=o.readFloat():c===6?u=o.readFloat():c===7?n.bands.push(o.readString()):c===8?n.offset=o.readDouble():c===9&&(n.scale=o.readDouble()),n.offset===0&&(n.offset=f),n.scale===0&&(n.scale=u)}function T8(c,n,o){c===1?n.version=o.readVarint():c===2?n.name=o.readString():c===3?n.units=o.readString():c===4?n.tileSize=o.readVarint():c===5?n.buffer=o.readVarint():c===6?n.pixelFormat=o.readVarint():c===7&&n.dataIndex.push(function(u,f){return u.readFields(S8,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(o,o.readVarint()+o.pos))}function A8(c,n,o){if(c===2)(function(u,f,h){u.readFields(E8,h,f)})(o,o.readVarint()+o.pos,n);else if(c===3)throw new Error("Not implemented")}function E8(c,n,o){if(c===1){let u=0;const f=o.readVarint()+o.pos;for(;o.pos<f;)n[u++]=o.readVarint()}}function C8(c,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let o=n[3];for(let u=2;u>=1;u--){const f=u===1?1:0,h=u===2?1:0;for(let _=0;_<n[0];_++){const w=n[1]*_;for(let T=f;T<n[1];T++){const P=n[2]*(T+w);for(let x=h;x<n[2];x++){const A=n[3]*(x+P);for(let I=0;I<n[3];I++){const C=A+I;c[C]+=c[C-o]}}}}o*=n[u]}return c}function P8(c){for(let n=0,o=c.length;n<o;n++)c[n]=c[n]>>>1^-(1&c[n]);return c}function M8(c,n){switch(n){case"uint32":return c;case"uint16":for(let o=0;o<c.length;o+=2){const u=c[o],f=c[o+1];c[o]=(240&u)>>4|(61440&u)>>8|(240&f)<<4|61440&f,c[o+1]=15&u|(3840&u)>>4|(15&f)<<8|(3840&f)<<4}return c;case"uint8":for(let o=0;o<c.length;o+=4){const u=c[o],f=c[o+1],h=c[o+2],_=c[o+3];c[o+0]=(192&u)>>6|(192&f)>>4|(192&h)>>2|192&_,c[o+1]=(48&u)>>4|(48&f)>>2|48&h|(48&_)<<2,c[o+2]=(12&u)>>2|12&f|(12&h)<<2|(12&_)<<4,c[o+3]=3&u|(3&f)<<2|(3&h)<<4|(3&_)<<6}return c;default:throw new Error(`Invalid pixel format, "${n}"`)}}Ze(j1,"DEMData"),Ze(lM,"DemMinMaxQuadTree",{omit:["dem"]});var Dc=Uint8Array,ry=Uint16Array,I8=Int32Array,uM=new Dc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hM=new Dc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),L8=new Dc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dM=function(c,n){for(var o=new ry(31),u=0;u<31;++u)o[u]=n+=1<<c[u-1];var f=new I8(o[30]);for(u=1;u<30;++u)for(var h=o[u];h<o[u+1];++h)f[h]=h-o[u]<<5|u;return{b:o,r:f}},fM=dM(uM,2),pM=fM.b,k8=fM.r;pM[28]=258,k8[258]=28;for(var R8=dM(hM,0).b,mM=new ry(32768),Fs=0;Fs<32768;++Fs){var Vg=(43690&Fs)>>1|(21845&Fs)<<1;mM[Fs]=((65280&(Vg=(61680&(Vg=(52428&Vg)>>2|(13107&Vg)<<2))>>4|(3855&Vg)<<4))>>8|(255&Vg)<<8)>>1}var iy=function(c,n,o){for(var u=c.length,f=0,h=new ry(n);f<u;++f)c[f]&&++h[c[f]-1];var _,w=new ry(n);for(f=1;f<n;++f)w[f]=w[f-1]+h[f-1]<<1;_=new ry(1<<n);var T=15-n;for(f=0;f<u;++f)if(c[f])for(var P=f<<4|c[f],x=n-c[f],A=w[c[f]-1]++<<x,I=A|(1<<x)-1;A<=I;++A)_[mM[A]>>T]=P;return _},sy=new Dc(288);for(Fs=0;Fs<144;++Fs)sy[Fs]=8;for(Fs=144;Fs<256;++Fs)sy[Fs]=9;for(Fs=256;Fs<280;++Fs)sy[Fs]=7;for(Fs=280;Fs<288;++Fs)sy[Fs]=8;var gM=new Dc(32);for(Fs=0;Fs<32;++Fs)gM[Fs]=5;var D8=iy(sy,9),N8=iy(gM,5),j2=function(c){for(var n=c[0],o=1;o<c.length;++o)c[o]>n&&(n=c[o]);return n},Ku=function(c,n,o){var u=n/8|0;return(c[u]|c[u+1]<<8)>>(7&n)&o},U2=function(c,n){var o=n/8|0;return(c[o]|c[o+1]<<8|c[o+2]<<16)>>(7&n)},O8=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Xu=function(c,n,o){var u=new Error(n||O8[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,Xu),!o)throw u;return u},z8=new Dc(0),F8=typeof TextDecoder<"u"&&new TextDecoder;try{F8.decode(z8,{stream:!0})}catch{}const B8={gzip_data:"gzip"};class du extends Error{constructor(n){super(n),this.name="MRTError"}}const j8={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},_M={uint32:1,uint16:2,uint8:4},U8={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let V2;class U1{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const o=this.layers[n];if(!o)throw new du(`Layer '${n}' not found`);return o}getHeaderLength(n){const o=new Uint8Array(n),u=new DataView(n);if(o[0]!==13)throw new du("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(n){const o=new Uint8Array(n),u=this.getHeaderLength(n);if(o.length<u)throw new du(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const f=function(h,_){return h.readFields(v8,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new V2(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new du(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const h of f.layers)this.layers[h.name]=new yM(h,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const o=[],u=this.getLayer(n.layerName);for(let f of n.blockIndices){const h=u.dataIndex[f],_=h.firstByte-n.firstByte,w=h.lastByte-n.firstByte;if(u._blocksInProgress.has(f))continue;const T={layerName:u.name,firstByte:_,lastByte:w,pixelFormat:u.pixelFormat,blockIndex:f,blockShape:[h.bands.length].concat(u.bandShape),buffer:u.buffer,codec:h.codec.codec,filters:h.filters.map(P=>P.filter)};u._blocksInProgress.add(f),o.push(T)}return new vM(o,()=>{o.forEach(f=>u._blocksInProgress.delete(f.blockIndex))},(f,h)=>{if(o.forEach(_=>u._blocksInProgress.delete(_.blockIndex)),f)throw f;h.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class yM{constructor({version:n,name:o,units:u,tileSize:f,pixelFormat:h,buffer:_,dataIndex:w},T){if(this.version=n,this.version!==1)throw new du(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=o,this.units=u,this.tileSize=f,this.buffer=_,this.pixelFormat=j8[h],this.dataIndex=w,this.bandShape=[f+2*_,f+2*_,_M[this.pixelFormat]],this._decodedBlocks=new B1(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return _M[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const o=n.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,n.data)}getBlockForBand(n){let o=0;switch(typeof n){case"string":for(const[u,f]of this.dataIndex.entries()){for(const[h,_]of f.bands.entries())if(_===n)return{bandIndex:o+h,blockIndex:u,blockBandIndex:h};o+=f.bands.length}break;case"number":for(const[u,f]of this.dataIndex.entries()){if(n>=o&&n<o+f.bands.length)return{bandIndex:n,blockIndex:u,blockBandIndex:n-o};o+=f.bands.length}break;default:throw new du(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new du(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let o=1/0,u=-1/0;const f=[],h=new Set;for(const _ of n){const{blockIndex:w}=this.getBlockForBand(_);if(w<0)throw new du(`Invalid band: ${JSON.stringify(_)}`);const T=this.dataIndex[w];f.includes(w)||f.push(w),h.add(w),o=Math.min(o,T.firstByte),u=Math.max(u,T.lastByte)}if(h.size>this.cacheSize)throw new du(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:f}}hasBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0}hasDataForBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(n){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(n),f=this._decodedBlocks.get(o.toString());if(!f)throw new du(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[o],_=this.bandShape.reduce((P,x)=>P*x,1),w=u*_,T=f.subarray(w,w+_);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}U1.setPbf=function(c){V2=c};class vM{constructor(n,o,u){this.tasks=n,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,o){this._finalized||(this._onComplete(n,o),this._finalized=!0)}}U1.performDecoding=function(c,n){const o=new Uint8Array(c);return Promise.all(n.tasks.map(u=>{const{layerName:f,firstByte:h,lastByte:_,pixelFormat:w,blockShape:T,blockIndex:P,filters:x,codec:A}=u,I=o.subarray(h,_+1),C=new Uint32Array(T[0]*T[1]*T[2]);let M;if(A!=="gzip_data")throw new du(`Unhandled codec: ${A}`);return M=function(R,j){if(!globalThis.DecompressionStream&&j==="gzip_data")return Promise.resolve(((Z=function(ue){ue[0]==31&&ue[1]==139&&ue[2]==8||Xu(6,"invalid gzip data");var Ce=ue[3],we=10;4&Ce&&(we+=2+(ue[10]|ue[11]<<8));for(var Se=(Ce>>3&1)+(Ce>>4&1);Se>0;Se-=!ue[we++]);return we+(2&Ce)}(X=R))+8>X.length&&Xu(6,"invalid gzip data"),function(ue,Ce,we,Se){var He=ue.length;if(!He||Ce.f&&!Ce.l)return we||new Dc(0);var Pe=!we,We=Pe||Ce.i!=2,st=Ce.i;Pe&&(we=new Dc(3*He));var tt,ft,ht=function($f){var Gf=we.length;if($f>Gf){var Pm=new Dc(Math.max(2*Gf,$f));Pm.set(we),we=Pm}},bt=Ce.f||0,gt=Ce.p||0,At=Ce.b||0,en=Ce.l,Jt=Ce.d,An=Ce.m,on=Ce.n,hn=8*He;do{if(!en){bt=Ku(ue,gt,1);var rn=Ku(ue,gt+1,3);if(gt+=3,!rn){var jn=ue[(tr=4+((gt+7)/8|0))-4]|ue[tr-3]<<8,Sn=tr+jn;if(Sn>He){st&&Xu(0);break}We&&ht(At+jn),we.set(ue.subarray(tr,Sn),At),Ce.b=At+=jn,Ce.p=gt=8*Sn,Ce.f=bt;continue}if(rn==1)en=D8,Jt=N8,An=9,on=5;else if(rn==2){var kn=Ku(ue,gt,31)+257,Qn=Ku(ue,gt+10,15)+4,gr=kn+Ku(ue,gt+5,31)+1;gt+=14;for(var sr=new Dc(gr),Sr=new Dc(19),fr=0;fr<Qn;++fr)Sr[L8[fr]]=Ku(ue,gt+3*fr,7);gt+=3*Qn;var Er=j2(Sr),Jr=(1<<Er)-1,Ei=iy(Sr,Er);for(fr=0;fr<gr;){var tr,kr=Ei[Ku(ue,gt,Jr)];if(gt+=15&kr,(tr=kr>>4)<16)sr[fr++]=tr;else{var Fi=0,Ki=0;for(tr==16?(Ki=3+Ku(ue,gt,3),gt+=2,Fi=sr[fr-1]):tr==17?(Ki=3+Ku(ue,gt,7),gt+=3):tr==18&&(Ki=11+Ku(ue,gt,127),gt+=7);Ki--;)sr[fr++]=Fi}}var ts=sr.subarray(0,kn),is=sr.subarray(kn);An=j2(ts),on=j2(is),en=iy(ts,An),Jt=iy(is,on)}else Xu(1);if(gt>hn){st&&Xu(0);break}}We&&ht(At+131072);for(var bi=(1<<An)-1,ao=(1<<on)-1,Da=gt;;Da=gt){var Is=(Fi=en[U2(ue,gt)&bi])>>4;if((gt+=15&Fi)>hn){st&&Xu(0);break}if(Fi||Xu(2),Is<256)we[At++]=Is;else{if(Is==256){Da=gt,en=null;break}var Bs=Is-254;Is>264&&(Bs=Ku(ue,gt,(1<<(Nc=uM[fr=Is-257]))-1)+pM[fr],gt+=Nc);var sa=Jt[U2(ue,gt)&ao],Io=sa>>4;if(sa||Xu(3),gt+=15&sa,is=R8[Io],Io>3){var Nc=hM[Io];is+=U2(ue,gt)&(1<<Nc)-1,gt+=Nc}if(gt>hn){st&&Xu(0);break}We&&ht(At+131072);var qf=At+Bs;if(At<is){var fu=0-is,Ju=Math.min(is,qf);for(fu+At<0&&Xu(3);At<Ju;++At)we[At]=(void 0)[fu+At]}for(;At<qf;++At)we[At]=we[At-is]}}Ce.l=en,Ce.p=Da,Ce.b=At,Ce.f=bt,en&&(bt=1,Ce.m=An,Ce.d=Jt,Ce.n=on)}while(!bt);return At!=we.length&&Pe?(tt=we,((ft=At)==null||ft>tt.length)&&(ft=tt.length),new Dc(tt.subarray(0,ft))):we.subarray(0,At)}(X.subarray(Z,-8),{i:2},new Dc((($=X)[(Y=$.length)-4]|$[Y-3]<<8|$[Y-2]<<16|$[Y-1]<<24)>>>0))));var $,Y,X,Z;const re=B8[j];if(!re)throw new Error(`Unhandled codec: ${j}`);const ae=new globalThis.DecompressionStream(re);return new Response(new Blob([R]).stream().pipeThrough(ae)).arrayBuffer().then(ue=>new Uint8Array(ue))}(I,A).then(R=>(function(j,$){j.readFields(A8,$)}(new V2(R),C),new U8[w](C.buffer))),M.then(R=>{for(let j=x.length-1;j>=0;j--)switch(x[j]){case"delta_filter":C8(R,T);break;case"zigzag_filter":P8(R);break;case"bitshuffle_filter":M8(R,w);break;default:throw new du(`Unhandled filter "${x[j]}"`)}return{layerName:f,blockIndex:P,data:R}}).catch(R=>{throw R})}))},Ze(vM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ze(U1,"MapboxRasterTile"),Ze(yM,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let oy,q2,Yu,qg,$2,$g=null;function xM(){return as()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:q2||he.DRACO_URL}function bM(){if(as()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(qg)return qg;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return qg=WebAssembly.validate(c)?he.MESHOPT_SIMD_URL:he.MESHOPT_URL,qg}const V1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},V8={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},ay={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function wM(c,n,o){const u=o.json.bufferViews.length,f=o.buffers.length;n.bufferView=u,o.json.bufferViews[u]={buffer:f,byteLength:c.byteLength},o.buffers[f]=c}const G2="KHR_draco_mesh_compression";function q8(c,n){const o=c.extensions&&c.extensions[G2];if(!o)return;const u=new Yu.Decoder,f=EM(n,o.bufferView),h=new Yu.Mesh;if(!u.DecodeArrayToMesh(f,f.byteLength,h))throw new Error("Failed to decode Draco mesh");const _=n.json.accessors[c.indices],w=V1[_.componentType],T=_.count*w.BYTES_PER_ELEMENT,P=Yu._malloc(T);w===Uint16Array?u.GetTrianglesUInt16Array(h,T,P):u.GetTrianglesUInt32Array(h,T,P),wM(Yu.memory.buffer.slice(P,P+T),_,n),Yu._free(P);for(const x of Object.keys(o.attributes)){const A=u.GetAttributeByUniqueId(h,o.attributes[x]),I=n.json.accessors[c.attributes[x]],C=V8[I.componentType],M=I.count*ay[I.type]*V1[I.componentType].BYTES_PER_ELEMENT,R=Yu._malloc(M);u.GetAttributeDataArrayForAllPoints(h,A,Yu[C],M,R),wM(Yu.memory.buffer.slice(R,R+M),I,n),Yu._free(R)}u.destroy(),h.destroy(),delete c.extensions[G2]}const q1="EXT_meshopt_compression";function $8(c,n){if(!c.extensions||!c.extensions[q1])return;const o=c.extensions[q1],u=new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),f=new Uint8Array(o.count*o.byteStride);$2.decodeGltfBuffer(f,o.count,o.byteStride,u,o.mode,o.filter),c.buffer=n.buffers.length,c.byteOffset=0,n.buffers[c.buffer]=f.buffer,delete c.extensions[q1]}const SM=1179937895,TM=new TextDecoder("utf8");function AM(c,n){return new URL(c,n).href}function G8(c,n,o,u){return fetch(AM(c.uri,u)).then(f=>f.arrayBuffer()).then(f=>{n.buffers[o]=f})}function EM(c,n){const o=c.json.bufferViews[n];return new Uint8Array(c.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function H8(c,n,o,u){if(c.uri){const f=AM(c.uri,u);return fetch(f).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{n.images[o]=h})}if(c.bufferView!==void 0){const f=EM(n,c.bufferView),h=new Blob([f],{type:c.mimeType});return createImageBitmap(h).then(_=>{n.images[o]=_})}}function CM(c,n=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(c,n,1)[0]===SM){const x=new Uint32Array(c,n);let A=2;const I=(x[A++]>>2)-3,C=x[A++]>>2;if(A++,u.json=JSON.parse(TM.decode(x.subarray(A,A+C))),A+=C,A<I){const M=x[A++];A++;const R=n+(A<<2);u.buffers[0]=c.slice(R,R+M)}}else u.json=JSON.parse(TM.decode(new Uint8Array(c,n)));const{buffers:f,images:h,meshes:_,extensionsUsed:w,bufferViews:T}=u.json;let P=Promise.resolve();if(f){const x=[];for(let A=0;A<f.length;A++){const I=f[A];I.uri?x.push(G8(I,u,A,o)):u.buffers[A]||(u.buffers[A]=null)}P=Promise.all(x)}return P.then(()=>{const x=[],A=w&&w.includes(G2),I=w&&w.includes(q1);if(A&&x.push(function(){if(!Yu)return oy??(oy=function(C){let M,R=null;function j(){M=new Uint8Array(R.buffer)}function $(){throw new Error("Unexpected Draco error.")}const Y={a:{a:$,d:function(X,Z,re){return M.copyWithin(X,Z,Z+re)},c:function(X){const Z=M.length,re=Math.max(X>>>0,Math.ceil(1.2*Z)),ae=Math.ceil((re-Z)/65536);try{return R.grow(ae),j(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(C,Y):C.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,Y))).then(X=>{const{Rb:Z,Qb:re,P:ae,T:ue,X:Ce,Ja:we,La:Se,Qa:He,Va:Pe,Wa:We,eb:st,jb:tt,f:ft,e:ht,yb:bt,zb:gt,Ab:At,Bb:en,Db:Jt,Gb:An}=X.instance.exports;R=ht;const on=(()=>{let hn=0,rn=0,jn=0,Sn=0;return kn=>{jn&&(Z(Sn),Z(hn),rn+=jn,jn=hn=0),hn||(rn+=128,hn=re(rn));const Qn=kn.length+7&-8;let gr=hn;Qn>=rn&&(jn=Qn,gr=Sn=re(Qn));for(let sr=0;sr<kn.length;sr++)M[gr+sr]=kn[sr];return gr}})();return j(),ft(),{memory:ht,_free:Z,_malloc:re,Mesh:class{constructor(){this.ptr=ae()}destroy(){ue(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){tt(this.ptr)}DecodeArrayToMesh(hn,rn,jn){const Sn=on(hn),kn=Se(this.ptr,Sn,rn,jn.ptr);return!!Ce(kn)}GetAttributeByUniqueId(hn,rn){return{ptr:He(this.ptr,hn.ptr,rn)}}GetTrianglesUInt16Array(hn,rn,jn){Pe(this.ptr,hn.ptr,rn,jn)}GetTrianglesUInt32Array(hn,rn,jn){We(this.ptr,hn.ptr,rn,jn)}GetAttributeDataArrayForAllPoints(hn,rn,jn,Sn,kn){st(this.ptr,hn.ptr,rn.ptr,jn,Sn,kn)}},DT_INT8:bt(),DT_UINT8:gt(),DT_INT16:At(),DT_UINT16:en(),DT_UINT32:Jt(),DT_FLOAT32:An()}})}(fetch(xM())),oy.then(C=>{Yu=C,oy=void 0}))}()),I&&x.push(function(){if($2)return;const C=function(M){let R;const j=WebAssembly.instantiateStreaming(M,{}).then(X=>{R=X.instance,R.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:j,supported:!0,decodeGltfBuffer(X,Z,re,ae,ue,Ce){(function(we,Se,He,Pe,We,st,tt){const ft=we.exports.sbrk,ht=Pe+3&-4,bt=ft(ht*We),gt=ft(st.length),At=new Uint8Array(we.exports.memory.buffer);At.set(st,gt);const en=Se(bt,Pe,We,gt,st.length);if(en===0&&tt&&tt(bt,ht,We),He.set(At.subarray(bt,bt+Pe*We)),ft(bt-ft(0)),en!==0)throw new Error(`Malformed buffer data: ${en}`)})(R,R.exports[Y[ue]],X,Z,re,ae,R.exports[$[Ce]])}}}(fetch(bM()));return C.ready.then(()=>{$2=C})}()),h)for(let C=0;C<h.length;C++)x.push(H8(h[C],u,C,o));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(A&&_)for(const{primitives:C}of _)for(const M of C)q8(M,u);if(I&&_&&T)for(const C of T)$8(C,u);return u})})}function Cm(c,n){const o=c.json.bufferViews[n.bufferView],u=V1[n.componentType];return new u(c.buffers[o.buffer],(n.byteOffset||0)+(o.byteOffset||0),n.count*(o.byteStride&&o.byteStride!==ay[n.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:ay[n.type]))}function H2(c,n,o,u){const f=V1[n.componentType],h=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),_=c.json.bufferViews[n.bufferView],w=_.byteStride?_.byteStride/f.BYTES_PER_ELEMENT:ay[n.type],T=o.float32,P=T.length/o.capacity;for(let x=0,A=0;x<n.count*w;x+=w,A+=P)for(let I=0;I<P;I++)T[A+I]=u[x+I]*h;o._trim()}function W8(c,n,o){const u=c.indices,f=c.attributes,h={};h.indexArray=new Os;const _=n.json.accessors[u],w=_.count/3;h.indexArray.reserve(w);const T=Cm(n,_);for(let I=0;I<w;I++)h.indexArray.emplaceBack(T[3*I],T[3*I+1],T[3*I+2]);h.indexArray._trim(),h.vertexArray=new ka;const P=n.json.accessors[f.POSITION];h.vertexArray.reserve(P.count);const x=Cm(n,P);for(let I=0;I<P.count;I++)h.vertexArray.emplaceBack(x[3*I],x[3*I+1],x[3*I+2]);if(h.vertexArray._trim(),h.aabb=new Nn(P.min,P.max),h.centroid=function(I,C){const M=[0,0,0],R=I.length;if(R>0){for(let j=0;j<R;j++){const $=3*I[j];M[0]+=C[$],M[1]+=C[$+1],M[2]+=C[$+2]}M[0]/=R,M[1]/=R,M[2]/=R}return M}(T,x),f.COLOR_0!==void 0){const I=n.json.accessors[f.COLOR_0],C=ay[I.type],M=Cm(n,I);h.colorArray=C===3?new ka:new Ka,h.colorArray.resize(I.count),H2(n,I,h.colorArray,M)}if(f.NORMAL!==void 0){h.normalArray=new ka;const I=n.json.accessors[f.NORMAL];h.normalArray.resize(I.count);const C=Cm(n,I);H2(n,I,h.normalArray,C)}if(f.TEXCOORD_0!==void 0&&o.length>0){h.texcoordArray=new Vu;const I=n.json.accessors[f.TEXCOORD_0];h.texcoordArray.resize(I.count);const C=Cm(n,I);H2(n,I,h.texcoordArray,C)}if(f._FEATURE_ID_RGBA4444!==void 0){const I=n.json.accessors[f._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Cm(n,I))}f._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Cm(n,n.json.accessors[f._FEATURE_RGBA4444]).buffer));const A=c.material;return h.material=function(I,C){const{emissiveFactor:M=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:j=.5,normalTexture:$,occlusionTexture:Y,emissiveTexture:X,doubleSided:Z}=I,{baseColorFactor:re=[1,1,1,1],metallicFactor:ae=1,roughnessFactor:ue=1,baseColorTexture:Ce,metallicRoughnessTexture:we}=I.pbrMetallicRoughness||{},Se=Y?C[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&Se){const He=Y.extensions.KHR_texture_transform;Se.offsetScale=[He.offset[0],He.offset[1],He.scale[0],He.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new qr(...re),metallicFactor:ae,roughnessFactor:ue,baseColorTexture:Ce?C[Ce.index]:void 0,metallicRoughnessTexture:we?C[we.index]:void 0},doubleSided:Z,emissiveFactor:M,alphaMode:R,alphaCutoff:j,normalTexture:$?C[$.index]:void 0,occlusionTexture:Se,emissionTexture:X?C[X.index]:void 0,defined:I.defined===void 0}}(A!==void 0?n.json.materials[A]:{defined:!1},o),h}function PM(c,n,o){const{matrix:u,rotation:f,translation:h,scale:_,mesh:w,extras:T,children:P}=c,x={};if(x.matrix=u||me.mat4.fromRotationTranslationScale([],f||[0,0,0,1],h||[0,0,0],_||[1,1,1]),w!==void 0){x.meshes=o[w];const A=x.anchor=[0,0];for(const I of x.meshes){const{min:C,max:M}=I.aabb;A[0]+=C[0]+M[0],A[1]+=C[1]+M[1]}A[0]=Math.floor(A[0]/x.meshes.length/2),A[1]=Math.floor(A[1]/x.meshes.length/2)}if(T&&(T.id&&(x.id=T.id),T.lights&&(x.lights=function(A){if(!A.length)return[];const I=function($){const Y=atob($),X=new Uint8Array(Y.length);for(let Z=0;Z<Y.length;Z++)X[Z]=Y.codePointAt(Z);return X}(A),C=[],M=I.length/24,R=new Uint16Array(I.buffer),j=new Float32Array(I.buffer);for(let $=0;$<M;$++){const Y=R[2*$*6]/30,X=R[2*$*6+1]/30,Z=R[2*$*6+10]/100,re=j[6*$+1],ae=j[6*$+2],ue=j[6*$+3],Ce=j[6*$+4],we=ue-re,Se=Ce-ae,He=Math.hypot(we,Se);C.push({pos:[re+.5*we,ae+.5*Se,X],normal:[Se/He,-we/He,0],width:He,height:Y,depth:Z,points:[re,ae,ue,Ce]})}return C}(T.lights))),P){const A=[];for(const I of P)A.push(PM(n.json.nodes[I],n,o));x.children=A}return x}function Z8(c){if(c.vertices.length===0||c.indices.length===0)return null;const n=new Qw(c.vertices,c.indices,8,256),[o,u]=[n.min.clone(),n.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:n,min:o,max:u}}function K8(c){if(!c.extras||!c.extras.ground)return null;const n=c.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const o=n[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const _ of o){if(!Array.isArray(_)||_.length!==2)continue;const w=_[0],T=_[1];typeof w=="number"&&typeof T=="number"&&u.push(new $t(w,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let f=0;for(let _=0;_<u.length;_++){const w=u[_],T=u[(_+1)%u.length],P=u[(_+2)%u.length];f+=(w.x-T.x)*(P.y-T.y)-(P.x-T.x)*(w.y-T.y)}f>0&&u.reverse();const h=k0(u.flatMap(_=>[_.x,_.y]),[]);return h.length===0?null:{vertices:u,indices:h}}function X8(c,n){const o=[],u=[];let f=0;const h=[];for(const _ of c){f=o.length;const w=_.vertexArray.float32,T=_.indexArray.uint16;for(let P=0;P<_.vertexArray.length;P++)h[0]=w[3*P+0],h[1]=w[3*P+1],h[2]=w[3*P+2],me.vec3.transformMat4(h,h,n),o.push(new $t(h[0],h[1]));for(let P=0;P<3*_.indexArray.length;P++)u.push(T[P]+f)}if(u.length%3!=0)return null;for(let _=0;_<u.length;_+=3){const w=o[u[_+0]],T=o[u[_+1]],P=o[u[_+2]];(w.x-T.x)*(P.y-T.y)-(P.x-T.x)*(w.y-T.y)>0&&([u[_+1],u[_+2]]=[u[_+2],u[_+1]])}return{vertices:o,indices:u}}function MM(c){const n=function(T,P){const x=[],A=WebGL2RenderingContext;if(T.json.textures)for(const I of T.json.textures){const C={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};I.sampler!==void 0&&Object.assign(C,T.json.samplers[I.sampler]),x.push({image:P[I.source],sampler:C,uploaded:!1})}return x}(c,c.images),o=function(T,P){const x=[];for(const A of T.json.meshes){const I=[];for(const C of A.primitives)I.push(W8(C,T,P));x.push(I)}return x}(c,n),{scenes:u,scene:f,nodes:h}=c.json,_=u?u[f||0].nodes:h,w=[];for(const T of _)w.push(PM(h[T],c,o));return function(T,P,x){const A={},I=new Set;for(let C=0;C<T.length;C++){const M=x[P[C]];if(!M.extras)continue;const R=M.extras["mapbox:footprint:version"],j=M.extras["mapbox:footprint:id"];(R||j)&&I.add(C),R==="1.0.0"&&j&&(A[j]=C)}for(let C=0;C<T.length;C++){if(I.has(C))continue;const M=T[C],R=x[P[C]];if(!R.extras)continue;let j=null;M.id in A&&(j=X8(T[A[M.id]].meshes,M.matrix)),j||(j=K8(R)),j&&(M.footprint=Z8(j))}if(I.size>0){const C=Array.from(I.values()).sort((M,R)=>M-R);for(let M=C.length-1;M>=0;M--)T.splice(C[M],1)}}(w,_,c.json.nodes),w}function Y8(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const n=c.vertexArray.float32,o=c.aabb.min[0]-1,u=c.aabb.min[1]-1,f=Tm/(c.aabb.max[0]-o+2),h=Tm/(c.aabb.max[1]-u+2);for(let _=0;_<n.length;_+=3){const w=n[_+2],T=(n[_+0]-o)*f|0,P=(n[_+1]-u)*h|0;w>c.heightmap[P*Tm+T]&&(c.heightmap[P*Tm+T]=w)}}function J8(c,n){const o={};o.indexArray=new Os,o.indexArray.reserve(4*c.length),o.vertexArray=new ka,o.vertexArray.reserve(10*c.length),o.colorArray=new Ka,o.vertexArray.reserve(10*c.length);let u=0;for(const _ of c){const w=Math.min(10,Math.max(4,1.3*_.height))*n,T=[-_.normal[1],_.normal[0],0],P=Math.min(.29,.1*_.width/_.depth),x=_.width-2*_.depth*n*(P+.01),A=me.vec3.scaleAndAdd([],_.pos,T,x/2),I=me.vec3.scaleAndAdd([],_.pos,T,-x/2),C=[A[0],A[1],A[2]+_.height],M=[I[0],I[1],I[2]+_.height],R=me.vec3.scaleAndAdd([],_.normal,T,P);me.vec3.scale(R,R,w);const j=me.vec3.scaleAndAdd([],_.normal,T,-P);me.vec3.scale(j,j,w),me.vec3.add(R,A,R),me.vec3.add(j,I,j),A[2]+=.1,I[2]+=.1,o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(j[0],j[1],j[2]),o.vertexArray.emplaceBack(A[0],A[1],A[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(C[0],C[1],C[2]),o.vertexArray.emplaceBack(M[0],M[1],M[2]),o.vertexArray.emplaceBack(A[0],A[1],A[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(j[0],j[1],j[2]);const $=x/w/2;o.colorArray.emplaceBack(-$-P,-1,$,.8),o.colorArray.emplaceBack($+P,-1,$,.8),o.colorArray.emplaceBack(-$,0,$,1.3),o.colorArray.emplaceBack($,0,$,1.3),o.colorArray.emplaceBack($+P,-.8,$,.7),o.colorArray.emplaceBack($+P,-.8,$,.7),o.colorArray.emplaceBack(0,0,$,1.3),o.colorArray.emplaceBack(0,0,$,1.3),o.colorArray.emplaceBack($+P,-1.2,$,.8),o.colorArray.emplaceBack($+P,-1.2,$,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const f={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=qr.white,f.pbrMetallicRoughness=h,o.material=f,o.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}class IM{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const u=n[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const Q8=["id","tile","layer","source","sourceLayer","state"];class Gg{constructor(n,o,u,f,h){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=u,this._y=f,this.properties=n.properties,this.id=h}clone(){const n=new Gg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(n.state=Object.assign({},this.state)),this.layer&&(n.layer=Object.assign({},this.layer)),this.source&&(n.source=this.source),this.sourceLayer&&(n.sourceLayer=this.sourceLayer),n}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of Q8)this[o]!==void 0&&(n[o]=this[o]);return n}}class LM{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new $e(un,16,0),this.featureIndexArray=new Ya,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(n,o,u,f,h,_=0,w=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,h,_);const P=this.grid;for(let x=0;x<o.length;x++){const A=o[x],I=[1/0,1/0,-1/0,-1/0];for(let C=0;C<A.length;C++){const M=A[C];I[0]=Math.min(I[0],M.x),I[1]=Math.min(I[1],M.y),I[2]=Math.max(I[2],M.x),I[3]=Math.max(I[3],M.y)}w!==0&&(I[0]-=w,I[1]-=w,I[2]+=w,I[3]+=w),I[0]<un&&I[1]<un&&I[2]>=0&&I[3]>=0&&P.insert(T,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Of.VectorTile(new h1(this.rawTileData)).layers,this.sourceLayerCoder=new IM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o){const{tilespaceGeometry:u,transform:f,tileTransform:h,pixelPosMatrix:_,availableImages:w}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const T=u.bufferedTilespaceBounds,P=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(C,M,R,j)=>Ue(u.bufferedTilespaceGeometry,C,M,R,j));P.sort(e7);let x=null;f.elevation&&P.length>0&&(x=Fg.create(f.elevation,this.tileID));const A={};let I;for(let C=0;C<P.length;C++){const M=P[C];if(M===I)continue;I=M;const R=this.featureIndexArray.get(M);let j=null;this.is3DTile?this.loadMatchingModelFeature(A,R,n,u,f):this.loadMatchingFeature(A,R,n,w,($,Y,X,Z=0)=>(j||(j=F($,this.tileID.canonical,h)),Y.queryIntersectsFeature(u,$,X,j,this.z,f,_,x,Z)))}return A}loadMatchingFeature(n,o,u,f,h){const{featureIndex:_,bucketIndex:w,sourceLayerIndex:T,layoutVertexArrayOffset:P}=o,x=this.bucketLayerIDs[w],A=u.layers,I=Object.keys(A);if(I.length&&!function($,Y){for(let X=0;X<$.length;X++)if(Y.indexOf($[X])>=0)return!0;return!1}(I,x))return;const C=u.sourceCache,M=this.sourceLayerCoder.decode(T),R=this.vtLayers[M].feature(_),j=this.getId(R,M);for(let $=0;$<x.length;$++){const Y=x[$];if(!A[Y])continue;const{styleLayer:X,targets:Z}=A[Y];let re={};j!==void 0&&(re=C.getFeatureState(X.sourceLayer,j));const ae=!h||h(R,X,re,P);if(!ae)continue;const ue=new Gg(R,this.z,this.x,this.y,j);ue.tile=this.tileID.canonical,ue.state=re;let Ce=this.serializedLayersCache.get(Y);Ce||(Ce=X.serialize(),Ce.id=Y,this.serializedLayersCache.set(Y,Ce)),ue.source=Ce.source,ue.sourceLayer=Ce["source-layer"],ue.layer=si({},Ce),ue.layer.paint=kM(Ce.paint,X.paint,R,re,f),ue.layer.layout=kM(Ce.layout,X.layout,R,re,f);let we=!1;for(const Se of Z){this.updateFeatureProperties(ue,Se);const{filter:He}=Se;if(He){if(R.properties=ue.properties,He.needGeometry){const Pe=B(R,!0);if(!He.filter(new Nr(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!He.filter(new Nr(this.tileID.overscaledZ),R))continue}we=!0,Se.targetId&&this.addFeatureVariant(ue,Se)}we&&this.appendToResult(n,Y,_,ue,ae)}}loadMatchingModelFeature(n,o,u,f,h){const _=this.bucketLayerIDs[0][0],w=u.layers;if(!w[_])return;const{styleLayer:T,targets:P}=w[_];if(T.type!=="model")return;const x=f.tile,A=o.featureIndex,I=x.getBucket(T);if(!(I&&I instanceof k1))return;const C=function(Ce,we,Se,He){const Pe=Ce.getNodesInfo()[we];if(Pe.hiddenByReplacement||!Pe.node.meshes)return;let We=Number.MAX_VALUE;const st=Pe.node,tt=Se.tile,ft=He.calculatePosMatrix(tt.tileID.toUnwrapped(),He.worldSize),ht=Pe.evaluatedScale;let bt=0;He.elevation&&st.elevation&&(bt=st.elevation*He.elevation.exaggeration()),me.mat4.translate(ft,ft,[(st.anchor?st.anchor[0]:0)*(ht[0]-1),(st.anchor?st.anchor[1]:0)*(ht[1]-1),bt]),me.mat4.scale(ft,ft,ht);const gt=Se.queryGeometry,At=gt.isPointQuery()?gt.screenBounds:gt.screenGeometry,en=function(An){const on=me.mat4.multiply([],ft,An.matrix);me.mat4.multiply(on,He.expandedFarZProjMatrix,on);for(let hn=0;hn<An.meshes.length;++hn){const rn=An.meshes[hn];if(hn===An.lightMeshIndex)continue;const jn=MP(At,He,on,rn.aabb);jn!=null&&(We=Math.min(jn,We))}if(An.children)for(const hn of An.children)en(hn)};if(en(st),We===Number.MAX_VALUE)return;const Jt=new ni(0,0);return UP(tt.tileID.canonical,Jt,Pe.node.anchor[0],Pe.node.anchor[1]),{intersectionZ:We,position:Jt,feature:Pe.feature}}(I,A,f,h);if(!C)return;const{z:M,x:R,y:j}=x.tileID.canonical,{feature:$,intersectionZ:Y,position:X}=C;let Z={};$.id!==void 0&&(Z=u.sourceCache.getFeatureState(T.sourceLayer,$.id));const re=new Gg({},M,R,j,$.id);re.tile=this.tileID.canonical,re.state=Z,re.properties=$.properties,re.geometry={type:"Point",coordinates:[X.lng,X.lat]};let ae=this.serializedLayersCache.get(_);ae||(ae=T.serialize(),ae.id=_,this.serializedLayersCache.set(_,ae)),re.source=ae.source,re.sourceLayer=ae["source-layer"],re.layer=si({},ae);let ue=!1;for(const Ce of P){this.updateFeatureProperties(re,Ce);const{filter:we}=Ce;if(we){if($.properties=re.properties,we.needGeometry){if(!we.filter(new Nr(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!we.filter(new Nr(this.tileID.overscaledZ),$))continue}ue=!0,Ce.targetId&&this.addFeatureVariant(re,Ce)}ue&&this.appendToResult(n,_,A,re,Y)}updateFeatureProperties(n,o,u){if(o.properties){const f={};for(const h in o.properties){const _=o.properties[h].evaluate({zoom:this.z},n._vectorTileFeature,n.state,n.tile,u);_!=null&&(f[h]=_)}n.properties=f}}addFeatureVariant(n,o,u){const f={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(f.properties=n.properties),n.variants=n.variants||{},n.variants[o.targetId]=n.variants[o.targetId]||[],n.variants[o.targetId].push(f)}appendToResult(n,o,u,f,h){let _=n[o];_===void 0&&(_=n[o]=[]),_.push({featureIndex:u,feature:f,intersectionZ:h})}lookupSymbolFeatures(n,o,u,f,h){const _={};this.loadVTLayers();for(const w of n)this.loadMatchingFeature(_,{bucketIndex:o,sourceLayerIndex:u,featureIndex:w,layoutVertexArrayOffset:0},f,h);return _}loadFeature(n){const{featureIndex:o,sourceLayerIndex:u}=n;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),h=this.vtFeatures[f];if(h[o])return h[o];const _=this.vtLayers[f].feature(o);return h[o]=_,_}hasLayer(n){for(const o of this.bucketLayerIDs)for(const u of o)if(n===u)return!0;return!1}getId(n,o){let u=n.id;if(this.promoteId){const f=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(f!=null)if(Array.isArray(f)){if(!this.promoteIdExpression){const h=Fu(f);if(h.result!=="success"){const _=h.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void pi(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=h.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Sc),u=this.promoteIdExpression.evaluate({zoom:0},n)}else u=n.properties[f];typeof u=="boolean"&&(u=Number(u))}return u}}function kM(c,n,o,u,f){return fi(c,(h,_)=>{const w=n instanceof _a?n.get(_):null;return w&&w.evaluate?w.evaluate(o,u,f):w})}function e7(c,n){return n-c}Ze(LM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const RM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class W2{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=u>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const h=RM[15&u];if(!h)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(n,2,1),[w]=new Uint32Array(n,4,1);return new W2(w,_,h,n)}constructor(n,o=64,u=Float64Array,f){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const h=RM.indexOf(this.ArrayType),_=2*n*this.ArrayType.BYTES_PER_ELEMENT,w=n*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+w+T,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+_+w+T),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+w+T,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=o,u}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Z2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:_,nodeSize:w}=this,T=[0,h.length-1,0],P=[];for(;T.length;){const x=T.pop()||0,A=T.pop()||0,I=T.pop()||0;if(A-I<=w){for(let j=I;j<=A;j++){const $=_[2*j],Y=_[2*j+1];$>=n&&$<=u&&Y>=o&&Y<=f&&P.push(h[j])}continue}const C=I+A>>1,M=_[2*C],R=_[2*C+1];M>=n&&M<=u&&R>=o&&R<=f&&P.push(h[C]),(x===0?n<=M:o<=R)&&(T.push(I),T.push(C-1),T.push(1-x)),(x===0?u>=M:f>=R)&&(T.push(C+1),T.push(A),T.push(1-x))}return P}within(n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:h,nodeSize:_}=this,w=[0,f.length-1,0],T=[],P=u*u;for(;w.length;){const x=w.pop()||0,A=w.pop()||0,I=w.pop()||0;if(A-I<=_){for(let j=I;j<=A;j++)NM(h[2*j],h[2*j+1],n,o)<=P&&T.push(f[j]);continue}const C=I+A>>1,M=h[2*C],R=h[2*C+1];NM(M,R,n,o)<=P&&T.push(f[C]),(x===0?n-u<=M:o-u<=R)&&(w.push(I),w.push(C-1),w.push(1-x)),(x===0?n+u>=M:o+u>=R)&&(w.push(C+1),w.push(A),w.push(1-x))}return T}}function Z2(c,n,o,u,f,h){if(f-u<=o)return;const _=u+f>>1;DM(c,n,_,u,f,h),Z2(c,n,o,u,_-1,1-h),Z2(c,n,o,_+1,f,1-h)}function DM(c,n,o,u,f,h){for(;f>u;){if(f-u>600){const P=f-u+1,x=o-u+1,A=Math.log(P),I=.5*Math.exp(2*A/3),C=.5*Math.sqrt(A*I*(P-I)/P)*(x-P/2<0?-1:1);DM(c,n,o,Math.max(u,Math.floor(o-x*I/P+C)),Math.min(f,Math.floor(o+(P-x)*I/P+C)),h)}const _=n[2*o+h];let w=u,T=f;for(ly(c,n,u,o),n[2*f+h]>_&&ly(c,n,u,f);w<T;){for(ly(c,n,w,T),w++,T--;n[2*w+h]<_;)w++;for(;n[2*T+h]>_;)T--}n[2*u+h]===_?ly(c,n,u,T):(T++,ly(c,n,T,f)),T<=o&&(u=T+1),o<=T&&(f=T-1)}}function ly(c,n,o,u){K2(c,o,u),K2(n,2*o,2*u),K2(n,2*o+1,2*u+1)}function K2(c,n,o){const u=c[n];c[n]=c[o],c[o]=u}function NM(c,n,o,u){const f=c-o,h=n-u;return f*f+h*h}i.$=Es,i.A=bo,i.B=Ua,i.C=Lh,i.D=Bg,i.E=Ta,i.F=2,i.G=q0,i.H=VC,i.I=wo,i.J=class extends I1{},i.K=Ea,i.L=zr,i.M=rm,i.N=Sf,i.O=au,i.P=$t,i.Q=yg,i.R=gs,i.S=Ef,i.T=E2,i.U=Md,i.V=I1,i.W=ne,i.X=Fu,i.Y=jo,i.Z=Pi,i._=Eo,i.a=function(c){return he.API_CDN_URL_REGEX.test(c)},i.a$=B,i.a0=So,i.a1=Ph,i.a2=Tf,i.a3=Cd,i.a4=function(c){const n=c.value;let o=[];if(!n)return o;const u=Ea(n);return u!=="string"?(o=o.concat([new I1(c.key,n,`string expected, "${u}" found`)]),o):(LP(n,!0)||(o=o.concat([new I1(c.key,n,`invalid url "${n}"`)])),o)},i.a5=Tt,i.a6=io,i.a7=Ir,i.a8=an,i.a9=class{constructor(c){this.specification=c}possiblyEvaluate(c,n){return Yi(c.expression.evaluate(n))}interpolate(c,n,o){return{x:Bn(c.x,n.x,o),y:Bn(c.y,n.y,o),z:Bn(c.z,n.z,o),azimuthal:Bn(c.azimuthal,n.azimuthal,o),polar:Bn(c.polar,n.polar,o)}}},i.aA=function(c,n){const o={};for(let u=0;u<n.length;u++){const f=n[u];f in c&&(o[f]=c[f])}return o},i.aB=Bh,i.aC=Ja,i.aD=class{constructor(c){this.entries={},this.scheduler=c}request(c,n,o,u){const f=this.entries[c]=this.entries[c]||{callbacks:[]};if(f.result){const[h,_]=f.result;return this.scheduler?this.scheduler.add(()=>{u(h,_)},n):u(h,_),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=o((h,_)=>{f.result=[h,_];for(const w of f.callbacks)this.scheduler?this.scheduler.add(()=>{w(h,_)},n):w(h,_);setTimeout(()=>delete this.entries[c],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(h=>h!==u),f.callbacks.length||(f.cancel(),delete this.entries[c]))}}},i.aE=function(c,n,o){const u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},f=>{const h=Wi(c.request,(_,w,T,P)=>{_?f(_):w&&f(null,{vectorTile:o?void 0:new Of.VectorTile(new h1(w)),rawData:w,cacheControl:T,expires:P})});return()=>{h.cancel(),f()}},n)},i.aF=function(c){Vr++,Vr>er&&(c.getActor().send("enforceCacheSizeLimit",$n),Vr=0)},i.aG=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},i.aH=Qt,i.aI=yP,i.aJ=TP,i.aK=_P,i.aL=function(c,n){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let u=0;u<c.length;u++){const f=document.createElement("source");yh(c[u])||(o.crossOrigin="Anonymous"),f.src=c[u],o.appendChild(f)}return{cancel:()=>{}}},i.aM=A1,i.aN=function(c){return fetch(c).then(n=>n.arrayBuffer()).then(n=>CM(n,0,c))},i.aO=MM,i.aP=class{constructor(c,n,o,u){this.id=c,this.position=n!=null?new ni(n[0],n[1]):new ni(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,n){if(me.mat4.multiply(c.matrix,n,c.matrix),c.meshes)for(const o of c.meshes){const u=Nn.applyTransformFast(o.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(const o of c.children)this._applyTransformations(o,c.matrix)}computeBoundsAndApplyParent(){const c=me.mat4.identity([]);for(const n of this.nodes)this._applyTransformations(n,c)}computeModelMatrix(c,n,o,u,f,h,_=!1){OP(this.matrix,this,c.transform,this.position,n,o,u,f,h,_)}upload(c){if(!this.uploaded){for(const n of this.nodes)L2(n,c);for(const n of this.nodes)L1(n);this.uploaded=!0}}destroy(){for(const c of this.nodes)k2(c)}},i.aQ=Hs,i.aR=H0,i.aS=Qa,i.aT=Po,i.aU=Ml,i.aV=Os,i.aW=Ur,i.aX=um,i.aY=S1,i.aZ=function(){ci.isLoading()||ci.isLoaded()||bs()!=="deferred"||ea()},i.a_=Bu,i.aa=Nr,i.ab=q,i.ac=r,i.ad=me,i.ae=br,i.af=_a,i.ag=Ra,i.ah=Bn,i.ai=un,i.aj=fd,i.ak=En,i.al=qr,i.am=class{constructor(c){this.specification=c}possiblyEvaluate(c,n){return function([o,u]){const f=Yi([1,o,u]);return{x:f.x,y:f.y,z:f.z}}(c.expression.evaluate(n))}interpolate(c,n,o){return{x:Bn(c.x,n.x,o),y:Bn(c.y,n.y,o),z:Bn(c.z,n.z,o)}}},i.an=function(c,n,o=0,u=!0){const f=new $t(o,o),h=c.sub(f),_=n.add(f),w=[h,new $t(_.x,h.y),_,new $t(h.x,_.y)];return u&&w.push(h.clone()),w},i.ao=function(c,n){const o=[];for(let u=0;u<c.length;u++){const f=Kr(u-1,-1,c.length-1),h=Kr(u+1,-1,c.length-1),_=c[u],w=c[h],T=c[f].sub(_).unit(),P=w.sub(_).unit(),x=P.angleWithSep(T.x,T.y),A=T.add(P).unit().mult(-1*n/Math.sin(x/2));o.push(_.add(A))}return o},i.ap=rP,i.aq=Ue,i.ar=function(c,n,o=0){return me.vec3.fromValues(((n.x-o)*c.scale-c.x)*un,(n.y*c.scale-c.y)*un,P0(n.z,n.y))},i.as=Yn,i.at=gC,i.au=function(c){let n=1/0,o=1/0,u=-1/0,f=-1/0;for(const h of c)n=Math.min(n,h.x),o=Math.min(o,h.y),u=Math.max(u,h.x),f=Math.max(f,h.y);return{min:new $t(n,o),max:new $t(u,f)}},i.av=cu,i.aw=je,i.ax=p,i.ay=Ln,i.az=ya,i.b=function(c){return he.API_FONTS_REGEX.test(c)},i.b$=P1,i.b0=Gg,i.b1=Ho,i.b2=s2,i.b3=Jw,i.b4=F,i.b5=ic,i.b6=Nh,i.b7=Vn,i.b8=qi,i.b9=k0,i.bA=ZE,i.bB=g2,i.bC=XC,i.bD=f2,i.bE=W2,i.bF=Kr,i.bG=Rr,i.bH=Vo,i.bI=function(c,n,o){c[4*n+0]=o[0],c[4*n+1]=o[1],c[4*n+2]=o[2],c[4*n+3]=o[3]},i.bJ=ym,i.bK=sc,i.bL=If,i.bM=Ss,i.bN=gm,i.bO=ni,i.bP=lP,i.bQ=Rt,i.bR=cr,i.bS=EP,i.bT=Xt,i.bU=ia,i.bV=function(c,n,o,u,f,h,_,w,T){if(T.name==="globe")return ia(c,n,new Xt(o,u,f),!1);const P=H0({z:o,x:u,y:f},T);return new Nn([(h+P.x/P.scale)*n,n*(P.y/P.scale),_],[(h+P.x2/P.scale)*n,n*(P.y2/P.scale),w])},i.bW=function(c,n,o){let u=0;for(let f=0;f<2;++f)c[f]>0&&(u+=(c[f]-0)*(c[f]-0)),n[f]<0&&(u+=(0-n[f])*(0-n[f]));return u},i.bX=ps,i.bY=Yv,i.bZ=function(c){const n=me.mat4.identity(new Float64Array(16));me.mat4.multiply(n,c.pixelMatrix,c.globeMatrix);const o=[0,kl,0],u=[0,Rl,0];return me.vec3.transformMat4(o,o,n),me.vec3.transformMat4(u,u,n),[o[0]>0&&o[0]<=c.width&&o[1]>0&&o[1]<=c.height&&!tl(c,new ni(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!tl(c,new ni(c.center.lat,-90))]},i.b_=function(c,n){const{scale:o}=c.tileTransform,u=o*un/(c.tileSize*Math.pow(2,n.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return me.mat2.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[u,u])},i.ba=S2,i.bb=function(c,n){const o=Ra(n.zoom);if(o===0)return Js(c);const u=Wr(c),f=Gi(u),h=cu(u.getWest())*n.worldSize,_=cu(u.getEast())*n.worldSize,w=Ja(u.getNorth())*n.worldSize,T=Ja(u.getSouth())*n.worldSize,P=[h,w,0],x=[_,w,0],A=[h,T,0],I=[_,T,0],C=me.mat4.invert([],n.globeMatrix);return me.vec3.transformMat4(P,P,C),me.vec3.transformMat4(x,x,C),me.vec3.transformMat4(A,A,C),me.vec3.transformMat4(I,I,C),f[0]=so(f[0],A,o),f[1]=so(f[1],I,o),f[2]=so(f[2],x,o),f[3]=so(f[3],P,o),Nn.fromPoints(f)},i.bc=zi,i.bd=ii,i.be=so,i.bf=Lc,i.bg=ar,i.bh=U1,i.bi=h1,i.bj=Wi,i.bk=function(c,n){const o=[];for(const u in c)u in n||o.push(u);return o},i.bl=hi,i.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bn=cn,i.bo=function(c,n){const{x:o,y:u}=c.point,f=oc(o,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return me.mat4.multiply(f,f,Qs(Js(n)))},i.bp=Lg,i.bq=Nl,i.br=u1,i.bs=function(c,n,o,u,f){const h=5*n+2;c.float32[h+0]=o,c.float32[h+1]=u,c.float32[h+2]=f},i.bt=w1,i.bu=UC,i.bv=ce,i.bw=$o,i.bx=VE,i.by=IP,i.bz=WE,i.c=Oe,i.c$=xC,i.c0=AP,i.c1=function(c){const n=AP(c,!0);return me.mat2.invert([],[n[0],n[1],n[4],n[5]])},i.c2=Cr,i.c3=function(c){const{x:n,y:o}=c.point,{lng:u,lat:f}=c._center;return oc(n,o,c.worldSize,u,f)},i.c4=bn,i.c5=gn,i.c6=Lf,i.c7=function(c){const n=Math.round((c+45+360)%360/90)%4;return Fn[n]},i.c8=45,i.c9=$r,i.cA=Zv,i.cB=class extends lu{constructor(c){super(c),this.current=T0}set(c,n,o){if(this.fetchUniformLocation(c,n)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},i.cC=Gn,i.cD=function(c,n,o){const u=Ra(o.zoom),f=c.style.map._antialias,h=c.terrain&&c.terrain.exaggeration()>0;return u===0&&!f&&!h},i.cE=function(c){const n=c.pixelsPerMeter,o=n/Vo(1,c.center.lat),u=me.mat4.identity(new Float64Array(16));return me.mat4.translate(u,u,[c.point.x,c.point.y,0]),me.mat4.scale(u,u,[o,o,n]),Float32Array.from(u)},i.cF=Wr,i.cG=function(c){const n=ps-5;c=Ln(c,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(En(c))),3);return Math.round(o*(Cg.length-1))},i.cH=function(c,n,o,u){const f=n.getNorth(),h=n.getSouth(),_=n.getWest(),w=n.getEast(),T=1<<c.z,P=w-_,x=f-h,A=P/kf,I=-x/Cg[o],C=[0,A,0,I,0,0,f,_,0];if(c.z>0){const M=180/u;me.mat3.multiply(C,C,[M/P+1,0,0,0,M/x+1,0,-.5*M/A,.5*M/I,1])}return C[2]=T,C[5]=c.x,C[8]=c.y,C},i.cI=Js,i.cJ=function(c,n,o){const u=me.mat4.identity(new Float64Array(16)),f=(n/(1<<c)-.5)*Math.PI*2;return me.mat4.rotateY(u,o.globeMatrix,f),Float32Array.from(u)},i.cK=class{isDataAvailableAtPoint(c){const n=this._source();if(this.isUsingMockSource()||!n||c.y<0||c.y>1)return!1;const o=n.getSource().maxzoom,u=1<<o,f=Math.floor(c.x),h=Math.floor((c.x-f)*u),_=Math.floor(c.y*u),w=this.findDEMTileFor(new Qt(o,f,o,h,_));return!(!w||!w.dem)}getAtPointOrZero(c,n=0){return this.getAtPoint(c,n)||0}getAtPoint(c,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const u=this._source();if(!u||c.y<0||c.y>1)return n;const f=u.getSource().maxzoom,h=1<<f,_=Math.floor(c.x),w=c.x-_,T=new Qt(f,_,f,Math.floor(w*h),Math.floor(c.y*h)),P=this.findDEMTileFor(T);if(!P||!P.dem)return n;const x=P.dem,A=1<<P.tileID.canonical.z,I=(w*A-P.tileID.canonical.x)*x.dim,C=(c.y*A-P.tileID.canonical.y)*x.dim,M=Math.floor(I),R=Math.floor(C);return(o?this.exaggeration():1)*Bn(Bn(x.get(M,R),x.get(M,R+1),C-R),Bn(x.get(M+1,R),x.get(M+1,R+1),C-R),I-M)}getAtTileOffset(c,n,o){const u=1<<c.canonical.z;return this.getAtPointOrZero(new r(c.wrap+(c.canonical.x+n/un)/u,(c.canonical.y+o/un)/u))}getAtTileOffsetFunc(c,n,o,u){return f=>{const h=this.getAtTileOffset(c,f.x,f.y),_=u.upVector(c.canonical,f.x,f.y),w=u.upVectorScale(c.canonical,n,o).metersToTile;return me.vec3.scale(_,_,h*w),_}}getForTilePoints(c,n,o,u){if(this.isUsingMockSource())return!1;const f=Fg.create(this,c,u);return!!f&&(n.forEach(h=>{h[2]=this.exaggeration()*f.getElevationAt(h[0],h[1],o)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(c);if(!n||!n.dem)return null;const o=n.dem.tree,u=n.tileID,f=1<<c.canonical.z-u.canonical.z;let h=c.canonical.x/f-u.canonical.x,_=c.canonical.y/f-u.canonical.y,w=0;for(let T=0;T<c.canonical.z-u.canonical.z&&!o.leaves[w];T++){h*=2,_*=2;const P=2*Math.floor(_)+Math.floor(h);w=o.childOffsets[w]+P,h%=1,_%=1}return{min:this.exaggeration()*o.minimums[w],max:this.exaggeration()*o.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let n=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const f of c){const h=this.getMinMaxForTile(f.tileID);h&&(o=Math.min(o,h.min),u=Math.max(u,h.max),n=!0)}return n?{min:o,max:u}:null}},i.cL=yE,i.cM=Lr,i.cN=function(c,n){return[Math.pow(c[0],2.2)*n,Math.pow(c[1],2.2)*n,Math.pow(c[2],2.2)*n]},i.cO=el,i.cP=Dt,i.cQ=Rs,i.cR=256,i.cS=function(c,n){const o=[0,0,0],u=zi(Js(n.canonical));return me.vec3.transformMat4(o,o,u),me.vec3.transformMat4(o,o,c),o},i.cT=c=>({u_camera_to_center_distance:new Ss(c),u_extrude_scale:new A0(c),u_device_pixel_ratio:new Ss(c),u_matrix:new ym(c),u_inv_rot_matrix:new ym(c),u_merc_center:new sc(c),u_tile_id:new If(c),u_zoom_transition:new Ss(c),u_up_dir:new If(c),u_emissive_strength:new Ss(c)}),i.cU=c=>({u_matrix:new ym(c),u_pixels_to_tile_units:new A0(c),u_device_pixel_ratio:new Ss(c),u_width_scale:new Ss(c),u_floor_width_scale:new Ss(c),u_units_to_pixels:new sc(c),u_dash_image:new gm(c),u_gradient_image:new gm(c),u_image_height:new Ss(c),u_texsize:new sc(c),u_tile_units_to_pixels:new Ss(c),u_alpha_discard_threshold:new Ss(c),u_trim_offset:new sc(c),u_trim_fade_range:new sc(c),u_trim_color:new _m(c),u_emissive_strength:new Ss(c),u_zbias_factor:new Ss(c),u_tile_to_meter:new Ss(c)}),i.cV=c=>({u_matrix:new ym(c),u_texsize:new sc(c),u_pixels_to_tile_units:new A0(c),u_device_pixel_ratio:new Ss(c),u_width_scale:new Ss(c),u_floor_width_scale:new Ss(c),u_image:new gm(c),u_units_to_pixels:new sc(c),u_tile_units_to_pixels:new Ss(c),u_alpha_discard_threshold:new Ss(c),u_trim_offset:new sc(c),u_trim_fade_range:new sc(c),u_trim_color:new _m(c),u_emissive_strength:new Ss(c),u_zbias_factor:new Ss(c),u_tile_to_meter:new Ss(c)}),i.cW=cm,i.cX=rj,i.cY=ij,i.cZ=Df,i.c_=(c,n,o,u,f,h)=>{const _=c.transform,w=_.projection.name==="globe";let T;if(h.paint.get("circle-pitch-alignment")==="map")if(w){const x=el(_.zoom,n.canonical)*_._pixelsPerMercatorPixel;T=Float32Array.from([x,0,0,x])}else T=_.calculatePixelsToTileUnitsMatrix(o);else T=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(_.projection),u_matrix:c.translatePosMatrix(n.projMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Lt.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:M0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(w){P.u_inv_rot_matrix=u,P.u_merc_center=f,P.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],P.u_zoom_transition=Ra(_.zoom);const x=f[0]*un,A=f[1]*un;P.u_up_dir=_.projection.upVector(new Xt(0,0,0),x,A)}return P},i.ca=Pg,i.cb=_m,i.cc=function(c,n,o){const u=Math.sqrt(c*c+n*n+o*o),f=u>0?Math.acos(o/u)*yr:0;let h=c!==0||n!==0?Math.atan2(-n,-c)*yr+90:0;return h<0&&(h+=360),[u,h,f]},i.cd=m,i.ce=Nn,i.cf=Yi,i.cg=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},i.ch=function(c,n){return c.readFields(Yj,{icons:[]},n)},i.ci=function(c){return c({pluginStatus:oi,pluginURL:Ai}),ro.on("pluginStateChange",c),c},i.cj=R1,i.ck=Dg,i.cl=p2,i.cm=gl,i.cn=Hr,i.co=pn,i.cp=Wo,i.cq=di,i.cr=function(c){const n=c.indexOf(Cf);return n>=0?c.slice(0,n):c},i.cs=function(c){return c.indexOf(Cf)>=0},i.ct=function(c){const n=c.indexOf(Cf);return n>=0?c.slice(n+1):""},i.cu=function(c){const n=[],o=c.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),c.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},i.cv=function(c,n,o,u){return c.type==="custom"?new zj(c,n):new Zj[c.type](c,n,o,u)},i.cw=xo,i.cx=class extends Gg{constructor(c,n){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=n.target,this.namespace=n.namespace,n.properties&&(this.properties=n.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},i.cy=ro,i.cz=ua,i.d=function(c){return he.API_TILEJSON_REGEX.test(c)},i.d$=IM,i.d0=ds,i.d1=(c,n,o,u,f,h,_,w)=>{const T=c.transform,P=T.pitch<15?_C(.07,.7,Ln((14-T.zoom)/5,0,1)):.07,x=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:vC(c,n,o,u),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:f,u_width_scale:h,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:yC(n,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(x?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:m(n.tileID.canonical,0)}},i.d2=(c,n,o,u,f,h,_,w,T)=>{const P=c.transform,x=P.calculatePixelsToTileUnitsMatrix(n),A=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",I=P.pitch<15?_C(.07,.7,Ln((14-P.zoom)/5,0,1)):.07;return{u_matrix:vC(c,n,o,u),u_pixels_to_tile_units:x,u_device_pixel_ratio:h,u_width_scale:_,u_floor_width_scale:w,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:bC(o)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:yC(n,c.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(A?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:m(n.tileID.canonical,0)}},i.d3=Kn,i.d4=L0,i.d5=P0,i.d6=aC,i.d7=_n,i.d8=c1,i.d9=zf,i.dA=o1,i.dB=Un,i.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.dD=pr,i.dE=Uw,i.dF=Ud,i.dG=function([c,n,o]){const u=Math.hypot(c,n,o),f=Math.atan2(c,o),h=.5*Math.PI-Math.acos(-n/u);return new ni(bn(f),bn(h))},i.dH=P2,i.dI=function(c){const n=c.navigator?c.navigator.userAgent:null;return!!function(o){if(ns==null){const u=o.navigator?o.navigator.userAgent:null;ns=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return ns}(c)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dJ=function(c,n){$n=c,er=n},i.dK=tl,i.dL=ac,i.dM=function(c){const n=[0,0,0],o=me.mat4.identity(new Float64Array(16));return me.mat4.multiply(o,c.pixelMatrix,c.globeMatrix),me.vec3.transformMat4(n,n,o),new $t(n[0],n[1])},i.dN=function(c,n,o=!1){if(oi===ki||oi===mi||oi===Ti)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ai=Lt.resolveURL(c),oi=ki,gi=n,xs(),o||ea()},i.dO=bs,i.dP=function(){R1().acquire(D2)},i.dQ=function(){const c=ey;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(D2),ey=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dR=Em,i.dS=function(c){const n=Si();if(!n)return;const o=n.delete(yn);c&&o.catch(c).then(()=>c())},i.dT=Q0,i.dU=xM,i.dV=function(c){q2=Lt.resolveURL(c),$g||($g=new Bg(R1(),new Ta)),$g.broadcast("setDracoUrl",q2)},i.dW=bM,i.dX=function(c){qg=Lt.resolveURL(c),$g||($g=new Bg(R1(),new Ta)),$g.broadcast("setMeshoptUrl",qg)},i.dY=Ze,i.dZ=Nf,i.d_=Zu,i.da=450,i.db=7,i.dc=Oj,i.dd=Or,i.de=Tg,i.df=256,i.dg=Qs,i.dh=ka,i.di=zs,i.dj=Ll,i.dk=function(c,n,o,u,f){return Ln((c-n)/(o-n)*(f-u)+u,u,f)},i.dl=Qp,i.dm=jh,i.dn=class{constructor(c,n,o,u){this.context=c,this.format=u,this.size=o,this.texture=c.gl.createTexture();const[f,h,_]=this.size,{gl:w}=c;w.bindTexture(w.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,f,h,_,0,T2(this.format),A2(this.format),n.data)}bind(c,n){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},i.dp=M2,i.dq=[1,1,1],i.dr=Fg,i.ds=zg,i.dt=kc,i.du=Vu,i.dv=Vd,i.dw=zd,i.dx=Dh,i.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new $t(1/0,1/0),max:new $t(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,n=!1){const o=$E(new $t(0,0),new $t(un,un),c),u=[];if(n&&!e2(o,this._globalClipBounds))return u;for(const f of this._activeRegions){if(f.hiddenByOverlap||!e2(o,f))continue;const h=IB(f.min,f.max,c);u.push({min:h.min,max:h.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return u}setSources(c){this._setSources(c.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const o=[];for(const u of n.cache.getVisibleCoordinates()){const f=n.cache.getTile(u).buckets[n.layer];f&&f.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(c){const n=c.getFootprints();if(n.length===0)return;const o=c.getOrder(),u=c.getClipMask(),f=c.getClipScope();for(const h of n){if(!h.footprint)continue;const _=$E(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:o,clipMask:u,clipScope:f})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,o)=>n.priority-o.priority||a1(n.min,o.min)||a1(n.max,o.max)||n.order-o.order||n.clipMask-o.clipMask||function(u,f){const h=(_,w)=>_+w;return u.length-f.length||u.reduce(h,"").localeCompare(f.reduce(h,""))}(n.clipScope,o.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let n=0;for(;!c&&n!==this._activeRegions.length;){const o=this._activeRegions[n],u=this._prevRegions[n];c=o.priority!==u.priority||!qE(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!cn(o.clipScope,u.clipScope),++n}}if(c){++this._updateTime;for(const o of this._activeRegions)o.order!==o1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const n=o=>{const u=this._activeRegions;if(o>=u.length)return o;const f=u[o].priority;for(;o<u.length&&u[o].priority===f;)++o;return o};if(this._sourceIds.length>1){let o=0,u=n(o);for(;o!==u;){let f=o;const h=o;for(;f!==u;){const _=this._activeRegions[f];_.hiddenByOverlap=!1;for(let w=0;w<h;w++){const T=this._activeRegions[w];if(!T.hiddenByOverlap&&_.order===o1&&e2(_,T)&&(_.hiddenByOverlap=HE(_.footprint,_.tileId,T.footprint,T.tileId),_.hiddenByOverlap))break}++f}o=u,u=n(o)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=c.length-1;n>=0;n--)this._addSource(c[n]);this._computeReplacement()}},i.dz=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,n){const o=new ic,u=new Os,f=[],h=c+1+2,_=n[0]+1,w=n[0]+1+(1+n.length),T=(P,x,A)=>{let I=P===h-1?P-2:P===0?P:P-1;return I+=A?24575:0,[I,x]};for(let P=0;P<h;++P)o.emplaceBack(...T(P,0,!0));for(let P=0;P<_;++P)for(let x=0;x<h;++x)o.emplaceBack(...T(x,P,(x===0||x===h-1)&&!0));for(let P=0;P<n.length;++P){const x=n[P];for(let A=0;A<h;++A)o.emplaceBack(...T(A,x,!0))}for(let P=0;P<n.length;++P){const x=u.length,A=n[P]+1+2,I=new Os;for(let R=0;R<A-1;R++){const j=R===A-2,$=j?h*(w-n.length+P-R):h;for(let Y=0;Y<h-1;Y++){const X=R*h+Y;R===0||j||Y===0||Y===h-2?(I.emplaceBack(X+1,X,X+$),I.emplaceBack(X+$,X+$+1,X+1)):(u.emplaceBack(X+1,X,X+$),u.emplaceBack(X+$,X+$+1,X+1))}}const C=qi.simpleSegment(0,x,o.length,u.length-x);for(let R=0;R<I.uint16.length;R+=3)u.emplaceBack(I.uint16[R],I.uint16[R+1],I.uint16[R+2]);const M=qi.simpleSegment(0,x,o.length,u.length-x);f.push({withoutSkirts:C,withSkirts:M})}return{vertices:o,indices:u,segments:f}}_createGrid(c){const n=this._fillGridMeshWithLods(kf,Cg);this._gridSegments=n.segments,this._gridBuffer=c.createVertexBuffer(n.vertices,Vn.members),this._gridIndexBuffer=c.createIndexBuffer(n.indices,!0)}_createPoles(c){const n=new Os;for(let _=0;_<=kf;_++)n.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=c.createIndexBuffer(n,!0);const o=new zs,u=new zs,f=new zs,h=new zs;this._poleSegments=[];for(let _=0,w=0;_<Lf;_++){const T=360/(1<<_);o.emplaceBack(0,-ya,0,.5,0),u.emplaceBack(0,-ya,0,.5,1),f.emplaceBack(0,-ya,0,.5,.5),h.emplaceBack(0,-ya,0,.5,.5);for(let P=0;P<=kf;P++){let x=P/kf,A=0;const I=Bn(0,T,x),[C,M,R]=Rf(hu,Gu,I,ya);o.emplaceBack(C,M,R,x,A),u.emplaceBack(C,M,R,x,1-A);const j=En(I);x=.5+.5*Math.sin(j),A=.5+.5*Math.cos(j),f.emplaceBack(C,M,R,x,A),h.emplaceBack(C,M,R,x,1-A)}this._poleSegments.push(qi.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(o,Dn,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,Dn,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(f,Dn,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(h,Dn,!1)}getGridBuffers(c,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},i.e=he,i.e0=LM,i.e1=fC,i.e2=bm,i.e3="hd_road_elevation",i.e4=class{static parseFrom(c,n){const o=qd.parse(c);if(!o)return[];let{vertices:u,features:f}=o;const h=1/m(n);f.sort((P,x)=>P.id-x.id),u.sort((P,x)=>P.id-x.id||P.idx-x.idx),u=u.filter((P,x,A)=>x===A.findIndex(I=>I.id===P.id&&I.idx===P.idx));const _=new Array;let w=0;const T=u.length;for(const P of f){if(P.constantHeight){_.push(new Xw(P.id,P.bounds,P.constantHeight));continue}for(;w!==T&&u[w].id<P.id;)w++;if(w===T||u[w].id!==P.id)continue;const x=new Array,A=new Array,I=w;for(;w!==T&&u[w].id===P.id;){const C=u[w];if(x.push({position:C.position,height:C.height,extent:C.extent}),w!==I&&u[w-1].idx===C.idx-1){const M=w-I;A.push({a:M-1,b:M})}w++}_.push(new Xw(P.id,P.bounds,void 0,x,A,h))}return _}},i.e5=fi,i.e6=wm,i.e7=qC,i.e8=Rg,i.e9=function(c,n,o,u,f,h,_,w=1,T){c.createArrays(),c.tilePixelRatio=un/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const P=c.layers[0].layout,x=c.layers[0]._unevaluatedLayout._values,A={};A.scaleFactor=w,A.textSizeScaleRange=P.get("text-size-scale-range"),A.iconSizeScaleRange=P.get("icon-size-scale-range");const[I,C]=A.textSizeScaleRange,[M,R]=A.iconSizeScaleRange;A.textScaleFactor=Ln(A.scaleFactor,I,C),A.iconScaleFactor=Ln(A.scaleFactor,M,R);const j=x["text-size"],$=x["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:ue,maxZoom:Ce}=c.textSizeData;A.compositeTextSizes=[j.possiblyEvaluate(new Nr(ue),h),j.possiblyEvaluate(new Nr(Ce),h)]}if(c.iconSizeData.kind==="composite"){const{minZoom:ue,maxZoom:Ce}=c.iconSizeData;A.compositeIconSizes=[$.possiblyEvaluate(new Nr(ue),h),$.possiblyEvaluate(new Nr(Ce),h)]}A.layoutTextSize=j.possiblyEvaluate(new Nr(_+1),h),A.layoutIconSize=$.possiblyEvaluate(new Nr(_+1),h),A.textMaxSize=j.possiblyEvaluate(new Nr(18),h);const Y=P.get("symbol-placement"),X=P.get("text-rotation-alignment")==="map"&&Y!=="point",Z=P.get("text-size");let re=!1;const ae=[];for(const ue of c.features){const Ce=P.get("text-font").evaluate(ue,{},h).join(","),we=Z.evaluate(ue,{},h)*A.textScaleFactor,Se=A.layoutTextSize.evaluate(ue,{},h)*A.textScaleFactor,He=A.layoutIconSize.evaluate(ue,{},h)*A.iconScaleFactor,Pe={horizontal:{},vertical:void 0},We=ue.text;let st,tt=[0,0];if(We){const rn=We.toString(),jn=P.get("text-letter-spacing").evaluate(ue,{},h)*$o,Sn=P.get("text-line-height").evaluate(ue,{},h)*$o,kn=Ut(rn)?jn:0,Qn=P.get("text-anchor").evaluate(ue,{},h),gr=P.get("text-variable-anchor");if(!gr){const Jr=P.get("text-radial-offset").evaluate(ue,{},h);tt=Jr?XC(Qn,[Jr*$o,m2]):P.get("text-offset").evaluate(ue,{},h).map(Ei=>Ei*$o)}let sr=X?"center":P.get("text-justify").evaluate(ue,{},h);const Sr=Y==="point",fr=Sr?P.get("text-max-width").evaluate(ue,{},h)*$o:1/0,Er=Jr=>{c.allowVerticalPlacement&&Ot(rn)&&(Pe.vertical=d2(We,n,o,f,Ce,fr,Sn,Qn,Jr,kn,tt,Nl.vertical,!0,Se,we,T))};if(!X&&gr){const Jr=sr==="auto"?gr.map(tr=>g2(tr)):[sr];let Ei=!1;for(let tr=0;tr<Jr.length;tr++){const kr=Jr[tr];if(!Pe.horizontal[kr])if(Ei)Pe.horizontal[kr]=Pe.horizontal[0];else{const Fi=d2(We,n,o,f,Ce,fr,Sn,"center",kr,kn,tt,Nl.horizontal,!1,Se,we,T);Fi&&(Pe.horizontal[kr]=Fi,Ei=Fi.positionedLines.length===1)}}Er("left")}else{if(sr==="auto"&&(sr=g2(Qn)),Sr||P.get("text-writing-mode").indexOf("horizontal")>=0||!Ot(rn)){const Jr=d2(We,n,o,f,Ce,fr,Sn,Qn,sr,kn,tt,Nl.horizontal,!1,Se,we,T);Jr&&(Pe.horizontal[sr]=Jr)}Er(Sr?"left":sr)}}let ft,ht,bt,gt,At,en=!1;if(ue.icon&&ue.icon.hasPrimary()){const rn=JC(ue.icon,c.iconSizeData,x["icon-size"],h,c.zoom,ue,T,A.iconScaleFactor);ft=rn.iconPrimary,ht=rn.iconSecondary;const jn=ft.toString(),Sn=u.get(jn);Sn&&(bt=P.get("icon-offset").evaluate(ue,{},h),gt=P.get("icon-anchor").evaluate(ue,{},h),At=P.get("icon-text-fit").evaluate(ue,{},h),st=pj(f.get(jn),ht?f.get(ht.toString()):void 0,bt,gt),en=Sn.sdf,c.sdfIcons===void 0?c.sdfIcons=Sn.sdf:c.sdfIcons!==Sn.sdf&&pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Sn.pixelRatio!==c.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}re=re||!(!ue.icon||!ue.icon.hasSecondary());const Jt=_2(Pe.horizontal)||Pe.vertical;c.iconsInText||(c.iconsInText=!!Jt&&Jt.iconsInText);const An=Se*A.textScaleFactor/$o,{defaultShapedIcon:on,verticallyShapedIcon:hn}=wj(c,st,P,ue,h,Pe,An,bt,At);st=on,ae.push({feature:ue,shapedTextOrientations:Pe,shapedText:Jt,shapedIcon:st,iconPrimary:ft,iconSecondary:ht,iconOffset:bt,iconAnchor:gt,verticallyShapedIcon:hn,layoutTextSize:Se,layoutIconSize:He,textOffset:tt,isSDFIcon:en,iconTextFit:At})}return{featureData:ae,sizes:A,hasAnySecondaryIcon:re,textAlongLine:X,symbolPlacement:Y}},i.ea=$C,i.eb=function(c,n,o,u,f,h,_,w,T,P){const{featureData:x,hasAnySecondaryIcon:A,sizes:I,textAlongLine:C,symbolPlacement:M}=n;for(const R of x){const{shapedIcon:j,verticallyShapedIcon:$,feature:Y,shapedTextOrientations:X,shapedText:Z,layoutTextSize:re,textOffset:ae,isSDFIcon:ue,iconPrimary:Ce,iconSecondary:we,iconTextFit:Se,iconOffset:He}=R;QC(j,P.iconPositions,Ce,we),QC($,P.iconPositions,Ce,we),bj(X,P.iconPositions),(Z||j)&&Sj(c,Y,X,j,$,T,I,re,0,ae,ue,u,f,_,w,A,Se,He,C,M)}o&&c.generateCollisionDebugBuffers(h,c.collisionBoxArray,I.textScaleFactor)},i.ec=Of,i.ed=j1,i.ee=On,i.ef=IE,i.eg=PC,i.eh=E,i.ei=function(c){let n=0;if(new Uint32Array(c,0,1)[0]!==SM){const o=new Uint32Array(c,0,7),[,,u,f,h,_]=o;n=o.byteLength+f+h+_+h,(u!==c.byteLength||n>=c.byteLength)&&pi("Invalid b3dm header information.")}return CM(c,n)},i.ej=function(c,n){const o=MM(c);for(const u of o){for(const f of u.meshes)Y8(f);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(J8(u.lights,n)))}return o},i.ek=k1,i.el=VP,i.em=ci,i.en=function(c){mr(),ur!=null&&ur.then(n=>{n.keys().then(o=>{for(let u=0;u<o.length-c;u++)n.delete(o[u])})})},i.f=function(c){return c.indexOf("mapbox:")===0},i.g=function(c,n){return ua(si(c,{method:"GET"}),n)},i.h=_e,i.i=function(c){return he.API_STYLE_REGEX.test(c)&&!Oe(c)},i.j=function(c){return decodeURIComponent(atob(c).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(n,o)=>String.fromCharCode(+("0x"+o))))},i.l=si,i.m=Xr,i.n=function(c,n){return ua(si(c,{type:"json"}),n)},i.o=dd,i.p=function(c,n){return ua(si(c,{method:"POST"}),n)},i.q=Lt,i.r=qo,i.s=function(c){try{const n=self[c];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=Nt,i.u=function(){return function c(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},i.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},i.w=pi,i.x=function(){return N2||(N2=new Em),N2},i.y=B2,i.z=Yc}),g(["./shared"],function(i){function E(Dt){const he=Dt?Dt.url.toString():void 0;return he?performance.getEntriesByName(he):[]}function k(Dt){if(typeof Dt=="number"||typeof Dt=="boolean"||typeof Dt=="string"||Dt==null)return JSON.stringify(Dt);if(Array.isArray(Dt)){let _e="[";for(const Oe of Dt)_e+=`${k(Oe)},`;return`${_e}]`}let he="{";for(const _e of Object.keys(Dt).sort())he+=`${_e}:${k(Dt[_e])},`;return`${he}}`}function O(Dt){let he="";for(const _e of i.bm)(Dt.type!=="model"||_e!=="minzoom"&&_e!=="maxzoom")&&(he+=`/${k(Dt[_e])}`);return he}class z{constructor(he){this.keyCache={},this._layers={},this._layerConfigs={},he&&this.replace(he)}replace(he,_e){this._layerConfigs={},this._layers={},this.update(he,[],_e)}update(he,_e,Oe){this._options=Oe;for(const qe of he)this._layerConfigs[qe.id]=qe,(this._layers[qe.id]=i.cv(qe,this.scope,null,this._options)).compileFilter(Oe),this.keyCache[qe.id]&&delete this.keyCache[qe.id];for(const qe of _e)delete this.keyCache[qe],delete this._layerConfigs[qe],delete this._layers[qe];this.familiesBySource={};const Ye=function(qe,at){const wt={};for(let Mt=0;Mt<qe.length;Mt++){const Nt=qe[Mt];let Lt=at&&at[Nt.id];!Lt&&(Lt=O(Nt),Nt.type==="line"&&Nt.paint)&&function pn(yn){return typeof yn=="string"&&yn==="line-progress"||(Array.isArray(yn)?yn.some(pn):!(!yn||typeof yn!="object")&&Object.values(yn).some(pn))}(Nt.paint["line-width"])&&(Lt+=`/${k(Nt.paint["line-width"])}`),at&&(at[Nt.id]=Lt);let sn=wt[Lt];sn||(sn=wt[Lt]=[]),sn.push(Nt)}const ct=[];for(const Mt in wt)ct.push(wt[Mt]);return ct}(Object.values(this._layerConfigs),this.keyCache);for(const qe of Ye){const at=qe.map(sn=>this._layers[sn.id]),wt=at[0];if(wt.visibility==="none")continue;const ct=wt.source||"";let Mt=this.familiesBySource[ct];Mt||(Mt=this.familiesBySource[ct]={});const Nt=wt.sourceLayer||"_geojsonTileLayer";let Lt=Mt[Nt];Lt||(Lt=Mt[Nt]=[]),Lt.push(at)}}}const G=1*i.d_;class U{constructor(he){const _e={},Oe=[];for(const wt in he){const ct=he[wt],Mt=_e[wt]={};for(const Nt in ct.glyphs){const Lt=ct.glyphs[+Nt];if(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)continue;const sn=Lt.metrics.localGlyph?G:1,pn={x:0,y:0,w:Lt.bitmap.width+2*sn,h:Lt.bitmap.height+2*sn};Oe.push(pn),Mt[Nt]=pn}}const{w:Ye,h:qe}=i.H(Oe),at=new i.dZ({width:Ye||1,height:qe||1});for(const wt in he){const ct=he[wt];for(const Mt in ct.glyphs){const Nt=ct.glyphs[+Mt];if(!Nt||Nt.bitmap.width===0||Nt.bitmap.height===0)continue;const Lt=_e[wt][Mt],sn=Nt.metrics.localGlyph?G:1;i.dZ.copy(Nt.bitmap,at,{x:0,y:0},{x:Lt.x+sn,y:Lt.y+sn},Nt.bitmap)}}this.image=at,this.positions=_e}}i.dY(U,"GlyphAtlas");class ie{constructor(he){this.tileID=new i.aH(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),this.tileZoom=he.tileZoom,this.uid=he.uid,this.zoom=he.zoom,this.lut=he.lut,this.canonical=he.tileID.canonical,this.pixelRatio=he.pixelRatio,this.tileSize=he.tileSize,this.source=he.source,this.scope=he.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=he.showCollisionBoxes,this.collectResourceTiming=!!he.request&&he.request.collectResourceTiming,this.promoteId=he.promoteId,this.isSymbolTile=he.isSymbolTile,this.tileTransform=i.aR(he.tileID.canonical,he.projection),this.projection=he.projection,this.worldview=he.worldview,this.localizableLayerIds=he.localizableLayerIds,this.brightness=he.brightness,this.extraShadowCaster=!!he.extraShadowCaster,this.tessellationStep=he.tessellationStep,this.scaleFactor=he.scaleFactor}parse(he,_e,Oe,Ye,qe){this.status="parsing",this.data=he,this.collisionBoxArray=new i.aX;const at=new i.d$(Object.keys(he.layers).sort()),wt=new i.e0(this.tileID,this.promoteId);wt.bucketLayerIDs=[];const ct={},Mt=new i.e1(256,256),Nt={featureIndex:wt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Mt,availableImages:Oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Lt=_e.familiesBySource[this.source];for(const mr in Lt){const Vr=he.layers[mr];if(!Vr)continue;let Xr=!1,ti=!1,Oi=!1;for(const fo of Lt[mr])fo[0].type==="symbol"?Xr=!0:ti=!0,fo[0].is3D()&&fo[0].type!=="model"&&(Oi=!0);if(this.extraShadowCaster&&!Oi||this.isSymbolTile===!0&&!Xr||this.isSymbolTile===!1&&!ti)continue;Vr.version===1&&i.w(`Vector tile source "${this.source}" layer "${mr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ms=at.encode(mr),to=[];let No=!1;for(let fo=0,gs=0;fo<Vr.length;fo++){const Ds=Vr.feature(fo),gl=wt.getId(Ds,mr);if(this.localizableLayerIds&&this.localizableLayerIds.has(mr)){const ua=Ds.properties?Ds.properties.worldview:null;if(this.worldview&&typeof ua=="string")if(ua==="all")Ds.properties.$localized=!0;else{if(!ua.split(",").includes(this.worldview))continue;Ds.properties.$localized=!0,Ds.properties.worldview=this.worldview}}!No&&Ds.properties&&Ds.properties.hasOwnProperty(i.e2)&&(No=!0),to.push({feature:Ds,id:gl,index:gs,sourceLayerIndex:ms}),gs++}No&&!Nt.elevationFeatures&&he.layers.hasOwnProperty(i.e3)&&(Nt.elevationFeatures=i.e4.parseFrom(he.layers[i.e3],this.canonical));for(const fo of Lt[mr]){const gs=fo[0];(!this.extraShadowCaster||gs.is3D()&&gs.type!=="model")&&(this.isSymbolTile!==void 0&&gs.type==="symbol"!==this.isSymbolTile||gs.minzoom&&this.zoom<Math.floor(gs.minzoom)||gs.maxzoom&&this.zoom>=gs.maxzoom||gs.visibility!=="none"&&(Q(fo,this.zoom,Nt.brightness,Oe),(ct[gs.id]=gs.createBucket({index:wt.bucketLayerIDs.length,layers:fo,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ms,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(to,Nt,this.tileID.canonical,this.tileTransform),wt.bucketLayerIDs.push(fo.map(Ds=>i.C(Ds.id,Ds.scope)))))}}let sn,pn,yn,$n,er,or;Mt.trim();const ur={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},li=()=>{if(sn)return this.status="done",qe(sn);if(this.extraShadowCaster)this.status="done",qe(null,{buckets:Object.values(ct).filter(mr=>!mr.isEmpty()),featureIndex:wt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Nt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(pn&&yn&&$n){const mr=new U(pn),Vr=new Map;for(const[Oi,ms]of yn.entries()){const{imagePosition:to}=i.e7(Oi,ms,i.e8);Vr.set(Oi,to)}const Xr={};for(const Oi in ct){const ms=ct[Oi];ms instanceof i.aY&&(Q(ms.layers,this.zoom,Nt.brightness,Oe),Xr[Oi]=i.e9(ms,pn,mr.positions,yn,Vr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const ti={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ye,yn,er,()=>{ti.iconsPending=!1,Si(Xr,mr,ti)}),this.rasterizeIfNeeded(Ye,$n,or,()=>{ti.patternsPending=!1,Si(Xr,mr,ti)})}},Si=(mr,Vr,Xr,ti)=>{if(Xr.iconsPending||Xr.patternsPending)return;const Oi=new i.ea(yn,$n,this.lut);for(const ms in ct){const to=ct[ms];if(ms in mr)i.eb(to,mr[ms],this.showCollisionBoxes,Oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,yn,Oi);else if(to.hasPattern&&(to instanceof i.b2||to instanceof i.b3||to instanceof i.d8)){Q(to.layers,this.zoom,Nt.brightness,Oe);const No=Object.fromEntries(Oi.patternPositions);to.addFeatures(Nt,this.tileID.canonical,No,Oe,this.tileTransform,this.brightness)}}this.status="done",qe(null,{buckets:Object.values(ct).filter(ms=>!ms.isEmpty()),featureIndex:wt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vr.image,lineAtlas:Mt,imageAtlas:Oi,brightness:Nt.brightness})};if(!this.extraShadowCaster){const mr=i.e5(Nt.glyphDependencies,ti=>Object.keys(ti).map(Number));Object.keys(mr).length?Ye.send("getGlyphs",{uid:this.uid,stacks:mr,scope:this.scope},(ti,Oi)=>{sn||(sn=ti,pn=Oi,li())},void 0,!1,ur):pn={};const Vr=Array.from(Nt.iconDependencies.keys()).map(ti=>i.I.parse(ti));Vr.length?Ye.send("getImages",{images:Vr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ti,Oi)=>{sn||(sn=ti,yn=new Map,er=this.updateImageMapAndGetImageTaskQueue(yn,Oi,Nt.iconDependencies),li())},void 0,!1,ur):(yn=new Map,er=new Map);const Xr=Array.from(Nt.patternDependencies.keys()).map(ti=>i.I.parse(ti));Xr.length?Ye.send("getImages",{images:Xr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ti,Oi)=>{sn||(sn=ti,$n=new Map,or=this.updateImageMapAndGetImageTaskQueue($n,Oi,Nt.patternDependencies),li())},void 0,!1,ur):($n=new Map,or=new Map)}if(Nt.elevationFeatures&&Nt.elevationFeatures.length>0){const mr=[];for(const Xr of Object.values(ct))if(Xr instanceof i.b3){const ti=Xr.getUnevaluatedPortalGraph();ti&&mr.push(ti)}const Vr=i.e6.evaluate(mr);for(const Xr of Object.values(ct))Xr instanceof i.b3&&Xr.setEvaluatedPortalGraph(Vr)}li()}rasterizeIfNeeded(he,_e,Oe,Ye){Array.from(_e.values()).some(qe=>qe.usvg)?this.rasterize(he,_e,Oe,Ye):Ye()}updateImageMapAndGetImageTaskQueue(he,_e,Oe){const Ye=new Map;for(const qe of _e.keys()){const at=Oe.get(qe)||[];for(const wt of at){const ct=wt.toString(),Mt=_e.get(wt.id.toString());Mt.usvg?Ye.has(ct)||(Ye.set(ct,wt),he.set(ct,Object.assign({},Mt))):he.set(ct,Mt)}}return Ye}rasterize(he,_e,Oe,Ye){this.rasterizeTask=he.send("rasterizeImages",{scope:this.scope,tasks:Oe},(qe,at)=>{if(!qe)for(const[wt,ct]of at.entries()){const Mt=Object.assign(_e.get(wt),{data:ct});_e.set(wt,Mt)}Ye()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Q(Dt,he,_e,Oe){const Ye=new i.aa(he,{brightness:_e});for(const qe of Dt)qe.recalculate(Ye,Oe)}class se extends i.E{constructor(he,_e,Oe,Ye,qe,at){super(),this.actor=he,this.layerIndex=_e,this.availableImages=Oe,this.loadVectorData=qe||i.aE,this.loading={},this.loaded={},this.deduped=new i.aD(he.scheduler),this.isSpriteLoaded=Ye,this.scheduler=he.scheduler,this.brightness=at}loadTile(he,_e){const Oe=he.uid,Ye=he&&he.request,qe=Ye&&Ye.collectResourceTiming,at=this.loading[Oe]=new ie(he);at.abort=this.loadVectorData(he,(wt,ct)=>{const Mt=!this.loading[Oe];if(delete this.loading[Oe],at.cancelRasterize(),Mt||wt||!ct)return at.status="done",Mt||(this.loaded[Oe]=at),_e(wt);const Nt=ct.rawData,Lt={};ct.expires&&(Lt.expires=ct.expires),ct.cacheControl&&(Lt.cacheControl=ct.cacheControl),at.vectorTile=ct.vectorTile||new i.ec.VectorTile(new i.bi(Nt));const sn=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,(pn,yn)=>{if(pn||!yn)return _e(pn);const $n={};if(qe){const er=E(Ye);er.length>0&&($n.resourceTiming=JSON.parse(JSON.stringify(er)))}_e(null,i.l({rawTileData:Nt.slice(0)},yn,Lt,$n))})};this.isSpriteLoaded?sn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(sn,{type:"parseTile",isSymbolTile:he.isSymbolTile,zoom:he.tileZoom}):sn()}),this.loaded=this.loaded||{},this.loaded[Oe]=at})}reloadTile(he,_e){const Oe=this.loaded,Ye=he.uid;if(Oe&&Oe[Ye]){const qe=Oe[Ye];qe.scaleFactor=he.scaleFactor,qe.showCollisionBoxes=he.showCollisionBoxes,qe.projection=he.projection,qe.brightness=he.brightness,qe.tileTransform=i.aR(he.tileID.canonical,he.projection),qe.extraShadowCaster=he.extraShadowCaster,qe.lut=he.lut;const at=(wt,ct)=>{const Mt=qe.reloadCallback;Mt&&(delete qe.reloadCallback,qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,Mt)),_e(wt,ct)};qe.status==="parsing"?qe.reloadCallback=at:qe.status==="done"&&(qe.vectorTile?qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,at):at())}else _e(null,void 0)}abortTile(he,_e){const Oe=he.uid,Ye=this.loading[Oe];Ye&&(Ye.abort&&Ye.abort(),delete this.loading[Oe]),_e()}removeTile(he,_e){const Oe=this.loaded,Ye=he.uid;Oe&&Oe[Ye]&&delete Oe[Ye],_e()}}class J{loadTile(he,_e){const{uid:Oe,encoding:Ye,rawImageData:qe,padding:at}=he,wt=ImageBitmap&&qe instanceof ImageBitmap?this.getImageData(qe,at):qe;_e(null,new i.ed(Oe,wt,Ye,at<1))}reloadTile(he,_e){_e(null,null)}abortTile(he,_e){_e()}removeTile(he,_e){_e()}getImageData(he,_e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(he.width,he.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=he.width,this.offscreenCanvas.height=he.height,this.offscreenCanvasContext.drawImage(he,0,0,he.width,he.height);const Oe=this.offscreenCanvasContext.getImageData(-_e,-_e,he.width+2*_e,he.height+2*_e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Oe}}i.bh.setPbf(i.bi);class te{constructor(he){this._mrt=new i.bh(he.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=he.uid,this.tileID=he.tileID,this.source=he.source}parse(he,_e){const Oe=this._mrt;this.status="parsing",this._entireBuffer=he;try{Oe.parseHeader(he),this._isHeaderLoaded=!0;const Ye=[];for(const qe in Oe.layers){const at=Oe.getLayer(qe),wt=at.getDataRange(at.getBandList()),ct=Oe.createDecodingTask(wt),Mt=he.slice(wt.firstByte,wt.lastByte+1),Nt=i.bh.performDecoding(Mt,ct).then(Lt=>ct.complete(null,Lt)).catch(Lt=>ct.complete(Lt,null));Ye.push(Nt)}Promise.allSettled(Ye).then(()=>_e(null,Oe))}catch(Ye){_e(Ye)}}}class le{constructor(he){this.actor=he,this.loading={},this.loaded={}}loadTile(he,_e){const Oe=he.uid,Ye=he.request,qe=this.loading[Oe]=new te(he),{cancel:at}=i.bj(Ye,(wt,ct,Mt,Nt)=>{const Lt=!this.loading[Oe];if(delete this.loading[Oe],Lt||wt||!ct)return qe.status="done",Lt||(this.loaded[Oe]=qe),_e(wt);qe.parse(ct,(sn,pn)=>{if(sn||!pn)return _e(sn);_e(null,pn,Mt,Nt)}),this.loaded[Oe]=qe});qe.abort=at}reloadTile(he,_e){_e(null,void 0)}abortTile(he,_e){const Oe=he.uid,Ye=this.loading[Oe];Ye&&(Ye.abort&&Ye.abort(),delete this.loading[Oe]),_e()}removeTile(he,_e){const Oe=he.uid;this.loaded[Oe]&&delete this.loaded[Oe],_e()}decodeRasterArray({task:he,buffer:_e},Oe){i.bh.performDecoding(_e,he).then(Ye=>Oe(null,Ye)).catch(Ye=>Oe(Ye))}}const ye=i.ec.VectorTileFeature.prototype.toGeoJSON;class Ne{constructor(he){this._feature=he,this.extent=i.ai,this.type=he.type,this.properties=he.tags,"id"in he&&!isNaN(he.id)&&(this.id=parseInt(he.id,10))}loadGeometry(){if(this._feature.type===1){const he=[];for(const _e of this._feature.geometry)he.push([new i.P(_e[0],_e[1])]);return he}{const he=[];for(const _e of this._feature.geometry){const Oe=[];for(const Ye of _e)Oe.push(new i.P(Ye[0],Ye[1]));he.push(Oe)}return he}}toGeoJSON(he,_e,Oe){return ye.call(this,he,_e,Oe)}}class rt{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ai,this.length=he.length,this._features=he}feature(he){return new Ne(this._features[he])}}const xe=64/4096,Me=128;class it{constructor(){this.features=new Map}clear(){this.features.clear()}load(he=[],_e){for(const Oe of he){const Ye=Oe.id;if(Ye==null)continue;let qe=this.features.get(Ye);qe&&this.updateCache(qe,_e),Oe.geometry?(qe=ve(Oe),this.updateCache(qe,_e),this.features.set(Ye,qe)):this.features.delete(Ye),this.updateCache(qe,_e)}}updateCache(he,_e){for(const{canonical:Oe,uid:Ye}of Object.values(_e)){const{z:qe,x:at,y:wt}=Oe;ot(he,Math.pow(2,qe),at,wt)&&delete _e[Ye]}}getTile(he,_e,Oe){const Ye=Math.pow(2,he),qe=[];for(const at of this.features.values())ot(at,Ye,_e,Oe)&&qe.push(yt(at,Ye,_e,Oe));return{features:qe}}getFeatures(){return[...this.features.values()]}}function ot({minX:Dt,minY:he,maxX:_e,maxY:Oe},Ye,qe,at){return Dt<(qe+1+xe)/Ye&&he<(at+1+xe)/Ye&&_e>(qe-xe)/Ye&&Oe>(at-xe)/Ye}function ve(Dt){const{id:he,geometry:_e,properties:Oe}=Dt;if(!_e)return;if(_e.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ye,coordinates:qe}=_e,at={id:he,type:1,geometry:[],tags:Oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},wt=at.geometry;if(Ye==="Point")Le(qe,wt,at);else if(Ye==="MultiPoint")for(const ct of qe)Le(ct,wt,at);else if(Ye==="LineString")at.type=2,dt(qe,wt,at);else if(Ye==="MultiLineString")at.type=2,Je(qe,wt,at);else if(Ye==="Polygon")at.type=3,Je(qe,wt,at,!0);else{if(Ye!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");at.type=3;for(const ct of qe)Je(ct,wt,at,!0)}return at}function Le([Dt,he],_e,Oe){const Ye=i.av(Dt);let qe=i.aC(he);qe=qe<0?0:qe>1?1:qe,_e.push(Ye,qe),Oe.minX=Math.min(Oe.minX,Ye),Oe.minY=Math.min(Oe.minY,qe),Oe.maxX=Math.max(Oe.maxX,Ye),Oe.maxY=Math.max(Oe.maxY,qe)}function dt(Dt,he,_e,Oe=!1,Ye=!1){const qe=[];for(const at of Dt)Le(at,qe,_e);he.push(qe),Oe&&function(at,wt){let ct=0;for(let Mt=0,Nt=at.length,Lt=Nt-2;Mt<Nt;Lt=Mt,Mt+=2)ct+=(at[Mt]-at[Lt])*(at[Mt+1]+at[Lt+1]);if(ct>0===wt)for(let Mt=0,Nt=at.length;Mt<Nt/2;Mt+=2){const Lt=at[Mt],sn=at[Mt+1];at[Mt]=at[Nt-2-Mt],at[Mt+1]=at[Nt-1-Mt],at[Nt-2-Mt]=Lt,at[Nt-1-Mt]=sn}}(qe,Ye)}function Je(Dt,he,_e,Oe=!1){for(let Ye=0;Ye<Dt.length;Ye++)dt(Dt[Ye],he,_e,Oe,Ye===0)}function yt(Dt,he,_e,Oe){const{id:Ye,type:qe,geometry:at,tags:wt}=Dt,ct=[];if(qe===1)(function(Mt,Nt,Lt,sn,pn){for(let yn=0;yn<Mt.length;yn+=2){const $n=Math.round(i.ai*(Mt[yn+0]*Nt-Lt)),er=Math.round(i.ai*(Mt[yn+1]*Nt-sn));pn.push([$n,er])}})(at,he,_e,Oe,ct);else for(const Mt of at)St(Mt,he,_e,Oe,ct);return{id:Ye,type:qe,geometry:ct,tags:wt}}function St(Dt,he,_e,Oe,Ye){const qe=-Me,at=i.ai+Me;let wt;for(let ct=0;ct<Dt.length-2;ct+=2){let Mt=Math.round(i.ai*(Dt[ct+0]*he-_e)),Nt=Math.round(i.ai*(Dt[ct+1]*he-Oe)),Lt=Math.round(i.ai*(Dt[ct+2]*he-_e)),sn=Math.round(i.ai*(Dt[ct+3]*he-Oe));const pn=Lt-Mt,yn=sn-Nt;Mt<qe&&Lt<qe||(Mt<qe?(Nt+=Math.round(yn*((qe-Mt)/pn)),Mt=qe):Lt<qe&&(sn=Nt+Math.round(yn*((qe-Mt)/pn)),Lt=qe),Nt<qe&&sn<qe||(Nt<qe?(Mt+=Math.round(pn*((qe-Nt)/yn)),Nt=qe):sn<qe&&(Lt=Mt+Math.round(pn*((qe-Nt)/yn)),sn=qe),Mt>=at&&Lt>=at||(Mt>=at?(Nt+=Math.round(yn*((at-Mt)/pn)),Mt=at):Lt>=at&&(sn=Nt+Math.round(yn*((at-Mt)/pn)),Lt=at),Nt>=at&&sn>=at||(Nt>=at?(Mt+=Math.round(pn*((at-Nt)/yn)),Nt=at):sn>=at&&(Lt=Mt+Math.round(pn*((at-Nt)/yn)),sn=at),wt&&Mt===wt[wt.length-1][0]&&Nt===wt[wt.length-1][1]||(wt=[[Mt,Nt]],Ye.push(wt)),wt.push([Lt,sn])))))}}var jt,et,Qe,Xe={exports:{}},Vt=function(){if(Qe)return Xe.exports;Qe=1;var Dt=i.eg(),he=function(){if(et)return jt;et=1;var Nt=i.ee(),Lt=i.ef().VectorTileFeature;function sn(yn,$n){this.options=$n||{},this.features=yn,this.length=yn.length}function pn(yn,$n){this.id=typeof yn.id=="number"?yn.id:void 0,this.type=yn.type,this.rawGeometry=yn.type===1?[yn.geometry]:yn.geometry,this.properties=yn.tags,this.extent=$n||4096}return jt=sn,sn.prototype.feature=function(yn){return new pn(this.features[yn],this.options.extent)},pn.prototype.loadGeometry=function(){var yn=this.rawGeometry;this.geometry=[];for(var $n=0;$n<yn.length;$n++){for(var er=yn[$n],or=[],ur=0;ur<er.length;ur++)or.push(new Nt(er[ur][0],er[ur][1]));this.geometry.push(or)}return this.geometry},pn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var yn=this.geometry,$n=1/0,er=-1/0,or=1/0,ur=-1/0,li=0;li<yn.length;li++)for(var Si=yn[li],mr=0;mr<Si.length;mr++){var Vr=Si[mr];$n=Math.min($n,Vr.x),er=Math.max(er,Vr.x),or=Math.min(or,Vr.y),ur=Math.max(ur,Vr.y)}return[$n,or,er,ur]},pn.prototype.toGeoJSON=Lt.prototype.toGeoJSON,jt}();function _e(Nt){var Lt=new Dt;return function(sn,pn){for(var yn in sn.layers)pn.writeMessage(3,Oe,sn.layers[yn])}(Nt,Lt),Lt.finish()}function Oe(Nt,Lt){var sn;Lt.writeVarintField(15,Nt.version||1),Lt.writeStringField(1,Nt.name||""),Lt.writeVarintField(5,Nt.extent||4096);var pn={keys:[],values:[],keycache:{},valuecache:{}};for(sn=0;sn<Nt.length;sn++)pn.feature=Nt.feature(sn),Lt.writeMessage(2,Ye,pn);var yn=pn.keys;for(sn=0;sn<yn.length;sn++)Lt.writeStringField(3,yn[sn]);var $n=pn.values;for(sn=0;sn<$n.length;sn++)Lt.writeMessage(4,Mt,$n[sn])}function Ye(Nt,Lt){var sn=Nt.feature;sn.id!==void 0&&Lt.writeVarintField(1,sn.id),Lt.writeMessage(2,qe,Nt),Lt.writeVarintField(3,sn.type),Lt.writeMessage(4,ct,sn)}function qe(Nt,Lt){var sn=Nt.feature,pn=Nt.keys,yn=Nt.values,$n=Nt.keycache,er=Nt.valuecache;for(var or in sn.properties){var ur=sn.properties[or],li=$n[or];if(ur!==null){li===void 0&&(pn.push(or),$n[or]=li=pn.length-1),Lt.writeVarint(li);var Si=typeof ur;Si!=="string"&&Si!=="boolean"&&Si!=="number"&&(ur=JSON.stringify(ur));var mr=Si+":"+ur,Vr=er[mr];Vr===void 0&&(yn.push(ur),er[mr]=Vr=yn.length-1),Lt.writeVarint(Vr)}}}function at(Nt,Lt){return(Lt<<3)+(7&Nt)}function wt(Nt){return Nt<<1^Nt>>31}function ct(Nt,Lt){for(var sn=Nt.loadGeometry(),pn=Nt.type,yn=0,$n=0,er=sn.length,or=0;or<er;or++){var ur=sn[or],li=1;pn===1&&(li=ur.length),Lt.writeVarint(at(1,li));for(var Si=pn===3?ur.length-1:ur.length,mr=0;mr<Si;mr++){mr===1&&pn!==1&&Lt.writeVarint(at(2,Si-1));var Vr=ur[mr].x-yn,Xr=ur[mr].y-$n;Lt.writeVarint(wt(Vr)),Lt.writeVarint(wt(Xr)),yn+=Vr,$n+=Xr}pn===3&&Lt.writeVarint(at(7,1))}}function Mt(Nt,Lt){var sn=typeof Nt;sn==="string"?Lt.writeStringField(1,Nt):sn==="boolean"?Lt.writeBooleanField(7,Nt):sn==="number"&&(Nt%1!=0?Lt.writeDoubleField(3,Nt):Nt<0?Lt.writeSVarintField(6,Nt):Lt.writeVarintField(5,Nt))}return Xe.exports=_e,Xe.exports.fromVectorTileJs=_e,Xe.exports.fromGeojsonVt=function(Nt,Lt){Lt=Lt||{};var sn={};for(var pn in Nt)sn[pn]=new he(Nt[pn].features,Lt),sn[pn].name=pn,sn[pn].version=Lt.version,sn[pn].extent=Lt.extent;return _e({layers:sn})},Xe.exports.GeoJSONWrapper=he,Xe.exports}(),be=i.eh(Vt);const Re={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Dt=>Dt},Fe=Math.fround||(ut=new Float32Array(1),Dt=>(ut[0]=+Dt,ut[0]));var ut;const Et=3,Ct=5,Wt=6;class Ft{constructor(he){this.options=Object.assign(Object.create(Re),he),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(he){const{log:_e,minZoom:Oe,maxZoom:Ye}=this.options;_e&&console.time("total time");const qe=`prepare ${he.length} points`;_e&&console.time(qe),this.points=he;const at=[];for(let ct=0;ct<he.length;ct++){const Mt=he[ct];if(!Mt.geometry)continue;const[Nt,Lt]=Mt.geometry.coordinates,sn=Fe(Cn(Nt)),pn=Fe(On(Lt));at.push(sn,pn,1/0,ct,-1,1),this.options.reduce&&at.push(0)}let wt=this.trees[Ye+1]=this._createTree(at);_e&&console.timeEnd(qe);for(let ct=Ye;ct>=Oe;ct--){const Mt=+Date.now();wt=this.trees[ct]=this._createTree(this._cluster(wt,ct)),_e&&console.log("z%d: %d clusters in %dms",ct,wt.numItems,+Date.now()-Mt)}return _e&&console.timeEnd("total time"),this}getClusters(he,_e){let Oe=((he[0]+180)%360+360)%360-180;const Ye=Math.max(-90,Math.min(90,he[1]));let qe=he[2]===180?180:((he[2]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,he[3]));if(he[2]-he[0]>=360)Oe=-180,qe=180;else if(Oe>qe){const Lt=this.getClusters([Oe,Ye,180,at],_e),sn=this.getClusters([-180,Ye,qe,at],_e);return Lt.concat(sn)}const wt=this.trees[this._limitZoom(_e)],ct=wt.range(Cn(Oe),On(at),Cn(qe),On(Ye)),Mt=wt.data,Nt=[];for(const Lt of ct){const sn=this.stride*Lt;Nt.push(Mt[sn+Ct]>1?me(Mt,sn,this.clusterProps):this.points[Mt[sn+Et]])}return Nt}getChildren(he){const _e=this._getOriginId(he),Oe=this._getOriginZoom(he),Ye="No cluster with the specified id.",qe=this.trees[Oe];if(!qe)throw new Error(Ye);const at=qe.data;if(_e*this.stride>=at.length)throw new Error(Ye);const wt=this.options.radius/(this.options.extent*Math.pow(2,Oe-1)),ct=qe.within(at[_e*this.stride],at[_e*this.stride+1],wt),Mt=[];for(const Nt of ct){const Lt=Nt*this.stride;at[Lt+4]===he&&Mt.push(at[Lt+Ct]>1?me(at,Lt,this.clusterProps):this.points[at[Lt+Et]])}if(Mt.length===0)throw new Error(Ye);return Mt}getLeaves(he,_e,Oe){const Ye=[];return this._appendLeaves(Ye,he,_e=_e||10,Oe=Oe||0,0),Ye}getTile(he,_e,Oe){const Ye=this.trees[this._limitZoom(he)],qe=Math.pow(2,he),{extent:at,radius:wt}=this.options,ct=wt/at,Mt=(Oe-ct)/qe,Nt=(Oe+1+ct)/qe,Lt={features:[]};return this._addTileFeatures(Ye.range((_e-ct)/qe,Mt,(_e+1+ct)/qe,Nt),Ye.data,_e,Oe,qe,Lt),_e===0&&this._addTileFeatures(Ye.range(1-ct/qe,Mt,1,Nt),Ye.data,qe,Oe,qe,Lt),_e===qe-1&&this._addTileFeatures(Ye.range(0,Mt,ct/qe,Nt),Ye.data,-1,Oe,qe,Lt),Lt.features.length?Lt:null}getClusterExpansionZoom(he){let _e=this._getOriginZoom(he)-1;for(;_e<=this.options.maxZoom;){const Oe=this.getChildren(he);if(_e++,Oe.length!==1)break;he=Oe[0].properties.cluster_id}return _e}_appendLeaves(he,_e,Oe,Ye,qe){const at=this.getChildren(_e);for(const wt of at){const ct=wt.properties;if(ct&&ct.cluster?qe+ct.point_count<=Ye?qe+=ct.point_count:qe=this._appendLeaves(he,ct.cluster_id,Oe,Ye,qe):qe<Ye?qe++:he.push(wt),he.length===Oe)break}return qe}_createTree(he){const _e=new i.bE(he.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Oe=0;Oe<he.length;Oe+=this.stride)_e.add(he[Oe],he[Oe+1]);return _e.finish(),_e.data=he,_e}_addTileFeatures(he,_e,Oe,Ye,qe,at){for(const wt of he){const ct=wt*this.stride,Mt=_e[ct+Ct]>1;let Nt,Lt,sn;if(Mt)Nt=dn(_e,ct,this.clusterProps),Lt=_e[ct],sn=_e[ct+1];else{const $n=this.points[_e[ct+Et]];Nt=$n.properties;const[er,or]=$n.geometry.coordinates;Lt=Cn(er),sn=On(or)}const pn={type:1,geometry:[[Math.round(this.options.extent*(Lt*qe-Oe)),Math.round(this.options.extent*(sn*qe-Ye))]],tags:Nt};let yn;yn=Mt||this.options.generateId?_e[ct+Et]:this.points[_e[ct+Et]].id,yn!==void 0&&(pn.id=yn),at.features.push(pn)}}_limitZoom(he){return Math.max(this.options.minZoom,Math.min(Math.floor(+he),this.options.maxZoom+1))}_cluster(he,_e){const{radius:Oe,extent:Ye,reduce:qe,minPoints:at}=this.options,wt=Oe/(Ye*Math.pow(2,_e)),ct=he.data,Mt=[],Nt=this.stride;for(let Lt=0;Lt<ct.length;Lt+=Nt){if(ct[Lt+2]<=_e)continue;ct[Lt+2]=_e;const sn=ct[Lt],pn=ct[Lt+1],yn=he.within(ct[Lt],ct[Lt+1],wt),$n=ct[Lt+Ct];let er=$n;for(const or of yn){const ur=or*Nt;ct[ur+2]>_e&&(er+=ct[ur+Ct])}if(er>$n&&er>=at){let or,ur=sn*$n,li=pn*$n,Si=-1;const mr=(Lt/Nt<<5)+(_e+1)+this.points.length;for(const Vr of yn){const Xr=Vr*Nt;if(ct[Xr+2]<=_e)continue;ct[Xr+2]=_e;const ti=ct[Xr+Ct];ur+=ct[Xr]*ti,li+=ct[Xr+1]*ti,ct[Xr+4]=mr,qe&&(or||(or=this._map(ct,Lt,!0),Si=this.clusterProps.length,this.clusterProps.push(or)),qe(or,this._map(ct,Xr)))}ct[Lt+4]=mr,Mt.push(ur/er,li/er,1/0,mr,-1,er),qe&&Mt.push(Si)}else{for(let or=0;or<Nt;or++)Mt.push(ct[Lt+or]);if(er>1)for(const or of yn){const ur=or*Nt;if(!(ct[ur+2]<=_e)){ct[ur+2]=_e;for(let li=0;li<Nt;li++)Mt.push(ct[ur+li])}}}}return Mt}_getOriginId(he){return he-this.points.length>>5}_getOriginZoom(he){return(he-this.points.length)%32}_map(he,_e,Oe){if(he[_e+Ct]>1){const at=this.clusterProps[he[_e+Wt]];return Oe?Object.assign({},at):at}const Ye=this.points[he[_e+Et]].properties,qe=this.options.map(Ye);return Oe&&qe===Ye?Object.assign({},qe):qe}}function me(Dt,he,_e){return{type:"Feature",id:Dt[he+Et],properties:dn(Dt,he,_e),geometry:{type:"Point",coordinates:[(Oe=Dt[he],360*(Oe-.5)),$t(Dt[he+1])]}};var Oe}function dn(Dt,he,_e){const Oe=Dt[he+Ct],Ye=Oe>=1e4?`${Math.round(Oe/1e3)}k`:Oe>=1e3?Math.round(Oe/100)/10+"k":Oe,qe=Dt[he+Wt],at=qe===-1?{}:Object.assign({},_e[qe]);return Object.assign(at,{cluster:!0,cluster_id:Dt[he+Et],point_count:Oe,point_count_abbreviated:Ye})}function Cn(Dt){return Dt/360+.5}function On(Dt){const he=Math.sin(Dt*Math.PI/180),_e=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return _e<0?0:_e>1?1:_e}function $t(Dt){const he=(180-360*Dt)*Math.PI/180;return 360*Math.atan(Math.exp(he))/Math.PI-90}function cn(Dt,he,_e,Oe){let Ye=Oe;const qe=he+(_e-he>>1);let at,wt=_e-he;const ct=Dt[he],Mt=Dt[he+1],Nt=Dt[_e],Lt=Dt[_e+1];for(let sn=he+3;sn<_e;sn+=3){const pn=_t(Dt[sn],Dt[sn+1],ct,Mt,Nt,Lt);if(pn>Ye)at=sn,Ye=pn;else if(pn===Ye){const yn=Math.abs(sn-qe);yn<wt&&(at=sn,wt=yn)}}Ye>Oe&&(at-he>3&&cn(Dt,he,at,Oe),Dt[at+2]=Ye,_e-at>3&&cn(Dt,at,_e,Oe))}function _t(Dt,he,_e,Oe,Ye,qe){let at=Ye-_e,wt=qe-Oe;if(at!==0||wt!==0){const ct=((Dt-_e)*at+(he-Oe)*wt)/(at*at+wt*wt);ct>1?(_e=Ye,Oe=qe):ct>0&&(_e+=at*ct,Oe+=wt*ct)}return at=Dt-_e,wt=he-Oe,at*at+wt*wt}function yr(Dt,he,_e,Oe){const Ye={id:Dt??null,type:he,geometry:_e,tags:Oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(he==="Point"||he==="MultiPoint"||he==="LineString")En(Ye,_e);else if(he==="Polygon")En(Ye,_e[0]);else if(he==="MultiLineString")for(const qe of _e)En(Ye,qe);else if(he==="MultiPolygon")for(const qe of _e)En(Ye,qe[0]);return Ye}function En(Dt,he){for(let _e=0;_e<he.length;_e+=3)Dt.minX=Math.min(Dt.minX,he[_e]),Dt.minY=Math.min(Dt.minY,he[_e+1]),Dt.maxX=Math.max(Dt.maxX,he[_e]),Dt.maxY=Math.max(Dt.maxY,he[_e+1])}function bn(Dt,he,_e,Oe){if(!he.geometry)return;const Ye=he.geometry.coordinates;if(Ye&&Ye.length===0)return;const qe=he.geometry.type,at=Math.pow(_e.tolerance/((1<<_e.maxZoom)*_e.extent),2);let wt=[],ct=he.id;if(_e.promoteId?ct=he.properties[_e.promoteId]:_e.generateId&&(ct=Oe||0),qe==="Point")Fn(Ye,wt);else if(qe==="MultiPoint")for(const Mt of Ye)Fn(Mt,wt);else if(qe==="LineString")Gn(Ye,wt,at,!1);else if(qe==="MultiLineString"){if(_e.lineMetrics){for(const Mt of Ye)wt=[],Gn(Mt,wt,at,!1),Dt.push(yr(ct,"LineString",wt,he.properties));return}Un(Ye,wt,at,!1)}else if(qe==="Polygon")Un(Ye,wt,at,!0);else{if(qe!=="MultiPolygon"){if(qe==="GeometryCollection"){for(const Mt of he.geometry.geometries)bn(Dt,{id:ct,geometry:Mt,properties:he.properties},_e,Oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Mt of Ye){const Nt=[];Un(Mt,Nt,at,!0),wt.push(Nt)}}Dt.push(yr(ct,qe,wt,he.properties))}function Fn(Dt,he){he.push(pr(Dt[0]),Ln(Dt[1]),0)}function Gn(Dt,he,_e,Oe){let Ye,qe,at=0;for(let ct=0;ct<Dt.length;ct++){const Mt=pr(Dt[ct][0]),Nt=Ln(Dt[ct][1]);he.push(Mt,Nt,0),ct>0&&(at+=Oe?(Ye*Nt-Mt*qe)/2:Math.sqrt(Math.pow(Mt-Ye,2)+Math.pow(Nt-qe,2))),Ye=Mt,qe=Nt}const wt=he.length-3;he[2]=1,cn(he,0,wt,_e),he[wt+2]=1,he.size=Math.abs(at),he.start=0,he.end=he.size}function Un(Dt,he,_e,Oe){for(let Ye=0;Ye<Dt.length;Ye++){const qe=[];Gn(Dt[Ye],qe,_e,Oe),he.push(qe)}}function pr(Dt){return Dt/360+.5}function Ln(Dt){const he=Math.sin(Dt*Math.PI/180),_e=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return _e<0?0:_e>1?1:_e}function br(Dt,he,_e,Oe,Ye,qe,at,wt){if(Oe/=he,qe>=(_e/=he)&&at<Oe)return Dt;if(at<_e||qe>=Oe)return null;const ct=[];for(const Mt of Dt){const Nt=Mt.geometry;let Lt=Mt.type;const sn=Ye===0?Mt.minX:Mt.minY,pn=Ye===0?Mt.maxX:Mt.maxY;if(sn>=_e&&pn<Oe){ct.push(Mt);continue}if(pn<_e||sn>=Oe)continue;let yn=[];if(Lt==="Point"||Lt==="MultiPoint")Kr(Nt,yn,_e,Oe,Ye);else if(Lt==="LineString")hi(Nt,yn,_e,Oe,Ye,!1,wt.lineMetrics);else if(Lt==="MultiLineString")wr(Nt,yn,_e,Oe,Ye,!1);else if(Lt==="Polygon")wr(Nt,yn,_e,Oe,Ye,!0);else if(Lt==="MultiPolygon")for(const $n of Nt){const er=[];wr($n,er,_e,Oe,Ye,!0),er.length&&yn.push(er)}if(yn.length){if(wt.lineMetrics&&Lt==="LineString"){for(const $n of yn)ct.push(yr(Mt.id,Lt,$n,Mt.tags));continue}Lt!=="LineString"&&Lt!=="MultiLineString"||(yn.length===1?(Lt="LineString",yn=yn[0]):Lt="MultiLineString"),Lt!=="Point"&&Lt!=="MultiPoint"||(Lt=yn.length===3?"Point":"MultiPoint"),ct.push(yr(Mt.id,Lt,yn,Mt.tags))}}return ct.length?ct:null}function Kr(Dt,he,_e,Oe,Ye){for(let qe=0;qe<Dt.length;qe+=3){const at=Dt[qe+Ye];at>=_e&&at<=Oe&&Ur(he,Dt[qe],Dt[qe+1],Dt[qe+2])}}function hi(Dt,he,_e,Oe,Ye,qe,at){let wt=si(Dt);const ct=Ye===0?Kn:Hs;let Mt,Nt,Lt=Dt.start;for(let er=0;er<Dt.length-3;er+=3){const or=Dt[er],ur=Dt[er+1],li=Dt[er+2],Si=Dt[er+3],mr=Dt[er+4],Vr=Ye===0?or:ur,Xr=Ye===0?Si:mr;let ti=!1;at&&(Mt=Math.sqrt(Math.pow(or-Si,2)+Math.pow(ur-mr,2))),Vr<_e?Xr>_e&&(Nt=ct(wt,or,ur,Si,mr,_e),at&&(wt.start=Lt+Mt*Nt)):Vr>Oe?Xr<Oe&&(Nt=ct(wt,or,ur,Si,mr,Oe),at&&(wt.start=Lt+Mt*Nt)):Ur(wt,or,ur,li),Xr<_e&&Vr>=_e&&(Nt=ct(wt,or,ur,Si,mr,_e),ti=!0),Xr>Oe&&Vr<=Oe&&(Nt=ct(wt,or,ur,Si,mr,Oe),ti=!0),!qe&&ti&&(at&&(wt.end=Lt+Mt*Nt),he.push(wt),wt=si(Dt)),at&&(Lt+=Mt)}let sn=Dt.length-3;const pn=Dt[sn],yn=Dt[sn+1],$n=Ye===0?pn:yn;$n>=_e&&$n<=Oe&&Ur(wt,pn,yn,Dt[sn+2]),sn=wt.length-3,qe&&sn>=3&&(wt[sn]!==wt[0]||wt[sn+1]!==wt[1])&&Ur(wt,wt[0],wt[1],wt[2]),wt.length&&he.push(wt)}function si(Dt){const he=[];return he.size=Dt.size,he.start=Dt.start,he.end=Dt.end,he}function wr(Dt,he,_e,Oe,Ye,qe){for(const at of Dt)hi(at,he,_e,Oe,Ye,qe,!1)}function Ur(Dt,he,_e,Oe){Dt.push(he,_e,Oe)}function Kn(Dt,he,_e,Oe,Ye,qe){const at=(qe-he)/(Oe-he);return Ur(Dt,qe,_e+(Ye-_e)*at,1),at}function Hs(Dt,he,_e,Oe,Ye,qe){const at=(qe-_e)/(Ye-_e);return Ur(Dt,he+(Oe-he)*at,qe,1),at}function fi(Dt,he){const _e=[];for(let Oe=0;Oe<Dt.length;Oe++){const Ye=Dt[Oe],qe=Ye.type;let at;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")at=xo(Ye.geometry,he);else if(qe==="MultiLineString"||qe==="Polygon"){at=[];for(const wt of Ye.geometry)at.push(xo(wt,he))}else if(qe==="MultiPolygon"){at=[];for(const wt of Ye.geometry){const ct=[];for(const Mt of wt)ct.push(xo(Mt,he));at.push(ct)}}_e.push(yr(Ye.id,qe,at,Ye.tags))}return _e}function xo(Dt,he){const _e=[];_e.size=Dt.size,Dt.start!==void 0&&(_e.start=Dt.start,_e.end=Dt.end);for(let Oe=0;Oe<Dt.length;Oe+=3)_e.push(Dt[Oe]+he,Dt[Oe+1],Dt[Oe+2]);return _e}function di(Dt,he){if(Dt.transformed)return Dt;const _e=1<<Dt.z,Oe=Dt.x,Ye=Dt.y;for(const qe of Dt.features){const at=qe.geometry,wt=qe.type;if(qe.geometry=[],wt===1)for(let ct=0;ct<at.length;ct+=2)qe.geometry.push(Hi(at[ct],at[ct+1],he,_e,Oe,Ye));else for(let ct=0;ct<at.length;ct++){const Mt=[];for(let Nt=0;Nt<at[ct].length;Nt+=2)Mt.push(Hi(at[ct][Nt],at[ct][Nt+1],he,_e,Oe,Ye));qe.geometry.push(Mt)}}return Dt.transformed=!0,Dt}function Hi(Dt,he,_e,Oe,Ye,qe){return[Math.round(_e*(Dt*Oe-Ye)),Math.round(_e*(he*Oe-qe))]}function pi(Dt,he,_e,Oe,Ye){const qe=he===Ye.maxZoom?0:Ye.tolerance/((1<<he)*Ye.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:Dt.length,source:null,x:_e,y:Oe,z:he,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const wt of Dt)lr(at,wt,qe,Ye);return at}function lr(Dt,he,_e,Oe){const Ye=he.geometry,qe=he.type,at=[];if(Dt.minX=Math.min(Dt.minX,he.minX),Dt.minY=Math.min(Dt.minY,he.minY),Dt.maxX=Math.max(Dt.maxX,he.maxX),Dt.maxY=Math.max(Dt.maxY,he.maxY),qe==="Point"||qe==="MultiPoint")for(let wt=0;wt<Ye.length;wt+=3)at.push(Ye[wt],Ye[wt+1]),Dt.numPoints++,Dt.numSimplified++;else if(qe==="LineString")ml(at,Ye,Dt,_e,!1,!1);else if(qe==="MultiLineString"||qe==="Polygon")for(let wt=0;wt<Ye.length;wt++)ml(at,Ye[wt],Dt,_e,qe==="Polygon",wt===0);else if(qe==="MultiPolygon")for(let wt=0;wt<Ye.length;wt++){const ct=Ye[wt];for(let Mt=0;Mt<ct.length;Mt++)ml(at,ct[Mt],Dt,_e,!0,Mt===0)}if(at.length){let wt=he.tags||null;if(qe==="LineString"&&Oe.lineMetrics){wt={};for(const Mt in he.tags)wt[Mt]=he.tags[Mt];wt.mapbox_clip_start=Ye.start/Ye.size,wt.mapbox_clip_end=Ye.end/Ye.size}const ct={geometry:at,type:qe==="Polygon"||qe==="MultiPolygon"?3:qe==="LineString"||qe==="MultiLineString"?2:1,tags:wt};he.id!==null&&(ct.id=he.id),Dt.features.push(ct)}}function ml(Dt,he,_e,Oe,Ye,qe){const at=Oe*Oe;if(Oe>0&&he.size<(Ye?at:Oe))return void(_e.numPoints+=he.length/3);const wt=[];for(let ct=0;ct<he.length;ct+=3)(Oe===0||he[ct+2]>at)&&(_e.numSimplified++,wt.push(he[ct],he[ct+1])),_e.numPoints++;Ye&&function(ct,Mt){let Nt=0;for(let Lt=0,sn=ct.length,pn=sn-2;Lt<sn;pn=Lt,Lt+=2)Nt+=(ct[Lt]-ct[pn])*(ct[Lt+1]+ct[pn+1]);if(Nt>0===Mt)for(let Lt=0,sn=ct.length;Lt<sn/2;Lt+=2){const pn=ct[Lt],yn=ct[Lt+1];ct[Lt]=ct[sn-2-Lt],ct[Lt+1]=ct[sn-1-Lt],ct[sn-2-Lt]=pn,ct[sn-1-Lt]=yn}}(wt,qe),Dt.push(wt)}const Yi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class as{constructor(he,_e){const Oe=(_e=this.options=function(qe,at){for(const wt in at)qe[wt]=at[wt];return qe}(Object.create(Yi),_e)).debug;if(Oe&&console.time("preprocess data"),_e.maxZoom<0||_e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(_e.promoteId&&_e.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ye=function(qe,at){const wt=[];if(qe.type==="FeatureCollection")for(let ct=0;ct<qe.features.length;ct++)bn(wt,qe.features[ct],at,ct);else bn(wt,qe.type==="Feature"?qe:{geometry:qe},at);return wt}(he,_e);this.tiles={},this.tileCoords=[],Oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",_e.indexMaxZoom,_e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ye=function(qe,at){const wt=at.buffer/at.extent;let ct=qe;const Mt=br(qe,1,-1-wt,wt,0,-1,2,at),Nt=br(qe,1,1-wt,2+wt,0,-1,2,at);return(Mt||Nt)&&(ct=br(qe,1,-wt,1+wt,0,-1,2,at)||[],Mt&&(ct=fi(Mt,1).concat(ct)),Nt&&(ct=ct.concat(fi(Nt,-1)))),ct}(Ye,_e),Ye.length&&this.splitTile(Ye,0,0,0),Oe&&(Ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(he,_e,Oe,Ye,qe,at,wt){const ct=[he,_e,Oe,Ye],Mt=this.options,Nt=Mt.debug;for(;ct.length;){Ye=ct.pop(),Oe=ct.pop(),_e=ct.pop(),he=ct.pop();const Lt=1<<_e,sn=Ho(_e,Oe,Ye);let pn=this.tiles[sn];if(!pn&&(Nt>1&&console.time("creation"),pn=this.tiles[sn]=pi(he,_e,Oe,Ye,Mt),this.tileCoords.push({z:_e,x:Oe,y:Ye}),Nt)){Nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",_e,Oe,Ye,pn.numFeatures,pn.numPoints,pn.numSimplified),console.timeEnd("creation"));const ti=`z${_e}`;this.stats[ti]=(this.stats[ti]||0)+1,this.total++}if(pn.source=he,qe==null){if(_e===Mt.indexMaxZoom||pn.numPoints<=Mt.indexMaxPoints)continue}else{if(_e===Mt.maxZoom||_e===qe)continue;if(qe!=null){const ti=qe-_e;if(Oe!==at>>ti||Ye!==wt>>ti)continue}}if(pn.source=null,he.length===0)continue;Nt>1&&console.time("clipping");const yn=.5*Mt.buffer/Mt.extent,$n=.5-yn,er=.5+yn,or=1+yn;let ur=null,li=null,Si=null,mr=null,Vr=br(he,Lt,Oe-yn,Oe+er,0,pn.minX,pn.maxX,Mt),Xr=br(he,Lt,Oe+$n,Oe+or,0,pn.minX,pn.maxX,Mt);he=null,Vr&&(ur=br(Vr,Lt,Ye-yn,Ye+er,1,pn.minY,pn.maxY,Mt),li=br(Vr,Lt,Ye+$n,Ye+or,1,pn.minY,pn.maxY,Mt),Vr=null),Xr&&(Si=br(Xr,Lt,Ye-yn,Ye+er,1,pn.minY,pn.maxY,Mt),mr=br(Xr,Lt,Ye+$n,Ye+or,1,pn.minY,pn.maxY,Mt),Xr=null),Nt>1&&console.timeEnd("clipping"),ct.push(ur||[],_e+1,2*Oe,2*Ye),ct.push(li||[],_e+1,2*Oe,2*Ye+1),ct.push(Si||[],_e+1,2*Oe+1,2*Ye),ct.push(mr||[],_e+1,2*Oe+1,2*Ye+1)}}getTile(he,_e,Oe){he=+he,_e=+_e,Oe=+Oe;const Ye=this.options,{extent:qe,debug:at}=Ye;if(he<0||he>24)return null;const wt=1<<he,ct=Ho(he,_e=_e+wt&wt-1,Oe);if(this.tiles[ct])return di(this.tiles[ct],qe);at>1&&console.log("drilling down to z%d-%d-%d",he,_e,Oe);let Mt,Nt=he,Lt=_e,sn=Oe;for(;!Mt&&Nt>0;)Nt--,Lt>>=1,sn>>=1,Mt=this.tiles[Ho(Nt,Lt,sn)];return Mt&&Mt.source?(at>1&&(console.log("found parent tile z%d-%d-%d",Nt,Lt,sn),console.time("drilling down")),this.splitTile(Mt.source,Nt,Lt,sn,he,_e,Oe),at>1&&console.timeEnd("drilling down"),this.tiles[ct]?di(this.tiles[ct],qe):null):null}}function Ho(Dt,he,_e){return 32*((1<<Dt)*_e+he)+Dt}function ns(Dt,he){const _e=Dt.tileID.canonical;if(!this._geoJSONIndex)return void he(null,null);const Oe=this._geoJSONIndex.getTile(_e.z,_e.x,_e.y);if(!Oe)return void he(null,null);const Ye=new rt(Oe.features);let qe=be(Ye);qe.byteOffset===0&&qe.byteLength===qe.buffer.byteLength||(qe=new Uint8Array(qe)),he(null,{vectorTile:Ye,rawData:qe.buffer})}class Rr extends se{constructor(he,_e,Oe,Ye,qe,at){super(he,_e,Oe,Ye,ns,at),qe&&(this.loadGeoJSON=qe),this._dynamicIndex=new it}loadData(he,_e){const Oe=he&&he.request,Ye=Oe&&Oe.collectResourceTiming;this.loadGeoJSON(he,(qe,at)=>{if(qe||!at)return _e(qe);if(typeof at!="object")return _e(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`));{try{if(he.filter){const ct=i.X(he.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ct.result==="error")throw new Error(ct.value.map(Mt=>`${Mt.key}: ${Mt.message}`).join(", "));at.features=at.features.filter(Mt=>ct.value.evaluate({zoom:0},Mt))}he.dynamic?(at.type==="Feature"&&(at={type:"FeatureCollection",features:[at]}),he.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(at.features,this.loaded),he.cluster&&(at.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=he.cluster?new Ft(function({superclusterOptions:ct,clusterProperties:Mt}){if(!Mt||!ct)return ct;const Nt={},Lt={},sn={accumulated:null,zoom:0},pn={properties:null},yn=Object.keys(Mt);for(const $n of yn){const[er,or]=Mt[$n],ur=i.X(or),li=i.X(typeof er=="string"?[er,["accumulated"],["get",$n]]:er);Nt[$n]=ur.value,Lt[$n]=li.value}return ct.map=$n=>{pn.properties=$n;const er={};for(const or of yn)er[or]=Nt[or].evaluate(sn,pn);return er},ct.reduce=($n,er)=>{pn.properties=er;for(const or of yn)sn.accumulated=$n[or],$n[or]=Lt[or].evaluate(sn,pn)},ct}(he)).load(at.features):he.dynamic?this._dynamicIndex:function(ct,Mt){return new as(ct,Mt)}(at,he.geojsonVtOptions)}catch(ct){return _e(ct)}const wt={};if(Ye){const ct=E(Oe);ct&&(wt.resourceTiming={},wt.resourceTiming[he.source]=JSON.parse(JSON.stringify(ct)))}_e(null,wt)}})}reloadTile(he,_e){const Oe=this.loaded;return Oe&&Oe[he.uid]?he.partial?_e(null,void 0):super.reloadTile(he,_e):this.loadTile(he,_e)}loadGeoJSON(he,_e){if(he.request)i.n(he.request,_e);else{if(typeof he.data!="string")return _e(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`));try{return _e(null,JSON.parse(he.data))}catch{return _e(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(he,_e){try{_e(null,this._geoJSONIndex.getClusterExpansionZoom(he.clusterId))}catch(Oe){_e(Oe)}}getClusterChildren(he,_e){try{_e(null,this._geoJSONIndex.getChildren(he.clusterId))}catch(Oe){_e(Oe)}}getClusterLeaves(he,_e){try{_e(null,this._geoJSONIndex.getLeaves(he.clusterId,he.limit,he.offset))}catch(Oe){_e(Oe)}}}class Ii{constructor(he,_e){this.tileID=new i.aH(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),this.tileZoom=he.tileZoom,this.uid=he.uid,this.zoom=he.zoom,this.canonical=he.tileID.canonical,this.pixelRatio=he.pixelRatio,this.tileSize=he.tileSize,this.source=he.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=he.projection,this.brightness=_e}parse(he,_e,Oe,Ye){this.status="parsing";const qe=new i.aH(Oe.tileID.overscaledZ,Oe.tileID.wrap,Oe.tileID.canonical.z,Oe.tileID.canonical.x,Oe.tileID.canonical.y),at=[],wt=_e.familiesBySource[Oe.source],ct=new i.e0(qe,Oe.promoteId);return ct.bucketLayerIDs=[],ct.is3DTile=!0,i.ei(he).then(Mt=>{if(!Mt)return Ye(new Error("Could not parse tile"));const Nt=i.ej(Mt,1/i.cd(Oe.tileID.canonical)),Lt=Mt.json.extensionsUsed&&Mt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Mt.json.asset.extras&&Mt.json.asset.extras.MAPBOX_mesh_features,sn=Mt.json.extensionsUsed&&Mt.json.extensionsUsed.includes("EXT_meshopt_compression"),pn=new i.aa(this.zoom,{brightness:this.brightness});for(const yn in wt)for(const $n of wt[yn]){const er=$n[0];ct.bucketLayerIDs.push($n.map(ur=>i.C(ur.id,ur.scope))),er.recalculate(pn,[]);const or=new i.ek($n,Nt,qe,Lt,sn,this.brightness,ct);Lt||(or.needsUpload=!0),at.push(or),or.evaluate(er)}this.status="done",Ye(null,{buckets:at,featureIndex:ct,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Mt=>Ye(new Error(Mt.message)))}}class $l{constructor(he,_e,Oe,Ye,qe,at){this.actor=he,this.layerIndex=_e,this.availableImages=Oe,this.brightness=at,this.loading={},this.loaded={}}loadTile(he,_e){const Oe=he.uid,Ye=this.loading[Oe]=new Ii(he,this.brightness);i.bj(he.request,(qe,at)=>{const wt=!this.loading[Oe];return delete this.loading[Oe],wt||qe?(Ye.status="done",wt||(this.loaded[Oe]=Ye),_e(qe)):at&&at.byteLength!==0?void Ye.parse(at,this.layerIndex,he,(ct,Mt)=>{Ye.status="done",this.loaded=this.loaded||{},this.loaded[Oe]=Ye,ct||!Mt?_e(ct):_e(null,Mt)}):(Ye.status="done",this.loaded[Oe]=Ye,_e())})}reloadTile(he,_e){const Oe=this.loaded,Ye=he.uid;if(Oe&&Oe[Ye]){const qe=Oe[Ye];qe.projection=he.projection,qe.brightness=he.brightness;const at=(wt,ct)=>{qe.reloadCallback&&(delete qe.reloadCallback,this.loadTile(he,_e)),_e(wt,ct)};qe.status==="parsing"?qe.reloadCallback=at:qe.status==="done"&&this.loadTile(he,_e)}}abortTile(he,_e){const Oe=he.uid;this.loading[Oe]&&delete this.loading[Oe],_e()}removeTile(he,_e){const Oe=this.loaded,Ye=he.uid;Oe&&Oe[Ye]&&delete Oe[Ye],_e()}}class Rs{constructor(he){this.self=he,this.actor=new i.el(he,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.bP({name:"mercator"}),this.workerSourceTypes={vector:se,geojson:Rr,"raster-dem":J,"raster-array":le,"batched-model":$l},this.workerSources={},this.self.registerWorkerSource=(_e,Oe)=>{if(this.workerSourceTypes[_e])throw new Error(`Worker source with name "${_e}" already registered.`);this.workerSourceTypes[_e]=Oe},this.self.registerRTLTextPlugin=_e=>{if(i.em.isParsed())throw new Error("RTL text plugin already registered.");i.em.applyArabicShaping=_e.applyArabicShaping,i.em.processBidirectionalText=_e.processBidirectionalText,i.em.processStyledBidirectionalText=_e.processStyledBidirectionalText}}clearCaches(he,_e,Oe){delete this.layerIndexes[he],delete this.availableImages[he],delete this.workerSources[he],Oe()}checkIfReady(he,_e,Oe){Oe()}setReferrer(he,_e){this.referrer=_e}spriteLoaded(he,{scope:_e,isLoaded:Oe}){if(this.isSpriteLoaded[he]||(this.isSpriteLoaded[he]={}),this.isSpriteLoaded[he][_e]=Oe,this.workerSources[he]&&this.workerSources[he][_e])for(const Ye in this.workerSources[he][_e]){const qe=this.workerSources[he][_e][Ye];for(const at in qe){const wt=qe[at];wt instanceof se&&(wt.isSpriteLoaded=Oe,wt.fire(new i.A("isSpriteLoaded")))}}}setImages(he,{scope:_e,images:Oe},Ye){if(this.availableImages[he]||(this.availableImages[he]={}),this.availableImages[he][_e]=Oe,this.workerSources[he]&&this.workerSources[he][_e]){for(const qe in this.workerSources[he][_e]){const at=this.workerSources[he][_e][qe];for(const wt in at)at[wt].availableImages=Oe}Ye()}else Ye()}setProjection(he,_e){this.projections[he]=i.bP(_e)}setBrightness(he,_e,Oe){this.brightness=_e,Oe()}setLayers(he,_e,Oe){this.getLayerIndex(he,_e.scope).replace(_e.layers,_e.options),Oe()}updateLayers(he,_e,Oe){this.getLayerIndex(he,_e.scope).update(_e.layers,_e.removedIds,_e.options),Oe()}loadTile(he,_e,Oe){_e.projection=this.projections[he]||this.defaultProjection,this.getWorkerSource(he,_e.type,_e.source,_e.scope).loadTile(_e,Oe)}decodeRasterArray(he,_e,Oe){this.getWorkerSource(he,_e.type,_e.source,_e.scope).decodeRasterArray(_e,Oe)}reloadTile(he,_e,Oe){_e.projection=this.projections[he]||this.defaultProjection,this.getWorkerSource(he,_e.type,_e.source,_e.scope).reloadTile(_e,Oe)}abortTile(he,_e,Oe){this.getWorkerSource(he,_e.type,_e.source,_e.scope).abortTile(_e,Oe)}removeTile(he,_e,Oe){this.getWorkerSource(he,_e.type,_e.source,_e.scope).removeTile(_e,Oe)}removeSource(he,_e,Oe){if(!(this.workerSources[he]&&this.workerSources[he][_e.scope]&&this.workerSources[he][_e.scope][_e.type]&&this.workerSources[he][_e.scope][_e.type][_e.source]))return;const Ye=this.workerSources[he][_e.scope][_e.type][_e.source];delete this.workerSources[he][_e.scope][_e.type][_e.source],Ye.removeSource!==void 0?Ye.removeSource(_e,Oe):Oe()}loadWorkerSource(he,_e,Oe){try{this.self.importScripts(_e.url),Oe()}catch(Ye){Oe(Ye.toString())}}syncRTLPluginState(he,_e,Oe){try{i.em.setState(_e);const Ye=i.em.getPluginURL();if(i.em.isLoaded()&&!i.em.isParsed()&&Ye!=null){this.self.importScripts(Ye);const qe=i.em.isParsed();Oe(qe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ye}`),qe)}}catch(Ye){Oe(Ye.toString())}}setDracoUrl(he,_e){this.dracoUrl=_e}getAvailableImages(he,_e){this.availableImages[he]||(this.availableImages[he]={});let Oe=this.availableImages[he][_e];return Oe||(Oe=[]),Oe}getLayerIndex(he,_e){this.layerIndexes[he]||(this.layerIndexes[he]={});let Oe=this.layerIndexes[he][_e];return Oe||(Oe=this.layerIndexes[he][_e]=new z,Oe.scope=_e),Oe}getWorkerSource(he,_e,Oe,Ye){const qe=this.workerSources;return qe[he]||(qe[he]={}),qe[he][Ye]||(qe[he][Ye]={}),qe[he][Ye][_e]||(qe[he][Ye][_e]={}),this.isSpriteLoaded[he]||(this.isSpriteLoaded[he]={}),qe[he][Ye][_e][Oe]||(qe[he][Ye][_e][Oe]=new this.workerSourceTypes[_e]({send:(at,wt,ct,Mt,Nt,Lt)=>{this.actor.send(at,wt,ct,he,Nt,Lt)},scheduler:this.actor.scheduler},this.getLayerIndex(he,Ye),this.getAvailableImages(he,Ye),this.isSpriteLoaded[he][Ye],void 0,this.brightness)),qe[he][Ye][_e][Oe]}rasterizeImages(he,_e,Oe){const Ye=new Map;for(const[qe,{image:at,imageVariant:wt}]of _e.tasks.entries()){const ct=this.imageRasterizer.rasterize(wt,at,_e.scope,he);Ye.set(qe,ct)}Oe(void 0,Ye)}removeRasterizedImages(he,_e,Oe){this.imageRasterizer.removeImagesFromCacheByIds(_e.imageIds,_e.scope,he),Oe()}enforceCacheSizeLimit(he,_e){i.en(_e)}getWorkerPerformanceMetrics(he,_e,Oe){Oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Rs(self)),Rs}),g(["./shared"],function(i){var E="3.11.0";const k={create:"create",load:"load",fullLoad:"fullLoad"},O={mark(m){performance.mark(m)},measure(m,r,l){performance.measure(m,r,l)}};function z(m){const r=m.name.split("?")[0];return i.a(r)&&r.includes("mapbox-gl.js")?"javascript":i.a(r)&&r.includes("mapbox-gl.css")?"css":i.b(r)?"fontRange":i.c(r)?"sprite":i.i(r)?"style":i.d(r)?"tilejson":"other"}var G,U={},ie=function(){if(G)return U;function m(p){return!r(p)}function r(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,S,L=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(L);try{S=new Worker(N),b=!0}catch{b=!1}return S&&S.terminate(),URL.revokeObjectURL(N),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var S=b.getContext("2d");if(!S)return!1;var L=S.getImageData(0,0,1,1);return L&&L.width===b.width}()?(l[y=p&&p.failIfMajorPerformanceCaveat]===void 0&&(l[y]=function(b){var S,L=function(N){var F=document.createElement("canvas"),B=Object.create(m.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=N,F.getContext("webgl2",B)}(b);if(!L)return!1;try{S=L.createShader(L.VERTEX_SHADER)}catch{return!1}return!(!S||L.isContextLost())&&(L.shaderSource(S,"void main() {}"),L.compileShader(S),L.getShaderParameter(S,L.COMPILE_STATUS)===!0)}(y)),l[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}G=1,U.supported=m,U.notSupportedReason=r;var l={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},U}();function Q(m,r,l){const p=document.createElement(m);return r!=null&&(p.className=r),l&&l.appendChild(p),p}function se(m,r,l){const p=document.createElementNS("http://www.w3.org/2000/svg",m);for(const y of Object.keys(r))p.setAttributeNS(null,y,String(r[y]));return l&&l.appendChild(p),p}const J=typeof document<"u"?document.documentElement&&document.documentElement.style:null,te=J&&J.userSelect!==void 0?"userSelect":"WebkitUserSelect";let le;function ye(){J&&te&&(le=J[te],J[te]="none")}function Ne(){J&&te&&(J[te]=le)}function rt(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",rt,!0)}function xe(){window.addEventListener("click",rt,!0),window.setTimeout(()=>{window.removeEventListener("click",rt,!0)},0)}function Me(m,r){const l=m.getBoundingClientRect();return ve(m,l,r)}function it(m,r){const l=m.getBoundingClientRect(),p=[];for(let y=0;y<r.length;y++)p.push(ve(m,l,r[y]));return p}function ot(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function ve(m,r,l){const p=m.offsetWidth===r.width?1:m.offsetWidth/r.width;return new i.P((l.clientX-r.left)*p,(l.clientY-r.top)*p)}const Le="01",dt="NO_ACCESS_TOKEN";class Je{constructor(r,l,p){this._transformRequestFn=r,this._customAccessToken=l,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const r=function(){let l="";for(let p=0;p<10;p++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Le,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,l){return this._transformRequestFn&&this._transformRequestFn(r,l)||{url:r}}normalizeStyleURL(r,l){if(!i.f(r))return r;const p=St(r);return p.params.push(`sdk=js-${E}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeGlyphsURL(r,l){if(!i.f(r))return r;const p=St(r);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeModelURL(r,l){if(!i.f(r))return r;const p=St(r);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeSourceURL(r,l,p,y){if(!i.f(r))return r;const b=St(r);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||l)}normalizeIconsetURL(r,l){const p=St(r);return i.f(r)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||l)):jt(p)}normalizeSpriteURL(r,l,p,y){const b=St(r);return i.f(r)?(b.path=`/styles/v1${b.path}/sprite${l}${p}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${l}${p}`,jt(b))}normalizeTileURL(r,l,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!i.f(r))return r;const y=St(r);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||p&&y.authority!=="raster"&&p===512?"@2x":""}${i.m.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${i.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${i.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${i.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||function(S){for(const L of S){const N=L.match(/^access_token=(.*)$/);if(N)return N[1]}return null}(y.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(r,l){const p=St(r);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return r;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return l&&(b=b.filter(S=>!S.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(r,l){const p=!!l&&i.f(l),y=[];for(const b of r.tiles||[])i.h(b)?y.push(this.canonicalizeTileURL(b,p)):y.push(b);return y}_makeAPIURL(r,l){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=St(i.e.API_URL);if(r.protocol=y.protocol,r.authority=y.authority,r.protocol==="http"){const b=r.params.indexOf("secure");b>=0&&r.params.splice(b,1)}if(y.path!=="/"&&(r.path=`${y.path}${r.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return jt(r);if(l=l||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return r.params=r.params.filter(b=>b.indexOf("access_token")===-1),r.params.push(`access_token=${l||""}`),jt(r)}}const yt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function St(m){const r=m.match(yt);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function jt(m){const r=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${r}`}const et="mapbox.eventData";function Qe(m){if(!m)return null;const r=m.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(i.j(r[1]))}catch{return null}}class Xe{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=Qe(i.e.ACCESS_TOKEN);let p="";return p=l&&l.u?i.k(l.u):i.e.ACCESS_TOKEN||"",r?`${et}.${r}:${p}`:`${et}:${p}`}fetchEventData(){const r=i.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid");if(r)try{const y=localStorage.getItem(l);y&&(this.eventData=JSON.parse(y));const b=localStorage.getItem(p);b&&(this.anonId=b)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const r=i.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.anonId;if(r&&y)try{localStorage.setItem(p,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,p,y){if(!i.e.EVENTS_URL)return;const b=St(i.e.EVENTS_URL);b.params.push(`access_token=${y||i.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(r).toISOString()},L=l?i.l(S,l):S,N={url:jt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=i.p(N,F=>{this.pendingRequest=null,p(F),this.saveEventData(),this.processRequests(y)})}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Vt=new class extends Xe{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,r){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(l=>i.f(l)||i.h(l))&&this.queueRequest(Date.now(),r)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Qe(i.e.ACCESS_TOKEN),l=r?r.u:i.e.ACCESS_TOKEN;let p=l!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),p=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),S=new Date(y),L=(y-this.eventData.lastSuccess)/864e5;p=p||L>=1||L<-1||b.getDate()!==S.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Le,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=l)},m):this.processRequests()}},be=Vt.postTurnstileEvent.bind(Vt),Re=new class extends Xe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,r,l,p){this.skuToken=r,this.errorCb=p,i.e.EVENTS_URL&&(l||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},l):this.errorCb(new Error(dt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Le,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},m))}remove(){this.errorCb=null}},Fe=Re.postMapLoadEvent.bind(Re),ut=new class extends Xe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let r=this.mapInstanceIdMap.get(m);return r||(r=i.u(),this.mapInstanceIdMap.set(m,r)),r}getEventId(m){const r=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,r+1),r}postStyleLoadEvent(m,r){const{map:l,style:p,importedStyles:y}=r;if(!i.e.EVENTS_URL||!m&&!i.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(l),S={mapInstanceId:b,eventId:this.getEventId(b),style:p};y.length&&(S.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:S},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:l}=this.queue.shift();this.postEvent(r,l,()=>{},m)}},Et=ut.postStyleLoadEvent.bind(ut),Ct=new class extends Xe{constructor(){super("gljs.performance")}postPerformanceEvent(m,r){i.e.EVENTS_URL&&(m||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:l}=this.queue.shift(),p=function(y){const b=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),L=function(ee){const ce={};if(ee){for(const oe in ee)if(oe!=="other")for(const fe of ee[oe]){const pe=`${oe}ResolveRangeMin`,Te=`${oe}ResolveRangeMax`,De=`${oe}RequestCount`,Ie=`${oe}RequestCachedCount`;ce[pe]=Math.min(ce[pe]||1/0,fe.startTime),ce[Te]=Math.max(ce[Te]||-1/0,fe.responseEnd);const Ge=Be=>{ce[Be]===void 0&&(ce[Be]=0),++ce[Be]};fe.transferSize!==void 0&&fe.transferSize===0&&Ge(Ie),Ge(De)}}return ce}(function(ee,ce){const oe={};if(ee)for(const fe of ee){const pe=ce(fe);oe[pe]===void 0&&(oe[pe]=[]),oe[pe].push(fe)}return oe}(b,z)),N=window.devicePixelRatio,F=navigator.connection||navigator.mozConnection||navigator.webkitConnection,B=F?F.effectiveType:void 0,H={counters:[],metadata:[],attributes:[]},W=(ee,ce,oe)=>{oe!=null&&ee.push({name:ce,value:oe.toString()})};for(const ee in L)W(H.counters,ee,L[ee]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(W(H.counters,"interactionRangeMin",y.interactionRange[0]),W(H.counters,"interactionRangeMax",y.interactionRange[1])),S)for(const ee of Object.keys(k)){const ce=k[ee],oe=S.find(fe=>fe.name===ce);oe&&W(H.counters,ce,oe.startTime)}return W(H.counters,"visibilityHidden",y.visibilityHidden),W(H.attributes,"style",function(ee){if(ee)for(const ce of ee){const oe=ce.name.split("?")[0];if(i.i(oe)){const fe=oe.split("/").slice(-2);if(fe.length===2)return`mapbox://styles/${fe[0]}/${fe[1]}`}}}(b)),W(H.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),W(H.attributes,"fogEnabled",y.fogEnabled?"true":"false"),W(H.attributes,"projection",y.projection),W(H.attributes,"zoom",y.zoom),W(H.metadata,"devicePixelRatio",N),W(H.metadata,"connectionEffectiveType",B),W(H.metadata,"navigatorUserAgent",navigator.userAgent),W(H.metadata,"screenWidth",window.screen.width),W(H.metadata,"screenHeight",window.screen.height),W(H.metadata,"windowWidth",window.innerWidth),W(H.metadata,"windowHeight",window.innerHeight),W(H.metadata,"mapWidth",y.width/N),W(H.metadata,"mapHeight",y.height/N),W(H.metadata,"webglRenderer",y.renderer),W(H.metadata,"webglVendor",y.vendor),W(H.metadata,"sdkVersion",E),W(H.metadata,"sdkIdentifier","mapbox-gl-js"),H}(l);for(const y of p.metadata);for(const y of p.counters);for(const y of p.attributes);this.postEvent(r,p,()=>{},m)}},Wt=Ct.postPerformanceEvent.bind(Ct),Ft=new class extends Xe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,r,l,p){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const y=St(i.e.API_URL+i.e.SESSION_PATH);y.params.push(`sku=${r||""}`),y.params.push(`access_token=${p||i.e.ACCESS_TOKEN||""}`);const b={url:jt(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(b,S=>{this.pendingRequest=null,l(S),this.saveEventData(),this.processRequests(p)})}getSessionAPI(m,r,l,p){this.skuToken=r,this.errorCb=p,i.e.SESSION_PATH&&i.e.API_URL&&(l||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},l):this.errorCb(new Error(dt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},m)}remove(){this.errorCb=null}},me=Ft.getSessionAPI.bind(Ft),dn=new Set;function Cn(m,r){r?dn.add(m):dn.delete(m)}class On{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,l){this._updatedSourceCaches[r]=l,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const l=r.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(r.id),this.setDirty()}removeLayer(r){const l=r.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][r.id]=r,this._updatedLayers[l].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const l in this._updatedLayers)r[l]=r[l]||{},r[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)r[l]=r[l]||{},r[l].removedIds=Object.keys(this._removedLayers[l]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(i.I.toString(r)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function $t(m){const{userImage:r}=m;return!!(r&&r.render&&r.render())&&(m.data.replace(new Uint8Array(r.data.buffer)),!0)}class cn extends i.E{constructor(r){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=r,r!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}createScope(r){this._images[r]={},this._iconsets[r]={},this.loaded[r]=!1,this.updatedImages[r]=new Set,this.patterns[r]={},this.callbackDispatchedThisFrame[r]=new Set,this.atlasImage[r]=new i.r({width:1,height:1})}createIconset(r,l){this._iconsets[r][l]={}}isLoaded(){for(const r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,l){if(this.loaded[l]!==r&&(this.loaded[l]=r,r)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,l,y);this.requestors=[]}}hasImage(r,l){return!!this.getImage(r,l)}getImage(r,l){return(r.iconsetId?this._iconsets[l][r.iconsetId]:this._images[l])[r.name]}addImage(r,l,p){const y=r.iconsetId?this._iconsets[l][r.iconsetId]:this._images[l];this._validate(r,p)&&(y[r.name]=p)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const y of r){if(y[0]<p||y[1]<y[0]||l<y[1])return!1;p=y[1]}return!0}_validateContent(r,l){return r?r.length!==4||!l.usvg&&(r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,l,p){const y=r.iconsetId?this._iconsets[l][r.iconsetId]:this._images[l];p.version=y[r.name].version+1,y[r.name]=p,this.updatedImages[l].add(r),this.removeFromImageRasterizerCache(r,l)}clearUpdatedImages(r){this.updatedImages[r].clear()}removeFromImageRasterizerCache(r,l){if(this.spriteFormat!=="raster")if(i.t()){const p={imageIds:[r],scope:l};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",p)}else this.imageRasterizer.removeImagesFromCacheByIds([r],l)}removeImage(r,l){const p=r.iconsetId?this._iconsets[l][r.iconsetId]:this._images[l],y=p[r.name];delete p[r.name],delete this.patterns[l][r.name],this.removeFromImageRasterizerCache(r,l),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(r){const l=[];for(const p of Object.keys(this._images[r]))l.push(new i.I(p));for(const p in this._iconsets[r])for(const y of Object.keys(this._iconsets[r][p]))l.push(new i.I({name:y,iconsetId:p}));return l}getImages(r,l,p){let y=!0;const b=!!this.loaded[l];if(!b)for(const S of r)(S.iconsetId?this._iconsets[l][S.iconsetId]:this._images[l])[S.name]||(y=!1);b||y?this._notify(r,l,p):this.requestors.push({ids:r,scope:l,callback:p})}rasterizeImages({scope:r,tasks:l},p){const y=new Map;for(const[b,S]of l.entries()){const L=this.getImage(S.id,r);L&&y.set(b,{image:L,imageVariant:S})}this._rasterizeImages(r,y,p)}_rasterizeImages(r,l,p){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:l,scope:r},p);else{const y=new Map;for(const[b,{image:S,imageVariant:L}]of l.entries())y.set(b,this.imageRasterizer.rasterize(L,S,r,0));p(void 0,y)}}getUpdatedImages(r){return this.updatedImages[r]||new Set}_notify(r,l,p){const y=new Map;for(const b of r){b.iconsetId&&(this._iconsets[l][b.iconsetId]=this._iconsets[l][b.iconsetId]||{});const S=(b.iconsetId?this._iconsets[l][b.iconsetId]:this._images[l])[b.name];if(!S){if(b.iconsetId)continue;i.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new i.A("styleimagemissing",{id:b.name}));continue}const L={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(L,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),y.set(i.I.toString(b),L)}p(null,y)}getPixelSize(r){const{width:l,height:p}=this.atlasImage[r];return{width:l,height:p}}getPattern(r,l,p){const y=this.patterns[l][r.name],b=this.getImage(r,l);if(!b)return null;if(y){if(y.position.version===b.version)return y.position;y.position.version=b.version}else{if(b.usvg&&!b.data){const S=this.getPatternInFlightId(r.toString(),l);if(this.patternsInFlight.has(S))return null;this.patternsInFlight.add(S);const L=new i.B(r).scaleSelf(i.q.devicePixelRatio),N=new Map([[L.toString(),{image:b,imageVariant:L}]]);return this._rasterizeImages(l,N,(F,B)=>this.storePatternImage(L,l,b,p,B)),null}this.storePattern(r,l,b)}return this._updatePatternAtlas(l,p),this.patterns[l][r.name].position}getPatternInFlightId(r,l){return i.C(r,l)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,l,p,y,b){const S=r.toString(),L=b?b.get(S):void 0;L&&(p.data=L,this.storePattern(r.id,l,p),this._updatePatternAtlas(l,y),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),l)))}storePattern(r,l,p){const y={w:p.data.width+2*i.F,h:p.data.height+2*i.F,x:0,y:0},b=new i.G(y,p,i.F);this.patterns[l][r.name]={bin:y,position:b}}bind(r,l){const p=r.gl;let y=this.atlasTexture[l];y?this.dirty&&(y.update(this.atlasImage[l]),this.dirty=!1):(y=new i.T(r,this.atlasImage[l],p.RGBA8),this.atlasTexture[l]=y),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(r,l){const p=[];for(const L in this.patterns[r])p.push(this.patterns[r][L].bin);const{w:y,h:b}=i.H(p),S=this.atlasImage[r];S.resize({width:y||1,height:b||1});for(const L in this.patterns[r]){const{bin:N,position:F}=this.patterns[r][L];let B=F.padding;const H=N.x+B,W=N.y+B,ee=this._images[r][L].data,ce=ee.width,oe=ee.height;B=B>1?B-1:B,i.r.copy(ee,S,{x:0,y:0},{x:H,y:W},{width:ce,height:oe},l),i.r.copy(ee,S,{x:0,y:oe-B},{x:H,y:W-B},{width:ce,height:B},l),i.r.copy(ee,S,{x:0,y:0},{x:H,y:W+oe},{width:ce,height:B},l),i.r.copy(ee,S,{x:ce-B,y:0},{x:H-B,y:W},{width:B,height:oe},l),i.r.copy(ee,S,{x:0,y:0},{x:H+ce,y:W},{width:B,height:oe},l),i.r.copy(ee,S,{x:ce-B,y:oe-B},{x:H-B,y:W-B},{width:B,height:B},l),i.r.copy(ee,S,{x:0,y:oe-B},{x:H+ce,y:W-B},{width:B,height:B},l),i.r.copy(ee,S,{x:0,y:0},{x:H+ce,y:W+oe},{width:B,height:B},l),i.r.copy(ee,S,{x:ce-B,y:0},{x:H-B,y:W+oe},{width:B,height:B},l)}this.dirty=!0}beginFrame(){for(const r in this._images)this.callbackDispatchedThisFrame[r]=new Set}dispatchRenderCallbacks(r,l){for(const p of r){if(this.callbackDispatchedThisFrame[l].has(p.toString()))continue;this.callbackDispatchedThisFrame[l].add(p.toString());const y=(p.iconsetId?this._iconsets[l][p.iconsetId]:this._images[l])[p.name];$t(y)&&this.updateImage(p,l,y)}}}function _t(m){const r=m.key,l=m.value,p=m.valueSpec||{},y=m.objectElementValidators||{},b=m.style,S=m.styleSpec;let L=[];const N=i.K(l);if(N!=="object")return[new i.V(r,l,`object expected, ${N} found`)];for(const F in l){const B=F.split(".")[0];let H;y[B]?H=y[B]:p[B]?H=lr:y["*"]?H=y["*"]:p["*"]&&(H=lr),H?L=L.concat(H({key:(r&&`${r}.`)+F,value:l[F],valueSpec:p[B]||p["*"],style:b,styleSpec:S,object:l,objectKey:F},l)):L.push(new i.J(r,l[F],`unknown property "${F}"`))}for(const F in p)y[F]||p[F].required&&p[F].default===void 0&&l[F]===void 0&&L.push(new i.V(r,l,`missing required property "${F}"`));return L}function yr(m){const r=m.value,l=m.valueSpec,p=m.style,y=m.styleSpec,b=m.key,S=m.arrayElementValidator||lr;if(i.K(r)!=="array")return[new i.V(b,r,`array expected, ${i.K(r)} found`)];if(l.length&&r.length!==l.length)return[new i.V(b,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new i.V(b,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let L={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};y.$version<7&&(L.function=l.function),i.K(l.value)==="object"&&(L=l.value);let N=[];for(let F=0;F<r.length;F++)N=N.concat(S({array:r,arrayIndex:F,value:r[F],valueSpec:L,style:p,styleSpec:y,key:`${b}[${F}]`},!0));return N}function En(m){const r=m.key,l=m.value,p=m.valueSpec;let y=i.K(l);if(y==="number"&&l!=l&&(y="NaN"),y!=="number")return[new i.V(r,l,`number expected, ${y} found`)];if("minimum"in p){let b=p.minimum;if(i.K(p.minimum)==="array"&&(b=p.minimum[m.arrayIndex]),l<b)return[new i.V(r,l,`${l} is less than the minimum value ${b}`)]}if("maximum"in p){let b=p.maximum;if(i.K(p.maximum)==="array"&&(b=p.maximum[m.arrayIndex]),l>b)return[new i.V(r,l,`${l} is greater than the maximum value ${b}`)]}return[]}function bn(m){const r=m.valueSpec,l=i.M(m.value.type);let p,y,b,S={};const L=l!=="categorical"&&m.value.property===void 0,N=!L,F=i.K(m.value.stops)==="array"&&i.K(m.value.stops[0])==="array"&&i.K(m.value.stops[0][0])==="object",B=_t({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(ee){if(l==="identity")return[new i.V(ee.key,ee.value,'identity function may not have a "stops" property')];let ce=[];const oe=ee.value;return ce=ce.concat(yr({key:ee.key,value:oe,valueSpec:ee.valueSpec,style:ee.style,styleSpec:ee.styleSpec,arrayElementValidator:H})),i.K(oe)==="array"&&oe.length===0&&ce.push(new i.V(ee.key,oe,"array must have at least one stop")),ce},default:function(ee){return lr({key:ee.key,value:ee.value,valueSpec:r,style:ee.style,styleSpec:ee.styleSpec})}}});return l==="identity"&&L&&B.push(new i.V(m.key,m.value,'missing required property "property"')),l==="identity"||m.value.stops||B.push(new i.V(m.key,m.value,'missing required property "stops"')),l==="exponential"&&m.valueSpec.expression&&!i.N(m.valueSpec)&&B.push(new i.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(N&&!i.O(m.valueSpec)?B.push(new i.V(m.key,m.value,"property functions not supported")):L&&!i.Q(m.valueSpec)&&B.push(new i.V(m.key,m.value,"zoom functions not supported"))),l!=="categorical"&&!F||m.value.property!==void 0||B.push(new i.V(m.key,m.value,'"property" property is required')),B;function H(ee){let ce=[];const oe=ee.value,fe=ee.key;if(i.K(oe)!=="array")return[new i.V(fe,oe,`array expected, ${i.K(oe)} found`)];if(oe.length!==2)return[new i.V(fe,oe,`array length 2 expected, length ${oe.length} found`)];if(F){if(i.K(oe[0])!=="object")return[new i.V(fe,oe,`object expected, ${i.K(oe[0])} found`)];if(oe[0].zoom===void 0)return[new i.V(fe,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new i.V(fe,oe,"object stop key must have value")];const pe=i.M(oe[0].zoom);if(typeof pe!="number")return[new i.V(fe,oe[0].zoom,"stop zoom values must be numbers")];if(b&&b>pe)return[new i.V(fe,oe[0].zoom,"stop zoom values must appear in ascending order")];pe!==b&&(b=pe,y=void 0,S={}),ce=ce.concat(_t({key:`${fe}[0]`,value:oe[0],valueSpec:{zoom:{}},style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{zoom:En,value:W}}))}else ce=ce.concat(W({key:`${fe}[0]`,value:oe[0],valueSpec:{},style:ee.style,styleSpec:ee.styleSpec},oe));return i.S(i.U(oe[1]))?ce.concat([new i.V(`${fe}[1]`,oe[1],"expressions are not allowed in function stops.")]):ce.concat(lr({key:`${fe}[1]`,value:oe[1],valueSpec:r,style:ee.style,styleSpec:ee.styleSpec}))}function W(ee,ce){const oe=i.K(ee.value),fe=i.M(ee.value),pe=ee.value!==null?ee.value:ce;if(p){if(oe!==p)return[new i.V(ee.key,pe,`${oe} stop domain type must match previous stop domain type ${p}`)]}else p=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof fe!="number"&&typeof fe!="string"&&typeof fe!="boolean")return[new i.V(ee.key,pe,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&l!=="categorical"){let Te=`number expected, ${oe} found`;return i.O(r)&&l===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ee.key,pe,Te)]}return l!=="categorical"||oe!=="number"||typeof fe=="number"&&isFinite(fe)&&Math.floor(fe)===fe?l!=="categorical"&&oe==="number"&&typeof fe=="number"&&typeof y=="number"&&y!==void 0&&fe<y?[new i.V(ee.key,pe,"stop domain values must appear in ascending order")]:(y=fe,l==="categorical"&&fe in S?[new i.V(ee.key,pe,"stop domain values must be unique")]:(S[fe]=!0,[])):[new i.V(ee.key,pe,`integer expected, found ${String(fe)}`)]}}function Fn(m){const r=(m.expressionContext==="property"?i.W:i.X)(i.U(m.value),m.valueSpec);if(r.result==="error")return r.value.map(p=>new i.V(`${m.key}${p.key}`,m.value,p.message));const l=r.value.expression||r.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!l.outputDefined())return[new i.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!i.Y(l))return[new i.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Gn(l,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!i.Z(l,["zoom","feature-state"]))return[new i.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!i._(l))return[new i.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Gn(m,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const y of r.valueSpec.expression.parameters)l.delete(y);if(l.size===0)return[];const p=[];return m instanceof i.$&&l.has(m.name)?[new i.V(r.key,r.value,`["${m.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(m.eachChild(y=>{p.push(...Gn(y,r))}),p)}function Un(m){const r=m.key,l=m.value,p=m.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(i.M(l))===-1&&y.push(new i.V(r,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(i.M(l))===-1&&y.push(new i.V(r,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),y}function pr(m){return i.a1(i.U(m.value))?Fn(i.L({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Ln(m)}function Ln(m){const r=m.value,l=m.key;if(i.K(r)!=="array")return[new i.V(l,r,`array expected, ${i.K(r)} found`)];const p=m.styleSpec;let y,b=[];if(r.length<1)return[new i.V(l,r,"filter array must have at least 1 element")];switch(b=b.concat(Un({key:`${l}[0]`,value:r[0],valueSpec:p.filter_operator,style:m.style,styleSpec:m.styleSpec})),i.M(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&i.M(r[1])==="$type"&&b.push(new i.V(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&b.push(new i.V(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(y=i.K(r[1]),y!=="string"&&b.push(new i.V(`${l}[1]`,r[1],`string expected, ${y} found`)));for(let S=2;S<r.length;S++)y=i.K(r[S]),i.M(r[1])==="$type"?b=b.concat(Un({key:`${l}[${S}]`,value:r[S],valueSpec:p.geometry_type,style:m.style,styleSpec:m.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&b.push(new i.V(`${l}[${S}]`,r[S],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let S=1;S<r.length;S++)b=b.concat(Ln({key:`${l}[${S}]`,value:r[S],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":y=i.K(r[1]),r.length!==2?b.push(new i.V(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):y!=="string"&&b.push(new i.V(`${l}[1]`,r[1],`string expected, ${y} found`))}return b}function br(m,r){const l=m.key,p=m.style,y=m.layer,b=m.styleSpec,S=m.value,L=m.objectKey,N=b[`${r}_${m.layerType}`];if(!N)return[];const F=L.match(/^(.*)-use-theme$/);if(r==="paint"&&F&&N[F[1]])return i.S(S)?[].concat(lr({key:m.key,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:r,propertyKey:L})):lr({key:l,value:S,valueSpec:{type:"string"},style:p,styleSpec:b});const B=L.match(/^(.*)-transition$/);if(r==="paint"&&B&&N[B[1]]&&N[B[1]].transition)return lr({key:l,value:S,valueSpec:b.transition,style:p,styleSpec:b});const H=m.valueSpec||N[L];if(!H)return[new i.J(l,S,`unknown property "${L}"`)];let W;if(i.K(S)==="string"&&i.O(H)&&!H.tokens&&(W=/^{([^}]+)}$/.exec(S))){const ce=`\`{ "type": "identity", "property": ${W?JSON.stringify(W[1]):'"_"'} }\``;return[new i.V(l,S,`"${L}" does not support interpolation syntax
Use an identity property function instead: ${ce}.`)]}const ee=[];if(m.layerType==="symbol")L!=="text-field"||!p||p.glyphs||p.imports||ee.push(new i.V(l,S,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&i.a2(i.U(S))&&i.M(S.type)==="identity"&&ee.push(new i.V(l,S,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&r==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&i.O(H)&&(i.a3(H)||i.Q(H))){const ce=i.W(i.U(S),H),oe=ce.value.expression||ce.value._styleExpression.expression;oe&&!i.Z(oe,["measure-light"])&&(L==="model-emissive-strength"&&i._(oe)&&i.Y(oe)||ee.push(new i.V(l,S,`${L} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return ee.concat(lr({key:m.key,value:S,valueSpec:H,style:p,styleSpec:b,expressionContext:"property",propertyType:r,propertyKey:L}))}function Kr(m){return br(m,"paint")}function hi(m){return br(m,"layout")}function si(m){let r=[];const l=m.value,p=m.key,y=m.style,b=m.styleSpec;l.type||l.ref||r.push(new i.V(p,l,'either "type" or "ref" is required'));let S=i.M(l.type);const L=i.M(l.ref);if(l.id){const N=i.M(l.id);for(let F=0;F<m.arrayIndex;F++){const B=y.layers[F];i.M(B.id)===N&&r.push(new i.V(p,l.id,`duplicate layer id "${l.id}", previously used at line ${B.id.__line__}`))}}if("ref"in l){let N;["type","source","source-layer","filter","layout"].forEach(F=>{F in l&&r.push(new i.V(p,l[F],`"${F}" is prohibited for ref layers`))}),y.layers.forEach(F=>{i.M(F.id)===L&&(N=F)}),N?N.ref?r.push(new i.V(p,l.ref,"ref cannot reference another ref layer")):S=i.M(N.type):typeof L=="string"&&r.push(new i.V(p,l.ref,`ref layer "${L}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(l.source){const N=y.sources&&y.sources[l.source],F=N&&i.M(N.type);N?F==="vector"&&S==="raster"?r.push(new i.V(p,l.source,`layer "${l.id}" requires a raster source`)):F==="raster"&&S!=="raster"?r.push(new i.V(p,l.source,`layer "${l.id}" requires a vector source`)):F!=="vector"||l["source-layer"]?F==="raster-dem"&&S!=="hillshade"?r.push(new i.V(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):F!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||F==="geojson"&&N.lineMetrics?S==="raster-particle"&&F!=="raster-array"&&r.push(new i.V(p,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):r.push(new i.V(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new i.V(p,l.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new i.V(p,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new i.V(p,l.source,`source "${l.source}" not found`))}else r.push(new i.V(p,l,'missing required property "source"'));return r=r.concat(_t({key:p,value:l,valueSpec:b.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>lr({key:`${p}.type`,value:l.type,valueSpec:b.layer.type,style:m.style,styleSpec:m.styleSpec,object:l,objectKey:"type"}),filter:N=>pr(i.L({layerType:S},N)),layout:N=>_t({layer:l,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":F=>hi(i.L({layerType:S},F))}}),paint:N=>_t({layer:l,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":F=>Kr(i.L({layerType:S,layer:l},F))}})}})),r}function wr(m){const r=m.value,l=m.key,p=i.K(r);return p!=="string"?[new i.V(l,r,`string expected, ${p} found`)]:[]}const Ur={promoteId:function m({key:r,value:l}){if(i.K(l)==="string")return wr({key:r,value:l});if(Array.isArray(l)){const p=[],y=i.U(l),b=i.X(y);return b.result==="error"&&b.value.forEach(S=>{p.push(new i.V(`${r}${S.key}`,null,`${S.message}`))}),i.Z(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new i.V(`${r}`,null,"promoteId expression should be only feature dependent")),p}{const p=[];for(const y in l)p.push(...m({key:`${r}.${y}`,value:l[y]}));return p}}};function Kn(m){const r=m.value,l=m.key,p=m.styleSpec,y=m.style;if(!r.type)return[new i.V(l,r,'"type" is required')];const b=i.M(r.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(r.url||r.tiles||S.push(new i.J(l,r,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(_t({key:l,value:r,valueSpec:p[`source_${b.replace("-","_")}`],style:m.style,styleSpec:p,objectElementValidators:Ur})),S;case"geojson":if(S=_t({key:l,value:r,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Ur}),r.cluster)for(const L in r.clusterProperties){const[N,F]=r.clusterProperties[L],B=typeof N=="string"?[N,["accumulated"],["get",L]]:N;S.push(...Fn({key:`${l}.${L}.map`,value:F,expressionContext:"cluster-map"})),S.push(...Fn({key:`${l}.${L}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return S;case"video":return _t({key:l,value:r,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return _t({key:l,value:r,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new i.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Un({key:`${l}.type`,value:r.type,valueSpec:{values:Hs(p)},style:y,styleSpec:p})}}function Hs(m){return m.source.reduce((r,l)=>{const p=m[l];return p.type.type==="enum"&&(r=r.concat(Object.keys(p.type.values))),r},[])}function fi(m){const r=m.value,l=m.styleSpec,p=l.light,y=m.style;let b=[];const S=i.K(r);if(r===void 0)return b;if(S!=="object")return b=b.concat([new i.V("light",r,`object expected, ${S} found`)]),b;for(const L in r){const N=L.match(/^(.*)-transition$/),F=L.match(/^(.*)-use-theme$/);b=b.concat(F&&p[F[1]]?lr({key:L,value:r[L],valueSpec:{type:"string"},style:y,styleSpec:l}):N&&p[N[1]]&&p[N[1]].transition?lr({key:L,value:r[L],valueSpec:l.transition,style:y,styleSpec:l}):p[L]?lr({key:L,value:r[L],valueSpec:p[L],style:y,styleSpec:l}):[new i.V(L,r[L],`unknown property "${L}"`)])}return b}function xo(m){const r=m.value;let l=[];if(!r)return l;const p=i.K(r);if(p!=="object")return l=l.concat([new i.V("light-3d",r,`object expected, ${p} found`)]),l;const y=m.styleSpec,b=y["light-3d"],S=m.key,L=m.style,N=m.style.lights;for(const H of["type","id"])if(!(H in r))return l=l.concat([new i.V("light-3d",r,`missing property ${H} on light`)]),l;if(r.type&&N)for(let H=0;H<m.arrayIndex;H++){const W=i.M(r.type),ee=N[H];i.M(ee.type)===W&&l.push(new i.V(S,r.id,`duplicate light type "${r.type}", previously defined at line ${ee.id.__line__}`))}const F=`properties_light_${r.type}`;if(!(F in y))return l=l.concat([new i.V("light-3d",r,`Invalid light type ${r.type}`)]),l;const B=y[F];for(const H in r)if(H==="properties"){const W=r[H],ee=i.K(W);if(ee!=="object")return l=l.concat([new i.V("properties",W,`object expected, ${ee} found`)]),l;for(const ce in W)l=l.concat(B[ce]?lr({key:ce,value:W[ce],valueSpec:B[ce],style:L,styleSpec:y}):[new i.J(m.key,W[ce],`unknown property "${ce}"`)])}else{const W=H.match(/^(.*)-transition$/),ee=H.match(/^(.*)-use-theme$/);l=l.concat(ee&&b[ee[1]]?lr({key:H,value:r[H],valueSpec:{type:"string"},style:L,styleSpec:y}):W&&b[W[1]]&&b[W[1]].transition?lr({key:H,value:r[H],valueSpec:y.transition,style:L,styleSpec:y}):b[H]?lr({key:H,value:r[H],valueSpec:b[H],style:L,styleSpec:y}):[new i.J(H,r[H],`unknown property "${H}"`)])}return l}function di(m){const r=m.value,l=m.key,p=m.style,y=m.styleSpec,b=y.terrain;let S=[];const L=i.K(r);if(r===void 0||L==="null")return S;if(L!=="object")return S=S.concat([new i.V("terrain",r,`object expected, ${L} found`)]),S;for(const N in r){const F=N.match(/^(.*)-transition$/),B=N.match(/^(.*)-use-theme$/);S=S.concat(B&&b[B[1]]?lr({key:N,value:r[N],valueSpec:{type:"string"},style:p,styleSpec:y}):F&&b[F[1]]&&b[F[1]].transition?lr({key:N,value:r[N],valueSpec:y.transition,style:p,styleSpec:y}):b[N]?lr({key:N,value:r[N],valueSpec:b[N],style:p,styleSpec:y}):[new i.J(N,r[N],`unknown property "${N}"`)])}if(r.source){const N=p.sources&&p.sources[r.source],F=N&&i.M(N.type);N?F!=="raster-dem"&&S.push(new i.V(l,r.source,`terrain cannot be used with a source of type ${String(F)}, it only be used with a "raster-dem" source type`)):S.push(new i.V(l,r.source,`source "${r.source}" not found`))}else S.push(new i.V(l,r,'terrain is missing required property "source"'));return S}function Hi(m){const r=m.value,l=m.style,p=m.styleSpec,y=p.fog;let b=[];const S=i.K(r);if(r===void 0)return b;if(S!=="object")return b=b.concat([new i.V("fog",r,`object expected, ${S} found`)]),b;for(const L in r){const N=L.match(/^(.*)-transition$/),F=L.match(/^(.*)-use-theme$/);b=b.concat(F&&y[F[1]]?lr({key:L,value:r[L],valueSpec:{type:"string"},style:l,styleSpec:p}):N&&y[N[1]]&&y[N[1]].transition?lr({key:L,value:r[L],valueSpec:p.transition,style:l,styleSpec:p}):y[L]?lr({key:L,value:r[L],valueSpec:y[L],style:l,styleSpec:p}):[new i.J(L,r[L],`unknown property "${L}"`)])}return b}const pi={"*":()=>[],array:yr,boolean:function(m){const r=m.value,l=m.key,p=i.K(r);return p!=="boolean"?[new i.V(l,r,`boolean expected, ${p} found`)]:[]},number:En,color:function(m){const r=m.key,l=m.value,p=i.K(l);return p!=="string"?[new i.V(r,l,`color expected, ${p} found`)]:i.a0.parseCSSColor(l)===null?[new i.V(r,l,`color expected, "${l}" found`)]:[]},enum:Un,filter:pr,function:bn,layer:si,object:_t,source:Kn,model:i.a4,light:fi,"light-3d":xo,terrain:di,fog:Hi,string:wr,formatted:function(m){return wr(m).length===0?[]:Fn(m)},resolvedImage:function(m){return wr(m).length===0?[]:Fn(m)},projection:function(m){const r=m.value,l=m.styleSpec,p=l.projection,y=m.style;let b=[];const S=i.K(r);if(S==="object")for(const L in r)b=b.concat(lr({key:L,value:r[L],valueSpec:p[L],style:y,styleSpec:l}));else S!=="string"&&(b=b.concat([new i.V("projection",r,`object or string expected, ${S} found`)]));return b},import:function(m){const{value:r,styleSpec:l}=m,{data:p,...y}=r;Object.defineProperty(y,"__line__",{value:r.__line__,enumerable:!1});let b=_t(i.L({},m,{value:y,valueSpec:l.import}));return i.M(y.id)===""&&b.push(new i.V(`${m.key}.id`,y,"import id can't be an empty string")),p&&(b=b.concat(Yi(p,l,{key:`${m.key}.data`}))),b},iconset:function(m){const r=m.value,l=m.key,p=m.styleSpec,y=m.style;if(!r.type)return[new i.V(l,r,'"type" is required')];const b=i.M(r.type);let S=[];if(S=S.concat(_t({key:l,value:r,valueSpec:p[`iconset_${b}`],style:y,styleSpec:p})),b==="source"&&r.source){const L=y.sources&&y.sources[r.source],N=L&&i.M(L.type);L?N!=="raster-array"&&S.push(new i.V(l,r.source,`iconset cannot be used with a source of type ${String(N)}, it only be used with a "raster-array" source type`)):S.push(new i.V(l,r.source,`source "${r.source}" not found`))}return S}};function lr(m,r=!1){const l=m.value,p=m.valueSpec,y=m.styleSpec;if(p.expression&&i.a2(i.M(l)))return bn(m);if(p.expression&&i.S(i.U(l)))return Fn(m);if(p.type&&pi[p.type]){const b=pi[p.type](m);return r===!0&&b.length>0&&i.K(m.value)==="array"?Fn(m):b}return _t(i.L({},m,{valueSpec:p.type?y[p.type]:p}))}function ml(m){const r=m.value,l=m.key,p=wr(m);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new i.V(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new i.V(l,r,'"glyphs" url must include a "{range}" token'))),p}function Yi(m,r=i.a5,l={}){return lr({key:l.key||"",value:m,valueSpec:r.$root,styleSpec:r,style:m,objectElementValidators:{glyphs:ml,"*":()=>[]}})}function as(m,r=i.a5){return at(Yi(m,r))}const Ho=m=>at(Kn(m)),ns=m=>at(fi(m)),Rr=m=>at(xo(m)),Ii=m=>at(di(m)),$l=m=>at(Hi(m)),Rs=m=>at(function(r){const l=r.value,p=r.style,y=r.styleSpec,b=y.snow;let S=[];const L=i.K(l);if(l===void 0)return S;if(L!=="object")return S=S.concat([new i.V("snow",l,`object expected, ${L} found`)]),S;for(const N in l){const F=N.match(/^(.*)-transition$/);S=S.concat(F&&b[F[1]]&&b[F[1]].transition?lr({key:N,value:l[N],valueSpec:y.transition,style:p,styleSpec:y}):b[N]?lr({key:N,value:l[N],valueSpec:b[N],style:p,styleSpec:y}):[new i.J(N,l[N],`unknown property "${N}"`)])}return S}(m)),Dt=m=>at(function(r){const l=r.value,p=r.style,y=r.styleSpec,b=y.rain;let S=[];const L=i.K(l);if(l===void 0)return S;if(L!=="object")return S=S.concat([new i.V("rain",l,`object expected, ${L} found`)]),S;for(const N in l){const F=N.match(/^(.*)-transition$/);S=S.concat(F&&b[F[1]]&&b[F[1]].transition?lr({key:N,value:l[N],valueSpec:y.transition,style:p,styleSpec:y}):b[N]?lr({key:N,value:l[N],valueSpec:b[N],style:p,styleSpec:y}):[new i.J(N,l[N],`unknown property "${N}"`)])}return S}(m)),he=m=>at(si(m)),_e=m=>at(pr(m)),Oe=m=>at(Kr(m)),Ye=m=>at(hi(m)),qe=m=>at(i.a4(m));function at(m){return m.slice().sort((r,l)=>r.line&&l.line?r.line-l.line:0)}function wt(m,r){let l=!1;if(r&&r.length)for(const p of r)p instanceof i.J?i.w(p.message):(m.fire(new i.z(new Error(p.message))),l=!0);return l}let ct;class Mt extends i.E{constructor(r,l="flat"){super(),this._transitionable=new i.a6(ct||(ct=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(r,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l,p={}){this._validate(ns,r,p)||(this._transitionable.setTransitionOrValue(r),this.id=l)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&wt(this,r.call(as,i.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Nt=class extends i.E{constructor(m,r,l,p){super(),this.scope=l,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),l,p),this._transitionable.setTransitionOrValue(m,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(m,r){this._transitionable.setTransitionOrValue(m,r)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new i.aa(m)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const r=m.value.expression;if(!r)return null;let l=-1,p=-1,y=1;for(const b of r.zoomStops)y=r.evaluate(new i.aa(b)),y>.01?(l=b,p=-1):p=b;return y<.01&&l>0&&p>l?[l,p]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof i.ab}};const Lt=45,sn=65,pn=.05;function yn(m,r,l,p){const y=i.ae(Lt,sn,l),[b,S]=$n(m,p);let L=1-Math.min(1,Math.exp((r-b)/(S-b)*-6));return L*=L*L,L=Math.min(1,1.00747*L),L*y*m.alpha}function $n(m,r){const l=.5/Math.tan(.5*r);return[m.range[0]+l,m.range[1]+l]}function er(m,r,l,p,y){const b=i.ad.vec3.transformMat4([],[r,l,p],y.mercatorFogMatrix);return yn(m,i.ad.vec3.length(b),y.pitch,y._fov)}function or(m,r,l,p,y,b,S){const L=[[l,p,0],[y,p,0],[y,b,0],[l,b,0]];let N=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(const B of L){const H=i.ad.vec3.transformMat4([],B,r),W=i.ad.vec3.length(H);N=Math.min(N,W),F=Math.max(F,W)}return[yn(m,N,S.pitch,S._fov),yn(m,F,S.pitch,S._fov)]}class ur extends i.E{constructor(r,l,p,y){super();const b=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(b,p,new Map(y)),this.set(r,y),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new i.af(b),this.scope=p}get state(){const r=this._transform,l=r.projection.name==="globe",p=i.ag(r.zoom),y=this.properties.get("range"),b=[.5,3];return{range:l?[i.ah(b[0],y[0],p),i.ah(b[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l,p={}){if(this._validate($l,r,p))return;const y=i.l({},r);for(const b of Object.keys(i.a5.fog))y[b]===void 0&&(y[b]=i.a5.fog[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ae(Lt,sn,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,y,b){const S=i.ac.fromLngLat(y),L=b.elevation?b.elevation.getAtPointOrZero(S):0;return er(p,S.x,S.y,L,b)}(this.state,r,l):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(r.toUnwrapped());return or(this.state,l,0,0,i.ai,i.ai,this._transform)}getOpacityForBounds(r,l,p,y,b){return this._transform.projection.supportsFog?or(this.state,r,l,p,y,b,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?$n(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const p of l){const y=r.points[p];let b;if(y[2]>=0)b=y;else{const S=r.points[p-4];b=i.aj(S,y,S[2]/(S[2]-y[2]))}if(er(this.state,b[0],b[1],0,this._transform)>=pn)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&wt(this,r.call(as,i.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let li,Si,mr,Vr,Xr=class extends i.E{constructor(m,r,l,p){super();const y=li||(li=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(y,l,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(y),this.scope=l}get state(){const m=this.properties.get("opacity"),r=this.properties.get("color"),l=this.properties.get("direction"),p=i.ak(l[0]),y=-Math.max(i.ak(l[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette"),L=this.properties.get("vignette-color");return L.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(r.r,r.g,r.b,r.a*m),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:L}}get(){return this._transitionable.serialize()}set(m,r,l={}){if(this._validate(Rs,m,l))return;const p=i.l({},m);for(const y of Object.keys(i.a5.snow))p[y]===void 0&&(p[y]=i.a5.snow[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,r,l){return(!l||l.validate!==!1)&&wt(this,m.call(as,i.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},ti=class extends i.E{constructor(m,r,l,p){super();const y=Si||(Si=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(y,l,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(y),this.scope=l}get state(){const m=this.properties.get("opacity"),r=this.properties.get("color"),l=this.properties.get("direction"),p=i.ak(l[0]),y=-Math.max(i.ak(l[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(r.r,r.g,r.b,r.a*m),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(m,r,l={}){if(this._validate(Dt,m,l))return;const p=i.l({},m);for(const y of Object.keys(i.a5.rain))p[y]===void 0&&(p[y]=i.a5.rain[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,r,l){return(!l||l.validate!==!1)&&wt(this,m.call(as,i.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class Oi extends i.E{constructor(r,l,p,y){super(),this.scope=p,this._options=r,this.properties=new i.af(l),this._transitionable=new i.a6(l,p,new Map(y)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,l){this._options=r,this._transitionable.setTransitionOrValue(r.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ms{constructor(r,l,p,y){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(r,l){let p,y;if(r instanceof i.P||typeof r[0]=="number"){const b=i.P.convert(r);p=[b],y=l.isPointAboveHorizon(b)}else{const b=i.P.convert(r[0]),S=i.P.convert(r[1]);p=[b,S],y=i.an(b,S).every(L=>l.isPointAboveHorizon(L))}return new ms(p,l.getCameraPoint(),y,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return i.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],y=i.an(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(y[3]=this.cameraPoint)),i.ao(y,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],y=i.an(l,p,r),b=this.cameraPoint.clone();switch(3*((b.y>l.y)+(b.y>p.y))+((b.x>l.x)+(b.x>p.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(r,l,p,y=0){const b=r.queryPadding/l._pixelsPerMercatorPixel+1,S=p?this._bufferedCameraMercator(b,l):this._bufferedScreenMercator(b,l);let L=r.tileID.wrap+(S.unwrapped?y:0);const N=S.polygon.map(fe=>i.ap(r.tileTransform,fe,L));if(!i.aq(N,0,0,i.ai,i.ai))return;L=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const F=this.screenGeometryMercator.polygon.map(fe=>i.ar(r.tileTransform,fe,L)),B=F.map(fe=>new i.P(fe[0],fe[1])),H=l.getFreeCameraOptions().position||new i.ac(0,0,0),W=i.ar(r.tileTransform,H,L),ee=F.map(fe=>{const pe=i.ad.vec3.sub(fe,fe,W);return i.ad.vec3.normalize(pe,pe),new i.as(W,pe)}),ce=i.at(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:ee,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(oe=i.au(N),oe.min.x=i.ay(oe.min.x,0,i.ai),oe.min.y=i.ay(oe.min.y,0,i.ai),oe.max.x=i.ay(oe.max.x,0,i.ai),oe.max.y=i.ay(oe.max.y,0,i.ai),oe),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:ce};var oe}_bufferedScreenMercator(r,l){const p=fo(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(b=>l.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(r,l){const p=fo(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(b=>l.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(r,l){const p=function(b,S){const L=i.ad.mat4.multiply([],S.pixelMatrix,S.globeMatrix),N=[0,-i.az,0,1],F=[0,i.az,0,1],B=[0,0,0,1];i.ad.vec4.transformMat4(N,N,L),i.ad.vec4.transformMat4(F,F,L),i.ad.vec4.transformMat4(B,B,L);const H=new i.P(N[0]/N[3],N[1]/N[3]),W=new i.P(F[0]/F[3],F[1]/F[3]),ee=i.aw(b,H)&&N[3]<B[3],ce=i.aw(b,W)&&F[3]<B[3];if(!ee&&!ce)return null;const oe=function(je,Ue,Ke){for(let nt=1;nt<je.length;nt++){const kt=No(Ue.pointCoordinate3D(je[nt-1]).x),xt=No(Ue.pointCoordinate3D(je[nt]).x);if(Ke<0){if(kt<xt)return{idx:nt,t:-kt/(xt-1-kt)}}else if(xt<kt)return{idx:nt,t:(1-kt)/(xt+1-kt)}}return null}(b,S,ee?-1:1);if(!oe)return null;const{idx:fe,t:pe}=oe;let Te=fe>1?to(b.slice(0,fe),S):[],De=fe<b.length?to(b.slice(fe),S):[];Te=Te.map(je=>new i.P(No(je.x),je.y)),De=De.map(je=>new i.P(No(je.x),je.y));const Ie=[...Te];Ie.length===0&&Ie.push(De[De.length-1]);const Ge=i.ah(Ie[Ie.length-1].y,(De.length===0?Te[0]:De[0]).y,pe);let Be;return Be=ee?[new i.P(0,Ge),new i.P(0,0),new i.P(1,0),new i.P(1,Ge)]:[new i.P(1,Ge),new i.P(1,1),new i.P(0,1),new i.P(0,Ge)],Ie.push(...Be),De.length===0?Ie.push(Te[0]):Ie.push(...De),{polygon:Ie.map(je=>new i.ac(je.x,je.y)),unwrapped:!1}}(r,l);if(p)return p;const y=function(b,S){let L=!1,N=-1/0,F=0;for(let H=0;H<b.length-1;H++)b[H].x>N&&(N=b[H].x,F=H);for(let H=0;H<b.length-1;H++){const W=(F+H)%(b.length-1),ee=b[W],ce=b[W+1];Math.abs(ee.x-ce.x)>.5&&(ee.x<ce.x?(ee.x+=1,W===0&&(b[b.length-1].x+=1)):(ce.x+=1,W+1===b.length-1&&(b[0].x+=1)),L=!0)}const B=i.av(S.center.lng);return L&&B<Math.abs(B-1)&&b.forEach(H=>{H.x-=1}),{polygon:b,unwrapped:L}}(to(r,l).map(b=>new i.P(No(b.x),b.y)),l);return{polygon:y.polygon.map(b=>new i.ac(b.x,b.y)),unwrapped:y.unwrapped}}}function to(m,r){return i.ax(m,l=>{const p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function No(m){return m<0?1+m%1:m%1}function fo(m){return 100*m|0}function gs(m,r,l,p,y){const b=function(L,N){if(L)return y(L);if(N){if(m.url&&N.tiles&&m.tiles&&delete m.tiles,N.variants){if(!Array.isArray(N.variants))return y(new Error("variants must be an array"));for(const B of N.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return y(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){N=i.l(N,B);break}}}const F=i.aA(i.l({},N,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);F.tiles=r.canonicalizeTileset(F,m.url),y(null,F)}},S=function(L,N,F){if(!L)return null;if(!N&&!F)return L;F=F||L.worldview_default;const B=Object.values(L.language||{});if(B.length===0)return null;const H=Object.values(L.worldview||{});if(H.length===0)return null;const W=B.every(ce=>ce===N),ee=H.every(ce=>ce===F);return W&&ee?L:N in(L.language_options||{})||F in(L.worldview_options||{})?null:L.language_options&&L.worldview_options?L:null}(m.data,l,p);return S?i.q.frame(()=>b(null,S)):m.url?i.n(r.transformRequest(r.normalizeSourceURL(m.url,null,l,p),i.R.Source),b):i.q.frame(()=>{const{data:L,...N}=m;b(null,N)})}class Ds{constructor(r,l,p){this.bounds=i.aB.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),p=Math.floor(i.av(this.bounds.getWest())*l),y=Math.floor(i.aC(this.bounds.getNorth())*l),b=Math.ceil(i.av(this.bounds.getEast())*l),S=Math.ceil(i.aC(this.bounds.getSouth())*l);return r.x>=p&&r.x<b&&r.y>=y&&r.y<S}}class gl extends i.E{constructor(r,l,p,y){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aA(l,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new i.aD}load(r){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,l,p,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new i.z(y));else if(b){if(i.l(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of b.vector_layers)this.vectorLayerIds.push(S.id),b.worldview&&b.worldview[S.source]&&this.localizableLayerIds.add(S.id)}b.bounds&&(this.tileBounds=new Ds(b.bounds,this.minzoom,this.maxzoom)),be(b.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}r&&r(y)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(r,l){const p=r.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(y,i.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,L=S?{image:S.image.clone()}:null,N={request:b,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:L,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(p)&&(N.worldview=this.map.getWorldview()||this.worldviewDefault,N.localizableLayerIds=this.localizableLayerIds),N.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",N,F.bind(this));else if(r.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",N,F.bind(this),void 0,!0);else{const B=i.aE.call({deduped:this._deduped},N,(H,W)=>{H||!W?F.call(this,H):(N.data={cacheControl:W.cacheControl,expires:W.expires,rawData:W.rawData.slice(0)},r.actor&&r.actor.send("loadTile",N,F.bind(this),void 0,!0))},!0);r.request={cancel:B}}function F(B,H){return delete r.request,r.aborted?l(null):B&&B.status!==404?l(B):(H&&H.resourceTiming&&(r.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&r.setExpiryData(H),r.loadVectorData(H,this.map.painter),i.aF(this.dispatcher),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,l){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ua extends i.E{constructor(r,l,p,y){super(),this.id=r,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},l),i.l(this,i.aA(l,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=gs(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new i.z(l)):p&&(i.l(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),p.bounds&&(this.tileBounds=new Ds(p.bounds,this.minzoom,this.maxzoom)),be(p.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),r&&r(l)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=i.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=i.o(this.map._requestManager.transformRequest(y,i.R.Tile),(b,S,L,N)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):b?(r.state="errored",l(b)):S?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:L,expires:N}),r.setTexture(S,this.map.painter),r.state="loaded",i.aF(this.dispatcher),void l(null)):l(null)))}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l&&l()}unloadTile(r,l){r.texture&&r.texture instanceof i.T?(r.destroy(!0),r.texture&&r.texture instanceof i.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Wi extends ua{constructor(r,l,p,y){super(r,l,p,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=i.l({type:"raster-array"},l)}triggerRepaint(r){const l=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);l&&l.enabled&&p&&l._clearRenderCacheForTile(p.id,r.tileID),this.map.triggerRepaint()}loadTile(r,l){const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,i.R.Tile),b={request:y,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=y,r.actor||(r.actor=this.dispatcher.getActor());const S=(L,N,F,B)=>{if(delete r.request,r.aborted)return r.state="unloaded",l(null);if(L)return L.name==="AbortError"?void 0:(r.state="errored",l(L));if(this.map._refreshExpiredTiles&&N&&r.setExpiryData({cacheControl:F,expires:B}),this.partial)r.state="empty";else{if(!N)return l(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=N;const H=new Map;for(const W in r._mrt.layers){const ee=r.getLayer(W);if(ee)for(const ce of ee.getBandList()){const{bytes:oe,tileSize:fe,buffer:pe}=ee.getBandView(ce),Te=fe+2*pe,De={data:new i.r({width:Te,height:Te},oe),pixelRatio:2,sdf:!1,usvg:!1,version:0};H.set(`${W}/${ce}`,De)}}for(const W in this.iconsets)this.iconsets[W].addIcons(H)}l(null)};r.request=this.partial?r.fetchHeader(void 0,S.bind(this)):r.actor.send("loadTile",b,S.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,l){const p=r.texture;p&&p instanceof i.T?(r.destroy(!0),this.map.painter.saveTileTexture(p)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,l,p){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(l,p,(y,b)=>{if(y)return r.state="errored",this.fire(new i.z(y)),void this.triggerRepaint(r);b&&(r._isHeaderLoaded=!0,r.setTexture(b,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:b})=>b===r),p=l&&l.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(r,l,p){if(!r)return;const y=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;l instanceof i.aI?b=l.paint.get("raster-array-band"):l instanceof i.aJ&&(b=l.paint.get("raster-particle-array-band"));const S=b||this.getInitialBand(y);if(S!=null)if(r.textureDescriptor){if(!r.updateNeeded(y,S)||p)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,y,S)}addIconset(r,l){this.iconsets[r]=l,this.partial=!1}}const yh={vector:gl,raster:ua,"raster-dem":class extends ua{constructor(m,r,l,p){super(m,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(m,r){const l=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,b){y&&(m.state="errored",r(y)),b&&(m.dem=b,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",r(null))}m.request=i.o(this.map._requestManager.transformRequest(l,i.R.Tile),(function(y,b,S,L){if(delete m.request,m.aborted)m.state="unloaded",r(null);else if(y)m.state="errored",r(y);else if(b){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:S,expires:L});const N=ImageBitmap&&b instanceof ImageBitmap&&i.t(),F=1-(b.width-i.aG(b.width))/2;F<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const B=N?b:i.q.getImageData(b,F),H={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:F};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",H,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const r=m.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,y=r.x===0?m.wrap-1:m.wrap,b=(r.x+1+l)%l,S=r.x+1===l?m.wrap+1:m.wrap,L={};return L[new i.aH(m.overscaledZ,y,r.z,p,r.y).key]={backfilled:!1},L[new i.aH(m.overscaledZ,S,r.z,b,r.y).key]={backfilled:!1},r.y>0&&(L[new i.aH(m.overscaledZ,y,r.z,p,r.y-1).key]={backfilled:!1},L[new i.aH(m.overscaledZ,m.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},L[new i.aH(m.overscaledZ,S,r.z,b,r.y-1).key]={backfilled:!1}),r.y+1<l&&(L[new i.aH(m.overscaledZ,y,r.z,p,r.y+1).key]={backfilled:!1},L[new i.aH(m.overscaledZ,m.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},L[new i.aH(m.overscaledZ,S,r.z,b,r.y+1).key]={backfilled:!1}),L}},"raster-array":Wi,geojson:class extends i.E{constructor(m,r,l,p){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=i.l({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const y=i.ai/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*y,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*y,extent:i.ai,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:i.ai,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*y,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const l of this._data.features)r.set(l.id,l);for(const l of m.features)r.set(l.id,l);this._data.features=[...r.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},r),this}getClusterChildren(m,r){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},r),this}getClusterLeaves(m,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:r,offset:l},p),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const r=i.l({append:m},this.workerOptions);r.scope=this.scope;const l=this._data;typeof l=="string"?(r.request=this.map._requestManager.transformRequest(i.q.resolveURL(l),i.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new i.z(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new i.A("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=i.C(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,r){const l=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,b=this._partialReload,S={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:b};m.request=this.actor.send(l,S,(L,N)=>b&&!N?(m.state="loaded",r(null)):(delete m.request,m.destroy(),m.aborted?r(null):L?r(L):(m.loadVectorData(N,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,r){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aK{constructor(m,r,l,p){super(m,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const r of m.urls)this.urls.push(this.map._requestManager.transformRequest(r,i.R.Source).url);i.aL(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new i.z(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const r=this.video.seekable;m<r.start(0)||m>r.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,r=m.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(m,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aK,model:class extends i.E{constructor(m,r,l,p){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const m=[];for(const r in this._options.models){const l=this._options.models[r],p=i.aN(this.map._requestManager.transformRequest(l.uri,i.R.Model).url).then(y=>{if(!y)return;const b=i.aO(y),S=new i.aP(r,l.position,l.orientation,b);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(y=>{this.fire(new i.z(new Error(`Could not load model ${r} from ${l.uri}: ${y.message}`)))});m.push(p)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new i.z(new Error(`Could not load models: ${r.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,r){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(m,r,l,p){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,r,l,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new i.z(p))):y&&(i.l(this,y),y.bounds&&(this.tileBounds=new Ds(y.bounds,this.minzoom,this.maxzoom)),be(y.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),m&&m(p)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,r){const l=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,i.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=r;else{if(m.buckets){const b=Object.values(m.buckets);for(const S of b)S.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",p,y.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(b,S){return m.aborted?r(null):b&&b.status!==404?r(b):(this.map._refreshExpiredTiles&&S&&m.setExpiryData(S),m.loadModelData(S,this.map.painter),m.state="loaded",void r(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aK{constructor(m,r,l,p){super(m,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new i.z(new i.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${m}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof i.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends i.E{constructor(m,r,l,p){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ds(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aA(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:r,y:l,z:p}=m.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,r){const{x:l,y:p,z:y}=m.tileID.canonical,b=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:y},{signal:b.signal})).then((function(S){return delete m.request,m.aborted?(m.state="unloaded",r(null)):S===void 0?(m.state="errored",r(null)):S===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",r(null)):function(L){return L instanceof ImageData||L instanceof HTMLCanvasElement||L instanceof ImageBitmap||L instanceof HTMLImageElement}(S)?(this.loadTileData(m,S),m.state="loaded",void r(null)):(m.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.name!=="AbortError"&&(m.state="errored",r(S))}),m.request.cancel=()=>b.abort()}loadTileData(m,r){m.setTexture(r,this.map.painter)}unloadTile(m,r){if(m.texture&&m.texture instanceof i.T?(m.destroy(!0),m.texture&&m.texture instanceof i.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:l,y:p,z:y}=m.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:y})}r&&r()}abortTile(m,r){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=i.C(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Eu=function(m,r,l,p){const y=new yh[r.type](m,r,l,p);if(y.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${y.id}`);return i.aQ(["load","abort","unload","serialize","prepare"],y),y};function Xc(m,r,l=""){return`${l}:${r.id||""}:${r.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:y,importId:b}=p;return`featureset:${y}${b?`:import:${b}`:""}`}}(m.target)}`}function Gl(m,r,l,p=""){if(m.uniqueFeatureID){const y=Xc(m,r,p);if(l.has(y))return!0;l.add(y)}return!1}function dd(m,r,l,p,y=!1){const b=r.sourceCache.transform,S=r.sourceCache.tilesIn(m,r.has3DLayers,y);S.sort(Oo);const L=[];for(const N of S){const F=N.tile.queryRenderedFeatures(r,N,l,p,b,y);Object.keys(F).length&&L.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:F})}return L.length===0?{}:function(N){const F={},B={};for(const H of N){const W=H.queryResults,ee=H.wrappedTileID,ce=B[ee]=B[ee]||{};for(const oe in W){const fe=W[oe],pe=ce[oe]=ce[oe]||{},Te=F[oe]=F[oe]||[];for(const De of fe)pe[De.featureIndex]||(pe[De.featureIndex]=!0,Te.push(De))}}return F}(L)}function Ba(m,r,l,p,y){const b={},S=p.queryRenderedSymbols(m),L=[];for(const N of Object.keys(S).map(Number))L.push(y[N]);L.sort(Oo);for(const N of L){const F=N.featureIndex.lookupSymbolFeatures(S[N.bucketInstanceId],N.bucketIndex,N.sourceLayerIndex,r,l);for(const B in F){const H=b[B]=b[B]||[],W=F[B];W.sort((ee,ce)=>{const oe=N.featureSortOrder;if(oe){const fe=oe.indexOf(ee.featureIndex);return oe.indexOf(ce.featureIndex)-fe}return ce.featureIndex-ee.featureIndex});for(const ee of W)H.push(ee)}}return b}function Cu(m,r){const l=m.getRenderableIds().map(b=>m.getTileByID(b)),p=[],y={};for(let b=0;b<l.length;b++){const S=l[b],L=S.tileID.canonical.key;y[L]||(y[L]=!0,S.querySourceFeatures(p,r))}return p}function Oo(m,r){const l=m.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Hl(m,r){const l={};if(!r)return l;for(const p of m){const y=p.layerIds.map(b=>r.getLayer(b)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>y.filter(S=>S.id===b)[0]));for(const b of y)l[b.fqid]=p}}return l}const zo=32,Sa=33,_l=new Uint16Array(8184);for(let m=0;m<2046;m++){let r=m+2,l=0,p=0,y=0,b=0,S=0,L=0;for(1&r?y=b=S=zo:l=p=L=zo;(r>>=1)>1;){const F=l+y>>1,B=p+b>>1;1&r?(y=l,b=p,l=S,p=L):(l=y,p=b,y=S,b=L),S=F,L=B}const N=4*m;_l[N+0]=l,_l[N+1]=p,_l[N+2]=y,_l[N+3]=b}const Wo=new Uint16Array(2178),bo=new Uint8Array(1089),Yc=new Uint16Array(1089);function Pu(m){return m===0?-.03125:m===32?.03125:0}const vh={type:2,extent:i.ai,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ai+1,0),new i.P(i.ai+1,i.ai+1),new i.P(0,i.ai+1),new i.P(0,0)]]};class Ta{constructor(r,l,p,y,b){this.tileID=r,this.uid=i.aW(),this.uses=0,this.tileSize=l,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<i.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,p){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=Hl(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof i.aY){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof i.aY&&b.hasRTLText){this.hasRTLText=!0,i.aZ();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],S=l.style.getOwnLayer(y);if(!S)continue;const L=S.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,L)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new i.aX}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,l,p){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,Hl(r.buckets,l.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const y in this.buckets){const b=this.buckets[y];b.uploadPending()&&b.upload(r)}const l=r.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new i.T(r,p.image,l.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(r,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(r,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(r,l,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,p),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=l.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(r,l,p,y,b,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const L=function(N,F){const B=i.ad.mat4.fromScaling([],[.5*N.width,.5*-N.height,1]);return i.ad.mat4.translate(B,B,[1,-1,0]),i.ad.mat4.multiply(B,B,N.calculateProjMatrix(F.toUnwrapped())),Float32Array.from(B)}(b,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:l,pixelPosMatrix:L,transform:y,availableImages:p,tileTransform:this.tileTransform})}querySourceFeatures(r,l){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),b=l?l.sourceLayer:"",S=y._geojsonTileLayer||y[b];if(!S)return;const L=i.a_(l&&l.filter),{z:N,x:F,y:B}=this.tileID.canonical,H={z:N,x:F,y:B};for(let W=0;W<S.length;W++){const ee=S.feature(W);if(L.needGeometry){const fe=i.a$(ee,!0);if(!L.filter(new i.aa(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!L.filter(new i.aa(this.tileID.overscaledZ),ee))continue;const ce=p.getId(ee,b),oe=new i.b0(ee,N,F,B,ce);oe.tile=H,r.push(oe)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const p=i.b1(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(l)if(this.expirationTime<l)y=!0;else{const b=this.expirationTime-l;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,l){if(!this.latestFeatureIndex||!r.style)return;const p=this.latestFeatureIndex.loadVTLayers(),y=r.style.listImages(),b=r.style.getBrightness();for(const S in this.buckets){if(!r.style.hasLayer(S))continue;const L=this.buckets[S],N=L.layers[0],F=N.sourceLayer||"_geojsonTileLayer",B=p[F],H=r.style.getLayerSourceCache(N);let W={};H&&(W=H._state.getState(F,void 0));const ee=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},ce=Object.keys(W).length>0&&!l;ce&&!L.stateDependentLayers.length&&!l||L.update(W,B,y,ee,ce?L.stateDependentLayers:L.layers,l,b),(L instanceof i.b2||L instanceof i.b3)&&r._terrain&&r._terrain.enabled&&H&&L.uploadPending()&&r._terrain._clearRenderCacheForTile(H.id,this.tileID);const oe=r&&r.style&&r.style.getOwnLayer(S);oe&&(this.queryPadding=Math.max(this.queryPadding,oe.queryRadius(L)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=i.q.now()+r}setTexture(r,l){const p=l.context,y=p.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r):(this.texture=new i.T(p,r,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(r,l){const p={};for(const y of l)p[y]=!0;this.dependencies[r]=p}hasDependency(r,l){for(const p of r){const y=this.dependencies[p];if(y){for(const b of l)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const p=i.b4(vh,this.tileID.canonical,this.tileTransform)[0],y=new i.b5,b=new i.b6;for(let S=0;S<p.length;S++){const{x:L,y:N}=p[S];y.emplaceBack(L,N),b.emplaceBack(S)}b.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(b),this._tileDebugBuffer=r.createVertexBuffer(y,i.b7.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const p=i.b4(vh,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const S=function(L,N){const F=i.aR(L,N),B=Math.pow(2,L.z);for(let fe=0;fe<Sa;fe++)for(let pe=0;pe<Sa;pe++){const Te=i.aS((L.x+(pe+Pu(pe))/zo)/B),De=i.aT((L.y+(fe+Pu(fe))/zo)/B),Ie=N.project(Te,De),Ge=fe*Sa+pe;Wo[2*Ge+0]=Math.round((Ie.x*F.scale-F.x)*i.ai),Wo[2*Ge+1]=Math.round((Ie.y*F.scale-F.y)*i.ai)}bo.fill(0),Yc.fill(0);for(let fe=2045;fe>=0;fe--){const pe=4*fe,Te=_l[pe+0],De=_l[pe+1],Ie=_l[pe+2],Ge=_l[pe+3],Be=Te+Ie>>1,je=De+Ge>>1,Ue=Be+je-De,Ke=je+Te-Be,nt=De*Sa+Te,kt=Ge*Sa+Ie,xt=je*Sa+Be,Zt=Math.hypot((Wo[2*nt+0]+Wo[2*kt+0])/2-Wo[2*xt+0],(Wo[2*nt+1]+Wo[2*kt+1])/2-Wo[2*xt+1])>=16;bo[xt]=bo[xt]||(Zt?1:0),fe<1022&&(bo[xt]=bo[xt]||bo[(De+Ke>>1)*Sa+(Te+Ue>>1)]||bo[(Ge+Ke>>1)*Sa+(Ie+Ue>>1)])}const H=new i.aU,W=new i.aV;let ee=0;function ce(fe,pe){const Te=pe*Sa+fe;return Yc[Te]===0&&(H.emplaceBack(Wo[2*Te+0],Wo[2*Te+1],fe*i.ai/zo,pe*i.ai/zo),Yc[Te]=++ee),Yc[Te]-1}function oe(fe,pe,Te,De,Ie,Ge){const Be=fe+Te>>1,je=pe+De>>1;if(Math.abs(fe-Ie)+Math.abs(pe-Ge)>1&&bo[je*Sa+Be])oe(Ie,Ge,fe,pe,Be,je),oe(Te,De,Ie,Ge,Be,je);else{const Ue=ce(fe,pe),Ke=ce(Te,De),nt=ce(Ie,Ge);W.emplaceBack(Ue,Ke,nt)}}return oe(0,0,zo,zo,zo,0),oe(zo,zo,0,0,0,zo),{vertices:H,indices:W}}(this.tileID.canonical,l);y=S.vertices,b=S.indices}else{y=new i.aU,b=new i.aV;for(const{x:L,y:N}of p)y.emplaceBack(L,N,0,0);const S=i.b9(y.int16,void 0,4);for(let L=0;L<S.length;L+=3)b.emplaceBack(S[L],S[L+1],S[L+2])}this._tileBoundsBuffer=r.createVertexBuffer(y,i.ba.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(b),this._tileBoundsSegments=i.b8.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(r,l){const p=l.projection;if(!p||p.name!=="globe"||l.freezeTileCoverage)return;const y=this.tileID.canonical,b=i.bb(y,l),S=i.bc(b),L=i.ag(l.zoom);let N;L>0&&(N=i.ad.mat4.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,y,l,S,N,L),this._makeGlobeTileDebugTextBuffer(r,y,l,S,N,L)}_globePoint(r,l,p,y,b,S,L){let N=i.bd(r,l,p);if(S){const F=1<<p.z,B=i.av(y.center.lng),H=i.aC(y.center.lat),W=(p.x+.5)/F-B;let ee=0;W>.5?ee=-1:W<-.5&&(ee=1);let ce=(r/i.ai+p.x)/F+ee,oe=(l/i.ai+p.y)/F;ce=(ce-B)*y._pixelsPerMercatorPixel+B,oe=(oe-H)*y._pixelsPerMercatorPixel+H;const fe=[ce*y.worldSize,oe*y.worldSize,0];i.ad.vec3.transformMat4(fe,fe,S),N=i.be(N,fe,L)}return i.ad.vec3.transformMat4(N,N,b)}_makeGlobeTileDebugBorderBuffer(r,l,p,y,b,S){const L=new i.b5,N=new i.b6,F=new i.bf,B=(W,ee,ce,oe,fe)=>{const pe=(ce-W)/(fe-1),Te=(oe-ee)/(fe-1),De=L.length;for(let Ie=0;Ie<fe;Ie++){const Ge=W+Ie*pe,Be=ee+Ie*Te;L.emplaceBack(Ge,Be);const je=this._globePoint(Ge,Be,l,p,y,b,S);F.emplaceBack(je[0],je[1],je[2]),N.emplaceBack(De+Ie)}},H=i.ai;B(0,0,H,0,16),B(H,0,H,H,16),B(H,H,0,H,16),B(0,H,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(N),this._tileDebugBuffer=r.createVertexBuffer(L,i.b7.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(F,i.bg.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,L.length,N.length)}_makeGlobeTileDebugTextBuffer(r,l,p,y,b,S){const L=i.ai/4,N=new i.b5,F=new i.aV,B=new i.bf,H=25;F.reserve(32),N.reserve(H),B.reserve(H);const W=(ee,ce)=>H*ee+ce;for(let ee=0;ee<H;ee++){const ce=ee*L;for(let oe=0;oe<H;oe++){const fe=oe*L;N.emplaceBack(fe,ce);const pe=this._globePoint(fe,ce,l,p,y,b,S);B.emplaceBack(pe[0],pe[1],pe[2])}}for(let ee=0;ee<4;ee++)for(let ce=0;ce<4;ce++){const oe=W(ee,ce),fe=W(ee,ce+1),pe=W(ee+1,ce),Te=W(ee+1,ce+1);F.emplaceBack(oe,fe,pe),F.emplaceBack(pe,fe,Te)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(F),this._tileDebugTextBuffer=r.createVertexBuffer(N,i.b7.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(B,i.bg.members),this._tileDebugTextSegments=i.b8.simpleSegment(0,0,H,32)}destroy(r=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bh.setPbf(i.bi);class wo extends Ta{constructor(r,l,p,y,b){super(r,l,p,y,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexture(r,l){const p=l.context,y=p.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r,{premultiply:!1}):this.texture=new i.T(p,r,y.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,l){const p=this._mrt=new i.bh(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=i.bj(y,(b,S,L,N)=>{if(b)l(b);else try{const F=p.getHeaderLength(S);if(F>r)return void(this.request=this.fetchHeader(F,l));p.parseHeader(S),this._isHeaderLoaded=!0;let B=0;for(const H of Object.values(p.layers))B=Math.max(B,H.dataIndex[H.dataIndex.length-1].lastByte);S.byteLength>=B&&(this.entireBuffer=S),l(null,this.entireBuffer||S,L,N)}catch(F){l(F)}}),this.request}fetchBand(r,l,p){const y=this._mrt;if(!this._isHeaderLoaded||!y)return void p(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void p(new Error("Can't fetch tile band without an actor"));let S;const L=(H,W)=>{S.complete(H,W),H?p(H):(this.updateTextureDescriptor(r,l),p(null,this.textureDescriptor&&this.textureDescriptor.img))},N=(H,W)=>{if(H)return p(H);const ee=b.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:W,task:S},L,void 0,!0);this._workQueue.push(()=>{ee&&ee.cancel(),S.cancel()})},F=y.getLayer(r);if(!F)return void p(new Error(`Unknown sourceLayer "${r}"`));if(F.hasDataForBand(l))return this.updateTextureDescriptor(r,l),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const B=F.getDataRange([l]);if(S=y.createDecodingTask(B),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)N(null,this.entireBuffer.slice(B.firstByte,B.lastByte+1));else{const H=Object.assign({},this.requestParams,{headers:{Range:`bytes=${B.firstByte}-${B.lastByte}`}}),W=i.bj(H,N);this._fetchQueue.push(()=>{W.cancel(),S.cancel()})}else p(null)}updateNeeded(r,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,l){if(!this._mrt)return;const p=this._mrt.getLayer(r);if(!p||!p.hasBand(l)||!p.hasDataForBand(l))return;const{bytes:y,tileSize:b,buffer:S,offset:L,scale:N}=p.getBandView(l),F=b+2*S,B=new i.r({width:F,height:F},y),H=this.texture;H&&H instanceof i.T&&H.update(B,{premultiply:!1}),this.textureDescriptor={layer:r,band:l,img:B,buffer:S,offset:L,tileSize:b,format:p.pixelFormat,mix:[N,256*N,65536*N,16777216*N]}}}class Wl{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,p){const y=r.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:l,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(r,b)},p)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const p=r.wrapped().key,y=l===void 0?0:this.data[p].indexOf(l),b=this.data[p][y];return this.data[p].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const p in this.data)for(const y of this.data[p])r(y.value)||l.push(y);for(const p of l)this.remove(p.value.tileID,p)}}class Jc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,p){const y=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][y]=this.stateChanges[r][y]||{},i.l(this.stateChanges[r][y],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const b in this.state[r])b!==y&&(this.deletedStates[r][b]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][y]===null){this.deletedStates[r][y]={};for(const b in this.state[r][y])p[b]||(this.deletedStates[r][y][b]=null)}else for(const b in p)this.deletedStates[r]&&this.deletedStates[r][y]&&this.deletedStates[r][y][b]===null&&delete this.deletedStates[r][y][b]}removeFeatureState(r,l,p){if(this.deletedStates[r]===null)return;const y=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&l!==void 0)this.deletedStates[r][y]!==null&&(this.deletedStates[r][y]=this.deletedStates[r][y]||{},this.deletedStates[r][y][p]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][y])for(p in this.deletedStates[r][y]={},this.stateChanges[r][y])this.deletedStates[r][y][p]=null;else this.deletedStates[r][y]=null;else this.deletedStates[r]=null}getState(r,l){const p=this.state[r]||{},y=this.stateChanges[r]||{},b=this.deletedStates[r];if(b===null)return{};if(l!==void 0){const L=String(l),N=i.l({},p[L],y[L]);if(b){const F=b[l];if(F===null)return{};for(const B in F)delete N[B]}return N}const S=i.l({},p,y);if(b)for(const L in b)delete S[L];return S}initializeTileState(r,l){r.refreshFeatureState(l)}coalesceChanges(r,l){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),i.l(this.state[y][S],this.stateChanges[y][S]),b[S]=this.state[y][S];p[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const S in this.state[y])b[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else if(this.state[y][S])for(const L of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][L];b[S]=this.state[y][S]}p[y]=p[y]||{},i.l(p[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const y in r)r[y].refreshFeatureState(l)}}class So extends i.E{constructor(r,l,p){super(),this.id=r,this._onlySymbols=p,l.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Wl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Jc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const p=this._tiles[l];p.upload(r),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(qr).map(r=>r.key)}getRenderableIds(r,l){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,r,l)&&p.push(this._tiles[y]);return r?p.sort((y,b)=>{const S=y.tileID,L=b.tileID,N=new i.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),F=new i.P(L.canonical.x,L.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-L.overscaledZ||F.y-N.y||F.x-N.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(qr).map(y=>y.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l,p){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())&&(p||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=l),this._loadTile(p,this._tileLoaded.bind(this,p,r,l)))}_tileLoaded(r,l,p,y){if(y)if(r.state="errored",y.status!==404)this._source.fire(new i.z(y,{tile:r}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=i.q.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let y=0;y<l.length;y++){const b=l[y];if(r.neighboringTiles&&r.neighboringTiles[b]){const S=this.getTileByID(b);p(r,S),p(S,r)}}function p(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let S=b.tileID.canonical.x-y.tileID.canonical.x;const L=b.tileID.canonical.y-y.tileID.canonical.y,N=Math.pow(2,y.tileID.canonical.z),F=b.tileID.key;S===0&&L===0||Math.abs(L)>1||(Math.abs(S)>1&&(Math.abs(S+N)===1?S+=N:Math.abs(S-N)===1&&(S-=N)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,S,L),y.neighboringTiles&&y.neighboringTiles[F]&&(y.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,p,y){for(const b in this._tiles){let S=this._tiles[b];if(y[b]||!S.hasData()||S.tileID.overscaledZ<=l||S.tileID.overscaledZ>p)continue;let L=S.tileID;for(;S&&S.tileID.overscaledZ>l+1;){const F=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[F.key],S&&S.hasData()&&(L=F)}let N=L;for(;N.overscaledZ>l;)if(N=N.scaledTo(N.overscaledZ-1),r[N.key]){y[L.key]=L;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=l?p:null}for(let p=r.overscaledZ-1;p>=l;p--){const y=r.scaledTo(p),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const p=Math.ceil(r.width/l)+1,y=Math.ceil(r.height/l)+1,b=Math.floor(p*y*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(L)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const p={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+l),p[b.tileID.key]=b}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(r,l,p,y){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let S,L=this._source.maxzoom;const N=this.map&&this.map.painter?this.map.painter._terrain:null;if(N&&N.sourceCache===this&&N.attenuationRange()){const H=N.attenuationRange()[0],W=Math.floor(H)-Math.log2(N.getDemUpscale());L>W&&(L=W)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new i.aH(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y));else if(this.tileCoverLift!==0){const H=r.clone();H.tileCoverLift=this.tileCoverLift,S=H.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:L,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&r.projection.name==="globe"&&(S.push(new i.aH(1,0,1,0,0)),S.push(new i.aH(1,0,1,1,0)),S.push(new i.aH(1,0,1,0,1)),S.push(new i.aH(1,0,1,1,1)))}else if(S=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:L,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const H=this._source.hasTile.bind(this._source);S=S.filter(W=>H(W))}}else S=[];if(S.length>0&&this.castsShadows&&y&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!po(this._source.type)){const H=r.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),W=Math.min(H,this._source.maxzoom);if(b){const ee=r.extendTileCover(S,W);for(const ce of ee)S.push(ce)}else{const ee=r.extendTileCover(S,W,y);for(const ce of ee)this._shadowCasterTiles[ce.key]=!0,S.push(ce)}}const F=this._updateRetainedTiles(S);if(po(this._source.type)&&S.length!==0){const H={},W={},ee=Object.keys(F);for(const oe of ee){const fe=F[oe],pe=this._tiles[oe];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=i.q.now())continue;const Te=this.findLoadedParent(fe,Math.max(fe.overscaledZ-So.maxOverzooming,this._source.minzoom));Te&&(this._addTile(Te.tileID),H[Te.tileID.key]=Te.tileID),W[oe]=fe}const ce=S[S.length-1].overscaledZ;for(const oe in this._tiles){const fe=this._tiles[oe];if(F[oe]||!fe.hasData())continue;let pe=fe.tileID;for(;pe.overscaledZ>ce;){pe=pe.scaledTo(pe.overscaledZ-1);const Te=this._tiles[pe.key];if(Te&&Te.hasData()&&W[pe.key]){F[oe]=fe.tileID;break}}}for(const oe in H)F[oe]||(this._coveredTiles[oe]=!0,F[oe]=H[oe])}for(const H in F)this._tiles[H].clearFadeHold();const B=i.bk(this._tiles,F);for(const H of B){const W=this._tiles[H];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(+H)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(r.length===0)return l;const p={},y=r.reduce((F,B)=>Math.min(F,B.overscaledZ),1/0),b=r[0].overscaledZ,S=Math.max(b-So.maxOverzooming,this._source.minzoom),L=Math.max(b+So.maxUnderzooming,this._source.minzoom),N={};for(const F of r){const B=this._addTile(F);l[F.key]=F,B.hasData()||y<this._source.maxzoom&&(N[F.key]=F)}this._retainLoadedChildren(N,y,L,l);for(const F of r){let B=this._tiles[F.key];if(B.hasData())continue;if(F.canonical.z>=this._source.maxzoom){const W=F.children(this._source.maxzoom)[0],ee=this.getTile(W);if(ee&&ee.hasData()){l[W.key]=W;continue}}else{const W=F.children(this._source.maxzoom);if(l[W[0].key]&&l[W[1].key]&&l[W[2].key]&&l[W[3].key])continue}let H=B.wasRequested();for(let W=F.overscaledZ-1;W>=S;--W){const ee=F.scaledTo(W);if(p[ee.key]||(p[ee.key]=!0,B=this.getTile(ee),!B&&H&&(B=this._addTile(ee)),B&&(l[ee.key]=ee,H=B.wasRequested(),B.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let p,y=this._tiles[r].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}l.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;y=b}for(const b of l)this._loadedParentTiles[b]=p}}_addTile(r){let l=this._tiles[r.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const p=!!l;if(!p){const y=this.map?this.map.painter:null,b=this._source.tileSize*r.overscaleFactor();l=this._source.type==="raster-array"?new wo(r,b,this.transform.tileZoom,y,this._isRaster):new Ta(r,b,this.transform.tileZoom,y,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,p||this._source.fire(new i.A("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=l.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,p){const y=[],b=this.transform;if(!b)return y;const S=b.projection.name==="globe",L=i.av(b.center.lng);for(const N in this._tiles){const F=this._tiles[N];if(p&&F.clearQueryDebugViz(),F.holdingForFade())continue;let B;if(S){const H=F.tileID.canonical;if(H.z===0){const W=[Math.abs(i.ay(L,...Bn(H,-1))-L),Math.abs(i.ay(L,...Bn(H,1))-L)];B=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(i.ay(L,...Bn(H,-1))-L),Math.abs(i.ay(L,...Bn(H,0))-L),Math.abs(i.ay(L,...Bn(H,1))-L)];B=[W.indexOf(Math.min(...W))-1]}}else B=[0];for(const H of B){const W=r.containsTile(F,b,l,H);W&&y.push(W)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,l){const p=this.getRenderableIds(r,l).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(r){const l=r.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const S of l){const L=1/(1<<S.canonical.z);b[S.key]=((S.canonical.x+.5)*L+S.wrap-p[0])*y[0]+((S.canonical.y+.5)*L-p[1])*y[1]-p[2]*y[2]}return l.sort((S,L)=>b[S.key]-b[L.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(po(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(r,l,p){this._state.updateState(r=r||"_geojsonTileLayer",l,p)}removeFeatureState(r,l,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,p)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,p){const y=this._tiles[r];y&&y.setDependencies(l,p)}reloadTilesForDependencies(r,l){for(const p in this._tiles)this._tiles[p].hasDependency(r,l)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(r,l))}_preloadTiles(r,l){if(!this._sourceLoaded){const N=()=>{this._sourceLoaded&&(this._source.off("data",N),this._preloadTiles(r,l))};return void this._source.on("data",N)}const p=new Map,y=Array.isArray(r)?r:[r],b=this.map.painter.terrain,S=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const N of y){const F=N.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const B of F)p.set(B.key,B);this.usedForTerrain&&N.updateElevation(!1)}const L=Array.from(p.values());i.bl(L,(N,F)=>{const B=new Ta(N,this._source.tileSize*N.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(B,H=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),F(H,B)})},l)}}function qr(m,r){const l=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return m.overscaledZ-r.overscaledZ||p-l||r.canonical.y-m.canonical.y||r.canonical.x-m.canonical.x}function po(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function Bn(m,r){const l=1<<m.z;return[m.x/l+r,(m.x+1)/l+r]}So.maxOverzooming=10,So.maxUnderzooming=3;class fd{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,l=!1;for(const p in this.style._mergedLayers){const y=this.style._mergedLayers[p];if(y.type==="fill-extrusion")this.layers.push({layer:y,visible:r,visibilityChanged:l});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:r,visibilityChanged:l})}}}onNewFrame(r){this.layersGotHidden=!1;for(const l of this.layers){const p=l.layer;let y=!1;p.type==="fill-extrusion"?y=!p.isHidden(r)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(y=!p.isHidden(r)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&l.visible,l.visible=y}}updateZOffset(r,l){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,S=this.style.getLayerSourceCache(b);let L=1;b.type==="fill-extrusion"&&(L=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0);let N=S?S.getTile(l):null;if(!N&&S&&l.canonical.z>S.getSource().minzoom){let F=l.scaledTo(Math.min(S.getSource().maxzoom,l.overscaledZ-1));for(;F.overscaledZ>=S.getSource().minzoom&&(N=S.getTile(F),!N&&F.overscaledZ!==0);)F=F.scaledTo(F.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:N?N.getBucket(b):null,tileID:N?N.tileID:l,verticalScale:L})}r.hasAnyZOffset=!1;let p=!1;for(let y=0;y<r.symbolInstances.length;y++){const b=r.symbolInstances.get(y),S=b.zOffset,L=this._getHeightAtTileOffset(l,b.tileAnchorX,b.tileAnchorY);b.zOffset=L!==Number.NEGATIVE_INFINITY?L:S,p||S===b.zOffset||(p=!0),r.hasAnyZOffset||b.zOffset===0||(r.hasAnyZOffset=!0)}p&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,l,p,y){let b=l,S=p;if(r.canonical.z!==y.canonical.z){const L=y.canonical,N=1/(1<<r.canonical.z-L.z);b=(l+r.canonical.x*i.ai)*N-L.x*i.ai|0,S=(p+r.canonical.y*i.ai)*N-L.y*i.ai|0}return{tileX:b,tileY:S}}_getHeightAtTileOffset(r,l,p){let y,b;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:L,tileID:N,verticalScale:F}=this.currentBuildingBuckets[S];if(!L)continue;const{tileX:B,tileY:H}=this._mapCoordToOverlappingTile(r,l,p,N),W=L.getHeightAtTileCoord(B,H);W&&W.height!==void 0&&(W.hidden?y=W.height:b=Math.max(W.height*F,b||0))}if(b!==void 0)return b;for(let S=0;S<this.layers.length;++S){const L=this.layers[S];if(L.layer.type!=="model"||!L.visible)continue;const{bucket:N,tileID:F}=this.currentBuildingBuckets[S];if(!N)continue;const{tileX:B,tileY:H}=this._mapCoordToOverlappingTile(r,l,p,F),W=N.getHeightAtTileCoord(B,H);if(W&&!W.hidden)return W.height===void 0&&y!==void 0?Math.min(W.maxHeight,y)*W.verticalScale:W.height?W.height*W.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function $r(m,r){const l={};for(const p in m)p!=="ref"&&(l[p]=m[p]);return i.bm.forEach(p=>{p in r&&(l[p]=r[p])}),l}function Mu(m){m=m.slice();const r=Object.create(null);for(let l=0;l<m.length;l++)r[m[l].id]=m[l];for(let l=0;l<m.length;l++)"ref"in m[l]&&(m[l]=$r(m[l],r[m[l].ref]));return m}const zr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ns(m,r,l){l.push({command:zr.addSource,args:[m,r[m]]})}function Iu(m,r,l){r.push({command:zr.removeSource,args:[m]}),l[m]=!0}function vc(m,r,l,p){Iu(m,l,p),Ns(m,r,l)}function In(m,r,l){let p;for(p in m[l])if(m[l].hasOwnProperty(p)&&p!=="data"&&!i.bn(m[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&p!=="data"&&!i.bn(m[l][p],r[l][p]))return!1;return!0}function Fr(m,r,l,p,y,b){let S;for(S in r=r||{},m=m||{})m.hasOwnProperty(S)&&(i.bn(m[S],r[S])||l.push({command:b,args:[p,S,r[S],y]}));for(S in r)r.hasOwnProperty(S)&&!m.hasOwnProperty(S)&&(i.bn(m[S],r[S])||l.push({command:b,args:[p,S,r[S],y]}))}function Dr(m){return m.id}function no(m,r){return m[r.id]=r,m}class Qc{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=i.ay(r,0,1);let l=1,p=this._distances[l];const y=r*this.paddedLength+this.padding;for(;p<y&&l<this._distances.length;)p=this._distances[++l];const b=l-1,S=this._distances[b],L=p-S,N=L>0?(y-S)/L:0;return this.points[b].mult(1-N).add(this.points[l].mult(N))}}class Pr{constructor(r,l,p){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,y,b){this._forEachCell(l,p,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(r,l,p,y){this._forEachCell(l-y,p-y,l+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(y)}_insertBoxCell(r,l,p,y,b,S){this.boxCells[b].push(S)}_insertCircleCell(r,l,p,y,b,S){this.circleCells[b].push(S)}_query(r,l,p,y,b,S){if(p<0||r>this.width||y<0||l>this.height)return!b&&[];const L=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=y){if(b)return!0;for(let N=0;N<this.boxKeys.length;N++)L.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const F=this.circles[3*N],B=this.circles[3*N+1],H=this.circles[3*N+2];L.push({key:this.circleKeys[N],x1:F-H,y1:B-H,x2:F+H,y2:B+H})}return S?L.filter(S):L}return this._forEachCell(r,l,p,y,this._queryCell,L,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?L.length>0:L}_queryCircle(r,l,p,y,b){const S=r-p,L=r+p,N=l-p,F=l+p;if(L<0||S>this.width||F<0||N>this.height)return!y&&[];const B=[];return this._forEachCell(S,N,L,F,this._queryCellCircle,B,{hitTest:y,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},b),y?B.length>0:B}query(r,l,p,y,b){return this._query(r,l,p,y,!1,b)}hitTest(r,l,p,y,b){return this._query(r,l,p,y,!0,b)}hitTestCircle(r,l,p,y){return this._queryCircle(r,l,p,!0,y)}_queryCell(r,l,p,y,b,S,L,N){const F=L.seenUids,B=this.boxCells[b];if(B!==null){const W=this.bboxes;for(const ee of B)if(!F.box[ee]){F.box[ee]=!0;const ce=4*ee;if(r<=W[ce+2]&&l<=W[ce+3]&&p>=W[ce+0]&&y>=W[ce+1]&&(!N||N(this.boxKeys[ee]))){if(L.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[ee],x1:W[ce],y1:W[ce+1],x2:W[ce+2],y2:W[ce+3]})}}}const H=this.circleCells[b];if(H!==null){const W=this.circles;for(const ee of H)if(!F.circle[ee]){F.circle[ee]=!0;const ce=3*ee;if(this._circleAndRectCollide(W[ce],W[ce+1],W[ce+2],r,l,p,y)&&(!N||N(this.circleKeys[ee]))){if(L.hitTest)return S.push(!0),!0;{const oe=W[ce],fe=W[ce+1],pe=W[ce+2];S.push({key:this.circleKeys[ee],x1:oe-pe,y1:fe-pe,x2:oe+pe,y2:fe+pe})}}}}}_queryCellCircle(r,l,p,y,b,S,L,N){const F=L.circle,B=L.seenUids,H=this.boxCells[b];if(H!==null){const ee=this.bboxes;for(const ce of H)if(!B.box[ce]){B.box[ce]=!0;const oe=4*ce;if(this._circleAndRectCollide(F.x,F.y,F.radius,ee[oe+0],ee[oe+1],ee[oe+2],ee[oe+3])&&(!N||N(this.boxKeys[ce])))return S.push(!0),!0}}const W=this.circleCells[b];if(W!==null){const ee=this.circles;for(const ce of W)if(!B.circle[ce]){B.circle[ce]=!0;const oe=3*ce;if(this._circlesCollide(ee[oe],ee[oe+1],ee[oe+2],F.x,F.y,F.radius)&&(!N||N(this.circleKeys[ce])))return S.push(!0),!0}}}_forEachCell(r,l,p,y,b,S,L,N){const F=this._convertToXCellCoord(r),B=this._convertToYCellCoord(l),H=this._convertToXCellCoord(p),W=this._convertToYCellCoord(y);for(let ee=F;ee<=H;ee++)for(let ce=B;ce<=W;ce++)if(b.call(this,r,l,p,y,this.xCellCount*ce+ee,S,L,N))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,y,b,S){const L=y-r,N=b-l,F=p+S;return F*F>L*L+N*N}_circleAndRectCollide(r,l,p,y,b,S,L){const N=(S-y)/2,F=Math.abs(r-(y+N));if(F>N+p)return!1;const B=(L-b)/2,H=Math.abs(l-(b+B));if(H>B+p)return!1;if(F<=N||H<=B)return!0;const W=F-N,ee=H-B;return W*W+ee*ee<=p*p}}const Zo={unknown:0,flipRequired:1,flipNotRequired:2},ja=Math.tan(85*Math.PI/180);function yl(m,r,l,p,y,b,S){const L=i.ad.mat4.create();if(l)if(b.name==="globe"){const N=i.bo(y,r);i.ad.mat4.multiply(L,L,N)}else{const N=i.ad.mat2.invert([],S);L[0]=N[0],L[1]=N[1],L[4]=N[2],L[5]=N[3],p||i.ad.mat4.rotateZ(L,L,y.angle)}else i.ad.mat4.multiply(L,y.labelPlaneMatrix,m);return L}function hs(m,r,l,p,y,b,S){const L=yl(m,r,l,p,y,b,S);return b.name==="globe"&&l||(L[2]=L[6]=L[10]=L[14]=0),L}function Ui(m,r,l,p,y,b,S){if(l){if(b.name==="globe"){const L=yl(m,r,l,p,y,b,S);return i.ad.mat4.invert(L,L),i.ad.mat4.multiply(L,m,L),L}{const L=i.ad.mat4.clone(m),N=i.ad.mat4.identity([]);return N[0]=S[0],N[1]=S[1],N[4]=S[2],N[5]=S[3],i.ad.mat4.multiply(L,L,N),p||i.ad.mat4.rotateZ(L,L,-y.angle),L}}return y.glCoordMatrix}function Fo(m,r,l,p){const y=[m,r,l,1];l?i.ad.vec4.transformMat4(y,y,p):Zi(y,y,p);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function xc(m,r){return Math.min(.5+m/r*.5,1.5)}function xh(m,r){const l=m[0]/m[3],p=m[1]/m[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function bc(m,r,l,p,y,b,S,L,N,F){const B=l.transform,H=p?m.textSizeData:m.iconSizeData,W=i.bp(H,l.transform.zoom),ee=B.projection.name==="globe",ce=[256/l.width*2+1,256/l.height*2+1],oe=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;oe.clear();let fe=null;ee&&(fe=p?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const pe=m.lineVertexArray,Te=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,De=l.transform.width/l.transform.height;let Ie,Ge=!1;for(let Be=0;Be<Te.length;Be++){const je=Te.get(Be),{numGlyphs:Ue,writingMode:Ke}=je;if(Ke!==i.bq.vertical||Ge||Ie===i.bq.horizontal||(Ge=!0),Ie=Ke,(je.hidden||Ke===i.bq.vertical)&&!Ge){Xo(Ue,oe);continue}Ge=!1;const nt=new i.P(je.tileAnchorX,je.tileAnchorY);let{x:kt,y:xt,z:Zt}=B.projection.projectTilePoint(nt.x,nt.y,F.canonical);if(N){const[_n,xn,Dn]=N(nt);kt+=_n,xt+=xn,Zt+=Dn}const Kt=[kt,xt,Zt,1];if(i.ad.vec4.transformMat4(Kt,Kt,r),!xh(Kt,ce)){Xo(Ue,oe);continue}const ln=Kt[3],vt=xc(l.transform.getCameraToCenterDistance(B.projection),ln),Ht=i.br(H,W,je),mt=S?Ht/vt:Ht*vt,Gt=Fo(kt,xt,Zt,y);if(Gt[3]<=0){Xo(Ue,oe);continue}let Bt={};const Xt=i.ak(m.layers[0].layout.get("text-max-angle")),Rt=Math.cos(Xt),Qt=S?null:N,gn=ls(je,mt,!1,L,r,y,b,m.glyphOffsetArray,pe,oe,fe,Gt,nt,Bt,De,Qt,B.projection,F,S,Rt);Ge=gn.useVertical,Qt&&gn.needsFlipping&&(Bt={}),(gn.notEnoughRoom||Ge||gn.needsFlipping&&ls(je,mt,!0,L,r,y,b,m.glyphOffsetArray,pe,oe,fe,Gt,nt,Bt,De,Qt,B.projection,F,S,Rt).notEnoughRoom)&&Xo(Ue,oe)}p?(m.text.dynamicLayoutVertexBuffer.updateData(oe),fe&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(fe)):(m.icon.dynamicLayoutVertexBuffer.updateData(oe),fe&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(fe))}function Lu(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe){const{lineStartIndex:pe,glyphStartIndex:Te,segment:De}=L,Ie=Te+L.numGlyphs,Ge=pe+L.lineLength,Be=r.getoffsetX(Te),je=r.getoffsetX(Ie-1),Ue=Ko(m*Be,l,p,y,b,S,De,pe,Ge,N,F,B,H,W,!0,ee,ce,oe,fe);if(!Ue)return null;const Ke=Ko(m*je,l,p,y,b,S,De,pe,Ge,N,F,B,H,W,!0,ee,ce,oe,fe);return Ke?{first:Ue,last:Ke}:null}function ha(m,r,l,p){return m===i.bq.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:m===i.bq.vertical?p>0?{needsFlipping:!0}:null:r!==Zo.unknown&&function(y,b){return y===0||Math.abs(b/y)>ja}(l,p)?r===Zo.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function ls(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe,pe,Te,De){const Ie=r/24,Ge=m.lineOffsetX*Ie,Be=m.lineOffsetY*Ie,{lineStartIndex:je,glyphStartIndex:Ue,numGlyphs:Ke,segment:nt,writingMode:kt,flipState:xt}=m,Zt=je+m.lineLength,Kt=ln=>{if(B){const[Gt,Bt,Xt]=ln.up,Rt=F.length;i.bs(B,Rt+0,Gt,Bt,Xt),i.bs(B,Rt+1,Gt,Bt,Xt),i.bs(B,Rt+2,Gt,Bt,Xt),i.bs(B,Rt+3,Gt,Bt,Xt)}const[vt,Ht,mt]=ln.point;i.bt(F,vt,Ht,mt,ln.angle)};if(Ke>1){const ln=Lu(Ie,L,Ge,Be,l,H,W,m,N,b,ee,oe,!1,fe,pe,Te,De);if(!ln)return{notEnoughRoom:!0};if(p&&!l){let[vt,Ht,mt]=ln.first.point,[Gt,Bt,Xt]=ln.last.point;[vt,Ht]=Fo(vt,Ht,mt,S),[Gt,Bt]=Fo(Gt,Bt,Xt,S);const Rt=ha(kt,xt,(Gt-vt)*ce,Bt-Ht);if(m.flipState=Rt&&Rt.needsFlipping?Zo.flipRequired:Zo.flipNotRequired,Rt)return Rt}Kt(ln.first);for(let vt=Ue+1;vt<Ue+Ke-1;vt++){const Ht=Ko(Ie*L.getoffsetX(vt),Ge,Be,l,H,W,nt,je,Zt,N,b,ee,oe,!1,!1,fe,pe,Te,De);if(!Ht)return F.length-=4*(vt-Ue),{notEnoughRoom:!0};Kt(Ht)}Kt(ln.last)}else{if(p&&!l){const vt=Fo(W.x,W.y,0,y),Ht=je+nt+1,mt=new i.P(N.getx(Ht),N.gety(Ht)),Gt=Fo(mt.x,mt.y,0,y),Bt=Gt[3]>0?Gt:ds(W,mt,vt,1,y,void 0,fe,pe.canonical),Xt=ha(kt,xt,(Bt[0]-vt[0])*ce,Bt[1]-vt[1]);if(m.flipState=Xt&&Xt.needsFlipping?Zo.flipRequired:Zo.flipNotRequired,Xt)return Xt}const ln=Ko(Ie*L.getoffsetX(Ue),Ge,Be,l,H,W,nt,je,Zt,N,b,ee,oe,!1,!1,fe,pe,Te,De);if(!ln)return{notEnoughRoom:!0};Kt(ln)}return{}}function Ua(m,r,l,p,y){const{x:b,y:S,z:L}=p.projectTilePoint(m.x,m.y,r);if(!y)return Fo(b,S,L,l);const[N,F,B]=y(m);return Fo(b+N,S+F,L+B,l)}function ds(m,r,l,p,y,b,S,L){const N=Ua(m.sub(r)._unit()._add(m),L,y,S,b);return i.ad.vec3.sub(N,l,N),i.ad.vec3.normalize(N,N),i.ad.vec3.scaleAndAdd(N,l,N,p)}function Ko(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe,pe,Te){const De=p?m-r:m+r;let Ie=De>0?1:-1,Ge=0;p&&(Ie*=-1,Ge=Math.PI),Ie<0&&(Ge+=Math.PI);let Be=L+S+(Ie>0?0:1)|0,je=y,Ue=y,Ke=0,nt=0;const kt=Math.abs(De),xt=[],Zt=[];let Kt=b,ln=Kt,vt=i.ad.vec3.zero([]);const Ht=()=>ds(ln,Kt,Ue,kt-Ke+1,B,W,oe,fe.canonical);for(;Ke+nt<=kt;){if(Be+=Ie,Be<L||Be>=N)return null;if(Ue=je,ln=Kt,xt.push(Ue),ee&&Zt.push(ln),Kt=new i.P(F.getx(Be),F.gety(Be)),je=H[Be],!je){const Dn=Ua(Kt,fe.canonical,B,oe,W);je=Dn[3]>0?H[Be]=Dn:Ht()}Ke+=nt;const _n=i.ad.vec3.sub([],je,Ue),xn=i.ad.vec3.distance(Ue,je);if(l&&xn>0&&nt>0&&i.ad.vec3.dot(vt,_n)/(nt*xn)<Te)return null;nt=xn,vt=_n}ce&&W&&(H[Be]&&(je=Ht(),nt=i.ad.vec3.distance(Ue,je),vt=i.ad.vec3.sub([],je,Ue)),H[Be]=je);const mt=(kt-Ke)/nt,Gt=Kt.sub(ln)._mult(mt)._add(ln),Bt=i.ad.vec3.scaleAndAdd([],Ue,vt,mt);let Xt=[0,0,1],Rt=vt[0],Qt=vt[1];if(pe&&(Xt=oe.upVector(fe.canonical,Gt.x,Gt.y),Xt[0]!==0||Xt[1]!==0||Xt[2]!==1)){const _n=[Xt[2],0,-Xt[0]],xn=i.ad.vec3.cross([],Xt,_n);i.ad.vec3.normalize(_n,_n),i.ad.vec3.normalize(xn,xn),Rt=i.ad.vec3.dot(vt,_n),Qt=i.ad.vec3.dot(vt,xn)}if(l){const _n=i.ad.vec3.cross([],Xt,vt);i.ad.vec3.normalize(_n,_n),i.ad.vec3.scaleAndAdd(Bt,Bt,_n,l*Ie)}const gn=Ge+Math.atan2(Qt,Rt);return xt.push(Bt),ee&&Zt.push(Gt),{point:Bt,angle:gn,path:xt,tilePath:Zt,up:Xt}}function Xo(m,r){const l=r.length,p=l+4*m;r.resize(p),r.float32.fill(-1/0,4*l,4*p)}function Zi(m,r,l){const p=r[0],y=r[1];return m[0]=l[0]*p+l[4]*y+l[12],m[1]=l[1]*p+l[5]*y+l[13],m[3]=l[3]*p+l[7]*y+l[15],m}const As=100;class da{constructor(r,l,p=new Pr(r.width+200,r.height+200,25),y=new Pr(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+As,this.screenBottomBoundary=r.height+As,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,y,b,S,L,N){let F=p.projectedAnchorX,B=p.projectedAnchorY,H=p.projectedAnchorZ;const W=p.elevation,ee=p.tileID,ce=r.getProjection();if(W&&ee){const[Be,je,Ue]=ce.upVector(ee.canonical,p.tileAnchorX,p.tileAnchorY),Ke=ce.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=Be*W*Ke,B+=je*W*Ke,H+=Ue*W*Ke}const oe=this.projectAndGetPerspectiveRatio(L,F,B,H,p.tileID,ce.name==="globe"||!!W||this.transform.pitch>0,ce),fe=S*oe.perspectiveRatio,pe=(p.x1*l+y.x-p.padding)*fe+oe.point.x,Te=(p.y1*l+y.y-p.padding)*fe+oe.point.y,De=(p.x2*l+y.x+p.padding)*fe+oe.point.x,Ie=(p.y2*l+y.y+p.padding)*fe+oe.point.y,Ge=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(pe,Te,De,Ie)||!b&&this.grid.hitTest(pe,Te,De,Ie,N)||Ge?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[pe,Te,De,Ie],offscreen:this.isOffscreen(pe,Te,De,Ie),occluded:!1}}placeCollisionCircles(r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe){const fe=[],pe=this.transform.elevation,Te=r.getProjection(),De=pe?pe.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,Te):null,Ie=new i.P(p.tileAnchorX,p.tileAnchorY);let{x:Ge,y:Be,z:je}=Te.projectTilePoint(Ie.x,Ie.y,oe.canonical);if(De){const[Xt,Rt,Qt]=De(Ie);Ge+=Xt,Be+=Rt,je+=Qt}const Ue=Te.name==="globe",Ke=this.projectAndGetPerspectiveRatio(L,Ge,Be,je,oe,Ue||!!pe||this.transform.pitch>0,Te),{perspectiveRatio:nt}=Ke,kt=(H?S/nt:S*nt)/i.bw,xt=Fo(Ge,Be,je,N),Zt=p.lineOffsetX*kt,Kt=p.lineOffsetY*kt,ln=i.ak(r.layers[0].layout.get("text-max-angle")),vt=Math.cos(ln),Ht=Ke.signedDistanceFromCamera>0?Lu(kt,b,Zt,Kt,!1,xt,Ie,p,y,N,{},pe&&!H?De:null,H&&!!pe,Te,oe,H,vt):null;let mt=!1,Gt=!1,Bt=!0;if(Ht&&!Ke.occluded){const Xt=.5*ee*nt+ce,Rt=new i.P(-100,-100),Qt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),gn=new Qc,{first:_n,last:xn}=Ht,Dn=_n.path.length;let ar=[];for(let Yn=Dn-1;Yn>=1;Yn--)ar.push(_n.path[Yn]);for(let Yn=1;Yn<xn.path.length;Yn++)ar.push(xn.path[Yn]);const Vn=2.5*Xt;F&&(ar=ar.map(([Yn,Cr,ri],Mi)=>(De&&!Ue&&(ri=De(Mi<Dn-1?_n.tilePath[Dn-1-Mi]:xn.tilePath[Mi-Dn+2])[2]),Fo(Yn,Cr,ri,F))),ar.some(Yn=>Yn[3]<=0)&&(ar=[]));let ir=[];if(ar.length>0){let Yn=1/0,Cr=-1/0,ri=1/0,Mi=-1/0;for(const xr of ar)Yn=Math.min(Yn,xr[0]),ri=Math.min(ri,xr[1]),Cr=Math.max(Cr,xr[0]),Mi=Math.max(Mi,xr[1]);Cr>=Rt.x&&Yn<=Qt.x&&Mi>=Rt.y&&ri<=Qt.y&&(ir=[ar.map(xr=>new i.P(xr[0],xr[1]))],(Yn<Rt.x||Cr>Qt.x||ri<Rt.y||Mi>Qt.y)&&(ir=i.bu(ir,Rt.x,Rt.y,Qt.x,Qt.y)))}for(const Yn of ir){gn.reset(Yn,.25*Xt);let Cr=0;Cr=gn.length<=.5*Xt?1:Math.ceil(gn.paddedLength/Vn)+1;for(let ri=0;ri<Cr;ri++){const Mi=ri/Math.max(Cr-1,1),xr=gn.lerp(Mi),$i=xr.x+As,cr=xr.y+As;fe.push($i,cr,Xt,0);const Nn=$i-Xt,Lr=cr-Xt,ai=$i+Xt,Yr=cr+Xt;if(Bt=Bt&&this.isOffscreen(Nn,Lr,ai,Yr),Gt=Gt||this.isInsideGrid(Nn,Lr,ai,Yr),!l&&this.grid.hitTestCircle($i,cr,Xt,W)&&(mt=!0,!B))return{circles:[],offscreen:!1,collisionDetected:mt,occluded:!1}}}}return{circles:!B&&mt||!Gt?[]:fe,offscreen:Bt,collisionDetected:mt,occluded:Ke.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,y=1/0,b=-1/0,S=-1/0;for(const B of r){const H=new i.P(B.x+As,B.y+As);p=Math.min(p,H.x),y=Math.min(y,H.y),b=Math.max(b,H.x),S=Math.max(S,H.y),l.push(H)}const L=this.grid.query(p,y,b,S).concat(this.ignoredGrid.query(p,y,b,S)),N={},F={};for(const B of L){const H=B.key;if(N[H.bucketInstanceId]===void 0&&(N[H.bucketInstanceId]={}),N[H.bucketInstanceId][H.featureIndex])continue;const W=[new i.P(B.x1,B.y1),new i.P(B.x2,B.y1),new i.P(B.x2,B.y2),new i.P(B.x1,B.y2)];i.bv(l,W)&&(N[H.bucketInstanceId][H.featureIndex]=!0,F[H.bucketInstanceId]===void 0&&(F[H.bucketInstanceId]=[]),F[H.bucketInstanceId].push(H.featureIndex))}return F}insertCollisionBox(r,l,p,y,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:b},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,y,b){const S=l?this.ignoredGrid:this.grid,L={bucketInstanceId:p,featureIndex:y,collisionGroupID:b};for(let N=0;N<r.length;N+=4)S.insertCircle(L,r[N],r[N+1],r[N+2])}projectAndGetPerspectiveRatio(r,l,p,y,b,S,L){const N=[l,p,y,1];let F=!1;y||this.transform.pitch>0?(i.ad.vec4.transformMat4(N,N,r),this.fogState&&b&&L.name!=="globe"&&(F=function(W,ee,ce,oe,fe,pe){const Te=pe.calculateFogTileMatrix(fe),De=[ee,ce,oe];return i.ad.vec3.transformMat4(De,De,Te),yn(W,i.ad.vec3.length(De),pe.pitch,pe._fov)}(this.fogState,l,p,y,b.toUnwrapped(),this.transform)>.9)):Zi(N,N,r);const B=N[3];return{point:new i.P((N[0]/B+1)/2*this.transform.width+As,(-N[1]/B+1)/2*this.transform.height+As),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(L)/B*.5,1.5),signedDistanceFromCamera:B,occluded:S&&N[2]>B||F}}isOffscreen(r,l,p,y){return p<As||r>=this.screenRightBoundary||y<As||l>this.screenBottomBoundary}isInsideGrid(r,l,p,y){return p>=0&&r<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=i.ad.mat4.identity([]);return i.ad.mat4.translate(r,r,[-100,-100,0]),r}}function Ji(m,r,l){const p=r.createTileMatrix(m,m.worldSize,l.toUnwrapped());return i.ad.mat4.multiply(new Float32Array(16),m.projMatrix,p)}function ku(m,r,l){if(r.projection.name===l.projection.name)return m.projMatrix;const p=l.clone();return p.setProjection(r.projection),Ji(p,r.getProjection(),m)}function To(m,r,l){return r.name===l.projection.name?m.projMatrix:Ji(l,r,m)}class wc{constructor(r,l,p,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Aa{constructor(r,l,p,y,b,S=!1){this.text=new wc(r?r.text:null,l,p,b),this.icon=new wc(r?r.icon:null,l,y,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ea{constructor(r,l,p,y=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=y}}class pd{constructor(){this.invProjMatrix=i.ad.mat4.create(),this.viewportMatrix=i.ad.mat4.create(),this.circles=[]}}class Va{constructor(r,l,p,y,b){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=b}}class Hp{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function Sc(m,r,l,p,y){const{horizontalAlign:b,verticalAlign:S}=i.bD(m),L=-(b-.5)*r,N=-(S-.5)*l,F=i.bC(m,p);return new i.P(L+F[0]*y,N+F[1]*y)}function Es(m,r,l,p,y){const b=new i.P(m,r);return l&&b._rotate(p?y:-y),b}class md{constructor(r,l,p,y,b,S){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new da(this.transform,b),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Hp(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,y,b=1){const S=p.getBucket(l),L=p.latestFeatureIndex;if(!S||!L||l.fqid!==S.layerIds[0])return;const N=S.layers[0].layout,F=S.layers[0].paint,B=p.collisionBoxArray,H=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),W=p.tileSize/i.ai,ee=p.tileID.toUnwrapped();this.transform.setProjection(S.projection);const ce=(oe=p.tileID,fe=S.getProjection(),pe=this.transform,fe.name===this.projection?pe.calculateProjMatrix(oe.toUnwrapped()):Ji(pe,fe,oe));var oe,fe,pe;const Te=N.get("text-pitch-alignment")==="map",De=N.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const Ie=l.dynamicFilter(),Ge=l.dynamicFilterNeedsFeature(),Be=this.transform.calculatePixelsToTileUnitsMatrix(p),je=hs(ce,p.tileID.canonical,Te,De,this.transform,S.getProjection(),Be);let Ue=null;if(Te){const Ht=Ui(ce,p.tileID.canonical,Te,De,this.transform,S.getProjection(),Be);Ue=i.ad.mat4.multiply([],this.transform.labelPlaneMatrix,Ht)}let Ke=null;Ie&&p.latestFeatureIndex&&(Ke={unwrappedTileID:ee,dynamicFilter:Ie,dynamicFilterNeedsFeature:Ge}),this.retainedQueryData[S.bucketInstanceId]=new Va(S.bucketInstanceId,L,S.sourceLayerIndex,S.index,p.tileID);const[nt,kt]=S.layers[0].layout.get("text-size-scale-range"),xt=i.ay(b,nt,kt),[Zt,Kt]=N.get("icon-size-scale-range"),ln=i.ay(b,Zt,Kt),vt={bucket:S,layout:N,paint:F,posMatrix:ce,textLabelPlaneMatrix:je,labelToScreenMatrix:Ue,clippingData:Ke,scale:H,textPixelRatio:W,holdingForFade:p.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:i.bp(S.textSizeData,this.transform.zoom,xt),partiallyEvaluatedIconSize:i.bp(S.iconSizeData,this.transform.zoom,ln),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(const Ht of S.sortKeyRanges){const{sortKey:mt,symbolInstanceStart:Gt,symbolInstanceEnd:Bt}=Ht;r.push({sortKey:mt,symbolInstanceStart:Gt,symbolInstanceEnd:Bt,parameters:vt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:vt})}attemptAnchorPlacement(r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe,pe,Te){const{textOffset0:De,textOffset1:Ie,crossTileID:Ge}=W,Be=[De,Ie],je=Sc(r,p,y,Be,b),Ue=this.collisionIndex.placeCollisionBox(ce,b,l,Es(je.x,je.y,S,L,this.transform.angle),H,N,F,B.predicate);if(fe){const Ke=ce.getSymbolInstanceIconSize(Te,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ce,Ke,fe,Es(je.x,je.y,S,L,this.transform.angle),H,N,F,B.predicate).box.length===0)return}if(Ue.box.length>0){let Ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ge]&&this.prevPlacement.placements[Ge]&&this.prevPlacement.placements[Ge].text&&(Ke=this.prevPlacement.variableOffsets[Ge].anchor),this.variableOffsets[Ge]={textOffset:Be,width:p,height:y,anchor:r,textScale:b,prevAnchor:Ke},this.markUsedJustification(ce,r,W,oe),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,oe,W),this.placedOrientations[Ge]=oe),{shift:je,placedGlyphBoxes:Ue}}}placeLayerBucketPart(r,l,p,y,b=1){const{bucket:S,layout:L,paint:N,posMatrix:F,textLabelPlaneMatrix:B,labelToScreenMatrix:H,clippingData:W,textPixelRatio:ee,holdingForFade:ce,collisionBoxArray:oe,partiallyEvaluatedTextSize:fe,partiallyEvaluatedIconSize:pe,collisionGroup:Te,latestFeatureIndex:De}=r.parameters,Ie=L.get("text-optional"),Ge=L.get("icon-optional"),Be=L.get("text-allow-overlap"),je=L.get("icon-allow-overlap"),Ue=L.get("text-rotation-alignment")==="map",Ke=L.get("text-pitch-alignment")==="map",nt=N.get("symbol-z-offset"),kt=L.get("symbol-elevation-reference")==="sea",[xt,Zt]=L.get("text-size-scale-range"),[Kt,ln]=L.get("icon-size-scale-range"),vt=i.ay(b,xt,Zt),Ht=i.ay(b,Kt,ln);this.transform.setProjection(S.projection);let mt=Be&&(je||!S.hasIconData()||Ge),Gt=je&&(Be||!S.hasTextData()||Ie);const Bt=!nt.isConstant();!S.collisionArrays&&oe&&S.deserializeCollisionBoxes(oe),p&&y&&S.updateCollisionDebugBuffers(this.transform.zoom,oe,vt,Ht);const Xt=(Rt,Qt,gn)=>{const{crossTileID:_n,numVerticalGlyphVertices:xn}=Rt;let Dn=null;if(W&&W.dynamicFilterNeedsFeature||Bt){const Wr=this.retainedQueryData[S.bucketInstanceId];Dn=De.loadFeature({featureIndex:Rt.featureIndex,bucketIndex:Wr.bucketIndex,sourceLayerIndex:Wr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(W&&!(0,W.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Dn,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new i.P(Rt.tileAnchorX,Rt.tileAnchorY),this.transform.calculateDistanceTileData(W.unwrappedTileID)))return this.placements[_n]=new Ea(!1,!1,!1,!0),void l.add(_n);const ar=nt.evaluate(Dn,{});if(l.has(_n))return;if(ce)return void(this.placements[_n]=new Ea(!1,!1,!1));let Vn=!1,ir=!1,Yn=!0,Cr=!1,ri=!1,Mi=null,xr={box:null,offscreen:null,occluded:null},$i={box:null,offscreen:null,occluded:null},cr=null,Nn=null,Lr=null,ai=0,Yr=0,rs=0;gn.textFeatureIndex?ai=gn.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(ai=Rt.featureIndex),gn.verticalTextFeatureIndex&&(Yr=gn.verticalTextFeatureIndex);const Ms=Wr=>{Wr.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Gi=this.transform.elevation;Wr.elevation=kt?ar:ar+(Gi?Gi.getAtTileOffset(Wr.tileID,Wr.tileAnchorX,Wr.tileAnchorY):0),Wr.elevation+=Rt.zOffset},Js=gn.textBox;if(Js){Ms(Js);const Wr=ii=>{let xi=i.bq.horizontal;if(S.allowVerticalPlacement&&!ii&&this.prevPlacement){const Mo=this.prevPlacement.placedOrientations[_n];Mo&&(this.placedOrientations[_n]=Mo,xi=Mo,this.markUsedOrientation(S,xi,Rt))}return xi},Gi=(ii,xi)=>{if(S.allowVerticalPlacement&&xn>0&&gn.verticalTextBox){for(const Mo of S.writingModes)if(Mo===i.bq.vertical?(xr=xi(),$i=xr):xr=ii(),xr&&xr.box&&xr.box.length)break}else xr=ii()};if(L.get("text-variable-anchor")){let ii=L.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_n]){const zi=this.prevPlacement.variableOffsets[_n];ii.indexOf(zi.anchor)>0&&(ii=ii.filter(Qs=>Qs!==zi.anchor),ii.unshift(zi.anchor))}const xi=(zi,Qs,uu)=>{const el=S.getSymbolInstanceTextSize(fe,Rt,this.transform.zoom,Qt),oc=(zi.x2-zi.x1)*el+2*zi.padding,Ra=(zi.y2-zi.y1)*el+2*zi.padding,ac=Rt.hasIconTextFit&&!je?Qs:null;ac&&Ms(ac);let tl={box:[],offscreen:!1,occluded:!1};const $u=Be?2*ii.length:ii.length;for(let hu=0;hu<$u;++hu){const Gu=this.attemptAnchorPlacement(ii[hu%ii.length],zi,oc,Ra,el,Ue,Ke,ee,F,Te,hu>=ii.length,Rt,Qt,S,uu,ac,fe,pe);if(Gu&&(tl=Gu.placedGlyphBoxes,tl&&tl.box&&tl.box.length)){Vn=!0,Mi=Gu.shift;break}}return tl};Gi(()=>xi(Js,gn.iconBox,i.bq.horizontal),()=>{const zi=gn.verticalTextBox;return zi&&Ms(zi),S.allowVerticalPlacement&&!(xr&&xr.box&&xr.box.length)&&xn>0&&zi?xi(zi,gn.verticalIconBox,i.bq.vertical):{box:null,offscreen:null,occluded:null}}),xr&&(Vn=xr.box,Yn=xr.offscreen,Cr=xr.occluded);const Mo=Wr(!(!xr||!xr.box));if(!Vn&&this.prevPlacement){const zi=this.prevPlacement.variableOffsets[_n];zi&&(this.variableOffsets[_n]=zi,this.markUsedJustification(S,zi.anchor,Rt,Mo))}}else{const ii=(xi,Mo)=>{const zi=S.getSymbolInstanceTextSize(fe,Rt,this.transform.zoom,Qt,b),Qs=this.collisionIndex.placeCollisionBox(S,zi,xi,new i.P(0,0),Be,ee,F,Te.predicate);return Qs&&Qs.box&&Qs.box.length&&(this.markUsedOrientation(S,Mo,Rt),this.placedOrientations[_n]=Mo),Qs};Gi(()=>ii(Js,i.bq.horizontal),()=>{const xi=gn.verticalTextBox;return S.allowVerticalPlacement&&xn>0&&xi?(Ms(xi),ii(xi,i.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Wr(!!(xr&&xr.box&&xr.box.length))}}if(cr=xr,Vn=cr&&cr.box&&cr.box.length>0,Yn=cr&&cr.offscreen,Cr=cr&&cr.occluded,Rt.useRuntimeCollisionCircles){const Wr=S.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex>=0?Rt.centerJustifiedTextSymbolIndex:Rt.verticalPlacedTextSymbolIndex),Gi=i.br(S.textSizeData,fe,Wr),ii=L.get("text-padding");Nn=this.collisionIndex.placeCollisionCircles(S,Be,Wr,S.lineVertexArray,S.glyphOffsetArray,Gi,F,B,H,p,Ke,Te.predicate,Rt.collisionCircleDiameter*Gi/i.bw,ii,this.retainedQueryData[S.bucketInstanceId].tileID),Vn=Be||Nn.circles.length>0&&!Nn.collisionDetected,Yn=Yn&&Nn.offscreen,Cr=Nn.occluded}if(gn.iconFeatureIndex&&(rs=gn.iconFeatureIndex),gn.iconBox){const Wr=Gi=>{Ms(Gi);const ii=Rt.hasIconTextFit&&Mi?Es(Mi.x,Mi.y,Ue,Ke,this.transform.angle):new i.P(0,0),xi=S.getSymbolInstanceIconSize(pe,this.transform.zoom,Rt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,xi,Gi,ii,je,ee,F,Te.predicate)};$i&&$i.box&&$i.box.length&&gn.verticalIconBox?(Lr=Wr(gn.verticalIconBox),ir=Lr.box.length>0):(Lr=Wr(gn.iconBox),ir=Lr.box.length>0),Yn=Yn&&Lr.offscreen,ri=Lr.occluded}const so=Ie||Rt.numHorizontalGlyphVertices===0&&xn===0,Dl=Ge||Rt.numIconVertices===0;if(so||Dl?Dl?so||(ir=ir&&Vn):Vn=ir&&Vn:ir=Vn=ir&&Vn,Vn&&cr&&cr.box&&this.collisionIndex.insertCollisionBox(cr.box,L.get("text-ignore-placement"),S.bucketInstanceId,$i&&$i.box&&Yr?Yr:ai,Te.ID),ir&&Lr&&this.collisionIndex.insertCollisionBox(Lr.box,L.get("icon-ignore-placement"),S.bucketInstanceId,rs,Te.ID),Nn&&(Vn&&this.collisionIndex.insertCollisionCircles(Nn.circles,L.get("text-ignore-placement"),S.bucketInstanceId,ai,Te.ID),p)){const Wr=S.bucketInstanceId;let Gi=this.collisionCircleArrays[Wr];Gi===void 0&&(Gi=this.collisionCircleArrays[Wr]=new pd);for(let ii=0;ii<Nn.circles.length;ii+=4)Gi.circles.push(Nn.circles[ii+0]),Gi.circles.push(Nn.circles[ii+1]),Gi.circles.push(Nn.circles[ii+2]),Gi.circles.push(Nn.collisionDetected?1:0)}const ia=S.projection.name!=="globe";mt=mt&&(ia||!Cr),Gt=Gt&&(ia||!ri),this.placements[_n]=new Ea(Vn||mt,ir||Gt,Yn||S.justReloaded),l.add(_n)};if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.elevationType==="road"&&S.updateRoadElevation(),S.updateZOffset(),S.sortFeaturesByY){const Rt=S.getSortedSymbolIndexes(this.transform.angle);for(let Qt=Rt.length-1;Qt>=0;--Qt){const gn=Rt[Qt];Xt(S.symbolInstances.get(gn),gn,S.collisionArrays[gn])}S.hasAnyZOffset&&i.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const Rt=S.getSortedIndexesByZOffset();for(let Qt=0;Qt<Rt.length;++Qt){const gn=Rt[Qt];Xt(S.symbolInstances.get(gn),gn,S.collisionArrays[gn])}}else for(let Rt=r.symbolInstanceStart;Rt<r.symbolInstanceEnd;Rt++)Xt(S.symbolInstances.get(Rt),Rt,S.collisionArrays[Rt]);if(p&&S.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[S.bucketInstanceId];i.ad.mat4.invert(Rt.invProjMatrix,F),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(r,l,p,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:N,crossTileID:F}=p,B=i.bB(l),H=y===i.bq.vertical?N:B==="left"?b:B==="center"?S:B==="right"?L:-1;b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=H>=0&&b!==H?0:F),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=H>=0&&S!==H?0:F),L>=0&&(r.text.placedSymbolArray.get(L).crossTileID=H>=0&&L!==H?0:F),N>=0&&(r.text.placedSymbolArray.get(N).crossTileID=H>=0&&N!==H?0:F)}markUsedOrientation(r,l,p){const y=l===i.bq.horizontal||l===i.bq.horizontalOnly?l:0,b=l===i.bq.vertical?l:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:F}=p,B=r.text.placedSymbolArray;S>=0&&(B.get(S).placedOrientation=y),L>=0&&(B.get(L).placedOrientation=y),N>=0&&(B.get(N).placedOrientation=y),F>=0&&(B.get(F).placedOrientation=b)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const y=l?l.symbolFadeChange(r):1,b=l?l.opacities:{},S=l?l.variableOffsets:{},L=l?l.placedOrientations:{};for(const N in this.placements){const F=this.placements[N],B=b[N];B?(this.opacities[N]=new Aa(B,y,F.text,F.icon,null,F.clipped),p=p||F.text!==B.text.placed||F.icon!==B.icon.placed):(this.opacities[N]=new Aa(null,y,F.text,F.icon,F.skipFade,F.clipped),p=p||F.text||F.icon)}for(const N in b){const F=b[N];if(!this.opacities[N]){const B=new Aa(F,y,!1,!1);B.isHidden()||(this.opacities[N]=B,p=p||F.text.placed||F.icon.placed)}}for(const N in S)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=S[N]);for(const N in L)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=L[N]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l,p,y){const b=new Set;for(const S of l){const L=S.getBucket(r);L&&S.latestFeatureIndex&&r.fqid===L.layerIds[0]&&(this.updateBucketOpacities(L,b,S,S.collisionBoxArray,p,y,S.tileID,r.scope),L.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(L,S.tileID),L.elevationType==="road"&&L.updateRoadElevation(),L.updateZOffset())}}updateBucketOpacities(r,l,p,y,b,S,L,N){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const F=r.layers[0].layout,B=r.layers[0].paint,H=!!r.layers[0].dynamicFilter(),W=new Aa(null,0,!1,!1,!0),ee=F.get("text-allow-overlap"),ce=F.get("icon-allow-overlap"),oe=F.get("text-variable-anchor"),fe=F.get("text-rotation-alignment")==="map",pe=F.get("text-pitch-alignment")==="map",Te=B.get("symbol-z-offset"),De=F.get("symbol-elevation-reference")==="sea",Ie=!Te.isConstant(),Ge=new Aa(null,0,ee&&(ce||!r.hasIconData()||F.get("icon-optional")),ce&&(ee||!r.hasTextData()||F.get("text-optional")),!0);!r.collisionArrays&&y&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(y);const Be=(Ue,Ke,nt)=>{for(let kt=0;kt<Ke/4;kt++)Ue.opacityVertexArray.emplaceBack(nt)};let je=0;S&&r.updateReplacement(L,S);for(let Ue=0;Ue<r.symbolInstances.length;Ue++){const Ke=r.symbolInstances.get(Ue),{numHorizontalGlyphVertices:nt,numVerticalGlyphVertices:kt,crossTileID:xt,numIconVertices:Zt,tileAnchorX:Kt,tileAnchorY:ln}=Ke;let vt=null;const Ht=this.retainedQueryData[r.bucketInstanceId];Ie&&Ke&&Ht&&(vt=p.latestFeatureIndex.loadFeature({featureIndex:Ke.featureIndex,bucketIndex:Ht.bucketIndex,sourceLayerIndex:Ht.sourceLayerIndex,layoutVertexArrayOffset:0}));const mt=Te.evaluate(vt,{}),Gt=l.has(xt);let Bt=this.opacities[xt];Gt?Bt=W:Bt||(Bt=Ge,this.opacities[xt]=Bt),l.add(xt);const Xt=nt>0||kt>0,Rt=Zt>0,Qt=this.placedOrientations[xt],gn=Qt===i.bq.vertical,_n=Qt===i.bq.horizontal||Qt===i.bq.horizontalOnly;!Xt&&!Rt||Bt.isHidden()||je++;let xn=!1;if((Xt||Rt)&&S)for(const Dn of r.activeReplacements){if(i.bx(Dn,b,i.by.Symbol,N)||Dn.min.x>Kt||Kt>Dn.max.x||Dn.min.y>ln||ln>Dn.max.y)continue;const ar=i.bz(Kt,ln,L.canonical,Dn.footprintTileId.canonical);if(xn=i.bA(ar,Dn.footprint),xn)break}if(Xt){const Dn=xn?Wn:Mn(Bt.text);Be(r.text,nt,gn?Wn:Dn),Be(r.text,kt,_n?Wn:Dn);const ar=Bt.text.isHidden(),{leftJustifiedTextSymbolIndex:Vn,centerJustifiedTextSymbolIndex:ir,rightJustifiedTextSymbolIndex:Yn,verticalPlacedTextSymbolIndex:Cr}=Ke,ri=r.text.placedSymbolArray,Mi=ar||gn?1:0;Vn>=0&&(ri.get(Vn).hidden=Mi),ir>=0&&(ri.get(ir).hidden=Mi),Yn>=0&&(ri.get(Yn).hidden=Mi),Cr>=0&&(ri.get(Cr).hidden=ar||_n?1:0);const xr=this.variableOffsets[xt];xr&&this.markUsedJustification(r,xr.anchor,Ke,Qt);const $i=this.placedOrientations[xt];$i&&(this.markUsedJustification(r,"left",Ke,$i),this.markUsedOrientation(r,$i,Ke))}if(Rt){const Dn=xn?Wn:Mn(Bt.icon),{placedIconSymbolIndex:ar,verticalPlacedIconSymbolIndex:Vn}=Ke,ir=r.icon.placedSymbolArray,Yn=Bt.icon.isHidden()?1:0;ar>=0&&(Be(r.icon,Zt,gn?Wn:Dn),ir.get(ar).hidden=Yn),Vn>=0&&(Be(r.icon,Ke.numVerticalIconVertices,_n?Wn:Dn),ir.get(Vn).hidden=Yn)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Dn=r.collisionArrays[Ue];if(Dn){let ar=new i.P(0,0),Vn=!0;if(Dn.textBox||Dn.verticalTextBox){if(oe){const Yn=this.variableOffsets[xt];Yn?(ar=Sc(Yn.anchor,Yn.width,Yn.height,Yn.textOffset,Yn.textScale),fe&&ar._rotate(pe?this.transform.angle:-this.transform.angle)):Vn=!1}H&&(Vn=!Bt.clipped),Dn.textBox&&fa(r.textCollisionBox.collisionVertexArray,Bt.text.placed,!Vn||gn,mt,De,ar.x,ar.y),Dn.verticalTextBox&&fa(r.textCollisionBox.collisionVertexArray,Bt.text.placed,!Vn||_n,mt,De,ar.x,ar.y)}const ir=Vn&&!!(!_n&&Dn.verticalIconBox);Dn.iconBox&&fa(r.iconCollisionBox.collisionVertexArray,Bt.icon.placed,ir,mt,De,Ke.hasIconTextFit?ar.x:0,Ke.hasIconTextFit?ar.y:0),Dn.verticalIconBox&&fa(r.iconCollisionBox.collisionVertexArray,Bt.icon.placed,!ir,mt,De,Ke.hasIconTextFit?ar.x:0,Ke.hasIconTextFit?ar.y:0)}}}if(r.fullyClipped=je===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Ue.invProjMatrix,r.placementViewportMatrix=Ue.viewportMatrix,r.collisionCircleArray=Ue.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function fa(m,r,l,p,y,b,S){m.emplaceBack(r?1:0,l?1:0,b||0,S||0,p,y?1:0),m.emplaceBack(r?1:0,l?1:0,b||0,S||0,p,y?1:0),m.emplaceBack(r?1:0,l?1:0,b||0,S||0,p,y?1:0),m.emplaceBack(r?1:0,l?1:0,b||0,S||0,p,y?1:0)}const bh=Math.pow(2,25),K=Math.pow(2,24),Ee=Math.pow(2,17),pt=Math.pow(2,16),It=Math.pow(2,9),Yt=Math.pow(2,8),fn=Math.pow(2,1);function Mn(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const r=m.placed?1:0,l=Math.floor(127*m.opacity);return l*bh+r*K+l*Ee+r*pt+l*It+r*Yt+l*fn+r}const Wn=0;class vr{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,l,p,y,b,S){const L=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(L,y,r[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((N,F)=>N.sortKey-F.sortKey));this._currentPartIndex<L.length;){const N=L[this._currentPartIndex];if(l.placeLayerBucketPart(N,this._seenCrossTileIDs,p,N.symbolInstanceStart===0,S),this._currentPartIndex++,b())return!0}return!1}}class Mr{constructor(r,l,p,y,b,S,L,N,F){this.placement=new md(r,b,S,L,N,F),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p,y,b){const S=i.q.now(),L=()=>{const N=i.q.now()-S;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=l[r[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=F)&&(!N.maxzoom||N.maxzoom>F)){const B=N,H=B.layout.get("symbol-z-elevate"),W=B.layout.get("symbol-sort-key").constantOr(1)!==void 0,ee=B.layout.get("symbol-z-order"),ce=ee==="viewport-y"||ee==="auto"&&!(ee!=="viewport-y"&&W),oe=B.layout.get("text-allow-overlap")||B.layout.get("icon-allow-overlap")||B.layout.get("text-ignore-placement")||B.layout.get("icon-ignore-placement"),fe=ce&&oe,pe=this._inProgressLayer=this._inProgressLayer||new vr(B),Te=i.C(N.source,N.scope);if(pe.continuePlacement(H||fe?y[Te]:p[Te],this.placement,this._showCollisionBoxes,N,L,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Gr=512/i.ai/2;class Ci{constructor(r,l,p){this.tileID=r,this.bucketInstanceId=p,this.index=new i.bE(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=r.canonical.x*i.ai,b=r.canonical.y*i.ai;for(let S=0;S<l.length;S++){const{key:L,crossTileID:N,tileAnchorX:F,tileAnchorY:B}=l.get(S),H=Math.floor((y+F)*Gr),W=Math.floor((b+B)*Gr);this.index.add(H,W),this.keys.push(L),this.crossTileIDs.push(N)}this.index.finish()}findMatches(r,l,p){const y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),b=Gr/Math.pow(2,l.canonical.z-this.tileID.canonical.z),S=l.canonical.x*i.ai,L=l.canonical.y*i.ai;for(let N=0;N<r.length;N++){const F=r.get(N);if(F.crossTileID)continue;const{key:B,tileAnchorX:H,tileAnchorY:W}=F,ee=Math.floor((S+H)*b),ce=Math.floor((L+W)*b),oe=this.index.range(ee-y,ce-y,ee+y,ce+y);for(const fe of oe){const pe=this.crossTileIDs[fe];if(this.keys[fe]===B&&!p.has(pe)){p.add(pe),F.crossTileID=pe;break}}}}}class _s{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ys{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const p in this.indexes){const y=this.indexes[p],b={};for(const S in y){const L=y[S];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+l),b[L.tileID.key]=L}this.indexes[p]=b}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let b=0;b<l.symbolInstances.length;b++)l.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const y=this.usedCrossTileIDs[r.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>r.overscaledZ)for(const L in S){const N=S[L];N.tileID.isChildOf(r)&&N.findMatches(l.symbolInstances,r,y)}else{const L=S[r.scaledTo(Number(b)).key];L&&L.findMatches(l.symbolInstances,r,y)}}for(let b=0;b<l.symbolInstances.length;b++){const S=l.symbolInstances.get(b);S.crossTileID||(S.crossTileID=p.generate(),y.add(S.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Ci(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p of l.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const y=this.indexes[p];for(const b in y)r[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[b]),delete y[b],l=!0)}return l}}class Ws{constructor(){this.layerIndexes={},this.crossTileIDs=new _s,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,y){let b=this.layerIndexes[r.fqid];b===void 0&&(b=this.layerIndexes[r.fqid]=new ys);let S=!1;const L={};y.name!=="globe"&&b.handleWrapJump(p);for(const N of l){const F=N.getBucket(r);F&&r.fqid===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(N.tileID,F,this.crossTileIDs)&&(S=!0),L[F.bucketInstanceId]=!0)}return b.removeStaleBuckets(L)&&(S=!0),S}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const vs=771;class Jn{constructor(r,l,p,y){this.blendFunction=r,this.blendColor=l,this.mask=p,this.blendEquation=y}}Jn.Replace=[1,0,1,0],Jn.disabled=new Jn(Jn.Replace,i.al.transparent,[!1,!1,!1,!1]),Jn.unblended=new Jn(Jn.Replace,i.al.transparent,[!0,!0,!0,!0]),Jn.alphaBlended=new Jn([1,vs,1,vs],i.al.transparent,[!0,!0,!0,!0]),Jn.alphaBlendedNonPremultiplied=new Jn([770,vs,770,vs],i.al.transparent,[!0,!0,!0,!0]),Jn.multiply=new Jn([774,0,774,0],i.al.transparent,[!0,!0,!0,!0]);class Rn{constructor(r,l,p){this.func=r,this.mask=l,this.range=p}}Rn.ReadOnly=!1,Rn.ReadWrite=!0,Rn.disabled=new Rn(519,Rn.ReadOnly,[0,1]);const Bo=7680;class Hn{constructor(r,l,p,y,b,S){this.test=r,this.ref=l,this.mask=p,this.fail=y,this.depthFail=b,this.pass=S}}Hn.disabled=new Hn({func:519,mask:0},0,0,Bo,Bo,Bo);const qa=1029,Zl=2305;class Xn{constructor(r,l,p){this.enable=r,this.mode=l,this.frontFace=p}}function eu(m,r){const l=i.bG(m,3);i.ad.mat4.fromQuat(m,r),i.bI(m,3,l)}function vl(m,r){const l=i.ad.quat.identity([]);return i.ad.quat.rotateZ(l,l,-r),i.ad.quat.rotateX(l,l,-m),l}function Kl(m,r){const l=[m[0],m[1],0],p=[r[0],r[1],0];if(i.ad.vec3.length(l)>=1e-15){const S=i.ad.vec3.normalize([],l);i.ad.vec3.scale(p,S,i.ad.vec3.dot(p,S)),r[0]=p[0],r[1]=p[1]}const y=i.ad.vec3.cross([],r,m);if(i.ad.vec3.len(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return vl(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),b)}Xn.disabled=new Xn(!1,qa,Zl),Xn.backCCW=new Xn(!0,qa,Zl),Xn.backCW=new Xn(!0,qa,2304),Xn.frontCW=new Xn(!0,1028,2304),Xn.frontCCW=new Xn(!0,1028,Zl);class tu{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof i.ac?r:new i.ac(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=i.bF(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this.position,y=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(r)):0,b=i.ac.fromLngLat(r,y),S=[b.x-p.x,b.y-p.y,b.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Kl(S,l)}setPitchBearing(r,l){this.orientation=vl(i.ak(r),i.ak(-l))}}class Cs{constructor(r,l){this._transform=i.ad.mat4.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new i.ac(r[0],r[1],r[2])}get position(){const r=i.bG(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&i.bI(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||i.ad.quat.identity([]),r&&eu(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=vl(r,l),eu(this._transform,this._orientation)}forward(){const r=i.bG(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=i.bG(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=i.bG(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return i.ad.mat4.invert(p,this.getWorldToCamera(r,l)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,l,p){const y=this.position;i.ad.vec3.scale(y,y,-r);const b=new Float64Array(16);return i.ad.mat4.fromScaling(b,[p,p,p]),i.ad.mat4.translate(b,b,y),b[10]*=l,b}getWorldToCamera(r,l){const p=new Float64Array(16),y=new Float64Array(4),b=this.position;return i.ad.quat.conjugate(y,this._orientation),i.ad.vec3.scale(b,b,-r),i.ad.mat4.fromQuat(p,y),i.ad.mat4.translate(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,y){const b=new Float64Array(16);return i.ad.mat4.perspective(b,r,l,p,y),b}getCameraToClipOrthographic(r,l,p,y,b,S){const L=new Float64Array(16);return i.ad.mat4.ortho(L,r,l,p,y,b,S),L}getDistanceToElevation(r,l=!1){const p=r===0?0:i.bH(r,l?i.aT(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new Cs([...this.position],[...this.orientation])}}const Di={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Xl{constructor(r=0,l=0,p=0,y=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=y}interpolate(r,l,p){return l.top!=null&&r.top!=null&&(this.top=i.ah(r.top,l.top,p)),l.bottom!=null&&r.bottom!=null&&(this.bottom=i.ah(r.bottom,l.bottom,p)),l.left!=null&&r.left!=null&&(this.left=i.ah(r.left,l.left,p)),l.right!=null&&r.right!=null&&(this.right=i.ah(r.right,l.right,p)),this}getCenter(r,l){const p=i.ay((this.left+r-this.right)/2,0,r),y=i.ay((this.top+l-this.bottom)/2,0,l);return new i.P(p,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Xl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const un=15;class nu{constructor(r,l,p,y,b,S,L){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(S),this.setMaxBounds(L),this.width=0,this.height=0,this._center=new i.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Xl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Cs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new nu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<un}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return i.aA(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=i.bP(this.projectionOptions);const p=this.getProjection(),y=!i.bn(l,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bP({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bF(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=i.ad.mat2.create(),i.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=i.ay(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=i.ak(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,b=0;for(let S=0;S<l.length;S++){const L=new i.P(l[S][0]*this.width,p+l[S][1]*(this.height-p)),N=r.pointCoordinate(L);if(!N)continue;const F=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);y+=N[3]*F,b+=F}return b===0?NaN:y/b}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,y=this._mercatorZfromZoom(r),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(y-p,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const y=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,p));return i.ay(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!i.ad.quat.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];i.ad.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new tu;return l.position=new i.ac(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!i.ad.quat.length(r))return!1;i.ad.quat.normalize(r,r);const l=i.ad.vec3.transformQuat([],[0,0,-1],r),p=i.ad.vec3.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const y=Kl(l,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;r[2]=i.ay(r[2],y/p,y/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new i.bQ(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new i.P(0,0)),y=this.pointCoordinate(new i.P(this.width,0)),b=this.pointCoordinate(new i.P(this.width,this.height)),S=this.pointCoordinate(new i.P(0,this.height)),L=Math.floor(Math.min(p.x,y.x,b.x,S.x)),N=Math.floor(Math.max(p.x,y.x,b.x,S.x)),F=1;for(let B=L-F;B<=N+F;B++)B!==0&&l.push(new i.bQ(B,r))}return l}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,l,p){let y=[];const b=p!==void 0,S=!b;if(S&&this.zoom<l||b&&p[0]===0&&p[1]===0)return y;const L=new Set,N=(B,H,W,ee,ce)=>{const oe=i.c5(H,B,W,ee,ce);L.has(oe)||(y.push(new i.aH(B,H,W,ee,ce)),L.add(oe))};for(let B=0;B<r.length;B++){const H=r[B];if(S&&H.canonical.z!==l)continue;const W=H.canonical,ee=H.overscaledZ,ce=H.wrap,oe=1<<W.z,fe=W.x+1<oe,pe=W.x>0,Te=W.y+1<oe,De=W.y>0,Ie=H.wrap-(pe?0:1),Ge=H.wrap+(fe?0:1),Be=pe?W.x-1:oe-1,je=fe?W.x+1:0;if(b)p[0]<0?(N(ee,Ge,W.z,je,W.y),p[1]<0&&Te&&(N(ee,ce,W.z,W.x,W.y+1),N(ee,Ge,W.z,je,W.y+1)),p[1]>0&&De&&(N(ee,ce,W.z,W.x,W.y-1),N(ee,Ge,W.z,je,W.y-1))):p[0]>0?(N(ee,Ie,W.z,Be,W.y),p[1]<0&&Te&&(N(ee,ce,W.z,W.x,W.y+1),N(ee,Ie,W.z,Be,W.y+1)),p[1]>0&&De&&(N(ee,ce,W.z,W.x,W.y-1),N(ee,Ie,W.z,Be,W.y-1))):p[1]<0&&Te?N(ee,ce,W.z,W.x,W.y+1):De&&N(ee,ce,W.z,W.x,W.y-1);else{const Ue=H.visibleQuadrants;1&Ue&&(N(ee,Ie,W.z,Be,W.y),De&&(N(ee,ce,W.z,W.x,W.y-1),N(ee,Ie,W.z,Be,W.y-1))),2&Ue&&(N(ee,Ge,W.z,je,W.y),De&&(N(ee,ce,W.z,W.x,W.y-1),N(ee,Ge,W.z,je,W.y-1))),4&Ue&&(N(ee,Ie,W.z,Be,W.y),Te&&(N(ee,ce,W.z,W.x,W.y+1),N(ee,Ie,W.z,Be,W.y+1))),8&Ue&&(N(ee,Ge,W.z,je,W.y),Te&&(N(ee,ce,W.z,W.x,W.y+1),N(ee,Ge,W.z,je,W.y+1)))}}const F=[];for(const B of y)y.some(H=>B.isChildOf(H))||F.push(B);if(y=F.filter(B=>!r.some(H=>!!(B.overscaledZ<l&&H.isChildOf(B))||B.equals(H)||B.isChildOf(H))),S){const B=1<<l,H=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=[B*H.x,B*H.y],ee=4,ce=ee*ee;y=y.filter(oe=>{const fe=oe.canonical.x+.5-W[0],pe=oe.canonical.y+.5-W[1];return fe*fe+pe*pe<ce})}return y}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,y=this.elevation&&this.elevation.exaggeration(),b=y&&!r.isTerrainDEM,S=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);const L=this.locationCoordinate(this.center),N=this.center.lat,F=1<<l,B=[F*L.x,F*L.y,0],H=this.projection.name==="globe",W=!H,ee=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,W),ce=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=F*i.bH(1,this.center.lat),fe=this._camera.position[2]/i.bH(1,this.center.lat),pe=[F*ce.x,F*ce.y,fe*(W?1:oe)],Te=H||y,De=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),Ie=this.isLODDisabled(!0)?l:0;let Ge;if(this._elevation&&r.isTerrainDEM)Ge=1e4*this._elevation.exaggeration();else if(this._elevation){const mt=this._elevation.getMinMaxForVisibleTiles();Ge=mt?mt.max:this._centerAltitude}else Ge=this._centerAltitude;const Be=r.isTerrainDEM?-Ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,je=this.projection.isReprojectedInTileSpace?i.bS(this):1,Ue=mt=>{const Bt=new i.ac(mt.x+25e-6,mt.y,mt.z),Xt=new i.ac(mt.x,mt.y+25e-6,mt.z),Rt=mt.toLngLat(),Qt=Bt.toLngLat(),gn=Xt.toLngLat(),_n=this.locationCoordinate(Rt),xn=this.locationCoordinate(Qt),Dn=this.locationCoordinate(gn),ar=Math.hypot(xn.x-_n.x,xn.y-_n.y),Vn=Math.hypot(Dn.x-_n.x,Dn.y-_n.y);return Math.sqrt(ar*Vn)*je/25e-6},Ke=mt=>{const Gt=Ge,Bt=Be;return{aabb:i.bV(this,F,0,0,0,mt,Bt,Gt,this.projection),zoom:0,x:0,y:0,minZ:Bt,maxZ:Gt,wrap:mt,fullyVisible:!1}},nt=[];let kt=[];const xt=l,Zt=r.reparseOverscaled?p:l,Kt=(fe-this._centerAltitude)*oe,ln=mt=>{if(!this._elevation||!mt.tileID||!S)return;const Gt=this._elevation.getMinMaxForTile(mt.tileID),Bt=mt.aabb;Gt?(Bt.min[2]=Gt.min,Bt.max[2]=Gt.max,Bt.center[2]=(Bt.min[2]+Bt.max[2])/2):(mt.shouldSplit=Ht(mt),mt.shouldSplit||(Bt.min[2]=Bt.max[2]=Bt.center[2]=this._centerAltitude))},vt=(mt,Gt)=>{if(.707*Gt<mt)return 1;const Bt=Gt/mt;return Bt/(1.4144271570014144+(Math.pow(1.1,Bt-1.4144271570014144+1)-1)/(1.1-1)-1)},Ht=mt=>{if(mt.zoom<Ie)return!0;if(mt.zoom===xt)return!1;if(mt.shouldSplit!=null)return mt.shouldSplit;const Gt=mt.aabb.distanceX(pe),Bt=mt.aabb.distanceY(pe);let Xt=Kt,Rt=1;if(H){Xt=mt.aabb.distanceZ(pe);const Vn=Math.pow(2,mt.zoom),ir=i.aT((mt.y+1)/Vn),Yn=i.aT(mt.y/Vn),Cr=Math.min(Math.max(N,ir),Yn),ri=i.ca(Cr)/i.ca(N);if(Rt=Cr===N?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ri/this._mercatorScaleRatio),this.zoom<=i.c6&&mt.zoom===xt-1&&ri>=.9)return!0}else if(b&&(Xt=mt.aabb.distanceZ(pe)*oe),this.projection.isReprojectedInTileSpace&&p<=5){const Vn=Math.pow(2,mt.zoom),ir=Ue(new i.ac((mt.x+.5)/Vn,(mt.y+.5)/Vn));Rt=ir>.85?1:ir}if(!S){const Vn=Math.sqrt(Gt*Gt+Bt*Bt+Xt*Xt);let ir=(1<<xt-mt.zoom)*De*Rt;return ir*=vt(Math.max(Xt,Kt),Vn),Vn<ir}let Qt=Number.MAX_VALUE,gn=0;const _n=mt.aabb.getCorners(),xn=[];for(const Vn of _n){i.ad.vec3.sub(xn,Vn,pe),H||(b?xn[2]*=oe:xn[2]=Kt);const ir=i.ad.vec3.dot(xn,this._camera.forward());ir<Qt&&(Qt=ir,gn=Math.abs(xn[2]))}let Dn=(1<<xt-mt.zoom)*De*Rt;if(Dn*=vt(Math.max(gn,Kt),Qt),Qt<Dn)return!0;const ar=mt.aabb.closestPoint(B);return ar[0]===B[0]&&ar[1]===B[1]};if(this.renderWorldCopies)for(let mt=1;mt<=3;mt++)nt.push(Ke(-mt)),nt.push(Ke(mt));for(nt.push(Ke(0));nt.length>0;){const mt=nt.pop(),Gt=mt.x,Bt=mt.y;let Xt=mt.fullyVisible;const Rt=()=>this.projection.name==="globe"&&(mt.y===0||mt.y===(1<<mt.zoom)-1);if(!Xt){let Qt=Te?mt.aabb.intersects(ee):mt.aabb.intersectsFlat(ee);if(Qt===0&&Rt()){const gn=new i.bT(mt.zoom,Gt,Bt);Qt=i.bU(this,F,gn,!0).intersects(ee)}if(Qt===0)continue;Xt=Qt===2}if(mt.zoom!==xt&&Ht(mt))for(let Qt=0;Qt<4;Qt++){const gn=(Gt<<1)+Qt%2,_n=(Bt<<1)+(Qt>>1),xn={aabb:S?mt.aabb.quadrant(Qt):i.bV(this,F,mt.zoom+1,gn,_n,mt.wrap,mt.minZ,mt.maxZ,this.projection),zoom:mt.zoom+1,x:gn,y:_n,wrap:mt.wrap,fullyVisible:Xt,tileID:void 0,shouldSplit:void 0,minZ:mt.minZ,maxZ:mt.maxZ};b&&!H&&(xn.tileID=new i.aH(mt.zoom+1===xt?Zt:mt.zoom+1,mt.wrap,mt.zoom+1,gn,_n),ln(xn)),nt.push(xn)}else{const Qt=mt.zoom===xt?Zt:mt.zoom;if(r.minzoom&&r.minzoom>Qt)continue;let gn=0;if(!Xt){let ar=Te?mt.aabb.intersectsPrecise(ee):mt.aabb.intersectsPreciseFlat(ee);if(ar===0&&Rt()){const Vn=new i.bT(mt.zoom,Gt,Bt);ar=i.bU(this,F,Vn,!0).intersectsPrecise(ee)}if(ar===0)continue;if(r.calculateQuadrantVisibility)if(ee.containsPoint(mt.aabb.center))gn=15;else for(let Vn=0;Vn<4;Vn++)mt.aabb.quadrant(Vn).intersects(ee)!==0&&(gn|=1<<Vn)}const _n=B[0]-(.5+Gt+(mt.wrap<<mt.zoom))*(1<<l-mt.zoom),xn=B[1]-.5-Bt,Dn=mt.tileID?mt.tileID:new i.aH(Qt,mt.wrap,mt.zoom,Gt,Bt);r.calculateQuadrantVisibility&&(Dn.visibleQuadrants=gn),kt.push({tileID:Dn,distanceSq:_n*_n+xn*xn})}}if(this.fogCullDistSq){const mt=this.fogCullDistSq,Gt=this.horizonLineFromTop();kt=kt.filter(Bt=>{const Xt=[0,0,0,1],Rt=[i.ai,i.ai,0,1],Qt=this.calculateFogTileMatrix(Bt.tileID.toUnwrapped());i.ad.vec4.transformMat4(Xt,Xt,Qt),i.ad.vec4.transformMat4(Rt,Rt,Qt);const gn=i.ad.vec4.min([],Xt,Rt),_n=i.ad.vec4.max([],Xt,Rt),xn=i.bW(gn,_n);if(xn===0)return!0;let Dn=!1;const ar=this._elevation;if(ar&&xn>mt&&Gt!==0){const Vn=this.calculateProjMatrix(Bt.tileID.toUnwrapped());let ir;r.isTerrainDEM||(ir=ar.getMinMaxForTile(Bt.tileID)),ir||(ir={min:Be,max:Ge});const Yn=i.c7(this.rotation),Cr=[Yn[0]*i.ai,Yn[1]*i.ai,ir.max];i.ad.vec3.transformMat4(Cr,Cr,Vn),Dn=(1-Cr[1])*this.height*.5<Gt}return xn<mt||Dn})}return kt.sort((mt,Gt)=>mt.distanceSq-Gt.distanceSq).map(mt=>mt.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=i.ay(r.lat,-i.bX,i.bX),p=this.projection.project(r.lng,l);return new i.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,l){let p,y;const b=this.centerPoint;if(this.projection.name==="globe"){const L=this.worldSize;p=(l.x-b.x)/L,y=(l.y-b.y)/L}else{const L=this.pointCoordinate(l),N=this.pointCoordinate(b);p=L.x-N.x,y=L.y-N.y}const S=this.locationCoordinate(r);this.setLocation(new i.ac(S.x-p,S.y-y))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,l){return this.projection.locationPoint(this,r,l)}locationPoint3D(r,l){return this.projection.locationPoint(this,r,l,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,l){return this.coordinateLocation(this.pointCoordinate3D(r,l))}locationCoordinate(r,l){const p=l?i.bH(l,r.lat):void 0,y=this.projection.project(r.lng,r.lat);return new i.ac(y.x,y.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const p=l??this._centerAltitude,y=[r.x,r.y,0,1],b=[r.x,r.y,1,1];i.ad.vec4.transformMat4(y,y,this.pixelMatrixInverse),i.ad.vec4.transformMat4(b,b,this.pixelMatrixInverse);const S=b[3];i.ad.vec4.scale(y,y,1/y[3]),i.ad.vec4.scale(b,b,1/S);const L=y[2],N=b[2];return{p0:y,p1:b,t:L===N?0:(p-L)/(N-L)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return i.ad.vec4.transformMat4(l,l,this.pixelMatrixInverse),i.ad.vec4.transformMat4(p,p,this.pixelMatrixInverse),i.ad.vec4.scale(l,l,1/l[3]),i.ad.vec4.scale(p,p,1/p[3]),l[2]=i.bH(l[2],this._center.lat)*this.worldSize,p[2]=i.bH(p[2],this._center.lat)*this.worldSize,i.ad.vec4.scale(l,l,1/this.worldSize),i.ad.vec4.scale(p,p,1/this.worldSize),new i.as([l[0],l[1],l[2]],i.ad.vec3.normalize([],i.ad.vec3.sub([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:y}=r,b=i.bH(l[2],this._center.lat),S=i.bH(p[2],this._center.lat);return new i.ac(i.ah(l[0],p[0],y)/this.worldSize,i.ah(l[1],p[1],y)/this.worldSize,i.ah(b,S,y))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r,l){if(!this.elevation)return this.pointCoordinate(r,l);let p=this.projection.pointCoordinate3D(this,r.x,r.y);if(p)return new i.ac(p[0],p[1],p[2]);let y=0,b=this.horizonLineFromTop();if(r.y>b)return this.pointCoordinate(r,l);const S=.02*b,L=r.clone();for(let N=0;N<10&&b-y>S;N++){L.y=i.ah(y,b,.66);const F=this.projection.pointCoordinate3D(this,L.x,L.y);F?(b=L.y,p=F):y=L.y}return p?new i.ac(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=i.bY)return!this.isPointAboveHorizon(r);const l=this.pointCoordinate(r);return l.y>=0&&l.y<=1}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,y=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return i.ad.vec4.transformMat4(y,y,this.pixelMatrix),y[3]>0?new i.P(y[0]/y[3],y[1]/y[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new i.P(l,r)),S=this.pointLocation3D(new i.P(y,r)),L=this.pointLocation3D(new i.P(y,p)),N=this.pointLocation3D(new i.P(l,p));let F=Math.min(b.lng,S.lng,L.lng,N.lng),B=Math.max(b.lng,S.lng,L.lng,N.lng),H=Math.min(b.lat,S.lat,L.lat,N.lat),W=Math.max(b.lat,S.lat,L.lat,N.lat);const ee=Math.pow(2,-this.zoom)/16*270,ce=this.projection.name==="globe"?1:4,oe=(fe,pe,Te,De,Ie)=>{const Ge=(fe+Te)/2,Be=(pe+De)/2,je=new i.P(Ge,Be),{lng:Ue,lat:Ke}=this.pointLocation3D(je),nt=Math.max(0,F-Ue,H-Ke,Ue-B,Ke-W);F=Math.min(F,Ue),B=Math.max(B,Ue),H=Math.min(H,Ke),W=Math.max(W,Ke),(Ie<ce||nt>ee)&&(oe(fe,pe,Ge,Be,Ie+1),oe(Ge,Be,Te,De,Ie+1))};if(oe(l,r,y,r,1),oe(y,r,y,p,1),oe(y,p,l,p,1),oe(l,p,l,r,1),this.projection.name==="globe"){const[fe,pe]=i.bZ(this);fe?(W=90,B=180,F=-180):pe&&(H=-90,B=180,F=-180)}return new i.aB(new i.bO(F,H),new i.bO(B,W))}_getBoundsRectangular(r,l){const{top:p,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,L=new i.P(y,p),N=new i.P(S,p),F=new i.P(S,b),B=new i.P(y,b);let H=this.pointCoordinate(L,r),W=this.pointCoordinate(N,r);const ee=this.pointCoordinate(F,l),ce=this.pointCoordinate(B,l),oe=(fe,pe)=>(pe.y-fe.y)/(pe.x-fe.x);return H.y>1&&W.y>=0?H=new i.ac((1-ce.y)/oe(ce,H)+ce.x,1):H.y<0&&W.y<=1&&(H=new i.ac(-ce.y/oe(ce,H)+ce.x,0)),W.y>1&&H.y>=0?W=new i.ac((1-ee.y)/oe(ee,W)+ee.x,1):W.y<0&&H.y<=1&&(W=new i.ac(-ee.y/oe(ee,W)+ee.x,0)),new i.aB().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(ce)).extend(this.coordinateLocation(ee))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=r.visibleDemTiles.reduce((p,y)=>{if(y.dem){const b=y.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-i.bX,this.maxLat=i.bX,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.av(this.minLng)*this.tileSize,this.worldMaxX=i.av(this.maxLng)*this.tileSize,this.worldMinY=i.aC(this.maxLat)*this.tileSize,this.worldMaxY=i.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];const y=r.canonical,b=1/this.height,S=this.cameraWorldSize,L=S/this.zoomScale(y.z),N=(y.x+Math.pow(2,y.z)*r.wrap)*L,F=y.y*L,B=this.point;B.x*=S/this.worldSize,B.y*=S/this.worldSize;const H=this.angle,W=Math.sin(-H),ee=-Math.cos(-H);return p[l]={bearing:[W,ee],center:[(B.x-N)*b,(B.y-F)*b],scale:L/i.ai*b},p[l]}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return i.ad.mat4.multiply(y,this.worldToFogMatrix,y),p[l]=new Float32Array(y),p[l]}calculateProjMatrix(r,l=!1,p=!1){const y=r.key;let b;if(b=p?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const S=this.calculatePosMatrix(r,this.worldSize);let L;return L=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,i.ad.mat4.multiply(S,L,S),b[y]=new Float32Array(S),b[y]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const y=i.b_(r,this);return p[l]=y,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,l=i.ad.mat4.fromScaling([],[r,r,r]);return i.ad.mat4.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const l=i.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),y=this._camera.forward(),b=i.bH(1,this._center.lat);p[2]/=b,y[2]/=b,i.ad.vec3.normalize(y,y);const S=r.raycast(p,y,r.exaggeration());if(S){const L=i.ad.vec3.scaleAndAdd([],p,y,S),N=new i.ac(L[0],L[1],i.bH(L[2],i.aT(L[1]))),F=(N.z+i.ad.vec3.length([N.x-p[0],N.y-p[1],N.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,p=i.bH(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),b=l.getAtPointOrZero(new i.ac(...y)),S=this.pixelsPerMeter/this.worldSize*b,L=this._minimumHeightOverTerrain(),N=y[2]-S;if(N<=L)if(N<0||r){const F=this.locationCoordinate(this._center,this._centerAltitude),B=[y[0],y[1],F.z-y[2]],H=i.ad.vec3.length(B);B[2]-=(L-N)/this._pixelsPerMercatorPixel;const W=i.ad.vec3.length(B);if(W===0)return;i.ad.vec3.scale(B,B,H/W*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],F.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const W=this.center;return W.lat=i.ay(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(W.lng=i.ay(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const l=this._unmodified,{x:p,y}=this.point;let b=0,S=p,L=y;const N=this.width/2,F=this.height/2,B=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(y-F<B&&(L=B+F),y+F>H&&(L=H-F),H-B<this.height&&(b=Math.max(b,this.height/(H-B)),L=(H+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,ce=this.worldSize/2-(W+ee)/2;S=(p+ce+this.worldSize)%this.worldSize-ce,S-N<W&&(S=W+N),S+N>ee&&(S=ee-N),ee-W<this.width&&(b=Math.max(b,this.width/(ee-W)),S=(ee+W)/2)}S===p&&L===y||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(S,L))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bH(1,this.center.lat)/i.bH(1,i.c8));const y=i.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,S=this._camera.getWorldToCamera(this.worldSize,b);let L;const N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(N[8]=2*-r.x/this.width,N[9]=2*r.y/this.height,this.isOrthographic){let Ke=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),nt=Ke*this.aspect,kt=-nt,xt=-Ke;nt-=r.x,kt-=r.x,Ke+=r.y,xt+=r.y,L=this._camera.getCameraToClipOrthographic(kt,nt,xt,Ke,this._nearZ,this._farZ),((Zt,Kt,ln,vt)=>{for(let Ht=0;Ht<16;Ht++)Zt[Ht]=i.ah(Kt[Ht],ln[Ht],vt)})(L,L,N,i.c9(this.pitch>=un?1:this.pitch/un))}else L=N;const F=i.ad.mat4.mul([],N,S);let B=i.ad.mat4.mul([],L,S);if(this.projection.isReprojectedInTileSpace){const Ke=this.locationCoordinate(this.center),nt=i.ad.mat4.identity([]);i.ad.mat4.translate(nt,nt,[Ke.x*this.worldSize,Ke.y*this.worldSize,0]),i.ad.mat4.multiply(nt,nt,i.c0(this)),i.ad.mat4.translate(nt,nt,[-Ke.x*this.worldSize,-Ke.y*this.worldSize,0]),i.ad.mat4.multiply(B,B,nt),i.ad.mat4.multiply(F,F,nt),this.inverseAdjustmentMatrix=i.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.mat4.scale([],B,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=B,this.invProjMatrix=i.ad.mat4.invert(new Float64Array(16),this.projMatrix),l){const Ke=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ke[8]=2*-r.x/this.width,Ke[9]=2*r.y/this.height,this.expandedFarZProjMatrix=i.ad.mat4.mul([],Ke,S)}else this.expandedFarZProjMatrix=this.projMatrix;const H=i.ad.mat4.invert([],L);this.frustumCorners=i.c2.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const W=new Float32Array(16);i.ad.mat4.identity(W),i.ad.mat4.scale(W,W,[1,-1,1]),i.ad.mat4.rotateX(W,W,this._pitch),i.ad.mat4.rotateZ(W,W,this.angle);const ee=i.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.mat4.clone(ee);const ce=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ee[8]=2*-r.x/this.width,ee[9]=2*(r.y+ce)/this.height,this.skyboxMatrix=i.ad.mat4.multiply(W,ee,W);const oe=this.point,fe=oe.x,pe=oe.y,Te=this.width%2/2,De=this.height%2/2,Ie=Math.cos(this.angle),Ge=Math.sin(this.angle),Be=fe-Math.round(fe)+Ie*Te+Ge*De,je=pe-Math.round(pe)+Ie*De+Ge*Te,Ue=new Float64Array(B);if(i.ad.mat4.translate(Ue,Ue,[Be>.5?Be-1:Be,je>.5?je-1:je,0]),this.alignedProjMatrix=Ue,B=i.ad.mat4.create(),i.ad.mat4.scale(B,B,[this.width/2,-this.height/2,1]),i.ad.mat4.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=i.ad.mat4.create(),i.ad.mat4.scale(B,B,[1,-1,1]),i.ad.mat4.translate(B,B,[-1,-1,0]),i.ad.mat4.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=i.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,F),this._calcFogMatrices(),this._distanceTileDataCache={},B=i.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.c3(this);const Ke=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad.vec3.transformMat4(Ke,Ke,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[r,r,l];i.ad.vec3.scale(b,b,y),i.ad.vec3.scale(p,p,-1),i.ad.vec3.multiply(p,p,b);const S=i.ad.mat4.create();i.ad.mat4.translate(S,S,p),i.ad.mat4.scale(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,y)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*b,y.y/this.worldSize-p[1]*b,r/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=r[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((l-p)/y,1)),this._camera.position=i.ad.vec3.scaleAndAdd([],this._camera.position,r,b),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),b=i.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ak(this._maxPitch)),L=Math.max((r[2]-b)/Math.cos(p),S),N=this._zoomFromMercatorZ(L);i.ad.vec3.scaleAndAdd(r,r,l,L),this._pitch=i.ay(p,i.ak(this.minPitch),i.ak(this.maxPitch)),this.angle=i.bF(y,-Math.PI,Math.PI),this._setZoom(i.ay(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let l=0,p=i.bY,y=0,b=1/0;for(;p-l>1e-6&&p>l;){const S=l+.5*(p-l),L=this.tileSize*Math.pow(2,S),N=this.getCameraToCenterDistance(this.projection,S,L),F=this.scaleZoom(N/(r*this.tileSize)),B=Math.abs(S-F);B<b&&(b=B,y=S),S<F?l=S:p=S}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const p=Math.min(r.x,l.x),y=Math.max(r.x,l.x),b=Math.min(r.y,l.y),S=Math.max(r.y,l.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const L=[new i.P(p,b),new i.P(y,S),new i.P(p,S),new i.P(y,b)],N=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const B of L){const H=this.pointRayIntersection(B);if(H.t<0)return!0;const W=this.rayIntersectionCoordinate(H);if(W.x<N||W.y<0||W.x>F||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(r,l){const p=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,r)),y=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([l,p,y],b){const S=[l,p,y,1];i.ad.vec4.transformMat4(S,S,b);const L=S[3]=Math.max(S[3],1e-6);return S[0]/=L,S[1]/=L,S[2]/=L,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,r))}}getCameraToCenterDistance(r,l=this.zoom,p=this.worldSize){const y=i.b$(r,l,this.width,this.height,1024),b=r.pixelSpaceConversion(this.center.lat,p,y);let S=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(S=i.ah(1,S,i.c9(this.pitch>=un?1:this.pitch/un))),S}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.mat4.multiply(r,r,this.globeMatrix),r}getFrustum(r){return i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const Ps=(m,r)=>{if(r>0&&m.terrain&&i.w("Cutoff is currently disabled on terrain"),r<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=m.transform,p=Math.max(Math.abs(l._zoom-(m.minCutoffZoom-1)),1),y=l.isLODDisabled(!1)?i.ae(60,45,l.pitch):i.ae(30,15,l.pitch),b=l._farZ-l._nearZ,S=r*l.height,L=((1-(N=y))*l.cameraToCenterDistance+N*(l._farZ+S))*p;var N;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(L-l._nearZ)/b,(L-S-l._nearZ)/b]}}},Zs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class wh{constructor(r,l){this.aabb=r,this.lastCascade=l}}class Ru{add(r,l){const p=this.receivers[r.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],l.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],l.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],l.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],l.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],l.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],l.max[2])):this.receivers[r.key]=new wh(l,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,l,p){const y=i.ce.fromPoints(r.points);let b=0;for(const S in this.receivers){const L=this.receivers[S];if(!L||!y.intersectsAabb(L.aabb))continue;L.aabb.min=y.closestPoint(L.aabb.min),L.aabb.max=y.closestPoint(L.aabb.max);const N=L.aabb.getCorners();for(let F=0;F<p.length;F++){let B=!0;for(const H of N){const W=[H[0]*l,H[1]*l,H[2]];if(i.ad.vec3.transformMat4(W,W,p[F].matrix),W[0]<-1||W[0]>1||W[1]<-1||W[1]>1){B=!1;break}}if(L.lastCascade=F,b=Math.max(b,F),B)break}}return b+1}}class Ks{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ru,this._depthMode=new Rn(r.context.gl.LEQUAL,Rn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(Zs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Zs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(Zs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,l){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const y=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||y<=0||(this._shadowLayerCount=p.style.order.reduce((ce,oe)=>{const fe=p.style._mergedLayers[oe];return ce+(fe.hasShadowPass()&&!fe.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=p.context,S=Zs.shadowMapResolution,L=Zs.shadowMapResolution;if(this._cascades.length===0||Zs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ce=0;ce<Zs.cascadeCount;++ce){const oe=p._shadowMapDebug,fe=b.gl,pe=b.createFramebuffer(S,L,oe,"texture"),Te=new i.T(b,{width:S,height:L,data:null},fe.DEPTH_COMPONENT16);if(pe.depthAttachment.set(Te.texture),oe){const De=new i.T(b,{width:S,height:L,data:null},fe.RGBA8);pe.colorAttachment.set(De.texture)}this._cascades.push({framebuffer:pe,texture:Te,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bR,scale:0})}}this.shadowDirection=bl(l);let N=0;if(r.elevation){const ce=r.elevation,oe=[1e4,-1e4];ce.visibleDemTiles.filter(fe=>fe.dem).forEach(fe=>{const pe=fe.dem.tree;oe[0]=Math.min(oe[0],pe.minimums[0]),oe[1]=Math.max(oe[1],pe.maximums[0])}),oe[0]!==1e4&&(N=(oe[1]-oe[0])*ce.exaggeration())}const F=1.5*r.cameraToCenterDistance,B=3*F,H=new Float64Array(16);for(let ce=0;ce<this._cascades.length;++ce){const oe=this._cascades[ce];let fe=r.height/50,pe=1;Zs.cascadeCount===1?pe=B:ce===0?pe=F:(fe=F,pe=B);const[Te,De]=Ca(r,this.shadowDirection,fe,pe,Zs.shadowMapResolution,N);oe.scale=r.scale,oe.matrix=Te,oe.boundingSphereRadius=De,i.ad.mat4.invert(H,oe.matrix),oe.frustum=i.bR.fromInvProjectionMatrix(H,1,0,!0),oe.far=pe}const W=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[W].far,this._cascades[W].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Zs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Zs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Di.ShadowMap0,this._uniformValues.u_shadowmap_1=Di.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ee=p.transform.elevation;for(const ce of this._groundShadowTiles){let oe={min:0,max:0};if(ee){const fe=ee.getMinMaxForTile(ce);fe&&(oe=fe)}this.addShadowReceiver(ce.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,l){if(!this.enabled)return;const p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,Zs.shadowMapResolution,Zs.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:i.al.white,depth:1});for(const S of r.order){const L=r._mergedLayers[S];if(!L.hasShadowPass()||L.isHidden(p.transform.zoom))continue;const N=r.getLayerSourceCache(L),F=N?l[N.id]:void 0;(L.type==="model"||F&&F.length)&&p.renderLayer(p,N,L,F)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,l=r.style,p=r.context,y=l.directionalLight,b=l.ambientLight;if(!y||!b)return;const S=[],L=Ps(r,r.longestCutoffRange);L.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const N=Tc(l,y,b),F=new Rn(p.gl.LEQUAL,Rn.ReadOnly,r.depthRangeFor3D);for(const B of this._groundShadowTiles){const H=B.toUnwrapped(),W=r.isTileAffectedByFog(B),ee=r.getOrCreateProgram("groundShadow",{defines:S,overrideFog:W});this.setupShadows(H,ee),r.uploadCommonUniforms(p,ee,H,null,L);const ce={u_matrix:r.transform.calculateProjMatrix(H),u_ground_shadow_factor:N};ee.draw(r,p.gl.TRIANGLES,F,Hn.disabled,Jn.multiply,Xn.disabled,ce,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Jn.unblended:Jn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const l=this.painter.transform,p=l.calculatePosMatrix(r,l.worldSize);return i.ad.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(r){return i.ad.mat4.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,l,p,y=0){if(!this.enabled)return;const b=this.painter.transform,S=this.painter.context,L=S.gl,N=this._uniformValues,F=new Float64Array(16),B=b.calculatePosMatrix(r,b.worldSize);for(let H=0;H<this._cascades.length;H++)i.ad.mat4.multiply(F,this._cascades[H].matrix,B),N[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(F),S.activeTexture.set(L.TEXTURE0+Di.ShadowMap0+H),this._cascades[H].texture.bind(L.NEAREST,L.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const H=i.cd(r.canonical),W=2/b.tileSize*i.ai/Zs.shadowMapResolution,ee=W*this._cascades[0].boundingSphereRadius,ce=W*this._cascades[this._cascades.length-1].boundingSphereRadius,oe=(p==="vector-tile"?1:3)/Math.pow(2,y-r.canonical.z-(1-b.zoom+Math.floor(b.zoom)));N.u_shadow_normal_offset=[H,ee*oe,ce*oe],N.u_shadow_bias=[6e-5,.0012,.012]}else N.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(S,N)}setupShadowsFromMatrix(r,l,p=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,S=this._uniformValues,L=new Float64Array(16);for(let N=0;N<Zs.cascadeCount;N++)i.ad.mat4.multiply(L,this._cascades[N].matrix,r),S[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),y.activeTexture.set(b.TEXTURE0+Di.ShadowMap0+N),this._cascades[N].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){const N=Zs.normalOffset;S.u_shadow_normal_offset=[1,N,N],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(y,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,l,p,y){if(y[2]>=0)return{};const b=function(N,F,B){const H=B/(1<<N.canonical.z);return new i.ce([N.canonical.x*H+N.wrap*B,N.canonical.y*H+N.wrap*B,0],[(N.canonical.x+1)*H+N.wrap*B,(N.canonical.y+1)*H+N.wrap*B,F])}(r,l,p).getCorners(),S=l/-y[2];y[0]<0?(i.ad.vec3.add(b[0],b[0],[y[0]*S,0,0]),i.ad.vec3.add(b[3],b[3],[y[0]*S,0,0])):y[0]>0&&(i.ad.vec3.add(b[1],b[1],[y[0]*S,0,0]),i.ad.vec3.add(b[2],b[2],[y[0]*S,0,0])),y[1]<0?(i.ad.vec3.add(b[0],b[0],[0,y[1]*S,0]),i.ad.vec3.add(b[1],b[1],[0,y[1]*S,0])):y[1]>0&&(i.ad.vec3.add(b[2],b[2],[0,y[1]*S,0]),i.ad.vec3.add(b[3],b[3],[0,y[1]*S,0]));const L={};return L.vertices=b,L.planes=[xl(b[1],b[0],b[4]),xl(b[2],b[1],b[5]),xl(b[3],b[2],b[6]),xl(b[0],b[3],b[7])],L}addShadowReceiver(r,l,p){this._receivers.add(r,i.ce.fromTileIdAndHeight(r,l,p))}getMaxCascadeForTile(r){const l=this._receivers.get(r);return l&&l.lastCascade?l.lastCascade:0}}function xl(m,r,l){const p=i.ad.vec3.sub([],l,r),y=i.ad.vec3.sub([],m,r),b=i.ad.vec3.cross([],p,y),S=i.ad.vec3.length(b);return S===0?[0,0,1,0]:(i.ad.vec3.scale(b,b,1/S),[b[0],b[1],b[2],-i.ad.vec3.dot(b,r)])}function bl(m){const r=m.properties.get("direction"),l=i.cc(r.x,r.y,r.z);l[2]=i.ay(l[2],0,75);const p=i.cf([l[0],l[1],l[2]]);return i.ad.vec3.fromValues(p.x,p.y,p.z)}function Tc(m,r,l){const p=r.properties.get("color-use-theme")==="none",y=r.properties.get("color"),b=r.properties.get("intensity"),S=r.properties.get("direction"),L=[S.x,S.y,S.z],N=l.properties.get("color-use-theme")==="none",F=l.properties.get("color"),B=l.properties.get("intensity"),H=Math.max(i.ad.vec3.dot([0,0,1],L),0),W=[0,0,0];i.ad.vec3.scale(W,F.toRenderColor(N?null:m.getLut(r.scope)).toArray01Linear().slice(0,3),B);const ee=[0,0,0];return i.ad.vec3.scale(ee,y.toRenderColor(p?null:m.getLut(l.scope)).toArray01Linear().slice(0,3),H*b),i.cg([W[0]>0?W[0]/(W[0]+ee[0]):0,W[1]>0?W[1]/(W[1]+ee[1]):0,W[2]>0?W[2]/(W[2]+ee[2]):0])}function Ca(m,r,l,p,y,b){const S=m.zoom,L=m.scale,N=m.worldSize,F=1/N,B=m.aspect,H=Math.sqrt(1+B*B)*Math.tan(.5*m.fovX),W=H*H,ee=p-l,ce=p+l;let oe,fe;W>ee/ce?(oe=p,fe=p*H):(oe=.5*ce*(1+W),fe=.5*Math.sqrt(ee*ee+2*(p*p+l*l)*W+ce*ce*W*W));const pe=m.projection.pixelsPerMeter(m.center.lat,N),Te=m._camera.getCameraToWorldMercator(),De=[0,0,-oe*F];i.ad.vec3.transformMat4(De,De,Te);let Ie=fe*F;const Ge=m._edgeInsets;if(!(Ge.left===0&&Ge.top===0&&Ge.right===0&&Ge.bottom===0||Ge.left===Ge.right&&Ge.top===Ge.bottom)){const Xt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?pe:1),Rt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,l,p);Rt[8]=2*-m.centerOffset.x/m.width,Rt[9]=2*m.centerOffset.y/m.height;const Qt=new Float64Array(16);i.ad.mat4.mul(Qt,Rt,Xt);const gn=new Float64Array(16);i.ad.mat4.invert(gn,Qt);const _n=i.bR.fromInvProjectionMatrix(gn,N,S,!0);for(const xn of _n.points){const Dn=((Be=xn)[0]/=L,Be[1]/=L,Be[2]=i.bH(Be[2],m._center.lat),Be);Ie=Math.max(Ie,i.ad.vec3.len(i.ad.vec3.subtract([],De,Dn)))}}var Be;Ie*=y/(y-1);const je=Math.acos(r[2]),Ue=Math.atan2(-r[0],-r[1]),Ke=new Cs;Ke.position=De,Ke.setPitchBearing(je,Ue);const nt=Ke.getWorldToCamera(N,pe),kt=Ie*N,xt=Math.min(m._mercatorZfromZoom(17)*N*-2,-2*kt),Zt=Ke.getCameraToClipOrthographic(-kt,kt,-kt,kt,xt,(kt+b*pe)/r[2]),Kt=new Float64Array(16);i.ad.mat4.multiply(Kt,Zt,nt);const ln=i.ad.vec3.fromValues(Math.floor(1e6*De[0])/1e6*N,Math.floor(1e6*De[1])/1e6*N,0),vt=.5*y,Ht=[0,0,0];i.ad.vec3.transformMat4(Ht,ln,Kt),i.ad.vec3.scale(Ht,Ht,vt);const mt=[Math.floor(Ht[0]),Math.floor(Ht[1]),Math.floor(Ht[2])],Gt=[0,0,0];i.ad.vec3.sub(Gt,Ht,mt),i.ad.vec3.scale(Gt,Gt,-1/vt);const Bt=new Float64Array(16);return i.ad.mat4.identity(Bt),i.ad.mat4.translate(Bt,Bt,Gt),i.ad.mat4.multiply(Kt,Bt,Kt),[Kt,kt]}class Du extends i.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(r,l){return i.aN(this.requestManager.transformRequest(l,i.R.Model).url).then(p=>{if(!p)return;const y=i.aO(p),b=new i.aP(r,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${r} from ${l}: ${p.message}`)))})}load(r,l,p={keepNumReferences:!1}){this.models[l]||(this.models[l]={});const y=Object.keys(r);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+y.length;const b=[];for(const S of y)b.push(this.loadModel(S,r[S]));Promise.allSettled(b).then(S=>{for(let L=0;L<S.length;L++){const{status:N,value:F}=S[L];if(N==="fulfilled"&&F){const B=this.models[l][y[L]];this.models[l][y[L]]={model:F,numReferences:p.keepNumReferences&&B?B.numReferences:1}}}this.numModelsLoading[l]-=y.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(S=>{this.fire(new i.z(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,l){return!!this.getModel(r,l)}getModel(r,l){return this.models[l]||(this.models[l]={}),this.models[l][r]?this.models[l][r].model:void 0}addModel(r,l,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={}),this.hasModel(r,p)&&this.models[p][r].numReferences++,this.modelUris[p][r]=this.requestManager.normalizeModelURL(l),this.load({[r]:this.modelUris[p][r]},p)}addModels(r,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const p=this.modelUris[l];for(const y in r)this.models[l][y]={},p[y]=this.requestManager.normalizeModelURL(r[y]);this.load(p,l,{keepNumReferences:!0})}reloadModels(r){this.load(this.modelUris[r],r)}addModelsFromBucket(r,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const p={};for(const y of r)this.hasModel(y,l)?this.models[l][y].numReferences++:(this.modelUris[l][y]=this.requestManager.normalizeModelURL(y),p[y]=this.modelUris[l][y]);this.load(p,l)}removeModel(r,l){if(this.models[l]&&this.models[l][r]&&(this.models[l][r].numReferences--,this.models[l][r].numReferences===0)){const p=this.models[l][r].model;delete this.models[l][r],delete this.modelUris[l][r],p.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,l){this.models[l]||(this.models[l]={});for(const p in this.models[l])this.models[l][p].model&&this.models[l][p].model.upload(r.context)}}const pa=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),Ao={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Ac(m){return m=m||{},Object.assign(m,Ao)}class Yl extends i.E{constructor(r){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=r,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=r.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=r.stylesheet.indoor.buildingFeaturesetId,this._scope=r.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:r=>(r.feature&&r.feature.properties.floorplan&&this.selectFloorplan(r.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(r){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(S,L){const[N,F]=S,{center:B,radius:H}=L,[W,ee]=B,ce=Math.abs(N-W);return Math.sqrt((ce>180?360-ce:ce)**2+(F-ee)**2)<=H}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=new i.P(this._map.transform.width/2,this._map.transform.height/2),y=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],b=this._map.queryRenderedFeatures(r?y:p,l);b.length>0&&(this._selectedFloorplan&&b[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=b[0],this._floorplanSelected(!1)))}_floorplanSelected(r){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(b){const[[S,L],[N,F]]=b,B=(N-S+360)%360,H=B>180?360-B:B;return{center:[(S+H/2+360)%360,(L+F)/2],radius:Math.sqrt(H**2+(F-L)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const l=this._floorplanStates[this._indoorData.id].selectedBuilding,p=this._floorplanStates[this._indoorData.id].selectedLevel;let y;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const b of this._indoorData.levels)b.id===this._selectedLevel.id&&(y=b.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:y})),l){const b=this._indoorData.buildings.find(S=>S.id===l);this._buildingSelected(b,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(p){const b=this._indoorData.levels.find(S=>S.id===p);this._updateLevels(b,r)}else r&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(r,l){l&&r&&r.extent&&this._map.fitBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=r?r.id:void 0;const p=this._indoorData.levels.filter(y=>r.levels.includes(y.id));this.fire(new i.A("buildingselected",{buildingId:r.id,levels:p}))}_levelSelected(r){if(r==="overview")this._updateLevels(void 0,!0);else{const l=this._indoorData.levels.find(p=>p.id===r);this._updateLevels(l,!0)}this.fire(new i.A("levelselected",{levelId:r==="overview"?void 0:r}))}_updateLevels(r,l){if(!r)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(l&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function p(F){const B=F.indexOf("/floor/");if(B===-1)return F;const H=B+7,W=F.indexOf("/",H);return W===-1?F.slice(H):F.slice(H,W)}this._selectedLevel=r,this._floorplanStates[this._indoorData.id].selectedLevel=r?r.id:void 0;const y=[],b={},S={},L={},N={};for(const F of this._indoorData.levels)if(y.push(F.id),b[F.id]=F.height,S[F.id]=F.base,r){if(this.mergeFloors){const B=p(r.id),H=p(F.id);L[F.id]=H===B?"true":"false"}else L[F.id]=F.id===r.id?"true":"false";N[F.id]=F.base<r.base?"true":"false"}else N[F.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",L]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",N]),r&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!r.isUnderground),l&&r.extent)){const F=this._map.cameraForBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),B=this._map.getZoom(),H=F.zoom?Math.abs(B-F.zoom):0;this._map.fitBounds(r.extent,H>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:B})}}selectFloorplan(r){const l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],y=this._map.queryRenderedFeatures(p,l);if(y.length>0){for(const b of y)if(JSON.parse(b.properties["indoor-data"]).floorplanIDs.includes(r)){this._selectedFloorplan=b,this._floorplanSelected(!0);break}}}selectBuilding(r){const l=this._indoorData.buildings.find(p=>p.id===r);this._buildingSelected(l,!0)}selectLevel(r){this._levelSelected(r)}}function Jl(m){if(!m.metadata||!m.metadata.content_area)return;const r=i.q.devicePixelRatio,{left:l,top:p,width:y,height:b}=m.metadata.content_area,S=l*r,L=p*r;return[S,L,S+y*r,L+b*r]}function Ec(m){if(m)return m.map(([r,l])=>[r*i.q.devicePixelRatio,l*i.q.devicePixelRatio])}class Cc{constructor(r,l){this.id=r,this.style=l}addIcons(r){const l=new Map;for(const[p,y]of r.entries()){const b=i.I.from({name:p,iconsetId:this.id});l.set(b,y)}this.style.addImages(l)}}const Qi=(m,r)=>wt(m,r&&r.filter(l=>l.identifier!=="source.canvas")),gd=i.aA(zr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Yo=i.aA(zr,["setCenter","setZoom","setBearing","setPitch"]),Jo=new Set(["background","sky","slot","custom"]),Nu={version:8,layers:[],sources:{}},ru={duration:300,delay:0};class Qo extends i.E{constructor(r,l={}){super(),this.map=r,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=i.l({},ru),this._buildingIndex=new fd(this),this.crossTileSymbolIndex=new Ws,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new On,this.dispatcher=l.dispatcher?l.dispatcher:new i.D(i.cj(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new cn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new i.ck(r._requestManager,l.localFontFamily?i.cl.all:l.localIdeographFontFamily?i.cl.ideographs:i.cl.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Du(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",i.cm());const p=this;this._rtlTextPluginCallback=Qo.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,S)=>{if(i.cn(b),S&&S.every(L=>L))for(const L in p._sourceCaches){const N=p._sourceCaches[L],F=N.getSource().type;F!=="vector"&&F!=="geojson"||N.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const L=this._layers[S];L.source===b.id&&this._validateLayer(L)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(i.f(r))return r;const l=i.co(r);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${i.cp(JSON.stringify(r))}`}_diffStyle(r,l,p){this.globalId=this._getGlobalId(r);const y=(b,S)=>{try{S(null,this.setState(b,p))}catch(L){S(L,!1)}};if(typeof r=="string"){const b=this.map._requestManager.normalizeStyleURL(r),S=this.map._requestManager.transformRequest(b,i.R.Style);i.n(S,(L,N)=>{L?this.fire(new i.z(L)):N&&y(N,l)})}else typeof r=="object"&&y(r,l)}loadURL(r,l={}){this.fire(new i.A("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!i.f(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,l.accessToken),this.resolvedImports.add(r);const y=this.importsCache.get(r);if(y)return this._load(y,p);const b=this.map._requestManager.transformRequest(r,i.R.Style);this._request=i.n(b,(S,L)=>{if(this._request=null,S)this.fire(new i.z(S));else if(L)return this.importsCache.set(r,L),this._load(L,p)})}loadJSON(r,l={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=i.q.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(Nu,!1)}_loadImports(r,l,p){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of r){const S=this._createFragmentStyle(b),L=new Promise(B=>{S.once("style.import.load",B),S.once("error",B)}).then(()=>this.mergeAll());if(y.push(L),this.resolvedImports.has(b.url)){S.loadEmpty();continue}const N=b.data||this.importsCache.get(b.url);N?(S.loadJSON(N,{validate:l}),this._isInternalStyle(N)&&(S.globalId=null)):b.url?S.loadURL(b.url,{validate:l}):S.loadEmpty();const F={style:S,id:b.id,config:b.config};if(p){const B=this.fragments.findIndex(({id:H})=>H===p);this.fragments=this.fragments.slice(0,B).concat(F).concat(this.fragments.slice(B))}else this.fragments.push(F)}return Promise.allSettled(y)}getImportGlobalIds(r=this,l=new Set){for(const p of r.fragments)p.style.globalId&&l.add(p.style.globalId),this.getImportGlobalIds(p.style,l);return[...l.values()]}_createFragmentStyle(r){const l=this.scope?i.C(r.id,this.scope):r.id;let p;const y=this._initialConfig&&this._initialConfig[l];(r.config||y)&&(p=i.l({},r.config,y));const b=new Qo(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,l){const p=r.indoor?Ac(r.schema):r.schema;if(this._isInternalStyle(r)){const S=i.l({},Nu,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(S,l)}if(this.updateConfig(this._config,p),l&&Qi(this,as(r)))return;this._loaded=!0,this.stylesheet=i.cq(r);const y=()=>{for(const F in r.sources)this.addSource(F,r.sources[F],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const F in r.iconsets)this.addIconset(F,r.iconsets[F]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(r.glyphs);const S=Mu(this.stylesheet.layers);if(this._order=S.map(F=>F.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const F=this.stylesheet.lights[0];this.light=new Mt(F.properties,F.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Mt(this.stylesheet.light)),this._layers={};for(const F of S){const B=i.cv(F,this.scope,this._styleColorTheme.lut,this.options);B.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B;const H=this.getOwnLayerSourceCache(B),W=!!this.directionalLight&&this.directionalLight.shadowsEnabled();H&&B.canCastShadows()&&W&&(H.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const L=this.stylesheet.terrain;L&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(L,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const N=this.isRootStyle();r.imports?this._loadImports(r.imports,l).then(()=>{this._reloadImports(),this.fire(new i.A(N?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(N?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const S=this._evaluateColorThemeData(b);this._loadColorTheme(S).then(()=>{y()}).catch(L=>{i.w(`Couldn't load color theme from the stylesheet: ${L}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,l,p,y,b,S,L,N,F,B;const H={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(W=>{if(W.stylesheet){if(W.light!=null&&(r=W.light),W.stylesheet.lights)for(const ee of W.stylesheet.lights)ee.type==="ambient"&&W.ambientLight!=null&&(l=W.ambientLight),ee.type==="directional"&&W.directionalLight!=null&&(p=W.directionalLight);y=this._prioritizeTerrain(y,W.terrain,W.stylesheet.terrain),W.stylesheet.fog&&W.fog!=null&&(b=W.fog),W.stylesheet.snow&&W.snow!=null&&(S=W.snow),W.stylesheet.rain&&W.rain!=null&&(L=W.rain),W.stylesheet.camera!=null&&(B=W.stylesheet.camera),W.stylesheet.projection!=null&&(N=W.stylesheet.projection),W.stylesheet.transition!=null&&(F=W.stylesheet.transition),H[W.scope]=W._styleColorTheme}}),this.light=r,this.ambientLight=l,this.directionalLight=p,this.fog=b,this.snow=S,this.rain=L,this._styleColorThemeForScope=H,y===null?delete this.terrain:this.terrain=y,this.camera=B||{"camera-projection":"perspective"},this.projection=N||{name:"mercator"},this.transition=i.l({},ru,F),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const l=p=>{for(const y of p.fragments)l(y.style);r(p)};l(this)}_prioritizeTerrain(r,l,p){const y=r&&r.drapeRenderMode===0;return p===null?l&&l.drapeRenderMode===0?l:y?r:null:l!=null&&(!r||y||l&&l.drapeRenderMode===1)?l:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{r=this._prioritizeTerrain(r,l.terrain,l.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(r=l.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},l={},p={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const S=i.C(b,y.scope);r[S]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const S=i.C(b,y.scope);l[S]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const S=i.C(b,y.scope);p[S]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=p}mergeLayers(){const r={},l=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const S of b._order){const L=b._layers[S];if(L.type==="slot"){const N=i.cr(S);if(r[N])continue;r[N]=[]}L.slot&&r[L.slot]?r[L.slot].push(L):l.push(L)}}),this._mergedOrder=[];const y=(b=[])=>{for(const S of b)if(S.type==="slot"){const L=i.cr(S.id);r[L]&&y(r[L]),this._mergedSlots.push(L)}else{const L=i.C(S.id,S.scope);this._mergedOrder.push(L),p[L]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};y(l),this._mergedOrder.sort((b,S)=>{const L=p[b],N=p[S];return L.hasInitialOcclusionOpacityProperties?N.is3D(!!this.terrain)?1:0:L.is3D(!!this.terrain)&&N.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=i.l({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(l,p,y){const b=i.l({},p);for(const L of Object.keys(i.a5.colorTheme))b[L]===void 0&&(b[L]=i.a5.colorTheme[L].default);const S=new i.a6(pa,l,new Map(y));return S.setTransitionOrValue(b,y),S.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{const b="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let S=r;S.startsWith(b)||(S=b+S);const L=i.I.from("mapbox-reserved-lut"),N=new Image;N.src=S,N.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},N.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void p();this._styleColorTheme.lutLoading=!1;const{width:F,height:B,data:H}=i.q.getImageData(N);if(B>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(F!==B*B)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(L)&&this.removeImage(L),this.addImage(L,{data:new i.r({width:F,height:B},H),pixelRatio:1,sdf:!1,usvg:!1,version:0});const W=this.imageManager.getImage(L,this.scope);W?(this._styleColorTheme.lut={image:W.data,data:r},p()):y(new Error("Missing LUT image."))}})}getLut(r){const l=this._styleColorThemeForScope[r];return l?l.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(l,p,y){let b,S,L;const N=i.q.devicePixelRatio>1?"@2x":"";let F=i.n(p.transformRequest(p.normalizeSpriteURL(l,N,".json"),i.R.SpriteJSON),(W,ee)=>{F=null,L||(L=W,b=ee,H())}),B=i.o(p.transformRequest(p.normalizeSpriteURL(l,N,".png"),i.R.SpriteImage),(W,ee)=>{B=null,L||(L=W,S=ee,H())});function H(){if(L)y(L);else if(b&&S){const W=i.q.getImageData(S),ee={};for(const ce in b){const{width:oe,height:fe,x:pe,y:Te,sdf:De,pixelRatio:Ie,stretchX:Ge,stretchY:Be,content:je}=b[ce],Ue=new i.r({width:oe,height:fe});i.r.copy(W,Ue,{x:pe,y:Te},{x:0,y:0},{width:oe,height:fe},null),ee[ce]={data:Ue,pixelRatio:Ie,sdf:De,stretchX:Ge,stretchY:Be,content:je,usvg:!1}}y(null,ee)}}return{cancel(){F&&(F.cancel(),F=null),B&&(B.cancel(),B=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new i.z(l));else if(p){const y=new Map;for(const b in p)y.set(i.I.from(b),p[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(r,l){if(l.type==="sprite")return void this._loadSprite(l.url);const p=this.getOwnSource(l.source);if(!p)return void this.fire(new i.z(new Error(`Source "${l.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));if(p.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${l.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,r);const y=new Cc(r,this);p.addIconset(r,y)}_loadIconset(r){if(!i.f(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const l=this.map._spriteFormat==="auto";var p,y;this._spriteRequest=(y=(b,S)=>{if(this._spriteRequest=null,b)l?this._loadSprite(r):this.fire(new i.z(b));else if(S){const L=new Map;for(const N in S)L.set(i.I.from(N),S[N]);this.addImages(L)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.bj((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(r),i.R.Iconset),(b,S)=>{if(b)return void y(b);const L={},N=i.ch(new i.bi(S));for(const F of N.icons){const B={version:1,pixelRatio:i.q.devicePixelRatio,content:Jl(F),stretchX:F.metadata?Ec(F.metadata.stretch_x_areas):void 0,stretchY:F.metadata?Ec(F.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:F};L[F.name]=B}y(null,L)}))}_validateLayer(r){const l=this.getOwnSource(r.source);if(!l)return;const p=r.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new i.z(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,l)=>{const p=this.fragments[l];return p&&p.style&&(r.data=p.style.serialize()),r})}_serializeSources(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return r}_serializeLayers(r){const l=[];for(const p of r){const y=this._layers[p];y&&y.type!=="custom"&&l.push(y.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const l=this.getOwnLayer(r);if(l)return l;this.fire(new i.z(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const l=this.getOwnSource(r);if(l)return l;this.fire(new i.z(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,l){const p=this.map.painter;if(p)for(let y=r.minzoom||0;y<(r.maxzoom||25.5);y++){const b=r.getProgramIds();if(b)for(const S of b){const L=r.getDefaultProgramParams(S,l.zoom,this._styleColorTheme.lut);L&&(p.style=this,this.fog&&(p._fogVisible=!0,L.overrideFog=!0,p.getOrCreateProgram(S,L)),p._fogVisible=!1,L.overrideFog=!1,p.getOrCreateProgram(S,L),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(L.overrideRtt=!0,p.getOrCreateProgram(S,L)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const l=this.calculateLightsBrightness();r.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));const p=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const L in S){const{updatedIds:N,removedIds:F}=S[L];(N||F)&&(this._updateWorkerLayers(L,N,F),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const b={};for(const S in this._mergedSourceCaches){const L=this._mergedSourceCaches[S];b[S]=L.used,L.used=!1,L.tileCoverLift=0}for(const S of this._mergedOrder){const L=this._mergedLayers[S];if(L.recalculate(r,this._availableImages),!L.isHidden(r.zoom)){const N=this.getLayerSourceCache(L);N&&(N.used=!0,N.tileCoverLift=Math.max(N.tileCoverLift,L.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(L,r)}):this.precompilePrograms(L,r))}for(const S in this._mergedSourceCaches){const L=this._mergedSourceCaches[S];if(!L)continue;const N=L._source;N.type==="raster-array"&&N.iconsets&&(L.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();for(const S in b){const L=this._mergedSourceCaches[S];b[S]!==L.used&&L.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:L.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new i.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=this._changes.getUpdatedImages();if(r.length){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,l,p){const y=this.getFragmentStyle(r);y&&this.dispatcher.broadcast("updateLayers",{layers:l?y._serializeLayers(l):[],scope:r,removedIds:p||[],options:y.options})}setState(r,l){if(this._checkLoaded(),Qi(this,as(r)))return!1;(r=i.cq(r)).layers=Mu(r.layers);const p=function(S,L){if(!S)return[{command:zr.setStyle,args:[L]}];let N=[];try{if(!i.bn(S.version,L.version))return[{command:zr.setStyle,args:[L]}];if(i.bn(S.center,L.center)||N.push({command:zr.setCenter,args:[L.center]}),i.bn(S.zoom,L.zoom)||N.push({command:zr.setZoom,args:[L.zoom]}),i.bn(S.bearing,L.bearing)||N.push({command:zr.setBearing,args:[L.bearing]}),i.bn(S.pitch,L.pitch)||N.push({command:zr.setPitch,args:[L.pitch]}),i.bn(S.sprite,L.sprite)||N.push({command:zr.setSprite,args:[L.sprite]}),i.bn(S.glyphs,L.glyphs)||N.push({command:zr.setGlyphs,args:[L.glyphs]}),i.bn(S.imports,L.imports)||function(ee=[],ce=[],oe){ce=ce||[];const fe=(ee=ee||[]).map(Dr),pe=ce.map(Dr),Te=ee.reduce(no,{}),De=ce.reduce(no,{}),Ie=fe.slice();let Ge,Be,je,Ue;for(Ge=0,Be=0;Ge<fe.length;Ge++)je=fe[Ge],De.hasOwnProperty(je)?Be++:(oe.push({command:zr.removeImport,args:[je]}),Ie.splice(Ie.indexOf(je,Be),1));for(Ge=0,Be=0;Ge<pe.length;Ge++)je=pe[pe.length-1-Ge],Ie[Ie.length-1-Ge]!==je&&(Te.hasOwnProperty(je)?(oe.push({command:zr.removeImport,args:[je]}),Ie.splice(Ie.lastIndexOf(je,Ie.length-Be),1)):Be++,Ue=Ie[Ie.length-Ge],oe.push({command:zr.addImport,args:[De[je],Ue]}),Ie.splice(Ie.length-Ge,0,je));for(const Ke of ce){const nt=Te[Ke.id];nt&&!i.bn(nt,Ke)&&oe.push({command:zr.updateImport,args:[Ke.id,Ke]})}}(S.imports,L.imports,N),i.bn(S.transition,L.transition)||N.push({command:zr.setTransition,args:[L.transition]}),i.bn(S.light,L.light)||N.push({command:zr.setLight,args:[L.light]}),i.bn(S.fog,L.fog)||N.push({command:zr.setFog,args:[L.fog]}),i.bn(S.snow,L.snow)||N.push({command:zr.setSnow,args:[L.snow]}),i.bn(S.rain,L.rain)||N.push({command:zr.setRain,args:[L.rain]}),i.bn(S.projection,L.projection)||N.push({command:zr.setProjection,args:[L.projection]}),i.bn(S.lights,L.lights)||N.push({command:zr.setLights,args:[L.lights]}),i.bn(S.camera,L.camera)||N.push({command:zr.setCamera,args:[L.camera]}),!i.bn(S["color-theme"],L["color-theme"]))return[{command:zr.setStyle,args:[L]}];const F={},B=[];(function(ee,ce,oe,fe){let pe;for(pe in ce=ce||{},ee=ee||{})ee.hasOwnProperty(pe)&&(ce.hasOwnProperty(pe)||Iu(pe,oe,fe));for(pe in ce){if(!ce.hasOwnProperty(pe))continue;const Te=ce[pe];ee.hasOwnProperty(pe)?i.bn(ee[pe],Te)||(ee[pe].type==="geojson"&&Te.type==="geojson"&&In(ee,ce,pe)?oe.push({command:zr.setGeoJSONSourceData,args:[pe,Te.data]}):vc(pe,ce,oe,fe)):Ns(pe,ce,oe)}})(S.sources,L.sources,B,F);const H=[];S.layers&&S.layers.forEach(ee=>{ee.source&&F[ee.source]?N.push({command:zr.removeLayer,args:[ee.id]}):H.push(ee)});let W=S.terrain;W&&F[W.source]&&(N.push({command:zr.setTerrain,args:[void 0]}),W=void 0),N=N.concat(B),i.bn(W,L.terrain)||N.push({command:zr.setTerrain,args:[L.terrain]}),function(ee,ce,oe){ce=ce||[];const fe=(ee=ee||[]).map(Dr),pe=ce.map(Dr),Te=ee.reduce(no,{}),De=ce.reduce(no,{}),Ie=fe.slice(),Ge=Object.create(null);let Be,je,Ue,Ke,nt,kt,xt;for(Be=0,je=0;Be<fe.length;Be++)Ue=fe[Be],De.hasOwnProperty(Ue)?je++:(oe.push({command:zr.removeLayer,args:[Ue]}),Ie.splice(Ie.indexOf(Ue,je),1));for(Be=0,je=0;Be<pe.length;Be++)Ue=pe[pe.length-1-Be],Ie[Ie.length-1-Be]!==Ue&&(Te.hasOwnProperty(Ue)?(oe.push({command:zr.removeLayer,args:[Ue]}),Ie.splice(Ie.lastIndexOf(Ue,Ie.length-je),1)):je++,kt=Ie[Ie.length-Be],oe.push({command:zr.addLayer,args:[De[Ue],kt]}),Ie.splice(Ie.length-Be,0,Ue),Ge[Ue]=!0);for(Be=0;Be<pe.length;Be++)if(Ue=pe[Be],Ke=Te[Ue],nt=De[Ue],!Ge[Ue]&&!i.bn(Ke,nt))if(i.bn(Ke.source,nt.source)&&i.bn(Ke["source-layer"],nt["source-layer"])&&i.bn(Ke.type,nt.type)){for(xt in Fr(Ke.layout,nt.layout,oe,Ue,null,zr.setLayoutProperty),Fr(Ke.paint,nt.paint,oe,Ue,null,zr.setPaintProperty),i.bn(Ke.slot,nt.slot)||oe.push({command:zr.setSlot,args:[Ue,nt.slot]}),i.bn(Ke.filter,nt.filter)||oe.push({command:zr.setFilter,args:[Ue,nt.filter]}),i.bn(Ke.minzoom,nt.minzoom)&&i.bn(Ke.maxzoom,nt.maxzoom)||oe.push({command:zr.setLayerZoomRange,args:[Ue,nt.minzoom,nt.maxzoom]}),Ke)Ke.hasOwnProperty(xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&xt!=="slot"&&(xt.indexOf("paint.")===0?Fr(Ke[xt],nt[xt],oe,Ue,xt.slice(6),zr.setPaintProperty):i.bn(Ke[xt],nt[xt])||oe.push({command:zr.setLayerProperty,args:[Ue,xt,nt[xt]]}));for(xt in nt)nt.hasOwnProperty(xt)&&!Ke.hasOwnProperty(xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&xt!=="slot"&&(xt.indexOf("paint.")===0?Fr(Ke[xt],nt[xt],oe,Ue,xt.slice(6),zr.setPaintProperty):i.bn(Ke[xt],nt[xt])||oe.push({command:zr.setLayerProperty,args:[Ue,xt,nt[xt]]}))}else oe.push({command:zr.removeLayer,args:[Ue]}),kt=Ie[Ie.lastIndexOf(Ue)+1],oe.push({command:zr.addLayer,args:[nt,kt]})}(H,L.layers,N)}catch(F){console.warn("Unable to compute style diff:",F),N=[{command:zr.setStyle,args:[L]}]}return N}(this.serialize(),r).filter(S=>!(S.command in Yo));if(p.length===0)return!1;const y=p.filter(S=>!(S.command in gd));if(y.length>0)throw new Error(`Unimplemented: ${y.map(S=>S.command).join(", ")}.`);const b=[];return p.forEach(S=>{b.push(this[S.command].apply(this,S.args))}),l&&Promise.all(b).then(l),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(r){for(const[l,p]of r.entries()){if(this.getImage(l)&&!l.iconsetId)return this.fire(new i.z(new Error(`An image with the name "${l.name}" already exists.`)));this.imageManager.addImage(l,this.scope,p),this._changes.updateImage(l)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(r,l){return this.getImage(r)&&!r.iconsetId?this.fire(new i.z(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,l),this._changes.updateImage(r),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(r,l,p=!1){this.imageManager.updateImage(r,this.scope,l),p&&(this._changes.updateImage(r),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,l,p={}){return this._checkLoaded(),this._validate(qe,`models.${r}`,l,null,p)||(this.modelManager.addModel(r,l,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,l,p={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Ho,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const y=Eu(r,l,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=S=>{const L=(S?"symbol:":"other:")+y.id,N=i.C(L,this.scope),F=this._sourceCaches[L]=new So(N,y,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=F,F.onAdd(this.map)};b(!1),l.type!=="vector"&&l.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const l=this.getOwnSource(r);if(!l)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===r)return this.fire(new i.z(new Error(`Source "${r}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new i.z(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(r);for(const y of p){const b=i.cr(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getOwnSource(r).setData(l),this._changes.setDirty()}getOwnSource(r){const l=this.getOwnSourceCache(r);return l&&l.getSource()}getOwnSources(){const r=[];for(const l in this._otherSourceCaches){const p=this.getOwnSourceCache(l);p&&r.push(p.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const l in r){const p=r[l]._tiles;for(const y in p){const b=p[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const y of r){if(this._validate(Rr,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(y),b.updateTransitions(l)}else this.ambientLight=new Oi(y,mr||(mr=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(y),b.updateTransitions(l)}else this.directionalLight=new Oi(y,Vr||(Vr=new i.a7({direction:new i.am(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=new i.aa(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,l=this.ambientLight;if(!r||!l)return;const p=W=>.2126*(W[0]<=.03928?W[0]/12.92:Math.pow((W[0]+.055)/1.055,2.4))+.7152*(W[1]<=.03928?W[1]/12.92:Math.pow((W[1]+.055)/1.055,2.4))+.0722*(W[2]<=.03928?W[2]/12.92:Math.pow((W[2]+.055)/1.055,2.4)),y=r.properties.get("color").toRenderColor(null).toArray01(),b=r.properties.get("intensity"),S=r.properties.get("direction"),L=1-i.cc(S.x,S.y,S.z)[2]/90,N=p(y)*b*L,F=l.properties.get("color").toRenderColor(null).toArray01(),B=l.properties.get("intensity"),H=p(F)*B;return Number(((N+H)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(i.cs(r)){const l=i.ct(r),p=this.fragments.find(({id:b})=>b===l);if(!p)throw new Error(`Style import '${r}' not found`);const y=i.cr(r);return p.style.getFragmentStyle(y)}{const l=this.fragments.find(({id:p})=>p===r);return l?l.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const l={},p=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in r){const b=this._featuresetSelectors[y]=[];for(const S of r[y].selectors){if(S.featureNamespace){const N=this.getOwnLayer(S.layer);if(!N){i.w(`Layer is undefined for selector: ${S.layer}`);continue}const F=p(N.source,N.sourceLayer);if(F in l&&l[F]!==S.featureNamespace){i.w(`"featureNamespace ${S.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}l[F]=S.featureNamespace}let L;if(S.properties)for(const N in S.properties){const F=i.X(S.properties[N]);F.result==="success"&&(L=L||{},L[N]=F.value)}b.push({layerId:S.layer,namespace:S.featureNamespace,properties:L,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const l=this.getFragmentStyle(r);if(!l||!l.stylesheet.featuresets)return[];const p=[];for(const y in l.stylesheet.featuresets)p.push({featuresetId:y,importId:l.scope?l.scope:void 0});return p}getFeaturesetLayers(r,l){const p=this.getFragmentStyle(l),y=p.stylesheet.featuresets;if(!y||!y[r])return this.fire(new i.z(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const S of y[r].selectors){const L=p.getOwnLayer(S.layer);L&&b.push(L)}return b}getConfigProperty(r,l){const p=this.getFragmentStyle(r);if(!p)return null;const y=i.C(l,p.scope),b=p.options.get(y),S=b?b.value||b.default:null;return S?S.serialize():null}setConfigProperty(r,l,p){const y=this.getFragmentStyle(r);if(!y)return;const b=y.stylesheet.indoor?Ac(y.stylesheet.schema):y.stylesheet.schema;if(!b||!b[l])return;const S=i.X(p);if(S.result!=="success")return void Qi(this,S.value);const L=S.value.expression,N=i.C(l,y.scope),F=y.options.get(N);if(!F)return;let B;const{minValue:H,maxValue:W,stepValue:ee,type:ce,values:oe}=b[l],fe=i.X(b[l].default);fe.result==="success"&&(B=fe.value.expression),B?(this.options.set(N,Object.assign({},F,{value:L,default:B,minValue:H,maxValue:W,stepValue:ee,type:ce,values:oe})),this.updateConfigDependencies(l)):this.fire(new i.z(new Error(`No schema defined for the config option "${l}" in the "${r}" fragment.`)))}getConfig(r){const l=this.getFragmentStyle(r);if(!l)return null;const p=l.stylesheet.schema;if(!p)return null;const y={};for(const b in p){const S=i.C(b,l.scope),L=l.options.get(S),N=L?L.value||L.default:null;y[b]=N?N.serialize():null}return y}setConfig(r,l){const p=this.getFragmentStyle(r);p&&(p.updateConfig(l,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const l=this.getFragmentStyle(r);return l?l.stylesheet.schema:null}setSchema(r,l){const p=this.getFragmentStyle(r);p&&(p.stylesheet.schema=l,p.updateConfig(p._config,l),this.updateConfigDependencies())}updateConfig(r,l){if(this._config=r,r||l)if(l)for(const p in l){let y,b;const S=i.X(l[p].default);if(S.result==="success"&&(y=S.value.expression),r&&r[p]!==void 0){const W=i.X(r[p]);W.result==="success"&&(b=W.value.expression)}const{minValue:L,maxValue:N,stepValue:F,type:B,values:H}=l[p];if(y){const W=i.C(p,this.scope);this.options.set(W,{default:y,value:b,minValue:L,maxValue:N,stepValue:F,type:B,values:H})}else this.fire(new i.z(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const l of this._configDependentLayers){const p=this.getLayer(l);if(p){if(r&&!p.configDependencies.has(r))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const p=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(p){const y=l._evaluateColorThemeData(p);(!l._styleColorTheme.lut&&y!==""||l._styleColorTheme.lut&&y!==l._styleColorTheme.lut.data)&&l.setColorTheme(p)}}),this._changes.setDirty()}addLayer(r,l,p={}){this._checkLoaded();const y=r.id;if(this._layers[y])return void this.fire(new i.z(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(r.type==="custom"){if(Qi(this,i.cu(r)))return;b=i.cv(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(y,r.source),r=i.cq(r),r=i.l(r,{source:y})),this._validate(he,`layers.${y}`,r,{arrayIndex:-1},p))return;b=i.cv(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let S=this._order.length;if(l){const B=this._order.indexOf(l);if(B===-1)return void this.fire(new i.z(new Error(`Layer with id "${l}" does not exist on this map.`)));b.slot===this._layers[l].slot?S=B:i.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const L=this.getOwnLayerSourceCache(b),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&b.canCastShadows()&&N&&(L.castsShadows=!0);const F=this._changes.getRemovedLayer(b);if(F&&b.source&&L&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const B=i.C(b.source,b.scope);F.type!==b.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),L.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(r,l){this._checkLoaded();const p=this._checkLayer(r);if(!p||r===l)return;const y=this._order.indexOf(r);this._order.splice(y,1);let b=this._order.length;if(l){const S=this._order.indexOf(l);if(S===-1)return void this.fire(new i.z(new Error(`Layer with id "${l}" does not exist on this map.`)));p.slot===this._layers[l].slot?b=S:i.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const l=this._checkLayer(r);if(!l)return;l.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const y=this.getOwnLayerSourceCache(l);if(y&&y.castsShadows){let b=!1;for(const S in this._layers)if(this._layers[S].source===l.source&&this._layers[S].canCastShadows()){b=!0;break}y.castsShadows=b}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const y=this._checkLayer(r);y&&(y.minzoom===l&&y.maxzoom===p||(l!=null&&(y.minzoom=l),p!=null&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,l){this._checkLoaded();const p=this._checkLayer(r);p&&p.slot!==l&&(p.slot=l,this._updateLayer(p))}setFilter(r,l,p={}){this._checkLoaded();const y=this._checkLayer(r);if(y&&!i.bn(y.filter,l))return l==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(_e,`layers.${y.id}.filter`,l,{layerType:y.type},p)||(y.filter=i.cq(l),this._updateLayer(y)))}getFilter(r){const l=this._checkLayer(r);if(l)return i.cq(l.filter)}setLayoutProperty(r,l,p,y={}){this._checkLoaded();const b=this._checkLayer(r);if(b&&!i.bn(b.getLayoutProperty(l),p)){if(p!=null&&(!y||y.validate!==!1)&&Qi(b,Ye.call(as,{key:`layers.${r}.layout.${l}`,layerType:b.type,objectKey:l,value:p,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(l,p),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(r,l){const p=this._checkLayer(r);if(p)return p.getLayoutProperty(l)}setPaintProperty(r,l,p,y={}){this._checkLoaded();const b=this._checkLayer(r);if(!b||i.bn(b.getPaintProperty(l),p)||p!=null&&(!y||y.validate!==!1)&&Qi(b,Oe.call(as,{key:`layers.${r}.paint.${l}`,layerType:b.type,objectKey:l,value:p,styleSpec:i.a5})))return;const S=b.setPaintProperty(l,p);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),S&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(r,l){const p=this._checkLayer(r);if(p)return p.getPaintProperty(l)}setFeatureState(r,l){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:N,importId:F}=r.target,B=this.getFragmentStyle(F),H=B.getFeaturesetLayers(N);for(const{source:W,sourceLayer:ee}of H)B.setFeatureState({id:r.id,source:W,sourceLayer:ee},l)}else if("layerId"in r.target){const{layerId:N}=r.target,F=this.getLayer(N);this.setFeatureState({id:r.id,source:F.source,sourceLayer:F.sourceLayer},l)}return}const p=r.source,y=r.sourceLayer,b=this._checkSource(p);if(!b)return;const S=b.type;if(S==="geojson"&&y)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!y)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const L=this.getOwnSourceCaches(p);for(const N of L)N.setFeatureState(y,r.id,l)}removeFeatureState(r,l){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:N,importId:F}=r.target,B=this.getFragmentStyle(F),H=B.getFeaturesetLayers(N);for(const{source:W,sourceLayer:ee}of H)B.removeFeatureState({id:r.id,source:W,sourceLayer:ee},l)}else if("layerId"in r.target){const{layerId:N}=r.target,F=this.getLayer(N);this.removeFeatureState({id:r.id,source:F.source,sourceLayer:F.sourceLayer},l)}return}const p=r.source,y=this._checkSource(p);if(!y)return;const b=y.type,S=b==="vector"?r.sourceLayer:void 0;if(b==="vector"&&!S)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const L=this.getOwnSourceCaches(p);for(const N of L)N.removeFeatureState(S,r.id,l)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let b;if("featuresetId"in r.target){const{featuresetId:S,importId:L}=r.target,N=this.getFragmentStyle(L),F=N.getFeaturesetLayers(S);for(const{source:B,sourceLayer:H}of F){const W=N.getFeatureState({id:r.id,source:B,sourceLayer:H});if(W&&!b)b=W;else if(!i.bn(b,W))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:S}=r.target,L=this.getLayer(S);b=this.getFeatureState({id:r.id,source:L.source,sourceLayer:L.sourceLayer})}return b}const l=r.source,p=r.sourceLayer,y=this._checkSource(l);if(y){if(y.type!=="vector"||p)return r.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=i.l({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),l=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return i.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(r){for(const l of Object.values(this._mergedLayers))r(l)&&this._updateLayer(l)}_updateLayer(r){this._changes.updateLayer(r);const l=this.getLayerSourceCache(r),p=i.C(r.source,r.scope),y=this._changes.getUpdatedSourceCaches();r.source&&!y[p]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),l.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=L=>this._mergedLayers[L].is3D(!!this.terrain),p=this.order,y={},b=[];for(let L=p.length-1;L>=0;L--){const N=p[L];if(l(N)){y[N]=L;for(const F of r){const B=F[N];if(B)for(const H of B)b.push(H)}}}b.sort((L,N)=>N.intersectionZ-L.intersectionZ);const S=[];for(let L=p.length-1;L>=0;L--){const N=p[L];if(l(N))for(let F=b.length-1;F>=0;F--){const B=b[F].feature;if(B.layer&&y[B.layer.id]<L)break;S.push(B),b.pop()}else for(const F of r){const B=F[N];if(B)for(const H of B)S.push(H.feature)}}return S}queryRenderedFeatures(r,l,p){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(_e,"queryRenderedFeatures.filter",l.filter,null,l),y=i.a_(l.filter));const b={},S=B=>{if(Jo.has(B.type))return;const H=this.getOwnLayerSourceCache(B),W=b[H.id]=b[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};B.is3D(!!this.terrain)&&(W.has3DLayers=!0),W.layers[B.fqid]=W.layers[B.fqid]||{styleLayer:B,targets:[]},W.layers[B.fqid].targets.push({filter:y})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const B of l.layers){const H=this._layers[B];if(!H)return this.fire(new i.z(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];S(H)}}else for(const B in this._layers)S(this._layers[B]);const L=this._queryRenderedFeatures(r,b,p),N=this._flattenAndSortRenderedFeatures(L),F=[];for(const B of N)i.ct(B.layer.id)===this.scope&&F.push(B);return F}queryRenderedFeatureset(r,l,p){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(_e,"queryRenderedFeatures.filter",l.filter,null,l),y=i.a_(l.filter));const b="mock",S=[];if(l&&l.target)S.push(Object.assign({},l,{targetId:b,filter:y}));else{const B=this.getFeaturesetDescriptors();for(const H of B)S.push({targetId:b,filter:y,target:H});for(const{style:H}of this.fragments){const W=H.getFeaturesetDescriptors();for(const ee of W)S.push({targetId:b,filter:y,target:ee})}}const L=this.queryRenderedTargets(r,S,p),N=[],F=new Set;for(const B of L)for(const H of B.variants[b])Gl(H,B,F)||N.push(new i.cx(B,H));return N}queryRenderedTargets(r,l,p){const y={},b=(L,N,F,B)=>{const H=y[N.id]=y[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};if(H.layers[L.fqid]=H.layers[L.fqid]||{styleLayer:L,targets:[]},L.is3D(!!this.terrain)&&(H.has3DLayers=!0),!B)return F.uniqueFeatureID=!1,void H.layers[L.fqid].targets.push(F);H.layers[L.fqid].targets.push(Object.assign({},F,{namespace:B.namespace,properties:B.properties,uniqueFeatureID:B.uniqueFeatureID}))};for(const L of l)if("featuresetId"in L.target){const{featuresetId:N,importId:F}=L.target,B=this.getFragmentStyle(F);if(!B||!B._featuresetSelectors)continue;const H=B._featuresetSelectors[N];if(!H){this.fire(new i.z(new Error(`The featureset '${N}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const W of H){const ee=B.getOwnLayer(W.layerId);ee&&!Jo.has(ee.type)&&b(ee,B.getOwnLayerSourceCache(ee),L,W)}}else if("layerId"in L.target){const{layerId:N}=L.target,F=this.getLayer(N);if(!F||Jo.has(F.type))continue;b(F,this.getLayerSourceCache(F),L)}const S=this._queryRenderedFeatures(r,y,p);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(r,l,p){const y=[],b=!!this.map._showQueryGeometry,S=ms.createFromScreenPoints(r,p);for(const L in l){const N=dd(S,l[L],this._availableImages,p,b);Object.keys(N).length&&y.push(N)}if(this.placement)for(const L in l){if(!l[L].sourceCache._onlySymbols)continue;const N=Ba(S.screenGeometry,l[L],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(N).length&&y.push(N)}return y}querySourceFeatures(r,l){const p=l&&l.filter;p&&this._validate(_e,"querySourceFeatures.filter",p,null,l);let y=[];const b=this.getOwnSourceCaches(r);for(const S of b)y=y.concat(Cu(S,l));return y}addSourceType(r,l,p){return Qo.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Qo.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,l,p={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const L in r)if(!i.bn(r[L],y[L])){b=!0;break}if(!b)return;const S=this._getTransitionParameters();this.light.setLight(r,l,p),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,l=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=r;const y=r.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const L="terrain-dem-src";this.addSource(L,p.source),p=i.cq(p),p=i.l(p,{source:L})}const b=i.l({},p),S={};if(this.terrain&&y){b.source=this.terrain.get().source;const L=this.terrain?this.getFragmentStyle(this.terrain.scope):null;L&&(S.style=L.serialize())}if(this._validate(Ii,"terrain",b,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l),this.fire(new i.A("data",{dataType:"style"}))}else{const b=this.terrain,S=b.get();for(const L of Object.keys(i.a5.terrain))!p.hasOwnProperty(L)&&i.a5.terrain[L].default&&(p[L]=i.a5.terrain[L].default);for(const L in r)if(!i.bn(r[L],S[L])){b.set(r,this.options),this.stylesheet.terrain=r;const N=this._getTransitionParameters({duration:0});b.updateTransitions(N),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new ur(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_createSnow(r){const l=this.snow=new Xr(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_createRain(r){const l=this.rain=new ti(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!i.bn(l.get(),r)){l.set(r,this.options),this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!i.bn(l.get(),r)){l.set(r,this.options),this.stylesheet.snow=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!i.bn(l.get(),r)){l.set(r,this.options),this.stylesheet.rain=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void r();const p=this._evaluateColorThemeData(l);this._loadColorTheme(p).then(()=>{this.fire(new i.A("colorthemeset")),r()}).catch(y=>{i.w(`Couldn't set color theme: ${y}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,l){const p=this.getFragmentStyle(r);p&&(p._styleColorTheme.colorThemeOverride=l,p._reloadColorTheme())}_getTransitionParameters(r){return{now:i.q.now(),transition:i.l(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],l=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?r.push(p):l.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const p=this.terrain=new Nt(r,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,p,y,b={}){if(b&&b.validate===!1)return!1;const S=i.l({},this.serialize());return Qi(this,r.call(as,i.l({key:l,style:S,value:p,styleSpec:i.a5},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){const l=this.getSourceCaches(r);for(const p of l)p.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const l=this.getSourceCaches(r);for(const p of l)p.resume(),p.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let l;this.directionalLight&&(l=bl(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(r,void 0,void 0,l)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,y,b,S,L=!1){let N=!1,F=!1;const B={},H={};for(const W of this._mergedOrder){const ee=this._mergedLayers[W];if(ee.type!=="symbol")continue;const ce=i.C(ee.source,ee.scope);let oe=B[ce];if(!oe){const pe=this.getLayerSourceCache(ee);if(!pe)continue;const Te=pe.getRenderableIds(!0).map(De=>pe.getTileByID(De));H[ce]=Te.slice(),oe=B[ce]=Te.sort((De,Ie)=>Ie.tileID.overscaledZ-De.tileID.overscaledZ||(De.tileID.isLessThan(Ie.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(ee,oe,l.center.lng,l.projection);N=N||fe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),L=L||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(L||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),l.zoom))&&(this.pauseablePlacement=new Mr(l,this._mergedOrder,L,p,y,b,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,H,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),F=!0),N&&this.pauseablePlacement.placement.setStale()),F||N){this._buildingIndex.onNewFrame(l.zoom);for(let W=0;W<this._mergedOrder.length;W++){const ee=this._mergedLayers[this._mergedOrder[W]];if(ee.type!=="symbol")continue;const ce=this.isLayerClipped(ee);this.placement.updateLayerOpacities(ee,B[i.C(ee.source,ee.scope)],W,ce?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,l){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===r.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!l)return p.push(r),this._loadImports([r],!0);const y=p.findIndex(({id:b})=>b===l);return y===-1&&this.fire(new i.z(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(r).concat(p.slice(y)),this._loadImports([r],!0,l)}updateImport(r,l){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(r);return y===-1?this:typeof l=="string"?(this.setImportUrl(r,l),this):(l.url&&l.url!==p[y].url&&this.setImportUrl(r,l.url),i.bn(l.config,p[y].config)||this.setImportConfig(r,l.config,l.data.schema),i.bn(l.data,p[y].data)||this.setImportData(r,l.data),this)}moveImport(r,l){this._checkLoaded();let p=this.stylesheet.imports||[];const y=this.getImportIndex(r);if(y===-1)return this;const b=this.getImportIndex(l);if(b===-1)return this;const S=p[y],L=this.fragments[y];return p=p.filter(({id:N})=>N!==r),this.fragments=this.fragments.filter(({id:N})=>N!==r),this.stylesheet.imports=p.slice(0,b).concat(S).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(L).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(r,l){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(r);if(y===-1)return this;p[y].url=l;const b=this.fragments[y];return b.style=this._createFragmentStyle(p[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(l),this}setImportData(r,l){this._checkLoaded();const p=this.getImportIndex(r),y=this.stylesheet.imports||[];return p===-1?this:l?(this.fragments[p].style.setState(l),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(r,y[p].url))}setImportConfig(r,l,p){this._checkLoaded();const y=this.getImportIndex(r),b=this.stylesheet.imports||[];if(y===-1)return this;l?b[y].config=l:delete b[y].config;const S=this.fragments[y];p&&S.style.stylesheet&&(S.style.stylesheet.schema=p);const L=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=l,S.style.updateConfig(l,L),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const l=this.stylesheet.imports||[],p=this.getImportIndex(r);p!==-1&&(l.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(r){const l=(this.stylesheet.imports||[]).findIndex(p=>p.id===r);return l===-1&&this.fire(new i.z(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),l}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const l in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[l];p&&r.push(p.getSource())}return r}getSource(r,l){const p=this.getSourceCache(r,l);return p&&p.getSource()}getLayerSource(r){const l=this.getLayerSourceCache(r);return l&&l.getSource()}getSourceCache(r,l){const p=i.C(r,l);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(r){const l=i.C(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[r]&&l.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&l.push(this._mergedSymbolSourceCaches[r]),l}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const l in r){const p=r[l];p==="reload"?this.reloadSource(l):p==="clear"&&this.clearSource(l)}}updateLayers(r){const l=this._changes.getUpdatedPaintProperties();for(const p of l){const y=this.getLayer(p);y&&y.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r,this.scope)}getImages(r,l,p){this.imageManager.getImages(l.images,l.scope,p),this._updateTilesForChangedImages();const y=S=>{if(S){const L=l.images.map(N=>i.I.toString(N));S.setDependencies(l.tileID.key,l.type,L)}},b=i.C(l.source,l.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b])}rasterizeImages(r,l,p){this.imageManager.rasterizeImages(l,p)}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,l.scope,p)}getResource(r,l,p){return i.cz(l,p)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this.getOwnSourceCaches(r);return l.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,l){if(!this._clipLayerPresent&&r.type!=="fill-extrusion")return!1;const p=r.type==="fill-extrusion"&&r.sourceLayer==="building";if(r.is3D(!!this.terrain)){if(p||l&&l.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qo.getSourceType=function(m){return yh[m]},Qo.setSourceType=function(m,r){yh[m]=r},Qo.registerForPluginStateChange=i.ci;var Pc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ql=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,$a=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ec="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pa=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,tc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,nc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,wl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Eo=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,jo=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Vi=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Pi=[];Ma(Pc,Pi),Ma($a,Pi),Ma(Ql,Pi);const es={"_prelude_fog.vertex.glsl":tc,"_prelude_terrain.vertex.glsl":Pa,"_prelude_shadow.vertex.glsl":jo,"_prelude_fog.fragment.glsl":nc,"_prelude_shadow.fragment.glsl":Vi,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":wl,"_prelude_raster_particle.glsl":Eo},fs={};Tr("",Pa),Tr(nc,tc),Tr(Vi,jo),Tr(wl,""),Tr(Eo,"");const Sl=Tr(Ql,$a),iu=Pc;var rc={background:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Tr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Tr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Tr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Tr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Tr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Tr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Tr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Tr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Tr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Tr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Tr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Tr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Tr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Tr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Tr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Tr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Tr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ec),skyboxGradient:Tr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ec),skyboxCapture:Tr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Tr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Tr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Tr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Tr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Tr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Tr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Tr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Tr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ma(m,r){const l=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=p.split(" ");for(const b of y)r.includes(b)||r.push(b)}}function Tr(m,r){const l=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(F=>{const B=F.split(" ");return B[B.length-1]}),y=[...new Set(y)]);const b={},S=[],L=[];if(m=m.replace(l,(F,B)=>(L.push(B),"")),(r=r.replace(l,(F,B)=>(S.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let N=[...Pi];Ma(m,N),Ma(r,N);for(const F of[...S,...L])es[F]||console.error(`Undefined include: ${F}`),fs[F]||(fs[F]=[],Ma(es[F],fs[F])),N=[...N,...fs[F]];return{fragmentSource:m=m.replace(p,(F,B,H,W,ee)=>(b[ee]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
in ${H} ${W} ${ee};
#else
uniform ${H} ${W} u_${ee};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${ee}
    ${H} ${W} ${ee} = u_${ee};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    in ${H} ${W} ${ee};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(p,(F,B,H,W,ee)=>{const ce=W==="float"?"vec2":W,oe=ee.match(/color/)?"color":ce;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
in ${H} ${W} a_${ee};
#endif
`:b[ee]?B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
in ${H} ${ce} a_${ee};
out ${H} ${W} ${ee};
#else
uniform ${H} ${W} u_${ee};
#endif
`:B==="initialize"?oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = a_${ee};
#else
    ${H} ${W} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = unpack_mix_${oe}(a_${ee}, u_${ee}_t);
#else
    ${H} ${W} ${ee} = u_${ee};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    in ${H} ${W} a_${ee};
    out ${H} ${W} ${ee};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    ${ee} = a_${ee};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
in ${H} ${ce} a_${ee};
#else
uniform ${H} ${W} u_${ee};
#endif
`:B==="define-instanced"?oe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ee}0;
in vec4 a_${ee}1;
in vec4 a_${ee}2;
in vec4 a_${ee}3;
#else
uniform ${H} ${W} u_${ee};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${H} ${ce} a_${ee};
#else
uniform ${H} ${W} u_${ee};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    ${H} ${W} ${ee} = a_${ee};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${H} ${W} ${ee} = a_${ee};
#else
    ${H} ${W} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${H} ${W} ${ee} = unpack_mix_${oe}(a_${ee}, u_${ee}_t);
#else
    ${H} ${W} ${ee} = u_${ee};
#endif
`}),staticAttributes:y,usedDefines:N,vertexIncludes:S,fragmentIncludes:L}}class _d{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,y,b,S,L,N){this.context=r;let F=this.boundPaintVertexBuffers.length!==y.length;for(let H=0;!F&&H<y.length;H++)this.boundPaintVertexBuffers[H]!==y[H]&&(F=!0);let B=this.boundDynamicVertexBuffers.length!==L.length;for(let H=0;!B&&H<L.length;H++)this.boundDynamicVertexBuffers[H]!==L[H]&&(B=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||F||B||this.boundIndexBuffer!==b||this.boundVertexOffset!==S)this.freshBind(l,p,y,b,S,L,N);else{r.bindVertexArrayOES.set(this.vao);for(const H of L)H&&(H.bind(),N&&H.instanceCount&&H.setVertexAttribDivisor(r.gl,l,N));b&&b.dynamicDraw&&b.bind()}}freshBind(r,l,p,y,b,S,L){const N=r.numAttributes,F=this.context,B=F.gl;this.vao&&this.destroy(),this.vao=F.gl.createVertexArray(),F.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=S,l.enableAttributes(B,r),l.bind(),l.setVertexAttribPointers(B,r,b);for(const H of p)H.enableAttributes(B,r),H.bind(),H.setVertexAttribPointers(B,r,b);for(const H of S)H&&(H.enableAttributes(B,r),H.bind(),H.setVertexAttribPointers(B,r,b),L&&H.instanceCount&&H.setVertexAttribDivisor(B,r,L));y&&y.bind(),F.currentNumAttributes=N}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ma(m,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new i.ac(0,p/l).toLngLat().lat,new i.ac(0,(p+1)/l).toLngLat().lat]}function Co(m,r,l,p,y,b,S){const L=m.context,N=L.gl,F=l.hillshadeFBO;if(!F)return;m.prepareDrawTile();const B=m.isTileAffectedByFog(r),H=m.getOrCreateProgram("hillshade",{overrideFog:B});L.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,F.colorAttachment.get());const W=((fe,pe,Te,De)=>{const Ie=Te.paint.get("hillshade-shadow-color"),Ge=Te.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Be=Te.paint.get("hillshade-highlight-color"),je=Te.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ue=Te.paint.get("hillshade-accent-color"),Ke=Te.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",nt=Te.paint.get("hillshade-emissive-strength");let kt=i.ak(Te.paint.get("hillshade-illumination-direction"));if(Te.paint.get("hillshade-illumination-anchor")==="viewport")kt-=fe.transform.angle;else if(fe.style&&fe.style.enable3dLights()&&fe.style.directionalLight){const Zt=fe.style.directionalLight.properties.get("direction"),Kt=i.cc(Zt.x,Zt.y,Zt.z);kt=i.ak(Kt[1])}const xt=!fe.options.moving;return{u_matrix:De||fe.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),xt),u_image:0,u_latrange:ma(0,pe.tileID),u_light:[Te.paint.get("hillshade-exaggeration"),kt],u_shadow:Ie.toRenderColor(Ge?null:Te.lut),u_highlight:Be.toRenderColor(je?null:Te.lut),u_emissive_strength:nt,u_accent:Ue.toRenderColor(Ke?null:Te.lut)}})(m,l,p,m.terrain?r.projMatrix:null);m.uploadCommonUniforms(L,H,r.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:ce,tileBoundsSegments:oe}=m.getTileBoundsBuffers(l);H.draw(m,N.TRIANGLES,y,b,S,Xn.disabled,W,p.id,ee,ce,oe)}function Sh(m,r,l){if(!r.needsDEMTextureUpload)return;const p=m.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||m.getTileTexture(l.stride);const b=l.getPixels();r.demTexture?r.demTexture.update(b,{premultiply:!1}):r.demTexture=new i.T(p,b,y.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function gf(m,r,l){const p=m.context,y=p.gl;if(!r.dem)return;const b=r.dem;if(p.activeTexture.set(y.TEXTURE1),Sh(m,r,b),!r.demTexture)return;r.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const S=b.dim;p.activeTexture.set(y.TEXTURE0);let L=r.hillshadeFBO;if(!L){const W=new i.T(p,{width:S,height:S,data:null},y.RGBA8);W.bind(y.LINEAR,y.CLAMP_TO_EDGE),L=r.hillshadeFBO=p.createFramebuffer(S,S,!0,"renderbuffer"),L.colorAttachment.set(W.texture)}p.bindFramebuffer.set(L.framebuffer),p.viewport.set([0,0,S,S]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:F,tileBoundsSegments:B}=m.getMercatorTileBoundsBuffers(),H=[];m.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(m,y.TRIANGLES,Rn.disabled,Hn.disabled,Jn.unblended,Xn.disabled,((W,ee)=>{const ce=ee.stride,oe=i.ad.mat4.create();return i.ad.mat4.ortho(oe,0,i.ai,-i.ai,0,0,1),i.ad.mat4.translate(oe,oe,[0,-i.ai,0]),{u_matrix:oe,u_image:1,u_dimension:[ce,ce],u_zoom:W.overscaledZ}})(r.tileID,b),l.id,N,F,B),r.needsHillshadePrepare=!1}class Li{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _f extends Li{getDefault(){return i.al.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Th extends Li{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class yd extends Li{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class yf extends Li{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class vd extends Li{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class vf extends Li{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class xd extends Li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Wp extends Li{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class bd extends Li{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class wd extends Li{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Zp extends Li{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ia extends Li{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Kp extends Li{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class xf extends Li{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class bf extends Li{getDefault(){return i.al.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Xp extends Li{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Sd extends Li{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class Td extends Li{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class su extends Li{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Yp=class extends Li{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Jp extends Li{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ad extends Li{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class mg extends Li{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class gg extends Li{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ah extends Li{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class g0 extends Li{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ou extends Li{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Tl extends Li{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Mc extends Li{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class _0 extends Li{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class _g extends Li{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ga extends Li{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class ga extends Ga{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Qp extends Ga{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Eh extends Ga{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class em extends Qp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const tm=(m,r,l)=>({u_matrix:m,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:l}),wf=(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:S,u_frustum_tr:L,u_frustum_br:N,u_frustum_bl:F,u_globe_pos:B,u_globe_radius:H,u_viewport:W,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:ee,u_far_z_cutoff:ce});function Ed(m,r){return m!=null&&r!=null&&!(!m.hasData()||!r.hasData())&&m.demTexture!=null&&r.demTexture!=null&&m.tileID.key!==r.tileID.key}const Ha=new class{constructor(){this.operations={}}newMorphing(m,r,l,p,y){if(m in this.operations){const b=this.operations[m];b.to.tileID.key!==l.tileID.key&&(b.queued=l)}else this.operations[m]={startTime:p,phase:0,duration:y,from:r,to:l,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const r=this.operations[m];return{from:r.from,to:r.to,phase:r.phase}}update(m){for(const r in this.operations){const l=this.operations[r];for(l.phase=(m-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,m)){delete this.operations[r];break}}}_nextOp(m,r){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=r,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Ch={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Wa(m,r,l){if(r===0)return 0;const p=r<1&&l===514?.25/r:1;return 6*Math.pow(1.5,22-m)*Math.max(r,1)*p}function Ou(m,r){const l=1<<m.z;return!r&&(m.x===0||m.x===l-1)||m.y===0||m.y===l-1}const au=m=>({u_matrix:m});function Cd(m,r,l,p,y){if(y>0){const b=i.q.now(),S=(b-m.timeAdded)/y,L=r?(b-r.timeAdded)/y:-1,N=l.getSource(),F=p.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),B=!r||Math.abs(r.tileID.overscaledZ-F)>Math.abs(m.tileID.overscaledZ-F),H=B&&m.refreshedUponExpiration?1:i.ay(B?S:1-L,0,1);return m.refreshedUponExpiration&&S>=1&&(m.refreshedUponExpiration=!1),r?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class yg extends So{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new i.D(i.cj(),null),y=Eu("mock-dem",l,p,r.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class Sf extends So{constructor(r){const l=Eu("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new i.D(i.cj(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const y=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const L=new Ta(S,this._source.tileSize*S.overscaleFactor(),r.tileZoom);L.state="loaded",this._tiles[S.key]=L}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(r){const l=this.proxyCachedFBO[r];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Tf extends i.aH{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class vg extends i.cK{constructor(r,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,b]=function(N){const F=new i.b5,B=new i.aV,H=131;F.reserve(17161),B.reserve(33800);const W=i.ai/128,ee=i.ai+W/2,ce=ee+W;for(let fe=-W;fe<ce;fe+=W)for(let pe=-W;pe<ce;pe+=W){const Te=pe<0||pe>ee||fe<0||fe>ee?24575:0,De=i.ay(Math.round(pe),0,i.ai),Ie=i.ay(Math.round(fe),0,i.ai);F.emplaceBack(De+Te,Ie)}const oe=(fe,pe)=>{const Te=pe*H+fe;B.emplaceBack(Te+1,Te,Te+H),B.emplaceBack(Te+H,Te+H+1,Te+1)};for(let fe=1;fe<129;fe++)for(let pe=1;pe<129;pe++)oe(pe,fe);return[0,129].forEach(fe=>{for(let pe=0;pe<130;pe++)oe(pe,fe),oe(fe,pe)}),[F,B,32768]}(),S=r.context;this.gridBuffer=S.createVertexBuffer(p,i.b7.members),this.gridIndexBuffer=S.createIndexBuffer(y),this.gridSegments=i.b8.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=i.b8.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Sf(l.map),this.orthoMatrix=i.ad.mat4.create(),i.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ai,0,i.ai,0,1);const L=S.gl;this._overlapStencilMode=new Hn({func:L.GEQUAL,mask:255},0,255,L.KEEP,L.KEEP,L.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yg(l.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const y=r.terrain.properties,b=r.terrain.drapeRenderMode===0,S=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const L=r.terrain&&r.terrain.scope,N=y.get("source"),F=b?this._mockSourceCache:r.getSourceCache(N,L);if(!F)return void i.w(`Couldn't find terrain source "${N}".`);if(this.sourceCache=F,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(l):y.get("exaggeration"),!l.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(l,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const l=this._previousCameraAltitude,p=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=p;const y=l!=null?p-l:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=r.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(b);let L=b-this._previousZoom;const N=this._previousUpdateTimestamp;let F=b;this._evaluationZoom!=null&&(F=this._evaluationZoom,Math.abs(b-F)>.5&&(L=.5*(b-F+L)),L*y<0&&(F+=L)),this._evaluationZoom=F;const B=S.getExaggeration(F),H=B===S.getExaggeration(Math.max(0,F-.1));if(H&&Math.abs(B-this._exaggeration)<.01)return B;let W=Math.min(.1,.00375*(this._updateTimestamp-N));return(H||B<.1||Math.abs(L)<1e-4)&&(W=Math.min(.2,4*W)),i.ah(this._exaggeration,B,W)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=l.getIds().map(N=>{const F=l.getTileByID(N).tileID;return F.projMatrix=p.calculateProjMatrix(F.toUnwrapped()),F});(function(N,F){const B=F.transform.pointCoordinate(F.transform.getCameraPoint()),H=new i.P(B.x,B.y);N.sort((W,ee)=>{if(ee.overscaledZ-W.overscaledZ)return ee.overscaledZ-W.overscaledZ;const ce=new i.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),oe=new i.P(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),fe=H.mult(1<<W.canonical.z);return fe.x-=.5,fe.y-=.5,fe.distSqr(ce)-fe.distSqr(oe)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const N in S){const F=S[N];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,r[N],b),F.usedForTerrain))continue;const B=r[N];F.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[l.id]=y.map(N=>new Tf(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const L={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const F=this.terrainTileForTile[N.key];if(!F)continue;const B=F.tileID.key;B in L||(this._visibleDemTiles.push(F),L[B]=B)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Sh(this.painter,y,b))}}_prepareDemTileUniforms(r,l,p,y){if(!l||l.demTexture==null)return!1;const b=r.tileID.canonical,S=Math.pow(2,l.tileID.canonical.z-b.z),L=y||"";return p[`u_dem_tl${L}`]=[b.x*S%1,b.y*S%1],p[`u_dem_scale${L}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const l=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const b=y.dem.tree.minimums[0];return b>0&&r++,p+b},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new i.cL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new i.T(r,y,l.R32F,{premultiply:!1}),b}setupElevationDraw(r,l,p){const y=this.painter.context,b=y.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let L=null,N=null,F=1;if(p&&p.morphing&&this._useVertexMorphing){const ee=p.morphing.srcDemTile,ce=p.morphing.dstDemTile;F=p.morphing.phase,ee&&ce&&(this._prepareDemTileUniforms(r,ee,S,"_prev")&&(N=ee),this._prepareDemTileUniforms(r,ce,S)&&(L=ce))}const B=ee=>ee&&ee.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let H=null;var W;if(this.enabled?N&&L?(H=L.demTexture,y.activeTexture.set(b.TEXTURE4),N.demTexture.bind(B(N),b.CLAMP_TO_EDGE),S.u_dem_lerp=F):(L=this.terrainTileForTile[r.tileID.key],H=this._prepareDemTileUniforms(r,L,S)?L.demTexture:this.emptyDEMTexture):H=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),H&&(S.u_dem_size=(W=H).size[0]===1?1:W.size[0]-2,H.bind(B(L),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,l,S),p&&p.useMeterToDem&&L){const ee=(1<<L.tileID.canonical.z)*i.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=ee}if(p&&p.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(y,S),this.painter.transform.projection.name==="globe"){const ee=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(y,ee)}}globeUniformValues(r,l,p){const y=r.projection;return{u_tile_tl_up:y.upVector(l,0,0),u_tile_tr_up:y.upVector(l,i.ai,0),u_tile_br_up:y.upVector(l,i.ai,i.ai),u_tile_bl_up:y.upVector(l,0,i.ai),u_tile_up_scale:p?i.cM(1):y.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,S,L,N){if(y.transform.projection.name==="globe")(function(F,B,H,W,ee){const ce=F.context,oe=ce.gl;let fe,pe;const Te=F.transform,De=i.cD(F,ce,Te),Ie=(Zt,Kt)=>{if(pe===Kt)return;const ln=[Ch[Kt],"PROJECTION_GLOBE_VIEW"];De&&ln.push("CUSTOM_ANTIALIASING");const vt=F.isTileAffectedByFog(Zt);fe=F.getOrCreateProgram("globeRaster",{defines:ln,overrideFog:vt}),pe=Kt},Ge=F.colorModeForRenderPass(),Be=new Rn(oe.LEQUAL,Rn.ReadWrite,F.depthRangeFor3D);Ha.update(ee);const je=i.cE(Te),Ue=[i.av(Te.center.lng),i.aC(Te.center.lat)],Ke=F.globeSharedBuffers,nt=[Te.width*i.q.devicePixelRatio,Te.height*i.q.devicePixelRatio],kt=Float32Array.from(Te.globeMatrix),xt={useDenormalizedUpVectorScale:!0};{const Zt=F.transform,Kt=Wa(Zt.zoom,B.exaggeration(),B.sourceCache._source.tileSize);pe=-1;const ln=oe.TRIANGLES;for(const vt of W){const Ht=H.getTile(vt),mt=Hn.disabled,Gt=B.prevTerrainTileForTile[vt.key],Bt=B.terrainTileForTile[vt.key];Ed(Gt,Bt)&&Ha.newMorphing(vt.key,Gt,Bt,ee,250),ce.activeTexture.set(oe.TEXTURE0),Ht.texture&&Ht.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const Xt=Ha.getMorphValuesForProxy(vt.key),Rt=Xt?1:0;Xt&&i.L(xt,{morphing:{srcDemTile:Xt.from,dstDemTile:Xt.to,phase:i.cC(Xt.phase)}});const Qt=i.cF(vt.canonical),gn=i.cG(Qt.getCenter().lat),_n=i.cH(vt.canonical,Qt,gn,Zt.worldSize/Zt._pixelsPerMercatorPixel),xn=i.bc(i.cI(vt.canonical)),Dn=wf(Zt.expandedFarZProjMatrix,kt,je,xn,i.ag(Zt.zoom),Ue,Zt.frustumCorners.TL,Zt.frustumCorners.TR,Zt.frustumCorners.BR,Zt.frustumCorners.BL,Zt.globeCenterInViewSpace,Zt.globeRadius,nt,Kt,Zt._farZ,_n);if(Ie(vt,Rt),fe&&(B.setupElevationDraw(Ht,fe,xt),F.uploadCommonUniforms(ce,fe,vt.toUnwrapped()),Ke)){const[ar,Vn,ir]=Ke.getGridBuffers(gn,Kt!==0);fe.draw(F,ln,Be,mt,Ge,Xn.backCCW,Dn,"globe_raster",ar,Vn,ir)}}}if(Ke&&(F.renderDefaultNorthPole||F.renderDefaultSouthPole)){const Zt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];De&&Zt.push("CUSTOM_ANTIALIASING"),fe=F.getOrCreateProgram("globeRaster",{defines:Zt});for(const Kt of W){const{x:ln,y:vt,z:Ht}=Kt.canonical,mt=vt===0,Gt=vt===(1<<Ht)-1,[Bt,Xt,Rt,Qt]=Ke.getPoleBuffers(Ht,!1);if(Qt&&(mt||Gt)){const gn=H.getTile(Kt);ce.activeTexture.set(oe.TEXTURE0),gn.texture&&gn.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let _n=i.cJ(Ht,ln,Te);const xn=i.bc(i.cI(Kt.canonical)),Dn=(ar,Vn)=>ar.draw(F,oe.TRIANGLES,Be,Hn.disabled,Ge,Xn.disabled,wf(Te.expandedFarZProjMatrix,_n,_n,xn,0,Ue,Te.frustumCorners.TL,Te.frustumCorners.TR,Te.frustumCorners.BR,Te.frustumCorners.BL,Te.globeCenterInViewSpace,Te.globeRadius,nt,0,Te._farZ),"globe_pole_raster",Vn,Rt,Qt);B.setupElevationDraw(gn,fe,xt),F.uploadCommonUniforms(ce,fe,Kt.toUnwrapped()),mt&&F.renderDefaultNorthPole&&Dn(fe,Bt),Gt&&F.renderDefaultSouthPole&&(_n=i.ad.mat4.scale(i.ad.mat4.create(),_n,[1,-1,1]),Dn(fe,Xt))}}}})(y,b,S,L,N);else{const F=y.context,B=F.gl;let H,W;const ee=y.shadowRenderer,ce=Ps(y,y.longestCutoffRange),oe=Ge=>{if(W===Ge)return;const Be=[];Be.push(Ch[Ge]),ce.shouldRenderCutoff&&Be.push("RENDER_CUTOFF"),ee&&(Be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ee.useNormalOffset&&Be.push("NORMAL_OFFSET")),H=y.getOrCreateProgram("terrainRaster",{defines:Be}),W=Ge},fe=y.colorModeForRenderPass(),pe=new Rn(B.LEQUAL,Rn.ReadWrite,y.depthRangeFor3D);Ha.update(N);const Te=y.transform,De=Wa(Te.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let Ie=[0,0,0];if(ee){const Ge=y.style.directionalLight,Be=y.style.ambientLight;Ge&&Be&&(Ie=Tc(y.style,Ge,Be))}{W=-1;const Ge=B.TRIANGLES,[Be,je]=[b.gridIndexBuffer,b.gridSegments];for(const Ue of L){const Ke=S.getTile(Ue),nt=Hn.disabled,kt=b.prevTerrainTileForTile[Ue.key],xt=b.terrainTileForTile[Ue.key];Ed(kt,xt)&&Ha.newMorphing(Ue.key,kt,xt,N,250),F.activeTexture.set(B.TEXTURE0),Ke.texture&&Ke.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Zt=Ha.getMorphValuesForProxy(Ue.key),Kt=Zt?1:0;let ln;Zt&&(ln={morphing:{srcDemTile:Zt.from,dstDemTile:Zt.to,phase:i.cC(Zt.phase)}});const vt=tm(Ue.projMatrix,Ou(Ue.canonical,Te.renderWorldCopies)?De/10:De,Ie);if(oe(Kt),!H)continue;b.setupElevationDraw(Ke,H,ln);const Ht=Ue.toUnwrapped();ee&&ee.setupShadows(Ht,H),y.uploadCommonUniforms(F,H,Ht,null,ce),H.draw(y,Ge,pe,nt,fe,Xn.backCCW,vt,"terrain_raster",b.gridBuffer,Be,je)}}}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],S=this._drapedRenderBatches.shift(),L=l.style.order,N=[];let F=0;for(const B of b){const H=y.getTileByID(B.proxyTileKey),W=y.proxyCachedFBO[B.key]?y.proxyCachedFBO[B.key][r]:void 0,ee=W!==void 0?y.renderCache[W]:this.pool[F++],ce=W!==void 0;if(H.texture=ee.tex,ce&&!ee.dirty){N.push(H.tileID);continue}let oe;p.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(p.clear({color:i.al.transparent,stencil:0}),ee.dirty=!1);for(let fe=S.start;fe<=S.end;++fe){const pe=l.style._mergedLayers[L[fe]];if(pe.isHidden(l.transform.zoom))continue;const Te=l.style.getLayerSourceCache(pe),De=Te?this.proxyToSource[B.key][Te.id]:[B];if(!De)continue;const Ie=De;p.viewport.set([0,0,ee.fb.width,ee.fb.height]),oe!==(Te?Te.id:null)&&(this._setupStencil(ee,De,pe,Te),oe=Te?Te.id:null),l.renderLayer(l,Te,pe,Ie)}if(this._drapedRenderBatches.length===0)for(const fe of this._pendingGroundEffectLayers){const pe=l.style._mergedLayers[L[fe]];if(pe.isHidden(l.transform.zoom))continue;const Te=l.style.getLayerSourceCache(pe),De=Te?this.proxyToSource[B.key][Te.id]:[B];if(!De)continue;const Ie=De;p.viewport.set([0,0,ee.fb.width,ee.fb.height]),oe!==(Te?Te.id:null)&&(this._setupStencil(ee,De,pe,Te),oe=Te?Te.id:null),l.renderLayer(l,Te,pe,Ie)}this.renderedToTile?(ee.dirty=!0,N.push(H.tileID)):ce||--F,F===5&&(F=0,this.renderToBackBuffer(N))}return this.renderToBackBuffer(N),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),S.end+1}postRender(){}isLayerOrderingCorrect(r){const l=r.order.length;let p=-1,y=l;for(let b=0;b<l;++b)this._style.isLayerDraped(r._mergedLayers[r.order[b]])?p=Math.max(p,b):y=Math.min(y,b);return y>p}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const S=b.tileID,L=1<<S.overscaledZ,{x:N,y:F}=S.canonical,B=N/L,H=(N+1)/L,W=F/L,ee=(F+1)/L;return{minx:B,miny:W,maxx:H,maxy:ee,t:b.dem.tree.raycastRoot(B,W,H,ee,r,l,p),tile:b}});y.sort((b,S)=>(b.t!==null?b.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,r,l,p);if(S!=null)return S}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const y=new i.T(r,{width:p[0],height:p[1],data:null},l.RGBA8);y.bind(l.LINEAR,l.CLAMP_TO_EDGE);const b=r.createFramebuffer(p[0],p[1],!0,null);return b.colorAttachment.set(y.texture),b.depthAttachment=new em(r,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._mergedLayers[r],p=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const p of this._style.getSources())if(p instanceof gl){r=!0;break}if(!r)return;const l={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(b&&!l[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof i.ab){l[b.id]=!0;for(const S of this.proxyCoords){const L=this.proxyToSource[S.key][b.id];if(L)for(const N of L)this._clearRenderCacheForTile(b.id,N)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof ua){r=!0;break}if(!r)return;const l={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(!b||l[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const S=y.paint.get("raster-fade-duration");for(const L of this.proxyCoords){const N=this.proxyToSource[L.key][b.id];if(N)for(const F of N){const B=Cd(b.getTile(F),b.findLoadedParent(F,0),b,this.painter.transform,S);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(b.id,F)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,l=r.length;if(l===0)return;const p=[];this._pendingGroundEffectLayers=[];let y,b=0,S=this._style._mergedLayers[r[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<l;)S=this._style._mergedLayers[r[b]];for(;b<l;++b){const L=this._style._mergedLayers[r[b]];L.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(L)?y===void 0&&(y=b):(L.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(p.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&p.push({start:y,end:b-1}),p.length!==0){const L=p[p.length-1];this._pendingGroundEffectLayers.every(N=>N>L.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const S=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let L=0;L<S.length;++L){const N=Object.values(S[L]);l.renderCachePool.push(...N)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let S=p.length-1;S>=0;S--){const L=p[S];if(l.getTileByID(L.key),l.proxyCachedFBO[L.key]!==void 0){const N=r[L.key],F=this.proxyToSource[L.key];let B=0;for(const H in F){const W=F[H],ee=N[H];if(!ee||ee.length!==W.length||W.some((ce,oe)=>ce!==ee[oe]||y[H]&&y[H].hasOwnProperty(ce.key))){B=-1;break}++B}for(const H in l.proxyCachedFBO[L.key])l.renderCache[l.proxyCachedFBO[L.key][H]].dirty=B<0||B!==Object.values(N).length}}const b=[...this._drapedRenderBatches];b.sort((S,L)=>L.end-L.start-(S.end-S.start));for(const S of b)for(const L of p){if(l.proxyCachedFBO[L.key])continue;let N=l.renderCachePool.pop();N===void 0&&l.renderCache.length<50&&(N=l.renderCache.length,l.renderCache.push(this._createFBO())),N!==void 0&&(l.proxyCachedFBO[L.key]={},l.proxyCachedFBO[L.key][S.start]=N,l.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let L;if(p.isTileClipped())L=l.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);L=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+L>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=L,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Hn.disabled}_renderTileClippingMasks(r,l){const p=this.painter,y=this.painter.context,b=y.gl;p._tileClippingMaskIDs={},y.setColorMode(Jn.disabled),y.setDepthMode(Rn.disabled);const S=p.getOrCreateProgram("clippingMask");for(const L of r){const N=p._tileClippingMaskIDs[L.key]=--l;S.draw(p,b.TRIANGLES,Rn.disabled,new Hn({func:b.ALWAYS,mask:0},N,255,b.KEEP,b.KEEP,b.REPLACE),Jn.disabled,Xn.disabled,au(L.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];i.ad.vec4.transformMat4(p,p,l.pixelMatrixInverse),i.ad.vec4.scale(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const y=l._camera.position,b=i.bH(1,l.center.lat),S=[y[0],y[1],y[2]/b,0],L=i.ad.vec3.subtract([],p.slice(0,3),S);i.ad.vec3.normalize(L,L);const N=this.raycast(S,L,this._exaggeration);return N!==null&&N?(i.ad.vec3.scaleAndAdd(S,S,L,N),S[3]=S[2],S[2]*=b,S):null}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof i.aK)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const y=this.proxiedCoords[r.id]=[],b=this.proxyCoords;for(let N=0;N<b.length;N++){const F=b[N],B=this._findTileCoveringTileID(F,r);if(B){const H=this._createProxiedId(F,B,p[F.key]&&p[F.key][r.id]);y.push(H),this.proxyToSource[F.key][r.id]=[H]}}let S=!1;const L=new Set;for(let N=0;N<l.length;N++){const F=r.getTile(l[N]);if(!F||!F.hasData())continue;const B=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==F.tileID.canonical.z){const H=this.proxyToSource[B.tileID.key][r.id],W=this._createProxiedId(B.tileID,F,p[B.tileID.key]&&p[B.tileID.key][r.id]);H?H.splice(H.length-1,0,W):this.proxyToSource[B.tileID.key][r.id]=[W];const ee=this.proxyToSource[B.tileID.key][r.id];L.has(ee)||L.add(ee),y.push(W),S=!0}}if(this._sourceTilesOverlap[r.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const N of L)N.sort((F,B)=>B.overscaledZ-F.overscaledZ)}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const y=this.proxiedCoords[r.id]=[],b=this.proxyCoords,S=r.getSource(),L=S.tileID;if(!L)return;const N=new i.P(L.x,L.y)._div(1<<L.z),F=S.coordinates.map(i.ac.fromLngLat).reduce((H,W)=>(H.min.x=Math.min(H.min.x,W.x-N.x),H.min.y=Math.min(H.min.y,W.y-N.y),H.max.x=Math.max(H.max.x,W.x-N.x),H.max.y=Math.max(H.max.y,W.y-N.y),H),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(H,W)=>{const ee=H.wrap+H.canonical.x/(1<<H.canonical.z),ce=H.canonical.y/(1<<H.canonical.z),oe=i.ai/(1<<H.canonical.z),fe=W.wrap+W.canonical.x/(1<<W.canonical.z),pe=W.canonical.y/(1<<W.canonical.z);return ee+oe<fe+F.min.x||ee>fe+F.max.x||ce+oe<pe+F.min.y||ce>pe+F.max.y};for(let H=0;H<b.length;H++){const W=b[H];for(let ee=0;ee<l.length;ee++){const ce=r.getTile(l[ee]);if(!ce||!ce.hasData()||B(W,ce.tileID))continue;const oe=this._createProxiedId(W,ce,p[W.key]&&p[W.key][r.id]),fe=this.proxyToSource[W.key][r.id];fe?fe.push(oe):this.proxyToSource[W.key][r.id]=[oe],y.push(oe)}}}_createProxiedId(r,l,p){let y=this.orthoMatrix;if(p){const b=p.find(S=>S.key===l.tileID.key);if(b)return b}if(l.tileID.key!==r.key){const b=r.canonical.z-l.tileID.canonical.z;let S,L,N;y=i.ad.mat4.create();const F=l.tileID.wrap-r.wrap<<r.overscaledZ;b>0?(S=i.ai>>b,L=S*((l.tileID.canonical.x<<b)-r.canonical.x+F),N=S*((l.tileID.canonical.y<<b)-r.canonical.y)):(S=i.ai<<-b,L=i.ai*(l.tileID.canonical.x-(r.canonical.x+F<<-b)),N=i.ai*(l.tileID.canonical.y-(r.canonical.y<<-b))),i.ad.mat4.ortho(y,0,S,0,S,0,1),i.ad.mat4.translate(y,y,[L,N,0])}return new Tf(l.tileID,r.key,y)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[l.id],b=y[r.key];if(p=b?l.getTileByID(b):null,p&&p.hasData()||b===null)return p;let S=p?p.tileID:r,L=S.overscaledZ;const N=l.getSource().minzoom,F=[];if(!b){const H=l.getSource().maxzoom;if(r.canonical.z>=H){const W=r.canonical.z-H;l.getSource().reparseOverscaled?(L=Math.max(r.canonical.z+2,l.transform.tileZoom),S=new i.aH(L,r.wrap,H,r.canonical.x>>W,r.canonical.y>>W)):W!==0&&(L=H,S=new i.aH(L,r.wrap,H,r.canonical.x>>W,r.canonical.y>>W))}S.key!==r.key&&(F.push(S.key),p=l.getTile(S))}const B=H=>{F.forEach(W=>{y[W]=H}),F.length=0};for(L-=1;L>=N&&(!p||!p.hasData());L--){p&&B(p.tileID.key);const H=S.calculateScaledKey(L);if(p=l.getTileByID(H),p&&p.hasData())break;const W=y[H];if(W===null)break;W===void 0?F.push(H):p=l.getTileByID(W)}return B(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}}function xg(m,r,l){const p=function(L,N,F){const B=i.ad.vec3.dot(N,L),H=i.ad.vec3.dot(F,[.2126,.7152,.0722]),W=(ce,oe,fe)=>(1-fe)*ce+fe*oe,ee=W(1-.3*Math.min(H,1),1,Math.min(B+1,1));return W(.92,1,Math.asin(i.ay(N[2],-1,1))/Math.PI+.5)*ee}(m,[0,0,1],r),y=[0,0,0];i.ad.vec3.scale(y,l.slice(0,3),p);const b=[0,0,0];i.ad.vec3.scale(b,r.slice(0,3),m[2]);const S=[0,0,0];return i.ad.vec3.add(S,y,b),i.cg(S)}const Pd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],y0=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class bg{static cacheKey(r,l,p,y){let b=`${l}${y?y.cacheKey:""}`;for(const S of p)r.usedDefines.includes(S)&&(b+=`/${S}`);return b}constructor(r,l,p,y,b,S){const L=r.gl;this.program=L.createProgram(),this.configuration=y,this.name=l,this.fixedDefines=[...S];const N=y?y.getBinderAttributes():[],F=(p.staticAttributes||[]).concat(N);let B=y?y.defines():[];B=B.concat(S.map(fe=>`#define ${fe}`));const H=`#version 300 es
`;let W=H+B.concat("precision mediump float;",iu,Sl.fragmentSource).join(`
`);for(const fe of p.fragmentIncludes)W+=`
${es[fe]}`;W+=`
${p.fragmentSource}`;let ee=H+B.concat("precision highp float;",iu,Sl.vertexSource).join(`
`);for(const fe of p.vertexIncludes)ee+=`
${es[fe]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(ee+=`
uniform int u_instanceID;
`),ee+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(ee=ee.replaceAll("gl_InstanceID","u_instanceID"));const ce=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(ce,W),L.compileShader(ce),L.attachShader(this.program,ce);const oe=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(oe,ee),L.compileShader(oe),L.attachShader(this.program,oe),this.attributes={},this.numAttributes=F.length;for(let fe=0;fe<this.numAttributes;fe++)if(F[fe]){const pe=F[fe].startsWith("a_")?F[fe]:`a_${F[fe]}`;L.bindAttribLocation(this.program,fe,pe),this.attributes[pe]=fe}L.linkProgram(this.program),L.deleteShader(oe),L.deleteShader(ce),this.fixedUniforms=b(r),this.binderUniforms=y?y.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(fe=>({u_instanceID:new i.bN(fe)}))(r)),(S.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(fe=>({u_dem:new i.bN(fe),u_dem_prev:new i.bN(fe),u_dem_tl:new i.bK(fe),u_dem_scale:new i.bM(fe),u_dem_tl_prev:new i.bK(fe),u_dem_scale_prev:new i.bM(fe),u_dem_size:new i.bM(fe),u_dem_lerp:new i.bM(fe),u_exaggeration:new i.bM(fe),u_depth:new i.bN(fe),u_depth_size_inv:new i.bK(fe),u_depth_range_unpack:new i.bK(fe),u_occluder_half_size:new i.bM(fe),u_occlusion_depth_offset:new i.bM(fe),u_meter_to_dem:new i.bM(fe),u_label_plane_matrix_inv:new i.bJ(fe)}))(r)),S.includes("GLOBE")&&(this.globeUniforms=(fe=>({u_tile_tl_up:new i.bL(fe),u_tile_tr_up:new i.bL(fe),u_tile_br_up:new i.bL(fe),u_tile_bl_up:new i.bL(fe),u_tile_up_scale:new i.bM(fe)}))(r)),S.includes("FOG")&&(this.fogUniforms=(fe=>({u_fog_matrix:new i.bJ(fe),u_fog_range:new i.bK(fe),u_fog_color:new i.cb(fe),u_fog_horizon_blend:new i.bM(fe),u_fog_vertical_limit:new i.bK(fe),u_fog_temporal_offset:new i.bM(fe),u_frustum_tl:new i.bL(fe),u_frustum_tr:new i.bL(fe),u_frustum_br:new i.bL(fe),u_frustum_bl:new i.bL(fe),u_globe_pos:new i.bL(fe),u_globe_radius:new i.bM(fe),u_globe_transition:new i.bM(fe),u_is_globe:new i.bN(fe),u_viewport:new i.bK(fe)}))(r)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(fe=>({u_cutoff_params:new i.cb(fe)}))(r)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(fe=>({u_lighting_ambient_color:new i.bL(fe),u_lighting_directional_dir:new i.bL(fe),u_lighting_directional_color:new i.bL(fe),u_ground_radiance:new i.bL(fe)}))(r)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(fe=>({u_light_matrix_0:new i.bJ(fe),u_light_matrix_1:new i.bJ(fe),u_fade_range:new i.bK(fe),u_shadow_normal_offset:new i.bL(fe),u_shadow_intensity:new i.bM(fe),u_shadow_texel_size:new i.bM(fe),u_shadow_map_resolution:new i.bM(fe),u_shadow_direction:new i.bL(fe),u_shadow_bias:new i.bL(fe),u_shadowmap_0:new i.bN(fe),u_shadowmap_1:new i.bN(fe)}))(r))}}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y]&&p[y].set(this.program,y,l[y])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y]&&p[y].set(this.program,y,l[y])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setCutoffUniformValues(r,l){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setLightsUniformValues(r,l){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setShadowUniformValues(r,l){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;r.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}_drawDebugWireframe(r,l,p,y,b,S,L,N,F,B){const H=r.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const W=r.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||r._terrain&&r._terrain.renderingToTexture||!Pd.includes(this.name))||!(!H.layers3D||!y0.includes(this.name))))return;const ee=W.gl,ce=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,b,W);if(!ce)return;const oe=[...this.fixedDefines];oe.push("DEBUG_WIREFRAME");const fe=r.getOrCreateProgram(this.name,{config:this.configuration,defines:oe});W.program.set(fe.program);const pe=(Ie,Ge,Be)=>{if(Ge[Ie]&&Be[Ie])for(const je in Ge[Ie])Be[Ie][je]&&Be[Ie][je].set(Be.program,je,Ge[Ie][je].current)};F&&F.setUniforms(fe.program,W,fe.binderUniforms,L,{zoom:N}),pe("fixedUniforms",this,fe),pe("terrainUniforms",this,fe),pe("globeUniforms",this,fe),pe("fogUniforms",this,fe),pe("lightsUniforms",this,fe),pe("shadowUniforms",this,fe),ce.bind(),W.setColorMode(new Jn([ee.ONE,ee.ONE_MINUS_SRC_ALPHA,ee.ZERO,ee.ONE],i.al.transparent,[!0,!0,!0,!1])),W.setDepthMode(new Rn(l.func===ee.LESS?ee.LEQUAL:l.func,Rn.ReadOnly,l.range)),W.setStencilMode(Hn.disabled);const Te=3*S.primitiveLength*2,De=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ie=B||1;for(let Ge=0;Ge<Ie;++Ge)fe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ge),ee.drawElements(ee.LINES,Te,ee.UNSIGNED_SHORT,De)}else B&&B>1?ee.drawElementsInstanced(ee.LINES,Te,ee.UNSIGNED_SHORT,De,B):ee.drawElements(ee.LINES,Te,ee.UNSIGNED_SHORT,De);b.bind(),W.program.set(this.program),W.setDepthMode(l),W.setStencilMode(p),W.setColorMode(y)}checkUniforms(r,l,p){if(this.fixedDefines.includes(l)){for(const y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${y} not set but required by ${l} being defined`)}}draw(r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe){const pe=r.context,Te=pe.gl;if(this.failedToCreate)return;pe.program.set(this.program),pe.setDepthMode(p),pe.setStencilMode(y),pe.setColorMode(b),pe.setCullFace(S);for(const Ge of Object.keys(this.fixedUniforms))this.fixedUniforms[Ge].set(this.program,Ge,L[Ge]);ce&&ce.setUniforms(this.program,pe,this.binderUniforms,W,{zoom:ee});const De={[Te.POINTS]:1,[Te.LINES]:2,[Te.TRIANGLES]:3,[Te.LINE_STRIP]:1}[l];this.checkUniforms(N,"RENDER_SHADOWS",this.shadowUniforms);const Ie=fe&&fe>0?1:void 0;for(const Ge of H.get()){const Be=Ge.vaos||(Ge.vaos={});if((Be[N]||(Be[N]=new _d)).bind(pe,this,F,ce?ce.getPaintVertexBuffers():[],B,Ge.vertexOffset,oe||[],Ie),this.forceManualRenderingForInstanceIDShaders){const je=fe||1;for(let Ue=0;Ue<je;++Ue)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ue),B?Te.drawElements(l,Ge.primitiveLength*De,Te.UNSIGNED_SHORT,Ge.primitiveOffset*De*2):Te.drawArrays(l,Ge.vertexOffset,Ge.vertexLength)}else fe&&fe>1?Te.drawElementsInstanced(l,Ge.primitiveLength*De,Te.UNSIGNED_SHORT,Ge.primitiveOffset*De*2,fe):B?Te.drawElements(l,Ge.primitiveLength*De,Te.UNSIGNED_SHORT,Ge.primitiveOffset*De*2):Te.drawArrays(l,Ge.vertexOffset,Ge.vertexLength);l===Te.TRIANGLES&&B&&this._drawDebugWireframe(r,p,y,b,B,Ge,W,ee,ce,fe)}}}function Af(m,r){const l=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,m.transform.tileZoom)/l,y=p*(r.tileID.canonical.x+r.tileID.wrap*l),b=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.at(r,1,m.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const zu={terrain:0,flat:1},nm=i.ad.mat4.create(),Ef=(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe,pe)=>{const Te=r.style.light,De=Te.properties.get("position"),Ie=[De.x,De.y,De.z],Ge=i.ad.mat3.create();Te.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(Ge,-r.transform.angle),i.ad.vec3.transformMat3(Ie,Ie,Ge));const Be=Te.properties.get("color"),je=r.transform,Ue={u_matrix:m,u_lightpos:Ie,u_lightintensity:Te.properties.get("intensity"),u_lightcolor:[Be.r,Be.g,Be.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:zu[F],u_base_type:zu[B],u_ao:y,u_edge_radius:b,u_width_scale:S,u_flood_light_color:ce,u_vertical_scale:oe,u_flood_light_intensity:fe,u_ground_shadow_factor:pe};return je.projection.name==="globe"&&(Ue.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],Ue.u_zoom_transition=H,Ue.u_inv_rot_matrix=ee,Ue.u_merc_center=W,Ue.u_up_dir=je.projection.upVector(new i.bT(0,0,0),W[0]*i.ai,W[1]*i.ai),Ue.u_height_lift=N),Ue},Fu=(m,r,l,p,y,b)=>({u_matrix:m,u_edge_radius:r,u_width_scale:l,u_vertical_scale:p,u_height_type:zu[y],u_base_type:zu[b]}),D=(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe)=>{const pe=Ef(m,r,l,p,y,b,S,L,F,B,H,W,ee,ce,oe,fe,1,[0,0,0]),Te={u_height_factor:-Math.pow(2,L.overscaledZ)/N.tileSize/8};return i.l(pe,Af(r,N),Te)},q=(m,r)=>({u_matrix:m,u_emissive_strength:r}),ne=(m,r,l,p)=>i.l(q(m,r),Af(l,p)),de=(m,r,l)=>({u_matrix:m,u_world:l,u_emissive_strength:r}),Ae=(m,r,l,p,y)=>i.l(ne(m,r,l,p),{u_world:y}),ke=(m,r,l,p,y)=>({u_matrix:m,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:l,u_height_scale:p,u_reset_depth:y}),ze=(m,r,l,p)=>{const y=i.ai/l.tileSize;return{u_matrix:m,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/y,r.pixelsToGLUnits[1]/y]}},Ve=(m,r,l=1)=>({u_matrix:m,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:l}),$e=i.ad.mat4.create(),lt=(m,r,l,p,y,b,S)=>{const L=m.transform,N=L.projection.name==="globe",F=N?i.cO(L.zoom,r.canonical)*L._pixelsPerMercatorPixel:i.at(l,1,b),B={u_matrix:r.projMatrix,u_extrude_scale:F,u_intensity:S,u_inv_rot_matrix:$e,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){B.u_inv_rot_matrix=p,B.u_merc_center=y,B.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],B.u_zoom_transition=i.ag(L.zoom);const H=y[0]*i.ai,W=y[1]*i.ai;B.u_up_dir=L.projection.upVector(new i.bT(0,0,0),H,W)}return B};function Ze(m,[r,l,p,y],[b,S]){if(b===S)return[0,0,0,0];const L=255*(m-1)/(m*(S-b));return[r*L,l*L,p*L,y*L]}function tn(m,r,[l,p]){return l===p?0:.5/m+(r-l)*(m-1)/(m*(p-l))}const nn=(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe,pe,Te,De,Ie)=>({u_matrix:m,u_normalize_matrix:r,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:F,u_fade_t:B.mix,u_opacity:B.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:i.cP(H.paint.get("raster-saturation")),u_contrast_factor:i.cQ(H.paint.get("raster-contrast")),u_spin_weights:qt(H.paint.get("raster-hue-rotate")),u_perspective_transform:W,u_raster_elevation:ee,u_zoom_transition:S,u_merc_center:L,u_cutoff_params:N,u_colorization_mix:Ze(i.cR,oe,pe),u_colorization_offset:tn(i.cR,fe,pe),u_color_ramp:ce,u_texture_offset:[De/(Te+2*De),Te/(Te+2*De)],u_texture_res:[Te+2*De,Te+2*De],u_emissive_strength:Ie});function qt(m){m*=Math.PI/180;const r=Math.sin(m),l=Math.cos(m);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const mn=.05,Pt=(m,r,l,p,y,b,S,L,N,F,B,H)=>({u_matrix:m,u_normalize_matrix:r,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:F,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:H,u_zoom_transition:S,u_merc_center:L,u_cutoff_params:N}),Ot=(m,r,l,p,y,b,S,L,N,F)=>({u_particle_texture:m,u_particle_texture_side_len:r,u_tile_offset:l,u_velocity:p,u_color_ramp:b,u_velocity_res:y,u_max_speed:S,u_uv_offset:L,u_data_scale:[255*N[0],255*N[1]],u_data_offset:F,u_particle_pos_scale:1.1,u_particle_pos_offset:[mn,mn]}),Ut=(m,r,l,p,y,b,S,L,N,F)=>({u_particle_texture:m,u_particle_texture_side_len:r,u_velocity:l,u_velocity_res:p,u_max_speed:y,u_speed_factor:b,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:L,u_data_scale:[255*N[0],255*N[1]],u_data_offset:F,u_particle_pos_scale:1.1,u_particle_pos_offset:[mn,mn]}),wn=i.ad.mat4.create(),Pn=(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe,pe,Te,De,Ie,Ge)=>{const Be=y.transform,je={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Be.getCameraToCenterDistance(Te),u_rotate_symbol:+l,u_aspect_ratio:Be.width/Be.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:L,u_is_text:+F,u_elevation_from_sea:N?1:0,u_pitch_with_map:+p,u_texsize:B,u_texsize_icon:H,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:wn,u_up_vector:[0,-1,0],u_color_adj_mat:De,u_icon_transition:Ie||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(Te)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:+W,u_scale_factor:Ge||1};return Te.name==="globe"&&(je.u_tile_id=[ee.canonical.x,ee.canonical.y,1<<ee.canonical.z],je.u_zoom_transition=ce,je.u_inv_rot_matrix=fe,je.u_merc_center=oe,je.u_camera_forward=Be._camera.forward(),je.u_ecef_origin=i.cS(Be.globeMatrix,ee.toUnwrapped()),je.u_tile_matrix=Float32Array.from(Be.globeMatrix),je.u_up_vector=pe),je},Tn=(m,r,l,p)=>({u_matrix:m,u_emissive_strength:r,u_opacity:l,u_color:p}),rr=(m,r,l,p,y,b,S,L,N)=>i.l(function(F,B,H,W,ee,ce){const{width:oe,height:fe}=W.imageManager.getPixelSize(B),pe=Math.pow(2,ce.tileID.overscaledZ),Te=ce.tileSize*Math.pow(2,W.transform.tileZoom)/pe,De=Te*(ce.tileID.canonical.x+ce.tileID.wrap*pe),Ie=Te*ce.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[oe,fe],u_pattern_size:H.displaySize,u_pattern_units_to_pixels:ee?[W.transform.width,-1*W.transform.height]:[1/i.at(ce,1,W.transform.tileZoom),1/i.at(ce,1,W.transform.tileZoom)],u_pixel_coord_upper:[De>>16,Ie>>16],u_pixel_coord_lower:[65535&De,65535&Ie]}}(0,b,S,p,L,N),{u_matrix:m,u_emissive_strength:r,u_opacity:l}),qn=new Float32Array(i.ad.mat4.identity([])),Ar=(m,r,l,p,y,b,S,L,N,F,B,H,W,ee=[0,0,0],ce)=>{const oe=y.style.light,fe=oe.properties.get("position"),pe=[-fe.x,-fe.y,fe.z],Te=i.ad.mat3.create();oe.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(Te,-y.transform.angle),i.ad.vec3.transformMat3(pe,pe,Te));const De=B.alphaMode==="MASK",Ie=oe.properties.get("color").toRenderColor(null),Ge=W.paint.get("model-ambient-occlusion-intensity"),Be=W.paint.get("model-color").constantOr(i.al.white).toRenderColor(null),je=W.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:r,u_normal_matrix:l,u_node_matrix:p||qn,u_lightpos:pe,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_camera_pos:ee,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+De,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[L[0],L[1],L[2],1],u_metallicFactor:N,u_roughnessFactor:F,u_baseColorTexture:Di.BaseColor,u_metallicRoughnessTexture:Di.MetallicRoughness,u_normalTexture:Di.Normal,u_occlusionTexture:Di.Occlusion,u_emissionTexture:Di.Emission,u_lutTexture:Di.LUT,u_color_mix:[Be.r,Be.g,Be.b,je],u_aoIntensity:Ge,u_emissive_strength:H,u_occlusionTextureTransform:ce||[0,0,0,0]}},Zn=(m,r=qn,l=qn)=>({u_matrix:m,u_instance:r,u_node_matrix:l}),ki={fillExtrusion:m=>({u_matrix:new i.bJ(m),u_lightpos:new i.bL(m),u_lightintensity:new i.bM(m),u_lightcolor:new i.bL(m),u_vertical_gradient:new i.bM(m),u_opacity:new i.bM(m),u_edge_radius:new i.bM(m),u_width_scale:new i.bM(m),u_ao:new i.bK(m),u_height_type:new i.bN(m),u_base_type:new i.bN(m),u_tile_id:new i.bL(m),u_zoom_transition:new i.bM(m),u_inv_rot_matrix:new i.bJ(m),u_merc_center:new i.bK(m),u_up_dir:new i.bL(m),u_height_lift:new i.bM(m),u_flood_light_color:new i.bL(m),u_vertical_scale:new i.bM(m),u_flood_light_intensity:new i.bM(m),u_ground_shadow_factor:new i.bL(m)}),fillExtrusionDepth:m=>({u_matrix:new i.bJ(m),u_edge_radius:new i.bM(m),u_width_scale:new i.bM(m),u_vertical_scale:new i.bM(m),u_height_type:new i.bN(m),u_base_type:new i.bN(m)}),fillExtrusionPattern:m=>({u_matrix:new i.bJ(m),u_lightpos:new i.bL(m),u_lightintensity:new i.bM(m),u_lightcolor:new i.bL(m),u_vertical_gradient:new i.bM(m),u_height_factor:new i.bM(m),u_edge_radius:new i.bM(m),u_width_scale:new i.bM(m),u_ao:new i.bK(m),u_height_type:new i.bN(m),u_base_type:new i.bN(m),u_tile_id:new i.bL(m),u_zoom_transition:new i.bM(m),u_inv_rot_matrix:new i.bJ(m),u_merc_center:new i.bK(m),u_up_dir:new i.bL(m),u_height_lift:new i.bM(m),u_image:new i.bN(m),u_texsize:new i.bK(m),u_pixel_coord_upper:new i.bK(m),u_pixel_coord_lower:new i.bK(m),u_tile_units_to_pixels:new i.bM(m),u_opacity:new i.bM(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new i.bJ(m),u_opacity:new i.bM(m),u_ao_pass:new i.bM(m),u_meter_to_tile:new i.bM(m),u_ao:new i.bK(m),u_flood_light_intensity:new i.bM(m),u_flood_light_color:new i.bL(m),u_attenuation:new i.bM(m),u_edge_radius:new i.bM(m),u_fb:new i.bN(m),u_fb_size:new i.bM(m),u_dynamic_offset:new i.bM(m)}),fill:m=>({u_matrix:new i.bJ(m),u_emissive_strength:new i.bM(m)}),fillPattern:m=>({u_matrix:new i.bJ(m),u_emissive_strength:new i.bM(m),u_image:new i.bN(m),u_texsize:new i.bK(m),u_pixel_coord_upper:new i.bK(m),u_pixel_coord_lower:new i.bK(m),u_tile_units_to_pixels:new i.bM(m)}),fillOutline:m=>({u_matrix:new i.bJ(m),u_emissive_strength:new i.bM(m),u_world:new i.bK(m)}),fillOutlinePattern:m=>({u_matrix:new i.bJ(m),u_emissive_strength:new i.bM(m),u_world:new i.bK(m),u_image:new i.bN(m),u_texsize:new i.bK(m),u_pixel_coord_upper:new i.bK(m),u_pixel_coord_lower:new i.bK(m),u_tile_units_to_pixels:new i.bM(m)}),elevatedStructures:m=>({u_matrix:new i.bJ(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new i.bJ(m),u_camera_pos:new i.bL(m),u_depth_bias:new i.bM(m),u_height_scale:new i.bM(m),u_reset_depth:new i.bM(m)}),circle:i.cT,collisionBox:m=>({u_matrix:new i.bJ(m),u_camera_to_center_distance:new i.bM(m),u_extrude_scale:new i.bK(m)}),collisionCircle:m=>({u_matrix:new i.bJ(m),u_inv_matrix:new i.bJ(m),u_camera_to_center_distance:new i.bM(m),u_viewport_size:new i.bK(m)}),debug:m=>({u_color:new i.cA(m),u_matrix:new i.bJ(m),u_overlay:new i.bN(m),u_overlay_scale:new i.bM(m)}),clippingMask:m=>({u_matrix:new i.bJ(m)}),heatmap:m=>({u_extrude_scale:new i.bM(m),u_intensity:new i.bM(m),u_matrix:new i.bJ(m),u_inv_rot_matrix:new i.bJ(m),u_merc_center:new i.bK(m),u_tile_id:new i.bL(m),u_zoom_transition:new i.bM(m),u_up_dir:new i.bL(m)}),heatmapTexture:m=>({u_image:new i.bN(m),u_color_ramp:new i.bN(m),u_opacity:new i.bM(m)}),hillshade:m=>({u_matrix:new i.bJ(m),u_image:new i.bN(m),u_latrange:new i.bK(m),u_light:new i.bK(m),u_shadow:new i.cA(m),u_highlight:new i.cA(m),u_emissive_strength:new i.bM(m),u_accent:new i.cA(m)}),hillshadePrepare:m=>({u_matrix:new i.bJ(m),u_image:new i.bN(m),u_dimension:new i.bK(m),u_zoom:new i.bM(m)}),line:i.cU,linePattern:i.cV,raster:m=>({u_matrix:new i.bJ(m),u_normalize_matrix:new i.bJ(m),u_globe_matrix:new i.bJ(m),u_merc_matrix:new i.bJ(m),u_grid_matrix:new i.cB(m),u_tl_parent:new i.bK(m),u_scale_parent:new i.bM(m),u_fade_t:new i.bM(m),u_opacity:new i.bM(m),u_image0:new i.bN(m),u_image1:new i.bN(m),u_brightness_low:new i.bM(m),u_brightness_high:new i.bM(m),u_saturation_factor:new i.bM(m),u_contrast_factor:new i.bM(m),u_spin_weights:new i.bL(m),u_perspective_transform:new i.bK(m),u_raster_elevation:new i.bM(m),u_zoom_transition:new i.bM(m),u_merc_center:new i.bK(m),u_cutoff_params:new i.cb(m),u_colorization_mix:new i.cb(m),u_colorization_offset:new i.bM(m),u_color_ramp:new i.bN(m),u_texture_offset:new i.bK(m),u_texture_res:new i.bK(m),u_emissive_strength:new i.bM(m)}),rasterParticle:m=>({u_matrix:new i.bJ(m),u_normalize_matrix:new i.bJ(m),u_globe_matrix:new i.bJ(m),u_merc_matrix:new i.bJ(m),u_grid_matrix:new i.cB(m),u_tl_parent:new i.bK(m),u_scale_parent:new i.bM(m),u_fade_t:new i.bM(m),u_opacity:new i.bM(m),u_image0:new i.bN(m),u_image1:new i.bN(m),u_raster_elevation:new i.bM(m),u_zoom_transition:new i.bM(m),u_merc_center:new i.bK(m),u_cutoff_params:new i.cb(m)}),rasterParticleTexture:m=>({u_texture:new i.bN(m),u_opacity:new i.bM(m)}),rasterParticleDraw:m=>({u_particle_texture:new i.bN(m),u_particle_texture_side_len:new i.bM(m),u_tile_offset:new i.bK(m),u_velocity:new i.bN(m),u_color_ramp:new i.bN(m),u_velocity_res:new i.bK(m),u_max_speed:new i.bM(m),u_uv_offset:new i.bK(m),u_data_scale:new i.bK(m),u_data_offset:new i.bM(m),u_particle_pos_scale:new i.bM(m),u_particle_pos_offset:new i.bK(m)}),rasterParticleUpdate:m=>({u_particle_texture:new i.bN(m),u_particle_texture_side_len:new i.bM(m),u_velocity:new i.bN(m),u_velocity_res:new i.bK(m),u_max_speed:new i.bM(m),u_speed_factor:new i.bM(m),u_reset_rate:new i.bM(m),u_rand_seed:new i.bM(m),u_uv_offset:new i.bK(m),u_data_scale:new i.bK(m),u_data_offset:new i.bM(m),u_particle_pos_scale:new i.bM(m),u_particle_pos_offset:new i.bK(m)}),symbol:m=>({u_is_size_zoom_constant:new i.bN(m),u_is_size_feature_constant:new i.bN(m),u_size_t:new i.bM(m),u_size:new i.bM(m),u_camera_to_center_distance:new i.bM(m),u_rotate_symbol:new i.bN(m),u_aspect_ratio:new i.bM(m),u_fade_change:new i.bM(m),u_matrix:new i.bJ(m),u_label_plane_matrix:new i.bJ(m),u_coord_matrix:new i.bJ(m),u_is_text:new i.bN(m),u_elevation_from_sea:new i.bN(m),u_pitch_with_map:new i.bN(m),u_texsize:new i.bK(m),u_texsize_icon:new i.bK(m),u_texture:new i.bN(m),u_texture_icon:new i.bN(m),u_gamma_scale:new i.bM(m),u_device_pixel_ratio:new i.bM(m),u_tile_id:new i.bL(m),u_zoom_transition:new i.bM(m),u_inv_rot_matrix:new i.bJ(m),u_merc_center:new i.bK(m),u_camera_forward:new i.bL(m),u_tile_matrix:new i.bJ(m),u_up_vector:new i.bL(m),u_ecef_origin:new i.bL(m),u_is_halo:new i.bN(m),u_icon_transition:new i.bM(m),u_color_adj_mat:new i.bJ(m),u_scale_factor:new i.bM(m)}),background:m=>({u_matrix:new i.bJ(m),u_emissive_strength:new i.bM(m),u_opacity:new i.bM(m),u_color:new i.cA(m)}),backgroundPattern:m=>({u_matrix:new i.bJ(m),u_emissive_strength:new i.bM(m),u_opacity:new i.bM(m),u_image:new i.bN(m),u_pattern_tl:new i.bK(m),u_pattern_br:new i.bK(m),u_texsize:new i.bK(m),u_pattern_size:new i.bK(m),u_pixel_coord_upper:new i.bK(m),u_pixel_coord_lower:new i.bK(m),u_pattern_units_to_pixels:new i.bK(m)}),terrainRaster:m=>({u_matrix:new i.bJ(m),u_image0:new i.bN(m),u_skirt_height:new i.bM(m),u_ground_shadow_factor:new i.bL(m)}),skybox:m=>({u_matrix:new i.bJ(m),u_sun_direction:new i.bL(m),u_cubemap:new i.bN(m),u_opacity:new i.bM(m),u_temporal_offset:new i.bM(m)}),skyboxGradient:m=>({u_matrix:new i.bJ(m),u_color_ramp:new i.bN(m),u_center_direction:new i.bL(m),u_radius:new i.bM(m),u_opacity:new i.bM(m),u_temporal_offset:new i.bM(m)}),skyboxCapture:m=>({u_matrix_3f:new i.cB(m),u_sun_direction:new i.bL(m),u_sun_intensity:new i.bM(m),u_color_tint_r:new i.cb(m),u_color_tint_m:new i.cb(m),u_luminance:new i.bM(m)}),globeRaster:m=>({u_proj_matrix:new i.bJ(m),u_globe_matrix:new i.bJ(m),u_normalize_matrix:new i.bJ(m),u_merc_matrix:new i.bJ(m),u_zoom_transition:new i.bM(m),u_merc_center:new i.bK(m),u_image0:new i.bN(m),u_grid_matrix:new i.cB(m),u_skirt_height:new i.bM(m),u_far_z_cutoff:new i.bM(m),u_frustum_tl:new i.bL(m),u_frustum_tr:new i.bL(m),u_frustum_br:new i.bL(m),u_frustum_bl:new i.bL(m),u_globe_pos:new i.bL(m),u_globe_radius:new i.bM(m),u_viewport:new i.bK(m)}),globeAtmosphere:m=>({u_frustum_tl:new i.bL(m),u_frustum_tr:new i.bL(m),u_frustum_br:new i.bL(m),u_frustum_bl:new i.bL(m),u_horizon:new i.bM(m),u_transition:new i.bM(m),u_fadeout_range:new i.bM(m),u_color:new i.cb(m),u_high_color:new i.cb(m),u_space_color:new i.cb(m),u_temporal_offset:new i.bM(m),u_horizon_angle:new i.bM(m)}),model:m=>({u_matrix:new i.bJ(m),u_lighting_matrix:new i.bJ(m),u_normal_matrix:new i.bJ(m),u_node_matrix:new i.bJ(m),u_lightpos:new i.bL(m),u_lightintensity:new i.bM(m),u_lightcolor:new i.bL(m),u_camera_pos:new i.bL(m),u_opacity:new i.bM(m),u_baseColorFactor:new i.cb(m),u_emissiveFactor:new i.cb(m),u_metallicFactor:new i.bM(m),u_roughnessFactor:new i.bM(m),u_baseTextureIsAlpha:new i.bN(m),u_alphaMask:new i.bN(m),u_alphaCutoff:new i.bM(m),u_baseColorTexture:new i.bN(m),u_metallicRoughnessTexture:new i.bN(m),u_normalTexture:new i.bN(m),u_occlusionTexture:new i.bN(m),u_emissionTexture:new i.bN(m),u_lutTexture:new i.bN(m),u_color_mix:new i.cb(m),u_aoIntensity:new i.bM(m),u_emissive_strength:new i.bM(m),u_occlusionTextureTransform:new i.cb(m)}),modelDepth:m=>({u_matrix:new i.bJ(m),u_instance:new i.bJ(m),u_node_matrix:new i.bJ(m)}),groundShadow:m=>({u_matrix:new i.bJ(m),u_ground_shadow_factor:new i.bL(m)}),stars:m=>({u_matrix:new i.bJ(m),u_up:new i.bL(m),u_right:new i.bL(m),u_intensity_multiplier:new i.bM(m)}),snowParticle:m=>({u_modelview:new i.bJ(m),u_projection:new i.bJ(m),u_time:new i.bM(m),u_cam_pos:new i.bL(m),u_velocityConeAperture:new i.bM(m),u_velocity:new i.bM(m),u_horizontalOscillationRadius:new i.bM(m),u_horizontalOscillationRate:new i.bM(m),u_boxSize:new i.bM(m),u_billboardSize:new i.bM(m),u_simpleShapeParameters:new i.bK(m),u_screenSize:new i.bK(m),u_thinningCenterPos:new i.bK(m),u_thinningShape:new i.bL(m),u_thinningAffectedRatio:new i.bM(m),u_thinningParticleOffset:new i.bM(m),u_particleColor:new i.cb(m),u_direction:new i.bL(m)}),rainParticle:m=>({u_modelview:new i.bJ(m),u_projection:new i.bJ(m),u_time:new i.bM(m),u_cam_pos:new i.bL(m),u_texScreen:new i.bN(m),u_velocityConeAperture:new i.bM(m),u_velocity:new i.bM(m),u_boxSize:new i.bM(m),u_rainDropletSize:new i.bK(m),u_distortionStrength:new i.bM(m),u_rainDirection:new i.bL(m),u_color:new i.cb(m),u_screenSize:new i.bK(m),u_thinningCenterPos:new i.bK(m),u_thinningShape:new i.bL(m),u_thinningAffectedRatio:new i.bM(m),u_thinningParticleOffset:new i.bM(m),u_shapeDirectionalPower:new i.bM(m),u_shapeNormalPower:new i.bM(m),u_mode:new i.bM(m)}),vignette:m=>({u_vignetteShape:new i.bL(m),u_vignetteColor:new i.cb(m)}),occlusion:m=>({u_matrix:new i.bJ(m),u_anchorPos:new i.bL(m),u_screenSizePx:new i.bK(m),u_occluderSizePx:new i.bK(m),u_color:new i.cb(m)})};class mi{constructor(r,l,p,y){this.id=mi.uniqueIdxCounter,mi.uniqueIdxCounter++,this.context=r;const b=r.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=mi.uniqueIdxCounter,mi.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}mi.uniqueIdxCounter=0;const Ti={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class gi{constructor(r,l,p,y,b,S){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.instanceCount=S,this.context=r;const L=r.gl;this.buffer=L.createBuffer(),r.bindVertexBuffer.set(this.buffer),L.bufferData(L.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?L.DYNAMIC_DRAW:L.STATIC_DRAW),this.dynamicDraw||b||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const y=l.attributes[this.attributes[p].name];y!==void 0&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,l,p){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],S=l.attributes[b.name];S!==void 0&&r.vertexAttribPointer(S,b.components,r[Ti[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(r,l,p){for(let y=0;y<this.attributes.length;y++){const b=l.attributes[this.attributes[y].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class oi{constructor(r,l,p,y,b){this.context=r,this.width=l,this.height=p;const S=this.framebuffer=r.gl.createFramebuffer();y&&(this.colorAttachment=new ga(r,S)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new Qp(r,S):new Eh(r,S))}destroy(){const r=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&r.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&r.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&r.deleteTexture(l)}r.deleteFramebuffer(this.framebuffer)}}class Ai{constructor(r,l){this.gl=r,this.clearColor=new _f(this),this.clearDepth=new Th(this),this.clearStencil=new yd(this),this.colorMask=new yf(this),this.depthMask=new vd(this),this.stencilMask=new vf(this),this.stencilFunc=new xd(this),this.stencilOp=new Wp(this),this.stencilTest=new bd(this),this.depthRange=new wd(this),this.depthTest=new Zp(this),this.depthFunc=new Ia(this),this.blend=new Kp(this),this.blendFunc=new xf(this),this.blendColor=new bf(this),this.blendEquation=new Xp(this),this.cullFace=new Sd(this),this.cullFaceSide=new Td(this),this.frontFace=new su(this),this.program=new Yp(this),this.activeTexture=new Jp(this),this.viewport=new Ad(this),this.bindFramebuffer=new mg(this),this.bindRenderbuffer=new gg(this),this.bindTexture=new Ah(this),this.bindVertexBuffer=new g0(this),this.bindElementBuffer=new ou(this),this.bindVertexArrayOES=new Tl(this),this.pixelStoreUnpack=new Mc(this),this.pixelStoreUnpackPremultiplyAlpha=new _0(this),this.pixelStoreUnpackFlipY=new _g(this),this.options=l?Object.assign({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l,p){return new mi(this,r,l,p)}createVertexBuffer(r,l,p,y,b){return new gi(this,r,l,p,y,b)}createRenderbuffer(r,l,p){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),b}createFramebuffer(r,l,p,y){return new oi(this,r,l,p,y)}clear({color:r,depth:l,stencil:p,colorMask:y}){const b=this.gl;let S=0;r&&(S|=b.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(y||[!0,!0,!0,!0])),l!==void 0&&(S|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(S|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(S)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){i.bn(r.blendFunction,Jn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Hr;function xs(m,r,l,p,y,b,S){const L=m.context,N=L.gl,F=m.transform,B=m.getOrCreateProgram("collisionBox"),H=[];let W=0,ee=0;for(let Ie=0;Ie<p.length;Ie++){const Ge=p[Ie],Be=r.getTile(Ge),je=Be.getBucket(l);if(!je)continue;const Ue=ku(Ge,je,F);let Ke=Ue;y[0]===0&&y[1]===0||(Ke=m.translatePosMatrix(Ue,Be,y,b));const nt=S?je.textCollisionBox:je.iconCollisionBox,kt=je.collisionCircleArray;if(kt.length>0){const xt=i.ad.mat4.create(),Zt=Ke;i.ad.mat4.mul(xt,je.placementInvProjMatrix,F.glCoordMatrix),i.ad.mat4.mul(xt,xt,je.placementViewportMatrix),H.push({circleArray:kt,circleOffset:ee,transform:Zt,invTransform:xt,projection:je.getProjection()}),W+=kt.length/4,ee=W}nt&&(m.terrain&&m.terrain.setupElevationDraw(Be,B),B.draw(m,N.LINES,Rn.disabled,Hn.disabled,m.colorModeForRenderPass(),Xn.disabled,ze(Ke,F,Be,je.getProjection()),l.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,F.zoom,null,[nt.collisionVertexBuffer,nt.collisionVertexBufferExt]))}if(!S||!H.length)return;const ce=m.getOrCreateProgram("collisionCircle"),oe=new i.cW;oe.resize(4*W),oe._trim();let fe=0;for(const Ie of H)for(let Ge=0;Ge<Ie.circleArray.length/4;Ge++){const Be=4*Ge,je=Ie.circleArray[Be+0],Ue=Ie.circleArray[Be+1],Ke=Ie.circleArray[Be+2],nt=Ie.circleArray[Be+3];oe.emplace(fe++,je,Ue,Ke,nt,0),oe.emplace(fe++,je,Ue,Ke,nt,1),oe.emplace(fe++,je,Ue,Ke,nt,2),oe.emplace(fe++,je,Ue,Ke,nt,3)}(!Hr||Hr.length<2*W)&&(Hr=function(Ie){const Ge=2*Ie,Be=new i.aV;Be.resize(Ge),Be._trim();for(let je=0;je<Ge;je++){const Ue=6*je;Be.uint16[Ue+0]=4*je+0,Be.uint16[Ue+1]=4*je+1,Be.uint16[Ue+2]=4*je+2,Be.uint16[Ue+3]=4*je+2,Be.uint16[Ue+4]=4*je+3,Be.uint16[Ue+5]=4*je+0}return Be}(W));const pe=L.createIndexBuffer(Hr,!0),Te=L.createVertexBuffer(oe,i.cX.members,!0);for(const Ie of H){const Ge={u_matrix:Ie.transform,u_inv_matrix:Ie.invTransform,u_camera_to_center_distance:(De=F).getCameraToCenterDistance(Ie.projection),u_viewport_size:[De.width,De.height]};ce.draw(m,N.TRIANGLES,Rn.disabled,Hn.disabled,m.colorModeForRenderPass(),Xn.disabled,Ge,l.id,Te,pe,i.b8.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,F.zoom)}var De;Te.destroy(),pe.destroy()}const ro=i.ad.mat4.create();function bs(m){const r=m._camera.getWorldToCamera(m.worldSize,1),l=i.ad.mat4.multiply([],r,m.globeMatrix);i.ad.mat4.invert(l,l);const p=[0,0,0],y=[0,1,0,0];return i.ad.vec4.transformMat4(y,y,l),p[0]=y[0],p[1]=y[1],p[2]=y[2],i.ad.vec3.normalize(p,p),p}function ea({width:m,height:r,anchor:l,textOffset:p,textScale:y},b){const{horizontalAlign:S,verticalAlign:L}=i.bD(l),N=-(S-.5)*m,F=-(L-.5)*r,B=i.bC(l,p);return new i.P((N/y+B[0])*b,(F/y+B[1])*b)}function ci(m,r,l,p,y,b,S,L,N,F,B){const H=m.text.placedSymbolArray,W=m.text.dynamicLayoutVertexArray,ee=m.icon.dynamicLayoutVertexArray,ce={},oe=m.getProjection(),fe=To(L,oe,b),pe=b.elevation,Te=oe.upVectorScale(L.canonical,b.center.lat,b.worldSize).metersToTile;W.clear();for(let De=0;De<H.length;De++){const Ie=H.get(De),{tileAnchorX:Ge,tileAnchorY:Be,numGlyphs:je}=Ie,Ue=Ie.hidden||!Ie.crossTileID||m.allowVerticalPlacement&&!Ie.placedOrientation?null:p[Ie.crossTileID];if(Ue){let Ke=0,nt=0,kt=0;if(pe){const Bt=pe?pe.getAtTileOffset(L,Ge,Be):0,[Xt,Rt,Qt]=oe.upVector(L.canonical,Ge,Be);Ke=Bt*Xt*Te,nt=Bt*Rt*Te,kt=Bt*Qt*Te}let[xt,Zt,Kt,ln]=Fo(Ie.projectedAnchorX+Ke,Ie.projectedAnchorY+nt,Ie.projectedAnchorZ+kt,l?fe:S);const vt=xc(b.getCameraToCenterDistance(oe),ln);let Ht=y.evaluateSizeForFeature(m.textSizeData,F,Ie)*vt/i.bw;l&&(Ht*=m.tilePixelRatio/N);const mt=ea(Ue,Ht);l?({x:xt,y:Zt,z:Kt}=oe.projectTilePoint(Ge+mt.x,Be+mt.y,L.canonical),[xt,Zt,Kt]=Fo(xt+Ke,Zt+nt,Kt+kt,S)):(r&&mt._rotate(-b.angle),xt+=mt.x,Zt+=mt.y,Kt=0);const Gt=m.allowVerticalPlacement&&Ie.placedOrientation===i.bq.vertical?Math.PI/2:0;for(let Bt=0;Bt<je;Bt++)i.bt(W,xt,Zt,Kt,Gt);B&&Ie.associatedIconIndex>=0&&(ce[Ie.associatedIconIndex]={x:xt,y:Zt,z:Kt,angle:Gt})}else Xo(je,W)}if(B){ee.clear();const De=m.icon.placedSymbolArray;for(let Ie=0;Ie<De.length;Ie++){const Ge=De.get(Ie),{numGlyphs:Be}=Ge,je=ce[Ie];if(Ge.hidden||!je)Xo(Be,ee);else{const{x:Ue,y:Ke,z:nt,angle:kt}=je;for(let xt=0;xt<Be;xt++)i.bt(ee,Ue,Ke,nt,kt)}}m.icon.dynamicLayoutVertexBuffer.updateData(ee)}m.text.dynamicLayoutVertexBuffer.updateData(W)}function Nr(m,r,l,p,y,b,S={}){const L=l.paint.get("icon-translate"),N=l.paint.get("text-translate"),F=l.paint.get("icon-translate-anchor"),B=l.paint.get("text-translate-anchor"),H=l.layout.get("icon-rotation-alignment"),W=l.layout.get("text-rotation-alignment"),ee=l.layout.get("icon-pitch-alignment"),ce=l.layout.get("text-pitch-alignment"),oe=l.layout.get("icon-keep-upright"),fe=l.layout.get("text-keep-upright"),pe=l.paint.get("icon-color-saturation"),Te=l.paint.get("icon-color-contrast"),De=l.paint.get("icon-color-brightness-min"),Ie=l.paint.get("icon-color-brightness-max"),Ge=l.layout.get("symbol-elevation-reference")==="sea",Be=m.context,je=Be.gl,Ue=m.transform,Ke=H==="map",nt=W==="map",kt=ee==="map",xt=ce==="map",Zt=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Kt=!1;const ln=m.depthModeForSublayer(0,Rn.ReadOnly),vt=[i.av(Ue.center.lng),i.aC(Ue.center.lat)],Ht=l.layout.get("text-variable-anchor"),mt=Ue.projection.name==="globe",Gt=[],Bt=[0,-1,0];for(const Xt of p){const Rt=r.getTile(Xt),Qt=Rt.getBucket(l);if(!Qt||Qt.projection.name==="mercator"&&mt||Qt.fullyClipped)continue;const gn=Qt.projection.name==="globe",_n=gn?i.ag(Ue.zoom):0,xn=To(Xt,Qt.getProjection(),Ue),Dn=Ue.calculatePixelsToTileUnitsMatrix(Rt),ar=Ht&&Qt.hasTextData(),Vn=Qt.hasIconTextFit()&&ar&&Qt.hasIconData(),ir=Qt.getProjection().createInversionMatrix(Ue,Xt.canonical),Yn=ai=>{Ue.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||m.terrain)&&(ai.push("DEPTH_D24"),ai.push("DEPTH_OCCLUSION"))},Cr=()=>{const ai=Ke&&l.layout.get("symbol-placement")!=="point",Yr=[];Yn(Yr);const rs=ai||Vn,Ms=l.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&kt&&Yr.push("PITCH_WITH_MAP_TERRAIN"),gn&&(Yr.push("PROJECTION_GLOBE_VIEW"),rs&&Yr.push("PROJECTED_POS_ON_VIEWPORT")),Ms>0&&Yr.push("ICON_TRANSITION"),Qt.icon.zOffsetVertexBuffer&&Yr.push("Z_OFFSET"),pe===0&&Te===0&&De===0&&Ie===1||Yr.push("COLOR_ADJUSTMENT"),Qt.sdfIcons&&Yr.push("RENDER_SDF");const Js=Qt.icon.programConfigurations.get(l.id),so=m.getOrCreateProgram("symbol",{config:Js,defines:Yr}),Dl=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],ia=Qt.iconSizeData,Wr=i.bp(ia,Ue.zoom),Gi=kt||Ue.pitch!==0,ii=yl(xn,Rt.tileID.canonical,kt,Ke,Ue,Qt.getProjection(),Dn),xi=Ui(xn,Rt.tileID.canonical,kt,Ke,Ue,Qt.getProjection(),Dn),Mo=m.translatePosMatrix(xi,Rt,L,F,!0),zi=m.translatePosMatrix(xn,Rt,L,F),Qs=rs?ro:ii,uu=Ke&&!kt&&!ai;let el=Bt;!mt&&!Ue.mercatorFromTransition||Ke||(el=bs(Ue));const oc=gn?el:Bt,Ra=l.getColorAdjustmentMatrix(pe,Te,De,Ie),ac=Pn(ia.kind,Wr,uu,kt,m,zi,Qs,Mo,Ge,!1,Dl,[0,0],!0,Xt,_n,vt,ir,oc,Qt.getProjection(),Ra,Ms),tl=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,$u=l.layout.get("icon-size").constantOr(0)!==1||Qt.iconsNeedLinear,hu=Qt.sdfIcons||m.options.rotating||m.options.zooming||$u||Gi?je.LINEAR:je.NEAREST,Gu=Qt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,M0=m.terrain&&kt&&ai?i.ad.mat4.invert(i.ad.mat4.create(),ii):ro;if(ai&&Qt.icon){const Df=Ue.elevation,Mg=Df?Df.getAtTileOffsetFunc(Xt,Ue.center.lat,Ue.worldSize,Qt.getProjection()):null,I0=hs(xn,Rt.tileID.canonical,kt,Ke,Ue,Qt.getProjection(),Dn);bc(Qt,xn,m,!1,I0,xi,kt,oe,Mg,Xt)}return{program:so,buffers:Qt.icon,uniformValues:ac,atlasTexture:tl,atlasTextureIcon:null,atlasInterpolation:hu,atlasInterpolationIcon:null,isSDF:Qt.sdfIcons,hasHalo:Gu,tile:Rt,labelPlaneMatrixInv:M0}},ri=()=>{const ai=nt&&l.layout.get("symbol-placement")!=="point",Yr=[],rs=ai||Ht||Vn;m.terrainRenderModeElevated()&&xt&&Yr.push("PITCH_WITH_MAP_TERRAIN"),gn&&(Yr.push("PROJECTION_GLOBE_VIEW"),rs&&Yr.push("PROJECTED_POS_ON_VIEWPORT")),Qt.text.zOffsetVertexBuffer&&Yr.push("Z_OFFSET"),Qt.iconsInText&&Yr.push("RENDER_TEXT_AND_SYMBOL"),Yr.push("RENDER_SDF"),Yn(Yr);const Ms=Qt.text.programConfigurations.get(l.id),Js=m.getOrCreateProgram("symbol",{config:Ms,defines:Yr});let so,Dl=[0,0],ia=null;const Wr=Qt.textSizeData;Qt.iconsInText&&(Dl=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],ia=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,so=xt||Ue.pitch!==0||m.options.rotating||m.options.zooming||Wr.kind==="composite"||Wr.kind==="camera"?je.LINEAR:je.NEAREST);const Gi=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture.size:[0,0],ii=l.layout.get("text-size-scale-range"),xi=i.ay(m.scaleFactor,ii[0],ii[1]),Mo=i.bp(Wr,Ue.zoom,xi),zi=yl(xn,Rt.tileID.canonical,xt,nt,Ue,Qt.getProjection(),Dn),Qs=Ui(xn,Rt.tileID.canonical,xt,nt,Ue,Qt.getProjection(),Dn),uu=m.translatePosMatrix(Qs,Rt,N,B,!0),el=m.translatePosMatrix(xn,Rt,N,B),oc=rs?ro:zi,Ra=nt&&!xt&&!ai;let ac=Bt;!mt&&!Ue.mercatorFromTransition||nt||(ac=bs(Ue));const tl=Pn(Wr.kind,Mo,Ra,xt,m,el,oc,uu,Ge,!0,Gi,Dl,!0,Xt,_n,vt,ir,gn?ac:Bt,Qt.getProjection(),null,null,xi),$u=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture:null,hu=je.LINEAR,Gu=l.paint.get("text-halo-width").constantOr(1)!==0,M0=m.terrain&&xt&&ai?i.ad.mat4.invert(i.ad.mat4.create(),zi):ro;if(ai&&Qt.text){const Df=Ue.elevation,Mg=Df?Df.getAtTileOffsetFunc(Xt,Ue.center.lat,Ue.worldSize,Qt.getProjection()):null,I0=hs(xn,Rt.tileID.canonical,xt,nt,Ue,Qt.getProjection(),Dn);bc(Qt,xn,m,!0,I0,Qs,xt,fe,Mg,Xt)}return{program:Js,buffers:Qt.text,uniformValues:tl,atlasTexture:$u,atlasTextureIcon:ia,atlasInterpolation:hu,atlasInterpolationIcon:so,isSDF:!0,hasHalo:Gu,tile:Rt,labelPlaneMatrixInv:M0}},Mi=Qt.icon.segments.get().length,xr=Qt.text.segments.get().length,$i=Mi&&!S.onlyText?Cr():null,cr=xr&&!S.onlyIcons?ri():null,Nn=l.paint.get("icon-opacity").constantOr(1),Lr=l.paint.get("text-opacity").constantOr(1);if(Zt&&Qt.canOverlap){Kt=!0;const ai=Nn&&!S.onlyText?Qt.icon.segments.get():[],Yr=Lr&&!S.onlyIcons?Qt.text.segments.get():[];for(const rs of ai)Gt.push({segments:new i.b8([rs]),sortKey:rs.sortKey,state:$i});for(const rs of Yr)Gt.push({segments:new i.b8([rs]),sortKey:rs.sortKey,state:cr})}else S.onlyText||Gt.push({segments:Nn?Qt.icon.segments:new i.b8([]),sortKey:0,state:$i}),S.onlyIcons||Gt.push({segments:Lr?Qt.text.segments:new i.b8([]),sortKey:0,state:cr})}Kt&&Gt.sort((Xt,Rt)=>Xt.sortKey-Rt.sortKey);for(const Xt of Gt){const Rt=Xt.state;if(Rt)if(m.terrain?m.terrain.setupElevationDraw(Rt.tile,Rt.program,{useDepthForOcclusion:Ue.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Rt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Ue.depthOcclusionForSymbolsAndCircles,Rt.program),Be.activeTexture.set(je.TEXTURE0),Rt.atlasTexture&&Rt.atlasTexture.bind(Rt.atlasInterpolation,je.CLAMP_TO_EDGE,!0),Rt.atlasTextureIcon&&(Be.activeTexture.set(je.TEXTURE1),Rt.atlasTextureIcon&&Rt.atlasTextureIcon.bind(Rt.atlasInterpolationIcon,je.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,Rt.program),Rt.hasHalo){const Qt=Rt.uniformValues;Qt.u_is_halo=1,mo(Rt.buffers,Xt.segments,l,m,Rt.program,ln,y,b,Qt,2),Qt.u_is_halo=0}else{if(Rt.isSDF){const Qt=Rt.uniformValues;Rt.hasHalo&&(Qt.u_is_halo=1,mo(Rt.buffers,Xt.segments,l,m,Rt.program,ln,y,b,Qt,1)),Qt.u_is_halo=0}mo(Rt.buffers,Xt.segments,l,m,Rt.program,ln,y,b,Rt.uniformValues,1)}}}function mo(m,r,l,p,y,b,S,L,N,F){const B=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,b,S,L,Xn.disabled,N,l.id,m.layoutVertexBuffer,m.indexBuffer,r,l.paint,p.transform.zoom,m.programConfigurations.get(l.id),B,F)}function Xs(m,r){const l=1<<m.canonical.z,p=(r.x*l-m.canonical.x-m.wrap*l)*i.ai,y=(r.y*l-m.canonical.y)*i.ai,b=i.d5(r.z,r.y);return i.ad.vec3.fromValues(p,y,b)}function io(m,r,l,p,y){if(!l.layout||l.layout.get("fill-elevation-reference")==="none")return;const b=m.context.gl,S=new Rn(m.context.gl.LEQUAL,Rn.ReadWrite,m.depthRangeFor3D),L=new Rn(m.context.gl.GREATER,Rn.ReadWrite,m.depthRangeFor3D),N=function(ee){const ce=i.c4(ee.pitch);let oe=.01;return ee.isOrthographic&&(oe=i.ah(1e-4,oe,i.c9(ce>=un?1:ce/un))),2*oe}(m.transform),F=m.transform.getFreeCameraOptions().position,B="elevatedStructuresDepthReconstruct",H=m.getOrCreateProgram(B,{defines:["DEPTH_RECONSTRUCTION"]}),W=m.getOrCreateProgram(B);for(const ee of p){const ce=r.getTile(ee),oe=ce.getBucket(l);if(!oe)continue;const fe=oe.elevatedStructures;if(!fe)continue;const pe=oe.elevationBufferData.heightRange,Te=Xs(ee.toUnwrapped(),F),De=m.translatePosMatrix(ee.projMatrix,ce,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));let Ie,Ge,Be,je;if(y==="initialize"){if(!pe||pe.min>=1||fe.depthSegments.segments[0].primitiveLength===0)continue;Ie=ke(De,Te,N,1,0),Ge=S,Be=fe.depthSegments,je=H}else if(y==="reset"){if(!pe||pe.min>=0||fe.maskSegments.segments[0].primitiveLength===0)continue;Ie=ke(De,Te,0,0,1),Ge=L,Be=fe.maskSegments,je=H}else if(y==="geometry"){if(fe.depthSegments.segments[0].primitiveLength===0)continue;Ie=ke(De,Te,N,1,0),Ge=S,Be=fe.depthSegments,je=W}je.draw(m,b.TRIANGLES,Ge,Hn.disabled,Jn.disabled,Xn.disabled,Ie,l.id,fe.vertexBuffer,fe.indexBuffer,Be,l.paint,m.transform.zoom)}}function go(m,r,l){const{painter:p,sourceCache:y,layer:b,coords:S,colorMode:L,elevationType:N,terrainEnabled:F,pass:B}=m,H=p.context.gl,W=b.paint.get("fill-pattern");let ee=N;N!=="road"||r&&!F||(ee="none");const ce=ee==="road",oe=new Rn(p.context.gl.LEQUAL,Rn.ReadWrite,p.depthRangeFor3D),fe=W&&W.constantOr(1),pe=(Te,De)=>{let Ie,Ge,Be,je,Ue;De?(Ge=fe&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ie=H.LINES):(Ge=fe?"fillPattern":"fill",Ie=H.TRIANGLES);for(const Ke of S){const nt=y.getTile(Ke);if(fe&&!nt.patternsLoaded())continue;const kt=nt.getBucket(b);if(!kt)continue;const xt=r?kt.elevationBufferData:kt.bufferData;if(xt.isEmpty())continue;p.prepareDrawTile();const Zt=xt.programConfigurations.get(b.id),Kt=p.isTileAffectedByFog(Ke),ln=[],vt=[];ce&&(ln.push("ELEVATED_ROADS"),vt.push(xt.elevatedLayoutVertexBuffer));const Ht=p.getOrCreateProgram(Ge,{config:Zt,overrideFog:Kt,defines:ln});fe&&(p.context.activeTexture.set(H.TEXTURE0),nt.imageAtlasTexture&&nt.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Zt.updatePaintBuffers());const mt=W.constantOr(null);if(mt&&nt.imageAtlas){const Xt=nt.imageAtlas,Rt=i.d0.from(mt).getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),Qt=Xt.patternPositions.get(Rt);Qt&&Zt.setConstantPatternPositions(Qt)}const Gt=p.translatePosMatrix(Ke.projMatrix,nt,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor")),Bt=b.paint.get("fill-emissive-strength");if(De){je=xt.lineIndexBuffer,Ue=xt.lineSegments;const Xt=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[H.drawingBufferWidth,H.drawingBufferHeight];Be=Ge==="fillOutlinePattern"&&fe?Ae(Gt,Bt,p,nt,Xt):de(Gt,Bt,Xt)}else je=xt.indexBuffer,Ue=xt.triangleSegments,Be=fe?ne(Gt,Bt,p,nt):q(Gt,Bt);p.uploadCommonUniforms(p.context,Ht,Ke.toUnwrapped()),Ht.draw(p,Ie,ee!=="none"?oe:Te,l||p.stencilModeForClipping(Ke),L,Xn.disabled,Be,b.id,xt.layoutVertexBuffer,je,Ue,b.paint,p.transform.zoom,Zt,vt)}};p.renderPass===B&&pe(p.depthModeForSublayer(1,p.renderPass==="opaque"?Rn.ReadWrite:Rn.ReadOnly),!1),ee==="none"&&p.renderPass==="translucent"&&b.paint.get("fill-antialias")&&pe(p.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Rn.ReadOnly),!0)}function Uo(m,r,l,p,y,b,S,L){l.resetLayerRenderingStats(m);const N=m.context,F=N.gl,B=m.transform,H=l.paint.get("fill-extrusion-pattern"),W=H.constantOr(1),ee=l.paint.get("fill-extrusion-opacity"),ce=m.style.enable3dLights(),oe=l.paint.get(ce&&!W?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),fe=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],pe=l.layout.get("fill-extrusion-edge-radius"),Te=pe>0&&!l.paint.get("fill-extrusion-rounded-roof"),De=Te?0:pe,Ie=B.projection.name==="globe"?i.d6():0,Ge=B.projection.name==="globe",Be=Ge?i.ag(B.zoom):0,je=[i.av(B.center.lng),i.aC(B.center.lat)],Ue=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ke=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ue?null:l.lut).toArray01().slice(0,3),nt=l.paint.get("fill-extrusion-flood-light-intensity"),kt=l.paint.get("fill-extrusion-vertical-scale"),xt=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Zt=l.paint.get("fill-extrusion-height-alignment"),Kt=l.paint.get("fill-extrusion-base-alignment"),ln=Ps(m,l.paint.get("fill-extrusion-cutoff-fade-range")),vt=[];let Ht;Ge&&vt.push("PROJECTION_GLOBE_VIEW"),fe[0]>0&&vt.push("FAUX_AO"),Te&&vt.push("ZERO_ROOF_RADIUS"),L&&vt.push("HAS_CENTROID"),nt>0&&vt.push("FLOOD_LIGHT"),ln.shouldRenderCutoff&&vt.push("RENDER_CUTOFF"),xt&&vt.push("RENDER_WALL_MODE");const mt=m.renderPass==="shadow",Gt=m.shadowRenderer,Bt=mt&&!!Gt;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Xt=[0,0,0];if(Gt){const gn=m.style.directionalLight,_n=m.style.ambientLight;gn&&_n&&(Xt=Tc(m.style,gn,_n)),mt||(vt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Gt.useNormalOffset&&vt.push("NORMAL_OFFSET")),Ht=vt.concat(["SHADOWS_SINGLE_CASCADE"])}const Rt=Bt?"fillExtrusionDepth":W?"fillExtrusionPattern":"fillExtrusion",Qt=l.getLayerRenderingStats();for(const gn of p){const _n=r.getTile(gn),xn=_n.getBucket(l);if(!xn||xn.projection.name!==B.projection.name)continue;let Dn=!1;Gt&&(Dn=Gt.getMaxCascadeForTile(gn.toUnwrapped())===0);const ar=m.isTileAffectedByFog(gn),Vn=xn.programConfigurations.get(l.id),ir=m.getOrCreateProgram(Rt,{config:Vn,defines:Dn?Ht:vt,overrideFog:ar});if(m.terrain&&m.terrain.setupElevationDraw(_n,ir,{useMeterToDem:!0}),!xn.centroidVertexBuffer){const cr=ir.attributes.a_centroid_pos;cr!==void 0&&F.vertexAttrib2f(cr,0,0)}!mt&&Gt&&Gt.setupShadows(_n.tileID.toUnwrapped(),ir,"vector-tile",_n.tileID.overscaledZ),W&&(m.context.activeTexture.set(F.TEXTURE0),_n.imageAtlasTexture&&_n.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Vn.updatePaintBuffers());const Yn=H.constantOr(null);if(Yn&&_n.imageAtlas){const cr=_n.imageAtlas,Nn=i.d0.from(Yn).getPrimary().scaleSelf(i.q.devicePixelRatio),Lr=cr.patternPositions.get(Nn.toString());Lr&&Vn.setConstantPatternPositions(Lr)}const Cr=l.paint.get("fill-extrusion-vertical-gradient"),ri=1/xn.tileToMeter;let Mi;if(mt&&Gt){if(La(_n.tileID,xn,m))continue;const cr=Gt.calculateShadowPassMatrixFromTile(_n.tileID.toUnwrapped());Mi=Fu(cr,De,ri,kt,Zt,Kt)}else{const cr=m.translatePosMatrix(gn.expandedProjMatrix,_n,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Nn=B.projection.createInversionMatrix(B,gn.canonical);Mi=W?D(cr,m,Cr,ee,fe,De,ri,gn,_n,Ie,Zt,Kt,Be,je,Nn,Ke,kt):Ef(cr,m,Cr,ee,fe,De,ri,gn,Ie,Zt,Kt,Be,je,Nn,Ke,kt,nt,Xt)}m.uploadCommonUniforms(N,ir,gn.toUnwrapped(),null,ln);let xr=xn.segments;if(B.projection.name==="mercator"&&!mt&&(xr=xn.getVisibleSegments(_n.tileID,m.terrain,m.transform.getFrustum(0)),!xr.get().length))continue;if(Qt)if(mt)for(const cr of xr.get())Qt.numRenderedVerticesInShadowPass+=cr.primitiveLength;else for(const cr of xr.get())Qt.numRenderedVerticesInTransparentPass+=cr.primitiveLength;const $i=[];(m.terrain||L)&&$i.push(xn.centroidVertexBuffer),Ge&&$i.push(xn.layoutVertexExtBuffer),xt&&$i.push(xn.wallVertexBuffer),ir.draw(m,N.gl.TRIANGLES,y,b,S,Xn.backCCW,Mi,l.id,xn.layoutVertexBuffer,xn.indexBuffer,xr,l.paint,m.transform.zoom,Vn,$i)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function ta(m,r,l,p,y,b,S,L,N,F,B,H,W,ee,ce,oe,fe,pe,Te){const De=m.context,Ie=De.gl,Ge=m.transform,Be=m.transform.zoom,je=[],Ue=Ps(m,l.paint.get("fill-extrusion-cutoff-fade-range"));F==="clear"?(je.push("CLEAR_SUBPASS"),Te&&(je.push("CLEAR_FROM_TEXTURE"),De.activeTexture.set(Ie.TEXTURE0),Te.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE))):F==="sdf"&&je.push("SDF_SUBPASS"),fe&&je.push("HAS_CENTROID"),Ue.shouldRenderCutoff&&je.push("RENDER_CUTOFF");const Ke=l.layout.get("fill-extrusion-edge-radius"),nt=(kt,xt,Zt,Kt,ln)=>{const vt=xt.programConfigurations.get(l.id),Ht=m.isTileAffectedByFog(kt),mt=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:vt,defines:je,overrideFog:Ht}),Gt=((Xt,Rt,Qt,gn,_n,xn,Dn,ar,Vn,ir,Yn)=>({u_matrix:Rt,u_opacity:Qt,u_ao_pass:gn?1:0,u_meter_to_tile:_n,u_ao:xn,u_flood_light_intensity:Dn,u_flood_light_color:ar,u_attenuation:Vn,u_edge_radius:ir,u_fb:0,u_fb_size:Yn,u_dynamic_offset:1}))(0,Kt,B,N,ln,[H,W*ln],ee,ce,oe,Be>=17?0:Ke*ln,Te?Te.size[0]:0),Bt=[];fe&&Bt.push(xt.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(De,mt,kt.toUnwrapped(),null,Ue),mt.draw(m,De.gl.TRIANGLES,y,b,S,L,Gt,l.id,xt.vertexBuffer,xt.indexBuffer,Zt,l.paint,Be,vt,Bt)};for(const kt of p){const xt=r.getTile(kt),Zt=xt.getBucket(l);if(!Zt||Zt.projection.name!==Ge.projection.name||!Zt.groundEffect||Zt.groundEffect&&!Zt.groundEffect.hasData())continue;const Kt=Zt.groundEffect,ln=1/Zt.tileToMeter;{const vt=m.translatePosMatrix(kt.projMatrix,xt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Ht=Kt.getDefaultSegment();nt(kt,Kt,Ht,vt,ln)}if(pe)for(let vt=0;vt<4;vt++){const Ht=i.d7[vt](kt),mt=r.getTile(Ht);if(!mt)continue;const Gt=mt.getBucket(l);if(!Gt||Gt.projection.name!==Ge.projection.name||!Gt.groundEffect||Gt.groundEffect&&!Gt.groundEffect.hasData())continue;const Bt=Gt.groundEffect;let Xt,Rt;vt===0?(Xt=[-i.ai,0,0],Rt=1):vt===1?(Xt=[i.ai,0,0],Rt=0):vt===2?(Xt=[0,-i.ai,0],Rt=3):(Xt=[0,i.ai,0],Rt=2);const Qt=Bt.regionSegments[Rt];if(!Qt)continue;const gn=new Float32Array(16);i.ad.mat4.translate(gn,kt.projMatrix,Xt),nt(kt,Bt,Qt,m.translatePosMatrix(gn,xt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),ln)}}}function ws(m,r,l,p,y,b,S){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const L=b?b.findDEMTileFor(l):null;if(!(L&&L.dem||S))return;b&&L&&L.dem&&p.selfDEMTileTimestamp!==L.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=L.dem._timestamp);const N=pe=>new i.P(Math.ceil((pe+i.da)*i.db),0),F=pe=>{const Te=r.getSource().minzoom,De=Ge=>{const Be=r.getTileByID(Ge);if(Be&&Be.hasData())return Be.getBucket(y)},Ie=[0,-1,1];for(const Ge of Ie){if(pe.overscaledZ+Ge<Te)continue;const Be=De(pe.calculateScaledKey(pe.overscaledZ+Ge));if(Be)return Be}},B=[0,0,0],H=(pe,Te)=>(B[0]=Math.min(pe.min.y,Te.min.y),B[1]=Math.max(pe.max.y,Te.max.y),B[2]=i.ai-Te.min.x>pe.max.x?Te.min.x-i.ai:pe.max.x,B),W=(pe,Te)=>(B[0]=Math.min(pe.min.x,Te.min.x),B[1]=Math.max(pe.max.x,Te.max.x),B[2]=i.ai-Te.min.y>pe.max.y?Te.min.y-i.ai:pe.max.y,B),ee=[(pe,Te)=>H(pe,Te),(pe,Te)=>H(Te,pe),(pe,Te)=>W(pe,Te),(pe,Te)=>W(Te,pe)],ce=(pe,Te,De,Ie,Ge,Be,je)=>{if(!b)return 0;const Ue=[[Be?De:pe,Be?pe:De,0],[Be?De:Te,Be?Te:De,0]],Ke=je<0?i.ai+je:je,nt=[Be?Ke:(pe+Te)/2,Be?(pe+Te)/2:Ke,0];return De===0&&je<0||De!==0&&je>0?b.getForTilePoints(Ge,[nt],!0,Ie):Ue.push(nt),b.getForTilePoints(l,Ue,!0,L),Math.max(Ue[0][2],Ue[1][2],nt[2])/b.exaggeration()};for(let pe=0;pe<4;pe++){const Te=p.borderFeatureIndices[pe];if(Te.length===0)continue;const De=i.d7[pe](l),Ie=F(De);if(!(Ie&&Ie instanceof i.d8))continue;const Ge=b?b.findDEMTileFor(De):null;if(!(Ge&&Ge.dem||S)||(b&&Ge&&Ge.dem&&p.borderDEMTileTimestamp[pe]!==Ge.dem._timestamp&&(p.borderDoneWithNeighborZ[pe]=-1,p.borderDEMTileTimestamp[pe]=Ge.dem._timestamp),p.borderDoneWithNeighborZ[pe]===Ie.canonical.z))continue;Ie.centroidVertexArray.length===0&&Ie.createCentroidsBuffer();const Be=(pe<2?1:5)-pe,je=Ie.borderDoneWithNeighborZ[Be]!==p.canonical.z,Ue=Ie.borderFeatureIndices[Be];let Ke=0;if(p.canonical.z!==Ie.canonical.z){for(const nt of Te)p.showCentroid(p.featuresOnBorder[nt]);if(je)for(const nt of Ue)Ie.showCentroid(Ie.featuresOnBorder[nt]);p.borderDoneWithNeighborZ[pe]=Ie.canonical.z,Ie.borderDoneWithNeighborZ[Be]=p.canonical.z}for(const nt of Te){const kt=p.featuresOnBorder[nt],xt=p.centroidData[kt.centroidDataIndex],Zt=kt.borders[pe];let Kt;for(;Ke<Ue.length;){Kt=Ie.featuresOnBorder[Ue[Ke]];const ln=Kt.borders[Be];if(ln[1]>Zt[0]+3||ln[0]>Zt[0]-3)break;Ie.showCentroid(Kt),Ke++}if(Kt&&Ke<Ue.length){const ln=Ke;let vt=0;for(;!(Kt.borders[Be][0]>Zt[1]-3)&&(vt++,++Ke!==Ue.length);)Kt=Ie.featuresOnBorder[Ue[Ke]];Kt=Ie.featuresOnBorder[Ue[ln]];let Ht=!1;if(vt>=1){const Bt=Kt.borders[Be];Math.abs(Zt[0]-Bt[0])<3&&Math.abs(Zt[1]-Bt[1])<3&&(vt=1,Ht=!0,Ke=ln+1)}else if(vt===0){p.showCentroid(kt);continue}const mt=Ie.centroidData[Kt.centroidDataIndex];S&&Ht&&(((oe=xt).flags|(fe=mt).flags)&i.d9?(oe.flags|=i.d9,fe.flags|=i.d9):(oe.flags&=~i.d9,fe.flags&=~i.d9));const Gt=kt.intersectsCount()>1||Kt.intersectsCount()>1;if(vt>1)Ke=ln,xt.centroidXY=mt.centroidXY=new i.P(0,0);else if(Ge&&Ge.dem&&!Gt){const Bt=ee[pe](xt,mt),Xt=pe%2?i.ai-1:0,Rt=ce(Bt[0],Math.min(i.ai-1,Bt[1]),Xt,Ge,De,pe<2,Bt[2]);xt.centroidXY=mt.centroidXY=N(Rt)}else Gt?xt.centroidXY=mt.centroidXY=new i.P(0,0):(xt.centroidXY=p.encodeBorderCentroid(kt),mt.centroidXY=Ie.encodeBorderCentroid(Kt));p.writeCentroidToBuffer(xt),Ie.writeCentroidToBuffer(mt)}else p.showCentroid(kt)}p.borderDoneWithNeighborZ[pe]=Ie.canonical.z,Ie.borderDoneWithNeighborZ[Be]=p.canonical.z}var oe,fe;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(m)}const _a=[1,0,0],an=[0,1,0],vn=[0,0,1];function La(m,r,l){const p=l.transform,y=l.shadowRenderer;if(!y)return!0;const b=m.toUnwrapped(),S=p.tileSize*y._cascades[l.currentShadowCascade].scale;let L=r.maxHeight;if(p.elevation){const oe=p.elevation.getMinMaxForTile(m);oe&&(L+=oe.max)}const N=[...y.shadowDirection];N[2]=-N[2];const F=y.computeSimplifiedTileShadowVolume(b,L,S,N);if(!F)return!1;const B=[_a,an,vn,N,[N[0],0,N[2]],[0,N[1],N[2]]],H=p.projection.name==="globe",W=p.scaleZoom(S),ee=i.bR.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,W,!H),ce=y.getCurrentCascadeFrustum();return ee.intersectsPrecise(F.vertices,F.planes,B)===0||ce.intersectsPrecise(F.vertices,F.planes,B)===0}function Ir(m){return[m[0]*i.dc,m[1]*i.dc,m[2]*i.dc,0]}function Tt(m,r,l,p,y,b,S,L,N){const F=p.getSource(),B=l.globeSharedBuffers;if(!B)return;let H,W,ee;if(r&&(H=p.getTile(r)),F instanceof i.aK?(W=F.texture,ee=i.cJ(0,0,l.transform)):H&&r&&(W=H.texture,ee=i.cJ(r.canonical.z,r.canonical.x,l.transform)),!W||!ee)return;m||(ee=i.ad.mat4.scale(i.ad.mat4.create(),ee,[1,-1,1]));const ce=l.context,oe=ce.gl,fe=y.paint.get("raster-resampling")==="nearest"?oe.NEAREST:oe.LINEAR,pe=l.colorModeForDrapableLayerRenderPass(b),Te=S.defines;Te.push("GLOBE_POLES");const De=new Rn(oe.LEQUAL,Rn.ReadWrite,l.depthRangeFor3D),Ie=Float32Array.from(l.transform.expandedFarZProjMatrix),Ge=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),ce.activeTexture.set(oe.TEXTURE0),W.bind(fe,oe.CLAMP_TO_EDGE),ce.activeTexture.set(oe.TEXTURE1),W.bind(fe,oe.CLAMP_TO_EDGE),"useMipmap"in W&&ce.extTextureFilterAnisotropic&&l.transform.pitch>20&&oe.texParameterf(oe.TEXTURE_2D,ce.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ce.extTextureFilterAnisotropicMax);const[Be,je,Ue,Ke]=r?B.getPoleBuffers(r.canonical.z,!1):B.getPoleBuffers(0,!0),nt=y.paint.get("raster-elevation");let kt;m?(kt=Be,l.renderDefaultNorthPole=nt!==0):(kt=je,l.renderDefaultSouthPole=nt!==0);const xt=Ir(S.mix),Zt=((ln,vt,Ht,mt,Gt,Bt,Xt,Rt,Qt,gn,_n,xn,Dn)=>nn(ln,vt,Ht,new Float32Array(16),new Float32Array(9),[0,0],mt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Bt,[0,0],Rt,2,gn,_n,xn,1,0,Dn))(Ie,Ge,ee,i.ag(l.transform.zoom),0,y,0,nt,0,xt,S.offset,S.range,b),Kt=l.getOrCreateProgram("raster",{defines:Te});l.uploadCommonUniforms(ce,Kt,null),Kt.draw(l,oe.TRIANGLES,De,N,pe,L,Zt,y.id,kt,Ue,Ke)}function rm(m){const r=m._nearZ,l=m.projection.farthestPixelDistance(m),p=l-r,y=.2*m.height,b=r+y;return[r,l,(b-y-r)/p,(b-r)/p]}function Md(m,r,l,p){if(m)return r instanceof Wi&&m instanceof wo?r.getTextureDescriptor(m,l,!0):{texture:m.texture,mix:Ir(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Ph=i.dd([{name:"a_index",type:"Int16",components:1}]);class Bu{constructor(r,l,p,y){const b={width:p[0],height:p[1],data:null},S=r.gl;this.targetColorTexture=new i.T(r,b,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(r,b,S.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(l,y),this.lastInvalidatedAt=0}updateParticleTexture(r,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,y=l.width*l.height;this.particleTexture0=new i.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new i.de;b.reserve(y);for(let S=0;S<y;S++)b.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(b,Ph.members,!0),this.particleSegment=i.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Id(m,r,l){if(!m)return null;const p=r.getTextureDescriptor(m,l,!0);if(!p)return null;let{texture:y,mix:b,offset:S,tileSize:L,buffer:N,format:F}=p;if(!y||!F)return null;let B=!1;return F==="uint32"&&(B=!0,b[3]=0,b=Ze(i.df,b,[0,l.paint.get("raster-particle-max-speed")]),S=tn(i.df,S,[0,l.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[N/(L+2*N),L/(L+2*N)],tileSize:L,scalarData:B,scale:b,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[F]]}}function Za(m){const r=m._nearZ,l=m.projection.farthestPixelDistance(m),p=l-r,y=.2*m.height,b=r+y;return[r,l,(b-y-r)/p,(b-r)/p]}const Al=new i.al(1,0,0,1),Mh=new i.al(0,1,0,1),wg=new i.al(0,0,1,1),Ld=new i.al(1,0,1,1),kd=new i.al(0,1,1,1);function El(m,r,l,p,y,b,S){const L=m.context,N=m.transform,F=L.gl,B=N.projection.name==="globe",H=B?["PROJECTION_GLOBE_VIEW"]:[];let W=i.ad.mat4.clone(l.projMatrix);if(B&&i.ag(N.zoom)>0){const xt=i.bb(l.canonical,N),Zt=i.dg(xt);W=i.ad.mat4.multiply(new Float32Array(16),N.globeMatrix,Zt),i.ad.mat4.multiply(W,N.projMatrix,W)}const ee=i.ad.mat4.create();ee[12]+=2*y/(i.q.devicePixelRatio*N.width),ee[13]+=2*b/(i.q.devicePixelRatio*N.height),i.ad.mat4.multiply(W,ee,W);const ce=m.getOrCreateProgram("debug",{defines:H}),oe=r.getTileByID(l.key);m.terrain&&m.terrain.setupElevationDraw(oe,ce);const fe=Rn.disabled,pe=Hn.disabled,Te=m.colorModeForRenderPass(),De="$debug";L.activeTexture.set(F.TEXTURE0),m.emptyTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),B?oe._makeGlobeTileDebugBuffers(m.context,N):oe._makeDebugTileBoundsBuffers(m.context,N.projection);const Ie=oe._tileDebugBuffer||m.debugBuffer,Ge=oe._tileDebugIndexBuffer||m.debugIndexBuffer,Be=oe._tileDebugSegments||m.debugSegments;if(ce.draw(m,F.LINE_STRIP,fe,pe,Te,Xn.disabled,Ve(W,p),De,Ie,Ge,Be,null,null,null,[oe._globeTileDebugBorderBuffer]),S){const xt=oe.latestRawTileData,Zt=Math.floor((xt&&xt.byteLength||0)/1024);let Kt=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Kt+=` => ${l.overscaledZ}`),Kt+=` ${oe.state}`,Kt+=` ${Zt}kb`,function(ln,vt){ln.initDebugOverlayCanvas();const Ht=ln.debugOverlayCanvas,mt=ln.context.gl,Gt=ln.debugOverlayCanvas.getContext("2d");Gt.clearRect(0,0,Ht.width,Ht.height),Gt.shadowColor="white",Gt.shadowBlur=2,Gt.lineWidth=1.5,Gt.strokeStyle="white",Gt.textBaseline="top",Gt.font="bold 36px Open Sans, sans-serif",Gt.fillText(vt,5,5),Gt.strokeText(vt,5,5),ln.debugOverlayTexture.update(Ht),ln.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(m,Kt)}const je=r.getTile(l).tileSize,Ue=512/Math.min(je,512)*(l.overscaledZ/N.zoom)*.5,Ke=oe._tileDebugTextBuffer||m.debugBuffer,nt=oe._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,kt=oe._tileDebugTextSegments||m.debugSegments;ce.draw(m,F.TRIANGLES,fe,pe,Jn.alphaBlended,Xn.disabled,Ve(W,i.al.transparent,Ue),De,Ke,nt,kt,null,null,null,[oe._globeTileDebugTextBuffer])}function Rd(m,r,l,p){Cl(m,0,r+l/2,m.transform.width,l,p)}function Ih(m,r,l,p){Cl(m,r-l/2,0,l,m.transform.height,p)}function Cl(m,r,l,p,y,b){const S=m.context,L=S.gl;L.enable(L.SCISSOR_TEST),L.scissor(r*i.q.devicePixelRatio,l*i.q.devicePixelRatio,p*i.q.devicePixelRatio,y*i.q.devicePixelRatio),S.clear({color:b}),L.disable(L.SCISSOR_TEST)}const Cf=i.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Lh}=Cf;function Pl(m,r,l,p){m.emplaceBack(r,l,p)}class Ic{constructor(r){this.vertexArray=new i.dh,this.indices=new i.aV,Pl(this.vertexArray,-1,-1,1),Pl(this.vertexArray,1,-1,1),Pl(this.vertexArray,-1,1,1),Pl(this.vertexArray,1,1,1),Pl(this.vertexArray,-1,-1,-1),Pl(this.vertexArray,1,-1,-1),Pl(this.vertexArray,-1,1,-1),Pl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Lh),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=i.b8.simpleSegment(0,0,36,12)}}function Ys(m,r,l,p,y,b){const S=m.context.gl,L=r.paint.get("sky-atmosphere-color"),N=r.paint.get("sky-atmosphere-halo-color"),F=r.paint.get("sky-atmosphere-sun-intensity"),B=((H,W,ee,ce,oe)=>({u_matrix_3f:H,u_sun_direction:W,u_sun_intensity:ee,u_color_tint_r:[ce.r,ce.g,ce.b,ce.a],u_color_tint_m:[oe.r,oe.g,oe.b,oe.a],u_luminance:5e-5}))(i.ad.mat3.fromMat4(i.ad.mat3.create(),p),y,F,L,N);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,r.skyboxTexture,0),l.draw(m,S.TRIANGLES,Rn.disabled,Hn.disabled,Jn.unblended,Xn.frontCW,B,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const v0=i.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Dd{constructor(r){const l=new i.di;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new i.aV;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,v0.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=i.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const vi=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Or{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class im{constructor(r){this.colorModeAlphaBlendedWriteRGB=new Jn([1,vs,1,vs],i.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Jn([1,0,1,0],i.al.transparent,[!1,!1,!1,!0]),this.params=new Or,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const l=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Dd(l);const p=this.params.sizeRange,y=this.params.intensityRange,b=function(B){const H=i.dl(30),W=[];for(let ee=0;ee<B;++ee){const ce=2*Math.PI*H(),oe=Math.acos(1-2*H())-.5*Math.PI;W.push(i.ad.vec3.fromValues(Math.cos(oe)*Math.cos(ce),Math.cos(oe)*Math.sin(ce),Math.sin(oe)))}return W}(this.params.starsCount),S=i.dl(300),L=new i.dj,N=new i.aV;let F=0;for(let B=0;B<b.length;++B){const H=i.ad.vec3.scale([],b[B],200),W=Math.max(0,1+.01*p*(1*S()-.5)),ee=Math.max(0,1+.01*y*(1*S()-.5));L.emplaceBack(H[0],H[1],H[2],-1,-1,W,ee),L.emplaceBack(H[0],H[1],H[2],1,-1,W,ee),L.emplaceBack(H[0],H[1],H[2],1,1,W,ee),L.emplaceBack(H[0],H[1],H[2],-1,1,W,ee),N.emplaceBack(F+0,F+1,F+2),N.emplaceBack(F+0,F+2,F+3),F+=4}this.starsVx=l.createVertexBuffer(L,vi.members),this.starsIdx=l.createIndexBuffer(N),this.starsSegments=i.b8.simpleSegment(0,0,L.length,N.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,l){const p=r.context,y=p.gl,b=r.transform,S=new Rn(y.LEQUAL,Rn.ReadOnly,[0,1]),L=i.ag(b.zoom),N=r.style.getLut(l.scope),F=l.properties.get("color-use-theme")==="none",B=l.properties.get("color").toRenderColor(F?null:N).toArray01(),H=l.properties.get("high-color-use-theme")==="none",W=l.properties.get("high-color").toRenderColor(H?null:N).toArray01(),ee=l.properties.get("space-color-use-theme")==="none",ce=l.properties.get("space-color").toRenderColor(ee?null:N).toArray01PremultipliedAlpha(),oe=5e-4,fe=i.dk(l.properties.get("horizon-blend"),0,1,oe,.25),pe=i.cD(r,p,b)&&fe===oe?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,Te=r.frameCounter/1e3%1,De=i.ad.vec3.length(b.globeCenterInViewSpace),Ie=Math.sqrt(Math.pow(De,2)-Math.pow(pe,2)),Ge=Math.acos(Ie/De),Be=je=>{const Ue=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];je&&Ue.push("ALPHA_PASS");const Ke=r.getOrCreateProgram("globeAtmosphere",{defines:Ue}),nt=((xt,Zt,Kt,ln,vt,Ht,mt,Gt,Bt,Xt,Rt,Qt)=>({u_frustum_tl:xt,u_frustum_tr:Zt,u_frustum_br:Kt,u_frustum_bl:ln,u_horizon:vt,u_transition:Ht,u_fadeout_range:mt,u_color:Gt,u_high_color:Bt,u_space_color:Xt,u_temporal_offset:Rt,u_horizon_angle:Qt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,L,fe,B,W,ce,Te,Ge);r.uploadCommonUniforms(p,Ke);const kt=this.atmosphereBuffer;kt&&Ke.draw(r,y.TRIANGLES,S,Hn.disabled,je?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Xn.backCW,nt,je?"atmosphere_glow_alpha":"atmosphere_glow",kt.vertexBuffer,kt.indexBuffer,kt.segments)};Be(!1),Be(!0)}drawStars(r,l){const p=i.ay(l.properties.get("star-intensity"),0,1);if(p===0)return;const y=r.context,b=y.gl,S=r.transform,L=r.getOrCreateProgram("stars"),N=i.ad.quat.identity([]);i.ad.quat.rotateX(N,N,-S._pitch),i.ad.quat.rotateZ(N,N,-S.angle),i.ad.quat.rotateX(N,N,i.ak(S._center.lat)),i.ad.quat.rotateY(N,N,-i.ak(S._center.lng));const F=i.ad.mat4.fromQuat(new Float32Array(16),N),B=i.ad.mat4.multiply([],S.starsProjMatrix,F),H=i.ad.mat3.fromMat4([],F),W=i.ad.mat3.invert([],H),ee=[0,1,0];i.ad.vec3.transformMat3(ee,ee,W),i.ad.vec3.scale(ee,ee,this.params.sizeMultiplier);const ce=[1,0,0];i.ad.vec3.transformMat3(ce,ce,W),i.ad.vec3.scale(ce,ce,this.params.sizeMultiplier);const oe=(fe=ee,pe=ce,Te=p,{u_matrix:Float32Array.from(B),u_up:fe,u_right:pe,u_intensity_multiplier:Te});var fe,pe,Te;r.uploadCommonUniforms(y,L),this.starsVx&&this.starsIdx&&L.draw(r,b.TRIANGLES,Rn.disabled,Hn.disabled,this.colorModeAlphaBlendedWriteRGB,Xn.disabled,oe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ic(m,r){const l=[...m],p=r.cameraWorldSizeForFog/r.worldSize,y=i.ad.mat4.identity([]);return i.ad.mat4.scale(y,y,[p,p,1]),i.ad.mat4.multiply(l,y,l),i.ad.mat4.multiply(l,r.worldToFogMatrix,l),l}function Lc(m,r,l,p,y){const b=l.material,S=p.context,{baseColorTexture:L,metallicRoughnessTexture:N}=b.pbrMetallicRoughness,{normalTexture:F,occlusionTexture:B,emissionTexture:H}=b;function W(ce,oe,fe){if(ce&&(m.push(oe),S.activeTexture.set(S.gl.TEXTURE0+fe),ce.gfxTexture)){const{minFilter:pe,magFilter:Te,wrapS:De,wrapT:Ie}=ce.sampler;ce.gfxTexture.bindExtraParam(pe,Te,De,Ie)}}W(L,"HAS_TEXTURE_u_baseColorTexture",Di.BaseColor),W(N,"HAS_TEXTURE_u_metallicRoughnessTexture",Di.MetallicRoughness),W(F,"HAS_TEXTURE_u_normalTexture",Di.Normal),W(B,"HAS_TEXTURE_u_occlusionTexture",Di.Occlusion),W(H,"HAS_TEXTURE_u_emissionTexture",Di.Emission),y&&(y.texture||(y.texture=new i.dn(p.context,y.image,[y.image.height,y.image.height,y.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+Di.LUT),y.texture&&y.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(l.texcoordBuffer)),l.colorBuffer&&(m.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(l.colorBuffer)),l.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(l.normalBuffer)),l.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(l.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||m.push("DIFFUSE_SHADED");const ee=p.shadowRenderer;ee&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ee.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Ml(m,r,l,p,y,b){const S=l.paint.get("model-opacity").constantOr(1),L=r.context,N=new Rn(r.context.gl.LEQUAL,Rn.ReadWrite,r.depthRangeFor3D),F=r.transform,B=m.mesh,H=B.material,W=H.pbrMetallicRoughness,ee=r.style.fog;let ce;ce=r.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:i.ad.mat4.multiply([],p.zScaleMatrix,m.nodeModelMatrix),i.ad.mat4.multiply(ce,p.negCameraPosMatrix,ce);const oe=i.ad.mat4.invert([],ce);i.ad.mat4.transpose(oe,oe);const fe=l.paint.get("model-color-use-theme").constantOr("default")==="none",pe=l.paint.get("model-emissive-strength").constantOr(0),Te=Ar(new Float32Array(m.worldViewProjection),new Float32Array(ce),new Float32Array(oe),null,r,S,W.baseColorFactor.toRenderColor(null),H.emissiveFactor,W.metallicFactor,W.roughnessFactor,H,pe,l),De={defines:[]},Ie=[],Ge=r.shadowRenderer;Ge&&(Ge.useNormalOffset=!1),Lc(De.defines,Ie,B,r,fe?null:l.lut);let Be=null;if(ee){const Ke=ic(m.nodeModelMatrix,r.transform);if(Be=new Float32Array(Ke),F.projection.name!=="globe"){const nt=B.aabb.min,kt=B.aabb.max,[xt,Zt]=ee.getOpacityForBounds(Ke,nt[0],nt[1],kt[0],kt[1]);De.overrideFog=xt>=pn||Zt>=pn}}const je=Ps(r,l.paint.get("model-cutoff-fade-range"));je.shouldRenderCutoff&&De.defines.push("RENDER_CUTOFF");const Ue=r.getOrCreateProgram("model",De);r.uploadCommonUniforms(L,Ue,null,Be,je),r.renderPass!=="shadow"&&Ge&&Ge.setupShadowsFromMatrix(m.nodeModelMatrix,Ue),Ue.draw(r,L.gl.TRIANGLES,N,y,b,B.material.doubleSided?Xn.disabled:Xn.backCCW,Te,l.id,B.vertexBuffer,B.indexBuffer,B.segments,l.paint,r.transform.zoom,void 0,Ie)}function Il(m,r,l,p,y,b,S){let L;L=m.projection.name==="globe"?i.dp(l,m):[...l],i.ad.mat4.multiply(L,L,r.matrix);const N=i.ad.mat4.multiply([],p,L);if(r.meshes)for(const F of r.meshes){if(F.material.alphaMode!=="BLEND"){S.push({mesh:F,depth:0,modelIndex:y,worldViewProjection:N,nodeModelMatrix:L});continue}const B=i.ad.vec3.transformMat4([],F.centroid,N);!m.isOrthographic&&B[2]<=0||b.push({mesh:F,depth:B[2],modelIndex:y,worldViewProjection:N,nodeModelMatrix:L})}if(r.children)for(const F of r.children)Il(m,F,l,p,y,b,S)}function kh(m,r,l,p){const y=l.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),S=y.getShadowPassColorMode(),L=y.calculateShadowPassMatrixFromMatrix(r),N=Zn(L);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,b,Hn.disabled,S,Xn.backCCW,N,p.id,m.vertexBuffer,m.indexBuffer,m.segments,p.paint,l.transform.zoom,void 0,void 0)}function sm(m,r,l){const p=r.updateZoomBasedPaintProperties(),y=function(b,S,L){let N,F,B,H=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&H>0){const W=b.terrain,ee=W.findDEMTileFor(L);ee&&ee.dem?N=i.dr.create(W,L,ee):H=0}if(H===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),H===S.validForExaggeration&&(H===0||N&&N._demTile&&N._demTile.tileID===S.validForDEMTile.id&&N._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const W in S.instancesPerModel){const ee=S.instancesPerModel[W];for(let ce=0;ce<ee.instancedDataArray.length;++ce){const oe=(N?H*N.getElevationAt(0|ee.instancedDataArray.float32[16*ce],0|ee.instancedDataArray.float32[16*ce+1],!0,!0):0)+ee.instancesEvaluatedElevation[ce];ee.instancedDataArray.float32[16*ce+6]=oe,F=F?Math.min(S.terrainElevationMin,oe):oe,B=B?Math.max(S.terrainElevationMax,oe):oe}}return S.terrainElevationMin=F||0,S.terrainElevationMax=B||0,S.validForExaggeration=H,S.validForDEMTile=N&&N._demTile?{id:N._demTile.tileID,timestamp:N._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,r,l);(p||y)&&(r.uploaded=!1,r.upload(m.context))}const na={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.ce([0,0,0],[i.ai,i.ai,0])};function Pf(m,r){const l=1<<m.canonical.z,p=r.getFreeCameraOptions().position,y=r.elevation,b=m.canonical.x/l,S=(m.canonical.x+1)/l,L=m.canonical.y/l,N=(m.canonical.y+1)/l;let F=r._centerAltitude;if(y){const ee=y.getMinMaxForTile(m);ee&&ee.max>F&&(F=ee.max)}const B=i.ay(p.x,b,S)-p.x,H=i.ay(p.y,L,N)-p.y,W=i.bH(F,r.center.lat)-p.z;return r._zoomFromMercatorZ(Math.sqrt(B*B+H*H+W*W))}function ka(m,r,l,p,y,b,S){const L=m.context,N=m.renderPass==="shadow",F=m.shadowRenderer,B=N&&F?F.getShadowPassDepthMode():new Rn(L.gl.LEQUAL,Rn.ReadWrite,m.depthRangeFor3D),H=m.isTileAffectedByFog(b);if(l.meshes)for(const W of l.meshes){const ee=["MODEL_POSITION_ON_GPU"],ce=[];let oe,fe,pe;p.instancedDataArray.length>20&&ee.push("INSTANCED_ARRAYS");const Te=Ps(m,r.paint.get("model-cutoff-fade-range"));if(Te.shouldRenderCutoff&&ee.push("RENDER_CUTOFF"),N&&F)oe=m.getOrCreateProgram("modelDepth",{defines:ee}),fe=Zn(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(l.matrix)),pe=F.getShadowPassColorMode();else{Lc(ee,ce,W,m,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),oe=m.getOrCreateProgram("model",{defines:ee,overrideFog:H});const Ie=W.material,Ge=Ie.pbrMetallicRoughness,Be=r.paint.get("model-opacity").constantOr(1),je=r.paint.get("model-emissive-strength").constantOr(0);fe=Ar(b.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,m,Be,Ge.baseColorFactor.toRenderColor(null),Ie.emissiveFactor,Ge.metallicFactor,Ge.roughnessFactor,Ie,je,r,y),F&&(S.shadowUniformsInitialized?oe.setShadowUniformValues(L,F.getShadowUniformValues()):(F.setupShadows(b.toUnwrapped(),oe,"model-tile",b.overscaledZ),S.shadowUniformsInitialized=!0)),pe=Te.shouldRenderCutoff||Be<1||Ie.alphaMode!=="OPAQUE"?Jn.alphaBlended:Jn.unblended}m.uploadCommonUniforms(L,oe,b.toUnwrapped(),null,Te);const De=W.material.doubleSided?Xn.disabled:Xn.backCCW;if(p.instancedDataArray.length>20)ce.push(p.instancedDataBuffer),oe.draw(m,L.gl.TRIANGLES,B,Hn.disabled,pe,De,fe,r.id,W.vertexBuffer,W.indexBuffer,W.segments,r.paint,m.transform.zoom,void 0,ce,p.instancedDataArray.length);else{const Ie=N?"u_instance":"u_normal_matrix";for(let Ge=0;Ge<p.instancedDataArray.length;++Ge)fe[Ie]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Ge,16),oe.draw(m,L.gl.TRIANGLES,B,Hn.disabled,pe,De,fe,r.id,W.vertexBuffer,W.indexBuffer,W.segments,r.paint,m.transform.zoom,void 0,ce)}}if(l.children)for(const W of l.children)ka(m,r,W,p,y,b,S)}const ra=[1,-1,1];function Nd(m,r,l,p){if(!l.modelManager)return!0;const y=l.modelManager;if(!l.shadowRenderer)return!0;const b=l.shadowRenderer,S=r.aabb;let L=!0,N=m.maxHeight;if(N===0){let B=0;for(const H in m.instancesPerModel){const W=y.getModel(H,p);W?B=Math.max(B,Math.max(Math.max(W.aabb.max[0],W.aabb.max[1]),W.aabb.max[2])):L=!1}N=m.maxScale*B*1.41+m.maxVerticalOffset,L&&(m.maxHeight=N)}S.max[2]=N,S.min[2]+=m.terrainElevationMin,S.max[2]+=m.terrainElevationMax,i.ad.vec3.transformMat4(S.min,S.min,r.tileMatrix),i.ad.vec3.transformMat4(S.max,S.max,r.tileMatrix);const F=S.intersects(b.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=F===2),F===0}function Od(m,r){const l=m.uniformValues.u_cutoff_params[0],p=m.uniformValues.u_cutoff_params[1],y=m.uniformValues.u_cutoff_params[2],b=m.uniformValues.u_cutoff_params[3];return p===l||b===y?1:i.ay(((r-l)/(p-l)-y)/(b-y),0,1)}function om(m,r,l,p){if(r.pitch<20)return 1;const y=r.getWorldToCameraMatrix();i.ad.mat4.multiply(y,y,m);const b=i.ad.vec4.fromValues(l.min[0],l.min[1],l.min[2],1);let S=i.ad.vec4.transformMat4(i.ad.vec4.create(),b,y),L=S,N=S;b[1]=l.max[1],S=i.ad.vec4.transformMat4(i.ad.vec4.create(),b,y),L=S[1]<L[1]?S:L,N=S[1]>N[1]?S:N,b[0]=l.max[0],S=i.ad.vec4.transformMat4(i.ad.vec4.create(),b,y),L=S[1]<L[1]?S:L,N=S[1]>N[1]?S:N,b[1]=l.min[1],S=i.ad.vec4.transformMat4(i.ad.vec4.create(),b,y),L=S[1]<L[1]?S:L,N=S[1]>N[1]?S:N;const F=i.ay(p[0],0,1),B=100*r.pixelsPerMeter*i.ay(p[1],0,1),H=i.ay(p[2],0,1),W=i.ad.vec4.lerp(i.ad.vec4.create(),L,N,F),ee=Math.tan(.5*r.fovX),ce=-W[2]*ee;if(B===0)return W[1]<-Math.abs(ce)?H:1;const oe=(-Math.abs(ce)-W[1])/B,fe=(Te,De,Ie)=>(1-Ie)*Te+Ie*De,pe=i.ay(fe(1,H,oe),H,1);return fe(1,pe,i.ay((r.pitch-20)/20,0,1))}class Mf{}class Ka{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,l,p){{const H=this._storage.get(l.id);if(H)return H.lastUsedFrameIdx=r,H.buf}const y=p.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),S=new ArrayBuffer(b),L=new Int16Array(S);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const N=new i.dt;for(let H=0;H<b/2;H+=3){const W=L[H],ee=L[H+1],ce=L[H+2];N.emplaceBack(W,ee),N.emplaceBack(ee,ce),N.emplaceBack(ce,W)}const F=p.bindVertexArrayOES.current,B=new Mf;return B.buf=new mi(p,N),B.lastUsedFrameIdx=r,this._storage.set(l.id,B),p.bindVertexArrayOES.set(F),B.buf}update(r){for(const[l,p]of this._storage)r-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(l))}destroy(){for(const[r,l]of this._storage)l.buf.destroy(),this._storage.delete(r)}}class am{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const kc=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class lm{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Rh{constructor(r,l){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const cm=i.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class ju{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,l){const p=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new i.du,L=new i.aV;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),L.emplaceBack(0,1,2),L.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(S,cm.members),this.vignetteIdx=r.context.createIndexBuffer(L)}const y=i.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,p);const S={u_vignetteShape:(b={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(r,r.context.gl.TRIANGLES,Rn.disabled,Hn.disabled,Jn.alphaBlended,Xn.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class Os{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,l){const p=r.getFreeCameraOptions().position,y=p.toAltitude(),b=p.toLngLat(),S=i.ak(b.lng),L=i.ak(b.lat),N=r.pixelsPerMeter/l,F=S*i.dv,B=i.dv*Math.log(Math.tan(Math.PI/4+L/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const H=-this._offsetYPrev+B,W=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+F)*N,this._accumulatedOffsetY+=H*N,this._accumulatedElevation+=W*N,this._offsetXPrev=F,this._offsetYPrev=B,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Uu(m,r){return[-(m[0]-Math.floor(m[0]/r)*r),-(m[1]-Math.floor(m[1]/r)*r),-(m[2]-Math.floor(m[2]/r)*r)]}function Xa(m){const r=i.dl(1323123451230),l=[];for(let p=0;p<m;++p){const y=2*r()-1,b=2*r()-1,S=2*r()-1;l.push(i.ad.vec3.fromValues(y,b,S))}return l}function zs(m,r,l,p,y){const b=i.ay((y-l)/(p-l),0,1);return(1-b)*m+b*r}class Ll{constructor(r){this._movement=new Os,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new ju,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,l){const p=r.transform;this._movement.update(p,this._ppmScaleFactor);const y=p.starsProjMatrix,b=i.ad.quat.identity([]);i.ad.quat.rotateX(b,b,i.ak(90)-p._pitch),i.ad.quat.rotateZ(b,b,-p.angle);const S=i.ad.mat4.fromQuat(new Float32Array(16),b),L=i.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),N=i.ad.mat4.transpose([],L),F=i.ad.mat4.multiply([],N,S),B=Date.now()/1e3;return this._accumulatedTimeFromStart+=(B-this._prevTime)*l,this._prevTime=B,{projectionMatrix:y,modelviewMatrix:F}}}class Dh extends Ll{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Rh(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const l=r.context;if(!this.particlesVx){const p=Xa(this.particlesCount),y=new i.dw,b=new i.aV;let S=0;const L=i.dl(1323123451230);for(let N=0;N<p.length;++N){const F=p[N],B=[2*L()-1,L(),L(),L()];y.emplaceBack(F[0],F[1],F[2],-1,-1,...B),y.emplaceBack(F[0],F[1],F[2],1,-1,...B),y.emplaceBack(F[0],F[1],F[2],1,1,...B),y.emplaceBack(F[0],F[1],F[2],-1,1,...B),b.emplaceBack(S+0,S+1,S+2),b.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=l.createVertexBuffer(y,kc.members),this.particlesIdx=l.createIndexBuffer(b)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=r.transform.zoom;if(l.revealStart>p)return;const y=zs(0,1,l.revealStart,l.revealStart+l.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let S=[-b.direction.x,b.direction.y,-100];i.ad.vec3.normalize(S,S);const L=structuredClone(this._vignetteParams);L.strength*=y,b.overrideStyleParameters||(b.intensity=r.style.rain.state.density,b.timeFactor=r.style.rain.state.intensity,b.color=structuredClone(r.style.rain.state.color),S=structuredClone(r.style.rain.state.direction),b.screenThinning.intensity=r.style.rain.state.centerThinning,b.dropletSizeX=r.style.rain.state.dropletSize[0],b.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],b.distortionStrength=100*r.style.rain.state.distortionStrength,L.strength=1,L.color=structuredClone(r.style.rain.state.vignetteColor));const N=this.updateOnRender(r,b.timeFactor),F=r.context,B=F.gl,H=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new i.T(F,{width:r.width,height:r.height,data:null},B.RGBA8)),b.distortionStrength>0&&(F.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),B.copyTexSubImage2D(B.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const W=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(F,W),F.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const ee=[b.color.r,b.color.g,b.color.b,b.color.a],ce=(oe,fe)=>{const pe=Uu(this._movement.getPosition(),oe),Te=b.dropletSizeX,De=b.dropletSizeX*b.dropletSizeYScale,Ie=r.width/2,Ge=r.height/2,Be=zs(0,b.screenThinning.start,0,1,b.screenThinning.intensity),je=zs(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Ue=zs(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Ke=(nt={modelview:N.modelviewMatrix,projection:N.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:pe,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:oe,rainDropletSize:[Te,De],distortionStrength:b.distortionStrength,rainDirection:S,color:ee,screenSize:[H.width,H.height],thinningCenterPos:[Ie,Ge],thinningShape:[Be,je,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Ue,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:fe?0:1},{u_modelview:Float32Array.from(nt.modelview),u_projection:Float32Array.from(nt.projection),u_time:nt.time,u_cam_pos:nt.camPos,u_texScreen:0,u_velocityConeAperture:nt.velocityConeAperture,u_velocity:nt.velocity,u_boxSize:nt.boxSize,u_rainDropletSize:nt.rainDropletSize,u_distortionStrength:nt.distortionStrength,u_rainDirection:nt.rainDirection,u_color:nt.color,u_screenSize:nt.screenSize,u_thinningCenterPos:nt.thinningCenterPos,u_thinningShape:nt.thinningShape,u_thinningAffectedRatio:nt.thinningAffectedRatio,u_thinningParticleOffset:nt.thinningParticleOffset,u_shapeDirectionalPower:nt.shapeDirectionalPower,u_shapeNormalPower:nt.shapeNormalPower,u_mode:nt.mode});var nt;const kt=Math.round(b.intensity*this.particlesCount),xt=i.b8.simpleSegment(0,0,4*kt,2*kt);W.draw(r,B.TRIANGLES,Rn.disabled,Hn.disabled,Jn.alphaBlended,Xn.disabled,Ke,"rain_particles",this.particlesVx,this.particlesIdx,xt)};b.distortionStrength>0&&ce(b.boxSize,!0),ce(b.boxSize,!1),this._vignette.draw(r,L)}}const zd=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Vu extends Ll{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Rh(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const l=r.context;if(!this.particlesVx){const p=Xa(this.particlesCount),y=new i.dx,b=new i.aV;let S=0;const L=i.dl(1323123451230);for(let N=0;N<p.length;++N){const F=p[N],B=L(),H=L(),W=L(),ee=[N/p.length,B,H,W],ce=[L(),L()];y.emplaceBack(F[0],F[1],F[2],-1,-1,...ee,...ce),y.emplaceBack(F[0],F[1],F[2],1,-1,...ee,...ce),y.emplaceBack(F[0],F[1],F[2],1,1,...ee,...ce),y.emplaceBack(F[0],F[1],F[2],-1,1,...ee,...ce),b.emplaceBack(S+0,S+1,S+2),b.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=l.createVertexBuffer(y,zd.members),this.particlesIdx=l.createIndexBuffer(b)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const l=structuredClone(this._params);let p=[-l.direction.x,l.direction.y,-100];i.ad.vec3.normalize(p,p);const y=structuredClone(this._vignetteParams),b=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=r.transform.zoom;if(b.revealStart>S)return;const L=zs(0,1,b.revealStart,b.revealStart+b.revealRange,S);y.strength*=L,l.overrideStyleParameters||(l.intensity=r.style.snow.state.density,l.timeFactor=r.style.snow.state.intensity,l.color=structuredClone(r.style.snow.state.color),p=structuredClone(r.style.snow.state.direction),l.screenThinning.intensity=r.style.snow.state.centerThinning,l.billboardSize=2.79*r.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(r.style.snow.state.vignetteColor));const N=this.updateOnRender(r,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const F=r.context,B=F.gl,H=r.transform,W=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(F,W),((ee,ce,oe)=>{const fe=Uu(this._movement.getPosition(),ee),pe=H.width/2,Te=H.height/2,De=zs(0,oe.screenThinning.start,0,1,oe.screenThinning.intensity),Ie=zs(.001,oe.screenThinning.range,0,1,oe.screenThinning.intensity),Ge=zs(0,oe.screenThinning.particleOffset,0,1,oe.screenThinning.intensity),Be=(je={modelview:N.modelviewMatrix,projection:N.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:fe,velocityConeAperture:oe.velocityConeAperture,velocity:oe.velocity,horizontalOscillationRadius:oe.horizontalOscillationRadius,horizontalOscillationRate:oe.horizontalOscillationRate,boxSize:ee,billboardSize:1*oe.billboardSize,simpleShapeParameters:[oe.shapeFadeStart,oe.shapeFadePower],screenSize:[H.width,H.height],thinningCenterPos:[pe,Te],thinningShape:[De,Ie,Math.pow(10,oe.screenThinning.fadePower)],thinningAffectedRatio:oe.screenThinning.affectedRatio,thinningParticleOffset:Ge,color:[oe.color.r,oe.color.g,oe.color.b,oe.color.a],direction:p},{u_modelview:Float32Array.from(je.modelview),u_projection:Float32Array.from(je.projection),u_time:je.time,u_cam_pos:je.camPos,u_velocityConeAperture:je.velocityConeAperture,u_velocity:je.velocity,u_horizontalOscillationRadius:je.horizontalOscillationRadius,u_horizontalOscillationRate:je.horizontalOscillationRate,u_boxSize:je.boxSize,u_billboardSize:je.billboardSize,u_simpleShapeParameters:je.simpleShapeParameters,u_screenSize:je.screenSize,u_thinningCenterPos:je.thinningCenterPos,u_thinningShape:je.thinningShape,u_thinningAffectedRatio:je.thinningAffectedRatio,u_thinningParticleOffset:je.thinningParticleOffset,u_particleColor:je.color,u_direction:je.direction});var je;const Ue=Math.round(oe.intensity*this.particlesCount),Ke=i.b8.simpleSegment(0,0,4*Ue,2*Ue);this.particlesVx&&this.particlesIdx&&W.draw(r,B.TRIANGLES,Rn.disabled,Hn.disabled,Jn.alphaBlended,Xn.disabled,Be,"snow_particles",this.particlesVx,this.particlesIdx,Ke)})(l.boxSize,0,l),this._vignette.draw(r,y)}}const Fd={symbol:function(m,r,l,p,y){if(m.renderPass!=="translucent")return;const b=Hn.disabled,S=m.colorModeForRenderPass(),L=l.layout.get("text-variable-anchor"),N=l.layout.get("text-size-scale-range"),F=i.ay(m.scaleFactor,N[0],N[1]);L&&function(W,ee,ce,oe,fe,pe,Te,De){const Ie=ee.transform,Ge=fe==="map",Be=pe==="map";for(const je of W){const Ue=oe.getTile(je),Ke=Ue.getBucket(ce);if(!Ke||!Ke.text||!Ke.text.segments.get().length)continue;const nt=i.bp(Ke.textSizeData,Ie.zoom,De),kt=To(je,Ke.getProjection(),Ie),xt=Ie.calculatePixelsToTileUnitsMatrix(Ue),Zt=yl(kt,Ue.tileID.canonical,Be,Ge,Ie,Ke.getProjection(),xt),Kt=Ke.hasIconTextFit()&&Ke.hasIconData();if(nt){const ln=Math.pow(2,Ie.zoom-Ue.tileID.overscaledZ);ci(Ke,Ge,Be,Te,i.cY,Ie,Zt,je,ln,nt,Kt)}}}(p,m,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),y,F);const B=l.paint.get("icon-opacity").constantOr(1)!==0,H=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(B||H)?Nr(m,r,l,p,b,S):(B&&Nr(m,r,l,p,b,S,{onlyIcons:!0}),H&&Nr(m,r,l,p,b,S,{onlyText:!0})),r.map.showCollisionBoxes&&(xs(m,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),xs(m,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(m,r,l,p){if(m.renderPass!=="translucent")return;const y=l.paint.get("circle-opacity"),b=l.paint.get("circle-stroke-width"),S=l.paint.get("circle-stroke-opacity"),L=l.layout.get("circle-sort-key").constantOr(1)!==void 0,N=l.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||S.constantOr(1)===0))return;const F=m.context,B=F.gl,H=m.transform,W=m.depthModeForSublayer(0,Rn.ReadOnly),ee=Hn.disabled,ce=m.colorModeForDrapableLayerRenderPass(N),oe=H.projection.name==="globe",fe=[i.av(H.center.lng),i.aC(H.center.lat)],pe=[];for(let De=0;De<p.length;De++){const Ie=p[De],Ge=r.getTile(Ie),Be=Ge.getBucket(l);if(!Be||Be.projection.name!==H.projection.name)continue;const je=Be.programConfigurations.get(l.id),Ue=i.cZ(l),Ke=m.isTileAffectedByFog(Ie);oe&&Ue.push("PROJECTION_GLOBE_VIEW"),Ue.push("DEPTH_D24"),m.terrain&&H.depthOcclusionForSymbolsAndCircles&&Ue.push("DEPTH_OCCLUSION");const nt=m.getOrCreateProgram("circle",{config:je,defines:Ue,overrideFog:Ke}),kt=Be.layoutVertexBuffer,xt=Be.globeExtVertexBuffer,Zt=Be.indexBuffer,Kt=H.projection.createInversionMatrix(H,Ie.canonical),ln={programConfiguration:je,program:nt,layoutVertexBuffer:kt,globeExtVertexBuffer:xt,indexBuffer:Zt,uniformValues:i.c_(m,Ie,Ge,Kt,fe,l),tile:Ge};if(L){const vt=Be.segments.get();for(const Ht of vt)pe.push({segments:new i.b8([Ht]),sortKey:Ht.sortKey,state:ln})}else pe.push({segments:Be.segments,sortKey:0,state:ln})}L&&pe.sort((De,Ie)=>De.sortKey-Ie.sortKey);const Te={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const De of pe){const{programConfiguration:Ie,program:Ge,layoutVertexBuffer:Be,globeExtVertexBuffer:je,indexBuffer:Ue,uniformValues:Ke,tile:nt}=De.state,kt=De.segments;m.terrain&&m.terrain.setupElevationDraw(nt,Ge,Te),m.uploadCommonUniforms(F,Ge,nt.tileID.toUnwrapped()),Ge.draw(m,B.TRIANGLES,W,ee,ce,Xn.disabled,Ke,l.id,Be,Ue,kt,l.paint,H.zoom,Ie,[je])}},heatmap:function(m,r,l,p){if(l.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const y=m.context,b=y.gl,S=Hn.disabled,L=new Jn([b.ONE,b.ONE,b.ONE,b.ONE],i.al.transparent,[!0,!0,!0,!0]);(function(ee,ce,oe,fe){const pe=ee.gl,Te=ce.width*fe,De=ce.height*fe;ee.activeTexture.set(pe.TEXTURE1),ee.viewport.set([0,0,Te,De]);let Ie=oe.heatmapFbo;if(!Ie||Ie&&(Ie.width!==Te||Ie.height!==De)){Ie&&Ie.destroy();const Ge=pe.createTexture();pe.bindTexture(pe.TEXTURE_2D,Ge),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MAG_FILTER,pe.LINEAR),Ie=oe.heatmapFbo=ee.createFramebuffer(Te,De,!0,null),function(Be,je,Ue,Ke,nt,kt){const xt=Be.gl;xt.texImage2D(xt.TEXTURE_2D,0,Be.extRenderToTextureHalfFloat?xt.RGBA16F:xt.RGBA,nt,kt,0,xt.RGBA,Be.extRenderToTextureHalfFloat?xt.HALF_FLOAT:xt.UNSIGNED_BYTE,null),Ke.colorAttachment.set(Ue)}(ee,0,Ge,Ie,Te,De)}else pe.bindTexture(pe.TEXTURE_2D,Ie.colorAttachment.get()),ee.bindFramebuffer.set(Ie.framebuffer)})(y,m,l,m.transform.projection.name==="globe"?.5:.25),y.clear({color:i.al.transparent});const N=m.transform,F=N.projection.name==="globe",B=F?["PROJECTION_GLOBE_VIEW"]:[],H=F?Xn.frontCCW:Xn.disabled,W=[i.av(N.center.lng),i.aC(N.center.lat)];for(let ee=0;ee<p.length;ee++){const ce=p[ee];if(r.hasRenderableParent(ce))continue;const oe=r.getTile(ce),fe=oe.getBucket(l);if(!fe||fe.projection.name!==N.projection.name)continue;const pe=m.isTileAffectedByFog(ce),Te=fe.programConfigurations.get(l.id),De=m.getOrCreateProgram("heatmap",{config:Te,defines:B,overrideFog:pe}),{zoom:Ie}=m.transform;m.terrain&&m.terrain.setupElevationDraw(oe,De),m.uploadCommonUniforms(y,De,ce.toUnwrapped());const Ge=N.projection.createInversionMatrix(N,ce.canonical);De.draw(m,b.TRIANGLES,Rn.disabled,S,L,H,lt(m,ce,oe,Ge,W,Ie,l.paint.get("heatmap-intensity")),l.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,l.paint,m.transform.zoom,Te,F?[fe.globeExtVertexBuffer]:null)}y.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(y,b){const S=y.context,L=S.gl,N=b.heatmapFbo;if(!N)return;S.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,N.colorAttachment.get()),S.activeTexture.set(L.TEXTURE1);let F=b.colorRampTexture;F||(F=b.colorRampTexture=new i.T(S,b.colorRamp,L.RGBA8)),F.bind(L.LINEAR,L.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,L.TRIANGLES,Rn.disabled,Hn.disabled,y.colorModeForRenderPass(),Xn.disabled,((B,H,W,ee)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(m,l))},line:function(m,r,l,p){if(m.renderPass!=="translucent")return;const y=l.paint.get("line-opacity"),b=l.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const S=l.paint.get("line-emissive-strength"),L=l.paint.get("line-occlusion-opacity"),N=l.layout.get("line-elevation-reference"),F=l.layout.get("line-width-unit")==="meters",B=N==="sea",H=m.context,W=H.gl;if(l.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const ee=l.layout.get("line-cross-slope"),ce=ee!==void 0,oe=ee<1,fe=m.colorModeForDrapableLayerRenderPass(S),pe=m.terrain&&m.terrain.renderingToTexture,Te=pe?1:i.q.devicePixelRatio,De=l.paint.get("line-dasharray"),Ie=De.constantOr(1),Ge=l.layout.get("line-cap"),Be=De.constantOr(null),je=Ge.constantOr(null),Ue=l.paint.get("line-pattern"),Ke=Ue.constantOr(1),nt=Ue.constantOr(null),kt=l.paint.get("line-opacity").constantOr(1);let xt=!Ke&&kt!==1||m.depthOcclusion&&L>0&&L<1;const Zt=l.paint.get("line-gradient"),Kt=Ke?"linePattern":"line",ln=i.c$(l);let vt;if(pe&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(xt=!1),L!==0&&m.depthOcclusion){const mt=l.paint._values["line-opacity"];mt&&mt.value&&mt.value.kind==="constant"?vt=mt.value:i.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&ln.push("VARIABLE_LINE_WIDTH");const Ht=(mt,Gt,Bt,Xt,Rt,Qt)=>{for(const gn of mt){const _n=r.getTile(gn);if(Ke&&!_n.patternsLoaded())continue;const xn=_n.getBucket(l);if(!xn||xn.hasZOffset&&!Rt||!xn.hasZOffset&&Rt)continue;m.prepareDrawTile();const Dn=xn.programConfigurations.get(l.id),ar=m.isTileAffectedByFog(gn),Vn=m.getOrCreateProgram(Kt,{config:Dn,defines:Gt,overrideFog:ar,overrideRtt:!Rt&&void 0});if(nt&&_n.imageAtlas){const cr=i.d0.from(nt).getPrimary().scaleSelf(Te).toString(),Nn=_n.imageAtlas.patternPositions.get(cr);Nn&&Dn.setConstantPatternPositions(Nn)}if(!Ke&&Be&&je&&_n.lineAtlas){const cr=_n.lineAtlas.getDash(Be,je);cr&&Dn.setConstantPatternPositions(cr)}let[ir,Yn]=l.paint.get("line-trim-offset");(je==="round"||je==="square")&&ir!==Yn&&(ir===0&&(ir-=1),Yn===1&&(Yn+=1));const Cr=pe?gn.projMatrix:null,ri=F?1/xn.tileToMeter/i.at(_n,1,m.transform.zoom):1,Mi=F?1/xn.tileToMeter/i.at(_n,1,Math.floor(m.transform.zoom)):1,xr=Ke?i.d1(m,_n,l,Cr,Te,ri,Mi,[ir,Yn]):i.d2(m,_n,l,Cr,xn.lineClipsArray.length,Te,ri,Mi,[ir,Yn]);if(Zt){const cr=xn.gradients[l.id];let Nn=cr.texture;if(l.gradientVersion!==cr.version){let Lr=256;if(l.stepInterpolant){const ai=r.getSource().maxzoom,Yr=gn.canonical.z===ai?Math.ceil(1<<m.transform.maxZoom-gn.canonical.z):1;Lr=i.ay(i.d3(xn.maxLineLength/i.ai*1024*Yr),256,H.maxTextureSize)}cr.gradient=i.d4({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Lr,image:cr.gradient||void 0,clips:xn.lineClipsArray}),cr.texture?cr.texture.update(cr.gradient):cr.texture=new i.T(H,cr.gradient,W.RGBA8),cr.version=l.gradientVersion,Nn=cr.texture}H.activeTexture.set(W.TEXTURE1),Nn.bind(l.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}Ie&&(H.activeTexture.set(W.TEXTURE0),_n.lineAtlasTexture&&_n.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Dn.updatePaintBuffers()),Ke&&(H.activeTexture.set(W.TEXTURE0),_n.imageAtlasTexture&&_n.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Dn.updatePaintBuffers()),Rt&&!B&&m.terrain.setupElevationDraw(_n,Vn),m.uploadCommonUniforms(H,Vn,gn.toUnwrapped());const $i=cr=>{vt!=null&&(vt.value=kt*L),Vn.draw(m,W.TRIANGLES,Bt,cr,fe,Xn.disabled,xr,l.id,xn.layoutVertexBuffer,xn.indexBuffer,xn.segments,l.paint,m.transform.zoom,Dn,[xn.layoutVertexBuffer2,xn.patternVertexBuffer,xn.zOffsetVertexBuffer]),vt!=null&&(vt.value=kt)};if(xt&&!Rt){const cr=m.stencilModeForClipping(gn).ref;cr===0&&pe&&H.clear({stencil:0});const Nn={func:W.EQUAL,mask:255};xr.u_alpha_discard_threshold=.8,$i(new Hn(Nn,cr,255,W.KEEP,W.KEEP,W.INVERT)),xr.u_alpha_discard_threshold=0,$i(new Hn(Nn,cr,255,W.KEEP,W.KEEP,W.KEEP))}else xr.u_alpha_discard_threshold=xt&&Rt&&Qt?.8:0,$i(Rt?Xt:m.stencilModeForClipping(gn))}};if(l.hasNonElevatedBuckets){const mt=!pe&&m.terrain;L!==0&&mt?i.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`):mt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${l.id}.`):Ht(p,ln,m.depthModeForSublayer(0,Rn.ReadOnly),Hn.disabled,!1,!0)}if(l.hasElevatedBuckets){ln.push("ELEVATED"),ce&&ln.push(oe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),B&&ln.push("ELEVATION_REFERENCE_SEA");const mt=xt?m.stencilModeFor3D():Hn.disabled,Gt=new Rn(m.depthOcclusion?W.GREATER:W.LEQUAL,Rn.ReadOnly,m.depthRangeFor3D);m.forceTerrainMode=!0,Ht(p,ln,Gt,mt,!0,!0),xt&&Ht(p,ln,Gt,mt,!0,!1),m.forceTerrainMode=!1}xt&&(m.resetStencilClippingMasks(),pe&&H.clear({stencil:0})),L===0||m.depthOcclusion||pe||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,r,l,p){const y=l.paint.get("fill-color"),b=l.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const S=l.paint.get("fill-emissive-strength"),L=m.colorModeForDrapableLayerRenderPass(S),N=l.paint.get("fill-pattern"),F=m.opaquePassEnabledForLayer()&&!N.constantOr(1)&&y.constantOr(i.al.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let B="none";l.layout.get("fill-elevation-reference")!=="none"?B="road":l.paint.get("fill-z-offset").constantOr(1)!==0&&(B="offset");const H=!(!m.terrain||!m.terrain.enabled),W={painter:m,sourceCache:r,layer:l,coords:p,colorMode:L,elevationType:B,terrainEnabled:H,pass:F};if(B!=="offset"){if(go(W,!1),B==="road"){const ee=!H&&m.renderPass==="translucent";ee&&io(m,r,l,p,"geometry"),go(W,!0,Hn.disabled),ee&&function(ce){const{painter:oe,sourceCache:fe,layer:pe,coords:Te,colorMode:De}=ce,Ie=oe.context.gl,Ge=new Rn(oe.context.gl.LEQUAL,Rn.ReadOnly,oe.depthRangeFor3D);for(const Be of Te){const je=fe.getTile(Be),Ue=je.getBucket(pe);if(!Ue)continue;const Ke=Ue.elevatedStructures;if(!Ke||!Ke.renderableSegments||Ke.renderableSegments.segments[0].primitiveLength===0)continue;oe.prepareDrawTile();const nt=Ue.bufferData.programConfigurations.get(pe.id),kt=oe.isTileAffectedByFog(Be),xt=oe.getOrCreateProgram("elevatedStructures",{config:nt,overrideFog:kt,defines:["NORMAL_OFFSET"]}),Zt={u_matrix:oe.translatePosMatrix(Be.projMatrix,je,pe.paint.get("fill-translate"),pe.paint.get("fill-translate-anchor"))};oe.uploadCommonUniforms(oe.context,xt,Be.toUnwrapped()),xt.draw(oe,Ie.TRIANGLES,Ge,Hn.disabled,De,Xn.backCCW,Zt,pe.id,Ke.vertexBuffer,Ke.indexBuffer,Ke.renderableSegments,pe.paint,oe.transform.zoom,nt,[Ke.vertexBufferNormal])}}(W)}}else go(W,!1,m.stencilModeFor3D())},"fill-extrusion":function(m,r,l,p){const y=l.paint.get("fill-extrusion-opacity"),b=m.context,S=b.gl,L=m.terrain,N=L&&L.renderingToTexture;if(y===0)return;const F=m.conflationActive&&m.style.isLayerClipped(l,r.getSource()),B=m.style.order.indexOf(l.fqid);if(F&&function(H,W,ee,ce,oe){for(const fe of ce){const pe=W.getTile(fe).getBucket(ee);pe&&(pe.updateReplacement(fe,H.replacementSource,oe),pe.uploadCentroid(H.context))}}(m,r,l,p,B),L||F)for(const H of p){const W=r.getTile(H).getBucket(l);W&&ws(m.context,r,H,W,l,L,F)}if(m.renderPass==="shadow"&&m.shadowRenderer){const H=m.shadowRenderer;if(L&&y<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const W=H.getShadowPassDepthMode(),ee=H.getShadowPassColorMode();Uo(m,r,l,p,W,Hn.disabled,ee,F)}else if(m.renderPass==="translucent"){const H=!l.paint.get("fill-extrusion-pattern").constantOr(1),W=l.paint.get("fill-extrusion-color").constantOr(i.al.white);if(!N&&W.a!==0){const ee=new Rn(m.context.gl.LEQUAL,Rn.ReadWrite,m.depthRangeFor3D);y===1&&H?Uo(m,r,l,p,ee,Hn.disabled,Jn.unblended,F):(Uo(m,r,l,p,ee,Hn.disabled,Jn.disabled,F),Uo(m,r,l,p,ee,m.stencilModeFor3D(),m.colorModeForRenderPass(),F),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&H&&(!L&&m.transform.projection.name!=="globe"||N)){const ee=l.paint.get("fill-extrusion-opacity"),ce=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),fe=l.paint.get("fill-extrusion-flood-light-intensity"),pe=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Te=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(pe?null:l.lut).toArray01().slice(0,3),De=ce>0&&oe>0,Ie=fe>0,Ge=(je,Ue,Ke)=>(1-Ke)*je+Ke*Ue,Be=je=>{const Ue=m.depthModeForSublayer(1,Rn.ReadOnly,S.LEQUAL,!0),Ke=l.paint.get(je?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),nt=Ge(.1,3,Ke),kt=m._showOverdrawInspector;if(!kt){const xt=new Hn({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Zt=new Jn([S.ONE,S.ONE,S.ONE,S.ONE],i.al.transparent,[!1,!1,!1,!0],S.MIN);ta(m,r,l,p,Ue,xt,Zt,Xn.disabled,je,"sdf",ee,ce,oe,fe,Te,nt,F,!1)}{const xt=kt?Hn.disabled:new Hn({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Zt=kt?m.colorModeForRenderPass():new Jn([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],i.al.transparent,[!0,!0,!0,!0]);ta(m,r,l,p,Ue,xt,Zt,Xn.disabled,je,"color",ee,ce,oe,fe,Te,nt,F,!1)}};if(N){const je=(Ue,Ke,nt)=>{const kt=m.depthModeForSublayer(1,Rn.ReadOnly,S.LEQUAL,!1),xt=l.paint.get(Ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Zt=Ge(.1,3,xt);{const Kt=new Jn([S.ONE,S.ONE,S.ONE,S.ONE],i.al.transparent,[!1,!1,!1,!0]);ta(m,r,l,p,kt,Hn.disabled,Kt,Xn.disabled,Ue,"clear",ee,ce,oe,fe,Te,Zt,F,Ke)}{const Kt=new Hn({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),ln=new Jn([S.ONE,S.ONE,S.ONE,S.ONE],i.al.transparent,[!1,!1,!1,!0],S.MIN);ta(m,r,l,p,kt,Kt,ln,Xn.disabled,Ue,"sdf",ee,ce,oe,fe,Te,Zt,F,Ke)}{const Kt=Ue?S.ZERO:S.ONE_MINUS_DST_ALPHA,ln=new Hn({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),vt=new Jn([Kt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],i.al.transparent,[!0,!0,!0,!0]);ta(m,r,l,p,kt,ln,vt,Xn.disabled,Ue,"color",ee,ce,oe,fe,Te,Zt,F,Ke)}{const Kt=new Jn([S.ONE,S.ONE,S.ONE,Ue?S.ZERO:S.ONE],i.al.transparent,[!1,!1,!1,!0],Ue?S.FUNC_ADD:S.MAX);ta(m,r,l,p,kt,Hn.disabled,Kt,Xn.disabled,Ue,"clear",ee,ce,oe,fe,Te,Zt,F,Ke,nt)}};if(De||Ie){let Ue;if(m.prepareDrawTile(),L){const Ke=L.drapeBufferSize[0],nt=L.drapeBufferSize[1];Ue=L.framebufferCopyTexture,Ue&&(!Ue||Ue.size[0]===Ke&&Ue.size[1]===nt)||(Ue&&Ue.destroy(),Ue=L.framebufferCopyTexture=new i.T(b,new i.r({width:Ke,height:nt}),S.RGBA8)),Ue.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Ke,nt)}De&&je(!0,!1,Ue),Ie&&je(!1,!0,Ue)}}else De&&Be(!0),Ie&&Be(!1),(De||Ie)&&m.resetStencilClippingMasks()}}},hillshade:function(m,r,l,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const y=m.context,b=m.terrain&&m.terrain.renderingToTexture,[S,L]=m.renderPass!=="translucent"||b?[{},p]:m.stencilConfigForOverlap(p);for(const N of L){const F=r.getTile(N);if(F.needsHillshadePrepare&&m.renderPass==="offscreen")gf(m,F,l);else if(m.renderPass==="translucent"){const B=m.depthModeForSublayer(0,Rn.ReadOnly),H=l.paint.get("hillshade-emissive-strength"),W=m.colorModeForDrapableLayerRenderPass(H),ee=b&&m.terrain?m.terrain.stencilModeForRTTOverlap(N):S[N.overscaledZ];Co(m,N,F,l,B,ee,W)}}y.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,r,l,p,y,b){if(m.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const S=m.transform.projection.name==="globe",L=l.paint.get("raster-elevation")!==0,N=L&&S;if(m.renderElevatedRasterBackface&&!N)return;const F=m.context,B=F.gl,H=r.getSource(),W=function(Be,je,Ue,Ke){const nt=je.paint.get("raster-color"),kt=Be.type==="raster-array",xt=[],Zt=je.paint.get("raster-resampling"),Kt=je.paint.get("raster-color-mix");let ln=je.paint.get("raster-color-range");const vt=[Kt[0],Kt[1],Kt[2],0],Ht=Kt[3];let mt=Zt==="nearest"?Ke.NEAREST:Ke.LINEAR;if(kt&&(xt.push("RASTER_ARRAY"),nt||xt.push("RASTER_COLOR"),Zt==="linear"&&xt.push("RASTER_ARRAY_LINEAR"),mt=Ke.NEAREST,!ln&&Be.rasterLayers)){const Gt=Be.rasterLayers.find(({id:Bt})=>Bt===je.sourceLayer);Gt&&Gt.fields&&Gt.fields.range&&(ln=Gt.fields.range)}if(ln=ln||[0,1],nt){xt.push("RASTER_COLOR"),Ue.activeTexture.set(Ke.TEXTURE2),je.updateColorRamp(ln);let Gt=je.colorRampTexture;Gt||(Gt=je.colorRampTexture=new i.T(Ue,je.colorRamp,Ke.RGBA8)),Gt.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}return{mix:vt,range:ln,offset:Ht,defines:xt,resampling:mt}}(H,l,F,B);if(H instanceof i.aK&&!p.length&&!S)return;const ee=l.paint.get("raster-emissive-strength"),ce=m.colorModeForDrapableLayerRenderPass(ee),oe=m.terrain&&m.terrain.renderingToTexture,fe=!m.options.moving,pe=l.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(H instanceof i.aK&&!p.length&&(H.onNorthPole||H.onSouthPole)){const Be=L?m.stencilModeFor3D():Hn.disabled;return void Tt(!!H.onNorthPole,null,m,r,l,ee,W,Xn.disabled,Be)}if(!p.length)return;const[Te,De]=H instanceof i.aK||oe?[{},p]:m.stencilConfigForOverlap(p),Ie=De[De.length-1].overscaledZ;N&&W.defines.push("PROJECTION_GLOBE_VIEW"),L&&W.defines.push("RENDER_CUTOFF");const Ge=(Be,je,Ue)=>{for(const Ke of Be){const nt=Ke.toUnwrapped(),kt=r.getTile(Ke);if(oe&&(!kt||!kt.hasData()))continue;F.activeTexture.set(B.TEXTURE0);const xt=Md(kt,H,l,W);if(!xt||!xt.texture)continue;const{texture:Zt,mix:Kt,offset:ln,tileSize:vt,buffer:Ht}=xt;let mt,Gt;oe?(mt=Rn.disabled,Gt=Ke.projMatrix):L?(mt=new Rn(B.LEQUAL,Rn.ReadWrite,m.depthRangeFor3D),Gt=S?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(nt,fe)):(mt=m.depthModeForSublayer(Ke.overscaledZ-Ie,l.paint.get("raster-opacity")===1?Rn.ReadWrite:Rn.ReadOnly,B.LESS),Gt=m.transform.calculateProjMatrix(nt,fe));const Bt=m.terrain&&oe?m.terrain.stencilModeForRTTOverlap(Ke):Te[Ke.overscaledZ],Xt=b?0:l.paint.get("raster-fade-duration");kt.registerFadeDuration(Xt);const Rt=r.findLoadedParent(Ke,0),Qt=Cd(kt,Rt,r,m.transform,Xt);let gn,_n;m.terrain&&m.terrain.prepareDrawTile(),F.activeTexture.set(B.TEXTURE0),Zt.bind(pe,B.CLAMP_TO_EDGE),F.activeTexture.set(B.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(pe,B.CLAMP_TO_EDGE),gn=Math.pow(2,Rt.tileID.overscaledZ-kt.tileID.overscaledZ),_n=[kt.tileID.canonical.x*gn%1,kt.tileID.canonical.y*gn%1]):Zt.bind(pe,B.CLAMP_TO_EDGE),"useMipmap"in Zt&&F.extTextureFilterAnisotropic&&m.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const xn=m.transform;let Dn;const ar=L?rm(xn):[0,0,0,0];let Vn,ir,Yn,Cr,ri,Mi=0;if(N&&H instanceof i.aK&&H.coordinates.length>3)Vn=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0)))),ir=Float32Array.from(xn.globeMatrix),Yn=Float32Array.from(i.cE(xn)),Cr=[i.av(xn.center.lng),i.aC(xn.center.lat)],Dn=H.elevatedGlobePerspectiveTransform,ri=H.elevatedGlobeGridMatrix||new Float32Array(9);else if(N){const Nn=i.cF(Ke.canonical);Mi=i.cG(Nn.getCenter().lat),Vn=Float32Array.from(i.bc(i.cI(Ke.canonical))),ir=Float32Array.from(xn.globeMatrix),Yn=Float32Array.from(i.cE(xn)),Cr=[i.av(xn.center.lng),i.aC(xn.center.lat)],Dn=[0,0],ri=Float32Array.from(i.cH(Ke.canonical,Nn,Mi,xn.worldSize/xn._pixelsPerMercatorPixel))}else Dn=H instanceof i.aK?H.perspectiveTransform:[0,0],Vn=new Float32Array(16),ir=new Float32Array(9),Yn=new Float32Array(16),Cr=[0,0],ri=new Float32Array(9);const xr=nn(Gt,Vn,ir,Yn,ri,_n||[0,0],i.ag(m.transform.zoom),Cr,ar,gn||1,Qt,l,Dn,L?l.paint.get("raster-elevation"):0,2,Kt,ln,W.range,vt,Ht,ee),$i=m.isTileAffectedByFog(Ke),cr=m.getOrCreateProgram("raster",{defines:W.defines,overrideFog:$i});if(m.uploadCommonUniforms(F,cr,nt),H instanceof i.aK){const Nn=H.elevatedGlobeVertexBuffer,Lr=H.elevatedGlobeIndexBuffer;if(oe||!S)H.boundsBuffer&&H.boundsSegments&&cr.draw(m,B.TRIANGLES,mt,Hn.disabled,ce,Xn.disabled,xr,l.id,H.boundsBuffer,m.quadTriangleIndexBuffer,H.boundsSegments);else if(Nn&&Lr){const ai=xn.zoom<=i.c6?H.elevatedGlobeSegments:H.getSegmentsForLongitude(xn.center.lng);ai&&cr.draw(m,B.TRIANGLES,mt,Hn.disabled,ce,je,xr,l.id,Nn,Lr,ai)}}else if(N){mt=new Rn(B.LEQUAL,Rn.ReadOnly,m.depthRangeFor3D);const Nn=m.globeSharedBuffers;if(Nn){const[Lr,ai,Yr]=Nn.getGridBuffers(Mi,!1);cr.draw(m,B.TRIANGLES,mt,Ue||Bt,m.colorModeForRenderPass(),je,xr,l.id,Lr,ai,Yr)}}else{const{tileBoundsBuffer:Nn,tileBoundsIndexBuffer:Lr,tileBoundsSegments:ai}=m.getTileBoundsBuffers(kt);cr.draw(m,B.TRIANGLES,mt,Bt,ce,Xn.disabled,xr,l.id,Nn,Lr,ai)}}if(!(H instanceof i.aK)&&N)for(const Ke of Be){const nt=Ke.canonical.y===(1<<Ke.canonical.z)-1;Ke.canonical.y===0&&Tt(!0,Ke,m,r,l,ee,W,je,Ue||Hn.disabled),nt&&Tt(!1,Ke,m,r,l,ee,W,je===Xn.frontCW?Xn.backCW:Xn.frontCW,Ue||Hn.disabled)}};N?Ge(De,m.renderElevatedRasterBackface?Xn.backCW:Xn.frontCW,m.stencilModeFor3D()):Ge(De,Xn.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,r,l,p,y,b){m.renderPass==="offscreen"&&function(S,L,N,F){if(!F.length)return;const B=S.context,H=B.gl,W=L.getSource();if(!(W instanceof Wi))return;const ee=Math.ceil(Math.sqrt(N.paint.get("raster-particle-count")));let ce=N.particlePositionRGBAImage;if(!ce||ce.width!==ee){const De=function(Ie){const Ge=Ie*Ie,Be=new Uint8Array(4*Ge),je=function(Ke){return Ke|=0,Ke=Math.imul(2747636419^Ke,2654435769),Ke=Math.imul(Ke^Ke>>>16,2654435769),((Ke=Math.imul(Ke^Ke>>>16,2654435769))>>>0)/4294967296},Ue=1/1.1;for(let Ke=0;Ke<Ge;Ke++){const nt=Ue*(je(2*Ke+0)+mn),kt=Ue*(je(2*Ke+1)+mn),xt=255*nt%1,Zt=255*kt%1,Kt=xt,ln=kt-Zt/255,vt=Zt;Be[4*Ke+0]=255*(nt-xt/255),Be[4*Ke+1]=255*Kt,Be[4*Ke+2]=255*ln,Be[4*Ke+3]=255*vt}return Be}(ee);ce=N.particlePositionRGBAImage=new i.r({width:ee,height:ee},De)}let oe=N.particleFramebuffer;oe?oe.width!==ee&&(oe.destroy(),oe=N.particleFramebuffer=B.createFramebuffer(ee,ee,!0,null)):oe=N.particleFramebuffer=B.createFramebuffer(ee,ee,!0,null);const fe=[];for(const De of F){const Ie=L.getTile(De);if(!(Ie instanceof wo))continue;const Ge=Id(Ie,W,N);if(!Ge)continue;const Be=[Ie.tileSize,Ie.tileSize];let je=N.tileFramebuffer;je||(je=N.tileFramebuffer=B.createFramebuffer(Be[0],Be[1],!0,null));let Ue=Ie.rasterParticleState;Ue||(Ue=Ie.rasterParticleState=new Bu(B,De,Be,ce));const Ke=Ue.update(N.lastInvalidatedAt);Ue.particleTextureDimension!==ee&&Ue.updateParticleTexture(De,ce);const nt=Ue.targetColorTexture;Ue.targetColorTexture=Ue.backgroundColorTexture,Ue.backgroundColorTexture=nt;const kt=Ue.particleTexture0;Ue.particleTexture0=Ue.particleTexture1,Ue.particleTexture1=kt,fe.push([De,Ge,Ue,Ke])}if(fe.length===0)return;const pe=i.q.now(),Te=N.previousDrawTimestamp?.001*(pe-N.previousDrawTimestamp):.0167;if(N.previousDrawTimestamp=pe,N.hasColorMap()){B.activeTexture.set(H.TEXTURE0+2);let De=N.colorRampTexture;De||(De=N.colorRampTexture=new i.T(B,N.colorRamp,H.RGBA8)),De.bind(H.LINEAR,H.CLAMP_TO_EDGE)}B.bindFramebuffer.set(N.tileFramebuffer.framebuffer),function(De,Ie,Ge){const Be=De.context,je=Be.gl,Ue=Ie.tileFramebuffer;Be.activeTexture.set(je.TEXTURE0);const Ke={u_texture:0,u_opacity:1.05*(kt=Ie.paint.get("raster-particle-fade-opacity-factor"))/(kt+.05)},nt=De.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var kt;for(const xt of Ge){const[,,Zt,Kt]=xt;Ue.colorAttachment.set(Zt.targetColorTexture.texture),Be.viewport.set([0,0,Ue.width,Ue.height]),Be.clear({color:i.al.transparent}),Kt&&(Zt.backgroundColorTexture.bind(je.NEAREST,je.CLAMP_TO_EDGE),nt.draw(De,je.TRIANGLES,Rn.disabled,Hn.disabled,Jn.alphaBlended,Xn.disabled,Ke,Ie.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments))}}(S,N,fe),function(De,Ie,Ge,Be){const je=De.context,Ue=je.gl,Ke=Ge.tileFramebuffer,nt=De.transform.projection.name==="globe",kt=Ge.paint.get("raster-particle-max-speed");for(const xt of Be){const[Zt,Kt,ln]=xt;je.activeTexture.set(Ue.TEXTURE0+0),Kt.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE),Ke.colorAttachment.set(ln.targetColorTexture.texture);const vt=De.getOrCreateProgram("rasterParticleDraw",{defines:Kt.defines,overrideFog:!1});je.activeTexture.set(Ue.TEXTURE0+1);const Ht=Kt.scalarData?[]:[0,1,2,3].map(Bt=>i.d7[Bt](Zt));Ht.push(Zt);const mt=Zt.canonical.x,Gt=Zt.canonical.y;for(const Bt of Ht){const Xt=Ie.getTile(nt?Bt.wrapped():Bt);if(!Xt)continue;const Rt=Xt.rasterParticleState;if(!Rt)continue;const Qt=Bt.canonical.x+(1<<Bt.canonical.z)*(Bt.wrap-Zt.wrap),gn=Bt.canonical.y;Rt.particleTexture0.bind(Ue.NEAREST,Ue.CLAMP_TO_EDGE);const _n=Ot(1,Rt.particleTexture0.size[0],[Qt-mt,gn-Gt],0,Kt.texture.size,2,kt,Kt.textureOffset,Kt.scale,Kt.offset);vt.draw(De,Ue.POINTS,Rn.disabled,Hn.disabled,Jn.alphaBlended,Xn.disabled,_n,Ge.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}}(S,L,N,fe),B.bindFramebuffer.set(N.particleFramebuffer.framebuffer),function(De,Ie,Ge,Be){const je=De.context,Ue=je.gl,Ke=Ie.paint.get("raster-particle-max-speed"),nt=Be*Ie.paint.get("raster-particle-speed-factor")*.15,kt=function(Zt){return Math.pow(Zt,6)}(.01+1*Ie.paint.get("raster-particle-reset-rate-factor")),xt=Ie.particleFramebuffer;je.viewport.set([0,0,xt.width,xt.height]);for(const Zt of Ge){const[,Kt,ln]=Zt;je.activeTexture.set(Ue.TEXTURE0+0),Kt.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE),je.activeTexture.set(Ue.TEXTURE0+1);const vt=ln.particleTexture0;vt.bind(Ue.NEAREST,Ue.CLAMP_TO_EDGE);const Ht=Ut(1,vt.size[0],0,Kt.texture.size,Ke,nt,kt,Kt.textureOffset,Kt.scale,Kt.offset);xt.colorAttachment.set(ln.particleTexture1.texture),je.clear({color:i.al.transparent}),De.getOrCreateProgram("rasterParticleUpdate",{defines:Kt.defines}).draw(De,Ue.TRIANGLES,Rn.disabled,Hn.disabled,Jn.unblended,Xn.disabled,Ht,Ie.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments)}}(S,N,fe,Te)}(m,r,l,p),m.renderPass==="translucent"&&(function(S,L,N,F,B){const H=S.context,W=H.gl,ee=L.getSource().tileSize,ce=5*(1-i.ae(i.bY,i.bY+1,S.transform.zoom))*ee+N.paint.get("raster-particle-elevation"),oe=!S.options.moving,fe=S.transform.projection.name==="globe";if(!F.length)return;const[pe,Te]=S.stencilConfigForOverlap(F),De=[];fe&&De.push("PROJECTION_GLOBE_VIEW");const Ie=S.stencilModeFor3D();for(const Ge of Te){const Be=Ge.toUnwrapped(),je=L.getTile(Ge);if(!je.rasterParticleState)continue;const Ue=je.rasterParticleState,Ke=100;je.registerFadeDuration(Ke);const nt=L.findLoadedParent(Ge,0),kt=Cd(je,nt,L,S.transform,Ke);let xt,Zt;S.terrain&&S.terrain.prepareDrawTile(),H.activeTexture.set(W.TEXTURE0),Ue.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),H.activeTexture.set(W.TEXTURE1),nt&&nt.rasterParticleState?(nt.rasterParticleState.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),xt=Math.pow(2,nt.tileID.overscaledZ-je.tileID.overscaledZ),Zt=[je.tileID.canonical.x*xt%1,je.tileID.canonical.y*xt%1]):Ue.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const Kt=fe?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Be,oe),ln=S.transform,vt=Za(ln),Ht=i.cF(Ge.canonical),mt=i.cG(Ht.getCenter().lat);let Gt,Bt,Xt,Rt,Qt;fe?(Gt=Float32Array.from(i.bc(i.cI(Ge.canonical))),Bt=Float32Array.from(ln.globeMatrix),Xt=Float32Array.from(i.cE(ln)),Rt=[i.av(ln.center.lng),i.aC(ln.center.lat)],Qt=Float32Array.from(i.cH(Ge.canonical,Ht,mt,ln.worldSize/ln._pixelsPerMercatorPixel))):(Gt=new Float32Array(16),Bt=new Float32Array(9),Xt=new Float32Array(16),Rt=[0,0],Qt=new Float32Array(9));const gn=Pt(Kt,Gt,Bt,Xt,Qt,Zt||[0,0],i.ag(S.transform.zoom),Rt,vt,xt||1,kt,ce),_n=S.isTileAffectedByFog(Ge),xn=S.getOrCreateProgram("rasterParticle",{defines:De,overrideFog:_n});if(S.uploadCommonUniforms(H,xn,Be),fe){const Dn=new Rn(W.LEQUAL,Rn.ReadOnly,S.depthRangeFor3D),ar=0,Vn=S.globeSharedBuffers;if(Vn){const[ir,Yn,Cr]=Vn.getGridBuffers(mt,ar!==0);xn.draw(S,W.TRIANGLES,Dn,Ie,Jn.alphaBlended,S.renderElevatedRasterBackface?Xn.frontCCW:Xn.backCCW,gn,N.id,ir,Yn,Cr)}}else{const Dn=S.depthModeForSublayer(0,Rn.ReadOnly),ar=pe[Ge.overscaledZ],{tileBoundsBuffer:Vn,tileBoundsIndexBuffer:ir,tileBoundsSegments:Yn}=S.getTileBoundsBuffers(je);xn.draw(S,W.TRIANGLES,Dn,ar,Jn.alphaBlended,Xn.disabled,gn,N.id,Vn,ir,Yn)}}S.resetStencilClippingMasks()}(m,r,l,p),m.style.map.triggerRepaint())},background:function(m,r,l,p){const y=l.paint.get("background-color"),b=l.paint.get("background-color-use-theme").constantOr("default")==="none",S=l.paint.get("background-opacity"),L=l.paint.get("background-emissive-strength"),N=l.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const F=m.context,B=F.gl,H=m.transform,W=H.tileSize,ee=l.paint.get("background-pattern");let ce;if(ee!==void 0&&(ee===null||(ce=m.imageManager.getPattern(i.I.from(ee.toString()),l.scope,m.style.getLut(l.scope)),!ce)))return;const oe=!ee&&y.a===1&&S===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==oe)return;const fe=Hn.disabled,pe=m.depthModeForSublayer(0,oe==="opaque"?Rn.ReadWrite:Rn.ReadOnly),Te=m.colorModeForDrapableLayerRenderPass(L),De=ee?"backgroundPattern":"background";let Ie,Ge=p;if(Ge||(Ie=m.getBackgroundTiles(),Ge=Object.values(Ie).map(Be=>Be.tileID)),ee&&(F.activeTexture.set(B.TEXTURE0),m.imageManager.bind(m.context,l.scope)),N){const Be=m.getOrCreateProgram(De,{overrideFog:!1,overrideRtt:!0}),je=new Float32Array(i.ad.mat4.identity([])),Ue=new i.aH(0,0,0,0,0),Ke=ee?rr(je,L,S,m,0,l.scope,ce,N,{tileID:Ue,tileSize:W}):Tn(je,L,S,y.toRenderColor(b?null:l.lut));Be.draw(m,B.TRIANGLES,pe,fe,Te,Xn.disabled,Ke,l.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Be of Ge){const je=m.isTileAffectedByFog(Be),Ue=m.getOrCreateProgram(De,{overrideFog:je}),Ke=Be.toUnwrapped(),nt=p?Be.projMatrix:m.transform.calculateProjMatrix(Ke);m.prepareDrawTile();const kt=r?r.getTile(Be):Ie?Ie[Be.key]:new Ta(Be,W,H.zoom,m),xt=ee?rr(nt,L,S,m,0,l.scope,ce,N,{tileID:Be,tileSize:W}):Tn(nt,L,S,y.toRenderColor(b?null:l.lut));m.uploadCommonUniforms(F,Ue,Ke);const{tileBoundsBuffer:Zt,tileBoundsIndexBuffer:Kt,tileBoundsSegments:ln}=m.getTileBoundsBuffers(kt);Ue.draw(m,B.TRIANGLES,pe,fe,Te,Xn.disabled,xt,l.id,Zt,Kt,ln)}},sky:function(m,r,l){const p=m._atmosphere?i.ag(m.transform.zoom):1,y=l.paint.get("sky-opacity")*p;if(y===0)return;const b=m.context,S=l.paint.get("sky-type"),L=new Rn(b.gl.LEQUAL,Rn.ReadOnly,[0,1]),N=m.frameCounter/1e3%1;S==="atmosphere"?m.renderPass==="offscreen"?l.needsSkyboxCapture(m)&&(function(F,B,H,W){const ee=F.context,ce=ee.gl;let oe=B.skyboxFbo;if(!oe){oe=B.skyboxFbo=ee.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new Ic(ee),B.skyboxTexture=ee.gl.createTexture(),ce.bindTexture(ce.TEXTURE_CUBE_MAP,B.skyboxTexture),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MAG_FILTER,ce.LINEAR);for(let De=0;De<6;++De)ce.texImage2D(ce.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,ce.RGBA,32,32,0,ce.RGBA,ce.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(oe.framebuffer),ee.viewport.set([0,0,32,32]);const fe=B.getCenter(F,!0),pe=F.getOrCreateProgram("skyboxCapture"),Te=new Float64Array(16);i.ad.mat4.identity(Te),i.ad.mat4.rotateY(Te,Te,.5*-Math.PI),Ys(F,B,pe,Te,fe,0),i.ad.mat4.identity(Te),i.ad.mat4.rotateY(Te,Te,.5*Math.PI),Ys(F,B,pe,Te,fe,1),i.ad.mat4.identity(Te),i.ad.mat4.rotateX(Te,Te,.5*-Math.PI),Ys(F,B,pe,Te,fe,2),i.ad.mat4.identity(Te),i.ad.mat4.rotateX(Te,Te,.5*Math.PI),Ys(F,B,pe,Te,fe,3),i.ad.mat4.identity(Te),Ys(F,B,pe,Te,fe,4),i.ad.mat4.identity(Te),i.ad.mat4.rotateY(Te,Te,Math.PI),Ys(F,B,pe,Te,fe,5),ee.viewport.set([0,0,F.width,F.height])}(m,l),l.markSkyboxValid(m)):m.renderPass==="sky"&&function(F,B,H,W,ee){const ce=F.context,oe=ce.gl,fe=F.transform,pe=F.getOrCreateProgram("skybox");ce.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,B.skyboxTexture);const Te=((De,Ie,Ge,Be,je)=>({u_matrix:De,u_sun_direction:Ie,u_cubemap:0,u_opacity:Be,u_temporal_offset:je}))(fe.skyboxMatrix,B.getCenter(F,!1),0,W,ee);F.uploadCommonUniforms(ce,pe),pe.draw(F,oe.TRIANGLES,H,Hn.disabled,F.colorModeForRenderPass(),Xn.backCW,Te,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,l,L,y,N):S==="gradient"&&m.renderPass==="sky"&&function(F,B,H,W,ee){const ce=F.context,oe=ce.gl,fe=F.transform,pe=F.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Ic(ce)),ce.activeTexture.set(oe.TEXTURE0);let Te=B.colorRampTexture;Te||(Te=B.colorRampTexture=new i.T(ce,B.colorRamp,oe.RGBA8)),Te.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const De=((Ie,Ge,Be,je,Ue)=>({u_matrix:Ie,u_color_ramp:0,u_center_direction:Ge,u_radius:i.ak(Be),u_opacity:je,u_temporal_offset:Ue}))(fe.skyboxMatrix,B.getCenter(F,!1),B.paint.get("sky-gradient-radius"),W,ee);F.uploadCommonUniforms(ce,pe),pe.draw(F,oe.TRIANGLES,H,Hn.disabled,F.colorModeForRenderPass(),Xn.backCW,De,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,l,L,y,N)},debug:function(m,r,l,p,y,b){for(let S=0;S<l.length;S++)if(y){const F=new i.al(p.r*.8,p.g*.8,p.b*.8,1);El(m,r,l[S],p,-1,-1,b),El(m,r,l[S],p,-1,1,b),El(m,r,l[S],p,1,1,b),El(m,r,l[S],p,1,-1,b),El(m,r,l[S],F,0,0,b)}else El(m,r,l[S],p,0,0,b)},custom:function(m,r,l,p){const y=m.context,b=l.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&l.isDraped(r)){if(m.renderPass==="offscreen"){const S=b.prerender;if(S){if(m.setCustomLayerDefaults(),y.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const L=m.transform.pointMerc;S.call(b,y.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.ag(m.transform.zoom),[L.x,L.y],m.transform.pixelsPerMeterRatio)}else S.call(b,y.gl,m.transform.customLayerMatrix());y.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const L=b.renderToTile;if(L){const N=p[0].canonical,F=new i.ac(N.x+p[0].wrap*(1<<N.z),N.y,N.z);y.setDepthMode(Rn.disabled),y.setStencilMode(Hn.disabled),y.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),L.call(b,y.gl,F),y.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),y.setColorMode(m.colorModeForRenderPass()),y.setStencilMode(Hn.disabled);const S=b.renderingMode==="3d"?new Rn(m.context.gl.LEQUAL,Rn.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Rn.ReadOnly);if(y.setDepthMode(S),m.transform.projection.name==="globe"){const L=m.transform.pointMerc;b.render(y.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.ag(m.transform.zoom),[L.x,L.y],m.transform.pixelsPerMeterRatio)}else b.render(y.gl,m.transform.customLayerMatrix());y.setDirty(),m.setBaseState(),y.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,r,l,p){if(m.renderPass==="opaque")return;const y=l.paint.get("model-opacity").constantOr(1);if(y===0)return;const b=l.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!b||m.terrain&&y<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const S=m.shadowRenderer,L=l.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,L||(S.enabled=!1));const N=()=>{S&&(S.useNormalOffset=!0,L||(S.enabled=!0))},F=r.getSource();if(m.renderPass==="light-beam"&&F.type!=="batched-model")return;if(F.type==="vector"||F.type==="geojson")return function(pe,Te,De,Ie,Ge){const Be=pe.transform;if(Be.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Be.projection.name} projection is not yet implemented`);const je=Be.getFreeCameraOptions().position;if(!pe.modelManager)return;const Ue=pe.modelManager;De.modelManager=Ue;const Ke=pe.shadowRenderer;if(!De._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const nt=De._unevaluatedLayout._values["model-id"],kt=Object.assign({},De.layout.get("model-id").parameters),xt=pe.style.order.indexOf(De.fqid);for(const Zt of Ie){const Kt=Te.getTile(Zt).getBucket(De);if(!Kt||Kt.projection.name!==Be.projection.name)continue;const ln=Kt.getModelUris();ln&&!Kt.modelsRequested&&(Ue.addModelsFromBucket(ln,Ge),Kt.modelsRequested=!0);const vt=Pf(Zt,Be);kt.zoom=vt;const Ht=nt.possiblyEvaluate(kt);if(sm(pe,Kt,Zt),na.shadowUniformsInitialized=!1,na.useSingleShadowCascade=!!Ke&&Ke.getMaxCascadeForTile(Zt.toUnwrapped())===0,pe.renderPass==="shadow"&&Ke){if(pe.currentShadowCascade===1&&Kt.isInsideFirstShadowMapFrustum)continue;const Bt=Be.calculatePosMatrix(Zt.toUnwrapped(),Be.worldSize);if(na.tileMatrix.set(Bt),na.shadowTileMatrix=Float32Array.from(Ke.calculateShadowPassMatrixFromMatrix(Bt)),na.aabb.min.fill(0),na.aabb.max[0]=na.aabb.max[1]=i.ai,na.aabb.max[2]=0,Nd(Kt,na,pe,De.scope))continue}const mt=1<<Zt.canonical.z,Gt=[((je.x-Zt.wrap)*mt-Zt.canonical.x)*i.ai,(je.y*mt-Zt.canonical.y)*i.ai,je.z*mt*i.ai];pe.conflationActive&&Object.keys(Kt.instancesPerModel).length>0&&pe.style.isLayerClipped(De,Te.getSource())&&Kt.updateReplacement(Zt,pe.replacementSource,xt,Ge)&&(Kt.uploaded=!1,Kt.upload(pe.context));for(let Bt in Kt.instancesPerModel){const Xt=Kt.instancesPerModel[Bt];Xt.features.length>0&&(Bt=Ht.evaluate(Xt.features[0].feature,{}));const Rt=Ue.getModel(Bt,Ge);if(Rt&&Rt.uploaded)for(const Qt of Rt.nodes)ka(pe,De,Qt,Xt,Gt,Zt,na)}}}(m,r,l,p,F.type==="vector"?l.scope:""),void N();if(!F.loaded())return;if(F.type==="batched-model")return function(pe,Te,De,Ie){De.resetLayerRenderingStats(pe);const Ge=pe.context,Be=pe.transform,je=pe.style.fog,Ue=pe.shadowRenderer;if(Be.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Be.projection.name} projection is not yet implemented`);const Ke=pe.transform.getFreeCameraOptions().position,nt=i.ad.vec3.scale([],[Ke.x,Ke.y,Ke.z],pe.transform.worldSize),kt=i.ad.vec3.negate([],nt),xt=i.ad.mat4.identity([]),Zt=i.dm(Be.center.lat,Be.zoom),Kt=i.ad.mat4.fromScaling([],[1,1,1/Zt]);i.ad.mat4.translate(xt,xt,kt);const ln=De.paint.get("model-opacity").constantOr(1),vt=new Rn(Ge.gl.LEQUAL,Rn.ReadWrite,pe.depthRangeFor3D),Ht=new Rn(Ge.gl.LEQUAL,Rn.ReadOnly,pe.depthRangeFor3D),mt=new i.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Gt=pe.renderPass==="shadow",Bt=Gt&&Ue?Ue.getCurrentCascadeFrustum():Be.getFrustum(Be.scaleZoom(Be.worldSize)),Xt=De.paint.get("model-front-cutoff"),Rt=Xt[2]<1,Qt=Ps(pe,De.paint.get("model-cutoff-fade-range")),gn=De.getLayerRenderingStats();(function(_n,xn,Dn,ar){const Vn=_n.terrain?_n.terrain.exaggeration():0,ir=_n.transform.zoom;for(const Yn of ar){const Cr=xn.getTile(Yn).getBucket(Dn);Cr&&(Cr.setFilter(Dn.filter),_n.conflationActive&&Cr.updateReplacement(Yn,_n.replacementSource),Cr.evaluateScale(_n,Dn),_n.terrain&&Vn>0&&Cr.elevationUpdate(_n.terrain,Vn,Yn,Dn.source),Cr.needsReEvaluation(_n,ir,Dn)&&Cr.evaluate(Dn))}})(pe,Te,De,Ie),function(){let _n,xn,Dn;Rt?(_n=Ie.length-1,xn=-1,Dn=-1):(_n=0,xn=Ie.length,Dn=1);const ar=new Float64Array(16),Vn=i.ad.vec3.create(),ir=new i.P(0,0);for(let Yn=_n;Yn!==xn;Yn+=Dn){const Cr=Ie[Yn],ri=Te.getTile(Cr).getBucket(De);if(!ri||!ri.uploaded)continue;let Mi=!1;Ue&&(Mi=Ue.getMaxCascadeForTile(Cr.toUnwrapped())===0);const xr=Be.calculatePosMatrix(Cr.toUnwrapped(),Be.worldSize),$i=ri.modelTraits;!Gt&&Rt&&(i.ad.mat4.invert(ar,xr),i.ad.vec3.transformMat4(Vn,nt,ar),ir.x=Vn[0],ir.y=Vn[1]);const cr=[];ri.setFilter(De.filter);for(const Nn of ri.getNodesInfo()){if(Nn.hiddenByReplacement||!Nn.node.meshes)continue;const Lr=Nn.node;let ai=0;pe.terrain&&Lr.elevation&&(ai=Lr.elevation*pe.terrain.exaggeration());const Yr=(()=>{const xi=Nn.aabb;return mt.min=[...xi.min],mt.max=[...xi.max],mt.min[2]+=ai,mt.max[2]+=ai,i.ad.vec3.transformMat4(mt.min,mt.min,xr),i.ad.vec3.transformMat4(mt.max,mt.max,xr),mt})(),rs=Nn.evaluatedScale;if(rs[0]<=1&&rs[1]<=1&&rs[2]<=1&&Yr.intersects(Bt)===0)continue;if(!Gt&&Rt){const xi=.16666666666666666;Nn.cameraCollisionOpacity=nt[0]>Yr.min[0]&&nt[0]<Yr.max[0]&&nt[1]>Yr.min[1]&&nt[1]<Yr.max[1]&&nt[2]*Zt<Yr.max[2]&&Lr.footprint&&i.bA(ir,Lr.footprint)?Math.max(Nn.cameraCollisionOpacity-xi,0):Math.min(1,Nn.cameraCollisionOpacity+xi)}const Ms=[...xr],Js=Lr.anchor?Lr.anchor[0]:0,so=Lr.anchor?Lr.anchor[1]:0;i.ad.mat4.translate(Ms,Ms,[Js*(rs[0]-1),so*(rs[1]-1),ai]),i.ad.vec3.exactEquals(rs,i.dq)||i.ad.mat4.scale(Ms,Ms,rs);const Dl=i.ad.mat4.multiply([],Ms,Lr.matrix),ia=i.ad.mat4.multiply([],Be.expandedFarZProjMatrix,Dl),Wr=i.ad.mat4.multiply([],Be.expandedFarZProjMatrix,Ms),Gi=i.ad.vec4.transformMat4([],[Js,so,ai,1],ia)[2];Lr.hidden=!1;let ii=ln;Gt||(Rt&&(ii*=Nn.cameraCollisionOpacity,ii*=om(Ms,Be,Nn.aabb,Xt)),ii*=Od(Qt,Gi)),ii!==0?cr.push({nodeInfo:Nn,depth:Gi,opacity:ii,wvpForNode:ia,wvpForTile:Wr,nodeModelMatrix:Dl,tileModelMatrix:Ms}):Lr.hidden=!0}Gt||cr.sort((Nn,Lr)=>!Rt||Nn.opacity===1&&Lr.opacity===1?Nn.depth<Lr.depth?-1:1:Nn.opacity===1?-1:Lr.opacity===1?1:Nn.depth>Lr.depth?-1:1);for(const Nn of cr){const Lr=Nn.nodeInfo,ai=Lr.node;let Yr=i.ad.mat4.multiply([],Kt,Nn.tileModelMatrix);i.ad.mat4.multiply(Yr,xt,Yr);const rs=i.ad.mat4.invert([],Yr);i.ad.mat4.transpose(rs,rs),i.ad.mat4.scale(rs,rs,ra),Yr=i.ad.mat4.multiply(Yr,Yr,ai.matrix);const Ms=pe.renderPass==="light-beam",Js=De.paint.get("model-color-use-theme").constantOr("default")==="none",so=$i&i.ds.HasMapboxMeshFeatures,Dl=so?0:Lr.evaluatedRMEA[0][2];for(let ia=0;ia<ai.meshes.length;++ia){const Wr=ai.meshes[ia],Gi=ia===ai.lightMeshIndex;let ii=Nn.wvpForNode;if(Gi){if(!Ms&&!pe.terrain&&pe.shadowRenderer){pe.currentLayer<pe.firstLightBeamLayer&&(pe.firstLightBeamLayer=pe.currentLayer);continue}ii=Nn.wvpForTile}else if(Ms)continue;const xi={defines:[]},Mo=[];if(!Gt&&Ue&&(Ue.useNormalOffset=!!Wr.normalBuffer),Lc(xi.defines,Mo,Wr,pe,Js?null:De.lut),so||xi.defines.push("DIFFUSE_SHADED"),Mi&&xi.defines.push("SHADOWS_SINGLE_CASCADE"),gn&&(Gt?gn.numRenderedVerticesInShadowPass+=Wr.vertexArray.length:gn.numRenderedVerticesInTransparentPass+=Wr.vertexArray.length),Gt){kh(Wr,Nn.nodeModelMatrix,pe,De);continue}let zi=null;if(je){const ac=ic(Nn.nodeModelMatrix,pe.transform);if(zi=new Float32Array(ac),Be.projection.name!=="globe"){const tl=Wr.aabb.min,$u=Wr.aabb.max,[hu,Gu]=je.getOpacityForBounds(ac,tl[0],tl[1],$u[0],$u[1]);xi.overrideFog=hu>=pn||Gu>=pn}}const Qs=Wr.material;let uu;Qs.occlusionTexture&&Qs.occlusionTexture.offsetScale&&(uu=Qs.occlusionTexture.offsetScale,xi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const el=pe.getOrCreateProgram("model",xi);!Gt&&Ue&&Ue.setupShadowsFromMatrix(Nn.tileModelMatrix,el,Ue.useNormalOffset),pe.uploadCommonUniforms(Ge,el,null,zi);const oc=Qs.pbrMetallicRoughness;oc.metallicFactor=.9,oc.roughnessFactor=.5;const Ra=Ar(new Float32Array(ii),new Float32Array(Yr),new Float32Array(rs),new Float32Array(ai.matrix),pe,Nn.opacity,oc.baseColorFactor.toRenderColor(null),Qs.emissiveFactor,oc.metallicFactor,oc.roughnessFactor,Qs,Dl,De,[0,0,0],uu);!Gi&&(Lr.hasTranslucentParts||Nn.opacity<1)&&el.draw(pe,Ge.gl.TRIANGLES,vt,Hn.disabled,Jn.disabled,Xn.backCCW,Ra,De.id,Wr.vertexBuffer,Wr.indexBuffer,Wr.segments,De.paint,pe.transform.zoom,void 0,Mo),el.draw(pe,Ge.gl.TRIANGLES,Gi?Ht:vt,Hn.disabled,Gi||Nn.opacity<1||Lr.hasTranslucentParts?Jn.alphaBlended:Jn.unblended,Xn.backCCW,Ra,De.id,Wr.vertexBuffer,Wr.indexBuffer,Wr.segments,De.paint,pe.transform.zoom,void 0,Mo)}}}}()}(m,r,l,p),void N();if(F.type!=="model")return;const B=F.getModels(),H=[],W=m.transform.getFreeCameraOptions().position,ee=i.ad.vec3.scale([],[W.x,W.y,W.z],m.transform.worldSize);i.ad.vec3.negate(ee,ee);const ce=[],oe=[];let fe=0;for(const pe of B){const Te=l.paint.get("model-rotation").constantOr(null),De=l.paint.get("model-scale").constantOr(null),Ie=l.paint.get("model-translation").constantOr(null);pe.computeModelMatrix(m,Te,De,Ie,!0,!0,!1);const Ge=i.ad.mat4.identity([]),Be=i.dm(pe.position.lat,m.transform.zoom),je=i.ad.mat4.fromScaling([],[1,1,1/Be]);i.ad.mat4.translate(Ge,Ge,ee),H.push({zScaleMatrix:je,negCameraPosMatrix:Ge});for(const Ue of pe.nodes)Il(m.transform,Ue,pe.matrix,m.transform.expandedFarZProjMatrix,fe,ce,oe);fe++}if(ce.sort((pe,Te)=>Te.depth-pe.depth),m.renderPass!=="shadow"){if(y===1)for(const pe of oe)Ml(pe,m,l,H[pe.modelIndex],Hn.disabled,m.colorModeForRenderPass());else{for(const pe of oe)Ml(pe,m,l,H[pe.modelIndex],Hn.disabled,Jn.disabled);for(const pe of oe)Ml(pe,m,l,H[pe.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const pe of ce)Ml(pe,m,l,H[pe.modelIndex],Hn.disabled,m.colorModeForRenderPass());N()}else{for(const pe of oe)kh(pe.mesh,pe.nodeModelMatrix,m,l);for(const pe of ce)kh(pe.mesh,pe.nodeModelMatrix,m,l);N()}}},Nh={line:function(m,r,l){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const p=r.getVisibleCoordinates();for(const y of p){const b=r.getTile(y).getBucket(m);if(b&&(b.hasZOffset?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,r,l){const p=r.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,p.type==="vector"?m.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const y=p.getModels();for(const b of y)b.upload(l.context)},raster:function(m,r,l){const p=r.getSource();if(!(p instanceof Wi&&p.loaded()))return;const y=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=m.paint.get("raster-array-band")||p.getInitialBand(y);if(b==null)return;const S=r.getIds().map(L=>r.getTileByID(L));for(const L of S)L.updateNeeded(y,b)&&p.prepareTile(L,y,b)},"raster-particle":function(m,r,l){const p=r.getSource();if(!(p instanceof Wi&&p.loaded()))return;const y=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=m.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(b==null)return;const S=r.getIds().map(L=>r.getTileByID(L));for(const L of S)L.updateNeeded(y,b)&&p.prepareTile(L,y,b)}},Oh={fill:io};class Sg{constructor(r,l,p,y,b){this.context=new Ai(r,l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const N of S)this._debugParams.enabledLayers[N]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const N of S)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],N);this.occlusionParams=new am(b),this.setup(),this.numSublayers=So.maxUnderzooming+So.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ks(this),this._wireframeDebugCache=new Ka,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const L=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,L,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y}updateTerrain(r,l){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new vg(this,r));const y=this._terrain;this.transform.elevation=p?y:null,y.update(r,this.transform,l),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(r){const l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=l.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const b=p+.78*(y-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new vg(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,l){if(this.width=r*i.q.devicePixelRatio,this.height=l*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const r=this.context,l=new i.b5;l.emplaceBack(0,0),l.emplaceBack(i.ai,0),l.emplaceBack(0,i.ai),l.emplaceBack(i.ai,i.ai),this.tileExtentBuffer=r.createVertexBuffer(l,i.b7.members),this.tileExtentSegments=i.b8.simpleSegment(0,0,4,2);const p=new i.b5;p.emplaceBack(0,0),p.emplaceBack(i.ai,0),p.emplaceBack(0,i.ai),p.emplaceBack(i.ai,i.ai),this.debugBuffer=r.createVertexBuffer(p,i.b7.members),this.debugSegments=i.b8.simpleSegment(0,0,4,5);const y=new i.b5;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,i.b7.members),this.viewportSegments=i.b8.simpleSegment(0,0,4,2);const b=new i.aU;b.emplaceBack(0,0,0,0),b.emplaceBack(i.ai,0,i.ai,0),b.emplaceBack(0,i.ai,0,i.ai),b.emplaceBack(i.ai,i.ai,i.ai,i.ai),this.mercatorBoundsBuffer=r.createVertexBuffer(b,i.ba.members),this.mercatorBoundsSegments=i.b8.simpleSegment(0,0,4,2);const S=new i.aV;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);const L=new i.b6;for(const F of[0,1,3,2,0])L.emplaceBack(F);this.debugIndexBuffer=r.createIndexBuffer(L),this.emptyTexture=new i.T(r,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=i.ad.mat4.create();const N=this.context.gl;this.stencilClearMode=new Hn({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Rn.disabled,this.stencilClearMode,Jn.disabled,Xn.disabled,au(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let L=!1;for(const N of p)if(this._tileClippingMaskIDs[N.key]===void 0){L=!0;break}if(!L)return}this.currentStencilSource=l.id;const y=this.context,b=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(Jn.disabled),y.setDepthMode(Rn.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const L of p){const N=l.getTile(L),F=this._tileClippingMaskIDs[L.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:H,tileBoundsSegments:W}=this.getTileBoundsBuffers(N);S.draw(this,b.TRIANGLES,Rn.disabled,new Hn({func:b.ALWAYS,mask:0},F,255,b.KEEP,b.KEEP,b.REPLACE),Jn.disabled,Xn.disabled,au(L.projMatrix),"$clipping",B,H,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new Hn({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new Hn({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((S,L)=>L.overscaledZ-S.overscaledZ),y=p[p.length-1].overscaledZ,b=p[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let L=0;L<b;L++)S[L+y]=new Hn({func:l.GEQUAL,mask:255},L+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=b,[S,p]}return[{[y]:Hn.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Jn([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new i.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Jn.unblended:Jn.alphaBlended}colorModeForDrapableLayerRenderPass(r){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Jn([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new i.al(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,l,p,y=!1){if(this.depthOcclusion)return new Rn(this.context.gl.GREATER,Rn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Rn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Rn(p||this.context.gl.LEQUAL,l,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,l=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&p!==0&&(this.depthFBO=new oi(this.context,l,p,!1,"texture"),this.depthTexture=new i.T(this.context,{width:l,height:p,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),r.bindTexture(r.TEXTURE_2D,b),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,l,p,0,0,l,p,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,l)=>r+l/this._fpsHistory.length,0))}render(r,l){const p=i.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=l;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(b).filter(vt=>{const Ht=y[vt];return!(Ht.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ht.type]});let L=S(),N=!1,F=!1;for(const vt of L){const Ht=y[vt];Ht.type==="circle"&&(N=!0),Ht.type==="symbol"&&(Ht.hasInitialOcclusionOpacityProperties?F=!0:N=!0)}let B=L.map(vt=>y[vt]);const H=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let W=0,ee=!1;for(const vt in H){const Ht=H[vt];Ht.used&&(Ht.prepare(this.context),Ht.getSource().usedInConflation&&++W)}let ce=!1;for(const vt of B)vt.isHidden(this.transform.zoom)||(vt.type==="clip"&&(ce=!0),this.prepareLayer(vt));const oe={},fe={},pe={},Te={},De={};for(const vt in H){const Ht=H[vt];oe[vt]=Ht.getVisibleCoordinates(),fe[vt]=oe[vt].slice().reverse(),pe[vt]=Ht.getVisibleCoordinates(!0).reverse(),Te[vt]=Ht.getShadowCasterCoordinates(),De[vt]=Ht.sortCoordinatesByDistance(oe[vt])}const Ie=vt=>{const Ht=this.style.getLayerSourceCache(vt);return Ht&&Ht.used?Ht.getSource():null};if(W||ce||this._clippingActiveLastFrame){const vt=[],Ht=[];let mt=0;for(const Gt of B)this.isSourceForClippingOrConflation(Gt,Ie(Gt))&&(vt.push(Gt),Ht.push(mt)),mt++;if(vt&&(ce||vt.length>1)||this._clippingActiveLastFrame){ce=!1;const Gt=[];for(let Bt=0;Bt<vt.length;Bt++){const Xt=vt[Bt],Rt=Ht[Bt],Qt=this.style.getLayerSourceCache(Xt);if(!Qt||!Qt.used||!Qt.getSource().usedInConflation&&Xt.type!=="clip")continue;let gn=i.dA,_n=i.by.None;const xn=[];let Dn=!0;if(Xt.type==="clip"){gn=Rt;for(const ar of Xt.layout.get("clip-layer-types"))_n|=ar==="model"?i.by.Model:ar==="symbol"?i.by.Symbol:i.by.FillExtrusion;for(const ar of Xt.layout.get("clip-layer-scope"))xn.push(ar);Xt.isHidden(this.transform.zoom)?Dn=!1:ce=!0}Dn&&Gt.push({layer:Xt.fqid,cache:Qt,order:gn,clipMask:_n,clipScope:xn})}this.replacementSource.setSources(Gt),ee=!0}}this._clippingActiveLastFrame=ce,ee||this.replacementSource.clear(),this.conflationActive=ee,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let vt=0;vt<B.length;vt++){const Ht=B[vt],mt=Ht.cutoffRange();if(this.longestCutoffRange=Math.max(mt,this.longestCutoffRange),mt>0){const Gt=Ie(Ht);Gt&&(this.minCutoffZoom=Math.max(Gt.minzoom,this.minCutoffZoom)),Ht.minzoom&&(this.minCutoffZoom=Math.max(Ht.minzoom,this.minCutoffZoom))}Ht.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=vt),this._lastOcclusionLayer=vt)}const Ge=this.style&&this.style.fog;Ge?(this._fogVisible=Ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,L=S(),B=L.map(vt=>y[vt]));const Be=this._shadowRenderer;if(Be){Be.updateShadowParameters(this.transform,this.style.directionalLight);for(const vt in H)for(const Ht of oe[vt]){let mt={min:0,max:0};this.terrain&&(mt=this.terrain.getMinMaxForTile(Ht)||mt),Be.addShadowReceiver(Ht.toUnwrapped(),mt.min,mt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new im(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const je=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(je&&!this._snow&&(this._snow=new Vu(this)),!je&&this._snow&&(this._snow.destroy(),delete this._snow),Ue&&!this._rain&&(this._rain=new Dh(this)),!Ue&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!dn.has(this.context.gl))return;this.renderPass="offscreen";for(const vt of B){const Ht=r.getLayerSourceCache(vt);if(!vt.hasOffscreenPass()||vt.isHidden(this.transform.zoom))continue;const mt=Ht?fe[Ht.id]:void 0;(vt.type==="custom"||vt.type==="raster"||vt.type==="raster-particle"||vt.isSky()||mt&&mt.length)&&this.renderLayer(this,Ht,vt,mt)}this.depthRangeFor3D=[0,1-(B.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Te)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ke=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),nt=(()=>{if(l.showOverdrawInspector)return i.al.black;const vt=this.style.fog;if(vt&&this.transform.projection.supportsFog){const Ht=this.style.getLut(vt.scope);if(!Ke){const mt=vt.properties.get("color-use-theme")==="none",Gt=vt.properties.get("color").toRenderColor(mt?null:Ht).toArray01();return new i.al(...Gt)}if(Ke){const mt=vt.properties.get("space-color-use-theme")==="none",Gt=vt.properties.get("space-color").toRenderColor(mt?null:Ht).toArray01();return new i.al(...Gt)}}return i.al.transparent})();if(this.context.clear({color:nt,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ke&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const vt=B[this.currentLayer],Ht=r.getLayerSourceCache(vt);if(vt.isSky())continue;const mt=Ht?(vt.is3D(b)?De:fe)[Ht.id]:void 0;this._renderTileClippingMasks(vt,Ht,mt),this.renderLayer(this,Ht,vt,mt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ke&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const vt=B[this.currentLayer],Ht=r.getLayerSourceCache(vt);vt.isSky()&&this.renderLayer(this,Ht,vt,Ht?fe[Ht.id]:void 0)}function kt(vt,Ht){let mt;return Ht&&(mt=(vt.type==="symbol"?pe:vt.is3D(b)?De:fe)[Ht.id]),mt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<L.length;){const vt=B[this.currentLayer];if(vt.type==="raster"||vt.type==="raster-particle"){const Ht=r.getLayerSourceCache(vt);this.renderLayer(this,Ht,vt,kt(vt,Ht))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let xt=0;Be&&(xt=Be.getShadowCastingLayerCount());let Zt=!1,Kt=-1;for(let vt=0;vt<L.length;++vt){const Ht=B[vt];Ht.isHidden(this.transform.zoom)||Ht.is3D(b)&&(Kt=vt)}F&&Kt===-1&&(N=!0);let ln=!1;for(;this.currentLayer<L.length;){const vt=B[this.currentLayer],Ht=r.getLayerSourceCache(vt);if(vt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(vt)){if(vt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!ln&&vt.is3D(b)&&!b){const mt=this.currentLayer,Gt=Bt=>{for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const Xt=B[this.currentLayer];if(Oh[Xt.type]){const Rt=this.style.getLayerSourceCache(Xt);Oh[Xt.type](this,Rt,Xt,kt(Xt,Rt),Bt)}}};Gt("initialize"),Gt("reset"),this.currentLayer=mt,ln=!0}if(N&&!Zt&&this.terrain&&!this.transform.isOrthographic&&(Zt=!0,this.blitDepth()),F&&Kt!==-1&&this.currentLayer===Kt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(vt,Ht,Ht?oe[Ht.id]:void 0),this.renderLayer(this,Ht,vt,kt(vt,Ht)),!this.terrain&&Be&&xt>0&&vt.hasShadowPass()&&--xt==0&&(Be.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const mt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=mt;this.currentLayer++){const Gt=B[this.currentLayer];if(!Gt.hasLightBeamPass())continue;const Bt=r.getLayerSourceCache(Gt);this.renderLayer(this,Bt,Gt,Bt?fe[Bt.id]:void 0)}this.currentLayer=mt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const mt=this.currentLayer;this.depthOcclusion=!0;for(const Gt of this.layersWithOcclusionOpacity){this.currentLayer=Gt;const Bt=B[this.currentLayer],Xt=r.getLayerSourceCache(Bt),Rt=Xt?fe[Xt.id]:void 0;this.terrain||this._renderTileClippingMasks(Bt,Xt,Xt?oe[Xt.id]:void 0),this.renderLayer(this,Xt,Bt,Rt)}this.depthOcclusion=!1,this.currentLayer=mt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let vt=null;B.forEach(Ht=>{const mt=r.getLayerSourceCache(Ht);mt&&!Ht.isHidden(this.transform.zoom)&&mt.getVisibleCoordinates().length&&(!vt||vt.getSource().maxzoom<mt.getSource().maxzoom)&&(vt=mt)}),vt&&this.options.showTileBoundaries&&Fd.debug(this,vt,vt.getVisibleCoordinates(),i.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Fd.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(vt){const Ht=vt.transform.padding;Rd(vt,vt.transform.height-(Ht.top||0),3,Al),Rd(vt,Ht.bottom||0,3,Mh),Ih(vt,Ht.left||0,3,wg),Ih(vt,vt.transform.width-(Ht.right||0),3,Ld);const mt=vt.transform.centerPoint;(function(Gt,Bt,Xt,Rt){Cl(Gt,Bt-1,Xt-10,2,20,Rt),Cl(Gt,Bt-10,Xt-1,20,2,Rt)})(vt,mt.x,vt.transform.height-mt.y,kd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),ee||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:l}=this.transform.projection,p=!l||!l.includes(r.type);if(Nh[r.type]&&(p||this.terrain&&r.type==="custom")){const y=this.style.getLayerSourceCache(r);Nh[r.type](r,y,this)}this.gpuTimingEnd()}renderLayer(r,l,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)&&(!r.terrain||p.type!=="custom")||p.type==="clip"||Fd[p.type](r,l,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,p=this.context.gl;let y=this.gpuTimers[r.id];y||(y=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(l.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=this.context.gl,p=l.createQuery();this.deferredRenderGpuTimeQueries.push(p),l.beginQuery(r.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const p in r){const y=r[p],b=this.context.extTimerQuery,S=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),l[p]=S}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let p=0;for(const y of r)p+=l.getQueryParameter(y,l.QUERY_RESULT)/1e6,l.deleteQuery(y);return p}translatePosMatrix(r,l,p,y,b){if(!p[0]&&!p[1])return r;const S=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(S){const F=Math.sin(S),B=Math.cos(S);p=[p[0]*B-p[1]*F,p[0]*F+p[1]*B]}const L=[b?p[0]:i.at(l,p[0],this.transform.zoom),b?p[1]:i.at(l,p[1],this.transform.zoom),0],N=new Float32Array(16);return i.ad.mat4.translate(N,r,L),N}saveTileTexture(r){const l=r.size[0],p=this._tileTextures[l];p?p.push(r):this._tileTextures[l]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,l,p){const y=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||l!==void 0&&!l||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(r,l){this.cache=this.cache||{};const p=l&&l.defines||[],y=l&&l.config,b=this.currentGlobalDefines(r,l&&l.overrideFog,l&&l.overrideRtt).concat(p),S=bg.cacheKey(rc[r],r,b,y);return this.cache[S]||(this.cache[S]=new bg(this.context,r,rc[r],y,ki[r],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,l){if(this.style.enable3dLights()){const p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){const b=((S,L,N)=>{const F=S.properties.get("direction"),B=S.properties.get("color-use-theme")==="none",H=S.properties.get("color").toRenderColor(B?null:N.getLut(S.scope)).toArray01(),W=S.properties.get("intensity"),ee=L.properties.get("color-use-theme")==="none",ce=L.properties.get("color").toRenderColor(ee?null:N.getLut(L.scope)).toArray01(),oe=L.properties.get("intensity"),fe=[F.x,F.y,F.z],pe=i.cN(ce,oe),Te=i.cN(H,W);return{u_lighting_ambient_color:pe,u_lighting_directional_dir:fe,u_lighting_directional_color:Te,u_ground_radiance:xg(fe,Te,pe)}})(p,y,this.style);l.setLightsUniformValues(r,b)}}}uploadCommonUniforms(r,l,p,y,b){if(this.uploadCommonLightUniforms(r,l),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const L=S.getOpacity(this.transform.pitch),N=((F,B,H,W,ee,ce,oe,fe,pe,Te,De,Ie)=>{const Ge=F.transform,Be=B.properties.get("color-use-theme")==="none",je=B.properties.get("color").toRenderColor(Be?null:F.style.getLut(B.scope)).toArray01();je[3]=W;const Ue=F.frameCounter/1e3%1,[Ke,nt]=B.properties.get("vertical-range");return{u_fog_matrix:H?Ge.calculateFogTileMatrix(H):Ie||F.identityMat,u_fog_range:B.getFovAdjustedRange(Ge._fov),u_fog_color:je,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ke,nt),nt],u_fog_temporal_offset:Ue,u_frustum_tl:ee,u_frustum_tr:ce,u_frustum_br:oe,u_frustum_bl:fe,u_globe_pos:pe,u_globe_radius:Te,u_viewport:De,u_globe_transition:i.ag(Ge.zoom),u_is_globe:+(Ge.projection.name==="globe")}})(this,S,p,L,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],y);l.setFogUniformValues(r,N)}b&&l.setCutoffUniformValues(r,b.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)l[y.key]=r[y.key]||new Ta(y,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,l){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[r.key];return l||(this._cachedTileFogOpacities[r.key]=l=this.style.fog.getOpacityForTile(r)),l[0]>=pn||l[1]>=pn}setupDepthForOcclusion(r,l,p){const y=this.context,b=y.gl,S=!!p;var L;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((L=this.depthRangeFor3D)[1]-L[0]),-1-2*L[0]/(L[1]-L[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),S||l.setTerrainUniformValues(y,p)}}function Tg(m,r){let l=!1,p=null;const y=()=>{p=null,l&&(m(),p=setTimeout(y,r),l=!1)};return()=>(l=!0,p||y(),p)}class x0{constructor(r){this._hashName=r&&encodeURIComponent(r),i.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Tg(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=b0(r);if(this._hashName){const p=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(S=>{const L=S.split("=")[0];return L===p?(y=!0,`${L}=${l}`):S}).filter(S=>S);return y||b.push(`${p}=${l}`),`#${b.join("&")}`}return`#${l}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function b0(m,r){const l=m.getCenter(),p=Math.round(100*m.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),S=Math.round(l.lng*b)/b,L=Math.round(l.lat*b)/b,N=m.getBearing(),F=m.getPitch();let B=r?`/${S}/${L}/${p}`:`${p}/${L}/${S}`;return(N||F)&&(B+="/"+Math.round(10*N)/10),F&&(B+=`/${Math.round(F)}`),B}const um={linearity:.3,easing:i.dB(0,0,.3,1)},jv=i.l({deceleration:2500,maxSpeed:1400},um),Uv=i.l({deceleration:20,maxSpeed:1400},um),Vv=i.l({deceleration:1e3,maxSpeed:360},um),qv=i.l({deceleration:1e3,maxSpeed:90},um);class $v{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=i.q.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)l.zoom+=b.zoomDelta||0,l.bearing+=b.bearingDelta||0,l.pitch+=b.pitchDelta||0,b.panDelta&&l.pan._add(b.panDelta),b.around&&(l.around=b.around),b.pinchAround&&(l.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){const b=dm(l.pan.mag(),p,i.l({},jv,r||{}));y.offset=l.pan.mult(b.amount/l.pan.mag()),y.center=this._map.transform.center,hm(y,b)}if(l.zoom){const b=dm(l.zoom,p,Uv);y.zoom=this._map.transform.zoom+b.amount,hm(y,b)}if(l.bearing){const b=dm(l.bearing,p,Vv);y.bearing=this._map.transform.bearing+i.ay(b.amount,-179,179),hm(y,b)}if(l.pitch){const b=dm(l.pitch,p,qv);y.pitch=this._map.transform.pitch+b.amount,hm(y,b)}if(y.zoom||y.bearing){const b=l.pinchAround===void 0?l.around:l.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function hm(m,r){(!m.duration||m.duration<r.duration)&&(m.duration=r.duration,m.easing=r.easing)}function dm(m,r,l){const{maxSpeed:p,linearity:y,deceleration:b}=l,S=i.ay(m*y/(r/1e3),-p,p),L=Math.abs(S)/(b*y);return{easing:l.easing,duration:1e3*L,amount:S*(L/2)}}class Ya extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,y={}){const b=Me(l.getCanvasContainer(),p),S=l.unproject(b);super(r,i.l({point:b,lngLat:S,originalEvent:p},y)),this._defaultPrevented=!1,this.target=l}}class fm extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const y=r==="touchend"?p.changedTouches:p.touches,b=it(l.getCanvasContainer(),y),S=b.map(N=>l.unproject(N)),L=b.reduce((N,F,B,H)=>N.add(F.div(H.length)),new i.P(0,0));super(r,{points:b,point:L,lngLats:S,lngLat:l.unproject(L),originalEvent:p}),this._defaultPrevented=!1}}class Gv extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class Hv{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Gv(this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Ya(r.type,this._map,r))}mouseup(r){this._map.fire(new Ya(r.type,this._map,r))}preclick(r){const l=i.l({},r);l.type="preclick",this._map.fire(new Ya(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Ya(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Ya(r.type,this._map,r))}mouseover(r){this._map.fire(new Ya(r.type,this._map,r))}mouseout(r){this._map.fire(new Ya(r.type,this._map,r))}touchstart(r){return this._firePreventable(new fm(r.type,this._map,r))}touchmove(r){this._map.fire(new fm(r.type,this._map,r))}touchend(r){this._map.fire(new fm(r.type,this._map,r))}touchcancel(r){this._map.fire(new fm(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kw{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Ya(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ya("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Ya(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rw{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(ye(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const S=Math.min(y.x,p.x),L=Math.max(y.x,p.x),N=Math.min(y.y,p.y),F=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${N}px)`,this._box.style.width=L-S+"px",this._box.style.height=F-N+"px")})}mouseupWindow(r,l){if(!this._active)return;const p=this._startPos,y=l;if(p&&r.button===0){if(this.reset(),xe(),p.x!==y.x||p.y!==y.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:r})),{cameraAnimation:b=>b.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ne(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new i.A(r,{originalEvent:l}))}}function qi(m,r){const l={};for(let p=0;p<m.length;p++)l[m[p].identifier]=r[p];return l}class Wv{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const b=new i.P(0,0);for(const S of y)b._add(S);return b.div(y.length)}(l),this.touches=qi(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const y=qi(p,l);for(const b in this.touches){const S=y[b];(!S||S.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class w0{constructor(r){this.singleTap=new Wv(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const y=this.singleTap.touchend(r,l,p);if(y){const b=r.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(b&&S||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Dw{constructor(){this._zoomIn=new w0({numTouches:1,numTaps:2}),this._zoomOut=new w0({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const y=this._zoomIn.touchend(r,l,p),b=this._zoomOut.touchend(r,l,p);return y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:r})}):b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const pm={0:1,2:2},S0={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class mm{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=ot(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(y,b){const S=pm[b];return y.buttons===void 0||(y.buttons&S)!==S}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(r){this._lastPoint&&ot(r)===this._eventButton&&(this._moved&&xe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ag extends mm{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class lu extends mm{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?S0[r.pitchRotateKey]:void 0}_correctButton(r,l){return this._pitchRotateKey?l===0&&r[this._pitchRotateKey]:l===0&&r.ctrlKey||l===2}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class gm extends mm{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?S0[r.pitchRotateKey]:void 0}_correctButton(r,l){return this._pitchRotateKey?l===0&&r[this._pitchRotateKey]:l===0&&r.ctrlKey||l===2}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class Ss{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),i.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!i.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const y=qi(p,l),b=new i.P(0,0),S=new i.P(0,0);let L=0;for(const F in y){const B=y[F],H=this._touches[F];H&&(b._add(B),S._add(B.sub(H)),L++,y[F]=B)}if(this._touches=y,L<this._minTouches||!S.mag())return;const N=S.div(L);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(L),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class sc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){const y=this._firstTwoTouches;if(!y)return;r.preventDefault();const[b,S]=y,L=If(p,l,b),N=If(p,l,S);if(!L||!N)return;const F=this._aroundCenter?null:L.add(N).div(2);return this._move([L,N],F,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,S=If(p,l,y),L=If(p,l,b);S&&L||(this._active&&xe(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function If(m,r,l){for(let p=0;p<m.length;p++)if(m[p].identifier===l)return r[p]}function _m(m,r){return Math.log(m/r)/Math.LN2}class Zv extends sc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(_m(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_m(this._distance,p),pinchAround:l}}}function Kv(m,r){return 180*m.angleWith(r)/Math.PI}class ym extends sc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Kv(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=Kv(r,p);return Math.abs(y)<l}}function T0(m){return Math.abs(m.y)>Math.abs(m.x)}class Nw extends sc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,T0(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const y=this._lastPoints;if(!y)return;const b=r[0].sub(y[0]),S=r[1].sub(y[1]);return this._map._cooperativeGestures&&!i.dC()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(this._valid!==void 0)return this._valid;const y=r.mag()>=2,b=l.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const S=r.y>0==l.y>0;return T0(r)&&T0(l)&&S}}const A0={panStep:100,bearingStep:15,pitchStep:10};class E0{constructor(){const r=A0;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,y=0,b=0,S=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),b=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),b=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),S=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:L=>{const N=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:vm,zoom:l?Math.round(N)+l*(r.shiftKey?2:1):N,bearing:L.getBearing()+p*this._bearingStep,pitch:L.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:L.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vm(m){return m*(2-m)}const Bd=4.000244140625,qu=1/450;class Rc{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=qu,i.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||i.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=i.q.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Bd==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Me(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const F=this._type==="wheel"&&Math.abs(this._delta)>Bd?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&B!==0&&(B=1/B);const H=l(),W=Math.pow(2,H),ee=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(ee*B))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),y=this._startZoom,b=this._easing;let S,L=!1;if(this._type==="wheel"&&y&&b){const F=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),B=b(F);S=i.ah(y,p,B),F<1?this._frameId||(this._frameId=!0):L=!0}else S=p,L=!0;this._active=!0,L&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let N=S-l();return N*this._lastDelta<0&&(N=0),{noInertia:!0,needsRenderFrame:!L,zoomDelta:N,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=i.dD;if(this._prevEase){const p=this._prevEase,y=(i.q.now()-p.start)/p.duration,b=p.easing(y+.01)-p.easing(y),S=.27/Math.sqrt(b*b+1e-4)*.01,L=Math.sqrt(.0729-S*S);l=i.dB(S,L,.25,1)}return this._prevEase={start:i.q.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class zh{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fh{constructor(){this._tap=new w0({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=l[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ow{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zw{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fw{constructor(r,l,p,y){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Eg=m=>m.zoom||m.drag||m.pitch||m.rotate;class Xv extends i.A{}class ya{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=i.ad.vec3.sub([],l,r);this.radius=i.ad.vec3.length(p[2]<0?i.ad.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){i.ad.vec3.div(r,r,this.constants),i.ad.vec3.normalize(r,r),i.ad.vec3.mul(r,r,this.constants);const l=i.ad.vec3.scale([],r,this.radius);if(l[2]>0){const p=i.ad.vec3.scale([],[0,0,1],i.ad.vec3.dot(l,[0,0,1])),y=i.ad.vec3.scale([],i.ad.vec3.normalize([],[l[0],l[1],0]),this.radius),b=i.ad.vec3.add([],l,i.ad.vec3.scale([],i.ad.vec3.sub([],i.ad.vec3.add([],y,p),l),2));l[0]=b[0],l[1]=b[1]}return l}}function Lf(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Yv{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $v(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ya,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),i.aQ(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,S]of this._listeners){const L=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,L,S)}}destroy(){for(const[r,l,p]of this._listeners){const y=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(l,y,p)}}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new Hv(l,r));const y=l.boxZoom=new Rw(l,r);this._add("boxZoom",y);const b=new Dw,S=new jd;l.doubleClickZoom=new zh(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const L=new Fh;this._add("tapDragZoom",L);const N=l.touchPitch=new Nw(l);this._add("touchPitch",N);const F=new lu(r),B=new gm(r);l.dragRotate=new zw(r,F,B),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const H=new Ag(r),W=new Ss(l,r);l.dragPan=new Ow(p,H,W),this._add("mousePan",H),this._add("touchPan",W,["touchZoom","touchRotate"]);const ee=new ym,ce=new Zv;l.touchZoomRotate=new Fw(p,ce,ee,L),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),this._add("blockableMapEvent",new kw(l));const oe=l.scrollZoom=new Rc(l,this);this._add("scrollZoom",oe,["mousePan"]);const fe=l.keyboard=new E0;this._add("keyboard",fe);for(const pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[pe]&&l[pe].enable(r[pe])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Eg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,p){for(const y in r)if(y!==p&&(!l||l.indexOf(y)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p=r.type==="renderFrame",y=p?void 0:r,b={needsRenderFrame:!1},S={},L={},N=r.touches?this._getMapTouches(r.touches):void 0,F=N?it(this._el,N):p?void 0:Me(this._el,r);for(const{handlerName:W,handler:ee,allowed:ce}of this._handlers){if(!ee.isEnabled())continue;let oe;this._blockedByActive(L,ce,W)?ee.reset():ee[l||r.type]&&(oe=ee[l||r.type](r,F,N),this.mergeHandlerResult(b,S,oe,W,y),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||ee.isActive())&&(L[W]=ee)}const B={};for(const W in this._previousActiveHandlers)L[W]||(B[W]=y);this._previousActiveHandlers=L,(Object.keys(B).length||Lf(b))&&(this._changes.push([b,S,B]),this._triggerRenderFrame()),(Object.keys(L).length||Lf(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=b;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(r,l,p,y,b){if(!p)return;i.l(r,p);const S={handlerName:y,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(l.zoom=S),p.panDelta!==void 0&&(l.drag=S),p.pitchDelta!==void 0&&(l.pitch=S),p.bearingDelta!==void 0&&(l.rotate=S)}_applyChanges(){const r={},l={},p={};for(const[y,b,S]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new i.P(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(r.around=y.around),y.aroundCoord!==void 0&&(r.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),i.l(l,b),i.l(p,S);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const y=this._map,b=y.transform,S=Te=>[Te.x,Te.y,Te.z];if((Te=>{const De=this._eventsInProgress.drag;return De&&!this._handlersById[De.handlerName].isActive()})()&&!Lf(r)){const Te=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Te!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!Lf(r))return void this._fireEvents(l,p,!0);let{panDelta:L,zoomDelta:N,bearingDelta:F,pitchDelta:B,around:H,aroundCoord:W,pinchAround:ee}=r;b._isCameraConstrained&&(N>0&&(N=0),b._isCameraConstrained=!1),ee!==void 0&&(H=ee),(N||(Te=>l[Te]&&!this._eventsInProgress[Te])("drag"))&&H&&(this._dragOrigin=S(b.pointCoordinate3D(H)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),H=H||y.transform.centerPoint,F&&(b.bearing+=F),B&&(b.pitch+=B),b._updateCameraState();const ce=[0,0,0];if(L)if(b.projection.name==="mercator"){const Te=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H).dir),De=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H.sub(L)).dir);ce[0]=De[0]-Te[0],ce[1]=De[1]-Te[1]}else{const Te=b.pointCoordinate(H);if(b.projection.name==="globe"){L=L.rotate(-b.angle);const De=b._pixelsPerMercatorPixel/b.worldSize;ce[0]=-L.x*i.dE(i.aT(Te.y))*De,ce[1]=-L.y*i.dE(b.center.lat)*De}else{const De=b.pointCoordinate(H.sub(L));Te&&De&&(ce[0]=De.x-Te.x,ce[1]=De.y-Te.y)}}const oe=b.zoom,fe=[0,0,0];if(N){const Te=S(W||b.pointCoordinate3D(H)),De={dir:i.ad.vec3.normalize([],i.ad.vec3.sub([],Te,b._camera.position))};if(De.dir[2]<0){const Ie=b.zoomDeltaToMovement(Te,N);i.ad.vec3.scale(fe,De.dir,Ie)}}const pe=i.ad.vec3.add(ce,ce,fe);b._translateCameraConstrained(pe),N&&Math.abs(b.zoom-oe)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const y=Eg(this._eventsInProgress),b=Eg(r),S={};for(const B in r){const{originalEvent:H}=r[B];this._eventsInProgress[B]||(S[`${B}start`]=H),this._eventsInProgress[B]=r[B]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const B in S)this._fireEvent(B,S[B]);b&&this._fireEvent("move",b.originalEvent);for(const B in r){const{originalEvent:H}=r[B];this._fireEvent(B,H)}const L={};let N;for(const B in this._eventsInProgress){const{handlerName:H,originalEvent:W}=this._eventsInProgress[B];this._handlersById[H].isActive()||(delete this._eventsInProgress[B],N=l[H]||W,L[`${B}end`]=N)}for(const B in L)this._fireEvent(B,L[B]);const F=Eg(this._eventsInProgress);if(p&&(y||b)&&!F){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;B?(H(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:N})):(this._map.fire(new i.A("moveend",{originalEvent:N})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new i.A(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Xv("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Jv="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class kf extends i.E{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,i.aQ(["_renderFrameCallback"],this)}getCenter(){return new i.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=i.P.convert(r).mult(-1),this.panTo(this.transform.center,i.l({offset:r},l),p)}panTo(r,l,p){return this.easeTo(i.l({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(i.l({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(i.l({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,i.l({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=i.aB.convert(r);const p=l&&l.bearing||0,y=l&&l.pitch||0,b=r.getNorthWest(),S=r.getSouthEast();return this._cameraForBounds(this.transform,b,S,p,y,l)}_extendPadding(r){const l={top:0,right:0,bottom:0,left:0};return r==null?i.l({},l,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:i.l({},l,r)}_extendCameraOptions(r){return(r=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,l){const p=l.max[0]-l.min[0],y=l.max[1]-l.min[1];return p/y>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):y/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,p,y,b,S){const L=r.clone(),N=this._extendCameraOptions(S);L.bearing=y,L.pitch=b;const F=i.bO.convert(l),B=i.bO.convert(p),H=.5*(F.lat+B.lat),W=.5*(F.lng+B.lng),ee=i.dF(H,W),ce=i.ad.vec3.normalize([],ee),oe=i.ad.vec3.normalize([],i.ad.vec3.cross([],ce,[0,1,0])),fe=i.ad.vec3.cross([],oe,ce),pe=[oe[0],oe[1],oe[2],0,fe[0],fe[1],fe[2],0,ce[0],ce[1],ce[2],0,0,0,0,1],Te=[ee,i.dF(F.lat,F.lng),i.dF(B.lat,F.lng),i.dF(B.lat,B.lng),i.dF(F.lat,B.lng),i.dF(H,F.lng),i.dF(H,B.lng),i.dF(F.lat,W),i.dF(B.lat,W)];let De=i.ce.fromPoints(Te.map(Bt=>[i.ad.vec3.dot(oe,Bt),i.ad.vec3.dot(fe,Bt),i.ad.vec3.dot(ce,Bt)]));const Ie=i.ad.vec3.transformMat4([],De.center,pe);i.ad.vec3.squaredLength(Ie)===0&&i.ad.vec3.set(Ie,0,0,1),i.ad.vec3.normalize(Ie,Ie),i.ad.vec3.scale(Ie,Ie,i.az),L.center=i.dG(Ie);const Ge=L.getWorldToCameraMatrix(),Be=i.ad.mat4.invert(new Float64Array(16),Ge);De=i.ce.applyTransform(De,i.ad.mat4.multiply([],Ge,pe));const je=this._extendAABB(De,L,N,y);if(!je)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");De=je,i.ad.vec3.transformMat4(Ie,Ie,Ge);const Ue=.5*(De.max[2]-De.min[2]),Ke=this._minimumAABBFrustumDistance(L,De),nt=i.ad.vec3.scale([],[0,0,1],Ue),kt=i.ad.vec3.add(nt,Ie,nt),xt=Ke+(L.pitch===0?0:i.ad.vec3.distance(Ie,kt)),Zt=L.globeCenterInViewSpace,Kt=i.ad.vec3.sub([],Ie,[Zt[0],Zt[1],Zt[2]]);i.ad.vec3.normalize(Kt,Kt),i.ad.vec3.scale(Kt,Kt,xt);const ln=i.ad.vec3.add([],Ie,Kt);i.ad.vec3.transformMat4(ln,ln,Be);const vt=i.dv/i.az,Ht=i.ad.vec3.length(ln),mt=i.bH(Math.max(Ht*vt-i.dv,Number.EPSILON),0),Gt=Math.min(L.zoomFromMercatorZAdjusted(mt),N.maxZoom);return Gt>.5*(i.c6+i.bY)?(L.setProjection({name:"mercator"}),L.zoom=Gt,this._cameraForBounds(L,l,p,y,b,S)):{center:L.center,zoom:Gt,bearing:y,pitch:b}}_extendAABB(r,l,p,y){const b=.5*((p.padding.left||0)+(p.padding.right||0)),S=.5*((p.padding.top||0)+(p.padding.bottom||0)),L=S,N=b,F=b,B=S,H=l.width-(N+F),W=l.height-(L+B),ee=i.ad.vec3.sub([],r.max,r.min),ce=Math.min(H/ee[0],W/ee[1]),oe=Math.min(l.scaleZoom(l.scale*ce),p.maxZoom);if(isNaN(oe))return null;const fe=l.scale/l.zoomScale(oe),pe=new i.ce([r.min[0]-N*fe,r.min[1]-B*fe,r.min[2]],[r.max[0]+F*fe,r.max[1]+L*fe,r.max[2]]),Te=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new i.P(p.offset.x,p.offset.y):i.P.convert(p.offset)).rotate(-i.ak(y));return pe.center[0]-=Te.x*fe,pe.center[1]+=Te.y*fe,pe}queryTerrainElevation(r,l){const p=this.transform.elevation;return p?(l=i.l({},{exaggerated:!0},l),p.getAtPoint(i.ac.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,p,y,b,S){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,p,y,b,S);const L=r.clone(),N=this._extendCameraOptions(S);L.bearing=y,L.pitch=b;const F=i.bO.convert(l),B=i.bO.convert(p),H=new i.bO(F.lng,B.lat),W=new i.bO(B.lng,F.lat),ee=L.project(F),ce=L.project(B),oe=this.queryTerrainElevation(F),fe=this.queryTerrainElevation(B),pe=this.queryTerrainElevation(H),Te=this.queryTerrainElevation(W),De=[[ee.x,ee.y,Math.min(oe||0,fe||0,pe||0,Te||0)],[ce.x,ce.y,Math.max(oe||0,fe||0,pe||0,Te||0)]];let Ie=i.ce.fromPoints(De);const Ge=L.getWorldToCameraMatrix(),Be=i.ad.mat4.invert(new Float64Array(16),Ge);Ie=i.ce.applyTransform(Ie,Ge);const je=this._extendAABB(Ie,L,N,y);if(!je)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ie=je;const Ue=.5*i.ad.vec3.sub([],Ie.max,Ie.min)[2],Ke=this._minimumAABBFrustumDistance(L,Ie),nt=[0,0,1,0];i.ad.vec4.transformMat4(nt,nt,Ge),i.ad.vec4.normalize(nt,nt);const kt=i.ad.vec3.scale([],nt,Ke+Ue),xt=i.ad.vec3.add([],Ie.center,kt);i.ad.vec3.transformMat4(Ie.center,Ie.center,Be),i.ad.vec3.transformMat4(xt,xt,Be);const Zt=L.unproject(new i.P(Ie.center[0],Ie.center[1])),Kt=i.dH(L.projection,Zt),ln=Math.pow(2,Kt),vt=Math.min(L._zoomFromMercatorZ(xt[2]*L.pixelsPerMeter*ln/L.worldSize),N.maxZoom);return L.mercatorFromTransition&&vt<.5*(i.c6+i.bY)?(L.setProjection({name:"globe"}),L.zoom=vt,this._cameraForBounds(L,l,p,y,b,S)):{center:Zt,zoom:vt,bearing:y,pitch:b}}fitBounds(r,l,p){const y=this.cameraForBounds(r,l);return this._fitInternal(y,l,p)}fitScreenCoordinates(r,l,p,y,b){const S=i.P.convert(r),L=i.P.convert(l),N=new i.P(Math.min(S.x,L.x),Math.min(S.y,L.y)),F=new i.P(Math.max(S.x,L.x),Math.max(S.y,L.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,L))return this;const B=this.transform.pointLocation3D(N),H=this.transform.pointLocation3D(F),W=this.transform.pointLocation3D(new i.P(N.x,F.y)),ee=this.transform.pointLocation3D(new i.P(F.x,N.y)),ce=[Math.min(B.lng,H.lng,W.lng,ee.lng),Math.min(B.lat,H.lat,W.lat,ee.lat)],oe=[Math.max(B.lng,H.lng,W.lng,ee.lng),Math.max(B.lat,H.lat,W.lat,ee.lat)],fe=y&&y.pitch?y.pitch:this.getPitch(),pe=this._cameraForBounds(this.transform,ce,oe,p,fe,y);return this._fitInternal(pe,y,b)}_fitInternal(r,l,p){return r?(l=i.l(r,l)).linear?this.easeTo(l,p):this.flyTo(l,p):this}jumpTo(r,l){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,S=!1;"zoom"in r&&p.zoom!==+r.zoom&&(y=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=i.bO.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(b=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(S=!0,p.pitch=+r.pitch);const L=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!p.isPaddingEqual(L))if(r.retainPadding===!1){const N=p.clone();N.padding=L,p.setLocationAtPoint(p.center,N.centerPoint)}else p.padding=L;return r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new i.A("movestart",l)).fire(new i.A("move",l)),y&&this.fire(new i.A("zoomstart",l)).fire(new i.A("zoom",l)).fire(new i.A("zoomend",l)),b&&this.fire(new i.A("rotatestart",l)).fire(new i.A("rotate",l)).fire(new i.A("rotateend",l)),S&&this.fire(new i.A("pitchstart",l)).fire(new i.A("pitch",l)).fire(new i.A("pitchend",l)),this.fire(new i.A("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Jv),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return i.w(Jv),this;this.stop();const y=p.zoom,b=p.pitch,S=p.bearing;p.setFreeCameraOptions(r);const L=y!==p.zoom,N=b!==p.pitch,F=S!==p.bearing;return this.fire(new i.A("movestart",l)).fire(new i.A("move",l)),L&&this.fire(new i.A("zoomstart",l)).fire(new i.A("zoom",l)).fire(new i.A("zoomend",l)),F&&this.fire(new i.A("rotatestart",l)).fire(new i.A("rotate",l)).fire(new i.A("rotateend",l)),N&&this.fire(new i.A("pitchstart",l)).fire(new i.A("pitch",l)).fire(new i.A("pitchend",l)),this.fire(new i.A("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=i.l({offset:[0,0],duration:500,easing:i.dD},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const p=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),L=this.getPadding(),N="zoom"in r?+r.zoom:y,F="bearing"in r?this._normalizeBearing(r.bearing,b):b,B="pitch"in r?+r.pitch:S,H=this._extendPadding(r.padding),W=i.P.convert(r.offset);let ee,ce,oe;if(p.projection.name==="globe"){const nt=i.ac.fromLngLat(p.center),kt=W.rotate(-p.angle);nt.x+=kt.x/p.worldSize,nt.y+=kt.y/p.worldSize;const xt=nt.toLngLat(),Zt=i.bO.convert(r.center||xt);this._normalizeCenter(Zt),ee=p.centerPoint.add(kt),ce=new i.P(nt.x,nt.y).mult(p.worldSize),oe=new i.P(i.av(Zt.lng),i.aC(Zt.lat)).mult(p.worldSize).sub(ce)}else{ee=p.centerPoint.add(W);const nt=p.pointLocation(ee),kt=i.bO.convert(r.center||nt);this._normalizeCenter(kt),ce=p.project(nt),oe=p.project(kt).sub(ce)}const fe=p.zoomScale(N-y);let pe,Te;r.around&&(pe=i.bO.convert(r.around),Te=p.locationPoint(pe));const De=this._zooming||N!==y,Ie=this._rotating||b!==F,Ge=this._pitching||B!==S,Be=!p.isPaddingEqual(H),je=r.retainPadding===!1?p.clone():p,Ue=nt=>kt=>{if(De&&(nt.zoom=i.ah(y,N,kt)),Ie&&(nt.bearing=i.ah(b,F,kt)),Ge&&(nt.pitch=i.ah(S,B,kt)),Be&&(je.interpolatePadding(L,H,kt),ee=je.centerPoint.add(W)),pe)nt.setLocationAtPoint(pe,Te);else{const xt=nt.zoomScale(nt.zoom-y),Zt=N>y?Math.min(2,fe):Math.max(.5,fe),Kt=Math.pow(Zt,1-kt),ln=nt.unproject(ce.add(oe.mult(kt*Kt)).mult(xt));nt.setLocationAtPoint(nt.renderWorldCopies?ln.wrap():ln,ee)}return r.preloadOnly||this._fireMoveEvents(l),nt};if(r.preloadOnly){const nt=this._emulate(Ue,r.duration,p);return this._preloadTiles(nt),this}const Ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=De,this._rotating=Ie,this._pitching=Ge,this._padding=Be,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Ke),this._ease(Ue(p),nt=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(l,nt)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||p.moving||this.fire(new i.A("movestart",r)),this._zooming&&!p.zooming&&this.fire(new i.A("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new i.A("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new i.A("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.A("move",r)),this._zooming&&this.fire(new i.A("zoom",r)),this._rotating&&this.fire(new i.A("rotate",r)),this._pitching&&this.fire(new i.A("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new i.A("zoomend",r)),y&&this.fire(new i.A("rotateend",r)),b&&this.fire(new i.A("pitchend",r)),this.fire(new i.A("moveend",r))}flyTo(r,l){if(this._prefersReducedMotion(r)){const Bt=i.aA(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Bt,l)}this.stop(),r=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dD},r);const p=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),L=this.getPadding(),N="zoom"in r?i.ay(+r.zoom,p.minZoom,p.maxZoom):y,F="bearing"in r?this._normalizeBearing(r.bearing,b):b,B="pitch"in r?+r.pitch:S,H=this._extendPadding(r.padding),W=p.zoomScale(N-y),ee=i.P.convert(r.offset);let ce=p.centerPoint.add(ee);const oe=p.pointLocation(ce),fe=i.bO.convert(r.center||oe);this._normalizeCenter(fe);const pe=p.project(oe),Te=p.project(fe).sub(pe);let De=r.curve;const Ie=Math.max(p.width,p.height),Ge=Ie/W,Be=Te.mag();if("minZoom"in r){const Bt=i.ay(Math.min(r.minZoom,y,N),p.minZoom,p.maxZoom),Xt=Ie/p.zoomScale(Bt-y);De=Math.sqrt(Xt/Be*2)}const je=De*De;function Ue(Bt){const Xt=(Ge*Ge-Ie*Ie+(Bt?-1:1)*je*je*Be*Be)/(2*(Bt?Ge:Ie)*je*Be);return Math.log(Math.sqrt(Xt*Xt+1)-Xt)}function Ke(Bt){return(Math.exp(Bt)-Math.exp(-Bt))/2}function nt(Bt){return(Math.exp(Bt)+Math.exp(-Bt))/2}const kt=Ue(0);let xt=function(Bt){return nt(kt)/nt(kt+De*Bt)},Zt=function(Bt){return Ie*((nt(kt)*(Ke(Xt=kt+De*Bt)/nt(Xt))-Ke(kt))/je)/Be;var Xt},Kt=(Ue(1)-kt)/De;if(Math.abs(Be)<1e-6||!isFinite(Kt)){if(Math.abs(Ie-Ge)<1e-6)return this.easeTo(r,l);const Bt=Ge<Ie?-1:1;Kt=Math.abs(Math.log(Ge/Ie))/De,Zt=function(){return 0},xt=function(Xt){return Math.exp(Bt*De*Xt)}}r.duration="duration"in r?+r.duration:1e3*Kt/("screenSpeed"in r?+r.screenSpeed/De:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const ln=b!==F,vt=B!==S,Ht=!p.isPaddingEqual(H),mt=r.retainPadding===!1?p.clone():p,Gt=Bt=>Xt=>{const Rt=Xt*Kt,Qt=1/xt(Rt);Bt.zoom=Xt===1?N:y+Bt.scaleZoom(Qt),ln&&(Bt.bearing=i.ah(b,F,Xt)),vt&&(Bt.pitch=i.ah(S,B,Xt)),Ht&&(mt.interpolatePadding(L,H,Xt),ce=mt.centerPoint.add(ee));const gn=Xt===1?fe:Bt.unproject(pe.add(Te.mult(Zt(Rt))).mult(Qt));return Bt.setLocationAtPoint(Bt.renderWorldCopies?gn.wrap():gn,ce),Bt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),Bt};if(r.preloadOnly){const Bt=this._emulate(Gt,r.duration,p);return this._preloadTiles(Bt),this}return this._zooming=!0,this._rotating=ln,this._pitching=vt,this._padding=Ht,this._prepareEase(l,!1),this._ease(Gt(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){p.animate===!1||p.duration===0?(r(1),l()):(this._easeStart=i.q.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=i.bF(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,l,p){const y=Math.ceil(15*l/1e3),b=[],S=r(p.clone());for(let L=0;L<=y;L++){const N=S(L/y);b.push(N.clone())}return b}_preloadTiles(r,l){}}class Cg{constructor(r={}){this.options=r,i.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact,p=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const y=Q("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=Q("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(r){const p=l.reduce((y,b,S)=>(b.value&&(y+=`${b.key}=${b.value}${S<l.length-1?"&":""}`),y),"?");r.href=`${i.e.FEEDBACK_URL}/${p}#${b0(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const l=this._map.style._mergedSourceCaches;for(const y in l){const b=l[y];if(b.used){const S=b.getSource();S.attribution&&r.indexOf(S.attribution)<0&&r.push(S.attribution)}}r.sort((y,b)=>y.length-b.length),r=r.filter((y,b)=>{for(let S=b+1;S<r.length;S++)if(r[S].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class kl{constructor(){i.aQ(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Q("div","mapboxgl-ctrl");const l=Q("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Rl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const y of p)if(y.id===r)return void(y.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Rf{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=i.cC((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const Ud={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Vd extends i.A{constructor(r,l,p,y){const{point:b,lngLat:S,originalEvent:L,target:N}=r;super(r.type,{point:b,lngLat:S,originalEvent:L,target:N}),this.preventDefault=()=>{r.preventDefault()},this.id=l,this.interaction=p,this.feature=y}}class C0{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,l){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const p=l.filter;let y=l.type;p&&this.filters.set(r,i.a_(p)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,l)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(r,l),this.typeById.set(r,y)}get(r){const l=this.typeById.get(r);if(!l)return;const p=this.interactionsByType.get(l);return p?p.get(r):void 0}remove(r){const l=this.typeById.get(r);if(!l)return;this.typeById.delete(r),this.filters.delete(r);const p=this.interactionsByType.get(l);p&&(p.delete(r),l==="mouseenter"||l==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(l,this.handleType))}queryTargets(r,l){const p=[];for(const[y,b]of l)b.target&&p.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(r,p,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const l=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());l.length&&(r.type="mouseenter",this.handleType(r,l));const p=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||p.set(b.id,b);p.size&&(r.type="mouseleave",this.handleType(r,Array.from(p.values())))}handleOut(r){const l=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);l.length&&(r.type="mouseleave",this.handleType(r,l)),this.hoveredFeatures.clear()}handleType(r,l){const p=Array.from(this.interactionsByType.get(r.type)).reverse(),y=!!l;l=l||this.queryTargets(r.point,p);const b=r.type==="mouseenter";let S=!1;const L=new Set;for(const N of l){for(const[F,B]of p){if(!B.target)continue;const H=N.variants?N.variants[F]:null;if(H){for(const W of H){if(Gl(W,N,L,F))continue;const ee=new i.cx(N,W),ce=Xc(W,N,F);y&&(ee.state=this.map.getFeatureState(ee));const oe=b?this.prevHoveredFeatures.get(ce):null,fe=new Vd(r,F,B,ee),pe=oe?oe.stop:B.handler(fe);if(b&&this.hoveredFeatures.set(ce,{feature:N,stop:pe}),pe!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[N,F]of p){const{handler:B,target:H}=F;if(!H&&B(new Vd(r,N,F,null))!==!1)break}}}function ni(m,r){if(Array.isArray(m)&&Array.isArray(r)){const l=new Set(m),p=new Set(r);return l.size===p.size&&m.every(y=>p.has(y))}return i.bn(m,r)}const Bh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Bw={showCompass:!0,showZoom:!0,visualizePitch:!1};class jw{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new lu({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new gm({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),ye()}move(r,l){const p=this.map,y=this.mouseRotate.mousemoveWindow(r,l),b=y&&y.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(r,l),L=S&&S.pitchDelta;L&&p.setPitch(p.getPitch()+L)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(i.l({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Me(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Me(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=it(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=it(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Pg(m,r,l){if(m=new i.bO(m.lng,m.lat),r){const p=new i.bO(m.lng-360,m.lat),y=new i.bO(m.lng+360,m.lat),b=360*Math.ceil(Math.abs(m.lng-l.center.lng)/360),S=l.locationPoint3D(m).distSqr(r),L=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint3D(p).distSqr(r)<S&&(L||Math.abs(p.lng-l.center.lng)<b)?m=p:l.locationPoint3D(y).distSqr(r)<S&&(L||Math.abs(y.lng-l.center.lng)<b)&&(m=y)}for(;Math.abs(m.lng-l.center.lng)>180;){const p=l.locationPoint3D(m);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;m.lng>l.center.lng?m.lng-=360:m.lng+=360}return m}const cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ja={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Vo extends i.E{constructor(r,l){super(),(r instanceof HTMLElement||l)&&(r=i.l({element:r},l)),i.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),r=i.l({},Ja,r),this._anchor=r.anchor,this._color=r.color,this._scale=r.scale,this._draggable=r.draggable,this._clickTolerance=r.clickTolerance,this._rotation=r.rotation,this._rotationAlignment=r.rotationAlignment,this._pitchAlignment=r.pitchAlignment,this._occludedOpacity=r.occludedOpacity,this._altitude=r.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=i.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const p=this._element.classList;for(const b in cu)p.remove(`mapboxgl-marker-anchor-${b}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const y=r&&r.className?r.className.trim().split(/\s+/):[];p.add(...y),this._popup=null}_createDefaultMarker(){const r=Q("div"),l=se("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const p=se("radialGradient",{id:"shadowGradient"},se("defs",{},l));se("stop",{offset:"10%","stop-opacity":.4},p),se("stop",{offset:"100%","stop-opacity":.05},p),se("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},l)}return se("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},l),se("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},l),se("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},l),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.bO.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||Ja.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const p=r.unproject(l,this._altitude),y=r.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(l,this._altitude);let y;r._showingGlobe()&&i.dK(r.transform,this._lngLat)?y=0:(y=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${cu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||p!=="map")return"";if(!l._showingGlobe()){const N=l.getPitch();return N?`rotateX(${N}deg)`:""}const y=i.c4(i.dL(l.transform,this._lngLat)),b=r.sub(i.dM(l.transform)),S=Math.abs(b.x)+Math.abs(b.y);if(S===0)return"";const L=y/S;return`rotateX(${-b.y*L}deg) rotateY(${b.x*L}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let p=0;const y=this.getRotationAlignment();if(y==="map")if(l._showingGlobe()){const b=l.project(new i.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=l.project(new i.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=i.c4(Math.atan2(S.y,S.x))-90}else p=-l.getBearing();else if(y==="horizon"){const b=i.ae(4,6,l.getZoom()),S=i.dM(l.transform);S.y+=b*l.transform.height;const L=r.sub(S),N=i.c4(Math.atan2(L.y,L.x));p=(N>90?N-270:N+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Pg(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=i.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const l=this._map;if(!l)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const b=this._clickTolerance||l._clickTolerance;if(r.point.dist(p)<b)return;this._isDragging=!0}this._pos=r.point.sub(y),this._lngLat=l.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,p=this._pos;l&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||Ja.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||Ja.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||Ja.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||Ja.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Qa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Po={maxWidth:100,unit:"metric"},P0={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ps={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Qv=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jh(m=new i.P(0,0),r="bottom"){if(typeof m=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(r){case"top":return new i.P(0,m);case"top-left":return new i.P(l,l);case"top-right":return new i.P(-l,l);case"bottom":return new i.P(0,-m);case"bottom-left":return new i.P(l,-l);case"bottom-right":return new i.P(-l,-l);case"left":return new i.P(m,0);case"right":return new i.P(-m,0)}return new i.P(0,0)}return m instanceof i.P||Array.isArray(m)?i.P.convert(m):i.P.convert(m[r]||[0,0])}return{version:E,supported:ie.supported,setRTLTextPlugin:i.dN,getRTLTextPluginStatus:i.dO,Map:class extends kf{constructor(m){O.mark(k.create);const r=m;if((m=i.l({},Bh,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&i.dI(window)&&(m.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new nu(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Rl,this._domRenderTaskQueue=new Rl,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aW(),this._locale=i.l({},Ud,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Rf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Je(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const l=document.getElementById(m.container);if(!l)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=l}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,i.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new lm),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Yv(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||i.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new Yl(this),m.hash&&(this._hash=new x0(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const l=m.bounds;l&&(this.resize(),this.fitBounds(l,i.l({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Cg({customAttribution:m.customAttribution})),this._logoControl=new kl,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new i.A(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new i.A(`${l.dataType}dataloading`,l))}),this._interactions=new C0(this)}_getMapId(){return this._mapId}addControl(m,r){if(r===void 0&&(r=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(m);return r>-1&&this._controls.splice(r,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new i.A("movestart",m)).fire(new i.A("move",m)),this.fire(new i.A("resize",m)),r&&this.fire(new i.A("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(i.aB.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(r=>r==="auto"?navigator.language:r):m}setLanguage(m){const r=this._parseLanguage(m);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,r=m.projection.name;let l;r==="globe"&&m.zoom>=i.bY?(m.setMercatorFromTransition(),l=!0):r==="mercator"&&m.zoom<i.bY&&(m.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,r){return this._updateProjection(m||r||{name:"mercator"})}_updateProjection(m){let r;return r=m.name==="globe"&&this.transform.zoom>=i.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,r){return this.transform.locationPoint3D(i.bO.convert(m),r)}unproject(m,r){return this.transform.pointLocation3D(i.P.convert(m),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,r,l){const p=y=>{let b=[];if(Array.isArray(r)){const S=r.filter(L=>this.getLayer(L));b=S.length?this.queryRenderedFeatures(y,{layers:S}):[]}else b=this.queryRenderedFeatures(y,{target:r});return b};if(m==="mouseenter"||m==="mouseover"){let y=!1;return{listener:l,targets:r,delegates:{mousemove:S=>{const L=p(S.point);L.length?y||(y=!0,l.call(this,new Ya(m,this,S.originalEvent,{features:L}))):y=!1},mouseout:()=>{y=!1}}}}if(m==="mouseleave"||m==="mouseout"){let y=!1;return{listener:l,targets:r,delegates:{mousemove:L=>{p(L.point).length?y=!0:y&&(y=!1,l.call(this,new Ya(m,this,L.originalEvent)))},mouseout:L=>{y&&(y=!1,l.call(this,new Ya(m,this,L.originalEvent)))}}}}{const y=b=>{const S=p(b.point);S.length&&(b.features=S,l.call(this,b),delete b.features)};return{listener:l,targets:r,delegates:{[m]:y}}}}on(m,r,l){if(typeof r=="function"||l===void 0)return super.on(m,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(m,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(m,r,l){if(typeof r=="function"||l===void 0)return super.once(m,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(m,r,l);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(m,r,l){if(typeof r=="function"||l===void 0)return super.off(m,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._delegatedListeners?this._delegatedListeners[m]:void 0;return p&&(y=>{for(let b=0;b<y.length;b++){const S=y[b];if(S.listener===l&&ni(S.targets,r)){for(const L in S.delegates)this.off(L,S.delegates[L]);return y.splice(b,1),this}}})(p),this}queryRenderedFeatures(m,r){if(!this.style)return[];if(m===void 0||m instanceof i.P||Array.isArray(m)||r!==void 0||(r=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!r){const b=this.style.queryRenderedFeatures(m,void 0,this.transform),S=this.style.queryRenderedFeatureset(m,void 0,this.transform);return b.concat(S)}let l=!0;if(r.target&&(l=this._isTargetValid(r.target),l&&!r.layers))return this.style.queryRenderedFeatureset(m,r,this.transform);let p=!0;if(r.layers&&Array.isArray(r.layers)){for(const b of r.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!r.target)return this.style.queryRenderedFeatures(m,r,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(m,r,this.transform))),l&&(y=y.concat(this.style.queryRenderedFeatureset(m,r,this.transform))),y}querySourceFeatures(m,r){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,r)}isPointOnSurface(m){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&i.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(m))}addInteraction(m,r){return this._interactions.add(m,r),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,r){return r=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&m&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(m,(l,p)=>{l?(i.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(m,r)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(m,r))}_getUIString(m){const r=this._locale[m];if(r==null)throw new Error(`Missing UI string '${m}'`);return r}_updateStyle(m,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const l=i.l({},r);r&&r.config&&(l.initialConfig=r.config,delete l.config),this.style=new Qo(this,l).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.cs(m)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const r of m)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(m)}addSource(m,r){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,r),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(m,r,l)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,r,{pixelRatio:l=1,sdf:p=!1,stretchX:y,stretchY:b,content:S}={}){this._lazyInitEmptyStyle();const L=i.I.from(m);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:N,height:F,data:B}=i.q.getImageData(r);this.style.addImage(L,{data:new i.r({width:N,height:F},B),pixelRatio:l,stretchX:y,stretchY:b,content:S,sdf:p,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:N,height:F}=r,B=r;this.style.addImage(L,{data:new i.r({width:N,height:F},new Uint8Array(B.data)),pixelRatio:l,stretchX:y,stretchY:b,content:S,sdf:p,usvg:!1,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m)}}updateImage(m,r){this._lazyInitEmptyStyle();const l=i.I.from(m),p=this.style.getImage(l);if(!p)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?i.q.getImageData(r):r,{width:b,height:S,data:L}=y;if(b===void 0||S===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||S!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${b}, ${S})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const N=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let F=!1;p.usvg?(p.data=new i.r({width:b,height:S},new Uint8Array(L)),p.usvg=!1,p.icon=void 0,F=!0):p.data.replace(L,N),this.style.updateImage(l,p,F)}hasImage(m){return m?!!this.style&&!!this.style.getImage(i.I.from(m)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(i.I.from(m))}loadImage(m,r){i.o(this._requestManager.transformRequest(m,i.R.Image),(l,p)=>{r(l,p instanceof HTMLImageElement?i.q.getImageData(p):p)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,r){this._lazyInitEmptyStyle(),this.style.addModel(m,r)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,r){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,r),this._update(!0)):this}getSlot(m){const r=this.getLayer(m);return r&&r.slot||null}setSlot(m,r){return this.style.setSlot(m,r),this.style.mergeLayers(),this._update(!0)}addImport(m,r){return this.style.addImport(m,r),this}updateImport(m,r){return typeof r!="string"&&r.id!==m?(this.removeImport(m),this.addImport(r)):(this.style.updateImport(m,r),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,r){return this.style.moveImport(m,r),this._update(!0)}moveLayer(m,r){return this._isValidId(m)?(this.style.moveLayer(m,r),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const r=this.style.getOwnLayer(m);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,r,l){return this._isValidId(m)?(this.style.setLayerZoomRange(m,r,l),this._update(!0)):this}setFilter(m,r,l={}){return this._isValidId(m)?(this.style.setFilter(m,r,l),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,r,l,p={}){return this._isValidId(m)?(this.style.setPaintProperty(m,r,l,p),this._update(!0)):this}getPaintProperty(m,r){return this._isValidId(m)?this.style.getPaintProperty(m,r):null}setLayoutProperty(m,r,l,p={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,r,l,p),this._update(!0)):this}getLayoutProperty(m,r){return this._isValidId(m)?this.style.getLayoutProperty(m,r):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,r){return this.style.setSchema(m,r),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,r){return this.style.setConfig(m,r),this._update(!0)}getConfigProperty(m,r){return this.style.getConfigProperty(m,r)}setConfigProperty(m,r,l){return this.style.setConfigProperty(m,r,l),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const r=m[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,r),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bO.convert(m),this.transform):0}setFeatureState(m,r){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,r),this._update())}removeFeatureState(m,r){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,r),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,p,y,b=this._container;for(;b&&(!p||!y);){const S=window.getComputedStyle(b).transform;S&&S!=="none"&&(l=S.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(y=l[3])),b=b.parentElement}this._containerWidth=p?Math.abs(m/p):m,this._containerHeight=y?Math.abs(r/y):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Q("div","mapboxgl-canvas-container",m);this._canvas=Q("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Q("div","mapboxgl-control-container",m),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=Q("div",`mapboxgl-ctrl-${y}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,r){const l=i.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(m),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${r}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const r=this._markers.indexOf(m);r!==-1&&this._markers.splice(r,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const r=this._popups.indexOf(m);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const m=i.l({},ie.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",m);r?(Cn(r,!0),this.painter=new Sg(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(r)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let r;this.fire(new i.A("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,p=i.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=y.createQuery(),y.beginQuery(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,B=this.transform.pitch,H=i.q.now(),W=new i.aa(F,{now:H,fadeDuration:b,pitch:B,transition:this.style.transition});this.style.update(W)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(p);const L=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),L&&(this._placementDirty=L.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,O.mark(k.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const F=i.q.now()-p;y.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const B=y.getQueryParameter(r,y.QUERY_RESULT)/1e6;y.deleteQuery(r),this.fire(new i.A("gpu-timing-frame",{cpuTime:F,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(F);this.fire(new i.A("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const F=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(F);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:B}))},50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(N||this._repaint)this.triggerRepaint();else{const F=this.idle();if(F&&(S=this._updateAverageElevation(p,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,O.mark(k.fullLoad),this._performanceMetricsCollection&&Wt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const r of this._markers)m&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!m||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(m,r=!1){const l=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(r||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const S=Math.abs(y-b);if(S>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),l(b);this._averageElevation.easeTo(b,m,300)}else if(S>1e-4)return this._averageElevation.jumpTo(b),l(b)}return!!this._averageElevation.isEasing(m)&&l(this._averageElevation.getValue(m))}_authenticate(){me(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===dt||m.status===401)){const r=this.painter.context.gl;Cn(r,!1),this._logoControl instanceof kl&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Fe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Et(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function y(b){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,b,0);const S=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,S),S}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(y(m),r.canvasCopies.map(y),r.timeStamps)}_canvasPixelComparison(m,r,l){let p=l[1]-l[0];const y=m.length/4;for(let b=0;b<r.length;b++){const S=r[b];let L=0;for(let N=0;N<S.length;N+=4)S[N]===m[N]&&S[N+1]===m[N+1]&&S[N+2]===m[N+2]&&S[N+3]===m[N+3]&&(L+=1);p+=(l[b+2]-l[b+1])*(1-L/y)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),dn.delete(this.painter.context.gl),Ft.remove(),Re.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=i.q.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(m){const r=this.style?this.style.getSourceCaches():[];return i.bl(r,(l,p)=>l._preloadTiles(m,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,r){i.dJ(m,r)}get version(){return E}},NavigationControl:class{constructor(m={}){this.options=i.l({},Bw,m),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(i.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=Q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const r=m.getZoom(),l=r===m.getMaxZoom(),p=r===m.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jw(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,r){const l=Q("button",m,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(m,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);m.setAttribute("aria-label",l),m.firstElementChild&&m.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends i.E{constructor(m={}){super();const r=navigator.geolocation;this.options=i.l({geolocation:r},Qa,m),i.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Tg(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,m(l)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(m){const r=this._map.getMaxBounds(),l=m.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",m)),this._finish()}}_updateCamera(m){const r=new i.bO(m.coords.longitude,m.coords.latitude),l=m.coords.accuracy,p=this._map.getBearing(),y=i.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),y,{geolocateSource:!0})}_updateMarker(m){if(m){const r=new i.bO(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,r=i.bH(1,m._center.lat)*m.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Q("button","mapboxgl-ctrl-geolocate",this._container),Q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q("div","mapboxgl-user-location"),this._dotElement.appendChild(Q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Vo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cg,ScaleControl:class{constructor(m={}){this.options=i.l({},Po,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-m/2,y=r.unproject([p,l]),b=r.unproject([p+m,l]),S=y.distanceTo(b);if(this.options.unit==="imperial"){const L=3.2808*S;L>5280?this._setScale(m,L/5280,"mile"):this._setScale(m,L,"foot")}else this.options.unit==="nautical"?this._setScale(m,S/1852,"nautical-mile"):S>=1e3?this._setScale(m,S/1e3,"kilometer"):this._setScale(m,S,"meter")}_setScale(m,r,l){this._map._requestDomTask(()=>{const p=function(b){const S=Math.pow(10,`${Math.floor(b)}`.length-1);let L=b/S;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(N){const F=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*F)/F}(L),S*L}(r),y=p/r;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${P0[l]}`,this._container.style.width=m*y+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:i.w("Full screen control 'container' must be a DOM element.")),i.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(m){super(),this.options=i.l(Object.create(ps),m),this._altitude=this.options.altitude,i.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=i.bO.convert(m),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const r=document.createDocumentFragment(),l=document.createElement("body");let p;for(l.innerHTML=m;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Q("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(m),this.options.closeButton){const l=this._closeButton=Q("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.innerHTML='<span aria-hidden="true">&#215;</span>',l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let r;return this._classList.delete(m)?r=!1:(this._classList.add(m),r=!0),this._updateClassList(),r}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";const y=l.offsetWidth,b=l.offsetHeight,S=p.x<y/2,L=p.x>r.transform.width-y/2;if(p.y+m<b)return S?"top-left":L?"top-right":"top";if(p.y>r.transform.height-b){if(S)return"bottom-left";if(L)return"bottom-right"}return S?"left":L?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),m.className=r.join(" ")}_update(m){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=Q("div","mapboxgl-popup",r.getContainer()),this._tip=Q("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Pg(this._lngLat,this._pos,r.transform)),!this._trackPointer||m){const y=this._pos=this._trackPointer&&m instanceof i.P?m:r.project(this._lngLat,this._altitude),b=jh(this.options.offset),S=this._anchor=this._getAnchor(b.y),L=jh(this.options.offset,S),N=y.add(L).round();r._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${cu[S]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&r._showingGlobe()){const y=i.dK(r.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Qv);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Vo,Style:Qo,LngLat:i.bO,LngLatBounds:i.aB,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:tu,Evented:i.E,config:i.e,prewarm:i.dP,clearPrewarmedResources:i.dQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(m){i.e.ACCESS_TOKEN=m},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(m){i.e.API_URL=m},get workerCount(){return i.dR.workerCount},set workerCount(m){i.dR.workerCount=m},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){i.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){i.dS(m)},get workerUrl(){return i.dT.workerUrl},set workerUrl(m){i.dT.workerUrl=m},get workerClass(){return i.dT.workerClass},set workerClass(m){i.dT.workerClass=m},get workerParams(){return i.dT.workerParams},set workerParams(m){i.dT.workerParams=m},get dracoUrl(){return i.dU()},set dracoUrl(m){i.dV(m)},get meshoptUrl(){return i.dW()},set meshoptUrl(m){i.dX(m)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var v=d;return v})})(mN);var B$=mN.exports;const Xm=l3(B$);Xm.accessToken="pk.eyJ1IjoiZ3VpdmFuaGVsZGVuIiwiYSI6ImNtOGRpOHA0dTA2eXYybnB1cGZpdXE5amoifQ.AaT1j9pOdFhZwKS-H2Xfcw";const Rp={"São Paulo":{lat:-23.5505,lng:-46.6333},"Rio de Janeiro":{lat:-22.9068,lng:-43.1729},Brasília:{lat:-15.7801,lng:-47.9292}};function j$(t,e={}){const s=[Rp["São Paulo"].lng,Rp["São Paulo"].lat],a=10,d="mapbox://styles/mapbox/streets-v11";return new Xm.Map({container:t,center:e.center||s,zoom:e.zoom||a,style:e.style||d})}function U$(t,e,s=!0){const a=[];return e.forEach(d=>{var k,O,z,G,U;if(!d.latitude||!d.longitude)return;const g=document.createElement("div");g.className=`marker ${d.type==="cliente"?"marker-client":d.type==="prestador"?"marker-provider":d.type==="rede_atual"?"marker-rede-atual":d.type==="bronzeMais"?"marker-bronze-mais":""}`,g.style.width=d.type==="cliente"?"25px":"20px",g.style.height=d.type==="cliente"?"25px":"20px";const v=((k=d.details)==null?void 0:k.especialidade)==="PRONTO SOCORRO ADULTO";if(v&&!s)return;v?(g.style.borderRadius="50%",g.style.width="40px",g.style.height="40px",g.innerHTML="🚑",g.style.fontSize="36px",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.background="white",d.type==="prestador"?g.style.border="3px solid #ef4444":d.type==="rede_atual"&&(g.style.border="3px solid #f97316"),g.style.boxShadow="0 0 0 1px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.2)"):d.type==="cliente"?(g.style.borderRadius="0",g.style.background=`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%233b82f6" width="25" height="25"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>')`,g.style.backgroundSize="cover",g.style.border="0",g.style.boxShadow="none"):(g.style.borderRadius="50%",d.type==="prestador"?g.style.backgroundColor="#ef4444":d.type==="rede_atual"?g.style.backgroundColor="#f97316":d.type==="bronzeMais"&&(g.style.backgroundColor="#800020"),g.style.border="2px solid white",g.style.boxShadow="0 0 0 1px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.2)");const i=new Xm.Popup({offset:25}).setHTML(`
        <div>
          <h3 class="font-bold text-sm mb-1">${d.name}</h3>
          <p class="text-xs text-gray-600">${d.type==="cliente"?"Cliente":d.type==="prestador"?"Prestador":"Prestador Rede Atual"}</p>
          ${(O=d.details)!=null&&O.uf?`<p class="text-xs mt-1">UF: ${d.details.uf}</p>`:""}
          ${(z=d.details)!=null&&z.cep?`<p class="text-xs">CEP: ${d.details.cep}</p>`:""}
          ${(G=d.details)!=null&&G.plano?`<p class="text-xs">Plano: ${d.details.plano}</p>`:""}
          ${(U=d.details)!=null&&U.especialidade?`<p class="text-xs">Especialidade: ${d.details.especialidade}</p>`:""}
        </div>
      `),E=new Xm.Marker(g).setLngLat([d.longitude,d.latitude]).setPopup(i).addTo(t);a.push(E)}),a}function V$(t,e){const a=e,d=a/(111.32*Math.cos(t[1]*Math.PI/180)),g=a/110.574;let v=[];for(let i=0;i<64;i++){const E=i*2*Math.PI/64,k=t[0]+d*Math.cos(E),O=t[1]+g*Math.sin(E);v.push([k,O])}return v.push(v[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[v]},properties:{}}}function E4(t,e,s=7,a="#ef4444"){const d=`circle-${e.id}`;if(t.getSource(d))return;const g=V$([e.longitude,e.latitude],s);t.addSource(d,{type:"geojson",data:g}),t.addLayer({id:`circle-fill-${e.id}`,type:"fill",source:d,paint:{"fill-color":a,"fill-opacity":.15}}),t.addLayer({id:`circle-line-${e.id}`,type:"line",source:d,paint:{"line-color":a,"line-width":1,"line-opacity":.5}})}function dx(t,e){const s=Rp[e];s&&t.flyTo({center:[s.lng,s.lat],zoom:10,essential:!0})}function C4(t){t&&t.remove()}function _N({clientLocations:t=[],providerLocations:e=[],redeAtualLocations:s=[],bronzeMaisLocations:a=[],focusCity:d,isLoading:g=!1,showClients:v=!0,showProviders:i=!0,showRedeAtual:E=!0,showBronzeMais:k=!0,showProntoSocorro:O=!0,onToggleFilter:z}){const G=ge.useRef(null),U=ge.useRef(null),[ie,Q]=ge.useState(!1);ge.useEffect(()=>{if(!G.current){console.error("MapView: Referência do container não encontrada");return}console.log("MapView: Inicializando mapa",{mapContainerExists:!!G.current,mapboxgl:!!Xm}),U.current&&(console.log("MapView: Limpando instância de mapa existente"),C4(U.current));try{const le=[Rp["São Paulo"].lng,Rp["São Paulo"].lat];console.log("MapView: Criando nova instância de mapa com coordenadas",le),Xm.accessToken||(console.error("MapView: Token do Mapbox não configurado"),Xm.accessToken="pk.eyJ1IjoiZ3VpdmFuaGVsZGVuIiwiYSI6ImNtOGRpOHA0dTA2eXYybnB1cGZpdXE5amoifQ.AaT1j9pOdFhZwKS-H2Xfcw"),U.current=j$("map",{center:le,zoom:10}),U.current.on("load",()=>{console.log("MapView: Mapa carregado com sucesso"),Q(!0)}),U.current.on("error",ye=>{console.error("MapView: Erro no mapa:",ye.error)})}catch(le){console.error("MapView: Erro ao inicializar o mapa:",le)}return()=>{U.current&&(C4(U.current),U.current=null)}},[]);const se=ge.useRef({}),J=ge.useRef({}),te=le=>{if(!U.current)return;const ye=le==="provider"?se.current:J.current;Object.keys(ye).forEach(Ne=>{const rt=`circle-${Ne}`,xe=`circle-fill-${Ne}`,Me=`circle-line-${Ne}`;try{U.current.getLayer(xe)&&U.current.removeLayer(xe),U.current.getLayer(Me)&&U.current.removeLayer(Me),U.current.getSource(rt)&&U.current.removeSource(rt)}catch(it){console.error(`Erro ao remover círculo ${Ne}:`,it)}}),le==="provider"?se.current={}:J.current={}};return ge.useEffect(()=>{if(!(!ie||!U.current))return i||te("provider"),k||te("bronzeMais"),()=>{U.current&&(te("provider"),te("bronzeMais"))}},[i,k,ie]),ge.useEffect(()=>{if(!ie||!U.current)return;te("provider"),te("bronzeMais");const le=[...v?t:[],...i?e:[],...E?s:[],...k?a:[]],ye=U$(U.current,le,O);return i&&e.forEach(Ne=>{E4(U.current,Ne,7),se.current[Ne.id]=!0}),k&&a.forEach(Ne=>{E4(U.current,Ne,7,"#800020"),J.current[Ne.id]=!0}),()=>{ye.forEach(Ne=>Ne.remove())}},[t,e,s,a,ie,v,i,E,k,O]),ge.useEffect(()=>{!ie||!U.current||!d||dx(U.current,d)},[d,ie]),V.jsxs("div",{className:"rounded-lg shadow overflow-hidden",children:[V.jsxs("div",{className:"p-4 border-b border-slate-200",children:[V.jsxs("div",{className:"flex justify-between items-center mb-3",children:[V.jsx("h3",{className:"font-semibold text-slate-700",children:"Mapa de Distribuição"}),V.jsxs("div",{className:"flex space-x-2",children:[V.jsx("button",{onClick:()=>U.current&&dx(U.current,"São Paulo"),className:"text-xs bg-slate-100 hover:bg-slate-200 text-slate-700 py-1 px-2 rounded",children:"São Paulo"}),V.jsx("button",{onClick:()=>U.current&&dx(U.current,"Rio de Janeiro"),className:"text-xs bg-slate-100 hover:bg-slate-200 text-slate-700 py-1 px-2 rounded",children:"Rio de Janeiro"}),V.jsx("button",{onClick:()=>U.current&&dx(U.current,"Brasília"),className:"text-xs bg-slate-100 hover:bg-slate-200 text-slate-700 py-1 px-2 rounded",children:"Brasília"})]})]}),V.jsxs("div",{className:"flex flex-wrap gap-2",children:[V.jsxs("button",{onClick:()=>z&&z("clients"),className:`text-xs py-1 px-2 rounded flex items-center gap-1 ${v?"bg-blue-100 text-blue-700 border border-blue-200":"bg-slate-100 text-slate-500 border border-slate-200"}`,children:[V.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Clientes"]}),V.jsxs("button",{onClick:()=>z&&z("providers"),className:`text-xs py-1 px-2 rounded flex items-center gap-1 ${i?"bg-red-100 text-red-700 border border-red-200":"bg-slate-100 text-slate-500 border border-slate-200"}`,children:[V.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),"Prestadores"]}),V.jsxs("button",{onClick:()=>z&&z("redeAtual"),className:`text-xs py-1 px-2 rounded flex items-center gap-1 ${E?"bg-orange-100 text-orange-700 border border-orange-200":"bg-slate-100 text-slate-500 border border-slate-200"}`,children:[V.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Prestadores Rede Atual"]}),V.jsxs("button",{onClick:()=>z&&z("bronzeMais"),className:`text-xs py-1 px-2 rounded flex items-center gap-1 ${k?"bg-rose-100 text-rose-700 border border-rose-200":"bg-slate-100 text-slate-500 border border-slate-200"}`,"aria-label":"Alternar visualização de Prestadores Bronze Mais",children:[V.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"#800020"}}),"Prestadores Bronze Mais"]}),V.jsxs("button",{onClick:()=>{z&&z("prontoSocorro")},className:`text-xs py-1 px-2 rounded flex items-center gap-1 ${O?"bg-amber-100 text-amber-700 border border-amber-200":"bg-slate-100 text-slate-500 border border-slate-200"}`,"aria-label":"Alternar visualização de Pronto Socorro",children:[V.jsx("div",{className:"w-6 h-6 flex items-center justify-center text-lg",children:"🚑"}),"Pronto Socorro"]})]})]}),V.jsxs("div",{className:"relative",children:[V.jsx("div",{id:"map",ref:G,className:"w-full h-[500px] bg-slate-200 rounded-b-lg",children:g&&V.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-100 bg-opacity-80 z-10",children:V.jsxs("div",{className:"flex flex-col items-center",children:[V.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary mb-2"}),V.jsx("p",{className:"text-slate-700",children:"Carregando mapa..."})]})})}),V.jsxs("div",{className:"absolute bottom-4 left-4 bg-white p-3 rounded-lg shadow-md",children:[V.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Legenda"}),V.jsxs("div",{className:"space-y-2",children:[V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:"w-6 h-6 mr-2",style:{background:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%233b82f6" width="24" height="24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>')`,backgroundSize:"cover"}}),V.jsx("span",{className:"text-xs text-slate-700",children:"Clientes"})]}),V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500 mr-2"}),V.jsx("span",{className:"text-xs text-slate-700",children:"Prestadores"})]}),V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 mr-2"}),V.jsx("span",{className:"text-xs text-slate-700",children:"Prestadores Rede Atual"})]}),V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:"w-4 h-4 rounded-full mr-2",style:{backgroundColor:"#800020"}}),V.jsx("span",{className:"text-xs text-slate-700",children:"Prestadores Bronze Mais"})]}),V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:"w-6 h-6 mr-2 flex items-center justify-center",style:{fontSize:"18px"},children:"🚑"}),V.jsx("span",{className:"text-xs text-slate-700",children:"Pronto Socorro"})]}),V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:"w-6 h-6 mr-2 flex items-center justify-center",style:{fontSize:"18px"},children:"🚑"}),V.jsx("span",{className:"text-xs text-slate-700",children:"Pronto Socorro Rede Atual"})]}),V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:"w-4 h-4 rounded border-2 border-red-300 bg-red-100 bg-opacity-30 mr-2"}),V.jsx("span",{className:"text-xs text-slate-700",children:"Área de 7km"})]})]})]})]})]})}function Sb(t,[e,s]){return Math.min(s,Math.max(e,t))}var q$=ge.createContext(void 0);function Rv(t){const e=ge.useContext(q$);return t||e||"ltr"}var O5=0;function vA(){ge.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??P4()),document.body.insertAdjacentElement("beforeend",t[1]??P4()),O5++,()=>{O5===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),O5--}},[])}function P4(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var z5="focusScope.autoFocusOnMount",F5="focusScope.autoFocusOnUnmount",M4={bubbles:!1,cancelable:!0},$$="FocusScope",ow=ge.forwardRef((t,e)=>{const{loop:s=!1,trapped:a=!1,onMountAutoFocus:d,onUnmountAutoFocus:g,...v}=t,[i,E]=ge.useState(null),k=fl(d),O=fl(g),z=ge.useRef(null),G=ji(e,Q=>E(Q)),U=ge.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;ge.useEffect(()=>{if(a){let Q=function(le){if(U.paused||!i)return;const ye=le.target;i.contains(ye)?z.current=ye:Qf(z.current,{select:!0})},se=function(le){if(U.paused||!i)return;const ye=le.relatedTarget;ye!==null&&(i.contains(ye)||Qf(z.current,{select:!0}))},J=function(le){if(document.activeElement===document.body)for(const Ne of le)Ne.removedNodes.length>0&&Qf(i)};document.addEventListener("focusin",Q),document.addEventListener("focusout",se);const te=new MutationObserver(J);return i&&te.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Q),document.removeEventListener("focusout",se),te.disconnect()}}},[a,i,U.paused]),ge.useEffect(()=>{if(i){L4.add(U);const Q=document.activeElement;if(!i.contains(Q)){const J=new CustomEvent(z5,M4);i.addEventListener(z5,k),i.dispatchEvent(J),J.defaultPrevented||(G$(X$(yN(i)),{select:!0}),document.activeElement===Q&&Qf(i))}return()=>{i.removeEventListener(z5,k),setTimeout(()=>{const J=new CustomEvent(F5,M4);i.addEventListener(F5,O),i.dispatchEvent(J),J.defaultPrevented||Qf(Q??document.body,{select:!0}),i.removeEventListener(F5,O),L4.remove(U)},0)}}},[i,k,O,U]);const ie=ge.useCallback(Q=>{if(!s&&!a||U.paused)return;const se=Q.key==="Tab"&&!Q.altKey&&!Q.ctrlKey&&!Q.metaKey,J=document.activeElement;if(se&&J){const te=Q.currentTarget,[le,ye]=H$(te);le&&ye?!Q.shiftKey&&J===ye?(Q.preventDefault(),s&&Qf(le,{select:!0})):Q.shiftKey&&J===le&&(Q.preventDefault(),s&&Qf(ye,{select:!0})):J===te&&Q.preventDefault()}},[s,a,U.paused]);return V.jsx(Zr.div,{tabIndex:-1,...v,ref:G,onKeyDown:ie})});ow.displayName=$$;function G$(t,{select:e=!1}={}){const s=document.activeElement;for(const a of t)if(Qf(a,{select:e}),document.activeElement!==s)return}function H$(t){const e=yN(t),s=I4(e,t),a=I4(e.reverse(),t);return[s,a]}function yN(t){const e=[],s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const d=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||d?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)e.push(s.currentNode);return e}function I4(t,e){for(const s of t)if(!W$(s,{upTo:e}))return s}function W$(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Z$(t){return t instanceof HTMLInputElement&&"select"in t}function Qf(t,{select:e=!1}={}){if(t&&t.focus){const s=document.activeElement;t.focus({preventScroll:!0}),t!==s&&Z$(t)&&e&&t.select()}}var L4=K$();function K$(){let t=[];return{add(e){const s=t[0];e!==s&&(s==null||s.pause()),t=k4(t,e),t.unshift(e)},remove(e){var s;t=k4(t,e),(s=t[0])==null||s.resume()}}}function k4(t,e){const s=[...t],a=s.indexOf(e);return a!==-1&&s.splice(a,1),s}function X$(t){return t.filter(e=>e.tagName!=="A")}var Y$=ek.useId||(()=>{}),J$=0;function id(t){const[e,s]=ge.useState(Y$());return pl(()=>{s(a=>a??String(J$++))},[t]),e?`radix-${e}`:""}const Q$=["top","right","bottom","left"],Dp=Math.min,jc=Math.max,Tb=Math.round,fx=Math.floor,sd=t=>({x:t,y:t}),eG={left:"right",right:"left",bottom:"top",top:"bottom"},tG={start:"end",end:"start"};function TT(t,e,s){return jc(t,Dp(e,s))}function df(t,e){return typeof t=="function"?t(e):t}function ff(t){return t.split("-")[0]}function u0(t){return t.split("-")[1]}function xA(t){return t==="x"?"y":"x"}function bA(t){return t==="y"?"height":"width"}function Np(t){return["top","bottom"].includes(ff(t))?"y":"x"}function wA(t){return xA(Np(t))}function nG(t,e,s){s===void 0&&(s=!1);const a=u0(t),d=wA(t),g=bA(d);let v=d==="x"?a===(s?"end":"start")?"right":"left":a==="start"?"bottom":"top";return e.reference[g]>e.floating[g]&&(v=Ab(v)),[v,Ab(v)]}function rG(t){const e=Ab(t);return[AT(t),e,AT(e)]}function AT(t){return t.replace(/start|end/g,e=>tG[e])}function iG(t,e,s){const a=["left","right"],d=["right","left"],g=["top","bottom"],v=["bottom","top"];switch(t){case"top":case"bottom":return s?e?d:a:e?a:d;case"left":case"right":return e?g:v;default:return[]}}function sG(t,e,s,a){const d=u0(t);let g=iG(ff(t),s==="start",a);return d&&(g=g.map(v=>v+"-"+d),e&&(g=g.concat(g.map(AT)))),g}function Ab(t){return t.replace(/left|right|bottom|top/g,e=>eG[e])}function oG(t){return{top:0,right:0,bottom:0,left:0,...t}}function vN(t){return typeof t!="number"?oG(t):{top:t,right:t,bottom:t,left:t}}function Eb(t){const{x:e,y:s,width:a,height:d}=t;return{width:a,height:d,top:s,left:e,right:e+a,bottom:s+d,x:e,y:s}}function R4(t,e,s){let{reference:a,floating:d}=t;const g=Np(e),v=wA(e),i=bA(v),E=ff(e),k=g==="y",O=a.x+a.width/2-d.width/2,z=a.y+a.height/2-d.height/2,G=a[i]/2-d[i]/2;let U;switch(E){case"top":U={x:O,y:a.y-d.height};break;case"bottom":U={x:O,y:a.y+a.height};break;case"right":U={x:a.x+a.width,y:z};break;case"left":U={x:a.x-d.width,y:z};break;default:U={x:a.x,y:a.y}}switch(u0(e)){case"start":U[v]-=G*(s&&k?-1:1);break;case"end":U[v]+=G*(s&&k?-1:1);break}return U}const aG=async(t,e,s)=>{const{placement:a="bottom",strategy:d="absolute",middleware:g=[],platform:v}=s,i=g.filter(Boolean),E=await(v.isRTL==null?void 0:v.isRTL(e));let k=await v.getElementRects({reference:t,floating:e,strategy:d}),{x:O,y:z}=R4(k,a,E),G=a,U={},ie=0;for(let Q=0;Q<i.length;Q++){const{name:se,fn:J}=i[Q],{x:te,y:le,data:ye,reset:Ne}=await J({x:O,y:z,initialPlacement:a,placement:G,strategy:d,middlewareData:U,rects:k,platform:v,elements:{reference:t,floating:e}});O=te??O,z=le??z,U={...U,[se]:{...U[se],...ye}},Ne&&ie<=50&&(ie++,typeof Ne=="object"&&(Ne.placement&&(G=Ne.placement),Ne.rects&&(k=Ne.rects===!0?await v.getElementRects({reference:t,floating:e,strategy:d}):Ne.rects),{x:O,y:z}=R4(k,G,E)),Q=-1)}return{x:O,y:z,placement:G,strategy:d,middlewareData:U}};async function dv(t,e){var s;e===void 0&&(e={});const{x:a,y:d,platform:g,rects:v,elements:i,strategy:E}=t,{boundary:k="clippingAncestors",rootBoundary:O="viewport",elementContext:z="floating",altBoundary:G=!1,padding:U=0}=df(e,t),ie=vN(U),se=i[G?z==="floating"?"reference":"floating":z],J=Eb(await g.getClippingRect({element:(s=await(g.isElement==null?void 0:g.isElement(se)))==null||s?se:se.contextElement||await(g.getDocumentElement==null?void 0:g.getDocumentElement(i.floating)),boundary:k,rootBoundary:O,strategy:E})),te=z==="floating"?{x:a,y:d,width:v.floating.width,height:v.floating.height}:v.reference,le=await(g.getOffsetParent==null?void 0:g.getOffsetParent(i.floating)),ye=await(g.isElement==null?void 0:g.isElement(le))?await(g.getScale==null?void 0:g.getScale(le))||{x:1,y:1}:{x:1,y:1},Ne=Eb(g.convertOffsetParentRelativeRectToViewportRelativeRect?await g.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:te,offsetParent:le,strategy:E}):te);return{top:(J.top-Ne.top+ie.top)/ye.y,bottom:(Ne.bottom-J.bottom+ie.bottom)/ye.y,left:(J.left-Ne.left+ie.left)/ye.x,right:(Ne.right-J.right+ie.right)/ye.x}}const lG=t=>({name:"arrow",options:t,async fn(e){const{x:s,y:a,placement:d,rects:g,platform:v,elements:i,middlewareData:E}=e,{element:k,padding:O=0}=df(t,e)||{};if(k==null)return{};const z=vN(O),G={x:s,y:a},U=wA(d),ie=bA(U),Q=await v.getDimensions(k),se=U==="y",J=se?"top":"left",te=se?"bottom":"right",le=se?"clientHeight":"clientWidth",ye=g.reference[ie]+g.reference[U]-G[U]-g.floating[ie],Ne=G[U]-g.reference[U],rt=await(v.getOffsetParent==null?void 0:v.getOffsetParent(k));let xe=rt?rt[le]:0;(!xe||!await(v.isElement==null?void 0:v.isElement(rt)))&&(xe=i.floating[le]||g.floating[ie]);const Me=ye/2-Ne/2,it=xe/2-Q[ie]/2-1,ot=Dp(z[J],it),ve=Dp(z[te],it),Le=ot,dt=xe-Q[ie]-ve,Je=xe/2-Q[ie]/2+Me,yt=TT(Le,Je,dt),St=!E.arrow&&u0(d)!=null&&Je!==yt&&g.reference[ie]/2-(Je<Le?ot:ve)-Q[ie]/2<0,jt=St?Je<Le?Je-Le:Je-dt:0;return{[U]:G[U]+jt,data:{[U]:yt,centerOffset:Je-yt-jt,...St&&{alignmentOffset:jt}},reset:St}}}),cG=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var s,a;const{placement:d,middlewareData:g,rects:v,initialPlacement:i,platform:E,elements:k}=e,{mainAxis:O=!0,crossAxis:z=!0,fallbackPlacements:G,fallbackStrategy:U="bestFit",fallbackAxisSideDirection:ie="none",flipAlignment:Q=!0,...se}=df(t,e);if((s=g.arrow)!=null&&s.alignmentOffset)return{};const J=ff(d),te=Np(i),le=ff(i)===i,ye=await(E.isRTL==null?void 0:E.isRTL(k.floating)),Ne=G||(le||!Q?[Ab(i)]:rG(i)),rt=ie!=="none";!G&&rt&&Ne.push(...sG(i,Q,ie,ye));const xe=[i,...Ne],Me=await dv(e,se),it=[];let ot=((a=g.flip)==null?void 0:a.overflows)||[];if(O&&it.push(Me[J]),z){const Je=nG(d,v,ye);it.push(Me[Je[0]],Me[Je[1]])}if(ot=[...ot,{placement:d,overflows:it}],!it.every(Je=>Je<=0)){var ve,Le;const Je=(((ve=g.flip)==null?void 0:ve.index)||0)+1,yt=xe[Je];if(yt)return{data:{index:Je,overflows:ot},reset:{placement:yt}};let St=(Le=ot.filter(jt=>jt.overflows[0]<=0).sort((jt,et)=>jt.overflows[1]-et.overflows[1])[0])==null?void 0:Le.placement;if(!St)switch(U){case"bestFit":{var dt;const jt=(dt=ot.filter(et=>{if(rt){const Qe=Np(et.placement);return Qe===te||Qe==="y"}return!0}).map(et=>[et.placement,et.overflows.filter(Qe=>Qe>0).reduce((Qe,Xe)=>Qe+Xe,0)]).sort((et,Qe)=>et[1]-Qe[1])[0])==null?void 0:dt[0];jt&&(St=jt);break}case"initialPlacement":St=i;break}if(d!==St)return{reset:{placement:St}}}return{}}}};function D4(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function N4(t){return Q$.some(e=>t[e]>=0)}const uG=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:s}=e,{strategy:a="referenceHidden",...d}=df(t,e);switch(a){case"referenceHidden":{const g=await dv(e,{...d,elementContext:"reference"}),v=D4(g,s.reference);return{data:{referenceHiddenOffsets:v,referenceHidden:N4(v)}}}case"escaped":{const g=await dv(e,{...d,altBoundary:!0}),v=D4(g,s.floating);return{data:{escapedOffsets:v,escaped:N4(v)}}}default:return{}}}}};async function hG(t,e){const{placement:s,platform:a,elements:d}=t,g=await(a.isRTL==null?void 0:a.isRTL(d.floating)),v=ff(s),i=u0(s),E=Np(s)==="y",k=["left","top"].includes(v)?-1:1,O=g&&E?-1:1,z=df(e,t);let{mainAxis:G,crossAxis:U,alignmentAxis:ie}=typeof z=="number"?{mainAxis:z,crossAxis:0,alignmentAxis:null}:{mainAxis:z.mainAxis||0,crossAxis:z.crossAxis||0,alignmentAxis:z.alignmentAxis};return i&&typeof ie=="number"&&(U=i==="end"?ie*-1:ie),E?{x:U*O,y:G*k}:{x:G*k,y:U*O}}const dG=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var s,a;const{x:d,y:g,placement:v,middlewareData:i}=e,E=await hG(e,t);return v===((s=i.offset)==null?void 0:s.placement)&&(a=i.arrow)!=null&&a.alignmentOffset?{}:{x:d+E.x,y:g+E.y,data:{...E,placement:v}}}}},fG=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:s,y:a,placement:d}=e,{mainAxis:g=!0,crossAxis:v=!1,limiter:i={fn:se=>{let{x:J,y:te}=se;return{x:J,y:te}}},...E}=df(t,e),k={x:s,y:a},O=await dv(e,E),z=Np(ff(d)),G=xA(z);let U=k[G],ie=k[z];if(g){const se=G==="y"?"top":"left",J=G==="y"?"bottom":"right",te=U+O[se],le=U-O[J];U=TT(te,U,le)}if(v){const se=z==="y"?"top":"left",J=z==="y"?"bottom":"right",te=ie+O[se],le=ie-O[J];ie=TT(te,ie,le)}const Q=i.fn({...e,[G]:U,[z]:ie});return{...Q,data:{x:Q.x-s,y:Q.y-a,enabled:{[G]:g,[z]:v}}}}}},pG=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:s,y:a,placement:d,rects:g,middlewareData:v}=e,{offset:i=0,mainAxis:E=!0,crossAxis:k=!0}=df(t,e),O={x:s,y:a},z=Np(d),G=xA(z);let U=O[G],ie=O[z];const Q=df(i,e),se=typeof Q=="number"?{mainAxis:Q,crossAxis:0}:{mainAxis:0,crossAxis:0,...Q};if(E){const le=G==="y"?"height":"width",ye=g.reference[G]-g.floating[le]+se.mainAxis,Ne=g.reference[G]+g.reference[le]-se.mainAxis;U<ye?U=ye:U>Ne&&(U=Ne)}if(k){var J,te;const le=G==="y"?"width":"height",ye=["top","left"].includes(ff(d)),Ne=g.reference[z]-g.floating[le]+(ye&&((J=v.offset)==null?void 0:J[z])||0)+(ye?0:se.crossAxis),rt=g.reference[z]+g.reference[le]+(ye?0:((te=v.offset)==null?void 0:te[z])||0)-(ye?se.crossAxis:0);ie<Ne?ie=Ne:ie>rt&&(ie=rt)}return{[G]:U,[z]:ie}}}},mG=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var s,a;const{placement:d,rects:g,platform:v,elements:i}=e,{apply:E=()=>{},...k}=df(t,e),O=await dv(e,k),z=ff(d),G=u0(d),U=Np(d)==="y",{width:ie,height:Q}=g.floating;let se,J;z==="top"||z==="bottom"?(se=z,J=G===(await(v.isRTL==null?void 0:v.isRTL(i.floating))?"start":"end")?"left":"right"):(J=z,se=G==="end"?"top":"bottom");const te=Q-O.top-O.bottom,le=ie-O.left-O.right,ye=Dp(Q-O[se],te),Ne=Dp(ie-O[J],le),rt=!e.middlewareData.shift;let xe=ye,Me=Ne;if((s=e.middlewareData.shift)!=null&&s.enabled.x&&(Me=le),(a=e.middlewareData.shift)!=null&&a.enabled.y&&(xe=te),rt&&!G){const ot=jc(O.left,0),ve=jc(O.right,0),Le=jc(O.top,0),dt=jc(O.bottom,0);U?Me=ie-2*(ot!==0||ve!==0?ot+ve:jc(O.left,O.right)):xe=Q-2*(Le!==0||dt!==0?Le+dt:jc(O.top,O.bottom))}await E({...e,availableWidth:Me,availableHeight:xe});const it=await v.getDimensions(i.floating);return ie!==it.width||Q!==it.height?{reset:{rects:!0}}:{}}}};function aw(){return typeof window<"u"}function h0(t){return xN(t)?(t.nodeName||"").toLowerCase():"#document"}function Gc(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function ud(t){var e;return(e=(xN(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function xN(t){return aw()?t instanceof Node||t instanceof Gc(t).Node:!1}function fh(t){return aw()?t instanceof Element||t instanceof Gc(t).Element:!1}function ld(t){return aw()?t instanceof HTMLElement||t instanceof Gc(t).HTMLElement:!1}function O4(t){return!aw()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Gc(t).ShadowRoot}function Dv(t){const{overflow:e,overflowX:s,overflowY:a,display:d}=ph(t);return/auto|scroll|overlay|hidden|clip/.test(e+a+s)&&!["inline","contents"].includes(d)}function gG(t){return["table","td","th"].includes(h0(t))}function lw(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function SA(t){const e=TA(),s=fh(t)?ph(t):t;return s.transform!=="none"||s.perspective!=="none"||(s.containerType?s.containerType!=="normal":!1)||!e&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!e&&(s.filter?s.filter!=="none":!1)||["transform","perspective","filter"].some(a=>(s.willChange||"").includes(a))||["paint","layout","strict","content"].some(a=>(s.contain||"").includes(a))}function _G(t){let e=Op(t);for(;ld(e)&&!n0(e);){if(SA(e))return e;if(lw(e))return null;e=Op(e)}return null}function TA(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function n0(t){return["html","body","#document"].includes(h0(t))}function ph(t){return Gc(t).getComputedStyle(t)}function cw(t){return fh(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Op(t){if(h0(t)==="html")return t;const e=t.assignedSlot||t.parentNode||O4(t)&&t.host||ud(t);return O4(e)?e.host:e}function bN(t){const e=Op(t);return n0(e)?t.ownerDocument?t.ownerDocument.body:t.body:ld(e)&&Dv(e)?e:bN(e)}function fv(t,e,s){var a;e===void 0&&(e=[]),s===void 0&&(s=!0);const d=bN(t),g=d===((a=t.ownerDocument)==null?void 0:a.body),v=Gc(d);if(g){const i=ET(v);return e.concat(v,v.visualViewport||[],Dv(d)?d:[],i&&s?fv(i):[])}return e.concat(d,fv(d,[],s))}function ET(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function wN(t){const e=ph(t);let s=parseFloat(e.width)||0,a=parseFloat(e.height)||0;const d=ld(t),g=d?t.offsetWidth:s,v=d?t.offsetHeight:a,i=Tb(s)!==g||Tb(a)!==v;return i&&(s=g,a=v),{width:s,height:a,$:i}}function AA(t){return fh(t)?t:t.contextElement}function C_(t){const e=AA(t);if(!ld(e))return sd(1);const s=e.getBoundingClientRect(),{width:a,height:d,$:g}=wN(e);let v=(g?Tb(s.width):s.width)/a,i=(g?Tb(s.height):s.height)/d;return(!v||!Number.isFinite(v))&&(v=1),(!i||!Number.isFinite(i))&&(i=1),{x:v,y:i}}const yG=sd(0);function SN(t){const e=Gc(t);return!TA()||!e.visualViewport?yG:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function vG(t,e,s){return e===void 0&&(e=!1),!s||e&&s!==Gc(t)?!1:e}function sg(t,e,s,a){e===void 0&&(e=!1),s===void 0&&(s=!1);const d=t.getBoundingClientRect(),g=AA(t);let v=sd(1);e&&(a?fh(a)&&(v=C_(a)):v=C_(t));const i=vG(g,s,a)?SN(g):sd(0);let E=(d.left+i.x)/v.x,k=(d.top+i.y)/v.y,O=d.width/v.x,z=d.height/v.y;if(g){const G=Gc(g),U=a&&fh(a)?Gc(a):a;let ie=G,Q=ET(ie);for(;Q&&a&&U!==ie;){const se=C_(Q),J=Q.getBoundingClientRect(),te=ph(Q),le=J.left+(Q.clientLeft+parseFloat(te.paddingLeft))*se.x,ye=J.top+(Q.clientTop+parseFloat(te.paddingTop))*se.y;E*=se.x,k*=se.y,O*=se.x,z*=se.y,E+=le,k+=ye,ie=Gc(Q),Q=ET(ie)}}return Eb({width:O,height:z,x:E,y:k})}function EA(t,e){const s=cw(t).scrollLeft;return e?e.left+s:sg(ud(t)).left+s}function TN(t,e,s){s===void 0&&(s=!1);const a=t.getBoundingClientRect(),d=a.left+e.scrollLeft-(s?0:EA(t,a)),g=a.top+e.scrollTop;return{x:d,y:g}}function xG(t){let{elements:e,rect:s,offsetParent:a,strategy:d}=t;const g=d==="fixed",v=ud(a),i=e?lw(e.floating):!1;if(a===v||i&&g)return s;let E={scrollLeft:0,scrollTop:0},k=sd(1);const O=sd(0),z=ld(a);if((z||!z&&!g)&&((h0(a)!=="body"||Dv(v))&&(E=cw(a)),ld(a))){const U=sg(a);k=C_(a),O.x=U.x+a.clientLeft,O.y=U.y+a.clientTop}const G=v&&!z&&!g?TN(v,E,!0):sd(0);return{width:s.width*k.x,height:s.height*k.y,x:s.x*k.x-E.scrollLeft*k.x+O.x+G.x,y:s.y*k.y-E.scrollTop*k.y+O.y+G.y}}function bG(t){return Array.from(t.getClientRects())}function wG(t){const e=ud(t),s=cw(t),a=t.ownerDocument.body,d=jc(e.scrollWidth,e.clientWidth,a.scrollWidth,a.clientWidth),g=jc(e.scrollHeight,e.clientHeight,a.scrollHeight,a.clientHeight);let v=-s.scrollLeft+EA(t);const i=-s.scrollTop;return ph(a).direction==="rtl"&&(v+=jc(e.clientWidth,a.clientWidth)-d),{width:d,height:g,x:v,y:i}}function SG(t,e){const s=Gc(t),a=ud(t),d=s.visualViewport;let g=a.clientWidth,v=a.clientHeight,i=0,E=0;if(d){g=d.width,v=d.height;const k=TA();(!k||k&&e==="fixed")&&(i=d.offsetLeft,E=d.offsetTop)}return{width:g,height:v,x:i,y:E}}function TG(t,e){const s=sg(t,!0,e==="fixed"),a=s.top+t.clientTop,d=s.left+t.clientLeft,g=ld(t)?C_(t):sd(1),v=t.clientWidth*g.x,i=t.clientHeight*g.y,E=d*g.x,k=a*g.y;return{width:v,height:i,x:E,y:k}}function z4(t,e,s){let a;if(e==="viewport")a=SG(t,s);else if(e==="document")a=wG(ud(t));else if(fh(e))a=TG(e,s);else{const d=SN(t);a={x:e.x-d.x,y:e.y-d.y,width:e.width,height:e.height}}return Eb(a)}function AN(t,e){const s=Op(t);return s===e||!fh(s)||n0(s)?!1:ph(s).position==="fixed"||AN(s,e)}function AG(t,e){const s=e.get(t);if(s)return s;let a=fv(t,[],!1).filter(i=>fh(i)&&h0(i)!=="body"),d=null;const g=ph(t).position==="fixed";let v=g?Op(t):t;for(;fh(v)&&!n0(v);){const i=ph(v),E=SA(v);!E&&i.position==="fixed"&&(d=null),(g?!E&&!d:!E&&i.position==="static"&&!!d&&["absolute","fixed"].includes(d.position)||Dv(v)&&!E&&AN(t,v))?a=a.filter(O=>O!==v):d=i,v=Op(v)}return e.set(t,a),a}function EG(t){let{element:e,boundary:s,rootBoundary:a,strategy:d}=t;const v=[...s==="clippingAncestors"?lw(e)?[]:AG(e,this._c):[].concat(s),a],i=v[0],E=v.reduce((k,O)=>{const z=z4(e,O,d);return k.top=jc(z.top,k.top),k.right=Dp(z.right,k.right),k.bottom=Dp(z.bottom,k.bottom),k.left=jc(z.left,k.left),k},z4(e,i,d));return{width:E.right-E.left,height:E.bottom-E.top,x:E.left,y:E.top}}function CG(t){const{width:e,height:s}=wN(t);return{width:e,height:s}}function PG(t,e,s){const a=ld(e),d=ud(e),g=s==="fixed",v=sg(t,!0,g,e);let i={scrollLeft:0,scrollTop:0};const E=sd(0);if(a||!a&&!g)if((h0(e)!=="body"||Dv(d))&&(i=cw(e)),a){const G=sg(e,!0,g,e);E.x=G.x+e.clientLeft,E.y=G.y+e.clientTop}else d&&(E.x=EA(d));const k=d&&!a&&!g?TN(d,i):sd(0),O=v.left+i.scrollLeft-E.x-k.x,z=v.top+i.scrollTop-E.y-k.y;return{x:O,y:z,width:v.width,height:v.height}}function B5(t){return ph(t).position==="static"}function F4(t,e){if(!ld(t)||ph(t).position==="fixed")return null;if(e)return e(t);let s=t.offsetParent;return ud(t)===s&&(s=s.ownerDocument.body),s}function EN(t,e){const s=Gc(t);if(lw(t))return s;if(!ld(t)){let d=Op(t);for(;d&&!n0(d);){if(fh(d)&&!B5(d))return d;d=Op(d)}return s}let a=F4(t,e);for(;a&&gG(a)&&B5(a);)a=F4(a,e);return a&&n0(a)&&B5(a)&&!SA(a)?s:a||_G(t)||s}const MG=async function(t){const e=this.getOffsetParent||EN,s=this.getDimensions,a=await s(t.floating);return{reference:PG(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function IG(t){return ph(t).direction==="rtl"}const LG={convertOffsetParentRelativeRectToViewportRelativeRect:xG,getDocumentElement:ud,getClippingRect:EG,getOffsetParent:EN,getElementRects:MG,getClientRects:bG,getDimensions:CG,getScale:C_,isElement:fh,isRTL:IG};function kG(t,e){let s=null,a;const d=ud(t);function g(){var i;clearTimeout(a),(i=s)==null||i.disconnect(),s=null}function v(i,E){i===void 0&&(i=!1),E===void 0&&(E=1),g();const{left:k,top:O,width:z,height:G}=t.getBoundingClientRect();if(i||e(),!z||!G)return;const U=fx(O),ie=fx(d.clientWidth-(k+z)),Q=fx(d.clientHeight-(O+G)),se=fx(k),te={rootMargin:-U+"px "+-ie+"px "+-Q+"px "+-se+"px",threshold:jc(0,Dp(1,E))||1};let le=!0;function ye(Ne){const rt=Ne[0].intersectionRatio;if(rt!==E){if(!le)return v();rt?v(!1,rt):a=setTimeout(()=>{v(!1,1e-7)},1e3)}le=!1}try{s=new IntersectionObserver(ye,{...te,root:d.ownerDocument})}catch{s=new IntersectionObserver(ye,te)}s.observe(t)}return v(!0),g}function RG(t,e,s,a){a===void 0&&(a={});const{ancestorScroll:d=!0,ancestorResize:g=!0,elementResize:v=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:E=!1}=a,k=AA(t),O=d||g?[...k?fv(k):[],...fv(e)]:[];O.forEach(J=>{d&&J.addEventListener("scroll",s,{passive:!0}),g&&J.addEventListener("resize",s)});const z=k&&i?kG(k,s):null;let G=-1,U=null;v&&(U=new ResizeObserver(J=>{let[te]=J;te&&te.target===k&&U&&(U.unobserve(e),cancelAnimationFrame(G),G=requestAnimationFrame(()=>{var le;(le=U)==null||le.observe(e)})),s()}),k&&!E&&U.observe(k),U.observe(e));let ie,Q=E?sg(t):null;E&&se();function se(){const J=sg(t);Q&&(J.x!==Q.x||J.y!==Q.y||J.width!==Q.width||J.height!==Q.height)&&s(),Q=J,ie=requestAnimationFrame(se)}return s(),()=>{var J;O.forEach(te=>{d&&te.removeEventListener("scroll",s),g&&te.removeEventListener("resize",s)}),z==null||z(),(J=U)==null||J.disconnect(),U=null,E&&cancelAnimationFrame(ie)}}const DG=dG,NG=fG,OG=cG,zG=mG,FG=uG,B4=lG,BG=pG,jG=(t,e,s)=>{const a=new Map,d={platform:LG,...s},g={...d.platform,_c:a};return aG(t,e,{...d,platform:g})};var Vx=typeof document<"u"?ge.useLayoutEffect:ge.useEffect;function Cb(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let s,a,d;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(s=t.length,s!==e.length)return!1;for(a=s;a--!==0;)if(!Cb(t[a],e[a]))return!1;return!0}if(d=Object.keys(t),s=d.length,s!==Object.keys(e).length)return!1;for(a=s;a--!==0;)if(!{}.hasOwnProperty.call(e,d[a]))return!1;for(a=s;a--!==0;){const g=d[a];if(!(g==="_owner"&&t.$$typeof)&&!Cb(t[g],e[g]))return!1}return!0}return t!==t&&e!==e}function CN(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function j4(t,e){const s=CN(t);return Math.round(e*s)/s}function j5(t){const e=ge.useRef(t);return Vx(()=>{e.current=t}),e}function UG(t){t===void 0&&(t={});const{placement:e="bottom",strategy:s="absolute",middleware:a=[],platform:d,elements:{reference:g,floating:v}={},transform:i=!0,whileElementsMounted:E,open:k}=t,[O,z]=ge.useState({x:0,y:0,strategy:s,placement:e,middlewareData:{},isPositioned:!1}),[G,U]=ge.useState(a);Cb(G,a)||U(a);const[ie,Q]=ge.useState(null),[se,J]=ge.useState(null),te=ge.useCallback(et=>{et!==rt.current&&(rt.current=et,Q(et))},[]),le=ge.useCallback(et=>{et!==xe.current&&(xe.current=et,J(et))},[]),ye=g||ie,Ne=v||se,rt=ge.useRef(null),xe=ge.useRef(null),Me=ge.useRef(O),it=E!=null,ot=j5(E),ve=j5(d),Le=j5(k),dt=ge.useCallback(()=>{if(!rt.current||!xe.current)return;const et={placement:e,strategy:s,middleware:G};ve.current&&(et.platform=ve.current),jG(rt.current,xe.current,et).then(Qe=>{const Xe={...Qe,isPositioned:Le.current!==!1};Je.current&&!Cb(Me.current,Xe)&&(Me.current=Xe,ug.flushSync(()=>{z(Xe)}))})},[G,e,s,ve,Le]);Vx(()=>{k===!1&&Me.current.isPositioned&&(Me.current.isPositioned=!1,z(et=>({...et,isPositioned:!1})))},[k]);const Je=ge.useRef(!1);Vx(()=>(Je.current=!0,()=>{Je.current=!1}),[]),Vx(()=>{if(ye&&(rt.current=ye),Ne&&(xe.current=Ne),ye&&Ne){if(ot.current)return ot.current(ye,Ne,dt);dt()}},[ye,Ne,dt,ot,it]);const yt=ge.useMemo(()=>({reference:rt,floating:xe,setReference:te,setFloating:le}),[te,le]),St=ge.useMemo(()=>({reference:ye,floating:Ne}),[ye,Ne]),jt=ge.useMemo(()=>{const et={position:s,left:0,top:0};if(!St.floating)return et;const Qe=j4(St.floating,O.x),Xe=j4(St.floating,O.y);return i?{...et,transform:"translate("+Qe+"px, "+Xe+"px)",...CN(St.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:Qe,top:Xe}},[s,i,St.floating,O.x,O.y]);return ge.useMemo(()=>({...O,update:dt,refs:yt,elements:St,floatingStyles:jt}),[O,dt,yt,St,jt])}const VG=t=>{function e(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:t,fn(s){const{element:a,padding:d}=typeof t=="function"?t(s):t;return a&&e(a)?a.current!=null?B4({element:a.current,padding:d}).fn(s):{}:a?B4({element:a,padding:d}).fn(s):{}}}},qG=(t,e)=>({...DG(t),options:[t,e]}),$G=(t,e)=>({...NG(t),options:[t,e]}),GG=(t,e)=>({...BG(t),options:[t,e]}),HG=(t,e)=>({...OG(t),options:[t,e]}),WG=(t,e)=>({...zG(t),options:[t,e]}),ZG=(t,e)=>({...FG(t),options:[t,e]}),KG=(t,e)=>({...VG(t),options:[t,e]});var XG="Arrow",PN=ge.forwardRef((t,e)=>{const{children:s,width:a=10,height:d=5,...g}=t;return V.jsx(Zr.svg,{...g,ref:e,width:a,height:d,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?s:V.jsx("polygon",{points:"0,0 30,0 15,10"})})});PN.displayName=XG;var YG=PN;function JG(t,e=[]){let s=[];function a(g,v){const i=ge.createContext(v),E=s.length;s=[...s,v];function k(z){const{scope:G,children:U,...ie}=z,Q=(G==null?void 0:G[t][E])||i,se=ge.useMemo(()=>ie,Object.values(ie));return V.jsx(Q.Provider,{value:se,children:U})}function O(z,G){const U=(G==null?void 0:G[t][E])||i,ie=ge.useContext(U);if(ie)return ie;if(v!==void 0)return v;throw new Error(`\`${z}\` must be used within \`${g}\``)}return k.displayName=g+"Provider",[k,O]}const d=()=>{const g=s.map(v=>ge.createContext(v));return function(i){const E=(i==null?void 0:i[t])||g;return ge.useMemo(()=>({[`__scope${t}`]:{...i,[t]:E}}),[i,E])}};return d.scopeName=t,[a,QG(d,...e)]}function QG(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const a=t.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(g){const v=a.reduce((i,{useScope:E,scopeName:k})=>{const z=E(g)[`__scope${k}`];return{...i,...z}},{});return ge.useMemo(()=>({[`__scope${e.scopeName}`]:v}),[v])}};return s.scopeName=e.scopeName,s}function CA(t){const[e,s]=ge.useState(void 0);return pl(()=>{if(t){s({width:t.offsetWidth,height:t.offsetHeight});const a=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;const g=d[0];let v,i;if("borderBoxSize"in g){const E=g.borderBoxSize,k=Array.isArray(E)?E[0]:E;v=k.inlineSize,i=k.blockSize}else v=t.offsetWidth,i=t.offsetHeight;s({width:v,height:i})});return a.observe(t,{box:"border-box"}),()=>a.unobserve(t)}else s(void 0)},[t]),e}var PA="Popper",[MN,uw]=JG(PA),[eH,IN]=MN(PA),LN=t=>{const{__scopePopper:e,children:s}=t,[a,d]=ge.useState(null);return V.jsx(eH,{scope:e,anchor:a,onAnchorChange:d,children:s})};LN.displayName=PA;var kN="PopperAnchor",RN=ge.forwardRef((t,e)=>{const{__scopePopper:s,virtualRef:a,...d}=t,g=IN(kN,s),v=ge.useRef(null),i=ji(e,v);return ge.useEffect(()=>{g.onAnchorChange((a==null?void 0:a.current)||v.current)}),a?null:V.jsx(Zr.div,{...d,ref:i})});RN.displayName=kN;var MA="PopperContent",[tH,nH]=MN(MA),DN=ge.forwardRef((t,e)=>{var Ct,Wt,Ft,me,dn,Cn;const{__scopePopper:s,side:a="bottom",sideOffset:d=0,align:g="center",alignOffset:v=0,arrowPadding:i=0,avoidCollisions:E=!0,collisionBoundary:k=[],collisionPadding:O=0,sticky:z="partial",hideWhenDetached:G=!1,updatePositionStrategy:U="optimized",onPlaced:ie,...Q}=t,se=IN(MA,s),[J,te]=ge.useState(null),le=ji(e,On=>te(On)),[ye,Ne]=ge.useState(null),rt=CA(ye),xe=(rt==null?void 0:rt.width)??0,Me=(rt==null?void 0:rt.height)??0,it=a+(g!=="center"?"-"+g:""),ot=typeof O=="number"?O:{top:0,right:0,bottom:0,left:0,...O},ve=Array.isArray(k)?k:[k],Le=ve.length>0,dt={padding:ot,boundary:ve.filter(iH),altBoundary:Le},{refs:Je,floatingStyles:yt,placement:St,isPositioned:jt,middlewareData:et}=UG({strategy:"fixed",placement:it,whileElementsMounted:(...On)=>RG(...On,{animationFrame:U==="always"}),elements:{reference:se.anchor},middleware:[qG({mainAxis:d+Me,alignmentAxis:v}),E&&$G({mainAxis:!0,crossAxis:!1,limiter:z==="partial"?GG():void 0,...dt}),E&&HG({...dt}),WG({...dt,apply:({elements:On,rects:$t,availableWidth:cn,availableHeight:_t})=>{const{width:yr,height:En}=$t.reference,bn=On.floating.style;bn.setProperty("--radix-popper-available-width",`${cn}px`),bn.setProperty("--radix-popper-available-height",`${_t}px`),bn.setProperty("--radix-popper-anchor-width",`${yr}px`),bn.setProperty("--radix-popper-anchor-height",`${En}px`)}}),ye&&KG({element:ye,padding:i}),sH({arrowWidth:xe,arrowHeight:Me}),G&&ZG({strategy:"referenceHidden",...dt})]}),[Qe,Xe]=zN(St),Vt=fl(ie);pl(()=>{jt&&(Vt==null||Vt())},[jt,Vt]);const be=(Ct=et.arrow)==null?void 0:Ct.x,Re=(Wt=et.arrow)==null?void 0:Wt.y,Fe=((Ft=et.arrow)==null?void 0:Ft.centerOffset)!==0,[ut,Et]=ge.useState();return pl(()=>{J&&Et(window.getComputedStyle(J).zIndex)},[J]),V.jsx("div",{ref:Je.setFloating,"data-radix-popper-content-wrapper":"",style:{...yt,transform:jt?yt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ut,"--radix-popper-transform-origin":[(me=et.transformOrigin)==null?void 0:me.x,(dn=et.transformOrigin)==null?void 0:dn.y].join(" "),...((Cn=et.hide)==null?void 0:Cn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:V.jsx(tH,{scope:s,placedSide:Qe,onArrowChange:Ne,arrowX:be,arrowY:Re,shouldHideArrow:Fe,children:V.jsx(Zr.div,{"data-side":Qe,"data-align":Xe,...Q,ref:le,style:{...Q.style,animation:jt?void 0:"none"}})})})});DN.displayName=MA;var NN="PopperArrow",rH={top:"bottom",right:"left",bottom:"top",left:"right"},ON=ge.forwardRef(function(e,s){const{__scopePopper:a,...d}=e,g=nH(NN,a),v=rH[g.placedSide];return V.jsx("span",{ref:g.onArrowChange,style:{position:"absolute",left:g.arrowX,top:g.arrowY,[v]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[g.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[g.placedSide],visibility:g.shouldHideArrow?"hidden":void 0},children:V.jsx(YG,{...d,ref:s,style:{...d.style,display:"block"}})})});ON.displayName=NN;function iH(t){return t!==null}var sH=t=>({name:"transformOrigin",options:t,fn(e){var se,J,te;const{placement:s,rects:a,middlewareData:d}=e,v=((se=d.arrow)==null?void 0:se.centerOffset)!==0,i=v?0:t.arrowWidth,E=v?0:t.arrowHeight,[k,O]=zN(s),z={start:"0%",center:"50%",end:"100%"}[O],G=(((J=d.arrow)==null?void 0:J.x)??0)+i/2,U=(((te=d.arrow)==null?void 0:te.y)??0)+E/2;let ie="",Q="";return k==="bottom"?(ie=v?z:`${G}px`,Q=`${-E}px`):k==="top"?(ie=v?z:`${G}px`,Q=`${a.floating.height+E}px`):k==="right"?(ie=`${-E}px`,Q=v?z:`${U}px`):k==="left"&&(ie=`${a.floating.width+E}px`,Q=v?z:`${U}px`),{data:{x:ie,y:Q}}}});function zN(t){const[e,s="center"]=t.split("-");return[e,s]}var FN=LN,BN=RN,jN=DN,UN=ON;function IA(t){const e=ge.useRef({value:t,previous:t});return ge.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var oH=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Zg=new WeakMap,px=new WeakMap,mx={},U5=0,VN=function(t){return t&&(t.host||VN(t.parentNode))},aH=function(t,e){return e.map(function(s){if(t.contains(s))return s;var a=VN(s);return a&&t.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",t,". Doing nothing"),null)}).filter(function(s){return!!s})},lH=function(t,e,s,a){var d=aH(e,Array.isArray(t)?t:[t]);mx[s]||(mx[s]=new WeakMap);var g=mx[s],v=[],i=new Set,E=new Set(d),k=function(z){!z||i.has(z)||(i.add(z),k(z.parentNode))};d.forEach(k);var O=function(z){!z||E.has(z)||Array.prototype.forEach.call(z.children,function(G){if(i.has(G))O(G);else try{var U=G.getAttribute(a),ie=U!==null&&U!=="false",Q=(Zg.get(G)||0)+1,se=(g.get(G)||0)+1;Zg.set(G,Q),g.set(G,se),v.push(G),Q===1&&ie&&px.set(G,!0),se===1&&G.setAttribute(s,"true"),ie||G.setAttribute(a,"true")}catch(J){console.error("aria-hidden: cannot operate on ",G,J)}})};return O(e),i.clear(),U5++,function(){v.forEach(function(z){var G=Zg.get(z)-1,U=g.get(z)-1;Zg.set(z,G),g.set(z,U),G||(px.has(z)||z.removeAttribute(a),px.delete(z)),U||z.removeAttribute(s)}),U5--,U5||(Zg=new WeakMap,Zg=new WeakMap,px=new WeakMap,mx={})}},LA=function(t,e,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(t)?t:[t]),d=oH(t);return d?(a.push.apply(a,Array.from(d.querySelectorAll("[aria-live]"))),lH(a,d,s,"aria-hidden")):function(){return null}},ed=function(){return ed=Object.assign||function(e){for(var s,a=1,d=arguments.length;a<d;a++){s=arguments[a];for(var g in s)Object.prototype.hasOwnProperty.call(s,g)&&(e[g]=s[g])}return e},ed.apply(this,arguments)};function qN(t,e){var s={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(t);d<a.length;d++)e.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(t,a[d])&&(s[a[d]]=t[a[d]]);return s}function cH(t,e,s){if(s||arguments.length===2)for(var a=0,d=e.length,g;a<d;a++)(g||!(a in e))&&(g||(g=Array.prototype.slice.call(e,0,a)),g[a]=e[a]);return t.concat(g||Array.prototype.slice.call(e))}var qx="right-scroll-bar-position",$x="width-before-scroll-bar",uH="with-scroll-bars-hidden",hH="--removed-body-scroll-bar-size";function V5(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function dH(t,e){var s=ge.useState(function(){return{value:t,callback:e,facade:{get current(){return s.value},set current(a){var d=s.value;d!==a&&(s.value=a,s.callback(a,d))}}}})[0];return s.callback=e,s.facade}var fH=typeof window<"u"?ge.useLayoutEffect:ge.useEffect,U4=new WeakMap;function pH(t,e){var s=dH(null,function(a){return t.forEach(function(d){return V5(d,a)})});return fH(function(){var a=U4.get(s);if(a){var d=new Set(a),g=new Set(t),v=s.current;d.forEach(function(i){g.has(i)||V5(i,null)}),g.forEach(function(i){d.has(i)||V5(i,v)})}U4.set(s,t)},[t]),s}function mH(t){return t}function gH(t,e){e===void 0&&(e=mH);var s=[],a=!1,d={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:t},useMedium:function(g){var v=e(g,a);return s.push(v),function(){s=s.filter(function(i){return i!==v})}},assignSyncMedium:function(g){for(a=!0;s.length;){var v=s;s=[],v.forEach(g)}s={push:function(i){return g(i)},filter:function(){return s}}},assignMedium:function(g){a=!0;var v=[];if(s.length){var i=s;s=[],i.forEach(g),v=s}var E=function(){var O=v;v=[],O.forEach(g)},k=function(){return Promise.resolve().then(E)};k(),s={push:function(O){v.push(O),k()},filter:function(O){return v=v.filter(O),s}}}};return d}function _H(t){t===void 0&&(t={});var e=gH(null);return e.options=ed({async:!0,ssr:!1},t),e}var $N=function(t){var e=t.sideCar,s=qN(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=e.read();if(!a)throw new Error("Sidecar medium not found");return ge.createElement(a,ed({},s))};$N.isSideCarExport=!0;function yH(t,e){return t.useMedium(e),$N}var GN=_H(),q5=function(){},hw=ge.forwardRef(function(t,e){var s=ge.useRef(null),a=ge.useState({onScrollCapture:q5,onWheelCapture:q5,onTouchMoveCapture:q5}),d=a[0],g=a[1],v=t.forwardProps,i=t.children,E=t.className,k=t.removeScrollBar,O=t.enabled,z=t.shards,G=t.sideCar,U=t.noIsolation,ie=t.inert,Q=t.allowPinchZoom,se=t.as,J=se===void 0?"div":se,te=t.gapMode,le=qN(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ye=G,Ne=pH([s,e]),rt=ed(ed({},le),d);return ge.createElement(ge.Fragment,null,O&&ge.createElement(ye,{sideCar:GN,removeScrollBar:k,shards:z,noIsolation:U,inert:ie,setCallbacks:g,allowPinchZoom:!!Q,lockRef:s,gapMode:te}),v?ge.cloneElement(ge.Children.only(i),ed(ed({},rt),{ref:Ne})):ge.createElement(J,ed({},rt,{className:E,ref:Ne}),i))});hw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};hw.classNames={fullWidth:$x,zeroRight:qx};var vH=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xH(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=vH();return e&&t.setAttribute("nonce",e),t}function bH(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function wH(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var SH=function(){var t=0,e=null;return{add:function(s){t==0&&(e=xH())&&(bH(e,s),wH(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},TH=function(){var t=SH();return function(e,s){ge.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&s])}},HN=function(){var t=TH(),e=function(s){var a=s.styles,d=s.dynamic;return t(a,d),null};return e},AH={left:0,top:0,right:0,gap:0},$5=function(t){return parseInt(t||"",10)||0},EH=function(t){var e=window.getComputedStyle(document.body),s=e[t==="padding"?"paddingLeft":"marginLeft"],a=e[t==="padding"?"paddingTop":"marginTop"],d=e[t==="padding"?"paddingRight":"marginRight"];return[$5(s),$5(a),$5(d)]},CH=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return AH;var e=EH(t),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,a-s+e[2]-e[0])}},PH=HN(),P_="data-scroll-locked",MH=function(t,e,s,a){var d=t.left,g=t.top,v=t.right,i=t.gap;return s===void 0&&(s="margin"),`
  .`.concat(uH,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(i,"px ").concat(a,`;
  }
  body[`).concat(P_,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(d,`px;
    padding-top: `).concat(g,`px;
    padding-right: `).concat(v,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(i,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(qx,` {
    right: `).concat(i,"px ").concat(a,`;
  }
  
  .`).concat($x,` {
    margin-right: `).concat(i,"px ").concat(a,`;
  }
  
  .`).concat(qx," .").concat(qx,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat($x," .").concat($x,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(P_,`] {
    `).concat(hH,": ").concat(i,`px;
  }
`)},V4=function(){var t=parseInt(document.body.getAttribute(P_)||"0",10);return isFinite(t)?t:0},IH=function(){ge.useEffect(function(){return document.body.setAttribute(P_,(V4()+1).toString()),function(){var t=V4()-1;t<=0?document.body.removeAttribute(P_):document.body.setAttribute(P_,t.toString())}},[])},LH=function(t){var e=t.noRelative,s=t.noImportant,a=t.gapMode,d=a===void 0?"margin":a;IH();var g=ge.useMemo(function(){return CH(d)},[d]);return ge.createElement(PH,{styles:MH(g,!e,d,s?"":"!important")})},CT=!1;if(typeof window<"u")try{var gx=Object.defineProperty({},"passive",{get:function(){return CT=!0,!0}});window.addEventListener("test",gx,gx),window.removeEventListener("test",gx,gx)}catch{CT=!1}var Kg=CT?{passive:!1}:!1,kH=function(t){return t.tagName==="TEXTAREA"},WN=function(t,e){if(!(t instanceof Element))return!1;var s=window.getComputedStyle(t);return s[e]!=="hidden"&&!(s.overflowY===s.overflowX&&!kH(t)&&s[e]==="visible")},RH=function(t){return WN(t,"overflowY")},DH=function(t){return WN(t,"overflowX")},q4=function(t,e){var s=e.ownerDocument,a=e;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var d=ZN(t,a);if(d){var g=KN(t,a),v=g[1],i=g[2];if(v>i)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},NH=function(t){var e=t.scrollTop,s=t.scrollHeight,a=t.clientHeight;return[e,s,a]},OH=function(t){var e=t.scrollLeft,s=t.scrollWidth,a=t.clientWidth;return[e,s,a]},ZN=function(t,e){return t==="v"?RH(e):DH(e)},KN=function(t,e){return t==="v"?NH(e):OH(e)},zH=function(t,e){return t==="h"&&e==="rtl"?-1:1},FH=function(t,e,s,a,d){var g=zH(t,window.getComputedStyle(e).direction),v=g*a,i=s.target,E=e.contains(i),k=!1,O=v>0,z=0,G=0;do{var U=KN(t,i),ie=U[0],Q=U[1],se=U[2],J=Q-se-g*ie;(ie||J)&&ZN(t,i)&&(z+=J,G+=ie),i instanceof ShadowRoot?i=i.host:i=i.parentNode}while(!E&&i!==document.body||E&&(e.contains(i)||e===i));return(O&&(Math.abs(z)<1||!d)||!O&&(Math.abs(G)<1||!d))&&(k=!0),k},_x=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},$4=function(t){return[t.deltaX,t.deltaY]},G4=function(t){return t&&"current"in t?t.current:t},BH=function(t,e){return t[0]===e[0]&&t[1]===e[1]},jH=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},UH=0,Xg=[];function VH(t){var e=ge.useRef([]),s=ge.useRef([0,0]),a=ge.useRef(),d=ge.useState(UH++)[0],g=ge.useState(HN)[0],v=ge.useRef(t);ge.useEffect(function(){v.current=t},[t]),ge.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(d));var Q=cH([t.lockRef.current],(t.shards||[]).map(G4),!0).filter(Boolean);return Q.forEach(function(se){return se.classList.add("allow-interactivity-".concat(d))}),function(){document.body.classList.remove("block-interactivity-".concat(d)),Q.forEach(function(se){return se.classList.remove("allow-interactivity-".concat(d))})}}},[t.inert,t.lockRef.current,t.shards]);var i=ge.useCallback(function(Q,se){if("touches"in Q&&Q.touches.length===2||Q.type==="wheel"&&Q.ctrlKey)return!v.current.allowPinchZoom;var J=_x(Q),te=s.current,le="deltaX"in Q?Q.deltaX:te[0]-J[0],ye="deltaY"in Q?Q.deltaY:te[1]-J[1],Ne,rt=Q.target,xe=Math.abs(le)>Math.abs(ye)?"h":"v";if("touches"in Q&&xe==="h"&&rt.type==="range")return!1;var Me=q4(xe,rt);if(!Me)return!0;if(Me?Ne=xe:(Ne=xe==="v"?"h":"v",Me=q4(xe,rt)),!Me)return!1;if(!a.current&&"changedTouches"in Q&&(le||ye)&&(a.current=Ne),!Ne)return!0;var it=a.current||Ne;return FH(it,se,Q,it==="h"?le:ye,!0)},[]),E=ge.useCallback(function(Q){var se=Q;if(!(!Xg.length||Xg[Xg.length-1]!==g)){var J="deltaY"in se?$4(se):_x(se),te=e.current.filter(function(Ne){return Ne.name===se.type&&(Ne.target===se.target||se.target===Ne.shadowParent)&&BH(Ne.delta,J)})[0];if(te&&te.should){se.cancelable&&se.preventDefault();return}if(!te){var le=(v.current.shards||[]).map(G4).filter(Boolean).filter(function(Ne){return Ne.contains(se.target)}),ye=le.length>0?i(se,le[0]):!v.current.noIsolation;ye&&se.cancelable&&se.preventDefault()}}},[]),k=ge.useCallback(function(Q,se,J,te){var le={name:Q,delta:se,target:J,should:te,shadowParent:qH(J)};e.current.push(le),setTimeout(function(){e.current=e.current.filter(function(ye){return ye!==le})},1)},[]),O=ge.useCallback(function(Q){s.current=_x(Q),a.current=void 0},[]),z=ge.useCallback(function(Q){k(Q.type,$4(Q),Q.target,i(Q,t.lockRef.current))},[]),G=ge.useCallback(function(Q){k(Q.type,_x(Q),Q.target,i(Q,t.lockRef.current))},[]);ge.useEffect(function(){return Xg.push(g),t.setCallbacks({onScrollCapture:z,onWheelCapture:z,onTouchMoveCapture:G}),document.addEventListener("wheel",E,Kg),document.addEventListener("touchmove",E,Kg),document.addEventListener("touchstart",O,Kg),function(){Xg=Xg.filter(function(Q){return Q!==g}),document.removeEventListener("wheel",E,Kg),document.removeEventListener("touchmove",E,Kg),document.removeEventListener("touchstart",O,Kg)}},[]);var U=t.removeScrollBar,ie=t.inert;return ge.createElement(ge.Fragment,null,ie?ge.createElement(g,{styles:jH(d)}):null,U?ge.createElement(LH,{gapMode:t.gapMode}):null)}function qH(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const $H=yH(GN,VH);var dw=ge.forwardRef(function(t,e){return ge.createElement(hw,ed({},t,{ref:e,sideCar:$H}))});dw.classNames=hw.classNames;var GH=[" ","Enter","ArrowUp","ArrowDown"],HH=[" ","Enter"],Nv="Select",[fw,pw,WH]=Iv(Nv),[d0,ZQ]=Vp(Nv,[WH,uw]),mw=uw(),[ZH,qp]=d0(Nv),[KH,XH]=d0(Nv),XN=t=>{const{__scopeSelect:e,children:s,open:a,defaultOpen:d,onOpenChange:g,value:v,defaultValue:i,onValueChange:E,dir:k,name:O,autoComplete:z,disabled:G,required:U,form:ie}=t,Q=mw(e),[se,J]=ge.useState(null),[te,le]=ge.useState(null),[ye,Ne]=ge.useState(!1),rt=Rv(k),[xe=!1,Me]=hf({prop:a,defaultProp:d,onChange:g}),[it,ot]=hf({prop:v,defaultProp:i,onChange:E}),ve=ge.useRef(null),Le=se?ie||!!se.closest("form"):!0,[dt,Je]=ge.useState(new Set),yt=Array.from(dt).map(St=>St.props.value).join(";");return V.jsx(FN,{...Q,children:V.jsxs(ZH,{required:U,scope:e,trigger:se,onTriggerChange:J,valueNode:te,onValueNodeChange:le,valueNodeHasChildren:ye,onValueNodeHasChildrenChange:Ne,contentId:id(),value:it,onValueChange:ot,open:xe,onOpenChange:Me,dir:rt,triggerPointerDownPosRef:ve,disabled:G,children:[V.jsx(fw.Provider,{scope:e,children:V.jsx(KH,{scope:t.__scopeSelect,onNativeOptionAdd:ge.useCallback(St=>{Je(jt=>new Set(jt).add(St))},[]),onNativeOptionRemove:ge.useCallback(St=>{Je(jt=>{const et=new Set(jt);return et.delete(St),et})},[]),children:s})}),Le?V.jsxs(bO,{"aria-hidden":!0,required:U,tabIndex:-1,name:O,autoComplete:z,value:it,onChange:St=>ot(St.target.value),disabled:G,form:ie,children:[it===void 0?V.jsx("option",{value:""}):null,Array.from(dt)]},yt):null]})})};XN.displayName=Nv;var YN="SelectTrigger",JN=ge.forwardRef((t,e)=>{const{__scopeSelect:s,disabled:a=!1,...d}=t,g=mw(s),v=qp(YN,s),i=v.disabled||a,E=ji(e,v.onTriggerChange),k=pw(s),O=ge.useRef("touch"),[z,G,U]=wO(Q=>{const se=k().filter(le=>!le.disabled),J=se.find(le=>le.value===v.value),te=SO(se,Q,J);te!==void 0&&v.onValueChange(te.value)}),ie=Q=>{i||(v.onOpenChange(!0),U()),Q&&(v.triggerPointerDownPosRef.current={x:Math.round(Q.pageX),y:Math.round(Q.pageY)})};return V.jsx(BN,{asChild:!0,...g,children:V.jsx(Zr.button,{type:"button",role:"combobox","aria-controls":v.contentId,"aria-expanded":v.open,"aria-required":v.required,"aria-autocomplete":"none",dir:v.dir,"data-state":v.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":xO(v.value)?"":void 0,...d,ref:E,onClick:nr(d.onClick,Q=>{Q.currentTarget.focus(),O.current!=="mouse"&&ie(Q)}),onPointerDown:nr(d.onPointerDown,Q=>{O.current=Q.pointerType;const se=Q.target;se.hasPointerCapture(Q.pointerId)&&se.releasePointerCapture(Q.pointerId),Q.button===0&&Q.ctrlKey===!1&&Q.pointerType==="mouse"&&(ie(Q),Q.preventDefault())}),onKeyDown:nr(d.onKeyDown,Q=>{const se=z.current!=="";!(Q.ctrlKey||Q.altKey||Q.metaKey)&&Q.key.length===1&&G(Q.key),!(se&&Q.key===" ")&&GH.includes(Q.key)&&(ie(),Q.preventDefault())})})})});JN.displayName=YN;var QN="SelectValue",eO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,className:a,style:d,children:g,placeholder:v="",...i}=t,E=qp(QN,s),{onValueNodeHasChildrenChange:k}=E,O=g!==void 0,z=ji(e,E.onValueNodeChange);return pl(()=>{k(O)},[k,O]),V.jsx(Zr.span,{...i,ref:z,style:{pointerEvents:"none"},children:xO(E.value)?V.jsx(V.Fragment,{children:v}):g})});eO.displayName=QN;var YH="SelectIcon",tO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,children:a,...d}=t;return V.jsx(Zr.span,{"aria-hidden":!0,...d,ref:e,children:a||"▼"})});tO.displayName=YH;var JH="SelectPortal",nO=t=>V.jsx(kv,{asChild:!0,...t});nO.displayName=JH;var og="SelectContent",rO=ge.forwardRef((t,e)=>{const s=qp(og,t.__scopeSelect),[a,d]=ge.useState();if(pl(()=>{d(new DocumentFragment)},[]),!s.open){const g=a;return g?ug.createPortal(V.jsx(iO,{scope:t.__scopeSelect,children:V.jsx(fw.Slot,{scope:t.__scopeSelect,children:V.jsx("div",{children:t.children})})}),g):null}return V.jsx(sO,{...t,ref:e})});rO.displayName=og;var nh=10,[iO,$p]=d0(og),QH="SelectContentImpl",sO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,position:a="item-aligned",onCloseAutoFocus:d,onEscapeKeyDown:g,onPointerDownOutside:v,side:i,sideOffset:E,align:k,alignOffset:O,arrowPadding:z,collisionBoundary:G,collisionPadding:U,sticky:ie,hideWhenDetached:Q,avoidCollisions:se,...J}=t,te=qp(og,s),[le,ye]=ge.useState(null),[Ne,rt]=ge.useState(null),xe=ji(e,Ct=>ye(Ct)),[Me,it]=ge.useState(null),[ot,ve]=ge.useState(null),Le=pw(s),[dt,Je]=ge.useState(!1),yt=ge.useRef(!1);ge.useEffect(()=>{if(le)return LA(le)},[le]),vA();const St=ge.useCallback(Ct=>{const[Wt,...Ft]=Le().map(Cn=>Cn.ref.current),[me]=Ft.slice(-1),dn=document.activeElement;for(const Cn of Ct)if(Cn===dn||(Cn==null||Cn.scrollIntoView({block:"nearest"}),Cn===Wt&&Ne&&(Ne.scrollTop=0),Cn===me&&Ne&&(Ne.scrollTop=Ne.scrollHeight),Cn==null||Cn.focus(),document.activeElement!==dn))return},[Le,Ne]),jt=ge.useCallback(()=>St([Me,le]),[St,Me,le]);ge.useEffect(()=>{dt&&jt()},[dt,jt]);const{onOpenChange:et,triggerPointerDownPosRef:Qe}=te;ge.useEffect(()=>{if(le){let Ct={x:0,y:0};const Wt=me=>{var dn,Cn;Ct={x:Math.abs(Math.round(me.pageX)-(((dn=Qe.current)==null?void 0:dn.x)??0)),y:Math.abs(Math.round(me.pageY)-(((Cn=Qe.current)==null?void 0:Cn.y)??0))}},Ft=me=>{Ct.x<=10&&Ct.y<=10?me.preventDefault():le.contains(me.target)||et(!1),document.removeEventListener("pointermove",Wt),Qe.current=null};return Qe.current!==null&&(document.addEventListener("pointermove",Wt),document.addEventListener("pointerup",Ft,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Wt),document.removeEventListener("pointerup",Ft,{capture:!0})}}},[le,et,Qe]),ge.useEffect(()=>{const Ct=()=>et(!1);return window.addEventListener("blur",Ct),window.addEventListener("resize",Ct),()=>{window.removeEventListener("blur",Ct),window.removeEventListener("resize",Ct)}},[et]);const[Xe,Vt]=wO(Ct=>{const Wt=Le().filter(dn=>!dn.disabled),Ft=Wt.find(dn=>dn.ref.current===document.activeElement),me=SO(Wt,Ct,Ft);me&&setTimeout(()=>me.ref.current.focus())}),be=ge.useCallback((Ct,Wt,Ft)=>{const me=!yt.current&&!Ft;(te.value!==void 0&&te.value===Wt||me)&&(it(Ct),me&&(yt.current=!0))},[te.value]),Re=ge.useCallback(()=>le==null?void 0:le.focus(),[le]),Fe=ge.useCallback((Ct,Wt,Ft)=>{const me=!yt.current&&!Ft;(te.value!==void 0&&te.value===Wt||me)&&ve(Ct)},[te.value]),ut=a==="popper"?PT:oO,Et=ut===PT?{side:i,sideOffset:E,align:k,alignOffset:O,arrowPadding:z,collisionBoundary:G,collisionPadding:U,sticky:ie,hideWhenDetached:Q,avoidCollisions:se}:{};return V.jsx(iO,{scope:s,content:le,viewport:Ne,onViewportChange:rt,itemRefCallback:be,selectedItem:Me,onItemLeave:Re,itemTextRefCallback:Fe,focusSelectedItem:jt,selectedItemText:ot,position:a,isPositioned:dt,searchRef:Xe,children:V.jsx(dw,{as:kp,allowPinchZoom:!0,children:V.jsx(ow,{asChild:!0,trapped:te.open,onMountAutoFocus:Ct=>{Ct.preventDefault()},onUnmountAutoFocus:nr(d,Ct=>{var Wt;(Wt=te.trigger)==null||Wt.focus({preventScroll:!0}),Ct.preventDefault()}),children:V.jsx(Lv,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:g,onPointerDownOutside:v,onFocusOutside:Ct=>Ct.preventDefault(),onDismiss:()=>te.onOpenChange(!1),children:V.jsx(ut,{role:"listbox",id:te.contentId,"data-state":te.open?"open":"closed",dir:te.dir,onContextMenu:Ct=>Ct.preventDefault(),...J,...Et,onPlaced:()=>Je(!0),ref:xe,style:{display:"flex",flexDirection:"column",outline:"none",...J.style},onKeyDown:nr(J.onKeyDown,Ct=>{const Wt=Ct.ctrlKey||Ct.altKey||Ct.metaKey;if(Ct.key==="Tab"&&Ct.preventDefault(),!Wt&&Ct.key.length===1&&Vt(Ct.key),["ArrowUp","ArrowDown","Home","End"].includes(Ct.key)){let me=Le().filter(dn=>!dn.disabled).map(dn=>dn.ref.current);if(["ArrowUp","End"].includes(Ct.key)&&(me=me.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ct.key)){const dn=Ct.target,Cn=me.indexOf(dn);me=me.slice(Cn+1)}setTimeout(()=>St(me)),Ct.preventDefault()}})})})})})})});sO.displayName=QH;var eW="SelectItemAlignedPosition",oO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,onPlaced:a,...d}=t,g=qp(og,s),v=$p(og,s),[i,E]=ge.useState(null),[k,O]=ge.useState(null),z=ji(e,xe=>O(xe)),G=pw(s),U=ge.useRef(!1),ie=ge.useRef(!0),{viewport:Q,selectedItem:se,selectedItemText:J,focusSelectedItem:te}=v,le=ge.useCallback(()=>{if(g.trigger&&g.valueNode&&i&&k&&Q&&se&&J){const xe=g.trigger.getBoundingClientRect(),Me=k.getBoundingClientRect(),it=g.valueNode.getBoundingClientRect(),ot=J.getBoundingClientRect();if(g.dir!=="rtl"){const dn=ot.left-Me.left,Cn=it.left-dn,On=xe.left-Cn,$t=xe.width+On,cn=Math.max($t,Me.width),_t=window.innerWidth-nh,yr=Sb(Cn,[nh,Math.max(nh,_t-cn)]);i.style.minWidth=$t+"px",i.style.left=yr+"px"}else{const dn=Me.right-ot.right,Cn=window.innerWidth-it.right-dn,On=window.innerWidth-xe.right-Cn,$t=xe.width+On,cn=Math.max($t,Me.width),_t=window.innerWidth-nh,yr=Sb(Cn,[nh,Math.max(nh,_t-cn)]);i.style.minWidth=$t+"px",i.style.right=yr+"px"}const ve=G(),Le=window.innerHeight-nh*2,dt=Q.scrollHeight,Je=window.getComputedStyle(k),yt=parseInt(Je.borderTopWidth,10),St=parseInt(Je.paddingTop,10),jt=parseInt(Je.borderBottomWidth,10),et=parseInt(Je.paddingBottom,10),Qe=yt+St+dt+et+jt,Xe=Math.min(se.offsetHeight*5,Qe),Vt=window.getComputedStyle(Q),be=parseInt(Vt.paddingTop,10),Re=parseInt(Vt.paddingBottom,10),Fe=xe.top+xe.height/2-nh,ut=Le-Fe,Et=se.offsetHeight/2,Ct=se.offsetTop+Et,Wt=yt+St+Ct,Ft=Qe-Wt;if(Wt<=Fe){const dn=ve.length>0&&se===ve[ve.length-1].ref.current;i.style.bottom="0px";const Cn=k.clientHeight-Q.offsetTop-Q.offsetHeight,On=Math.max(ut,Et+(dn?Re:0)+Cn+jt),$t=Wt+On;i.style.height=$t+"px"}else{const dn=ve.length>0&&se===ve[0].ref.current;i.style.top="0px";const On=Math.max(Fe,yt+Q.offsetTop+(dn?be:0)+Et)+Ft;i.style.height=On+"px",Q.scrollTop=Wt-Fe+Q.offsetTop}i.style.margin=`${nh}px 0`,i.style.minHeight=Xe+"px",i.style.maxHeight=Le+"px",a==null||a(),requestAnimationFrame(()=>U.current=!0)}},[G,g.trigger,g.valueNode,i,k,Q,se,J,g.dir,a]);pl(()=>le(),[le]);const[ye,Ne]=ge.useState();pl(()=>{k&&Ne(window.getComputedStyle(k).zIndex)},[k]);const rt=ge.useCallback(xe=>{xe&&ie.current===!0&&(le(),te==null||te(),ie.current=!1)},[le,te]);return V.jsx(nW,{scope:s,contentWrapper:i,shouldExpandOnScrollRef:U,onScrollButtonChange:rt,children:V.jsx("div",{ref:E,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ye},children:V.jsx(Zr.div,{...d,ref:z,style:{boxSizing:"border-box",maxHeight:"100%",...d.style}})})})});oO.displayName=eW;var tW="SelectPopperPosition",PT=ge.forwardRef((t,e)=>{const{__scopeSelect:s,align:a="start",collisionPadding:d=nh,...g}=t,v=mw(s);return V.jsx(jN,{...v,...g,ref:e,align:a,collisionPadding:d,style:{boxSizing:"border-box",...g.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});PT.displayName=tW;var[nW,kA]=d0(og,{}),MT="SelectViewport",aO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,nonce:a,...d}=t,g=$p(MT,s),v=kA(MT,s),i=ji(e,g.onViewportChange),E=ge.useRef(0);return V.jsxs(V.Fragment,{children:[V.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),V.jsx(fw.Slot,{scope:s,children:V.jsx(Zr.div,{"data-radix-select-viewport":"",role:"presentation",...d,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...d.style},onScroll:nr(d.onScroll,k=>{const O=k.currentTarget,{contentWrapper:z,shouldExpandOnScrollRef:G}=v;if(G!=null&&G.current&&z){const U=Math.abs(E.current-O.scrollTop);if(U>0){const ie=window.innerHeight-nh*2,Q=parseFloat(z.style.minHeight),se=parseFloat(z.style.height),J=Math.max(Q,se);if(J<ie){const te=J+U,le=Math.min(ie,te),ye=te-le;z.style.height=le+"px",z.style.bottom==="0px"&&(O.scrollTop=ye>0?ye:0,z.style.justifyContent="flex-end")}}}E.current=O.scrollTop})})})]})});aO.displayName=MT;var lO="SelectGroup",[rW,iW]=d0(lO),sW=ge.forwardRef((t,e)=>{const{__scopeSelect:s,...a}=t,d=id();return V.jsx(rW,{scope:s,id:d,children:V.jsx(Zr.div,{role:"group","aria-labelledby":d,...a,ref:e})})});sW.displayName=lO;var cO="SelectLabel",uO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,...a}=t,d=iW(cO,s);return V.jsx(Zr.div,{id:d.id,...a,ref:e})});uO.displayName=cO;var Pb="SelectItem",[oW,hO]=d0(Pb),dO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,value:a,disabled:d=!1,textValue:g,...v}=t,i=qp(Pb,s),E=$p(Pb,s),k=i.value===a,[O,z]=ge.useState(g??""),[G,U]=ge.useState(!1),ie=ji(e,te=>{var le;return(le=E.itemRefCallback)==null?void 0:le.call(E,te,a,d)}),Q=id(),se=ge.useRef("touch"),J=()=>{d||(i.onValueChange(a),i.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return V.jsx(oW,{scope:s,value:a,disabled:d,textId:Q,isSelected:k,onItemTextChange:ge.useCallback(te=>{z(le=>le||((te==null?void 0:te.textContent)??"").trim())},[]),children:V.jsx(fw.ItemSlot,{scope:s,value:a,disabled:d,textValue:O,children:V.jsx(Zr.div,{role:"option","aria-labelledby":Q,"data-highlighted":G?"":void 0,"aria-selected":k&&G,"data-state":k?"checked":"unchecked","aria-disabled":d||void 0,"data-disabled":d?"":void 0,tabIndex:d?void 0:-1,...v,ref:ie,onFocus:nr(v.onFocus,()=>U(!0)),onBlur:nr(v.onBlur,()=>U(!1)),onClick:nr(v.onClick,()=>{se.current!=="mouse"&&J()}),onPointerUp:nr(v.onPointerUp,()=>{se.current==="mouse"&&J()}),onPointerDown:nr(v.onPointerDown,te=>{se.current=te.pointerType}),onPointerMove:nr(v.onPointerMove,te=>{var le;se.current=te.pointerType,d?(le=E.onItemLeave)==null||le.call(E):se.current==="mouse"&&te.currentTarget.focus({preventScroll:!0})}),onPointerLeave:nr(v.onPointerLeave,te=>{var le;te.currentTarget===document.activeElement&&((le=E.onItemLeave)==null||le.call(E))}),onKeyDown:nr(v.onKeyDown,te=>{var ye;((ye=E.searchRef)==null?void 0:ye.current)!==""&&te.key===" "||(HH.includes(te.key)&&J(),te.key===" "&&te.preventDefault())})})})})});dO.displayName=Pb;var My="SelectItemText",fO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,className:a,style:d,...g}=t,v=qp(My,s),i=$p(My,s),E=hO(My,s),k=XH(My,s),[O,z]=ge.useState(null),G=ji(e,J=>z(J),E.onItemTextChange,J=>{var te;return(te=i.itemTextRefCallback)==null?void 0:te.call(i,J,E.value,E.disabled)}),U=O==null?void 0:O.textContent,ie=ge.useMemo(()=>V.jsx("option",{value:E.value,disabled:E.disabled,children:U},E.value),[E.disabled,E.value,U]),{onNativeOptionAdd:Q,onNativeOptionRemove:se}=k;return pl(()=>(Q(ie),()=>se(ie)),[Q,se,ie]),V.jsxs(V.Fragment,{children:[V.jsx(Zr.span,{id:E.textId,...g,ref:G}),E.isSelected&&v.valueNode&&!v.valueNodeHasChildren?ug.createPortal(g.children,v.valueNode):null]})});fO.displayName=My;var pO="SelectItemIndicator",mO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,...a}=t;return hO(pO,s).isSelected?V.jsx(Zr.span,{"aria-hidden":!0,...a,ref:e}):null});mO.displayName=pO;var IT="SelectScrollUpButton",gO=ge.forwardRef((t,e)=>{const s=$p(IT,t.__scopeSelect),a=kA(IT,t.__scopeSelect),[d,g]=ge.useState(!1),v=ji(e,a.onScrollButtonChange);return pl(()=>{if(s.viewport&&s.isPositioned){let i=function(){const k=E.scrollTop>0;g(k)};const E=s.viewport;return i(),E.addEventListener("scroll",i),()=>E.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),d?V.jsx(yO,{...t,ref:v,onAutoScroll:()=>{const{viewport:i,selectedItem:E}=s;i&&E&&(i.scrollTop=i.scrollTop-E.offsetHeight)}}):null});gO.displayName=IT;var LT="SelectScrollDownButton",_O=ge.forwardRef((t,e)=>{const s=$p(LT,t.__scopeSelect),a=kA(LT,t.__scopeSelect),[d,g]=ge.useState(!1),v=ji(e,a.onScrollButtonChange);return pl(()=>{if(s.viewport&&s.isPositioned){let i=function(){const k=E.scrollHeight-E.clientHeight,O=Math.ceil(E.scrollTop)<k;g(O)};const E=s.viewport;return i(),E.addEventListener("scroll",i),()=>E.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),d?V.jsx(yO,{...t,ref:v,onAutoScroll:()=>{const{viewport:i,selectedItem:E}=s;i&&E&&(i.scrollTop=i.scrollTop+E.offsetHeight)}}):null});_O.displayName=LT;var yO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,onAutoScroll:a,...d}=t,g=$p("SelectScrollButton",s),v=ge.useRef(null),i=pw(s),E=ge.useCallback(()=>{v.current!==null&&(window.clearInterval(v.current),v.current=null)},[]);return ge.useEffect(()=>()=>E(),[E]),pl(()=>{var O;const k=i().find(z=>z.ref.current===document.activeElement);(O=k==null?void 0:k.ref.current)==null||O.scrollIntoView({block:"nearest"})},[i]),V.jsx(Zr.div,{"aria-hidden":!0,...d,ref:e,style:{flexShrink:0,...d.style},onPointerDown:nr(d.onPointerDown,()=>{v.current===null&&(v.current=window.setInterval(a,50))}),onPointerMove:nr(d.onPointerMove,()=>{var k;(k=g.onItemLeave)==null||k.call(g),v.current===null&&(v.current=window.setInterval(a,50))}),onPointerLeave:nr(d.onPointerLeave,()=>{E()})})}),aW="SelectSeparator",vO=ge.forwardRef((t,e)=>{const{__scopeSelect:s,...a}=t;return V.jsx(Zr.div,{"aria-hidden":!0,...a,ref:e})});vO.displayName=aW;var kT="SelectArrow",lW=ge.forwardRef((t,e)=>{const{__scopeSelect:s,...a}=t,d=mw(s),g=qp(kT,s),v=$p(kT,s);return g.open&&v.position==="popper"?V.jsx(UN,{...d,...a,ref:e}):null});lW.displayName=kT;function xO(t){return t===""||t===void 0}var bO=ge.forwardRef((t,e)=>{const{value:s,...a}=t,d=ge.useRef(null),g=ji(e,d),v=IA(s);return ge.useEffect(()=>{const i=d.current,E=window.HTMLSelectElement.prototype,O=Object.getOwnPropertyDescriptor(E,"value").set;if(v!==s&&O){const z=new Event("change",{bubbles:!0});O.call(i,s),i.dispatchEvent(z)}},[v,s]),V.jsx(rw,{asChild:!0,children:V.jsx("select",{...a,ref:g,defaultValue:s})})});bO.displayName="BubbleSelect";function wO(t){const e=fl(t),s=ge.useRef(""),a=ge.useRef(0),d=ge.useCallback(v=>{const i=s.current+v;e(i),function E(k){s.current=k,window.clearTimeout(a.current),k!==""&&(a.current=window.setTimeout(()=>E(""),1e3))}(i)},[e]),g=ge.useCallback(()=>{s.current="",window.clearTimeout(a.current)},[]);return ge.useEffect(()=>()=>window.clearTimeout(a.current),[]),[s,d,g]}function SO(t,e,s){const d=e.length>1&&Array.from(e).every(k=>k===e[0])?e[0]:e,g=s?t.indexOf(s):-1;let v=cW(t,Math.max(g,0));d.length===1&&(v=v.filter(k=>k!==s));const E=v.find(k=>k.textValue.toLowerCase().startsWith(d.toLowerCase()));return E!==s?E:void 0}function cW(t,e){return t.map((s,a)=>t[(e+a)%t.length])}var uW=XN,TO=JN,hW=eO,dW=tO,fW=nO,AO=rO,pW=aO,EO=uO,CO=dO,mW=fO,gW=mO,PO=gO,MO=_O,IO=vO;const Mb=uW,Ib=hW,pv=ge.forwardRef(({className:t,children:e,...s},a)=>V.jsxs(TO,{ref:a,className:jr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...s,children:[e,V.jsx(dW,{asChild:!0,children:V.jsx(nN,{className:"h-4 w-4 opacity-50"})})]}));pv.displayName=TO.displayName;const LO=ge.forwardRef(({className:t,...e},s)=>V.jsx(PO,{ref:s,className:jr("flex cursor-default items-center justify-center py-1",t),...e,children:V.jsx(Uq,{className:"h-4 w-4"})}));LO.displayName=PO.displayName;const kO=ge.forwardRef(({className:t,...e},s)=>V.jsx(MO,{ref:s,className:jr("flex cursor-default items-center justify-center py-1",t),...e,children:V.jsx(nN,{className:"h-4 w-4"})}));kO.displayName=MO.displayName;const mv=ge.forwardRef(({className:t,children:e,position:s="popper",...a},d)=>V.jsx(fW,{children:V.jsxs(AO,{ref:d,className:jr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...a,children:[V.jsx(LO,{}),V.jsx(pW,{className:jr("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),V.jsx(kO,{})]})}));mv.displayName=AO.displayName;const _W=ge.forwardRef(({className:t,...e},s)=>V.jsx(EO,{ref:s,className:jr("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));_W.displayName=EO.displayName;const Oa=ge.forwardRef(({className:t,children:e,...s},a)=>V.jsxs(CO,{ref:a,className:jr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[V.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:V.jsx(gW,{children:V.jsx(mA,{className:"h-4 w-4"})})}),V.jsx(mW,{children:e})]}));Oa.displayName=CO.displayName;const yW=ge.forwardRef(({className:t,...e},s)=>V.jsx(IO,{ref:s,className:jr("-mx-1 my-1 h-px bg-muted",t),...e}));yW.displayName=IO.displayName;var RO=["PageUp","PageDown"],DO=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],NO={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},f0="Slider",[RT,vW,xW]=Iv(f0),[OO,KQ]=Vp(f0,[xW]),[bW,gw]=OO(f0),zO=ge.forwardRef((t,e)=>{const{name:s,min:a=0,max:d=100,step:g=1,orientation:v="horizontal",disabled:i=!1,minStepsBetweenThumbs:E=0,defaultValue:k=[a],value:O,onValueChange:z=()=>{},onValueCommit:G=()=>{},inverted:U=!1,form:ie,...Q}=t,se=ge.useRef(new Set),J=ge.useRef(0),le=v==="horizontal"?wW:SW,[ye=[],Ne]=hf({prop:O,defaultProp:k,onChange:ve=>{var dt;(dt=[...se.current][J.current])==null||dt.focus(),z(ve)}}),rt=ge.useRef(ye);function xe(ve){const Le=PW(ye,ve);ot(ve,Le)}function Me(ve){ot(ve,J.current)}function it(){const ve=rt.current[J.current];ye[J.current]!==ve&&G(ye)}function ot(ve,Le,{commit:dt}={commit:!1}){const Je=kW(g),yt=RW(Math.round((ve-a)/g)*g+a,Je),St=Sb(yt,[a,d]);Ne((jt=[])=>{const et=EW(jt,St,Le);if(LW(et,E*g)){J.current=et.indexOf(St);const Qe=String(et)!==String(jt);return Qe&&dt&&G(et),Qe?et:jt}else return jt})}return V.jsx(bW,{scope:t.__scopeSlider,name:s,disabled:i,min:a,max:d,valueIndexToChangeRef:J,thumbs:se.current,values:ye,orientation:v,form:ie,children:V.jsx(RT.Provider,{scope:t.__scopeSlider,children:V.jsx(RT.Slot,{scope:t.__scopeSlider,children:V.jsx(le,{"aria-disabled":i,"data-disabled":i?"":void 0,...Q,ref:e,onPointerDown:nr(Q.onPointerDown,()=>{i||(rt.current=ye)}),min:a,max:d,inverted:U,onSlideStart:i?void 0:xe,onSlideMove:i?void 0:Me,onSlideEnd:i?void 0:it,onHomeKeyDown:()=>!i&&ot(a,0,{commit:!0}),onEndKeyDown:()=>!i&&ot(d,ye.length-1,{commit:!0}),onStepKeyDown:({event:ve,direction:Le})=>{if(!i){const yt=RO.includes(ve.key)||ve.shiftKey&&DO.includes(ve.key)?10:1,St=J.current,jt=ye[St],et=g*yt*Le;ot(jt+et,St,{commit:!0})}}})})})})});zO.displayName=f0;var[FO,BO]=OO(f0,{startEdge:"left",endEdge:"right",size:"width",direction:1}),wW=ge.forwardRef((t,e)=>{const{min:s,max:a,dir:d,inverted:g,onSlideStart:v,onSlideMove:i,onSlideEnd:E,onStepKeyDown:k,...O}=t,[z,G]=ge.useState(null),U=ji(e,le=>G(le)),ie=ge.useRef(),Q=Rv(d),se=Q==="ltr",J=se&&!g||!se&&g;function te(le){const ye=ie.current||z.getBoundingClientRect(),Ne=[0,ye.width],xe=RA(Ne,J?[s,a]:[a,s]);return ie.current=ye,xe(le-ye.left)}return V.jsx(FO,{scope:t.__scopeSlider,startEdge:J?"left":"right",endEdge:J?"right":"left",direction:J?1:-1,size:"width",children:V.jsx(jO,{dir:Q,"data-orientation":"horizontal",...O,ref:U,style:{...O.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:le=>{const ye=te(le.clientX);v==null||v(ye)},onSlideMove:le=>{const ye=te(le.clientX);i==null||i(ye)},onSlideEnd:()=>{ie.current=void 0,E==null||E()},onStepKeyDown:le=>{const Ne=NO[J?"from-left":"from-right"].includes(le.key);k==null||k({event:le,direction:Ne?-1:1})}})})}),SW=ge.forwardRef((t,e)=>{const{min:s,max:a,inverted:d,onSlideStart:g,onSlideMove:v,onSlideEnd:i,onStepKeyDown:E,...k}=t,O=ge.useRef(null),z=ji(e,O),G=ge.useRef(),U=!d;function ie(Q){const se=G.current||O.current.getBoundingClientRect(),J=[0,se.height],le=RA(J,U?[a,s]:[s,a]);return G.current=se,le(Q-se.top)}return V.jsx(FO,{scope:t.__scopeSlider,startEdge:U?"bottom":"top",endEdge:U?"top":"bottom",size:"height",direction:U?1:-1,children:V.jsx(jO,{"data-orientation":"vertical",...k,ref:z,style:{...k.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:Q=>{const se=ie(Q.clientY);g==null||g(se)},onSlideMove:Q=>{const se=ie(Q.clientY);v==null||v(se)},onSlideEnd:()=>{G.current=void 0,i==null||i()},onStepKeyDown:Q=>{const J=NO[U?"from-bottom":"from-top"].includes(Q.key);E==null||E({event:Q,direction:J?-1:1})}})})}),jO=ge.forwardRef((t,e)=>{const{__scopeSlider:s,onSlideStart:a,onSlideMove:d,onSlideEnd:g,onHomeKeyDown:v,onEndKeyDown:i,onStepKeyDown:E,...k}=t,O=gw(f0,s);return V.jsx(Zr.span,{...k,ref:e,onKeyDown:nr(t.onKeyDown,z=>{z.key==="Home"?(v(z),z.preventDefault()):z.key==="End"?(i(z),z.preventDefault()):RO.concat(DO).includes(z.key)&&(E(z),z.preventDefault())}),onPointerDown:nr(t.onPointerDown,z=>{const G=z.target;G.setPointerCapture(z.pointerId),z.preventDefault(),O.thumbs.has(G)?G.focus():a(z)}),onPointerMove:nr(t.onPointerMove,z=>{z.target.hasPointerCapture(z.pointerId)&&d(z)}),onPointerUp:nr(t.onPointerUp,z=>{const G=z.target;G.hasPointerCapture(z.pointerId)&&(G.releasePointerCapture(z.pointerId),g(z))})})}),UO="SliderTrack",VO=ge.forwardRef((t,e)=>{const{__scopeSlider:s,...a}=t,d=gw(UO,s);return V.jsx(Zr.span,{"data-disabled":d.disabled?"":void 0,"data-orientation":d.orientation,...a,ref:e})});VO.displayName=UO;var DT="SliderRange",qO=ge.forwardRef((t,e)=>{const{__scopeSlider:s,...a}=t,d=gw(DT,s),g=BO(DT,s),v=ge.useRef(null),i=ji(e,v),E=d.values.length,k=d.values.map(G=>GO(G,d.min,d.max)),O=E>1?Math.min(...k):0,z=100-Math.max(...k);return V.jsx(Zr.span,{"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,...a,ref:i,style:{...t.style,[g.startEdge]:O+"%",[g.endEdge]:z+"%"}})});qO.displayName=DT;var NT="SliderThumb",$O=ge.forwardRef((t,e)=>{const s=vW(t.__scopeSlider),[a,d]=ge.useState(null),g=ji(e,i=>d(i)),v=ge.useMemo(()=>a?s().findIndex(i=>i.ref.current===a):-1,[s,a]);return V.jsx(TW,{...t,ref:g,index:v})}),TW=ge.forwardRef((t,e)=>{const{__scopeSlider:s,index:a,name:d,...g}=t,v=gw(NT,s),i=BO(NT,s),[E,k]=ge.useState(null),O=ji(e,te=>k(te)),z=E?v.form||!!E.closest("form"):!0,G=CA(E),U=v.values[a],ie=U===void 0?0:GO(U,v.min,v.max),Q=CW(a,v.values.length),se=G==null?void 0:G[i.size],J=se?MW(se,ie,i.direction):0;return ge.useEffect(()=>{if(E)return v.thumbs.add(E),()=>{v.thumbs.delete(E)}},[E,v.thumbs]),V.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${ie}% + ${J}px)`},children:[V.jsx(RT.ItemSlot,{scope:t.__scopeSlider,children:V.jsx(Zr.span,{role:"slider","aria-label":t["aria-label"]||Q,"aria-valuemin":v.min,"aria-valuenow":U,"aria-valuemax":v.max,"aria-orientation":v.orientation,"data-orientation":v.orientation,"data-disabled":v.disabled?"":void 0,tabIndex:v.disabled?void 0:0,...g,ref:O,style:U===void 0?{display:"none"}:t.style,onFocus:nr(t.onFocus,()=>{v.valueIndexToChangeRef.current=a})})}),z&&V.jsx(AW,{name:d??(v.name?v.name+(v.values.length>1?"[]":""):void 0),form:v.form,value:U},a)]})});$O.displayName=NT;var AW=t=>{const{value:e,...s}=t,a=ge.useRef(null),d=IA(e);return ge.useEffect(()=>{const g=a.current,v=window.HTMLInputElement.prototype,E=Object.getOwnPropertyDescriptor(v,"value").set;if(d!==e&&E){const k=new Event("input",{bubbles:!0});E.call(g,e),g.dispatchEvent(k)}},[d,e]),V.jsx("input",{style:{display:"none"},...s,ref:a,defaultValue:e})};function EW(t=[],e,s){const a=[...t];return a[s]=e,a.sort((d,g)=>d-g)}function GO(t,e,s){const g=100/(s-e)*(t-e);return Sb(g,[0,100])}function CW(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function PW(t,e){if(t.length===1)return 0;const s=t.map(d=>Math.abs(d-e)),a=Math.min(...s);return s.indexOf(a)}function MW(t,e,s){const a=t/2,g=RA([0,50],[0,a]);return(a-g(e)*s)*s}function IW(t){return t.slice(0,-1).map((e,s)=>t[s+1]-e)}function LW(t,e){if(e>0){const s=IW(t);return Math.min(...s)>=e}return!0}function RA(t,e){return s=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const a=(e[1]-e[0])/(t[1]-t[0]);return e[0]+a*(s-t[0])}}function kW(t){return(String(t).split(".")[1]||"").length}function RW(t,e){const s=Math.pow(10,e);return Math.round(t*s)/s}var HO=zO,DW=VO,NW=qO,OW=$O;const WO=ge.forwardRef(({className:t,...e},s)=>V.jsxs(HO,{ref:s,className:jr("relative flex w-full touch-none select-none items-center",t),...e,children:[V.jsx(DW,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:V.jsx(NW,{className:"absolute h-full bg-primary"})}),V.jsx(OW,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));WO.displayName=HO.displayName;const zW=pA("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),qs=ge.forwardRef(({className:t,variant:e,size:s,asChild:a=!1,...d},g)=>{const v=a?kp:"button";return V.jsx(v,{className:jr(zW({variant:e,size:s,className:t})),ref:g,...d})});qs.displayName="Button";function FW({data:t,isLoading:e,onShowDetails:s,onFilterChange:a}){const[d,g]=ge.useState({uf:"Todos",tipoServico:"Todos",distanciaMaxima:15}),v=(E,k)=>{const O={...d,[E]:k};g(O)},i=()=>{a(d)};return V.jsxs("div",{className:"bg-white rounded-lg shadow h-full flex flex-col",children:[V.jsx("div",{className:"p-4 border-b border-slate-200",children:V.jsx("h3",{className:"font-semibold text-slate-700",children:"Análise de Proximidade"})}),V.jsxs("div",{className:"p-4 border-b border-slate-200",children:[V.jsxs("div",{className:"space-y-3",children:[V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Filtrar por UF"}),V.jsxs(Mb,{value:d.uf,onValueChange:E=>v("uf",E),children:[V.jsx(pv,{children:V.jsx(Ib,{placeholder:"Selecione UF"})}),V.jsxs(mv,{children:[V.jsx(Oa,{value:"Todos",children:"Todos"}),V.jsx(Oa,{value:"SP",children:"SP"}),V.jsx(Oa,{value:"RJ",children:"RJ"}),V.jsx(Oa,{value:"DF",children:"DF"}),V.jsx(Oa,{value:"MG",children:"MG"}),V.jsx(Oa,{value:"RS",children:"RS"})]})]})]}),V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Serviço"}),V.jsxs(Mb,{value:d.tipoServico,onValueChange:E=>v("tipoServico",E),children:[V.jsx(pv,{children:V.jsx(Ib,{placeholder:"Selecione o tipo"})}),V.jsxs(mv,{children:[V.jsx(Oa,{value:"Todos",children:"Todos"}),V.jsx(Oa,{value:"Hospitais",children:"Hospitais"}),V.jsx(Oa,{value:"Clínicas",children:"Clínicas"}),V.jsx(Oa,{value:"Laboratórios",children:"Laboratórios"})]})]})]}),V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Distância Máxima"}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx(WO,{min:1,max:50,step:1,defaultValue:[d.distanciaMaxima],onValueChange:E=>v("distanciaMaxima",E[0]),className:"w-full"}),V.jsxs("span",{className:"text-sm text-slate-700 min-w-[30px]",children:[d.distanciaMaxima,"km"]})]})]})]}),V.jsx(qs,{className:"mt-4 w-full bg-primary hover:bg-blue-700",onClick:i,children:"Aplicar Filtros"})]}),V.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[V.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Prestadores mais próximos"}),e?V.jsx("div",{className:"flex justify-center items-center h-40",children:V.jsx(Wq,{className:"h-8 w-8 animate-spin text-primary"})}):t.length===0?V.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhum resultado encontrado com os filtros atuais."}):V.jsx("div",{className:"space-y-4",children:t.map(E=>V.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-lg",children:[V.jsxs("div",{className:"flex justify-between items-start",children:[V.jsxs("div",{children:[V.jsx("h5",{className:"font-medium text-slate-800",children:E.clienteNome}),V.jsx("p",{className:"text-xs text-slate-500",children:E.clienteUf})]}),V.jsx("span",{className:"text-xs bg-slate-200 text-slate-700 px-2 py-1 rounded",children:"Cliente"})]}),V.jsx("div",{className:"mt-3 space-y-2",children:E.prestadores.map(k=>V.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded border border-slate-200",children:[V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:`text-xs font-medium text-white ${k.ranking===1?"bg-green-600":"bg-blue-600"} w-5 h-5 rounded-full flex items-center justify-center mr-2`,children:k.ranking}),V.jsxs("div",{children:[V.jsx("p",{className:"text-sm font-medium text-slate-800",children:k.nome}),V.jsxs("p",{className:"text-xs text-slate-500",children:[k.distancia.toFixed(1)," km • ",k.local]})]})]}),V.jsx("button",{className:"text-xs text-primary hover:text-blue-700",onClick:()=>s(E.clienteId,k.id),children:"Detalhes"})]},k.id))})]},E.clienteId))})]})]})}const ZO=ge.forwardRef(({className:t,...e},s)=>V.jsx("div",{className:"relative w-full overflow-auto",children:V.jsx("table",{ref:s,className:jr("w-full caption-bottom text-sm",t),...e})}));ZO.displayName="Table";const KO=ge.forwardRef(({className:t,...e},s)=>V.jsx("thead",{ref:s,className:jr("[&_tr]:border-b",t),...e}));KO.displayName="TableHeader";const XO=ge.forwardRef(({className:t,...e},s)=>V.jsx("tbody",{ref:s,className:jr("[&_tr:last-child]:border-0",t),...e}));XO.displayName="TableBody";const BW=ge.forwardRef(({className:t,...e},s)=>V.jsx("tfoot",{ref:s,className:jr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...e}));BW.displayName="TableFooter";const Iy=ge.forwardRef(({className:t,...e},s)=>V.jsx("tr",{ref:s,className:jr("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...e}));Iy.displayName="TableRow";const ep=ge.forwardRef(({className:t,...e},s)=>V.jsx("th",{ref:s,className:jr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...e}));ep.displayName="TableHead";const $h=ge.forwardRef(({className:t,...e},s)=>V.jsx("td",{ref:s,className:jr("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...e}));$h.displayName="TableCell";const jW=ge.forwardRef(({className:t,...e},s)=>V.jsx("caption",{ref:s,className:jr("mt-4 text-sm text-muted-foreground",t),...e}));jW.displayName="TableCaption";function cs(t){"@babel/helpers - typeof";return cs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cs(t)}var ul=Uint8Array,qc=Uint16Array,DA=Int32Array,_w=new ul([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yw=new ul([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),OT=new ul([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),YO=function(t,e){for(var s=new qc(31),a=0;a<31;++a)s[a]=e+=1<<t[a-1];for(var d=new DA(s[30]),a=1;a<30;++a)for(var g=s[a];g<s[a+1];++g)d[g]=g-s[a]<<5|a;return{b:s,r:d}},JO=YO(_w,2),QO=JO.b,zT=JO.r;QO[28]=258,zT[258]=28;var ez=YO(yw,0),UW=ez.b,H4=ez.r,FT=new qc(32768);for(var $s=0;$s<32768;++$s){var Xf=($s&43690)>>1|($s&21845)<<1;Xf=(Xf&52428)>>2|(Xf&13107)<<2,Xf=(Xf&61680)>>4|(Xf&3855)<<4,FT[$s]=((Xf&65280)>>8|(Xf&255)<<8)>>1}var od=function(t,e,s){for(var a=t.length,d=0,g=new qc(e);d<a;++d)t[d]&&++g[t[d]-1];var v=new qc(e);for(d=1;d<e;++d)v[d]=v[d-1]+g[d-1]<<1;var i;if(s){i=new qc(1<<e);var E=15-e;for(d=0;d<a;++d)if(t[d])for(var k=d<<4|t[d],O=e-t[d],z=v[t[d]-1]++<<O,G=z|(1<<O)-1;z<=G;++z)i[FT[z]>>E]=k}else for(i=new qc(a),d=0;d<a;++d)t[d]&&(i[d]=FT[v[t[d]-1]++]>>15-t[d]);return i},zp=new ul(288);for(var $s=0;$s<144;++$s)zp[$s]=8;for(var $s=144;$s<256;++$s)zp[$s]=9;for(var $s=256;$s<280;++$s)zp[$s]=7;for(var $s=280;$s<288;++$s)zp[$s]=8;var gv=new ul(32);for(var $s=0;$s<32;++$s)gv[$s]=5;var VW=od(zp,9,0),qW=od(zp,9,1),$W=od(gv,5,0),GW=od(gv,5,1),G5=function(t){for(var e=t[0],s=1;s<t.length;++s)t[s]>e&&(e=t[s]);return e},eh=function(t,e,s){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(e&7)&s},H5=function(t,e){var s=e/8|0;return(t[s]|t[s+1]<<8|t[s+2]<<16)>>(e&7)},NA=function(t){return(t+7)/8|0},tz=function(t,e,s){return(s==null||s>t.length)&&(s=t.length),new ul(t.subarray(e,s))},HW=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ih=function(t,e,s){var a=new Error(e||HW[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,ih),!s)throw a;return a},WW=function(t,e,s,a){var d=t.length,g=0;if(!d||e.f&&!e.l)return s||new ul(0);var v=!s,i=v||e.i!=2,E=e.i;v&&(s=new ul(d*3));var k=function(dn){var Cn=s.length;if(dn>Cn){var On=new ul(Math.max(Cn*2,dn));On.set(s),s=On}},O=e.f||0,z=e.p||0,G=e.b||0,U=e.l,ie=e.d,Q=e.m,se=e.n,J=d*8;do{if(!U){O=eh(t,z,1);var te=eh(t,z+1,3);if(z+=3,te)if(te==1)U=qW,ie=GW,Q=9,se=5;else if(te==2){var rt=eh(t,z,31)+257,xe=eh(t,z+10,15)+4,Me=rt+eh(t,z+5,31)+1;z+=14;for(var it=new ul(Me),ot=new ul(19),ve=0;ve<xe;++ve)ot[OT[ve]]=eh(t,z+ve*3,7);z+=xe*3;for(var Le=G5(ot),dt=(1<<Le)-1,Je=od(ot,Le,1),ve=0;ve<Me;){var yt=Je[eh(t,z,dt)];z+=yt&15;var le=yt>>4;if(le<16)it[ve++]=le;else{var St=0,jt=0;for(le==16?(jt=3+eh(t,z,3),z+=2,St=it[ve-1]):le==17?(jt=3+eh(t,z,7),z+=3):le==18&&(jt=11+eh(t,z,127),z+=7);jt--;)it[ve++]=St}}var et=it.subarray(0,rt),Qe=it.subarray(rt);Q=G5(et),se=G5(Qe),U=od(et,Q,1),ie=od(Qe,se,1)}else ih(1);else{var le=NA(z)+4,ye=t[le-4]|t[le-3]<<8,Ne=le+ye;if(Ne>d){E&&ih(0);break}i&&k(G+ye),s.set(t.subarray(le,Ne),G),e.b=G+=ye,e.p=z=Ne*8,e.f=O;continue}if(z>J){E&&ih(0);break}}i&&k(G+131072);for(var Xe=(1<<Q)-1,Vt=(1<<se)-1,be=z;;be=z){var St=U[H5(t,z)&Xe],Re=St>>4;if(z+=St&15,z>J){E&&ih(0);break}if(St||ih(2),Re<256)s[G++]=Re;else if(Re==256){be=z,U=null;break}else{var Fe=Re-254;if(Re>264){var ve=Re-257,ut=_w[ve];Fe=eh(t,z,(1<<ut)-1)+QO[ve],z+=ut}var Et=ie[H5(t,z)&Vt],Ct=Et>>4;Et||ih(3),z+=Et&15;var Qe=UW[Ct];if(Ct>3){var ut=yw[Ct];Qe+=H5(t,z)&(1<<ut)-1,z+=ut}if(z>J){E&&ih(0);break}i&&k(G+131072);var Wt=G+Fe;if(G<Qe){var Ft=g-Qe,me=Math.min(Qe,Wt);for(Ft+G<0&&ih(3);G<me;++G)s[G]=a[Ft+G]}for(;G<Wt;++G)s[G]=s[G-Qe]}}e.l=U,e.p=be,e.b=G,e.f=O,U&&(O=1,e.m=Q,e.d=ie,e.n=se)}while(!O);return G!=s.length&&v?tz(s,0,G):s.subarray(0,G)},Hd=function(t,e,s){s<<=e&7;var a=e/8|0;t[a]|=s,t[a+1]|=s>>8},by=function(t,e,s){s<<=e&7;var a=e/8|0;t[a]|=s,t[a+1]|=s>>8,t[a+2]|=s>>16},W5=function(t,e){for(var s=[],a=0;a<t.length;++a)t[a]&&s.push({s:a,f:t[a]});var d=s.length,g=s.slice();if(!d)return{t:rz,l:0};if(d==1){var v=new ul(s[0].s+1);return v[s[0].s]=1,{t:v,l:1}}s.sort(function(Ne,rt){return Ne.f-rt.f}),s.push({s:-1,f:25001});var i=s[0],E=s[1],k=0,O=1,z=2;for(s[0]={s:-1,f:i.f+E.f,l:i,r:E};O!=d-1;)i=s[s[k].f<s[z].f?k++:z++],E=s[k!=O&&s[k].f<s[z].f?k++:z++],s[O++]={s:-1,f:i.f+E.f,l:i,r:E};for(var G=g[0].s,a=1;a<d;++a)g[a].s>G&&(G=g[a].s);var U=new qc(G+1),ie=BT(s[O-1],U,0);if(ie>e){var a=0,Q=0,se=ie-e,J=1<<se;for(g.sort(function(rt,xe){return U[xe.s]-U[rt.s]||rt.f-xe.f});a<d;++a){var te=g[a].s;if(U[te]>e)Q+=J-(1<<ie-U[te]),U[te]=e;else break}for(Q>>=se;Q>0;){var le=g[a].s;U[le]<e?Q-=1<<e-U[le]++-1:++a}for(;a>=0&&Q;--a){var ye=g[a].s;U[ye]==e&&(--U[ye],++Q)}ie=e}return{t:new ul(U),l:ie}},BT=function(t,e,s){return t.s==-1?Math.max(BT(t.l,e,s+1),BT(t.r,e,s+1)):e[t.s]=s},W4=function(t){for(var e=t.length;e&&!t[--e];);for(var s=new qc(++e),a=0,d=t[0],g=1,v=function(E){s[a++]=E},i=1;i<=e;++i)if(t[i]==d&&i!=e)++g;else{if(!d&&g>2){for(;g>138;g-=138)v(32754);g>2&&(v(g>10?g-11<<5|28690:g-3<<5|12305),g=0)}else if(g>3){for(v(d),--g;g>6;g-=6)v(8304);g>2&&(v(g-3<<5|8208),g=0)}for(;g--;)v(d);g=1,d=t[i]}return{c:s.subarray(0,a),n:e}},wy=function(t,e){for(var s=0,a=0;a<e.length;++a)s+=t[a]*e[a];return s},nz=function(t,e,s){var a=s.length,d=NA(e+2);t[d]=a&255,t[d+1]=a>>8,t[d+2]=t[d]^255,t[d+3]=t[d+1]^255;for(var g=0;g<a;++g)t[d+g+4]=s[g];return(d+4+a)*8},Z4=function(t,e,s,a,d,g,v,i,E,k,O){Hd(e,O++,s),++d[256];for(var z=W5(d,15),G=z.t,U=z.l,ie=W5(g,15),Q=ie.t,se=ie.l,J=W4(G),te=J.c,le=J.n,ye=W4(Q),Ne=ye.c,rt=ye.n,xe=new qc(19),Me=0;Me<te.length;++Me)++xe[te[Me]&31];for(var Me=0;Me<Ne.length;++Me)++xe[Ne[Me]&31];for(var it=W5(xe,7),ot=it.t,ve=it.l,Le=19;Le>4&&!ot[OT[Le-1]];--Le);var dt=k+5<<3,Je=wy(d,zp)+wy(g,gv)+v,yt=wy(d,G)+wy(g,Q)+v+14+3*Le+wy(xe,ot)+2*xe[16]+3*xe[17]+7*xe[18];if(E>=0&&dt<=Je&&dt<=yt)return nz(e,O,t.subarray(E,E+k));var St,jt,et,Qe;if(Hd(e,O,1+(yt<Je)),O+=2,yt<Je){St=od(G,U,0),jt=G,et=od(Q,se,0),Qe=Q;var Xe=od(ot,ve,0);Hd(e,O,le-257),Hd(e,O+5,rt-1),Hd(e,O+10,Le-4),O+=14;for(var Me=0;Me<Le;++Me)Hd(e,O+3*Me,ot[OT[Me]]);O+=3*Le;for(var Vt=[te,Ne],be=0;be<2;++be)for(var Re=Vt[be],Me=0;Me<Re.length;++Me){var Fe=Re[Me]&31;Hd(e,O,Xe[Fe]),O+=ot[Fe],Fe>15&&(Hd(e,O,Re[Me]>>5&127),O+=Re[Me]>>12)}}else St=VW,jt=zp,et=$W,Qe=gv;for(var Me=0;Me<i;++Me){var ut=a[Me];if(ut>255){var Fe=ut>>18&31;by(e,O,St[Fe+257]),O+=jt[Fe+257],Fe>7&&(Hd(e,O,ut>>23&31),O+=_w[Fe]);var Et=ut&31;by(e,O,et[Et]),O+=Qe[Et],Et>3&&(by(e,O,ut>>5&8191),O+=yw[Et])}else by(e,O,St[ut]),O+=jt[ut]}return by(e,O,St[256]),O+jt[256]},ZW=new DA([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),rz=new ul(0),KW=function(t,e,s,a,d,g){var v=g.z||t.length,i=new ul(a+v+5*(1+Math.ceil(v/7e3))+d),E=i.subarray(a,i.length-d),k=g.l,O=(g.r||0)&7;if(e){O&&(E[0]=g.r>>3);for(var z=ZW[e-1],G=z>>13,U=z&8191,ie=(1<<s)-1,Q=g.p||new qc(32768),se=g.h||new qc(ie+1),J=Math.ceil(s/3),te=2*J,le=function($t){return(t[$t]^t[$t+1]<<J^t[$t+2]<<te)&ie},ye=new DA(25e3),Ne=new qc(288),rt=new qc(32),xe=0,Me=0,it=g.i||0,ot=0,ve=g.w||0,Le=0;it+2<v;++it){var dt=le(it),Je=it&32767,yt=se[dt];if(Q[Je]=yt,se[dt]=Je,ve<=it){var St=v-it;if((xe>7e3||ot>24576)&&(St>423||!k)){O=Z4(t,E,0,ye,Ne,rt,Me,ot,Le,it-Le,O),ot=xe=Me=0,Le=it;for(var jt=0;jt<286;++jt)Ne[jt]=0;for(var jt=0;jt<30;++jt)rt[jt]=0}var et=2,Qe=0,Xe=U,Vt=Je-yt&32767;if(St>2&&dt==le(it-Vt))for(var be=Math.min(G,St)-1,Re=Math.min(32767,it),Fe=Math.min(258,St);Vt<=Re&&--Xe&&Je!=yt;){if(t[it+et]==t[it+et-Vt]){for(var ut=0;ut<Fe&&t[it+ut]==t[it+ut-Vt];++ut);if(ut>et){if(et=ut,Qe=Vt,ut>be)break;for(var Et=Math.min(Vt,ut-2),Ct=0,jt=0;jt<Et;++jt){var Wt=it-Vt+jt&32767,Ft=Q[Wt],me=Wt-Ft&32767;me>Ct&&(Ct=me,yt=Wt)}}}Je=yt,yt=Q[Je],Vt+=Je-yt&32767}if(Qe){ye[ot++]=268435456|zT[et]<<18|H4[Qe];var dn=zT[et]&31,Cn=H4[Qe]&31;Me+=_w[dn]+yw[Cn],++Ne[257+dn],++rt[Cn],ve=it+et,++xe}else ye[ot++]=t[it],++Ne[t[it]]}}for(it=Math.max(it,ve);it<v;++it)ye[ot++]=t[it],++Ne[t[it]];O=Z4(t,E,k,ye,Ne,rt,Me,ot,Le,it-Le,O),k||(g.r=O&7|E[O/8|0]<<3,O-=7,g.h=se,g.p=Q,g.i=it,g.w=ve)}else{for(var it=g.w||0;it<v+k;it+=65535){var On=it+65535;On>=v&&(E[O/8|0]=k,On=v),O=nz(E,O+1,t.subarray(it,On))}g.i=v}return tz(i,0,a+NA(O)+d)},iz=function(){var t=1,e=0;return{p:function(s){for(var a=t,d=e,g=s.length|0,v=0;v!=g;){for(var i=Math.min(v+2655,g);v<i;++v)d+=a+=s[v];a=(a&65535)+15*(a>>16),d=(d&65535)+15*(d>>16)}t=a,e=d},d:function(){return t%=65521,e%=65521,(t&255)<<24|(t&65280)<<8|(e&255)<<8|e>>8}}},XW=function(t,e,s,a,d){if(!d&&(d={l:1},e.dictionary)){var g=e.dictionary.subarray(-32768),v=new ul(g.length+t.length);v.set(g),v.set(t,g.length),t=v,d.w=g.length}return KW(t,e.level==null?6:e.level,e.mem==null?d.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,s,a,d)},sz=function(t,e,s){for(;s;++e)t[e]=s,s>>>=8},YW=function(t,e){var s=e.level,a=s==0?0:s<6?1:s==9?3:2;if(t[0]=120,t[1]=a<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var d=iz();d.p(e.dictionary),sz(t,2,d.d())}},JW=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&ih(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&ih(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function jT(t,e){e||(e={});var s=iz();s.p(t);var a=XW(t,e,e.dictionary?6:2,4);return YW(a,e),sz(a,a.length-4,s.d()),a}function QW(t,e){return WW(t.subarray(JW(t,e),-4),{i:2},e,e)}var eZ=typeof TextDecoder<"u"&&new TextDecoder,tZ=0;try{eZ.decode(rz,{stream:!0}),tZ=1}catch{}var ei=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function Z5(){ei.console&&typeof ei.console.log=="function"&&ei.console.log.apply(ei.console,arguments)}var Ts={log:Z5,warn:function(t){ei.console&&(typeof ei.console.warn=="function"?ei.console.warn.apply(ei.console,arguments):Z5.call(null,arguments))},error:function(t){ei.console&&(typeof ei.console.error=="function"?ei.console.error.apply(ei.console,arguments):Z5(t))}};function K5(t,e,s){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(){Dm(a.response,e,s)},a.onerror=function(){Ts.error("could not download file")},a.send()}function K4(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function yx(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var qy,UT,Dm=ei.saveAs||((typeof window>"u"?"undefined":cs(window))!=="object"||window!==ei?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(t,e,s){var a=ei.URL||ei.webkitURL,d=document.createElement("a");e=e||t.name||"download",d.download=e,d.rel="noopener",typeof t=="string"?(d.href=t,d.origin!==location.origin?K4(d.href)?K5(t,e,s):yx(d,d.target="_blank"):yx(d)):(d.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(d.href)},4e4),setTimeout(function(){yx(d)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,s){if(e=e||t.name||"download",typeof t=="string")if(K4(t))K5(t,e,s);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout(function(){yx(a)})}else navigator.msSaveOrOpenBlob(function(d,g){return g===void 0?g={autoBom:!1}:cs(g)!=="object"&&(Ts.warn("Deprecated: Expected third argument to be a object"),g={autoBom:!g}),g.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(d.type)?new Blob(["\uFEFF",d],{type:d.type}):d}(t,s),e)}:function(t,e,s,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),typeof t=="string")return K5(t,e,s);var d=t.type==="application/octet-stream",g=/constructor/i.test(ei.HTMLElement)||ei.safari,v=/CriOS\/[\d]+/.test(navigator.userAgent);if((v||d&&g)&&(typeof FileReader>"u"?"undefined":cs(FileReader))==="object"){var i=new FileReader;i.onloadend=function(){var O=i.result;O=v?O:O.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=O:location=O,a=null},i.readAsDataURL(t)}else{var E=ei.URL||ei.webkitURL,k=E.createObjectURL(t);a?a.location=k:location.href=k,a=null,setTimeout(function(){E.revokeObjectURL(k)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function oz(t){var e;t=t||"",this.ok=!1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var s=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(i){return[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(i){return[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]}}],a=0;a<s.length;a++){var d=s[a].re,g=s[a].process,v=d.exec(t);v&&(e=g(v),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var i=this.r.toString(16),E=this.g.toString(16),k=this.b.toString(16);return i.length==1&&(i="0"+i),E.length==1&&(E="0"+E),k.length==1&&(k="0"+k),"#"+i+E+k}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function X5(t,e){var s=t[0],a=t[1],d=t[2],g=t[3];s=il(s,a,d,g,e[0],7,-680876936),g=il(g,s,a,d,e[1],12,-389564586),d=il(d,g,s,a,e[2],17,606105819),a=il(a,d,g,s,e[3],22,-1044525330),s=il(s,a,d,g,e[4],7,-176418897),g=il(g,s,a,d,e[5],12,1200080426),d=il(d,g,s,a,e[6],17,-1473231341),a=il(a,d,g,s,e[7],22,-45705983),s=il(s,a,d,g,e[8],7,1770035416),g=il(g,s,a,d,e[9],12,-1958414417),d=il(d,g,s,a,e[10],17,-42063),a=il(a,d,g,s,e[11],22,-1990404162),s=il(s,a,d,g,e[12],7,1804603682),g=il(g,s,a,d,e[13],12,-40341101),d=il(d,g,s,a,e[14],17,-1502002290),s=sl(s,a=il(a,d,g,s,e[15],22,1236535329),d,g,e[1],5,-165796510),g=sl(g,s,a,d,e[6],9,-1069501632),d=sl(d,g,s,a,e[11],14,643717713),a=sl(a,d,g,s,e[0],20,-373897302),s=sl(s,a,d,g,e[5],5,-701558691),g=sl(g,s,a,d,e[10],9,38016083),d=sl(d,g,s,a,e[15],14,-660478335),a=sl(a,d,g,s,e[4],20,-405537848),s=sl(s,a,d,g,e[9],5,568446438),g=sl(g,s,a,d,e[14],9,-1019803690),d=sl(d,g,s,a,e[3],14,-187363961),a=sl(a,d,g,s,e[8],20,1163531501),s=sl(s,a,d,g,e[13],5,-1444681467),g=sl(g,s,a,d,e[2],9,-51403784),d=sl(d,g,s,a,e[7],14,1735328473),s=ol(s,a=sl(a,d,g,s,e[12],20,-1926607734),d,g,e[5],4,-378558),g=ol(g,s,a,d,e[8],11,-2022574463),d=ol(d,g,s,a,e[11],16,1839030562),a=ol(a,d,g,s,e[14],23,-35309556),s=ol(s,a,d,g,e[1],4,-1530992060),g=ol(g,s,a,d,e[4],11,1272893353),d=ol(d,g,s,a,e[7],16,-155497632),a=ol(a,d,g,s,e[10],23,-1094730640),s=ol(s,a,d,g,e[13],4,681279174),g=ol(g,s,a,d,e[0],11,-358537222),d=ol(d,g,s,a,e[3],16,-722521979),a=ol(a,d,g,s,e[6],23,76029189),s=ol(s,a,d,g,e[9],4,-640364487),g=ol(g,s,a,d,e[12],11,-421815835),d=ol(d,g,s,a,e[15],16,530742520),s=al(s,a=ol(a,d,g,s,e[2],23,-995338651),d,g,e[0],6,-198630844),g=al(g,s,a,d,e[7],10,1126891415),d=al(d,g,s,a,e[14],15,-1416354905),a=al(a,d,g,s,e[5],21,-57434055),s=al(s,a,d,g,e[12],6,1700485571),g=al(g,s,a,d,e[3],10,-1894986606),d=al(d,g,s,a,e[10],15,-1051523),a=al(a,d,g,s,e[1],21,-2054922799),s=al(s,a,d,g,e[8],6,1873313359),g=al(g,s,a,d,e[15],10,-30611744),d=al(d,g,s,a,e[6],15,-1560198380),a=al(a,d,g,s,e[13],21,1309151649),s=al(s,a,d,g,e[4],6,-145523070),g=al(g,s,a,d,e[11],10,-1120210379),d=al(d,g,s,a,e[2],15,718787259),a=al(a,d,g,s,e[9],21,-343485551),t[0]=bp(s,t[0]),t[1]=bp(a,t[1]),t[2]=bp(d,t[2]),t[3]=bp(g,t[3])}function vw(t,e,s,a,d,g){return e=bp(bp(e,t),bp(a,g)),bp(e<<d|e>>>32-d,s)}function il(t,e,s,a,d,g,v){return vw(e&s|~e&a,t,e,d,g,v)}function sl(t,e,s,a,d,g,v){return vw(e&a|s&~a,t,e,d,g,v)}function ol(t,e,s,a,d,g,v){return vw(e^s^a,t,e,d,g,v)}function al(t,e,s,a,d,g,v){return vw(s^(e|~a),t,e,d,g,v)}function az(t){var e,s=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)X5(a,nZ(t.substring(e-64,e)));t=t.substring(e-64);var d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)d[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(d[e>>2]|=128<<(e%4<<3),e>55)for(X5(a,d),e=0;e<16;e++)d[e]=0;return d[14]=8*s,X5(a,d),a}function nZ(t){var e,s=[];for(e=0;e<64;e+=4)s[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return s}qy=ei.atob.bind(ei),UT=ei.btoa.bind(ei);var X4="0123456789abcdef".split("");function rZ(t){for(var e="",s=0;s<4;s++)e+=X4[t>>8*s+4&15]+X4[t>>8*s&15];return e}function iZ(t){return String.fromCharCode((255&t)>>0,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function VT(t){return az(t).map(iZ).join("")}var sZ=function(t){for(var e=0;e<t.length;e++)t[e]=rZ(t[e]);return t.join("")}(az("hello"))!="5d41402abc4b2a76b9719d911017c592";function bp(t,e){if(sZ){var s=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(s>>16)<<16|65535&s}return t+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function qT(t,e){var s,a,d,g;if(t!==s){for(var v=(d=t,g=1+(256/t.length>>0),new Array(g+1).join(d)),i=[],E=0;E<256;E++)i[E]=E;var k=0;for(E=0;E<256;E++){var O=i[E];k=(k+O+v.charCodeAt(E))%256,i[E]=i[k],i[k]=O}s=t,a=i}else i=a;var z=e.length,G=0,U=0,ie="";for(E=0;E<z;E++)U=(U+(O=i[G=(G+1)%256]))%256,i[G]=i[U],i[U]=O,v=i[(i[G]+i[U])%256],ie+=String.fromCharCode(e.charCodeAt(E)^v);return ie}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var Y4={print:4,modify:8,copy:16,"annot-forms":32};function n_(t,e,s,a){this.v=1,this.r=2;var d=192;t.forEach(function(i){if(Y4.perm!==void 0)throw new Error("Invalid permission: "+i);d+=Y4[i]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var g=(e+this.padding).substr(0,32),v=(s+this.padding).substr(0,32);this.O=this.processOwnerPassword(g,v),this.P=-(1+(255^d)),this.encryptionKey=VT(g+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(a)).substr(0,5),this.U=qT(this.encryptionKey,this.padding)}function r_(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var e="",s=t.length,a=0;a<s;a++){var d=t.charCodeAt(a);d<33||d===35||d===37||d===40||d===41||d===47||d===60||d===62||d===91||d===93||d===123||d===125||d>126?e+="#"+("0"+d.toString(16)).slice(-2):e+=t[a]}return e}function J4(t){if(cs(t)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(s,a,d){if(d=d||!1,typeof s!="string"||typeof a!="function"||typeof d!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(s)||(e[s]={});var g=Math.random().toString(35);return e[s][g]=[a,!!d],g},this.unsubscribe=function(s){for(var a in e)if(e[a][s])return delete e[a][s],Object.keys(e[a]).length===0&&delete e[a],!0;return!1},this.publish=function(s){if(e.hasOwnProperty(s)){var a=Array.prototype.slice.call(arguments,1),d=[];for(var g in e[s]){var v=e[s][g];try{v[0].apply(t,a)}catch(i){ei.console&&Ts.error("jsPDF PubSub Error",i.message,i)}v[1]&&d.push(g)}d.length&&d.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function Lb(t){if(!(this instanceof Lb))return new Lb(t);var e="opacity,stroke-opacity".split(",");for(var s in t)t.hasOwnProperty(s)&&e.indexOf(s)>=0&&(this[s]=t[s]);this.id="",this.objectNumber=-1}function lz(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function Om(t,e,s,a,d){if(!(this instanceof Om))return new Om(t,e,s,a,d);this.type=t==="axial"?2:3,this.coords=e,this.colors=s,lz.call(this,a,d)}function __(t,e,s,a,d){if(!(this instanceof __))return new __(t,e,s,a,d);this.boundingBox=t,this.xStep=e,this.yStep=s,this.stream="",this.cloneIndex=0,lz.call(this,a,d)}function Qr(t){var e,s=typeof arguments[0]=="string"?arguments[0]:"p",a=arguments[1],d=arguments[2],g=arguments[3],v=[],i=1,E=16,k="S",O=null;cs(t=t||{})==="object"&&(s=t.orientation,a=t.unit||a,d=t.format||d,g=t.compress||t.compressPdf||g,(O=t.encryption||null)!==null&&(O.userPassword=O.userPassword||"",O.ownerPassword=O.ownerPassword||"",O.userPermissions=O.userPermissions||[]),i=typeof t.userUnit=="number"?Math.abs(t.userUnit):1,t.precision!==void 0&&(e=t.precision),t.floatPrecision!==void 0&&(E=t.floatPrecision),k=t.defaultPathOperation||"S"),v=t.filters||(g===!0?["FlateEncode"]:v),a=a||"mm",s=(""+(s||"P")).toLowerCase();var z=t.putOnlyUsedFonts||!1,G={},U={internal:{},__private__:{}};U.__private__.PubSub=J4;var ie="1.3",Q=U.__private__.getPdfVersion=function(){return ie};U.__private__.setPdfVersion=function(K){ie=K};var se={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};U.__private__.getPageFormats=function(){return se};var J=U.__private__.getPageFormat=function(K){return se[K]};d=d||"a4";var te={COMPAT:"compat",ADVANCED:"advanced"},le=te.COMPAT;function ye(){this.saveGraphicsState(),_t(new _e(Kn,0,0,-Kn,0,fa()*Kn).toString()+" cm"),this.setFontSize(this.getFontSize()/Kn),k="n",le=te.ADVANCED}function Ne(){this.restoreGraphicsState(),k="S",le=te.COMPAT}var rt=U.__private__.combineFontStyleAndFontWeight=function(K,Ee){if(K=="bold"&&Ee=="normal"||K=="bold"&&Ee==400||K=="normal"&&Ee=="italic"||K=="bold"&&Ee=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ee&&(K=Ee==400||Ee==="normal"?K==="italic"?"italic":"normal":Ee!=700&&Ee!=="bold"||K!=="normal"?(Ee==700?"bold":Ee)+""+K:"bold"),K};U.advancedAPI=function(K){var Ee=le===te.COMPAT;return Ee&&ye.call(this),typeof K!="function"||(K(this),Ee&&Ne.call(this)),this},U.compatAPI=function(K){var Ee=le===te.ADVANCED;return Ee&&Ne.call(this),typeof K!="function"||(K(this),Ee&&ye.call(this)),this},U.isAdvancedAPI=function(){return le===te.ADVANCED};var xe,Me=function(K){if(le!==te.ADVANCED)throw new Error(K+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},it=U.roundToPrecision=U.__private__.roundToPrecision=function(K,Ee){var pt=e||Ee;if(isNaN(K)||isNaN(pt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return K.toFixed(pt).replace(/0+$/,"")};xe=U.hpf=U.__private__.hpf=typeof E=="number"?function(K){if(isNaN(K))throw new Error("Invalid argument passed to jsPDF.hpf");return it(K,E)}:E==="smart"?function(K){if(isNaN(K))throw new Error("Invalid argument passed to jsPDF.hpf");return it(K,K>-1&&K<1?16:5)}:function(K){if(isNaN(K))throw new Error("Invalid argument passed to jsPDF.hpf");return it(K,16)};var ot=U.f2=U.__private__.f2=function(K){if(isNaN(K))throw new Error("Invalid argument passed to jsPDF.f2");return it(K,2)},ve=U.__private__.f3=function(K){if(isNaN(K))throw new Error("Invalid argument passed to jsPDF.f3");return it(K,3)},Le=U.scale=U.__private__.scale=function(K){if(isNaN(K))throw new Error("Invalid argument passed to jsPDF.scale");return le===te.COMPAT?K*Kn:le===te.ADVANCED?K:void 0},dt=function(K){return le===te.COMPAT?fa()-K:le===te.ADVANCED?K:void 0},Je=function(K){return Le(dt(K))};U.__private__.setPrecision=U.setPrecision=function(K){typeof parseInt(K,10)=="number"&&(e=parseInt(K,10))};var yt,St="00000000000000000000000000000000",jt=U.__private__.getFileId=function(){return St},et=U.__private__.setFileId=function(K){return St=K!==void 0&&/^[a-fA-F0-9]{32}$/.test(K)?K.toUpperCase():St.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),O!==null&&(po=new n_(O.userPermissions,O.userPassword,O.ownerPassword,St)),St};U.setFileId=function(K){return et(K),this},U.getFileId=function(){return jt()};var Qe=U.__private__.convertDateToPDFDate=function(K){var Ee=K.getTimezoneOffset(),pt=Ee<0?"+":"-",It=Math.floor(Math.abs(Ee/60)),Yt=Math.abs(Ee%60),fn=[pt,Fe(It),"'",Fe(Yt),"'"].join("");return["D:",K.getFullYear(),Fe(K.getMonth()+1),Fe(K.getDate()),Fe(K.getHours()),Fe(K.getMinutes()),Fe(K.getSeconds()),fn].join("")},Xe=U.__private__.convertPDFDateToDate=function(K){var Ee=parseInt(K.substr(2,4),10),pt=parseInt(K.substr(6,2),10)-1,It=parseInt(K.substr(8,2),10),Yt=parseInt(K.substr(10,2),10),fn=parseInt(K.substr(12,2),10),Mn=parseInt(K.substr(14,2),10);return new Date(Ee,pt,It,Yt,fn,Mn,0)},Vt=U.__private__.setCreationDate=function(K){var Ee;if(K===void 0&&(K=new Date),K instanceof Date)Ee=Qe(K);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(K))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ee=K}return yt=Ee},be=U.__private__.getCreationDate=function(K){var Ee=yt;return K==="jsDate"&&(Ee=Xe(yt)),Ee};U.setCreationDate=function(K){return Vt(K),this},U.getCreationDate=function(K){return be(K)};var Re,Fe=U.__private__.padd2=function(K){return("0"+parseInt(K)).slice(-2)},ut=U.__private__.padd2Hex=function(K){return("00"+(K=K.toString())).substr(K.length)},Et=0,Ct=[],Wt=[],Ft=0,me=[],dn=[],Cn=!1,On=Wt,$t=function(){Et=0,Ft=0,Wt=[],Ct=[],me=[],Nt=wt(),Lt=wt()};U.__private__.setCustomOutputDestination=function(K){Cn=!0,On=K};var cn=function(K){Cn||(On=K)};U.__private__.resetCustomOutputDestination=function(){Cn=!1,On=Wt};var _t=U.__private__.out=function(K){return K=K.toString(),Ft+=K.length+1,On.push(K),On},yr=U.__private__.write=function(K){return _t(arguments.length===1?K.toString():Array.prototype.join.call(arguments," "))},En=U.__private__.getArrayBuffer=function(K){for(var Ee=K.length,pt=new ArrayBuffer(Ee),It=new Uint8Array(pt);Ee--;)It[Ee]=K.charCodeAt(Ee);return pt},bn=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];U.__private__.getStandardFonts=function(){return bn};var Fn=t.fontSize||16;U.__private__.setFontSize=U.setFontSize=function(K){return Fn=le===te.ADVANCED?K/Kn:K,this};var Gn,Un=U.__private__.getFontSize=U.getFontSize=function(){return le===te.COMPAT?Fn:Fn*Kn},pr=t.R2L||!1;U.__private__.setR2L=U.setR2L=function(K){return pr=K,this},U.__private__.getR2L=U.getR2L=function(){return pr};var Ln,br=U.__private__.setZoomMode=function(K){var Ee=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(K))Gn=K;else if(isNaN(K)){if(Ee.indexOf(K)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+K+'" is not recognized.');Gn=K}else Gn=parseInt(K,10)};U.__private__.getZoomMode=function(){return Gn};var Kr,hi=U.__private__.setPageMode=function(K){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(K)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+K+'" is not recognized.');Ln=K};U.__private__.getPageMode=function(){return Ln};var si=U.__private__.setLayoutMode=function(K){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(K)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+K+'" is not recognized.');Kr=K};U.__private__.getLayoutMode=function(){return Kr},U.__private__.setDisplayMode=U.setDisplayMode=function(K,Ee,pt){return br(K),si(Ee),hi(pt),this};var wr={title:"",subject:"",author:"",keywords:"",creator:""};U.__private__.getDocumentProperty=function(K){if(Object.keys(wr).indexOf(K)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return wr[K]},U.__private__.getDocumentProperties=function(){return wr},U.__private__.setDocumentProperties=U.setProperties=U.setDocumentProperties=function(K){for(var Ee in wr)wr.hasOwnProperty(Ee)&&K[Ee]&&(wr[Ee]=K[Ee]);return this},U.__private__.setDocumentProperty=function(K,Ee){if(Object.keys(wr).indexOf(K)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return wr[K]=Ee};var Ur,Kn,Hs,fi,xo,di={},Hi={},pi=[],lr={},ml={},Yi={},as={},Ho=null,ns=0,Rr=[],Ii=new J4(U),$l=t.hotfixes||[],Rs={},Dt={},he=[],_e=function K(Ee,pt,It,Yt,fn,Mn){if(!(this instanceof K))return new K(Ee,pt,It,Yt,fn,Mn);isNaN(Ee)&&(Ee=1),isNaN(pt)&&(pt=0),isNaN(It)&&(It=0),isNaN(Yt)&&(Yt=1),isNaN(fn)&&(fn=0),isNaN(Mn)&&(Mn=0),this._matrix=[Ee,pt,It,Yt,fn,Mn]};Object.defineProperty(_e.prototype,"sx",{get:function(){return this._matrix[0]},set:function(K){this._matrix[0]=K}}),Object.defineProperty(_e.prototype,"shy",{get:function(){return this._matrix[1]},set:function(K){this._matrix[1]=K}}),Object.defineProperty(_e.prototype,"shx",{get:function(){return this._matrix[2]},set:function(K){this._matrix[2]=K}}),Object.defineProperty(_e.prototype,"sy",{get:function(){return this._matrix[3]},set:function(K){this._matrix[3]=K}}),Object.defineProperty(_e.prototype,"tx",{get:function(){return this._matrix[4]},set:function(K){this._matrix[4]=K}}),Object.defineProperty(_e.prototype,"ty",{get:function(){return this._matrix[5]},set:function(K){this._matrix[5]=K}}),Object.defineProperty(_e.prototype,"a",{get:function(){return this._matrix[0]},set:function(K){this._matrix[0]=K}}),Object.defineProperty(_e.prototype,"b",{get:function(){return this._matrix[1]},set:function(K){this._matrix[1]=K}}),Object.defineProperty(_e.prototype,"c",{get:function(){return this._matrix[2]},set:function(K){this._matrix[2]=K}}),Object.defineProperty(_e.prototype,"d",{get:function(){return this._matrix[3]},set:function(K){this._matrix[3]=K}}),Object.defineProperty(_e.prototype,"e",{get:function(){return this._matrix[4]},set:function(K){this._matrix[4]=K}}),Object.defineProperty(_e.prototype,"f",{get:function(){return this._matrix[5]},set:function(K){this._matrix[5]=K}}),Object.defineProperty(_e.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(_e.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(_e.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(_e.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),_e.prototype.join=function(K){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(xe).join(K)},_e.prototype.multiply=function(K){var Ee=K.sx*this.sx+K.shy*this.shx,pt=K.sx*this.shy+K.shy*this.sy,It=K.shx*this.sx+K.sy*this.shx,Yt=K.shx*this.shy+K.sy*this.sy,fn=K.tx*this.sx+K.ty*this.shx+this.tx,Mn=K.tx*this.shy+K.ty*this.sy+this.ty;return new _e(Ee,pt,It,Yt,fn,Mn)},_e.prototype.decompose=function(){var K=this.sx,Ee=this.shy,pt=this.shx,It=this.sy,Yt=this.tx,fn=this.ty,Mn=Math.sqrt(K*K+Ee*Ee),Wn=(K/=Mn)*pt+(Ee/=Mn)*It;pt-=K*Wn,It-=Ee*Wn;var vr=Math.sqrt(pt*pt+It*It);return Wn/=vr,K*(It/=vr)<Ee*(pt/=vr)&&(K=-K,Ee=-Ee,Wn=-Wn,Mn=-Mn),{scale:new _e(Mn,0,0,vr,0,0),translate:new _e(1,0,0,1,Yt,fn),rotate:new _e(K,Ee,-Ee,K,0,0),skew:new _e(1,0,Wn,1,0,0)}},_e.prototype.toString=function(K){return this.join(" ")},_e.prototype.inversed=function(){var K=this.sx,Ee=this.shy,pt=this.shx,It=this.sy,Yt=this.tx,fn=this.ty,Mn=1/(K*It-Ee*pt),Wn=It*Mn,vr=-Ee*Mn,Mr=-pt*Mn,Gr=K*Mn;return new _e(Wn,vr,Mr,Gr,-Wn*Yt-Mr*fn,-vr*Yt-Gr*fn)},_e.prototype.applyToPoint=function(K){var Ee=K.x*this.sx+K.y*this.shx+this.tx,pt=K.x*this.shy+K.y*this.sy+this.ty;return new Aa(Ee,pt)},_e.prototype.applyToRectangle=function(K){var Ee=this.applyToPoint(K),pt=this.applyToPoint(new Aa(K.x+K.w,K.y+K.h));return new Ea(Ee.x,Ee.y,pt.x-Ee.x,pt.y-Ee.y)},_e.prototype.clone=function(){var K=this.sx,Ee=this.shy,pt=this.shx,It=this.sy,Yt=this.tx,fn=this.ty;return new _e(K,Ee,pt,It,Yt,fn)},U.Matrix=_e;var Oe=U.matrixMult=function(K,Ee){return Ee.multiply(K)},Ye=new _e(1,0,0,1,0,0);U.unitMatrix=U.identityMatrix=Ye;var qe=function(K,Ee){if(!ml[K]){var pt=(Ee instanceof Om?"Sh":"P")+(Object.keys(lr).length+1).toString(10);Ee.id=pt,ml[K]=pt,lr[pt]=Ee,Ii.publish("addPattern",Ee)}};U.ShadingPattern=Om,U.TilingPattern=__,U.addShadingPattern=function(K,Ee){return Me("addShadingPattern()"),qe(K,Ee),this},U.beginTilingPattern=function(K){Me("beginTilingPattern()"),Va(K.boundingBox[0],K.boundingBox[1],K.boundingBox[2]-K.boundingBox[0],K.boundingBox[3]-K.boundingBox[1],K.matrix)},U.endTilingPattern=function(K,Ee){Me("endTilingPattern()"),Ee.stream=dn[Re].join(`
`),qe(K,Ee),Ii.publish("endTilingPattern",Ee),he.pop().restore()};var at=U.__private__.newObject=function(){var K=wt();return ct(K,!0),K},wt=U.__private__.newObjectDeferred=function(){return Et++,Ct[Et]=function(){return Ft},Et},ct=function(K,Ee){return Ee=typeof Ee=="boolean"&&Ee,Ct[K]=Ft,Ee&&_t(K+" 0 obj"),K},Mt=U.__private__.newAdditionalObject=function(){var K={objId:wt(),content:""};return me.push(K),K},Nt=wt(),Lt=wt(),sn=U.__private__.decodeColorString=function(K){var Ee=K.split(" ");if(Ee.length!==2||Ee[1]!=="g"&&Ee[1]!=="G")Ee.length===5&&(Ee[4]==="k"||Ee[4]==="K")&&(Ee=[(1-Ee[0])*(1-Ee[3]),(1-Ee[1])*(1-Ee[3]),(1-Ee[2])*(1-Ee[3]),"r"]);else{var pt=parseFloat(Ee[0]);Ee=[pt,pt,pt,"r"]}for(var It="#",Yt=0;Yt<3;Yt++)It+=("0"+Math.floor(255*parseFloat(Ee[Yt])).toString(16)).slice(-2);return It},pn=U.__private__.encodeColorString=function(K){var Ee;typeof K=="string"&&(K={ch1:K});var pt=K.ch1,It=K.ch2,Yt=K.ch3,fn=K.ch4,Mn=K.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof pt=="string"&&pt.charAt(0)!=="#"){var Wn=new oz(pt);if(Wn.ok)pt=Wn.toHex();else if(!/^\d*\.?\d*$/.test(pt))throw new Error('Invalid color "'+pt+'" passed to jsPDF.encodeColorString.')}if(typeof pt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(pt)&&(pt="#"+pt[1]+pt[1]+pt[2]+pt[2]+pt[3]+pt[3]),typeof pt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(pt)){var vr=parseInt(pt.substr(1),16);pt=vr>>16&255,It=vr>>8&255,Yt=255&vr}if(It===void 0||fn===void 0&&pt===It&&It===Yt)if(typeof pt=="string")Ee=pt+" "+Mn[0];else switch(K.precision){case 2:Ee=ot(pt/255)+" "+Mn[0];break;case 3:default:Ee=ve(pt/255)+" "+Mn[0]}else if(fn===void 0||cs(fn)==="object"){if(fn&&!isNaN(fn.a)&&fn.a===0)return Ee=["1.","1.","1.",Mn[1]].join(" ");if(typeof pt=="string")Ee=[pt,It,Yt,Mn[1]].join(" ");else switch(K.precision){case 2:Ee=[ot(pt/255),ot(It/255),ot(Yt/255),Mn[1]].join(" ");break;default:case 3:Ee=[ve(pt/255),ve(It/255),ve(Yt/255),Mn[1]].join(" ")}}else if(typeof pt=="string")Ee=[pt,It,Yt,fn,Mn[2]].join(" ");else switch(K.precision){case 2:Ee=[ot(pt),ot(It),ot(Yt),ot(fn),Mn[2]].join(" ");break;case 3:default:Ee=[ve(pt),ve(It),ve(Yt),ve(fn),Mn[2]].join(" ")}return Ee},yn=U.__private__.getFilters=function(){return v},$n=U.__private__.putStream=function(K){var Ee=(K=K||{}).data||"",pt=K.filters||yn(),It=K.alreadyAppliedFilters||[],Yt=K.addLength1||!1,fn=Ee.length,Mn=K.objectId,Wn=function(vs){return vs};if(O!==null&&Mn===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");O!==null&&(Wn=po.encryptor(Mn,0));var vr={};pt===!0&&(pt=["FlateEncode"]);var Mr=K.additionalKeyValues||[],Gr=(vr=Qr.API.processDataByFilters!==void 0?Qr.API.processDataByFilters(Ee,pt):{data:Ee,reverseChain:[]}).reverseChain+(Array.isArray(It)?It.join(" "):It.toString());if(vr.data.length!==0&&(Mr.push({key:"Length",value:vr.data.length}),Yt===!0&&Mr.push({key:"Length1",value:fn})),Gr.length!=0)if(Gr.split("/").length-1==1)Mr.push({key:"Filter",value:Gr});else{Mr.push({key:"Filter",value:"["+Gr+"]"});for(var Ci=0;Ci<Mr.length;Ci+=1)if(Mr[Ci].key==="DecodeParms"){for(var _s=[],ys=0;ys<vr.reverseChain.split("/").length-1;ys+=1)_s.push("null");_s.push(Mr[Ci].value),Mr[Ci].value="["+_s.join(" ")+"]"}}_t("<<");for(var Ws=0;Ws<Mr.length;Ws++)_t("/"+Mr[Ws].key+" "+Mr[Ws].value);_t(">>"),vr.data.length!==0&&(_t("stream"),_t(Wn(vr.data)),_t("endstream"))},er=U.__private__.putPage=function(K){var Ee=K.number,pt=K.data,It=K.objId,Yt=K.contentsObjId;ct(It,!0),_t("<</Type /Page"),_t("/Parent "+K.rootDictionaryObjId+" 0 R"),_t("/Resources "+K.resourceDictionaryObjId+" 0 R"),_t("/MediaBox ["+parseFloat(xe(K.mediaBox.bottomLeftX))+" "+parseFloat(xe(K.mediaBox.bottomLeftY))+" "+xe(K.mediaBox.topRightX)+" "+xe(K.mediaBox.topRightY)+"]"),K.cropBox!==null&&_t("/CropBox ["+xe(K.cropBox.bottomLeftX)+" "+xe(K.cropBox.bottomLeftY)+" "+xe(K.cropBox.topRightX)+" "+xe(K.cropBox.topRightY)+"]"),K.bleedBox!==null&&_t("/BleedBox ["+xe(K.bleedBox.bottomLeftX)+" "+xe(K.bleedBox.bottomLeftY)+" "+xe(K.bleedBox.topRightX)+" "+xe(K.bleedBox.topRightY)+"]"),K.trimBox!==null&&_t("/TrimBox ["+xe(K.trimBox.bottomLeftX)+" "+xe(K.trimBox.bottomLeftY)+" "+xe(K.trimBox.topRightX)+" "+xe(K.trimBox.topRightY)+"]"),K.artBox!==null&&_t("/ArtBox ["+xe(K.artBox.bottomLeftX)+" "+xe(K.artBox.bottomLeftY)+" "+xe(K.artBox.topRightX)+" "+xe(K.artBox.topRightY)+"]"),typeof K.userUnit=="number"&&K.userUnit!==1&&_t("/UserUnit "+K.userUnit),Ii.publish("putPage",{objId:It,pageContext:Rr[Ee],pageNumber:Ee,page:pt}),_t("/Contents "+Yt+" 0 R"),_t(">>"),_t("endobj");var fn=pt.join(`
`);return le===te.ADVANCED&&(fn+=`
Q`),ct(Yt,!0),$n({data:fn,filters:yn(),objectId:Yt}),_t("endobj"),It},or=U.__private__.putPages=function(){var K,Ee,pt=[];for(K=1;K<=ns;K++)Rr[K].objId=wt(),Rr[K].contentsObjId=wt();for(K=1;K<=ns;K++)pt.push(er({number:K,data:dn[K],objId:Rr[K].objId,contentsObjId:Rr[K].contentsObjId,mediaBox:Rr[K].mediaBox,cropBox:Rr[K].cropBox,bleedBox:Rr[K].bleedBox,trimBox:Rr[K].trimBox,artBox:Rr[K].artBox,userUnit:Rr[K].userUnit,rootDictionaryObjId:Nt,resourceDictionaryObjId:Lt}));ct(Nt,!0),_t("<</Type /Pages");var It="/Kids [";for(Ee=0;Ee<ns;Ee++)It+=pt[Ee]+" 0 R ";_t(It+"]"),_t("/Count "+ns),_t(">>"),_t("endobj"),Ii.publish("postPutPages")},ur=function(K){Ii.publish("putFont",{font:K,out:_t,newObject:at,putStream:$n}),K.isAlreadyPutted!==!0&&(K.objectNumber=at(),_t("<<"),_t("/Type /Font"),_t("/BaseFont /"+r_(K.postScriptName)),_t("/Subtype /Type1"),typeof K.encoding=="string"&&_t("/Encoding /"+K.encoding),_t("/FirstChar 32"),_t("/LastChar 255"),_t(">>"),_t("endobj"))},li=function(){for(var K in di)di.hasOwnProperty(K)&&(z===!1||z===!0&&G.hasOwnProperty(K))&&ur(di[K])},Si=function(K){K.objectNumber=at();var Ee=[];Ee.push({key:"Type",value:"/XObject"}),Ee.push({key:"Subtype",value:"/Form"}),Ee.push({key:"BBox",value:"["+[xe(K.x),xe(K.y),xe(K.x+K.width),xe(K.y+K.height)].join(" ")+"]"}),Ee.push({key:"Matrix",value:"["+K.matrix.toString()+"]"});var pt=K.pages[1].join(`
`);$n({data:pt,additionalKeyValues:Ee,objectId:K.objectNumber}),_t("endobj")},mr=function(){for(var K in Rs)Rs.hasOwnProperty(K)&&Si(Rs[K])},Vr=function(K,Ee){var pt,It=[],Yt=1/(Ee-1);for(pt=0;pt<1;pt+=Yt)It.push(pt);if(It.push(1),K[0].offset!=0){var fn={offset:0,color:K[0].color};K.unshift(fn)}if(K[K.length-1].offset!=1){var Mn={offset:1,color:K[K.length-1].color};K.push(Mn)}for(var Wn="",vr=0,Mr=0;Mr<It.length;Mr++){for(pt=It[Mr];pt>K[vr+1].offset;)vr++;var Gr=K[vr].offset,Ci=(pt-Gr)/(K[vr+1].offset-Gr),_s=K[vr].color,ys=K[vr+1].color;Wn+=ut(Math.round((1-Ci)*_s[0]+Ci*ys[0]).toString(16))+ut(Math.round((1-Ci)*_s[1]+Ci*ys[1]).toString(16))+ut(Math.round((1-Ci)*_s[2]+Ci*ys[2]).toString(16))}return Wn.trim()},Xr=function(K,Ee){Ee||(Ee=21);var pt=at(),It=Vr(K.colors,Ee),Yt=[];Yt.push({key:"FunctionType",value:"0"}),Yt.push({key:"Domain",value:"[0.0 1.0]"}),Yt.push({key:"Size",value:"["+Ee+"]"}),Yt.push({key:"BitsPerSample",value:"8"}),Yt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Yt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),$n({data:It,additionalKeyValues:Yt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:pt}),_t("endobj"),K.objectNumber=at(),_t("<< /ShadingType "+K.type),_t("/ColorSpace /DeviceRGB");var fn="/Coords ["+xe(parseFloat(K.coords[0]))+" "+xe(parseFloat(K.coords[1]))+" ";K.type===2?fn+=xe(parseFloat(K.coords[2]))+" "+xe(parseFloat(K.coords[3])):fn+=xe(parseFloat(K.coords[2]))+" "+xe(parseFloat(K.coords[3]))+" "+xe(parseFloat(K.coords[4]))+" "+xe(parseFloat(K.coords[5])),_t(fn+="]"),K.matrix&&_t("/Matrix ["+K.matrix.toString()+"]"),_t("/Function "+pt+" 0 R"),_t("/Extend [true true]"),_t(">>"),_t("endobj")},ti=function(K,Ee){var pt=wt(),It=at();Ee.push({resourcesOid:pt,objectOid:It}),K.objectNumber=It;var Yt=[];Yt.push({key:"Type",value:"/Pattern"}),Yt.push({key:"PatternType",value:"1"}),Yt.push({key:"PaintType",value:"1"}),Yt.push({key:"TilingType",value:"1"}),Yt.push({key:"BBox",value:"["+K.boundingBox.map(xe).join(" ")+"]"}),Yt.push({key:"XStep",value:xe(K.xStep)}),Yt.push({key:"YStep",value:xe(K.yStep)}),Yt.push({key:"Resources",value:pt+" 0 R"}),K.matrix&&Yt.push({key:"Matrix",value:"["+K.matrix.toString()+"]"}),$n({data:K.stream,additionalKeyValues:Yt,objectId:K.objectNumber}),_t("endobj")},Oi=function(K){var Ee;for(Ee in lr)lr.hasOwnProperty(Ee)&&(lr[Ee]instanceof Om?Xr(lr[Ee]):lr[Ee]instanceof __&&ti(lr[Ee],K))},ms=function(K){for(var Ee in K.objectNumber=at(),_t("<<"),K)switch(Ee){case"opacity":_t("/ca "+ot(K[Ee]));break;case"stroke-opacity":_t("/CA "+ot(K[Ee]))}_t(">>"),_t("endobj")},to=function(){var K;for(K in Yi)Yi.hasOwnProperty(K)&&ms(Yi[K])},No=function(){for(var K in _t("/XObject <<"),Rs)Rs.hasOwnProperty(K)&&Rs[K].objectNumber>=0&&_t("/"+K+" "+Rs[K].objectNumber+" 0 R");Ii.publish("putXobjectDict"),_t(">>")},fo=function(){po.oid=at(),_t("<<"),_t("/Filter /Standard"),_t("/V "+po.v),_t("/R "+po.r),_t("/U <"+po.toHexString(po.U)+">"),_t("/O <"+po.toHexString(po.O)+">"),_t("/P "+po.P),_t(">>"),_t("endobj")},gs=function(){for(var K in _t("/Font <<"),di)di.hasOwnProperty(K)&&(z===!1||z===!0&&G.hasOwnProperty(K))&&_t("/"+K+" "+di[K].objectNumber+" 0 R");_t(">>")},Ds=function(){if(Object.keys(lr).length>0){for(var K in _t("/Shading <<"),lr)lr.hasOwnProperty(K)&&lr[K]instanceof Om&&lr[K].objectNumber>=0&&_t("/"+K+" "+lr[K].objectNumber+" 0 R");Ii.publish("putShadingPatternDict"),_t(">>")}},gl=function(K){if(Object.keys(lr).length>0){for(var Ee in _t("/Pattern <<"),lr)lr.hasOwnProperty(Ee)&&lr[Ee]instanceof U.TilingPattern&&lr[Ee].objectNumber>=0&&lr[Ee].objectNumber<K&&_t("/"+Ee+" "+lr[Ee].objectNumber+" 0 R");Ii.publish("putTilingPatternDict"),_t(">>")}},ua=function(){if(Object.keys(Yi).length>0){var K;for(K in _t("/ExtGState <<"),Yi)Yi.hasOwnProperty(K)&&Yi[K].objectNumber>=0&&_t("/"+K+" "+Yi[K].objectNumber+" 0 R");Ii.publish("putGStateDict"),_t(">>")}},Wi=function(K){ct(K.resourcesOid,!0),_t("<<"),_t("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),gs(),Ds(),gl(K.objectOid),ua(),No(),_t(">>"),_t("endobj")},yh=function(){var K=[];li(),to(),mr(),Oi(K),Ii.publish("putResources"),K.forEach(Wi),Wi({resourcesOid:Lt,objectOid:Number.MAX_SAFE_INTEGER}),Ii.publish("postPutResources")},Eu=function(){Ii.publish("putAdditionalObjects");for(var K=0;K<me.length;K++){var Ee=me[K];ct(Ee.objId,!0),_t(Ee.content),_t("endobj")}Ii.publish("postPutAdditionalObjects")},Xc=function(K){Hi[K.fontName]=Hi[K.fontName]||{},Hi[K.fontName][K.fontStyle]=K.id},Gl=function(K,Ee,pt,It,Yt){var fn={id:"F"+(Object.keys(di).length+1).toString(10),postScriptName:K,fontName:Ee,fontStyle:pt,encoding:It,isStandardFont:Yt||!1,metadata:{}};return Ii.publish("addFont",{font:fn,instance:this}),di[fn.id]=fn,Xc(fn),fn.id},dd=function(K){for(var Ee=0,pt=bn.length;Ee<pt;Ee++){var It=Gl.call(this,K[Ee][0],K[Ee][1],K[Ee][2],bn[Ee][3],!0);z===!1&&(G[It]=!0);var Yt=K[Ee][0].split("-");Xc({id:It,fontName:Yt[0],fontStyle:Yt[1]||""})}Ii.publish("addFonts",{fonts:di,dictionary:Hi})},Ba=function(K){return K.foo=function(){try{return K.apply(this,arguments)}catch(It){var Ee=It.stack||"";~Ee.indexOf(" at ")&&(Ee=Ee.split(" at ")[1]);var pt="Error in function "+Ee.split(`
`)[0].split("<")[0]+": "+It.message;if(!ei.console)throw new Error(pt);ei.console.error(pt,It),ei.alert&&alert(pt)}},K.foo.bar=K,K.foo},Cu=function(K,Ee){var pt,It,Yt,fn,Mn,Wn,vr,Mr,Gr;if(Yt=(Ee=Ee||{}).sourceEncoding||"Unicode",Mn=Ee.outputEncoding,(Ee.autoencode||Mn)&&di[Ur].metadata&&di[Ur].metadata[Yt]&&di[Ur].metadata[Yt].encoding&&(fn=di[Ur].metadata[Yt].encoding,!Mn&&di[Ur].encoding&&(Mn=di[Ur].encoding),!Mn&&fn.codePages&&(Mn=fn.codePages[0]),typeof Mn=="string"&&(Mn=fn[Mn]),Mn)){for(vr=!1,Wn=[],pt=0,It=K.length;pt<It;pt++)(Mr=Mn[K.charCodeAt(pt)])?Wn.push(String.fromCharCode(Mr)):Wn.push(K[pt]),Wn[pt].charCodeAt(0)>>8&&(vr=!0);K=Wn.join("")}for(pt=K.length;vr===void 0&&pt!==0;)K.charCodeAt(pt-1)>>8&&(vr=!0),pt--;if(!vr)return K;for(Wn=Ee.noBOM?[]:[254,255],pt=0,It=K.length;pt<It;pt++){if((Gr=(Mr=K.charCodeAt(pt))>>8)>>8)throw new Error("Character at position "+pt+" of string '"+K+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Wn.push(Gr),Wn.push(Mr-(Gr<<8))}return String.fromCharCode.apply(void 0,Wn)},Oo=U.__private__.pdfEscape=U.pdfEscape=function(K,Ee){return Cu(K,Ee).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Hl=U.__private__.beginPage=function(K){dn[++ns]=[],Rr[ns]={objId:0,contentsObjId:0,userUnit:Number(i),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(K[0]),topRightY:Number(K[1])}},_l(ns),cn(dn[Re])},zo=function(K,Ee){var pt,It,Yt;switch(s=Ee||s,typeof K=="string"&&(pt=J(K.toLowerCase()),Array.isArray(pt)&&(It=pt[0],Yt=pt[1])),Array.isArray(K)&&(It=K[0]*Kn,Yt=K[1]*Kn),isNaN(It)&&(It=d[0],Yt=d[1]),(It>14400||Yt>14400)&&(Ts.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),It=Math.min(14400,It),Yt=Math.min(14400,Yt)),d=[It,Yt],s.substr(0,1)){case"l":Yt>It&&(d=[Yt,It]);break;case"p":It>Yt&&(d=[Yt,It])}Hl(d),xc(Ui),_t(Ko),ku!==0&&_t(ku+" J"),To!==0&&_t(To+" j"),Ii.publish("addPage",{pageNumber:ns})},Sa=function(K){K>0&&K<=ns&&(dn.splice(K,1),Rr.splice(K,1),ns--,Re>ns&&(Re=ns),this.setPage(Re))},_l=function(K){K>0&&K<=ns&&(Re=K)},Wo=U.__private__.getNumberOfPages=U.getNumberOfPages=function(){return dn.length-1},bo=function(K,Ee,pt){var It,Yt=void 0;return pt=pt||{},K=K!==void 0?K:di[Ur].fontName,Ee=Ee!==void 0?Ee:di[Ur].fontStyle,It=K.toLowerCase(),Hi[It]!==void 0&&Hi[It][Ee]!==void 0?Yt=Hi[It][Ee]:Hi[K]!==void 0&&Hi[K][Ee]!==void 0?Yt=Hi[K][Ee]:pt.disableWarning===!1&&Ts.warn("Unable to look up font label for font '"+K+"', '"+Ee+"'. Refer to getFontList() for available fonts."),Yt||pt.noFallback||(Yt=Hi.times[Ee])==null&&(Yt=Hi.times.normal),Yt},Yc=U.__private__.putInfo=function(){var K=at(),Ee=function(It){return It};for(var pt in O!==null&&(Ee=po.encryptor(K,0)),_t("<<"),_t("/Producer ("+Oo(Ee("jsPDF "+Qr.version))+")"),wr)wr.hasOwnProperty(pt)&&wr[pt]&&_t("/"+pt.substr(0,1).toUpperCase()+pt.substr(1)+" ("+Oo(Ee(wr[pt]))+")");_t("/CreationDate ("+Oo(Ee(yt))+")"),_t(">>"),_t("endobj")},Pu=U.__private__.putCatalog=function(K){var Ee=(K=K||{}).rootDictionaryObjId||Nt;switch(at(),_t("<<"),_t("/Type /Catalog"),_t("/Pages "+Ee+" 0 R"),Gn||(Gn="fullwidth"),Gn){case"fullwidth":_t("/OpenAction [3 0 R /FitH null]");break;case"fullheight":_t("/OpenAction [3 0 R /FitV null]");break;case"fullpage":_t("/OpenAction [3 0 R /Fit]");break;case"original":_t("/OpenAction [3 0 R /XYZ null null 1]");break;default:var pt=""+Gn;pt.substr(pt.length-1)==="%"&&(Gn=parseInt(Gn)/100),typeof Gn=="number"&&_t("/OpenAction [3 0 R /XYZ null null "+ot(Gn)+"]")}switch(Kr||(Kr="continuous"),Kr){case"continuous":_t("/PageLayout /OneColumn");break;case"single":_t("/PageLayout /SinglePage");break;case"two":case"twoleft":_t("/PageLayout /TwoColumnLeft");break;case"tworight":_t("/PageLayout /TwoColumnRight")}Ln&&_t("/PageMode /"+Ln),Ii.publish("putCatalog"),_t(">>"),_t("endobj")},vh=U.__private__.putTrailer=function(){_t("trailer"),_t("<<"),_t("/Size "+(Et+1)),_t("/Root "+Et+" 0 R"),_t("/Info "+(Et-1)+" 0 R"),O!==null&&_t("/Encrypt "+po.oid+" 0 R"),_t("/ID [ <"+St+"> <"+St+"> ]"),_t(">>")},Ta=U.__private__.putHeader=function(){_t("%PDF-"+ie),_t("%ºß¬à")},wo=U.__private__.putXRef=function(){var K="0000000000";_t("xref"),_t("0 "+(Et+1)),_t("0000000000 65535 f ");for(var Ee=1;Ee<=Et;Ee++)typeof Ct[Ee]=="function"?_t((K+Ct[Ee]()).slice(-10)+" 00000 n "):Ct[Ee]!==void 0?_t((K+Ct[Ee]).slice(-10)+" 00000 n "):_t("0000000000 00000 n ")},Wl=U.__private__.buildDocument=function(){$t(),cn(Wt),Ii.publish("buildDocument"),Ta(),or(),Eu(),yh(),O!==null&&fo(),Yc(),Pu();var K=Ft;return wo(),vh(),_t("startxref"),_t(""+K),_t("%%EOF"),cn(dn[Re]),Wt.join(`
`)},Jc=U.__private__.getBlob=function(K){return new Blob([En(K)],{type:"application/pdf"})},So=U.output=U.__private__.output=Ba(function(K,Ee){switch(typeof(Ee=Ee||{})=="string"?Ee={filename:Ee}:Ee.filename=Ee.filename||"generated.pdf",K){case void 0:return Wl();case"save":U.save(Ee.filename);break;case"arraybuffer":return En(Wl());case"blob":return Jc(Wl());case"bloburi":case"bloburl":if(ei.URL!==void 0&&typeof ei.URL.createObjectURL=="function")return ei.URL&&ei.URL.createObjectURL(Jc(Wl()))||void 0;Ts.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var pt="",It=Wl();try{pt=UT(It)}catch{pt=UT(unescape(encodeURIComponent(It)))}return"data:application/pdf;filename="+Ee.filename+";base64,"+pt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ei)==="[object Window]"){var Yt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",fn=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ee.pdfObjectUrl&&(Yt=Ee.pdfObjectUrl,fn="");var Mn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Yt+'"'+fn+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ee)+");<\/script></body></html>",Wn=ei.open();return Wn!==null&&Wn.document.write(Mn),Wn}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ei)==="[object Window]"){var vr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ee.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ee.filename+'" width="500px" height="400px" /></body></html>',Mr=ei.open();if(Mr!==null){Mr.document.write(vr);var Gr=this;Mr.document.documentElement.querySelector("#pdfViewer").onload=function(){Mr.document.title=Ee.filename,Mr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Gr.output("bloburl"))}}return Mr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ei)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Ci='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ee)+'"></iframe></body></html>',_s=ei.open();if(_s!==null&&(_s.document.write(Ci),_s.document.title=Ee.filename),_s||typeof safari>"u")return _s;break;case"datauri":case"dataurl":return ei.document.location.href=this.output("datauristring",Ee);default:return null}}),qr=function(K){return Array.isArray($l)===!0&&$l.indexOf(K)>-1};switch(a){case"pt":Kn=1;break;case"mm":Kn=72/25.4;break;case"cm":Kn=72/2.54;break;case"in":Kn=72;break;case"px":Kn=qr("px_scaling")==1?.75:96/72;break;case"pc":case"em":Kn=12;break;case"ex":Kn=6;break;default:if(typeof a!="number")throw new Error("Invalid unit: "+a);Kn=a}var po=null;Vt(),et();var Bn=function(K){return O!==null?po.encryptor(K,0):function(Ee){return Ee}},fd=U.__private__.getPageInfo=U.getPageInfo=function(K){if(isNaN(K)||K%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Rr[K].objId,pageNumber:K,pageContext:Rr[K]}},$r=U.__private__.getPageInfoByObjId=function(K){if(isNaN(K)||K%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ee in Rr)if(Rr[Ee].objId===K)break;return fd(Ee)},Mu=U.__private__.getCurrentPageInfo=U.getCurrentPageInfo=function(){return{objId:Rr[Re].objId,pageNumber:Re,pageContext:Rr[Re]}};U.addPage=function(){return zo.apply(this,arguments),this},U.setPage=function(){return _l.apply(this,arguments),cn.call(this,dn[Re]),this},U.insertPage=function(K){return this.addPage(),this.movePage(Re,K),this},U.movePage=function(K,Ee){var pt,It;if(K>Ee){pt=dn[K],It=Rr[K];for(var Yt=K;Yt>Ee;Yt--)dn[Yt]=dn[Yt-1],Rr[Yt]=Rr[Yt-1];dn[Ee]=pt,Rr[Ee]=It,this.setPage(Ee)}else if(K<Ee){pt=dn[K],It=Rr[K];for(var fn=K;fn<Ee;fn++)dn[fn]=dn[fn+1],Rr[fn]=Rr[fn+1];dn[Ee]=pt,Rr[Ee]=It,this.setPage(Ee)}return this},U.deletePage=function(){return Sa.apply(this,arguments),this},U.__private__.text=U.text=function(K,Ee,pt,It,Yt){var fn,Mn,Wn,vr,Mr,Gr,Ci,_s,ys,Ws=(It=It||{}).scope||this;if(typeof K=="number"&&typeof Ee=="number"&&(typeof pt=="string"||Array.isArray(pt))){var vs=pt;pt=Ee,Ee=K,K=vs}if(arguments[3]instanceof _e?(Me("The transform parameter of text() with a Matrix value"),ys=Yt):(Wn=arguments[4],vr=arguments[5],cs(Ci=arguments[3])==="object"&&Ci!==null||(typeof Wn=="string"&&(vr=Wn,Wn=null),typeof Ci=="string"&&(vr=Ci,Ci=null),typeof Ci=="number"&&(Wn=Ci,Ci=null),It={flags:Ci,angle:Wn,align:vr})),isNaN(Ee)||isNaN(pt)||K==null)throw new Error("Invalid arguments passed to jsPDF.text");if(K.length===0)return Ws;var Jn="",Rn=!1,Bo=typeof It.lineHeightFactor=="number"?It.lineHeightFactor:hs,Hn=Ws.internal.scaleFactor;function qa(Vi){return Vi=Vi.split("	").join(Array(It.TabLen||9).join(" ")),Oo(Vi,Ci)}function Zl(Vi){for(var Pi,es=Vi.concat(),fs=[],Sl=es.length;Sl--;)typeof(Pi=es.shift())=="string"?fs.push(Pi):Array.isArray(Vi)&&(Pi.length===1||Pi[1]===void 0&&Pi[2]===void 0)?fs.push(Pi[0]):fs.push([Pi[0],Pi[1],Pi[2]]);return fs}function Xn(Vi,Pi){var es;if(typeof Vi=="string")es=Pi(Vi)[0];else if(Array.isArray(Vi)){for(var fs,Sl,iu=Vi.concat(),rc=[],Ma=iu.length;Ma--;)typeof(fs=iu.shift())=="string"?rc.push(Pi(fs)[0]):Array.isArray(fs)&&typeof fs[0]=="string"&&(Sl=Pi(fs[0],fs[1],fs[2]),rc.push([Sl[0],Sl[1],Sl[2]]));es=rc}return es}var eu=!1,vl=!0;if(typeof K=="string")eu=!0;else if(Array.isArray(K)){var Kl=K.concat();Mn=[];for(var tu,Cs=Kl.length;Cs--;)(typeof(tu=Kl.shift())!="string"||Array.isArray(tu)&&typeof tu[0]!="string")&&(vl=!1);eu=vl}if(eu===!1)throw new Error('Type of text must be string or Array. "'+K+'" is not recognized.');typeof K=="string"&&(K=K.match(/[\r?\n]/)?K.split(/\r\n|\r|\n/g):[K]);var Di=Fn/Ws.internal.scaleFactor,Xl=Di*(Bo-1);switch(It.baseline){case"bottom":pt-=Xl;break;case"top":pt+=Di-Xl;break;case"hanging":pt+=Di-2*Xl;break;case"middle":pt+=Di/2-Xl}if((Gr=It.maxWidth||0)>0&&(typeof K=="string"?K=Ws.splitTextToSize(K,Gr):Object.prototype.toString.call(K)==="[object Array]"&&(K=K.reduce(function(Vi,Pi){return Vi.concat(Ws.splitTextToSize(Pi,Gr))},[]))),fn={text:K,x:Ee,y:pt,options:It,mutex:{pdfEscape:Oo,activeFontKey:Ur,fonts:di,activeFontSize:Fn}},Ii.publish("preProcessText",fn),K=fn.text,Wn=(It=fn.options).angle,!(ys instanceof _e)&&Wn&&typeof Wn=="number"){Wn*=Math.PI/180,It.rotationDirection===0&&(Wn=-Wn),le===te.ADVANCED&&(Wn=-Wn);var un=Math.cos(Wn),nu=Math.sin(Wn);ys=new _e(un,nu,-nu,un,0,0)}else Wn&&Wn instanceof _e&&(ys=Wn);le!==te.ADVANCED||ys||(ys=Ye),(Mr=It.charSpace||da)!==void 0&&(Jn+=xe(Le(Mr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(_s=It.horizontalScale)!==void 0&&(Jn+=xe(100*_s)+` Tz
`),It.lang;var Ps=-1,Zs=It.renderingMode!==void 0?It.renderingMode:It.stroke,wh=Ws.internal.getCurrentPageInfo().pageContext;switch(Zs){case 0:case!1:case"fill":Ps=0;break;case 1:case!0:case"stroke":Ps=1;break;case 2:case"fillThenStroke":Ps=2;break;case 3:case"invisible":Ps=3;break;case 4:case"fillAndAddForClipping":Ps=4;break;case 5:case"strokeAndAddPathForClipping":Ps=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Ps=6;break;case 7:case"addToPathForClipping":Ps=7}var Ru=wh.usedRenderingMode!==void 0?wh.usedRenderingMode:-1;Ps!==-1?Jn+=Ps+` Tr
`:Ru!==-1&&(Jn+=`0 Tr
`),Ps!==-1&&(wh.usedRenderingMode=Ps),vr=It.align||"left";var Ks,xl=Fn*Bo,bl=Ws.internal.pageSize.getWidth(),Tc=di[Ur];Mr=It.charSpace||da,Gr=It.maxWidth||0,Ci=Object.assign({autoencode:!0,noBOM:!0},It.flags);var Ca=[],Du=function(Vi){return Ws.getStringUnitWidth(Vi,{font:Tc,charSpace:Mr,fontSize:Fn,doKerning:!1})*Fn/Hn};if(Object.prototype.toString.call(K)==="[object Array]"){var pa;Mn=Zl(K),vr!=="left"&&(Ks=Mn.map(Du));var Ao,Ac=0;if(vr==="right"){Ee-=Ks[0],K=[],Cs=Mn.length;for(var Yl=0;Yl<Cs;Yl++)Yl===0?(Ao=ha(Ee),pa=ls(pt)):(Ao=Le(Ac-Ks[Yl]),pa=-xl),K.push([Mn[Yl],Ao,pa]),Ac=Ks[Yl]}else if(vr==="center"){Ee-=Ks[0]/2,K=[],Cs=Mn.length;for(var Jl=0;Jl<Cs;Jl++)Jl===0?(Ao=ha(Ee),pa=ls(pt)):(Ao=Le((Ac-Ks[Jl])/2),pa=-xl),K.push([Mn[Jl],Ao,pa]),Ac=Ks[Jl]}else if(vr==="left"){K=[],Cs=Mn.length;for(var Ec=0;Ec<Cs;Ec++)K.push(Mn[Ec])}else if(vr==="justify"&&Tc.encoding==="Identity-H"){K=[],Cs=Mn.length,Gr=Gr!==0?Gr:bl;for(var Cc=0,Qi=0;Qi<Cs;Qi++)if(pa=Qi===0?ls(pt):-xl,Ao=Qi===0?ha(Ee):Cc,Qi<Cs-1){var gd=Le((Gr-Ks[Qi])/(Mn[Qi].split(" ").length-1)),Yo=Mn[Qi].split(" ");K.push([Yo[0]+" ",Ao,pa]),Cc=0;for(var Jo=1;Jo<Yo.length;Jo++){var Nu=(Du(Yo[Jo-1]+" "+Yo[Jo])-Du(Yo[Jo]))*Hn+gd;Jo==Yo.length-1?K.push([Yo[Jo],Nu,0]):K.push([Yo[Jo]+" ",Nu,0]),Cc-=Nu}}else K.push([Mn[Qi],Ao,pa]);K.push(["",Cc,0])}else{if(vr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(K=[],Cs=Mn.length,Gr=Gr!==0?Gr:bl,Qi=0;Qi<Cs;Qi++)pa=Qi===0?ls(pt):-xl,Ao=Qi===0?ha(Ee):0,Qi<Cs-1?Ca.push(xe(Le((Gr-Ks[Qi])/(Mn[Qi].split(" ").length-1)))):Ca.push(0),K.push([Mn[Qi],Ao,pa])}}var ru=typeof It.R2L=="boolean"?It.R2L:pr;ru===!0&&(K=Xn(K,function(Vi,Pi,es){return[Vi.split("").reverse().join(""),Pi,es]})),fn={text:K,x:Ee,y:pt,options:It,mutex:{pdfEscape:Oo,activeFontKey:Ur,fonts:di,activeFontSize:Fn}},Ii.publish("postProcessText",fn),K=fn.text,Rn=fn.mutex.isHex||!1;var Qo=di[Ur].encoding;Qo!=="WinAnsiEncoding"&&Qo!=="StandardEncoding"||(K=Xn(K,function(Vi,Pi,es){return[qa(Vi),Pi,es]})),Mn=Zl(K),K=[];for(var Pc,Ql,$a,ec=0,Pa=1,tc=Array.isArray(Mn[0])?Pa:ec,nc="",wl=function(Vi,Pi,es){var fs="";return es instanceof _e?(es=typeof It.angle=="number"?Oe(es,new _e(1,0,0,1,Vi,Pi)):Oe(new _e(1,0,0,1,Vi,Pi),es),le===te.ADVANCED&&(es=Oe(new _e(1,0,0,-1,0,0),es)),fs=es.join(" ")+` Tm
`):fs=xe(Vi)+" "+xe(Pi)+` Td
`,fs},Eo=0;Eo<Mn.length;Eo++){switch(nc="",tc){case Pa:$a=(Rn?"<":"(")+Mn[Eo][0]+(Rn?">":")"),Pc=parseFloat(Mn[Eo][1]),Ql=parseFloat(Mn[Eo][2]);break;case ec:$a=(Rn?"<":"(")+Mn[Eo]+(Rn?">":")"),Pc=ha(Ee),Ql=ls(pt)}Ca!==void 0&&Ca[Eo]!==void 0&&(nc=Ca[Eo]+` Tw
`),Eo===0?K.push(nc+wl(Pc,Ql,ys)+$a):tc===ec?K.push(nc+$a):tc===Pa&&K.push(nc+wl(Pc,Ql,ys)+$a)}K=tc===ec?K.join(` Tj
T* `):K.join(` Tj
`),K+=` Tj
`;var jo=`BT
/`;return jo+=Ur+" "+Fn+` Tf
`,jo+=xe(Fn*Bo)+` TL
`,jo+=Zi+`
`,jo+=Jn,jo+=K,_t(jo+="ET"),G[Ur]=!0,Ws};var zr=U.__private__.clip=U.clip=function(K){return _t(K==="evenodd"?"W*":"W"),this};U.clipEvenOdd=function(){return zr("evenodd")},U.__private__.discardPath=U.discardPath=function(){return _t("n"),this};var Ns=U.__private__.isValidStyle=function(K){var Ee=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(K)!==-1&&(Ee=!0),Ee};U.__private__.setDefaultPathOperation=U.setDefaultPathOperation=function(K){return Ns(K)&&(k=K),this};var Iu=U.__private__.getStyle=U.getStyle=function(K){var Ee=k;switch(K){case"D":case"S":Ee="S";break;case"F":Ee="f";break;case"FD":case"DF":Ee="B";break;case"f":case"f*":case"B":case"B*":Ee=K}return Ee},vc=U.close=function(){return _t("h"),this};U.stroke=function(){return _t("S"),this},U.fill=function(K){return In("f",K),this},U.fillEvenOdd=function(K){return In("f*",K),this},U.fillStroke=function(K){return In("B",K),this},U.fillStrokeEvenOdd=function(K){return In("B*",K),this};var In=function(K,Ee){cs(Ee)==="object"?no(Ee,K):_t(K)},Fr=function(K){K===null||le===te.ADVANCED&&K===void 0||(K=Iu(K),_t(K))};function Dr(K,Ee,pt,It,Yt){var fn=new __(Ee||this.boundingBox,pt||this.xStep,It||this.yStep,this.gState,Yt||this.matrix);fn.stream=this.stream;var Mn=K+"$$"+this.cloneIndex+++"$$";return qe(Mn,fn),fn}var no=function(K,Ee){var pt=ml[K.key],It=lr[pt];if(It instanceof Om)_t("q"),_t(Qc(Ee)),It.gState&&U.setGState(It.gState),_t(K.matrix.toString()+" cm"),_t("/"+pt+" sh"),_t("Q");else if(It instanceof __){var Yt=new _e(1,0,0,-1,0,fa());K.matrix&&(Yt=Yt.multiply(K.matrix||Ye),pt=Dr.call(It,K.key,K.boundingBox,K.xStep,K.yStep,Yt).id),_t("q"),_t("/Pattern cs"),_t("/"+pt+" scn"),It.gState&&U.setGState(It.gState),_t(Ee),_t("Q")}},Qc=function(K){switch(K){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},Pr=U.moveTo=function(K,Ee){return _t(xe(Le(K))+" "+xe(Je(Ee))+" m"),this},Zo=U.lineTo=function(K,Ee){return _t(xe(Le(K))+" "+xe(Je(Ee))+" l"),this},ja=U.curveTo=function(K,Ee,pt,It,Yt,fn){return _t([xe(Le(K)),xe(Je(Ee)),xe(Le(pt)),xe(Je(It)),xe(Le(Yt)),xe(Je(fn)),"c"].join(" ")),this};U.__private__.line=U.line=function(K,Ee,pt,It,Yt){if(isNaN(K)||isNaN(Ee)||isNaN(pt)||isNaN(It)||!Ns(Yt))throw new Error("Invalid arguments passed to jsPDF.line");return le===te.COMPAT?this.lines([[pt-K,It-Ee]],K,Ee,[1,1],Yt||"S"):this.lines([[pt-K,It-Ee]],K,Ee,[1,1]).stroke()},U.__private__.lines=U.lines=function(K,Ee,pt,It,Yt,fn){var Mn,Wn,vr,Mr,Gr,Ci,_s,ys,Ws,vs,Jn,Rn;if(typeof K=="number"&&(Rn=pt,pt=Ee,Ee=K,K=Rn),It=It||[1,1],fn=fn||!1,isNaN(Ee)||isNaN(pt)||!Array.isArray(K)||!Array.isArray(It)||!Ns(Yt)||typeof fn!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Pr(Ee,pt),Mn=It[0],Wn=It[1],Mr=K.length,vs=Ee,Jn=pt,vr=0;vr<Mr;vr++)(Gr=K[vr]).length===2?(vs=Gr[0]*Mn+vs,Jn=Gr[1]*Wn+Jn,Zo(vs,Jn)):(Ci=Gr[0]*Mn+vs,_s=Gr[1]*Wn+Jn,ys=Gr[2]*Mn+vs,Ws=Gr[3]*Wn+Jn,vs=Gr[4]*Mn+vs,Jn=Gr[5]*Wn+Jn,ja(Ci,_s,ys,Ws,vs,Jn));return fn&&vc(),Fr(Yt),this},U.path=function(K){for(var Ee=0;Ee<K.length;Ee++){var pt=K[Ee],It=pt.c;switch(pt.op){case"m":Pr(It[0],It[1]);break;case"l":Zo(It[0],It[1]);break;case"c":ja.apply(this,It);break;case"h":vc()}}return this},U.__private__.rect=U.rect=function(K,Ee,pt,It,Yt){if(isNaN(K)||isNaN(Ee)||isNaN(pt)||isNaN(It)||!Ns(Yt))throw new Error("Invalid arguments passed to jsPDF.rect");return le===te.COMPAT&&(It=-It),_t([xe(Le(K)),xe(Je(Ee)),xe(Le(pt)),xe(Le(It)),"re"].join(" ")),Fr(Yt),this},U.__private__.triangle=U.triangle=function(K,Ee,pt,It,Yt,fn,Mn){if(isNaN(K)||isNaN(Ee)||isNaN(pt)||isNaN(It)||isNaN(Yt)||isNaN(fn)||!Ns(Mn))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[pt-K,It-Ee],[Yt-pt,fn-It],[K-Yt,Ee-fn]],K,Ee,[1,1],Mn,!0),this},U.__private__.roundedRect=U.roundedRect=function(K,Ee,pt,It,Yt,fn,Mn){if(isNaN(K)||isNaN(Ee)||isNaN(pt)||isNaN(It)||isNaN(Yt)||isNaN(fn)||!Ns(Mn))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Wn=4/3*(Math.SQRT2-1);return Yt=Math.min(Yt,.5*pt),fn=Math.min(fn,.5*It),this.lines([[pt-2*Yt,0],[Yt*Wn,0,Yt,fn-fn*Wn,Yt,fn],[0,It-2*fn],[0,fn*Wn,-Yt*Wn,fn,-Yt,fn],[2*Yt-pt,0],[-Yt*Wn,0,-Yt,-fn*Wn,-Yt,-fn],[0,2*fn-It],[0,-fn*Wn,Yt*Wn,-fn,Yt,-fn]],K+Yt,Ee,[1,1],Mn,!0),this},U.__private__.ellipse=U.ellipse=function(K,Ee,pt,It,Yt){if(isNaN(K)||isNaN(Ee)||isNaN(pt)||isNaN(It)||!Ns(Yt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var fn=4/3*(Math.SQRT2-1)*pt,Mn=4/3*(Math.SQRT2-1)*It;return Pr(K+pt,Ee),ja(K+pt,Ee-Mn,K+fn,Ee-It,K,Ee-It),ja(K-fn,Ee-It,K-pt,Ee-Mn,K-pt,Ee),ja(K-pt,Ee+Mn,K-fn,Ee+It,K,Ee+It),ja(K+fn,Ee+It,K+pt,Ee+Mn,K+pt,Ee),Fr(Yt),this},U.__private__.circle=U.circle=function(K,Ee,pt,It){if(isNaN(K)||isNaN(Ee)||isNaN(pt)||!Ns(It))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(K,Ee,pt,pt,It)},U.setFont=function(K,Ee,pt){return pt&&(Ee=rt(Ee,pt)),Ur=bo(K,Ee,{disableWarning:!1}),this};var yl=U.__private__.getFont=U.getFont=function(){return di[bo.apply(U,arguments)]};U.__private__.getFontList=U.getFontList=function(){var K,Ee,pt={};for(K in Hi)if(Hi.hasOwnProperty(K))for(Ee in pt[K]=[],Hi[K])Hi[K].hasOwnProperty(Ee)&&pt[K].push(Ee);return pt},U.addFont=function(K,Ee,pt,It,Yt){var fn=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&fn.indexOf(arguments[3])!==-1?Yt=arguments[3]:arguments[3]&&fn.indexOf(arguments[3])==-1&&(pt=rt(pt,It)),Yt=Yt||"Identity-H",Gl.call(this,K,Ee,pt,Yt)};var hs,Ui=t.lineWidth||.200025,Fo=U.__private__.getLineWidth=U.getLineWidth=function(){return Ui},xc=U.__private__.setLineWidth=U.setLineWidth=function(K){return Ui=K,_t(xe(Le(K))+" w"),this};U.__private__.setLineDash=Qr.API.setLineDash=Qr.API.setLineDashPattern=function(K,Ee){if(K=K||[],Ee=Ee||0,isNaN(Ee)||!Array.isArray(K))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return K=K.map(function(pt){return xe(Le(pt))}).join(" "),Ee=xe(Le(Ee)),_t("["+K+"] "+Ee+" d"),this};var xh=U.__private__.getLineHeight=U.getLineHeight=function(){return Fn*hs};U.__private__.getLineHeight=U.getLineHeight=function(){return Fn*hs};var bc=U.__private__.setLineHeightFactor=U.setLineHeightFactor=function(K){return typeof(K=K||1.15)=="number"&&(hs=K),this},Lu=U.__private__.getLineHeightFactor=U.getLineHeightFactor=function(){return hs};bc(t.lineHeight);var ha=U.__private__.getHorizontalCoordinate=function(K){return Le(K)},ls=U.__private__.getVerticalCoordinate=function(K){return le===te.ADVANCED?K:Rr[Re].mediaBox.topRightY-Rr[Re].mediaBox.bottomLeftY-Le(K)},Ua=U.__private__.getHorizontalCoordinateString=U.getHorizontalCoordinateString=function(K){return xe(ha(K))},ds=U.__private__.getVerticalCoordinateString=U.getVerticalCoordinateString=function(K){return xe(ls(K))},Ko=t.strokeColor||"0 G";U.__private__.getStrokeColor=U.getDrawColor=function(){return sn(Ko)},U.__private__.setStrokeColor=U.setDrawColor=function(K,Ee,pt,It){return Ko=pn({ch1:K,ch2:Ee,ch3:pt,ch4:It,pdfColorType:"draw",precision:2}),_t(Ko),this};var Xo=t.fillColor||"0 g";U.__private__.getFillColor=U.getFillColor=function(){return sn(Xo)},U.__private__.setFillColor=U.setFillColor=function(K,Ee,pt,It){return Xo=pn({ch1:K,ch2:Ee,ch3:pt,ch4:It,pdfColorType:"fill",precision:2}),_t(Xo),this};var Zi=t.textColor||"0 g",As=U.__private__.getTextColor=U.getTextColor=function(){return sn(Zi)};U.__private__.setTextColor=U.setTextColor=function(K,Ee,pt,It){return Zi=pn({ch1:K,ch2:Ee,ch3:pt,ch4:It,pdfColorType:"text",precision:3}),this};var da=t.charSpace,Ji=U.__private__.getCharSpace=U.getCharSpace=function(){return parseFloat(da||0)};U.__private__.setCharSpace=U.setCharSpace=function(K){if(isNaN(K))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return da=K,this};var ku=0;U.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},U.__private__.setLineCap=U.setLineCap=function(K){var Ee=U.CapJoinStyles[K];if(Ee===void 0)throw new Error("Line cap style of '"+K+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ku=Ee,_t(Ee+" J"),this};var To=0;U.__private__.setLineJoin=U.setLineJoin=function(K){var Ee=U.CapJoinStyles[K];if(Ee===void 0)throw new Error("Line join style of '"+K+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return To=Ee,_t(Ee+" j"),this},U.__private__.setLineMiterLimit=U.__private__.setMiterLimit=U.setLineMiterLimit=U.setMiterLimit=function(K){if(K=K||0,isNaN(K))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return _t(xe(Le(K))+" M"),this},U.GState=Lb,U.setGState=function(K){(K=typeof K=="string"?Yi[as[K]]:wc(null,K)).equals(Ho)||(_t("/"+K.id+" gs"),Ho=K)};var wc=function(K,Ee){if(!K||!as[K]){var pt=!1;for(var It in Yi)if(Yi.hasOwnProperty(It)&&Yi[It].equals(Ee)){pt=!0;break}if(pt)Ee=Yi[It];else{var Yt="GS"+(Object.keys(Yi).length+1).toString(10);Yi[Yt]=Ee,Ee.id=Yt}return K&&(as[K]=Ee.id),Ii.publish("addGState",Ee),Ee}};U.addGState=function(K,Ee){return wc(K,Ee),this},U.saveGraphicsState=function(){return _t("q"),pi.push({key:Ur,size:Fn,color:Zi}),this},U.restoreGraphicsState=function(){_t("Q");var K=pi.pop();return Ur=K.key,Fn=K.size,Zi=K.color,Ho=null,this},U.setCurrentTransformationMatrix=function(K){return _t(K.toString()+" cm"),this},U.comment=function(K){return _t("#"+K),this};var Aa=function(K,Ee){var pt=K||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return pt},set:function(fn){isNaN(fn)||(pt=parseFloat(fn))}});var It=Ee||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return It},set:function(fn){isNaN(fn)||(It=parseFloat(fn))}});var Yt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Yt},set:function(fn){Yt=fn.toString()}}),this},Ea=function(K,Ee,pt,It){Aa.call(this,K,Ee),this.type="rect";var Yt=pt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Yt},set:function(Mn){isNaN(Mn)||(Yt=parseFloat(Mn))}});var fn=It||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return fn},set:function(Mn){isNaN(Mn)||(fn=parseFloat(Mn))}}),this},pd=function(){this.page=ns,this.currentPage=Re,this.pages=dn.slice(0),this.pagesContext=Rr.slice(0),this.x=Hs,this.y=fi,this.matrix=xo,this.width=Es(Re),this.height=fa(Re),this.outputDestination=On,this.id="",this.objectNumber=-1};pd.prototype.restore=function(){ns=this.page,Re=this.currentPage,Rr=this.pagesContext,dn=this.pages,Hs=this.x,fi=this.y,xo=this.matrix,md(Re,this.width),bh(Re,this.height),On=this.outputDestination};var Va=function(K,Ee,pt,It,Yt){he.push(new pd),ns=Re=0,dn=[],Hs=K,fi=Ee,xo=Yt,Hl([pt,It])},Hp=function(K){if(Dt[K])he.pop().restore();else{var Ee=new pd,pt="Xo"+(Object.keys(Rs).length+1).toString(10);Ee.id=pt,Dt[K]=pt,Rs[pt]=Ee,Ii.publish("addFormObject",Ee),he.pop().restore()}};for(var Sc in U.beginFormObject=function(K,Ee,pt,It,Yt){return Va(K,Ee,pt,It,Yt),this},U.endFormObject=function(K){return Hp(K),this},U.doFormObject=function(K,Ee){var pt=Rs[Dt[K]];return _t("q"),_t(Ee.toString()+" cm"),_t("/"+pt.id+" Do"),_t("Q"),this},U.getFormObject=function(K){var Ee=Rs[Dt[K]];return{x:Ee.x,y:Ee.y,width:Ee.width,height:Ee.height,matrix:Ee.matrix}},U.save=function(K,Ee){return K=K||"generated.pdf",(Ee=Ee||{}).returnPromise=Ee.returnPromise||!1,Ee.returnPromise===!1?(Dm(Jc(Wl()),K),typeof Dm.unload=="function"&&ei.setTimeout&&setTimeout(Dm.unload,911),this):new Promise(function(pt,It){try{var Yt=Dm(Jc(Wl()),K);typeof Dm.unload=="function"&&ei.setTimeout&&setTimeout(Dm.unload,911),pt(Yt)}catch(fn){It(fn.message)}})},Qr.API)Qr.API.hasOwnProperty(Sc)&&(Sc==="events"&&Qr.API.events.length?function(K,Ee){var pt,It,Yt;for(Yt=Ee.length-1;Yt!==-1;Yt--)pt=Ee[Yt][0],It=Ee[Yt][1],K.subscribe.apply(K,[pt].concat(typeof It=="function"?[It]:It))}(Ii,Qr.API.events):U[Sc]=Qr.API[Sc]);var Es=U.getPageWidth=function(K){return(Rr[K=K||Re].mediaBox.topRightX-Rr[K].mediaBox.bottomLeftX)/Kn},md=U.setPageWidth=function(K,Ee){Rr[K].mediaBox.topRightX=Ee*Kn+Rr[K].mediaBox.bottomLeftX},fa=U.getPageHeight=function(K){return(Rr[K=K||Re].mediaBox.topRightY-Rr[K].mediaBox.bottomLeftY)/Kn},bh=U.setPageHeight=function(K,Ee){Rr[K].mediaBox.topRightY=Ee*Kn+Rr[K].mediaBox.bottomLeftY};return U.internal={pdfEscape:Oo,getStyle:Iu,getFont:yl,getFontSize:Un,getCharSpace:Ji,getTextColor:As,getLineHeight:xh,getLineHeightFactor:Lu,getLineWidth:Fo,write:yr,getHorizontalCoordinate:ha,getVerticalCoordinate:ls,getCoordinateString:Ua,getVerticalCoordinateString:ds,collections:{},newObject:at,newAdditionalObject:Mt,newObjectDeferred:wt,newObjectDeferredBegin:ct,getFilters:yn,putStream:$n,events:Ii,scaleFactor:Kn,pageSize:{getWidth:function(){return Es(Re)},setWidth:function(K){md(Re,K)},getHeight:function(){return fa(Re)},setHeight:function(K){bh(Re,K)}},encryptionOptions:O,encryption:po,getEncryptor:Bn,output:So,getNumberOfPages:Wo,pages:dn,out:_t,f2:ot,f3:ve,getPageInfo:fd,getPageInfoByObjId:$r,getCurrentPageInfo:Mu,getPDFVersion:Q,Point:Aa,Rectangle:Ea,Matrix:_e,hasHotfix:qr},Object.defineProperty(U.internal.pageSize,"width",{get:function(){return Es(Re)},set:function(K){md(Re,K)},enumerable:!0,configurable:!0}),Object.defineProperty(U.internal.pageSize,"height",{get:function(){return fa(Re)},set:function(K){bh(Re,K)},enumerable:!0,configurable:!0}),dd.call(U,bn),Ur="F1",zo(d,s),Ii.publish("initialized"),U}n_.prototype.lsbFirstWord=function(t){return String.fromCharCode(t>>0&255,t>>8&255,t>>16&255,t>>24&255)},n_.prototype.toHexString=function(t){return t.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},n_.prototype.hexToBytes=function(t){for(var e=[],s=0;s<t.length;s+=2)e.push(String.fromCharCode(parseInt(t.substr(s,2),16)));return e.join("")},n_.prototype.processOwnerPassword=function(t,e){return qT(VT(e).substr(0,5),t)},n_.prototype.encryptor=function(t,e){var s=VT(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(a){return qT(s,a)}},Lb.prototype.equals=function(t){var e,s="id,objectNumber,equals";if(!t||cs(t)!==cs(this))return!1;var a=0;for(e in this)if(!(s.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e)||this[e]!==t[e])return!1;a++}for(e in t)t.hasOwnProperty(e)&&s.indexOf(e)<0&&a--;return a===0},Qr.API={events:[]},Qr.version="3.0.1";var yo=Qr.API,OA=1,hg=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Yg=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},ui=function(t){return t.toFixed(2)},Yf=function(t){return t.toFixed(5)};yo.__acroform__={};var yc=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},Q4=function(t){return t*OA},Gh=function(t){var e=new uz,s=_r.internal.getHeight(t)||0,a=_r.internal.getWidth(t)||0;return e.BBox=[0,0,Number(ui(a)),Number(ui(s))],e},oZ=yo.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|=1<<e},aZ=yo.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&=~(1<<e)},lZ=yo.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return t&1<<e?1:0},ko=yo.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return lZ(t,e-1)},Ro=yo.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return oZ(t,e-1)},Do=yo.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return aZ(t,e-1)},cZ=yo.__acroform__.calculateCoordinates=function(t,e){var s=e.internal.getHorizontalCoordinate,a=e.internal.getVerticalCoordinate,d=t[0],g=t[1],v=t[2],i=t[3],E={};return E.lowerLeft_X=s(d)||0,E.lowerLeft_Y=a(g+i)||0,E.upperRight_X=s(d+v)||0,E.upperRight_Y=a(g)||0,[Number(ui(E.lowerLeft_X)),Number(ui(E.lowerLeft_Y)),Number(ui(E.upperRight_X)),Number(ui(E.upperRight_Y))]},uZ=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],s=t._V||t.DV,a=$T(t,s),d=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+d+" "+ui(a.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(a.text),e.push("ET"),e.push("Q"),e.push("EMC");var g=Gh(t);return g.scope=t.scope,g.stream=e.join(`
`),g}},$T=function(t,e){var s=t.fontSize===0?t.maxFontSize:t.fontSize,a={text:"",fontSize:""},d=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");d=t.multiline?d.map(function(ve){return ve.split(`
`)}):d.map(function(ve){return[ve]});var g=s,v=_r.internal.getHeight(t)||0;v=v<0?-v:v;var i=_r.internal.getWidth(t)||0;i=i<0?-i:i;var E=function(ve,Le,dt){if(ve+1<d.length){var Je=Le+" "+d[ve+1][0];return vx(Je,t,dt).width<=i-4}return!1};g++;e:for(;g>0;){e="",g--;var k,O,z=vx("3",t,g).height,G=t.multiline?v-g:(v-z)/2,U=G+=2,ie=0,Q=0,se=0;if(g<=0){e=`(...) Tj
`,e+="% Width of Text: "+vx(e,t,g=12).width+", FieldWidth:"+i+`
`;break}for(var J="",te=0,le=0;le<d.length;le++)if(d.hasOwnProperty(le)){var ye=!1;if(d[le].length!==1&&se!==d[le].length-1){if((z+2)*(te+2)+2>v)continue e;J+=d[le][se],ye=!0,Q=le,le--}else{J=(J+=d[le][se]+" ").substr(J.length-1)==" "?J.substr(0,J.length-1):J;var Ne=parseInt(le),rt=E(Ne,J,g),xe=le>=d.length-1;if(rt&&!xe){J+=" ",se=0;continue}if(rt||xe){if(xe)Q=Ne;else if(t.multiline&&(z+2)*(te+2)+2>v)continue e}else{if(!t.multiline||(z+2)*(te+2)+2>v)continue e;Q=Ne}}for(var Me="",it=ie;it<=Q;it++){var ot=d[it];if(t.multiline){if(it===Q){Me+=ot[se]+" ",se=(se+1)%ot.length;continue}if(it===ie){Me+=ot[ot.length-1]+" ";continue}}Me+=ot[0]+" "}switch(Me=Me.substr(Me.length-1)==" "?Me.substr(0,Me.length-1):Me,O=vx(Me,t,g).width,t.textAlign){case"right":k=i-O-2;break;case"center":k=(i-O)/2;break;case"left":default:k=2}e+=ui(k)+" "+ui(U)+` Td
`,e+="("+hg(Me)+`) Tj
`,e+=-ui(k)+` 0 Td
`,U=-(g+2),O=0,ie=ye?Q:Q+1,te++,J=""}break}return a.text=e,a.fontSize=g,a},vx=function(t,e,s){var a=e.scope.internal.getFont(e.fontName,e.fontStyle),d=e.scope.getStringUnitWidth(t,{font:a,fontSize:parseFloat(s),charSpace:0})*parseFloat(s);return{height:e.scope.getStringUnitWidth("3",{font:a,fontSize:parseFloat(s),charSpace:0})*parseFloat(s)*1.5,width:d}},hZ={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},dZ=function(t,e){var s={type:"reference",object:t};e.internal.getPageInfo(t.page).pageContext.annotations.find(function(a){return a.type===s.type&&a.object===s.object})===void 0&&e.internal.getPageInfo(t.page).pageContext.annotations.push(s)},fZ=function(t,e){for(var s in t)if(t.hasOwnProperty(s)){var a=s,d=t[s];e.internal.newObjectDeferredBegin(d.objId,!0),cs(d)==="object"&&typeof d.putStream=="function"&&d.putStream(),delete t[a]}},pZ=function(t,e){if(e.scope=t,t.internal!==void 0&&(t.internal.acroformPlugin===void 0||t.internal.acroformPlugin.isInitialized===!1)){if(mh.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(hZ)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");OA=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new hz,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){(function(s){s.internal.events.unsubscribe(s.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete s.internal.acroformPlugin.acroFormDictionaryRoot._eventID,s.internal.acroformPlugin.printedOut=!0})(t)}),t.internal.events.subscribe("buildDocument",function(){(function(s){s.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var a=s.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var d in a)if(a.hasOwnProperty(d)){var g=a[d];g.objId=void 0,g.hasAnnotation&&dZ(g,s)}})(t)}),t.internal.events.subscribe("putCatalog",function(){(function(s){if(s.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");s.internal.write("/AcroForm "+s.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(t)}),t.internal.events.subscribe("postPutPages",function(s){(function(a,d){var g=!a;for(var v in a||(d.internal.newObjectDeferredBegin(d.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),d.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),a=a||d.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(a.hasOwnProperty(v)){var i=a[v],E=[],k=i.Rect;if(i.Rect&&(i.Rect=cZ(i.Rect,d)),d.internal.newObjectDeferredBegin(i.objId,!0),i.DA=_r.createDefaultAppearanceStream(i),cs(i)==="object"&&typeof i.getKeyValueListForStream=="function"&&(E=i.getKeyValueListForStream()),i.Rect=k,i.hasAppearanceStream&&!i.appearanceStreamContent){var O=uZ(i);E.push({key:"AP",value:"<</N "+O+">>"}),d.internal.acroformPlugin.xForms.push(O)}if(i.appearanceStreamContent){var z="";for(var G in i.appearanceStreamContent)if(i.appearanceStreamContent.hasOwnProperty(G)){var U=i.appearanceStreamContent[G];if(z+="/"+G+" ",z+="<<",Object.keys(U).length>=1||Array.isArray(U)){for(var v in U)if(U.hasOwnProperty(v)){var ie=U[v];typeof ie=="function"&&(ie=ie.call(d,i)),z+="/"+v+" "+ie+" ",d.internal.acroformPlugin.xForms.indexOf(ie)>=0||d.internal.acroformPlugin.xForms.push(ie)}}else typeof(ie=U)=="function"&&(ie=ie.call(d,i)),z+="/"+v+" "+ie,d.internal.acroformPlugin.xForms.indexOf(ie)>=0||d.internal.acroformPlugin.xForms.push(ie);z+=">>"}E.push({key:"AP",value:`<<
`+z+">>"})}d.internal.putStream({additionalKeyValues:E,objectId:i.objId}),d.internal.out("endobj")}g&&fZ(d.internal.acroformPlugin.xForms,d)})(s,t)}),t.internal.acroformPlugin.isInitialized=!0}},cz=yo.__acroform__.arrayToPdfArray=function(t,e,s){var a=function(v){return v};if(Array.isArray(t)){for(var d="[",g=0;g<t.length;g++)switch(g!==0&&(d+=" "),cs(t[g])){case"boolean":case"number":case"object":d+=t[g].toString();break;case"string":t[g].substr(0,1)!=="/"?(e!==void 0&&s&&(a=s.internal.getEncryptor(e)),d+="("+hg(a(t[g].toString()))+")"):d+=t[g].toString()}return d+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Y5=function(t,e,s){var a=function(d){return d};return e!==void 0&&s&&(a=s.internal.getEncryptor(e)),(t=t||"").toString(),t="("+hg(a(t))+")"},td=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};td.prototype.toString=function(){return this.objId+" 0 R"},td.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},td.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter(function(g){return g!="content"&&g!="appearanceStreamContent"&&g!="scope"&&g!="objId"&&g.substring(0,1)!="_"});for(var s in e)if(Object.getOwnPropertyDescriptor(this,e[s]).configurable===!1){var a=e[s],d=this[a];d&&(Array.isArray(d)?t.push({key:a,value:cz(d,this.objId,this.scope)}):d instanceof td?(d.scope=this.scope,t.push({key:a,value:d.objId+" 0 R"})):typeof d!="function"&&t.push({key:a,value:d}))}return t};var uz=function(){td.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(s){e=s}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(s){t=s.trim()},get:function(){return t||null}})};yc(uz,td);var hz=function(){td.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var s=function(a){return a};return this.scope&&(s=this.scope.internal.getEncryptor(this.objId)),"("+hg(s(t))+")"}},set:function(s){t=s}})};yc(hz,td);var mh=function t(){td.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute F supplied.');e=J}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!ko(e,3)},set:function(J){J?this.F=Ro(e,3):this.F=Do(e,3)}});var s=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return s},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute Ff supplied.');s=J}});var a=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(a.length!==0)return a},set:function(J){a=J!==void 0?J:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[0])?0:a[0]},set:function(J){a[0]=J}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[1])?0:a[1]},set:function(J){a[1]=J}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[2])?0:a[2]},set:function(J){a[2]=J}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[3])?0:a[3]},set:function(J){a[3]=J}});var d="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return d},set:function(J){switch(J){case"/Btn":case"/Tx":case"/Ch":case"/Sig":d=J;break;default:throw new Error('Invalid value "'+J+'" for attribute FT supplied.')}}});var g=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!g||g.length<1){if(this instanceof kb)return;g="FieldObject"+t.FieldNum++}var J=function(te){return te};return this.scope&&(J=this.scope.internal.getEncryptor(this.objId)),"("+hg(J(g))+")"},set:function(J){g=J.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return g},set:function(J){g=J}});var v="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return v},set:function(J){v=J}});var i="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return i},set:function(J){i=J}});var E=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return E},set:function(J){E=J}});var k=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return k===void 0?50/OA:k},set:function(J){k=J}});var O="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return O},set:function(J){O=J}});var z="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!z||this instanceof kb||this instanceof Ym))return Y5(z,this.objId,this.scope)},set:function(J){J=J.toString(),z=J}});var G=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(G)return this instanceof ba?G:Y5(G,this.objId,this.scope)},set:function(J){J=J.toString(),G=this instanceof ba?J:J.substr(0,1)==="("?Yg(J.substr(1,J.length-2)):Yg(J)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof ba?Yg(G.substr(1,G.length-1)):G},set:function(J){J=J.toString(),G=this instanceof ba?"/"+J:J}});var U=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(U)return U},set:function(J){this.V=J}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(U)return this instanceof ba?U:Y5(U,this.objId,this.scope)},set:function(J){J=J.toString(),U=this instanceof ba?J:J.substr(0,1)==="("?Yg(J.substr(1,J.length-2)):Yg(J)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof ba?Yg(U.substr(1,U.length-1)):U},set:function(J){J=J.toString(),U=this instanceof ba?"/"+J:J}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var ie,Q=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return Q},set:function(J){J=!!J,Q=J}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(ie)return ie},set:function(J){ie=J}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,1)},set:function(J){J?this.Ff=Ro(this.Ff,1):this.Ff=Do(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,2)},set:function(J){J?this.Ff=Ro(this.Ff,2):this.Ff=Do(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,3)},set:function(J){J?this.Ff=Ro(this.Ff,3):this.Ff=Do(this.Ff,3)}});var se=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(se!==null)return se},set:function(J){if([0,1,2].indexOf(J)===-1)throw new Error('Invalid value "'+J+'" for attribute Q supplied.');se=J}}),Object.defineProperty(this,"textAlign",{get:function(){var J;switch(se){case 0:default:J="left";break;case 1:J="center";break;case 2:J="right"}return J},configurable:!0,enumerable:!0,set:function(J){switch(J){case"right":case 2:se=2;break;case"center":case 1:se=1;break;case"left":case 0:default:se=0}}})};yc(mh,td);var M_=function(){mh.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(s){t=s}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(s){t=s}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return cz(e,this.objId,this.scope)},set:function(s){var a,d;d=[],typeof(a=s)=="string"&&(d=function(g,v,i){i||(i=1);for(var E,k=[];E=v.exec(g);)k.push(E[i]);return k}(a,/\((.*?)\)/g)),e=d}}),this.getOptions=function(){return e},this.setOptions=function(s){e=s,this.sort&&e.sort()},this.addOption=function(s){s=(s=s||"").toString(),e.push(s),this.sort&&e.sort()},this.removeOption=function(s,a){for(a=a||!1,s=(s=s||"").toString();e.indexOf(s)!==-1&&(e.splice(e.indexOf(s),1),a!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,18)},set:function(s){s?this.Ff=Ro(this.Ff,18):this.Ff=Do(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,19)},set:function(s){this.combo===!0&&(s?this.Ff=Ro(this.Ff,19):this.Ff=Do(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,20)},set:function(s){s?(this.Ff=Ro(this.Ff,20),e.sort()):this.Ff=Do(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,22)},set:function(s){s?this.Ff=Ro(this.Ff,22):this.Ff=Do(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,23)},set:function(s){s?this.Ff=Ro(this.Ff,23):this.Ff=Do(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,27)},set:function(s){s?this.Ff=Ro(this.Ff,27):this.Ff=Do(this.Ff,27)}}),this.hasAppearanceStream=!1};yc(M_,mh);var I_=function(){M_.call(this),this.fontName="helvetica",this.combo=!1};yc(I_,M_);var L_=function(){I_.call(this),this.combo=!0};yc(L_,I_);var Gx=function(){L_.call(this),this.edit=!0};yc(Gx,L_);var ba=function(){mh.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,15)},set:function(s){s?this.Ff=Ro(this.Ff,15):this.Ff=Do(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,16)},set:function(s){s?this.Ff=Ro(this.Ff,16):this.Ff=Do(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,17)},set:function(s){s?this.Ff=Ro(this.Ff,17):this.Ff=Do(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,26)},set:function(s){s?this.Ff=Ro(this.Ff,26):this.Ff=Do(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var s=function(g){return g};if(this.scope&&(s=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var a,d=[];for(a in d.push("<<"),e)d.push("/"+a+" ("+hg(s(e[a]))+")");return d.push(">>"),d.join(`
`)}},set:function(s){cs(s)==="object"&&(e=s)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(s){typeof s=="string"&&(e.CA=s)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(s){t=s}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(s){t="/"+s}})};yc(ba,mh);var Hx=function(){ba.call(this),this.pushButton=!0};yc(Hx,ba);var k_=function(){ba.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e!==void 0?e:[]}})};yc(k_,ba);var kb=function(){var t,e;mh.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(d){t=d}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(d){e=d}});var s,a={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var d=function(i){return i};this.scope&&(d=this.scope.internal.getEncryptor(this.objId));var g,v=[];for(g in v.push("<<"),a)v.push("/"+g+" ("+hg(d(a[g]))+")");return v.push(">>"),v.join(`
`)},set:function(d){cs(d)==="object"&&(a=d)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return a.CA||""},set:function(d){typeof d=="string"&&(a.CA=d)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return s},set:function(d){s=d}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return s.substr(1,s.length-1)},set:function(d){s="/"+d}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=_r.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};yc(kb,mh),k_.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var s=this.Kids[e];s.appearanceStreamContent=t.createAppearanceStream(s.optionName),s.caption=t.getCA()}},k_.prototype.createOption=function(t){var e=new kb;return e.Parent=this,e.optionName=t,this.Kids.push(e),mZ.call(this.scope,e),e};var Wx=function(){ba.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=_r.CheckBox.createAppearanceStream()};yc(Wx,ba);var Ym=function(){mh.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,13)},set:function(e){e?this.Ff=Ro(this.Ff,13):this.Ff=Do(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,21)},set:function(e){e?this.Ff=Ro(this.Ff,21):this.Ff=Do(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,23)},set:function(e){e?this.Ff=Ro(this.Ff,23):this.Ff=Do(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,24)},set:function(e){e?this.Ff=Ro(this.Ff,24):this.Ff=Do(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,25)},set:function(e){e?this.Ff=Ro(this.Ff,25):this.Ff=Do(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,26)},set:function(e){e?this.Ff=Ro(this.Ff,26):this.Ff=Do(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};yc(Ym,mh);var Zx=function(){Ym.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!ko(this.Ff,14)},set:function(t){t?this.Ff=Ro(this.Ff,14):this.Ff=Do(this.Ff,14)}}),this.password=!0};yc(Zx,Ym);var _r={CheckBox:{createAppearanceStream:function(){return{N:{On:_r.CheckBox.YesNormal},D:{On:_r.CheckBox.YesPushDown,Off:_r.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=Gh(t);e.scope=t.scope;var s=[],a=t.scope.internal.getFont(t.fontName,t.fontStyle).id,d=t.scope.__private__.encodeColorString(t.color),g=$T(t,t.caption);return s.push("0.749023 g"),s.push("0 0 "+ui(_r.internal.getWidth(t))+" "+ui(_r.internal.getHeight(t))+" re"),s.push("f"),s.push("BMC"),s.push("q"),s.push("0 0 1 rg"),s.push("/"+a+" "+ui(g.fontSize)+" Tf "+d),s.push("BT"),s.push(g.text),s.push("ET"),s.push("Q"),s.push("EMC"),e.stream=s.join(`
`),e},YesNormal:function(t){var e=Gh(t);e.scope=t.scope;var s=t.scope.internal.getFont(t.fontName,t.fontStyle).id,a=t.scope.__private__.encodeColorString(t.color),d=[],g=_r.internal.getHeight(t),v=_r.internal.getWidth(t),i=$T(t,t.caption);return d.push("1 g"),d.push("0 0 "+ui(v)+" "+ui(g)+" re"),d.push("f"),d.push("q"),d.push("0 0 1 rg"),d.push("0 0 "+ui(v-1)+" "+ui(g-1)+" re"),d.push("W"),d.push("n"),d.push("0 g"),d.push("BT"),d.push("/"+s+" "+ui(i.fontSize)+" Tf "+a),d.push(i.text),d.push("ET"),d.push("Q"),e.stream=d.join(`
`),e},OffPushDown:function(t){var e=Gh(t);e.scope=t.scope;var s=[];return s.push("0.749023 g"),s.push("0 0 "+ui(_r.internal.getWidth(t))+" "+ui(_r.internal.getHeight(t))+" re"),s.push("f"),e.stream=s.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:_r.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=_r.RadioButton.Circle.YesNormal,e.D[t]=_r.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=Gh(t);e.scope=t.scope;var s=[],a=_r.internal.getWidth(t)<=_r.internal.getHeight(t)?_r.internal.getWidth(t)/4:_r.internal.getHeight(t)/4;a=Number((.9*a).toFixed(5));var d=_r.internal.Bezier_C,g=Number((a*d).toFixed(5));return s.push("q"),s.push("1 0 0 1 "+Yf(_r.internal.getWidth(t)/2)+" "+Yf(_r.internal.getHeight(t)/2)+" cm"),s.push(a+" 0 m"),s.push(a+" "+g+" "+g+" "+a+" 0 "+a+" c"),s.push("-"+g+" "+a+" -"+a+" "+g+" -"+a+" 0 c"),s.push("-"+a+" -"+g+" -"+g+" -"+a+" 0 -"+a+" c"),s.push(g+" -"+a+" "+a+" -"+g+" "+a+" 0 c"),s.push("f"),s.push("Q"),e.stream=s.join(`
`),e},YesPushDown:function(t){var e=Gh(t);e.scope=t.scope;var s=[],a=_r.internal.getWidth(t)<=_r.internal.getHeight(t)?_r.internal.getWidth(t)/4:_r.internal.getHeight(t)/4;a=Number((.9*a).toFixed(5));var d=Number((2*a).toFixed(5)),g=Number((d*_r.internal.Bezier_C).toFixed(5)),v=Number((a*_r.internal.Bezier_C).toFixed(5));return s.push("0.749023 g"),s.push("q"),s.push("1 0 0 1 "+Yf(_r.internal.getWidth(t)/2)+" "+Yf(_r.internal.getHeight(t)/2)+" cm"),s.push(d+" 0 m"),s.push(d+" "+g+" "+g+" "+d+" 0 "+d+" c"),s.push("-"+g+" "+d+" -"+d+" "+g+" -"+d+" 0 c"),s.push("-"+d+" -"+g+" -"+g+" -"+d+" 0 -"+d+" c"),s.push(g+" -"+d+" "+d+" -"+g+" "+d+" 0 c"),s.push("f"),s.push("Q"),s.push("0 g"),s.push("q"),s.push("1 0 0 1 "+Yf(_r.internal.getWidth(t)/2)+" "+Yf(_r.internal.getHeight(t)/2)+" cm"),s.push(a+" 0 m"),s.push(a+" "+v+" "+v+" "+a+" 0 "+a+" c"),s.push("-"+v+" "+a+" -"+a+" "+v+" -"+a+" 0 c"),s.push("-"+a+" -"+v+" -"+v+" -"+a+" 0 -"+a+" c"),s.push(v+" -"+a+" "+a+" -"+v+" "+a+" 0 c"),s.push("f"),s.push("Q"),e.stream=s.join(`
`),e},OffPushDown:function(t){var e=Gh(t);e.scope=t.scope;var s=[],a=_r.internal.getWidth(t)<=_r.internal.getHeight(t)?_r.internal.getWidth(t)/4:_r.internal.getHeight(t)/4;a=Number((.9*a).toFixed(5));var d=Number((2*a).toFixed(5)),g=Number((d*_r.internal.Bezier_C).toFixed(5));return s.push("0.749023 g"),s.push("q"),s.push("1 0 0 1 "+Yf(_r.internal.getWidth(t)/2)+" "+Yf(_r.internal.getHeight(t)/2)+" cm"),s.push(d+" 0 m"),s.push(d+" "+g+" "+g+" "+d+" 0 "+d+" c"),s.push("-"+g+" "+d+" -"+d+" "+g+" -"+d+" 0 c"),s.push("-"+d+" -"+g+" -"+g+" -"+d+" 0 -"+d+" c"),s.push(g+" -"+d+" "+d+" -"+g+" "+d+" 0 c"),s.push("f"),s.push("Q"),e.stream=s.join(`
`),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:_r.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=_r.RadioButton.Cross.YesNormal,e.D[t]=_r.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=Gh(t);e.scope=t.scope;var s=[],a=_r.internal.calculateCross(t);return s.push("q"),s.push("1 1 "+ui(_r.internal.getWidth(t)-2)+" "+ui(_r.internal.getHeight(t)-2)+" re"),s.push("W"),s.push("n"),s.push(ui(a.x1.x)+" "+ui(a.x1.y)+" m"),s.push(ui(a.x2.x)+" "+ui(a.x2.y)+" l"),s.push(ui(a.x4.x)+" "+ui(a.x4.y)+" m"),s.push(ui(a.x3.x)+" "+ui(a.x3.y)+" l"),s.push("s"),s.push("Q"),e.stream=s.join(`
`),e},YesPushDown:function(t){var e=Gh(t);e.scope=t.scope;var s=_r.internal.calculateCross(t),a=[];return a.push("0.749023 g"),a.push("0 0 "+ui(_r.internal.getWidth(t))+" "+ui(_r.internal.getHeight(t))+" re"),a.push("f"),a.push("q"),a.push("1 1 "+ui(_r.internal.getWidth(t)-2)+" "+ui(_r.internal.getHeight(t)-2)+" re"),a.push("W"),a.push("n"),a.push(ui(s.x1.x)+" "+ui(s.x1.y)+" m"),a.push(ui(s.x2.x)+" "+ui(s.x2.y)+" l"),a.push(ui(s.x4.x)+" "+ui(s.x4.y)+" m"),a.push(ui(s.x3.x)+" "+ui(s.x3.y)+" l"),a.push("s"),a.push("Q"),e.stream=a.join(`
`),e},OffPushDown:function(t){var e=Gh(t);e.scope=t.scope;var s=[];return s.push("0.749023 g"),s.push("0 0 "+ui(_r.internal.getWidth(t))+" "+ui(_r.internal.getHeight(t))+" re"),s.push("f"),e.stream=s.join(`
`),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,s=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+s}};_r.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=_r.internal.getWidth(t),s=_r.internal.getHeight(t),a=Math.min(e,s);return{x1:{x:(e-a)/2,y:(s-a)/2+a},x2:{x:(e-a)/2+a,y:(s-a)/2},x3:{x:(e-a)/2,y:(s-a)/2},x4:{x:(e-a)/2+a,y:(s-a)/2+a}}}},_r.internal.getWidth=function(t){var e=0;return cs(t)==="object"&&(e=Q4(t.Rect[2])),e},_r.internal.getHeight=function(t){var e=0;return cs(t)==="object"&&(e=Q4(t.Rect[3])),e};var mZ=yo.addField=function(t){if(pZ(this,t),!(t instanceof mh))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};yo.AcroFormChoiceField=M_,yo.AcroFormListBox=I_,yo.AcroFormComboBox=L_,yo.AcroFormEditBox=Gx,yo.AcroFormButton=ba,yo.AcroFormPushButton=Hx,yo.AcroFormRadioButton=k_,yo.AcroFormCheckBox=Wx,yo.AcroFormTextField=Ym,yo.AcroFormPasswordField=Zx,yo.AcroFormAppearance=_r,yo.AcroForm={ChoiceField:M_,ListBox:I_,ComboBox:L_,EditBox:Gx,Button:ba,PushButton:Hx,RadioButton:k_,CheckBox:Wx,TextField:Ym,PasswordField:Zx,Appearance:_r},Qr.AcroForm={ChoiceField:M_,ListBox:I_,ComboBox:L_,EditBox:Gx,Button:ba,PushButton:Hx,RadioButton:k_,CheckBox:Wx,TextField:Ym,PasswordField:Zx,Appearance:_r};function dz(t){return t.reduce(function(e,s,a){return e[s]=a,e},{})}(function(t){t.__addimage__={};var e="UNKNOWN",s={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=t.__addimage__.getImageFileTypeByImageData=function(ve,Le){var dt,Je,yt,St,jt,et=e;if((Le=Le||e)==="RGBA"||ve.data!==void 0&&ve.data instanceof Uint8ClampedArray&&"height"in ve&&"width"in ve)return"RGBA";if(rt(ve))for(jt in s)for(yt=s[jt],dt=0;dt<yt.length;dt+=1){for(St=!0,Je=0;Je<yt[dt].length;Je+=1)if(yt[dt][Je]!==void 0&&yt[dt][Je]!==ve[Je]){St=!1;break}if(St===!0){et=jt;break}}else for(jt in s)for(yt=s[jt],dt=0;dt<yt.length;dt+=1){for(St=!0,Je=0;Je<yt[dt].length;Je+=1)if(yt[dt][Je]!==void 0&&yt[dt][Je]!==ve.charCodeAt(Je)){St=!1;break}if(St===!0){et=jt;break}}return et===e&&Le!==e&&(et=Le),et},d=function ve(Le){for(var dt=this.internal.write,Je=this.internal.putStream,yt=(0,this.internal.getFilters)();yt.indexOf("FlateEncode")!==-1;)yt.splice(yt.indexOf("FlateEncode"),1);Le.objectId=this.internal.newObject();var St=[];if(St.push({key:"Type",value:"/XObject"}),St.push({key:"Subtype",value:"/Image"}),St.push({key:"Width",value:Le.width}),St.push({key:"Height",value:Le.height}),Le.colorSpace===se.INDEXED?St.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(Le.palette.length/3-1)+" "+("sMask"in Le&&Le.sMask!==void 0?Le.objectId+2:Le.objectId+1)+" 0 R]"}):(St.push({key:"ColorSpace",value:"/"+Le.colorSpace}),Le.colorSpace===se.DEVICE_CMYK&&St.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),St.push({key:"BitsPerComponent",value:Le.bitsPerComponent}),"decodeParameters"in Le&&Le.decodeParameters!==void 0&&St.push({key:"DecodeParms",value:"<<"+Le.decodeParameters+">>"}),"transparency"in Le&&Array.isArray(Le.transparency)){for(var jt="",et=0,Qe=Le.transparency.length;et<Qe;et++)jt+=Le.transparency[et]+" "+Le.transparency[et]+" ";St.push({key:"Mask",value:"["+jt+"]"})}Le.sMask!==void 0&&St.push({key:"SMask",value:Le.objectId+1+" 0 R"});var Xe=Le.filter!==void 0?["/"+Le.filter]:void 0;if(Je({data:Le.data,additionalKeyValues:St,alreadyAppliedFilters:Xe,objectId:Le.objectId}),dt("endobj"),"sMask"in Le&&Le.sMask!==void 0){var Vt="/Predictor "+Le.predictor+" /Colors 1 /BitsPerComponent "+Le.bitsPerComponent+" /Columns "+Le.width,be={width:Le.width,height:Le.height,colorSpace:"DeviceGray",bitsPerComponent:Le.bitsPerComponent,decodeParameters:Vt,data:Le.sMask};"filter"in Le&&(be.filter=Le.filter),ve.call(this,be)}if(Le.colorSpace===se.INDEXED){var Re=this.internal.newObject();Je({data:Me(new Uint8Array(Le.palette)),objectId:Re}),dt("endobj")}},g=function(){var ve=this.internal.collections.addImage_images;for(var Le in ve)d.call(this,ve[Le])},v=function(){var ve,Le=this.internal.collections.addImage_images,dt=this.internal.write;for(var Je in Le)dt("/I"+(ve=Le[Je]).index,ve.objectId,"0","R")},i=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",g),this.internal.events.subscribe("putXobjectDict",v))},E=function(){var ve=this.internal.collections.addImage_images;return i.call(this),ve},k=function(){return Object.keys(this.internal.collections.addImage_images).length},O=function(ve){return typeof t["process"+ve.toUpperCase()]=="function"},z=function(ve){return cs(ve)==="object"&&ve.nodeType===1},G=function(ve,Le){if(ve.nodeName==="IMG"&&ve.hasAttribute("src")){var dt=""+ve.getAttribute("src");if(dt.indexOf("data:image/")===0)return qy(unescape(dt).split("base64,").pop());var Je=t.loadFile(dt,!0);if(Je!==void 0)return Je}if(ve.nodeName==="CANVAS"){if(ve.width===0||ve.height===0)throw new Error("Given canvas must have data. Canvas width: "+ve.width+", height: "+ve.height);var yt;switch(Le){case"PNG":yt="image/png";break;case"WEBP":yt="image/webp";break;case"JPEG":case"JPG":default:yt="image/jpeg"}return qy(ve.toDataURL(yt,1).split("base64,").pop())}},U=function(ve){var Le=this.internal.collections.addImage_images;if(Le){for(var dt in Le)if(ve===Le[dt].alias)return Le[dt]}},ie=function(ve,Le,dt){return ve||Le||(ve=-96,Le=-96),ve<0&&(ve=-1*dt.width*72/ve/this.internal.scaleFactor),Le<0&&(Le=-1*dt.height*72/Le/this.internal.scaleFactor),ve===0&&(ve=Le*dt.width/dt.height),Le===0&&(Le=ve*dt.height/dt.width),[ve,Le]},Q=function(ve,Le,dt,Je,yt,St){var jt=ie.call(this,dt,Je,yt),et=this.internal.getCoordinateString,Qe=this.internal.getVerticalCoordinateString,Xe=E.call(this);if(dt=jt[0],Je=jt[1],Xe[yt.index]=yt,St){St*=Math.PI/180;var Vt=Math.cos(St),be=Math.sin(St),Re=function(ut){return ut.toFixed(4)},Fe=[Re(Vt),Re(be),Re(-1*be),Re(Vt),0,0,"cm"]}this.internal.write("q"),St?(this.internal.write([1,"0","0",1,et(ve),Qe(Le+Je),"cm"].join(" ")),this.internal.write(Fe.join(" ")),this.internal.write([et(dt),"0","0",et(Je),"0","0","cm"].join(" "))):this.internal.write([et(dt),"0","0",et(Je),et(ve),Qe(Le+Je),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+yt.index+" Do"),this.internal.write("Q")},se=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var J=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},te=t.__addimage__.sHashCode=function(ve){var Le,dt,Je=0;if(typeof ve=="string")for(dt=ve.length,Le=0;Le<dt;Le++)Je=(Je<<5)-Je+ve.charCodeAt(Le),Je|=0;else if(rt(ve))for(dt=ve.byteLength/2,Le=0;Le<dt;Le++)Je=(Je<<5)-Je+ve[Le],Je|=0;return Je},le=t.__addimage__.validateStringAsBase64=function(ve){(ve=ve||"").toString().trim();var Le=!0;return ve.length===0&&(Le=!1),ve.length%4!=0&&(Le=!1),/^[A-Za-z0-9+/]+$/.test(ve.substr(0,ve.length-2))===!1&&(Le=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(ve.substr(-2))===!1&&(Le=!1),Le},ye=t.__addimage__.extractImageFromDataUrl=function(ve){if(ve==null||!(ve=ve.trim()).startsWith("data:"))return null;var Le=ve.indexOf(",");return Le<0?null:ve.substring(0,Le).trim().endsWith("base64")?ve.substring(Le+1):null},Ne=t.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};t.__addimage__.isArrayBuffer=function(ve){return Ne()&&ve instanceof ArrayBuffer};var rt=t.__addimage__.isArrayBufferView=function(ve){return Ne()&&typeof Uint32Array<"u"&&(ve instanceof Int8Array||ve instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&ve instanceof Uint8ClampedArray||ve instanceof Int16Array||ve instanceof Uint16Array||ve instanceof Int32Array||ve instanceof Uint32Array||ve instanceof Float32Array||ve instanceof Float64Array)},xe=t.__addimage__.binaryStringToUint8Array=function(ve){for(var Le=ve.length,dt=new Uint8Array(Le),Je=0;Je<Le;Je++)dt[Je]=ve.charCodeAt(Je);return dt},Me=t.__addimage__.arrayBufferToBinaryString=function(ve){for(var Le="",dt=rt(ve)?ve:new Uint8Array(ve),Je=0;Je<dt.length;Je+=8192)Le+=String.fromCharCode.apply(null,dt.subarray(Je,Je+8192));return Le};t.addImage=function(){var ve,Le,dt,Je,yt,St,jt,et,Qe;if(typeof arguments[1]=="number"?(Le=e,dt=arguments[1],Je=arguments[2],yt=arguments[3],St=arguments[4],jt=arguments[5],et=arguments[6],Qe=arguments[7]):(Le=arguments[1],dt=arguments[2],Je=arguments[3],yt=arguments[4],St=arguments[5],jt=arguments[6],et=arguments[7],Qe=arguments[8]),cs(ve=arguments[0])==="object"&&!z(ve)&&"imageData"in ve){var Xe=ve;ve=Xe.imageData,Le=Xe.format||Le||e,dt=Xe.x||dt||0,Je=Xe.y||Je||0,yt=Xe.w||Xe.width||yt,St=Xe.h||Xe.height||St,jt=Xe.alias||jt,et=Xe.compression||et,Qe=Xe.rotation||Xe.angle||Qe}var Vt=this.internal.getFilters();if(et===void 0&&Vt.indexOf("FlateEncode")!==-1&&(et="SLOW"),isNaN(dt)||isNaN(Je))throw new Error("Invalid coordinates passed to jsPDF.addImage");i.call(this);var be=it.call(this,ve,Le,jt,et);return Q.call(this,dt,Je,yt,St,be,Qe),this};var it=function(ve,Le,dt,Je){var yt,St,jt;if(typeof ve=="string"&&a(ve)===e){ve=unescape(ve);var et=ot(ve,!1);(et!==""||(et=t.loadFile(ve,!0))!==void 0)&&(ve=et)}if(z(ve)&&(ve=G(ve,Le)),Le=a(ve,Le),!O(Le))throw new Error("addImage does not support files of type '"+Le+"', please ensure that a plugin for '"+Le+"' support is added.");if(((jt=dt)==null||jt.length===0)&&(dt=function(Qe){return typeof Qe=="string"||rt(Qe)?te(Qe):rt(Qe.data)?te(Qe.data):null}(ve)),(yt=U.call(this,dt))||(Ne()&&(ve instanceof Uint8Array||Le==="RGBA"||(St=ve,ve=xe(ve))),yt=this["process"+Le.toUpperCase()](ve,k.call(this),dt,function(Qe){return Qe&&typeof Qe=="string"&&(Qe=Qe.toUpperCase()),Qe in t.image_compression?Qe:J.NONE}(Je),St)),!yt)throw new Error("An unknown error occurred whilst processing the image.");return yt},ot=t.__addimage__.convertBase64ToBinaryString=function(ve,Le){Le=typeof Le!="boolean"||Le;var dt,Je="";if(typeof ve=="string"){var yt;dt=(yt=ye(ve))!==null&&yt!==void 0?yt:ve;try{Je=qy(dt)}catch(St){if(Le)throw le(dt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+St.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Je};t.getImageProperties=function(ve){var Le,dt,Je="";if(z(ve)&&(ve=G(ve)),typeof ve=="string"&&a(ve)===e&&((Je=ot(ve,!1))===""&&(Je=t.loadFile(ve)||""),ve=Je),dt=a(ve),!O(dt))throw new Error("addImage does not support files of type '"+dt+"', please ensure that a plugin for '"+dt+"' support is added.");if(!Ne()||ve instanceof Uint8Array||(ve=xe(ve)),!(Le=this["process"+dt.toUpperCase()](ve)))throw new Error("An unknown error occurred whilst processing the image");return Le.fileType=dt,Le}})(Qr.API),function(t){var e=function(s){if(s!==void 0&&s!="")return!0};Qr.API.events.push(["addPage",function(s){this.internal.getPageInfo(s.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(s){for(var a,d,g,v=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,E=this.internal.getPageInfoByObjId(s.objId),k=s.pageContext.annotations,O=!1,z=0;z<k.length&&!O;z++)switch((a=k[z]).type){case"link":(e(a.options.url)||e(a.options.pageNumber))&&(O=!0);break;case"reference":case"text":case"freetext":O=!0}if(O!=0){this.internal.write("/Annots [");for(var G=0;G<k.length;G++){a=k[G];var U=this.internal.pdfEscape,ie=this.internal.getEncryptor(s.objId);switch(a.type){case"reference":this.internal.write(" "+a.object.objId+" 0 R ");break;case"text":var Q=this.internal.newAdditionalObject(),se=this.internal.newAdditionalObject(),J=this.internal.getEncryptor(Q.objId),te=a.title||"Note";g="<</Type /Annot /Subtype /Text "+(d="/Rect ["+v(a.bounds.x)+" "+i(a.bounds.y+a.bounds.h)+" "+v(a.bounds.x+a.bounds.w)+" "+i(a.bounds.y)+"] ")+"/Contents ("+U(J(a.contents))+")",g+=" /Popup "+se.objId+" 0 R",g+=" /P "+E.objId+" 0 R",g+=" /T ("+U(J(te))+") >>",Q.content=g;var le=Q.objId+" 0 R";g="<</Type /Annot /Subtype /Popup "+(d="/Rect ["+v(a.bounds.x+30)+" "+i(a.bounds.y+a.bounds.h)+" "+v(a.bounds.x+a.bounds.w+30)+" "+i(a.bounds.y)+"] ")+" /Parent "+le,a.open&&(g+=" /Open true"),g+=" >>",se.content=g,this.internal.write(Q.objId,"0 R",se.objId,"0 R");break;case"freetext":d="/Rect ["+v(a.bounds.x)+" "+i(a.bounds.y)+" "+v(a.bounds.x+a.bounds.w)+" "+i(a.bounds.y+a.bounds.h)+"] ";var ye=a.color||"#000000";g="<</Type /Annot /Subtype /FreeText "+d+"/Contents ("+U(ie(a.contents))+")",g+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+ye+")",g+=" /Border [0 0 0]",g+=" >>",this.internal.write(g);break;case"link":if(a.options.name){var Ne=this.annotations._nameMap[a.options.name];a.options.pageNumber=Ne.page,a.options.top=Ne.y}else a.options.top||(a.options.top=0);if(d="/Rect ["+a.finalBounds.x+" "+a.finalBounds.y+" "+a.finalBounds.w+" "+a.finalBounds.h+"] ",g="",a.options.url)g="<</Type /Annot /Subtype /Link "+d+"/Border [0 0 0] /A <</S /URI /URI ("+U(ie(a.options.url))+") >>";else if(a.options.pageNumber)switch(g="<</Type /Annot /Subtype /Link "+d+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(a.options.pageNumber).objId+" 0 R",a.options.magFactor=a.options.magFactor||"XYZ",a.options.magFactor){case"Fit":g+=" /Fit]";break;case"FitH":g+=" /FitH "+a.options.top+"]";break;case"FitV":a.options.left=a.options.left||0,g+=" /FitV "+a.options.left+"]";break;case"XYZ":default:var rt=i(a.options.top);a.options.left=a.options.left||0,a.options.zoom===void 0&&(a.options.zoom=0),g+=" /XYZ "+a.options.left+" "+rt+" "+a.options.zoom+"]"}g!=""&&(g+=" >>",this.internal.write(g))}}this.internal.write("]")}}]),t.createAnnotation=function(s){var a=this.internal.getCurrentPageInfo();switch(s.type){case"link":this.link(s.bounds.x,s.bounds.y,s.bounds.w,s.bounds.h,s);break;case"text":case"freetext":a.pageContext.annotations.push(s)}},t.link=function(s,a,d,g,v){var i=this.internal.getCurrentPageInfo(),E=this.internal.getCoordinateString,k=this.internal.getVerticalCoordinateString;i.pageContext.annotations.push({finalBounds:{x:E(s),y:k(a),w:E(s+d),h:k(a+g)},options:v,type:"link"})},t.textWithLink=function(s,a,d,g){var v,i,E=this.getTextWidth(s),k=this.internal.getLineHeight()/this.internal.scaleFactor;if(g.maxWidth!==void 0){i=g.maxWidth;var O=this.splitTextToSize(s,i).length;v=Math.ceil(k*O)}else i=E,v=k;return this.text(s,a,d,g),d+=.2*k,g.align==="center"&&(a-=E/2),g.align==="right"&&(a-=E),this.link(a,d-k,i,v,g),E},t.getTextWidth=function(s){var a=this.internal.getFontSize();return this.getStringUnitWidth(s)*a/this.internal.scaleFactor}}(Qr.API),function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},s={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},a={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},d=[1570,1571,1573,1575];t.__arabicParser__={};var g=t.__arabicParser__.isInArabicSubstitutionA=function(Q){return e[Q.charCodeAt(0)]!==void 0},v=t.__arabicParser__.isArabicLetter=function(Q){return typeof Q=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(Q)},i=t.__arabicParser__.isArabicEndLetter=function(Q){return v(Q)&&g(Q)&&e[Q.charCodeAt(0)].length<=2},E=t.__arabicParser__.isArabicAlfLetter=function(Q){return v(Q)&&d.indexOf(Q.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(Q){return v(Q)&&g(Q)&&e[Q.charCodeAt(0)].length>=1};var k=t.__arabicParser__.arabicLetterHasFinalForm=function(Q){return v(Q)&&g(Q)&&e[Q.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(Q){return v(Q)&&g(Q)&&e[Q.charCodeAt(0)].length>=3};var O=t.__arabicParser__.arabicLetterHasMedialForm=function(Q){return v(Q)&&g(Q)&&e[Q.charCodeAt(0)].length==4},z=t.__arabicParser__.resolveLigatures=function(Q){var se=0,J=s,te="",le=0;for(se=0;se<Q.length;se+=1)J[Q.charCodeAt(se)]!==void 0?(le++,typeof(J=J[Q.charCodeAt(se)])=="number"&&(te+=String.fromCharCode(J),J=s,le=0),se===Q.length-1&&(J=s,te+=Q.charAt(se-(le-1)),se-=le-1,le=0)):(J=s,te+=Q.charAt(se-le),se-=le,le=0);return te};t.__arabicParser__.isArabicDiacritic=function(Q){return Q!==void 0&&a[Q.charCodeAt(0)]!==void 0};var G=t.__arabicParser__.getCorrectForm=function(Q,se,J){return v(Q)?g(Q)===!1?-1:!k(Q)||!v(se)&&!v(J)||!v(J)&&i(se)||i(Q)&&!v(se)||i(Q)&&E(se)||i(Q)&&i(se)?0:O(Q)&&v(se)&&!i(se)&&v(J)&&k(J)?3:i(Q)||!v(J)?1:2:-1},U=function(Q){var se=0,J=0,te=0,le="",ye="",Ne="",rt=(Q=Q||"").split("\\s+"),xe=[];for(se=0;se<rt.length;se+=1){for(xe.push(""),J=0;J<rt[se].length;J+=1)le=rt[se][J],ye=rt[se][J-1],Ne=rt[se][J+1],v(le)?(te=G(le,ye,Ne),xe[se]+=te!==-1?String.fromCharCode(e[le.charCodeAt(0)][te]):le):xe[se]+=le;xe[se]=z(xe[se])}return xe.join(" ")},ie=t.__arabicParser__.processArabic=t.processArabic=function(){var Q,se=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,J=[];if(Array.isArray(se)){var te=0;for(J=[],te=0;te<se.length;te+=1)Array.isArray(se[te])?J.push([U(se[te][0]),se[te][1],se[te][2]]):J.push([U(se[te])]);Q=J}else Q=U(se);return typeof arguments[0]=="string"?Q:(arguments[0].text=Q,arguments[0])};t.events.push(["preProcessText",ie])}(Qr.API),Qr.API.autoPrint=function(t){var e;switch((t=t||{}).variant=t.variant||"non-conform",t.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(t){var e=function(){var s=void 0;Object.defineProperty(this,"pdf",{get:function(){return s},set:function(i){s=i}});var a=150;Object.defineProperty(this,"width",{get:function(){return a},set:function(i){a=isNaN(i)||Number.isInteger(i)===!1||i<0?150:i,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=a+1)}});var d=300;Object.defineProperty(this,"height",{get:function(){return d},set:function(i){d=isNaN(i)||Number.isInteger(i)===!1||i<0?300:i,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=d+1)}});var g=[];Object.defineProperty(this,"childNodes",{get:function(){return g},set:function(i){g=i}});var v={};Object.defineProperty(this,"style",{get:function(){return v},set:function(i){v=i}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(s,a){var d;if((s=s||"2d")!=="2d")return null;for(d in a)this.pdf.context2d.hasOwnProperty(d)&&(this.pdf.context2d[d]=a[d]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(Qr.API),function(t){var e={left:0,top:0,bottom:0,right:0},s=!1,a=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),d.call(this))},d=function(){this.internal.__cell__.lastCell=new g,this.internal.__cell__.pages=1},g=function(){var E=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return E},set:function(Q){E=Q}});var k=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return k},set:function(Q){k=Q}});var O=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return O},set:function(Q){O=Q}});var z=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return z},set:function(Q){z=Q}});var G=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return G},set:function(Q){G=Q}});var U=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return U},set:function(Q){U=Q}});var ie=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return ie},set:function(Q){ie=Q}}),this};g.prototype.clone=function(){return new g(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},g.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(E){return a.call(this),this.internal.__cell__.headerFunction=typeof E=="function"?E:void 0,this},t.getTextDimensions=function(E,k){a.call(this);var O=(k=k||{}).fontSize||this.getFontSize(),z=k.font||this.getFont(),G=k.scaleFactor||this.internal.scaleFactor,U=0,ie=0,Q=0,se=this;if(!Array.isArray(E)&&typeof E!="string"){if(typeof E!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");E=String(E)}var J=k.maxWidth;J>0?typeof E=="string"?E=this.splitTextToSize(E,J):Object.prototype.toString.call(E)==="[object Array]"&&(E=E.reduce(function(le,ye){return le.concat(se.splitTextToSize(ye,J))},[])):E=Array.isArray(E)?E:[E];for(var te=0;te<E.length;te++)U<(Q=this.getStringUnitWidth(E[te],{font:z})*O)&&(U=Q);return U!==0&&(ie=E.length),{w:U/=G,h:Math.max((ie*O*this.getLineHeightFactor()-O*(this.getLineHeightFactor()-1))/G,0)}},t.cellAddPage=function(){a.call(this),this.addPage();var E=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new g(E.left,E.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var v=t.cell=function(){var E;E=arguments[0]instanceof g?arguments[0]:new g(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),a.call(this);var k=this.internal.__cell__.lastCell,O=this.internal.__cell__.padding,z=this.internal.__cell__.margins||e,G=this.internal.__cell__.tableHeaderRow,U=this.internal.__cell__.printHeaders;return k.lineNumber!==void 0&&(k.lineNumber===E.lineNumber?(E.x=(k.x||0)+(k.width||0),E.y=k.y||0):k.y+k.height+E.height+z.bottom>this.getPageHeight()?(this.cellAddPage(),E.y=z.top,U&&G&&(this.printHeaderRow(E.lineNumber,!0),E.y+=G[0].height)):E.y=k.y+k.height||E.y),E.text[0]!==void 0&&(this.rect(E.x,E.y,E.width,E.height,s===!0?"FD":void 0),E.align==="right"?this.text(E.text,E.x+E.width-O,E.y+O,{align:"right",baseline:"top"}):E.align==="center"?this.text(E.text,E.x+E.width/2,E.y+O,{align:"center",baseline:"top",maxWidth:E.width-O-O}):this.text(E.text,E.x+O,E.y+O,{align:"left",baseline:"top",maxWidth:E.width-O-O})),this.internal.__cell__.lastCell=E,this};t.table=function(E,k,O,z,G){if(a.call(this),!O)throw new Error("No data for PDF table.");var U,ie,Q,se,J=[],te=[],le=[],ye={},Ne={},rt=[],xe=[],Me=(G=G||{}).autoSize||!1,it=G.printHeaders!==!1,ot=G.css&&G.css["font-size"]!==void 0?16*G.css["font-size"]:G.fontSize||12,ve=G.margins||Object.assign({width:this.getPageWidth()},e),Le=typeof G.padding=="number"?G.padding:3,dt=G.headerBackgroundColor||"#c8c8c8",Je=G.headerTextColor||"#000";if(d.call(this),this.internal.__cell__.printHeaders=it,this.internal.__cell__.margins=ve,this.internal.__cell__.table_font_size=ot,this.internal.__cell__.padding=Le,this.internal.__cell__.headerBackgroundColor=dt,this.internal.__cell__.headerTextColor=Je,this.setFontSize(ot),z==null)te=J=Object.keys(O[0]),le=J.map(function(){return"left"});else if(Array.isArray(z)&&cs(z[0])==="object")for(J=z.map(function(Xe){return Xe.name}),te=z.map(function(Xe){return Xe.prompt||Xe.name||""}),le=z.map(function(Xe){return Xe.align||"left"}),U=0;U<z.length;U+=1)Ne[z[U].name]=z[U].width*(19.049976/25.4);else Array.isArray(z)&&typeof z[0]=="string"&&(te=J=z,le=J.map(function(){return"left"}));if(Me||Array.isArray(z)&&typeof z[0]=="string")for(U=0;U<J.length;U+=1){for(ye[se=J[U]]=O.map(function(Xe){return Xe[se]}),this.setFont(void 0,"bold"),rt.push(this.getTextDimensions(te[U],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),ie=ye[se],this.setFont(void 0,"normal"),Q=0;Q<ie.length;Q+=1)rt.push(this.getTextDimensions(ie[Q],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Ne[se]=Math.max.apply(null,rt)+Le+Le,rt=[]}if(it){var yt={};for(U=0;U<J.length;U+=1)yt[J[U]]={},yt[J[U]].text=te[U],yt[J[U]].align=le[U];var St=i.call(this,yt,Ne);xe=J.map(function(Xe){return new g(E,k,Ne[Xe],St,yt[Xe].text,void 0,yt[Xe].align)}),this.setTableHeaderRow(xe),this.printHeaderRow(1,!1)}var jt=z.reduce(function(Xe,Vt){return Xe[Vt.name]=Vt.align,Xe},{});for(U=0;U<O.length;U+=1){"rowStart"in G&&G.rowStart instanceof Function&&G.rowStart({row:U,data:O[U]},this);var et=i.call(this,O[U],Ne);for(Q=0;Q<J.length;Q+=1){var Qe=O[U][J[Q]];"cellStart"in G&&G.cellStart instanceof Function&&G.cellStart({row:U,col:Q,data:Qe},this),v.call(this,new g(E,k,Ne[J[Q]],et,Qe,U+2,jt[J[Q]]))}}return this.internal.__cell__.table_x=E,this.internal.__cell__.table_y=k,this};var i=function(E,k){var O=this.internal.__cell__.padding,z=this.internal.__cell__.table_font_size,G=this.internal.scaleFactor;return Object.keys(E).map(function(U){var ie=E[U];return this.splitTextToSize(ie.hasOwnProperty("text")?ie.text:ie,k[U]-O-O)},this).map(function(U){return this.getLineHeightFactor()*U.length*z/G+O+O},this).reduce(function(U,ie){return Math.max(U,ie)},0)};t.setTableHeaderRow=function(E){a.call(this),this.internal.__cell__.tableHeaderRow=E},t.printHeaderRow=function(E,k){if(a.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var O;if(s=!0,typeof this.internal.__cell__.headerFunction=="function"){var z=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new g(z[0],z[1],z[2],z[3],void 0,-1)}this.setFont(void 0,"bold");for(var G=[],U=0;U<this.internal.__cell__.tableHeaderRow.length;U+=1){O=this.internal.__cell__.tableHeaderRow[U].clone(),k&&(O.y=this.internal.__cell__.margins.top||0,G.push(O)),O.lineNumber=E;var ie=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),v.call(this,O),this.setTextColor(ie)}G.length>0&&this.setTableHeaderRow(G),this.setFont(void 0,"normal"),s=!1}}(Qr.API);var fz={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},pz=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],GT=dz(pz),mz=[100,200,300,400,500,600,700,800,900],gZ=dz(mz);function HT(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),s=function(g){return fz[g=g||"normal"]?g:"normal"}(t.style),a=function(g){if(!g)return 400;if(typeof g=="number")return g>=100&&g<=900&&g%100==0?g:400;if(/^\d00$/.test(g))return parseInt(g);switch(g){case"bold":return 700;case"normal":default:return 400}}(t.weight),d=function(g){return typeof GT[g=g||"normal"]=="number"?g:"normal"}(t.stretch);return{family:e,style:s,weight:a,stretch:d,src:t.src||[],ref:t.ref||{name:e,style:[d,s,a].join(" ")}}}function eL(t,e,s,a){var d;for(d=s;d>=0&&d<e.length;d+=a)if(t[e[d]])return t[e[d]];for(d=s;d>=0&&d<e.length;d-=a)if(t[e[d]])return t[e[d]]}var _Z={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},tL={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function nL(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function yZ(t,e,s){for(var a=(s=s||{}).defaultFontFamily||"times",d=Object.assign({},_Z,s.genericFontFamilies||{}),g=null,v=null,i=0;i<e.length;++i)if(d[(g=HT(e[i])).family]&&(g.family=d[g.family]),t.hasOwnProperty(g.family)){v=t[g.family];break}if(!(v=v||t[a]))throw new Error("Could not find a font-family for the rule '"+nL(g)+"' and default family '"+a+"'.");if(v=function(E,k){if(k[E])return k[E];var O=GT[E],z=O<=GT.normal?-1:1,G=eL(k,pz,O,z);if(!G)throw new Error("Could not find a matching font-stretch value for "+E);return G}(g.stretch,v),v=function(E,k){if(k[E])return k[E];for(var O=fz[E],z=0;z<O.length;++z)if(k[O[z]])return k[O[z]];throw new Error("Could not find a matching font-style for "+E)}(g.style,v),!(v=function(E,k){if(k[E])return k[E];if(E===400&&k[500])return k[500];if(E===500&&k[400])return k[400];var O=gZ[E],z=eL(k,mz,O,E<400?-1:1);if(!z)throw new Error("Could not find a matching font-weight for value "+E);return z}(g.weight,v)))throw new Error("Failed to resolve a font for the rule '"+nL(g)+"'.");return v}function rL(t){return t.trimLeft()}function vZ(t,e){for(var s=0;s<t.length;){if(t.charAt(s)===e)return[t.substring(0,s),t.substring(s+1)];s+=1}return null}function xZ(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],t.substring(e[0].length)]}var xx,iL,sL,J5=["times"];(function(t){var e,s,a,d,g,v,i,E,k,O=function(be){return be=be||{},this.isStrokeTransparent=be.isStrokeTransparent||!1,this.strokeOpacity=be.strokeOpacity||1,this.strokeStyle=be.strokeStyle||"#000000",this.fillStyle=be.fillStyle||"#000000",this.isFillTransparent=be.isFillTransparent||!1,this.fillOpacity=be.fillOpacity||1,this.font=be.font||"10px sans-serif",this.textBaseline=be.textBaseline||"alphabetic",this.textAlign=be.textAlign||"left",this.lineWidth=be.lineWidth||1,this.lineJoin=be.lineJoin||"miter",this.lineCap=be.lineCap||"butt",this.path=be.path||[],this.transform=be.transform!==void 0?be.transform.clone():new E,this.globalCompositeOperation=be.globalCompositeOperation||"normal",this.globalAlpha=be.globalAlpha||1,this.clip_path=be.clip_path||[],this.currentPoint=be.currentPoint||new v,this.miterLimit=be.miterLimit||10,this.lastPoint=be.lastPoint||new v,this.lineDashOffset=be.lineDashOffset||0,this.lineDash=be.lineDash||[],this.margin=be.margin||[0,0,0,0],this.prevPageLastElemOffset=be.prevPageLastElemOffset||0,this.ignoreClearRect=typeof be.ignoreClearRect!="boolean"||be.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new z(this),e=this.internal.f2,s=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString,d=this.internal.getHorizontalCoordinate,g=this.internal.getVerticalCoordinate,v=this.internal.Point,i=this.internal.Rectangle,E=this.internal.Matrix,k=new O}]);var z=function(be){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Re=be;Object.defineProperty(this,"pdf",{get:function(){return Re}});var Fe=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Fe},set:function(cn){Fe=!!cn}});var ut=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return ut},set:function(cn){ut=!!cn}});var Et=0;Object.defineProperty(this,"posX",{get:function(){return Et},set:function(cn){isNaN(cn)||(Et=cn)}});var Ct=0;Object.defineProperty(this,"posY",{get:function(){return Ct},set:function(cn){isNaN(cn)||(Ct=cn)}}),Object.defineProperty(this,"margin",{get:function(){return k.margin},set:function(cn){var _t;typeof cn=="number"?_t=[cn,cn,cn,cn]:((_t=new Array(4))[0]=cn[0],_t[1]=cn.length>=2?cn[1]:_t[0],_t[2]=cn.length>=3?cn[2]:_t[0],_t[3]=cn.length>=4?cn[3]:_t[1]),k.margin=_t}});var Wt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Wt},set:function(cn){Wt=cn}});var Ft=0;Object.defineProperty(this,"lastBreak",{get:function(){return Ft},set:function(cn){Ft=cn}});var me=[];Object.defineProperty(this,"pageBreaks",{get:function(){return me},set:function(cn){me=cn}}),Object.defineProperty(this,"ctx",{get:function(){return k},set:function(cn){cn instanceof O&&(k=cn)}}),Object.defineProperty(this,"path",{get:function(){return k.path},set:function(cn){k.path=cn}});var dn=[];Object.defineProperty(this,"ctxStack",{get:function(){return dn},set:function(cn){dn=cn}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(cn){var _t;_t=G(cn),this.ctx.fillStyle=_t.style,this.ctx.isFillTransparent=_t.a===0,this.ctx.fillOpacity=_t.a,this.pdf.setFillColor(_t.r,_t.g,_t.b,{a:_t.a}),this.pdf.setTextColor(_t.r,_t.g,_t.b,{a:_t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(cn){var _t=G(cn);this.ctx.strokeStyle=_t.style,this.ctx.isStrokeTransparent=_t.a===0,this.ctx.strokeOpacity=_t.a,_t.a===0?this.pdf.setDrawColor(255,255,255):(_t.a,this.pdf.setDrawColor(_t.r,_t.g,_t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(cn){["butt","round","square"].indexOf(cn)!==-1&&(this.ctx.lineCap=cn,this.pdf.setLineCap(cn))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(cn){isNaN(cn)||(this.ctx.lineWidth=cn,this.pdf.setLineWidth(cn))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(cn){["bevel","round","miter"].indexOf(cn)!==-1&&(this.ctx.lineJoin=cn,this.pdf.setLineJoin(cn))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(cn){isNaN(cn)||(this.ctx.miterLimit=cn,this.pdf.setMiterLimit(cn))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(cn){this.ctx.textBaseline=cn}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(cn){["right","end","center","left","start"].indexOf(cn)!==-1&&(this.ctx.textAlign=cn)}});var Cn=null;function On(cn,_t){if(Cn===null){var yr=function(En){var bn=[];return Object.keys(En).forEach(function(Fn){En[Fn].forEach(function(Gn){var Un=null;switch(Gn){case"bold":Un={family:Fn,weight:"bold"};break;case"italic":Un={family:Fn,style:"italic"};break;case"bolditalic":Un={family:Fn,weight:"bold",style:"italic"};break;case"":case"normal":Un={family:Fn}}Un!==null&&(Un.ref={name:Fn,style:Gn},bn.push(Un))})}),bn}(cn.getFontList());Cn=function(En){for(var bn={},Fn=0;Fn<En.length;++Fn){var Gn=HT(En[Fn]),Un=Gn.family,pr=Gn.stretch,Ln=Gn.style,br=Gn.weight;bn[Un]=bn[Un]||{},bn[Un][pr]=bn[Un][pr]||{},bn[Un][pr][Ln]=bn[Un][pr][Ln]||{},bn[Un][pr][Ln][br]=Gn}return bn}(yr.concat(_t))}return Cn}var $t=null;Object.defineProperty(this,"fontFaces",{get:function(){return $t},set:function(cn){Cn=null,$t=cn}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(cn){var _t;if(this.ctx.font=cn,(_t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(cn))!==null){var yr=_t[1];_t[2];var En=_t[3],bn=_t[4];_t[5];var Fn=_t[6],Gn=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(bn)[2];bn=Math.floor(Gn==="px"?parseFloat(bn)*this.pdf.internal.scaleFactor:Gn==="em"?parseFloat(bn)*this.pdf.getFontSize():parseFloat(bn)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(bn);var Un=function(wr){var Ur,Kn,Hs=[],fi=wr.trim();if(fi==="")return J5;if(fi in tL)return[tL[fi]];for(;fi!=="";){switch(Kn=null,Ur=(fi=rL(fi)).charAt(0)){case'"':case"'":Kn=vZ(fi.substring(1),Ur);break;default:Kn=xZ(fi)}if(Kn===null||(Hs.push(Kn[0]),(fi=rL(Kn[1]))!==""&&fi.charAt(0)!==","))return J5;fi=fi.replace(/^,/,"")}return Hs}(Fn);if(this.fontFaces){var pr=yZ(On(this.pdf,this.fontFaces),Un.map(function(wr){return{family:wr,stretch:"normal",weight:En,style:yr}}));this.pdf.setFont(pr.ref.name,pr.ref.style)}else{var Ln="";(En==="bold"||parseInt(En,10)>=700||yr==="bold")&&(Ln="bold"),yr==="italic"&&(Ln+="italic"),Ln.length===0&&(Ln="normal");for(var br="",Kr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},hi=0;hi<Un.length;hi++){if(this.pdf.internal.getFont(Un[hi],Ln,{noFallback:!0,disableWarning:!0})!==void 0){br=Un[hi];break}if(Ln==="bolditalic"&&this.pdf.internal.getFont(Un[hi],"bold",{noFallback:!0,disableWarning:!0})!==void 0)br=Un[hi],Ln="bold";else if(this.pdf.internal.getFont(Un[hi],"normal",{noFallback:!0,disableWarning:!0})!==void 0){br=Un[hi],Ln="normal";break}}if(br===""){for(var si=0;si<Un.length;si++)if(Kr[Un[si]]){br=Kr[Un[si]];break}}br=br===""?"Times":br,this.pdf.setFont(br,Ln)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(cn){this.ctx.globalCompositeOperation=cn}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(cn){this.ctx.globalAlpha=cn}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(cn){this.ctx.lineDashOffset=cn,Vt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(cn){this.ctx.lineDash=cn,Vt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(cn){this.ctx.ignoreClearRect=!!cn}})};z.prototype.setLineDash=function(be){this.lineDash=be},z.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},z.prototype.fill=function(){ye.call(this,"fill",!1)},z.prototype.stroke=function(){ye.call(this,"stroke",!1)},z.prototype.beginPath=function(){this.path=[{type:"begin"}]},z.prototype.moveTo=function(be,Re){if(isNaN(be)||isNaN(Re))throw Ts.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Fe=this.ctx.transform.applyToPoint(new v(be,Re));this.path.push({type:"mt",x:Fe.x,y:Fe.y}),this.ctx.lastPoint=new v(be,Re)},z.prototype.closePath=function(){var be=new v(0,0),Re=0;for(Re=this.path.length-1;Re!==-1;Re--)if(this.path[Re].type==="begin"&&cs(this.path[Re+1])==="object"&&typeof this.path[Re+1].x=="number"){be=new v(this.path[Re+1].x,this.path[Re+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new v(be.x,be.y)},z.prototype.lineTo=function(be,Re){if(isNaN(be)||isNaN(Re))throw Ts.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Fe=this.ctx.transform.applyToPoint(new v(be,Re));this.path.push({type:"lt",x:Fe.x,y:Fe.y}),this.ctx.lastPoint=new v(Fe.x,Fe.y)},z.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),ye.call(this,null,!0)},z.prototype.quadraticCurveTo=function(be,Re,Fe,ut){if(isNaN(Fe)||isNaN(ut)||isNaN(be)||isNaN(Re))throw Ts.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Et=this.ctx.transform.applyToPoint(new v(Fe,ut)),Ct=this.ctx.transform.applyToPoint(new v(be,Re));this.path.push({type:"qct",x1:Ct.x,y1:Ct.y,x:Et.x,y:Et.y}),this.ctx.lastPoint=new v(Et.x,Et.y)},z.prototype.bezierCurveTo=function(be,Re,Fe,ut,Et,Ct){if(isNaN(Et)||isNaN(Ct)||isNaN(be)||isNaN(Re)||isNaN(Fe)||isNaN(ut))throw Ts.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Wt=this.ctx.transform.applyToPoint(new v(Et,Ct)),Ft=this.ctx.transform.applyToPoint(new v(be,Re)),me=this.ctx.transform.applyToPoint(new v(Fe,ut));this.path.push({type:"bct",x1:Ft.x,y1:Ft.y,x2:me.x,y2:me.y,x:Wt.x,y:Wt.y}),this.ctx.lastPoint=new v(Wt.x,Wt.y)},z.prototype.arc=function(be,Re,Fe,ut,Et,Ct){if(isNaN(be)||isNaN(Re)||isNaN(Fe)||isNaN(ut)||isNaN(Et))throw Ts.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Ct=!!Ct,!this.ctx.transform.isIdentity){var Wt=this.ctx.transform.applyToPoint(new v(be,Re));be=Wt.x,Re=Wt.y;var Ft=this.ctx.transform.applyToPoint(new v(0,Fe)),me=this.ctx.transform.applyToPoint(new v(0,0));Fe=Math.sqrt(Math.pow(Ft.x-me.x,2)+Math.pow(Ft.y-me.y,2))}Math.abs(Et-ut)>=2*Math.PI&&(ut=0,Et=2*Math.PI),this.path.push({type:"arc",x:be,y:Re,radius:Fe,startAngle:ut,endAngle:Et,counterclockwise:Ct})},z.prototype.arcTo=function(be,Re,Fe,ut,Et){throw new Error("arcTo not implemented.")},z.prototype.rect=function(be,Re,Fe,ut){if(isNaN(be)||isNaN(Re)||isNaN(Fe)||isNaN(ut))throw Ts.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(be,Re),this.lineTo(be+Fe,Re),this.lineTo(be+Fe,Re+ut),this.lineTo(be,Re+ut),this.lineTo(be,Re),this.lineTo(be+Fe,Re),this.lineTo(be,Re)},z.prototype.fillRect=function(be,Re,Fe,ut){if(isNaN(be)||isNaN(Re)||isNaN(Fe)||isNaN(ut))throw Ts.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!U.call(this)){var Et={};this.lineCap!=="butt"&&(Et.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Et.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(be,Re,Fe,ut),this.fill(),Et.hasOwnProperty("lineCap")&&(this.lineCap=Et.lineCap),Et.hasOwnProperty("lineJoin")&&(this.lineJoin=Et.lineJoin)}},z.prototype.strokeRect=function(be,Re,Fe,ut){if(isNaN(be)||isNaN(Re)||isNaN(Fe)||isNaN(ut))throw Ts.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");ie.call(this)||(this.beginPath(),this.rect(be,Re,Fe,ut),this.stroke())},z.prototype.clearRect=function(be,Re,Fe,ut){if(isNaN(be)||isNaN(Re)||isNaN(Fe)||isNaN(ut))throw Ts.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(be,Re,Fe,ut))},z.prototype.save=function(be){be=typeof be!="boolean"||be;for(var Re=this.pdf.internal.getCurrentPageInfo().pageNumber,Fe=0;Fe<this.pdf.internal.getNumberOfPages();Fe++)this.pdf.setPage(Fe+1),this.pdf.internal.out("q");if(this.pdf.setPage(Re),be){this.ctx.fontSize=this.pdf.internal.getFontSize();var ut=new O(this.ctx);this.ctxStack.push(this.ctx),this.ctx=ut}},z.prototype.restore=function(be){be=typeof be!="boolean"||be;for(var Re=this.pdf.internal.getCurrentPageInfo().pageNumber,Fe=0;Fe<this.pdf.internal.getNumberOfPages();Fe++)this.pdf.setPage(Fe+1),this.pdf.internal.out("Q");this.pdf.setPage(Re),be&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},z.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var G=function(be){var Re,Fe,ut,Et;if(be.isCanvasGradient===!0&&(be=be.getColor()),!be)return{r:0,g:0,b:0,a:0,style:be};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(be))Re=0,Fe=0,ut=0,Et=0;else{var Ct=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(be);if(Ct!==null)Re=parseInt(Ct[1]),Fe=parseInt(Ct[2]),ut=parseInt(Ct[3]),Et=1;else if((Ct=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(be))!==null)Re=parseInt(Ct[1]),Fe=parseInt(Ct[2]),ut=parseInt(Ct[3]),Et=parseFloat(Ct[4]);else{if(Et=1,typeof be=="string"&&be.charAt(0)!=="#"){var Wt=new oz(be);be=Wt.ok?Wt.toHex():"#000000"}be.length===4?(Re=be.substring(1,2),Re+=Re,Fe=be.substring(2,3),Fe+=Fe,ut=be.substring(3,4),ut+=ut):(Re=be.substring(1,3),Fe=be.substring(3,5),ut=be.substring(5,7)),Re=parseInt(Re,16),Fe=parseInt(Fe,16),ut=parseInt(ut,16)}}return{r:Re,g:Fe,b:ut,a:Et,style:be}},U=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},ie=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};z.prototype.fillText=function(be,Re,Fe,ut){if(isNaN(Re)||isNaN(Fe)||typeof be!="string")throw Ts.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(ut=isNaN(ut)?void 0:ut,!U.call(this)){var Et=et(this.ctx.transform.rotation),Ct=this.ctx.transform.scaleX;Le.call(this,{text:be,x:Re,y:Fe,scale:Ct,angle:Et,align:this.textAlign,maxWidth:ut})}},z.prototype.strokeText=function(be,Re,Fe,ut){if(isNaN(Re)||isNaN(Fe)||typeof be!="string")throw Ts.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!ie.call(this)){ut=isNaN(ut)?void 0:ut;var Et=et(this.ctx.transform.rotation),Ct=this.ctx.transform.scaleX;Le.call(this,{text:be,x:Re,y:Fe,scale:Ct,renderingMode:"stroke",angle:Et,align:this.textAlign,maxWidth:ut})}},z.prototype.measureText=function(be){if(typeof be!="string")throw Ts.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Re=this.pdf,Fe=this.pdf.internal.scaleFactor,ut=Re.internal.getFontSize(),Et=Re.getStringUnitWidth(be)*ut/Re.internal.scaleFactor,Ct=function(Wt){var Ft=(Wt=Wt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Ft}}),this};return new Ct({width:Et*=Math.round(96*Fe/72*1e4)/1e4})},z.prototype.scale=function(be,Re){if(isNaN(be)||isNaN(Re))throw Ts.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Fe=new E(be,0,0,Re,0,0);this.ctx.transform=this.ctx.transform.multiply(Fe)},z.prototype.rotate=function(be){if(isNaN(be))throw Ts.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Re=new E(Math.cos(be),Math.sin(be),-Math.sin(be),Math.cos(be),0,0);this.ctx.transform=this.ctx.transform.multiply(Re)},z.prototype.translate=function(be,Re){if(isNaN(be)||isNaN(Re))throw Ts.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Fe=new E(1,0,0,1,be,Re);this.ctx.transform=this.ctx.transform.multiply(Fe)},z.prototype.transform=function(be,Re,Fe,ut,Et,Ct){if(isNaN(be)||isNaN(Re)||isNaN(Fe)||isNaN(ut)||isNaN(Et)||isNaN(Ct))throw Ts.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Wt=new E(be,Re,Fe,ut,Et,Ct);this.ctx.transform=this.ctx.transform.multiply(Wt)},z.prototype.setTransform=function(be,Re,Fe,ut,Et,Ct){be=isNaN(be)?1:be,Re=isNaN(Re)?0:Re,Fe=isNaN(Fe)?0:Fe,ut=isNaN(ut)?1:ut,Et=isNaN(Et)?0:Et,Ct=isNaN(Ct)?0:Ct,this.ctx.transform=new E(be,Re,Fe,ut,Et,Ct)};var Q=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};z.prototype.drawImage=function(be,Re,Fe,ut,Et,Ct,Wt,Ft,me){var dn=this.pdf.getImageProperties(be),Cn=1,On=1,$t=1,cn=1;ut!==void 0&&Ft!==void 0&&($t=Ft/ut,cn=me/Et,Cn=dn.width/ut*Ft/ut,On=dn.height/Et*me/Et),Ct===void 0&&(Ct=Re,Wt=Fe,Re=0,Fe=0),ut!==void 0&&Ft===void 0&&(Ft=ut,me=Et),ut===void 0&&Ft===void 0&&(Ft=dn.width,me=dn.height);for(var _t,yr=this.ctx.transform.decompose(),En=et(yr.rotate.shx),bn=new E,Fn=(bn=(bn=(bn=bn.multiply(yr.translate)).multiply(yr.skew)).multiply(yr.scale)).applyToRectangle(new i(Ct-Re*$t,Wt-Fe*cn,ut*Cn,Et*On)),Gn=se.call(this,Fn),Un=[],pr=0;pr<Gn.length;pr+=1)Un.indexOf(Gn[pr])===-1&&Un.push(Gn[pr]);if(le(Un),this.autoPaging)for(var Ln=Un[0],br=Un[Un.length-1],Kr=Ln;Kr<br+1;Kr++){this.pdf.setPage(Kr);var hi=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],si=Kr===1?this.posY+this.margin[0]:this.margin[0],wr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ur=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Kn=Kr===1?0:wr+(Kr-2)*Ur;if(this.ctx.clip_path.length!==0){var Hs=this.path;_t=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=te(_t,this.posX+this.margin[3],-Kn+si+this.ctx.prevPageLastElemOffset),Ne.call(this,"fill",!0),this.path=Hs}var fi=JSON.parse(JSON.stringify(Fn));fi=te([fi],this.posX+this.margin[3],-Kn+si+this.ctx.prevPageLastElemOffset)[0];var xo=(Kr>Ln||Kr<br)&&Q.call(this);xo&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],hi,Ur,null).clip().discardPath()),this.pdf.addImage(be,"JPEG",fi.x,fi.y,fi.w,fi.h,null,null,En),xo&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(be,"JPEG",Fn.x,Fn.y,Fn.w,Fn.h,null,null,En)};var se=function(be,Re,Fe){var ut=[];Re=Re||this.pdf.internal.pageSize.width,Fe=Fe||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Et=this.posY+this.ctx.prevPageLastElemOffset;switch(be.type){default:case"mt":case"lt":ut.push(Math.floor((be.y+Et)/Fe)+1);break;case"arc":ut.push(Math.floor((be.y+Et-be.radius)/Fe)+1),ut.push(Math.floor((be.y+Et+be.radius)/Fe)+1);break;case"qct":var Ct=Qe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,be.x1,be.y1,be.x,be.y);ut.push(Math.floor((Ct.y+Et)/Fe)+1),ut.push(Math.floor((Ct.y+Ct.h+Et)/Fe)+1);break;case"bct":var Wt=Xe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,be.x1,be.y1,be.x2,be.y2,be.x,be.y);ut.push(Math.floor((Wt.y+Et)/Fe)+1),ut.push(Math.floor((Wt.y+Wt.h+Et)/Fe)+1);break;case"rect":ut.push(Math.floor((be.y+Et)/Fe)+1),ut.push(Math.floor((be.y+be.h+Et)/Fe)+1)}for(var Ft=0;Ft<ut.length;Ft+=1)for(;this.pdf.internal.getNumberOfPages()<ut[Ft];)J.call(this);return ut},J=function(){var be=this.fillStyle,Re=this.strokeStyle,Fe=this.font,ut=this.lineCap,Et=this.lineWidth,Ct=this.lineJoin;this.pdf.addPage(),this.fillStyle=be,this.strokeStyle=Re,this.font=Fe,this.lineCap=ut,this.lineWidth=Et,this.lineJoin=Ct},te=function(be,Re,Fe){for(var ut=0;ut<be.length;ut++)switch(be[ut].type){case"bct":be[ut].x2+=Re,be[ut].y2+=Fe;case"qct":be[ut].x1+=Re,be[ut].y1+=Fe;case"mt":case"lt":case"arc":default:be[ut].x+=Re,be[ut].y+=Fe}return be},le=function(be){return be.sort(function(Re,Fe){return Re-Fe})},ye=function(be,Re){for(var Fe,ut,Et=this.fillStyle,Ct=this.strokeStyle,Wt=this.lineCap,Ft=this.lineWidth,me=Math.abs(Ft*this.ctx.transform.scaleX),dn=this.lineJoin,Cn=JSON.parse(JSON.stringify(this.path)),On=JSON.parse(JSON.stringify(this.path)),$t=[],cn=0;cn<On.length;cn++)if(On[cn].x!==void 0)for(var _t=se.call(this,On[cn]),yr=0;yr<_t.length;yr+=1)$t.indexOf(_t[yr])===-1&&$t.push(_t[yr]);for(var En=0;En<$t.length;En++)for(;this.pdf.internal.getNumberOfPages()<$t[En];)J.call(this);if(le($t),this.autoPaging)for(var bn=$t[0],Fn=$t[$t.length-1],Gn=bn;Gn<Fn+1;Gn++){this.pdf.setPage(Gn),this.fillStyle=Et,this.strokeStyle=Ct,this.lineCap=Wt,this.lineWidth=me,this.lineJoin=dn;var Un=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],pr=Gn===1?this.posY+this.margin[0]:this.margin[0],Ln=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],br=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Kr=Gn===1?0:Ln+(Gn-2)*br;if(this.ctx.clip_path.length!==0){var hi=this.path;Fe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=te(Fe,this.posX+this.margin[3],-Kr+pr+this.ctx.prevPageLastElemOffset),Ne.call(this,be,!0),this.path=hi}if(ut=JSON.parse(JSON.stringify(Cn)),this.path=te(ut,this.posX+this.margin[3],-Kr+pr+this.ctx.prevPageLastElemOffset),Re===!1||Gn===0){var si=(Gn>bn||Gn<Fn)&&Q.call(this);si&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Un,br,null).clip().discardPath()),Ne.call(this,be,Re),si&&this.pdf.restoreGraphicsState()}this.lineWidth=Ft}else this.lineWidth=me,Ne.call(this,be,Re),this.lineWidth=Ft;this.path=Cn},Ne=function(be,Re){if((be!=="stroke"||Re||!ie.call(this))&&(be==="stroke"||Re||!U.call(this))){for(var Fe,ut,Et=[],Ct=this.path,Wt=0;Wt<Ct.length;Wt++){var Ft=Ct[Wt];switch(Ft.type){case"begin":Et.push({begin:!0});break;case"close":Et.push({close:!0});break;case"mt":Et.push({start:Ft,deltas:[],abs:[]});break;case"lt":var me=Et.length;if(Ct[Wt-1]&&!isNaN(Ct[Wt-1].x)&&(Fe=[Ft.x-Ct[Wt-1].x,Ft.y-Ct[Wt-1].y],me>0)){for(;me>=0;me--)if(Et[me-1].close!==!0&&Et[me-1].begin!==!0){Et[me-1].deltas.push(Fe),Et[me-1].abs.push(Ft);break}}break;case"bct":Fe=[Ft.x1-Ct[Wt-1].x,Ft.y1-Ct[Wt-1].y,Ft.x2-Ct[Wt-1].x,Ft.y2-Ct[Wt-1].y,Ft.x-Ct[Wt-1].x,Ft.y-Ct[Wt-1].y],Et[Et.length-1].deltas.push(Fe);break;case"qct":var dn=Ct[Wt-1].x+2/3*(Ft.x1-Ct[Wt-1].x),Cn=Ct[Wt-1].y+2/3*(Ft.y1-Ct[Wt-1].y),On=Ft.x+2/3*(Ft.x1-Ft.x),$t=Ft.y+2/3*(Ft.y1-Ft.y),cn=Ft.x,_t=Ft.y;Fe=[dn-Ct[Wt-1].x,Cn-Ct[Wt-1].y,On-Ct[Wt-1].x,$t-Ct[Wt-1].y,cn-Ct[Wt-1].x,_t-Ct[Wt-1].y],Et[Et.length-1].deltas.push(Fe);break;case"arc":Et.push({deltas:[],abs:[],arc:!0}),Array.isArray(Et[Et.length-1].abs)&&Et[Et.length-1].abs.push(Ft)}}ut=Re?null:be==="stroke"?"stroke":"fill";for(var yr=!1,En=0;En<Et.length;En++)if(Et[En].arc)for(var bn=Et[En].abs,Fn=0;Fn<bn.length;Fn++){var Gn=bn[Fn];Gn.type==="arc"?Me.call(this,Gn.x,Gn.y,Gn.radius,Gn.startAngle,Gn.endAngle,Gn.counterclockwise,void 0,Re,!yr):dt.call(this,Gn.x,Gn.y),yr=!0}else if(Et[En].close===!0)this.pdf.internal.out("h"),yr=!1;else if(Et[En].begin!==!0){var Un=Et[En].start.x,pr=Et[En].start.y;Je.call(this,Et[En].deltas,Un,pr),yr=!0}ut&&it.call(this,ut),Re&&ot.call(this)}},rt=function(be){var Re=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Fe=Re*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return be-Fe;case"top":return be+Re-Fe;case"hanging":return be+Re-2*Fe;case"middle":return be+Re/2-Fe;case"ideographic":return be;case"alphabetic":default:return be}},xe=function(be){return be+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};z.prototype.createLinearGradient=function(){var be=function(){};return be.colorStops=[],be.addColorStop=function(Re,Fe){this.colorStops.push([Re,Fe])},be.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},be.isCanvasGradient=!0,be},z.prototype.createPattern=function(){return this.createLinearGradient()},z.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Me=function(be,Re,Fe,ut,Et,Ct,Wt,Ft,me){for(var dn=St.call(this,Fe,ut,Et,Ct),Cn=0;Cn<dn.length;Cn++){var On=dn[Cn];Cn===0&&(me?ve.call(this,On.x1+be,On.y1+Re):dt.call(this,On.x1+be,On.y1+Re)),yt.call(this,be,Re,On.x2,On.y2,On.x3,On.y3,On.x4,On.y4)}Ft?ot.call(this):it.call(this,Wt)},it=function(be){switch(be){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},ot=function(){this.pdf.clip(),this.pdf.discardPath()},ve=function(be,Re){this.pdf.internal.out(s(be)+" "+a(Re)+" m")},Le=function(be){var Re;switch(be.align){case"right":case"end":Re="right";break;case"center":Re="center";break;case"left":case"start":default:Re="left"}var Fe=this.pdf.getTextDimensions(be.text),ut=rt.call(this,be.y),Et=xe.call(this,ut)-Fe.h,Ct=this.ctx.transform.applyToPoint(new v(be.x,ut)),Wt=this.ctx.transform.decompose(),Ft=new E;Ft=(Ft=(Ft=Ft.multiply(Wt.translate)).multiply(Wt.skew)).multiply(Wt.scale);for(var me,dn,Cn,On=this.ctx.transform.applyToRectangle(new i(be.x,ut,Fe.w,Fe.h)),$t=Ft.applyToRectangle(new i(be.x,Et,Fe.w,Fe.h)),cn=se.call(this,$t),_t=[],yr=0;yr<cn.length;yr+=1)_t.indexOf(cn[yr])===-1&&_t.push(cn[yr]);if(le(_t),this.autoPaging)for(var En=_t[0],bn=_t[_t.length-1],Fn=En;Fn<bn+1;Fn++){this.pdf.setPage(Fn);var Gn=Fn===1?this.posY+this.margin[0]:this.margin[0],Un=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],pr=this.pdf.internal.pageSize.height-this.margin[2],Ln=pr-this.margin[0],br=this.pdf.internal.pageSize.width-this.margin[1],Kr=br-this.margin[3],hi=Fn===1?0:Un+(Fn-2)*Ln;if(this.ctx.clip_path.length!==0){var si=this.path;me=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=te(me,this.posX+this.margin[3],-1*hi+Gn),Ne.call(this,"fill",!0),this.path=si}var wr=te([JSON.parse(JSON.stringify($t))],this.posX+this.margin[3],-hi+Gn+this.ctx.prevPageLastElemOffset)[0];be.scale>=.01&&(dn=this.pdf.internal.getFontSize(),this.pdf.setFontSize(dn*be.scale),Cn=this.lineWidth,this.lineWidth=Cn*be.scale);var Ur=this.autoPaging!=="text";if(Ur||wr.y+wr.h<=pr){if(Ur||wr.y>=Gn&&wr.x<=br){var Kn=Ur?be.text:this.pdf.splitTextToSize(be.text,be.maxWidth||br-wr.x)[0],Hs=te([JSON.parse(JSON.stringify(On))],this.posX+this.margin[3],-hi+Gn+this.ctx.prevPageLastElemOffset)[0],fi=Ur&&(Fn>En||Fn<bn)&&Q.call(this);fi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Kr,Ln,null).clip().discardPath()),this.pdf.text(Kn,Hs.x,Hs.y,{angle:be.angle,align:Re,renderingMode:be.renderingMode}),fi&&this.pdf.restoreGraphicsState()}}else wr.y<pr&&(this.ctx.prevPageLastElemOffset+=pr-wr.y);be.scale>=.01&&(this.pdf.setFontSize(dn),this.lineWidth=Cn)}else be.scale>=.01&&(dn=this.pdf.internal.getFontSize(),this.pdf.setFontSize(dn*be.scale),Cn=this.lineWidth,this.lineWidth=Cn*be.scale),this.pdf.text(be.text,Ct.x+this.posX,Ct.y+this.posY,{angle:be.angle,align:Re,renderingMode:be.renderingMode,maxWidth:be.maxWidth}),be.scale>=.01&&(this.pdf.setFontSize(dn),this.lineWidth=Cn)},dt=function(be,Re,Fe,ut){Fe=Fe||0,ut=ut||0,this.pdf.internal.out(s(be+Fe)+" "+a(Re+ut)+" l")},Je=function(be,Re,Fe){return this.pdf.lines(be,Re,Fe,null,null)},yt=function(be,Re,Fe,ut,Et,Ct,Wt,Ft){this.pdf.internal.out([e(d(Fe+be)),e(g(ut+Re)),e(d(Et+be)),e(g(Ct+Re)),e(d(Wt+be)),e(g(Ft+Re)),"c"].join(" "))},St=function(be,Re,Fe,ut){for(var Et=2*Math.PI,Ct=Math.PI/2;Re>Fe;)Re-=Et;var Wt=Math.abs(Fe-Re);Wt<Et&&ut&&(Wt=Et-Wt);for(var Ft=[],me=ut?-1:1,dn=Re;Wt>1e-5;){var Cn=dn+me*Math.min(Wt,Ct);Ft.push(jt.call(this,be,dn,Cn)),Wt-=Math.abs(Cn-dn),dn=Cn}return Ft},jt=function(be,Re,Fe){var ut=(Fe-Re)/2,Et=be*Math.cos(ut),Ct=be*Math.sin(ut),Wt=Et,Ft=-Ct,me=Wt*Wt+Ft*Ft,dn=me+Wt*Et+Ft*Ct,Cn=4/3*(Math.sqrt(2*me*dn)-dn)/(Wt*Ct-Ft*Et),On=Wt-Cn*Ft,$t=Ft+Cn*Wt,cn=On,_t=-$t,yr=ut+Re,En=Math.cos(yr),bn=Math.sin(yr);return{x1:be*Math.cos(Re),y1:be*Math.sin(Re),x2:On*En-$t*bn,y2:On*bn+$t*En,x3:cn*En-_t*bn,y3:cn*bn+_t*En,x4:be*Math.cos(Fe),y4:be*Math.sin(Fe)}},et=function(be){return 180*be/Math.PI},Qe=function(be,Re,Fe,ut,Et,Ct){var Wt=be+.5*(Fe-be),Ft=Re+.5*(ut-Re),me=Et+.5*(Fe-Et),dn=Ct+.5*(ut-Ct),Cn=Math.min(be,Et,Wt,me),On=Math.max(be,Et,Wt,me),$t=Math.min(Re,Ct,Ft,dn),cn=Math.max(Re,Ct,Ft,dn);return new i(Cn,$t,On-Cn,cn-$t)},Xe=function(be,Re,Fe,ut,Et,Ct,Wt,Ft){var me,dn,Cn,On,$t,cn,_t,yr,En,bn,Fn,Gn,Un,pr,Ln=Fe-be,br=ut-Re,Kr=Et-Fe,hi=Ct-ut,si=Wt-Et,wr=Ft-Ct;for(dn=0;dn<41;dn++)En=(_t=(Cn=be+(me=dn/40)*Ln)+me*(($t=Fe+me*Kr)-Cn))+me*($t+me*(Et+me*si-$t)-_t),bn=(yr=(On=Re+me*br)+me*((cn=ut+me*hi)-On))+me*(cn+me*(Ct+me*wr-cn)-yr),dn==0?(Fn=En,Gn=bn,Un=En,pr=bn):(Fn=Math.min(Fn,En),Gn=Math.min(Gn,bn),Un=Math.max(Un,En),pr=Math.max(pr,bn));return new i(Math.round(Fn),Math.round(Gn),Math.round(Un-Fn),Math.round(pr-Gn))},Vt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var be,Re,Fe=(be=this.ctx.lineDash,Re=this.ctx.lineDashOffset,JSON.stringify({lineDash:be,lineDashOffset:Re}));this.prevLineDash!==Fe&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Fe)}}})(Qr.API),function(t){var e=function(g){var v,i,E,k,O,z,G,U,ie,Q;for(i=[],E=0,k=(g+=v="\0\0\0\0".slice(g.length%4||4)).length;k>E;E+=4)(O=(g.charCodeAt(E)<<24)+(g.charCodeAt(E+1)<<16)+(g.charCodeAt(E+2)<<8)+g.charCodeAt(E+3))!==0?(z=(O=((O=((O=((O=(O-(Q=O%85))/85)-(ie=O%85))/85)-(U=O%85))/85)-(G=O%85))/85)%85,i.push(z+33,G+33,U+33,ie+33,Q+33)):i.push(122);return function(se,J){for(var te=J;te>0;te--)se.pop()}(i,v.length),String.fromCharCode.apply(String,i)+"~>"},s=function(g){var v,i,E,k,O,z=String,G="length",U=255,ie="charCodeAt",Q="slice",se="replace";for(g[Q](-2),g=g[Q](0,-2)[se](/\s/g,"")[se]("z","!!!!!"),E=[],k=0,O=(g+=v="uuuuu"[Q](g[G]%5||5))[G];O>k;k+=5)i=52200625*(g[ie](k)-33)+614125*(g[ie](k+1)-33)+7225*(g[ie](k+2)-33)+85*(g[ie](k+3)-33)+(g[ie](k+4)-33),E.push(U&i>>24,U&i>>16,U&i>>8,U&i);return function(J,te){for(var le=te;le>0;le--)J.pop()}(E,v[G]),z.fromCharCode.apply(z,E)},a=function(g){var v=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((g=g.replace(/\s/g,"")).indexOf(">")!==-1&&(g=g.substr(0,g.indexOf(">"))),g.length%2&&(g+="0"),v.test(g)===!1)return"";for(var i="",E=0;E<g.length;E+=2)i+=String.fromCharCode("0x"+(g[E]+g[E+1]));return i},d=function(g){for(var v=new Uint8Array(g.length),i=g.length;i--;)v[i]=g.charCodeAt(i);return g=(v=jT(v)).reduce(function(E,k){return E+String.fromCharCode(k)},"")};t.processDataByFilters=function(g,v){var i=0,E=g||"",k=[];for(typeof(v=v||[])=="string"&&(v=[v]),i=0;i<v.length;i+=1)switch(v[i]){case"ASCII85Decode":case"/ASCII85Decode":E=s(E),k.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":E=e(E),k.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":E=a(E),k.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":E=E.split("").map(function(O){return("0"+O.charCodeAt().toString(16)).slice(-2)}).join("")+">",k.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":E=d(E),k.push("/FlateDecode");break;default:throw new Error('The filter: "'+v[i]+'" is not implemented')}return{data:E,reverseChain:k.reverse().join(" ")}}}(Qr.API),function(t){t.loadFile=function(e,s,a){return function(d,g,v){g=g!==!1,v=typeof v=="function"?v:function(){};var i=void 0;try{i=function(E,k,O){var z=new XMLHttpRequest,G=0,U=function(ie){var Q=ie.length,se=[],J=String.fromCharCode;for(G=0;G<Q;G+=1)se.push(J(255&ie.charCodeAt(G)));return se.join("")};if(z.open("GET",E,!k),z.overrideMimeType("text/plain; charset=x-user-defined"),k===!1&&(z.onload=function(){z.status===200?O(U(this.responseText)):O(void 0)}),z.send(null),k&&z.status===200)return U(z.responseText)}(d,g,v)}catch{}return i}(e,s,a)},t.loadImageFile=t.loadFile}(Qr.API),function(t){function e(){return(ei.html2canvas?Promise.resolve(ei.html2canvas):ad(()=>import("./html2canvas.esm-CBrSDip1.js"),[])).catch(function(v){return Promise.reject(new Error("Could not load html2canvas: "+v))}).then(function(v){return v.default?v.default:v})}function s(){return(ei.DOMPurify?Promise.resolve(ei.DOMPurify):ad(()=>import("./purify.es-CF4_YkFU.js"),[])).catch(function(v){return Promise.reject(new Error("Could not load dompurify: "+v))}).then(function(v){return v.default?v.default:v})}var a=function(v){var i=cs(v);return i==="undefined"?"undefined":i==="string"||v instanceof String?"string":i==="number"||v instanceof Number?"number":i==="function"||v instanceof Function?"function":v&&v.constructor===Array?"array":v&&v.nodeType===1?"element":i==="object"?"object":"unknown"},d=function(v,i){var E=document.createElement(v);for(var k in i.className&&(E.className=i.className),i.innerHTML&&i.dompurify&&(E.innerHTML=i.dompurify.sanitize(i.innerHTML)),i.style)E.style[k]=i.style[k];return E},g=function v(i){var E=Object.assign(v.convert(Promise.resolve()),JSON.parse(JSON.stringify(v.template))),k=v.convert(Promise.resolve(),E);return k=(k=k.setProgress(1,v,1,[v])).set(i)};(g.prototype=Object.create(Promise.prototype)).constructor=g,g.convert=function(v,i){return v.__proto__=i||g.prototype,v},g.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},g.prototype.from=function(v,i){return this.then(function(){switch(i=i||function(E){switch(a(E)){case"string":return"string";case"element":return E.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(v)){case"string":return this.then(s).then(function(E){return this.set({src:d("div",{innerHTML:v,dompurify:E})})});case"element":return this.set({src:v});case"canvas":return this.set({canvas:v});case"img":return this.set({img:v});default:return this.error("Unknown source type.")}})},g.prototype.to=function(v){switch(v){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},g.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var v={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},i=function E(k,O){for(var z=k.nodeType===3?document.createTextNode(k.nodeValue):k.cloneNode(!1),G=k.firstChild;G;G=G.nextSibling)O!==!0&&G.nodeType===1&&G.nodeName==="SCRIPT"||z.appendChild(E(G,O));return k.nodeType===1&&(k.nodeName==="CANVAS"?(z.width=k.width,z.height=k.height,z.getContext("2d").drawImage(k,0,0)):k.nodeName!=="TEXTAREA"&&k.nodeName!=="SELECT"||(z.value=k.value),z.addEventListener("load",function(){z.scrollTop=k.scrollTop,z.scrollLeft=k.scrollLeft},!0)),z}(this.prop.src,this.opt.html2canvas.javascriptEnabled);i.tagName==="BODY"&&(v.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=d("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=d("div",{className:"html2pdf__container",style:v}),this.prop.container.appendChild(i),this.prop.container.firstChild.appendChild(d("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},g.prototype.toCanvas=function(){var v=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(v).then(e).then(function(i){var E=Object.assign({},this.opt.html2canvas);return delete E.onrendered,i(this.prop.container,E)}).then(function(i){(this.opt.html2canvas.onrendered||function(){})(i),this.prop.canvas=i,document.body.removeChild(this.prop.overlay)})},g.prototype.toContext2d=function(){var v=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(v).then(e).then(function(i){var E=this.opt.jsPDF,k=this.opt.fontFaces,O=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,z=Object.assign({async:!0,allowTaint:!0,scale:O,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete z.onrendered,E.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,E.context2d.posX=this.opt.x,E.context2d.posY=this.opt.y,E.context2d.margin=this.opt.margin,E.context2d.fontFaces=k,k)for(var G=0;G<k.length;++G){var U=k[G],ie=U.src.find(function(Q){return Q.format==="truetype"});ie&&E.addFont(ie.url,U.ref.name,U.ref.style)}return z.windowHeight=z.windowHeight||0,z.windowHeight=z.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):z.windowHeight,E.context2d.save(!0),i(this.prop.container,z)}).then(function(i){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(i),this.prop.canvas=i,document.body.removeChild(this.prop.overlay)})},g.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var v=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=v})},g.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},g.prototype.output=function(v,i,E){return(E=E||"pdf").toLowerCase()==="img"||E.toLowerCase()==="image"?this.outputImg(v,i):this.outputPdf(v,i)},g.prototype.outputPdf=function(v,i){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(v,i)})},g.prototype.outputImg=function(v){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(v){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+v+'" is not supported.'}})},g.prototype.save=function(v){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(v?{filename:v}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},g.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},g.prototype.set=function(v){if(a(v)!=="object")return this;var i=Object.keys(v||{}).map(function(E){if(E in g.template.prop)return function(){this.prop[E]=v[E]};switch(E){case"margin":return this.setMargin.bind(this,v.margin);case"jsPDF":return function(){return this.opt.jsPDF=v.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,v.pageSize);default:return function(){this.opt[E]=v[E]}}},this);return this.then(function(){return this.thenList(i)})},g.prototype.get=function(v,i){return this.then(function(){var E=v in g.template.prop?this.prop[v]:this.opt[v];return i?i(E):E})},g.prototype.setMargin=function(v){return this.then(function(){switch(a(v)){case"number":v=[v,v,v,v];case"array":if(v.length===2&&(v=[v[0],v[1],v[0],v[1]]),v.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=v}).then(this.setPageSize)},g.prototype.setPageSize=function(v){function i(E,k){return Math.floor(E*k/72*96)}return this.then(function(){(v=v||Qr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(v.inner={width:v.width-this.opt.margin[1]-this.opt.margin[3],height:v.height-this.opt.margin[0]-this.opt.margin[2]},v.inner.px={width:i(v.inner.width,v.k),height:i(v.inner.height,v.k)},v.inner.ratio=v.inner.height/v.inner.width),this.prop.pageSize=v})},g.prototype.setProgress=function(v,i,E,k){return v!=null&&(this.progress.val=v),i!=null&&(this.progress.state=i),E!=null&&(this.progress.n=E),k!=null&&(this.progress.stack=k),this.progress.ratio=this.progress.val/this.progress.state,this},g.prototype.updateProgress=function(v,i,E,k){return this.setProgress(v?this.progress.val+v:null,i||null,E?this.progress.n+E:null,k?this.progress.stack.concat(k):null)},g.prototype.then=function(v,i){var E=this;return this.thenCore(v,i,function(k,O){return E.updateProgress(null,null,1,[k]),Promise.prototype.then.call(this,function(z){return E.updateProgress(null,k),z}).then(k,O).then(function(z){return E.updateProgress(1),z})})},g.prototype.thenCore=function(v,i,E){E=E||Promise.prototype.then,v&&(v=v.bind(this)),i&&(i=i.bind(this));var k=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:g.convert(Object.assign({},this),Promise.prototype),O=E.call(k,v,i);return g.convert(O,this.__proto__)},g.prototype.thenExternal=function(v,i){return Promise.prototype.then.call(this,v,i)},g.prototype.thenList=function(v){var i=this;return v.forEach(function(E){i=i.thenCore(E)}),i},g.prototype.catch=function(v){v&&(v=v.bind(this));var i=Promise.prototype.catch.call(this,v);return g.convert(i,this)},g.prototype.catchExternal=function(v){return Promise.prototype.catch.call(this,v)},g.prototype.error=function(v){return this.then(function(){throw new Error(v)})},g.prototype.using=g.prototype.set,g.prototype.saveAs=g.prototype.save,g.prototype.export=g.prototype.output,g.prototype.run=g.prototype.then,Qr.getPageSize=function(v,i,E){if(cs(v)==="object"){var k=v;v=k.orientation,i=k.unit||i,E=k.format||E}i=i||"mm",E=E||"a4",v=(""+(v||"P")).toLowerCase();var O,z=(""+E).toLowerCase(),G={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(i){case"pt":O=1;break;case"mm":O=72/25.4;break;case"cm":O=72/2.54;break;case"in":O=72;break;case"px":O=.75;break;case"pc":case"em":O=12;break;case"ex":O=6;break;default:throw"Invalid unit: "+i}var U,ie=0,Q=0;if(G.hasOwnProperty(z))ie=G[z][1]/O,Q=G[z][0]/O;else try{ie=E[1],Q=E[0]}catch{throw new Error("Invalid format: "+E)}if(v==="p"||v==="portrait")v="p",Q>ie&&(U=Q,Q=ie,ie=U);else{if(v!=="l"&&v!=="landscape")throw"Invalid orientation: "+v;v="l",ie>Q&&(U=Q,Q=ie,ie=U)}return{width:Q,height:ie,unit:i,k:O,orientation:v}},t.html=function(v,i){(i=i||{}).callback=i.callback||function(){},i.html2canvas=i.html2canvas||{},i.html2canvas.canvas=i.html2canvas.canvas||this.canvas,i.jsPDF=i.jsPDF||this,i.fontFaces=i.fontFaces?i.fontFaces.map(HT):null;var E=new g(i);return i.worker?E:E.from(v).doCallback()}}(Qr.API),Qr.API.addJS=function(t){return sL=t,this.internal.events.subscribe("postPutResources",function(){xx=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(xx+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),iL=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+sL+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){xx!==void 0&&iL!==void 0&&this.internal.out("/Names <</JavaScript "+xx+" 0 R>>")}),this},function(t){var e;t.events.push(["postPutResources",function(){var s=this,a=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var d=s.outline.render().split(/\r\n/),g=0;g<d.length;g++){var v=d[g],i=a.exec(v);if(i!=null){var E=i[1];s.internal.newObjectDeferredBegin(E,!1)}s.internal.write(v)}if(this.outline.createNamedDestinations){var k=this.internal.pages.length,O=[];for(g=0;g<k;g++){var z=s.internal.newObject();O.push(z);var G=s.internal.getPageInfo(g+1);s.internal.write("<< /D["+G.objId+" 0 R /XYZ null null null]>> endobj")}var U=s.internal.newObject();for(s.internal.write("<< /Names [ "),g=0;g<O.length;g++)s.internal.write("(page_"+(g+1)+")"+O[g]+" 0 R");s.internal.write(" ] >>","endobj"),e=s.internal.newObject(),s.internal.write("<< /Dests "+U+" 0 R"),s.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var s=this;s.outline={createNamedDestinations:!1,root:{children:[]}},s.outline.add=function(a,d,g){var v={title:d,options:g,children:[]};return a==null&&(a=this.root),a.children.push(v),v},s.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=s,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},s.outline.genIds_r=function(a){a.id=s.internal.newObjectDeferred();for(var d=0;d<a.children.length;d++)this.genIds_r(a.children[d])},s.outline.renderRoot=function(a){this.objStart(a),this.line("/Type /Outlines"),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1]))),this.line("/Count "+this.count_r({count:0},a)),this.objEnd()},s.outline.renderItems=function(a){for(var d=this.ctx.pdf.internal.getVerticalCoordinateString,g=0;g<a.children.length;g++){var v=a.children[g];this.objStart(v),this.line("/Title "+this.makeString(v.title)),this.line("/Parent "+this.makeRef(a)),g>0&&this.line("/Prev "+this.makeRef(a.children[g-1])),g<a.children.length-1&&this.line("/Next "+this.makeRef(a.children[g+1])),v.children.length>0&&(this.line("/First "+this.makeRef(v.children[0])),this.line("/Last "+this.makeRef(v.children[v.children.length-1])));var i=this.count=this.count_r({count:0},v);if(i>0&&this.line("/Count "+i),v.options&&v.options.pageNumber){var E=s.internal.getPageInfo(v.options.pageNumber);this.line("/Dest ["+E.objId+" 0 R /XYZ 0 "+d(0)+" 0]")}this.objEnd()}for(var k=0;k<a.children.length;k++)this.renderItems(a.children[k])},s.outline.line=function(a){this.ctx.val+=a+`\r
`},s.outline.makeRef=function(a){return a.id+" 0 R"},s.outline.makeString=function(a){return"("+s.internal.pdfEscape(a)+")"},s.outline.objStart=function(a){this.ctx.val+=`\r
`+a.id+` 0 obj\r
<<\r
`},s.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},s.outline.count_r=function(a,d){for(var g=0;g<d.children.length;g++)a.count++,this.count_r(a,d.children[g]);return a.count}}])}(Qr.API),function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(s,a,d,g,v,i){var E,k=this.decode.DCT_DECODE,O=null;if(typeof s=="string"||this.__addimage__.isArrayBuffer(s)||this.__addimage__.isArrayBufferView(s)){switch(s=v||s,s=this.__addimage__.isArrayBuffer(s)?new Uint8Array(s):s,(E=function(z){for(var G,U=256*z.charCodeAt(4)+z.charCodeAt(5),ie=z.length,Q={width:0,height:0,numcomponents:1},se=4;se<ie;se+=2){if(se+=U,e.indexOf(z.charCodeAt(se+1))!==-1){G=256*z.charCodeAt(se+5)+z.charCodeAt(se+6),Q={width:256*z.charCodeAt(se+7)+z.charCodeAt(se+8),height:G,numcomponents:z.charCodeAt(se+9)};break}U=256*z.charCodeAt(se+2)+z.charCodeAt(se+3)}return Q}(s=this.__addimage__.isArrayBufferView(s)?this.__addimage__.arrayBufferToBinaryString(s):s)).numcomponents){case 1:i=this.color_spaces.DEVICE_GRAY;break;case 4:i=this.color_spaces.DEVICE_CMYK;break;case 3:i=this.color_spaces.DEVICE_RGB}O={data:s,width:E.width,height:E.height,colorSpace:i,bitsPerComponent:8,filter:k,index:a,alias:d}}return O}}(Qr.API);var Jg,bx,oL,aL,lL,bZ=function(){var t,e,s;function a(g){var v,i,E,k,O,z,G,U,ie,Q,se,J,te,le;for(this.data=g,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},z=null;;){switch(v=this.readUInt32(),ie=(function(){var ye,Ne;for(Ne=[],ye=0;ye<4;++ye)Ne.push(String.fromCharCode(this.data[this.pos++]));return Ne}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(v);break;case"fcTL":z&&this.animation.frames.push(z),this.pos+=4,z={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},O=this.readUInt16(),k=this.readUInt16()||100,z.delay=1e3*O/k,z.disposeOp=this.data[this.pos++],z.blendOp=this.data[this.pos++],z.data=[];break;case"IDAT":case"fdAT":for(ie==="fdAT"&&(this.pos+=4,v-=4),g=(z!=null?z.data:void 0)||this.imgData,J=0;0<=v?J<v:J>v;0<=v?++J:--J)g.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(E=this.palette.length/3,this.transparency.indexed=this.read(v),this.transparency.indexed.length>E)throw new Error("More transparent colors than palette size");if((Q=E-this.transparency.indexed.length)>0)for(te=0;0<=Q?te<Q:te>Q;0<=Q?++te:--te)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(v)[0];break;case 2:this.transparency.rgb=this.read(v)}break;case"tEXt":G=(se=this.read(v)).indexOf(0),U=String.fromCharCode.apply(String,se.slice(0,G)),this.text[U]=String.fromCharCode.apply(String,se.slice(G+1));break;case"IEND":return z&&this.animation.frames.push(z),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(le=this.colorType)===4||le===6,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=v}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}a.prototype.read=function(g){var v,i;for(i=[],v=0;0<=g?v<g:v>g;0<=g?++v:--v)i.push(this.data[this.pos++]);return i},a.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},a.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},a.prototype.decodePixels=function(g){var v=this.pixelBitlength/8,i=new Uint8Array(this.width*this.height*v),E=0,k=this;if(g==null&&(g=this.imgData),g.length===0)return new Uint8Array(0);function O(z,G,U,ie){var Q,se,J,te,le,ye,Ne,rt,xe,Me,it,ot,ve,Le,dt,Je,yt,St,jt,et,Qe,Xe=Math.ceil((k.width-z)/U),Vt=Math.ceil((k.height-G)/ie),be=k.width==Xe&&k.height==Vt;for(Le=v*Xe,ot=be?i:new Uint8Array(Le*Vt),ye=g.length,ve=0,se=0;ve<Vt&&E<ye;){switch(g[E++]){case 0:for(te=yt=0;yt<Le;te=yt+=1)ot[se++]=g[E++];break;case 1:for(te=St=0;St<Le;te=St+=1)Q=g[E++],le=te<v?0:ot[se-v],ot[se++]=(Q+le)%256;break;case 2:for(te=jt=0;jt<Le;te=jt+=1)Q=g[E++],J=(te-te%v)/v,dt=ve&&ot[(ve-1)*Le+J*v+te%v],ot[se++]=(dt+Q)%256;break;case 3:for(te=et=0;et<Le;te=et+=1)Q=g[E++],J=(te-te%v)/v,le=te<v?0:ot[se-v],dt=ve&&ot[(ve-1)*Le+J*v+te%v],ot[se++]=(Q+Math.floor((le+dt)/2))%256;break;case 4:for(te=Qe=0;Qe<Le;te=Qe+=1)Q=g[E++],J=(te-te%v)/v,le=te<v?0:ot[se-v],ve===0?dt=Je=0:(dt=ot[(ve-1)*Le+J*v+te%v],Je=J&&ot[(ve-1)*Le+(J-1)*v+te%v]),Ne=le+dt-Je,rt=Math.abs(Ne-le),Me=Math.abs(Ne-dt),it=Math.abs(Ne-Je),xe=rt<=Me&&rt<=it?le:Me<=it?dt:Je,ot[se++]=(Q+xe)%256;break;default:throw new Error("Invalid filter algorithm: "+g[E-1])}if(!be){var Re=((G+ve*ie)*k.width+z)*v,Fe=ve*Le;for(te=0;te<Xe;te+=1){for(var ut=0;ut<v;ut+=1)i[Re++]=ot[Fe++];Re+=(U-1)*v}}ve++}}return g=QW(g),k.interlaceMethod==1?(O(0,0,8,8),O(4,0,8,8),O(0,4,4,8),O(2,0,4,4),O(0,2,2,4),O(1,0,2,2),O(0,1,1,2)):O(0,0,1,1),i},a.prototype.decodePalette=function(){var g,v,i,E,k,O,z,G,U;for(i=this.palette,O=this.transparency.indexed||[],k=new Uint8Array((O.length||0)+i.length),E=0,g=0,v=z=0,G=i.length;z<G;v=z+=3)k[E++]=i[v],k[E++]=i[v+1],k[E++]=i[v+2],k[E++]=(U=O[g++])!=null?U:255;return k},a.prototype.copyToImageData=function(g,v){var i,E,k,O,z,G,U,ie,Q,se,J;if(E=this.colors,Q=null,i=this.hasAlphaChannel,this.palette.length&&(Q=(J=this._decodedPalette)!=null?J:this._decodedPalette=this.decodePalette(),E=4,i=!0),ie=(k=g.data||g).length,z=Q||v,O=G=0,E===1)for(;O<ie;)U=Q?4*v[O/4]:G,se=z[U++],k[O++]=se,k[O++]=se,k[O++]=se,k[O++]=i?z[U++]:255,G=U;else for(;O<ie;)U=Q?4*v[O/4]:G,k[O++]=z[U++],k[O++]=z[U++],k[O++]=z[U++],k[O++]=i?z[U++]:255,G=U},a.prototype.decode=function(){var g;return g=new Uint8Array(this.width*this.height*4),this.copyToImageData(g,this.decodePixels()),g};var d=function(){if(Object.prototype.toString.call(ei)==="[object Window]"){try{e=ei.document.createElement("canvas"),s=e.getContext("2d")}catch{return!1}return!0}return!1};return d(),t=function(g){var v;if(d()===!0)return s.width=g.width,s.height=g.height,s.clearRect(0,0,g.width,g.height),s.putImageData(g,0,0),(v=new Image).src=e.toDataURL(),v;throw new Error("This method requires a Browser with Canvas-capability.")},a.prototype.decodeFrames=function(g){var v,i,E,k,O,z,G,U;if(this.animation){for(U=[],i=O=0,z=(G=this.animation.frames).length;O<z;i=++O)v=G[i],E=g.createImageData(v.width,v.height),k=this.decodePixels(new Uint8Array(v.data)),this.copyToImageData(E,k),v.imageData=E,U.push(v.image=t(E));return U}},a.prototype.renderFrame=function(g,v){var i,E,k;return i=(E=this.animation.frames)[v],k=E[v-1],v===0&&g.clearRect(0,0,this.width,this.height),(k!=null?k.disposeOp:void 0)===1?g.clearRect(k.xOffset,k.yOffset,k.width,k.height):(k!=null?k.disposeOp:void 0)===2&&g.putImageData(k.imageData,k.xOffset,k.yOffset),i.blendOp===0&&g.clearRect(i.xOffset,i.yOffset,i.width,i.height),g.drawImage(i.image,i.xOffset,i.yOffset)},a.prototype.animate=function(g){var v,i,E,k,O,z,G=this;return i=0,z=this.animation,k=z.numFrames,E=z.frames,O=z.numPlays,(v=function(){var U,ie;if(U=i++%k,ie=E[U],G.renderFrame(g,U),k>1&&i/k<O)return G.animation._timeout=setTimeout(v,ie.delay)})()},a.prototype.stopAnimation=function(){var g;return clearTimeout((g=this.animation)!=null?g._timeout:void 0)},a.prototype.render=function(g){var v,i;return g._png&&g._png.stopAnimation(),g._png=this,g.width=this.width,g.height=this.height,v=g.getContext("2d"),this.animation?(this.decodeFrames(v),this.animate(v)):(i=v.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),v.putImageData(i,0,0))},a}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function wZ(t){var e=0;if(t[e++]!==71||t[e++]!==73||t[e++]!==70||t[e++]!==56||(t[e++]+1&253)!=56||t[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var s=t[e++]|t[e++]<<8,a=t[e++]|t[e++]<<8,d=t[e++],g=d>>7,v=1<<(7&d)+1;t[e++],t[e++];var i=null,E=null;g&&(i=e,E=v,e+=3*v);var k=!0,O=[],z=0,G=null,U=0,ie=null;for(this.width=s,this.height=a;k&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(t[e]!==11||t[e+1]==78&&t[e+2]==69&&t[e+3]==84&&t[e+4]==83&&t[e+5]==67&&t[e+6]==65&&t[e+7]==80&&t[e+8]==69&&t[e+9]==50&&t[e+10]==46&&t[e+11]==48&&t[e+12]==3&&t[e+13]==1&&t[e+16]==0)e+=14,ie=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((ve=t[e++])>=0))throw Error("Invalid block size");if(ve===0)break;e+=ve}break;case 249:if(t[e++]!==4||t[e+4]!==0)throw new Error("Invalid graphics extension block.");var Q=t[e++];z=t[e++]|t[e++]<<8,G=t[e++],!(1&Q)&&(G=null),U=Q>>2&7,e++;break;case 254:for(;;){if(!((ve=t[e++])>=0))throw Error("Invalid block size");if(ve===0)break;e+=ve}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var se=t[e++]|t[e++]<<8,J=t[e++]|t[e++]<<8,te=t[e++]|t[e++]<<8,le=t[e++]|t[e++]<<8,ye=t[e++],Ne=ye>>6&1,rt=1<<(7&ye)+1,xe=i,Me=E,it=!1;ye>>7&&(it=!0,xe=e,Me=rt,e+=3*rt);var ot=e;for(e++;;){var ve;if(!((ve=t[e++])>=0))throw Error("Invalid block size");if(ve===0)break;e+=ve}O.push({x:se,y:J,width:te,height:le,has_local_palette:it,palette_offset:xe,palette_size:Me,data_offset:ot,data_length:e-ot,transparent_index:G,interlaced:!!Ne,delay:z,disposal:U});break;case 59:k=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return O.length},this.loopCount=function(){return ie},this.frameInfo=function(Le){if(Le<0||Le>=O.length)throw new Error("Frame index out of range.");return O[Le]},this.decodeAndBlitFrameBGRA=function(Le,dt){var Je=this.frameInfo(Le),yt=Je.width*Je.height,St=new Uint8Array(yt);cL(t,Je.data_offset,St,yt);var jt=Je.palette_offset,et=Je.transparent_index;et===null&&(et=256);var Qe=Je.width,Xe=s-Qe,Vt=Qe,be=4*(Je.y*s+Je.x),Re=4*((Je.y+Je.height)*s+Je.x),Fe=be,ut=4*Xe;Je.interlaced===!0&&(ut+=4*s*7);for(var Et=8,Ct=0,Wt=St.length;Ct<Wt;++Ct){var Ft=St[Ct];if(Vt===0&&(Vt=Qe,(Fe+=ut)>=Re&&(ut=4*Xe+4*s*(Et-1),Fe=be+(Qe+Xe)*(Et<<1),Et>>=1)),Ft===et)Fe+=4;else{var me=t[jt+3*Ft],dn=t[jt+3*Ft+1],Cn=t[jt+3*Ft+2];dt[Fe++]=Cn,dt[Fe++]=dn,dt[Fe++]=me,dt[Fe++]=255}--Vt}},this.decodeAndBlitFrameRGBA=function(Le,dt){var Je=this.frameInfo(Le),yt=Je.width*Je.height,St=new Uint8Array(yt);cL(t,Je.data_offset,St,yt);var jt=Je.palette_offset,et=Je.transparent_index;et===null&&(et=256);var Qe=Je.width,Xe=s-Qe,Vt=Qe,be=4*(Je.y*s+Je.x),Re=4*((Je.y+Je.height)*s+Je.x),Fe=be,ut=4*Xe;Je.interlaced===!0&&(ut+=4*s*7);for(var Et=8,Ct=0,Wt=St.length;Ct<Wt;++Ct){var Ft=St[Ct];if(Vt===0&&(Vt=Qe,(Fe+=ut)>=Re&&(ut=4*Xe+4*s*(Et-1),Fe=be+(Qe+Xe)*(Et<<1),Et>>=1)),Ft===et)Fe+=4;else{var me=t[jt+3*Ft],dn=t[jt+3*Ft+1],Cn=t[jt+3*Ft+2];dt[Fe++]=me,dt[Fe++]=dn,dt[Fe++]=Cn,dt[Fe++]=255}--Vt}}}function cL(t,e,s,a){for(var d=t[e++],g=1<<d,v=g+1,i=v+1,E=d+1,k=(1<<E)-1,O=0,z=0,G=0,U=t[e++],ie=new Int32Array(4096),Q=null;;){for(;O<16&&U!==0;)z|=t[e++]<<O,O+=8,U===1?U=t[e++]:--U;if(O<E)break;var se=z&k;if(z>>=E,O-=E,se!==g){if(se===v)break;for(var J=se<i?se:Q,te=0,le=J;le>g;)le=ie[le]>>8,++te;var ye=le;if(G+te+(J!==se?1:0)>a)return void Ts.log("Warning, gif stream longer than expected.");s[G++]=ye;var Ne=G+=te;for(J!==se&&(s[G++]=ye),le=J;te--;)le=ie[le],s[--Ne]=255&le,le>>=8;Q!==null&&i<4096&&(ie[i++]=Q<<8|ye,i>=k+1&&E<12&&(++E,k=k<<1|1)),Q=se}else i=v+1,k=(1<<(E=d+1))-1,Q=null}return G!==a&&Ts.log("Warning, gif stream shorter than expected."),s}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Q5(t){var e,s,a,d,g,v=Math.floor,i=new Array(64),E=new Array(64),k=new Array(64),O=new Array(64),z=new Array(65535),G=new Array(65535),U=new Array(64),ie=new Array(64),Q=[],se=0,J=7,te=new Array(64),le=new Array(64),ye=new Array(64),Ne=new Array(256),rt=new Array(2048),xe=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Me=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],it=[0,1,2,3,4,5,6,7,8,9,10,11],ot=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ve=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Le=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],dt=[0,1,2,3,4,5,6,7,8,9,10,11],Je=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],yt=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function St(be,Re){for(var Fe=0,ut=0,Et=new Array,Ct=1;Ct<=16;Ct++){for(var Wt=1;Wt<=be[Ct];Wt++)Et[Re[ut]]=[],Et[Re[ut]][0]=Fe,Et[Re[ut]][1]=Ct,ut++,Fe++;Fe*=2}return Et}function jt(be){for(var Re=be[0],Fe=be[1]-1;Fe>=0;)Re&1<<Fe&&(se|=1<<J),Fe--,--J<0&&(se==255?(et(255),et(0)):et(se),J=7,se=0)}function et(be){Q.push(be)}function Qe(be){et(be>>8&255),et(255&be)}function Xe(be,Re,Fe,ut,Et){for(var Ct,Wt=Et[0],Ft=Et[240],me=function(bn,Fn){var Gn,Un,pr,Ln,br,Kr,hi,si,wr,Ur,Kn=0;for(wr=0;wr<8;++wr){Gn=bn[Kn],Un=bn[Kn+1],pr=bn[Kn+2],Ln=bn[Kn+3],br=bn[Kn+4],Kr=bn[Kn+5],hi=bn[Kn+6];var Hs=Gn+(si=bn[Kn+7]),fi=Gn-si,xo=Un+hi,di=Un-hi,Hi=pr+Kr,pi=pr-Kr,lr=Ln+br,ml=Ln-br,Yi=Hs+lr,as=Hs-lr,Ho=xo+Hi,ns=xo-Hi;bn[Kn]=Yi+Ho,bn[Kn+4]=Yi-Ho;var Rr=.707106781*(ns+as);bn[Kn+2]=as+Rr,bn[Kn+6]=as-Rr;var Ii=.382683433*((Yi=ml+pi)-(ns=di+fi)),$l=.5411961*Yi+Ii,Rs=1.306562965*ns+Ii,Dt=.707106781*(Ho=pi+di),he=fi+Dt,_e=fi-Dt;bn[Kn+5]=_e+$l,bn[Kn+3]=_e-$l,bn[Kn+1]=he+Rs,bn[Kn+7]=he-Rs,Kn+=8}for(Kn=0,wr=0;wr<8;++wr){Gn=bn[Kn],Un=bn[Kn+8],pr=bn[Kn+16],Ln=bn[Kn+24],br=bn[Kn+32],Kr=bn[Kn+40],hi=bn[Kn+48];var Oe=Gn+(si=bn[Kn+56]),Ye=Gn-si,qe=Un+hi,at=Un-hi,wt=pr+Kr,ct=pr-Kr,Mt=Ln+br,Nt=Ln-br,Lt=Oe+Mt,sn=Oe-Mt,pn=qe+wt,yn=qe-wt;bn[Kn]=Lt+pn,bn[Kn+32]=Lt-pn;var $n=.707106781*(yn+sn);bn[Kn+16]=sn+$n,bn[Kn+48]=sn-$n;var er=.382683433*((Lt=Nt+ct)-(yn=at+Ye)),or=.5411961*Lt+er,ur=1.306562965*yn+er,li=.707106781*(pn=ct+at),Si=Ye+li,mr=Ye-li;bn[Kn+40]=mr+or,bn[Kn+24]=mr-or,bn[Kn+8]=Si+ur,bn[Kn+56]=Si-ur,Kn++}for(wr=0;wr<64;++wr)Ur=bn[wr]*Fn[wr],U[wr]=Ur>0?Ur+.5|0:Ur-.5|0;return U}(be,Re),dn=0;dn<64;++dn)ie[xe[dn]]=me[dn];var Cn=ie[0]-Fe;Fe=ie[0],Cn==0?jt(ut[0]):(jt(ut[G[Ct=32767+Cn]]),jt(z[Ct]));for(var On=63;On>0&&ie[On]==0;)On--;if(On==0)return jt(Wt),Fe;for(var $t,cn=1;cn<=On;){for(var _t=cn;ie[cn]==0&&cn<=On;)++cn;var yr=cn-_t;if(yr>=16){$t=yr>>4;for(var En=1;En<=$t;++En)jt(Ft);yr&=15}Ct=32767+ie[cn],jt(Et[(yr<<4)+G[Ct]]),jt(z[Ct]),cn++}return On!=63&&jt(Wt),Fe}function Vt(be){be=Math.min(Math.max(be,1),100),g!=be&&(function(Re){for(var Fe=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ut=0;ut<64;ut++){var Et=v((Fe[ut]*Re+50)/100);Et=Math.min(Math.max(Et,1),255),i[xe[ut]]=Et}for(var Ct=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Wt=0;Wt<64;Wt++){var Ft=v((Ct[Wt]*Re+50)/100);Ft=Math.min(Math.max(Ft,1),255),E[xe[Wt]]=Ft}for(var me=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],dn=0,Cn=0;Cn<8;Cn++)for(var On=0;On<8;On++)k[dn]=1/(i[xe[dn]]*me[Cn]*me[On]*8),O[dn]=1/(E[xe[dn]]*me[Cn]*me[On]*8),dn++}(be<50?Math.floor(5e3/be):Math.floor(200-2*be)),g=be)}this.encode=function(be,Re){Re&&Vt(Re),Q=new Array,se=0,J=7,Qe(65496),Qe(65504),Qe(16),et(74),et(70),et(73),et(70),et(0),et(1),et(1),et(0),Qe(1),Qe(1),et(0),et(0),function(){Qe(65499),Qe(132),et(0);for(var Un=0;Un<64;Un++)et(i[Un]);et(1);for(var pr=0;pr<64;pr++)et(E[pr])}(),function(Un,pr){Qe(65472),Qe(17),et(8),Qe(pr),Qe(Un),et(3),et(1),et(17),et(0),et(2),et(17),et(1),et(3),et(17),et(1)}(be.width,be.height),function(){Qe(65476),Qe(418),et(0);for(var Un=0;Un<16;Un++)et(Me[Un+1]);for(var pr=0;pr<=11;pr++)et(it[pr]);et(16);for(var Ln=0;Ln<16;Ln++)et(ot[Ln+1]);for(var br=0;br<=161;br++)et(ve[br]);et(1);for(var Kr=0;Kr<16;Kr++)et(Le[Kr+1]);for(var hi=0;hi<=11;hi++)et(dt[hi]);et(17);for(var si=0;si<16;si++)et(Je[si+1]);for(var wr=0;wr<=161;wr++)et(yt[wr])}(),Qe(65498),Qe(12),et(3),et(1),et(0),et(2),et(17),et(3),et(17),et(0),et(63),et(0);var Fe=0,ut=0,Et=0;se=0,J=7,this.encode.displayName="_encode_";for(var Ct,Wt,Ft,me,dn,Cn,On,$t,cn,_t=be.data,yr=be.width,En=be.height,bn=4*yr,Fn=0;Fn<En;){for(Ct=0;Ct<bn;){for(dn=bn*Fn+Ct,On=-1,$t=0,cn=0;cn<64;cn++)Cn=dn+($t=cn>>3)*bn+(On=4*(7&cn)),Fn+$t>=En&&(Cn-=bn*(Fn+1+$t-En)),Ct+On>=bn&&(Cn-=Ct+On-bn+4),Wt=_t[Cn++],Ft=_t[Cn++],me=_t[Cn++],te[cn]=(rt[Wt]+rt[Ft+256>>0]+rt[me+512>>0]>>16)-128,le[cn]=(rt[Wt+768>>0]+rt[Ft+1024>>0]+rt[me+1280>>0]>>16)-128,ye[cn]=(rt[Wt+1280>>0]+rt[Ft+1536>>0]+rt[me+1792>>0]>>16)-128;Fe=Xe(te,k,Fe,e,a),ut=Xe(le,O,ut,s,d),Et=Xe(ye,O,Et,s,d),Ct+=32}Fn+=8}if(J>=0){var Gn=[];Gn[1]=J+1,Gn[0]=(1<<J+1)-1,jt(Gn)}return Qe(65497),new Uint8Array(Q)},t=t||50,function(){for(var be=String.fromCharCode,Re=0;Re<256;Re++)Ne[Re]=be(Re)}(),e=St(Me,it),s=St(Le,dt),a=St(ot,ve),d=St(Je,yt),function(){for(var be=1,Re=2,Fe=1;Fe<=15;Fe++){for(var ut=be;ut<Re;ut++)G[32767+ut]=Fe,z[32767+ut]=[],z[32767+ut][1]=Fe,z[32767+ut][0]=ut;for(var Et=-(Re-1);Et<=-be;Et++)G[32767+Et]=Fe,z[32767+Et]=[],z[32767+Et][1]=Fe,z[32767+Et][0]=Re-1+Et;be<<=1,Re<<=1}}(),function(){for(var be=0;be<256;be++)rt[be]=19595*be,rt[be+256>>0]=38470*be,rt[be+512>>0]=7471*be+32768,rt[be+768>>0]=-11059*be,rt[be+1024>>0]=-21709*be,rt[be+1280>>0]=32768*be+8421375,rt[be+1536>>0]=-27439*be,rt[be+1792>>0]=-5329*be}(),Vt(t)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function th(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function uL(t){function e(Me){if(!Me)throw Error("assert :P")}function s(Me,it,ot){for(var ve=0;4>ve;ve++)if(Me[it+ve]!=ot.charCodeAt(ve))return!0;return!1}function a(Me,it,ot,ve,Le){for(var dt=0;dt<Le;dt++)Me[it+dt]=ot[ve+dt]}function d(Me,it,ot,ve){for(var Le=0;Le<ve;Le++)Me[it+Le]=ot}function g(Me){return new Int32Array(Me)}function v(Me,it){for(var ot=[],ve=0;ve<Me;ve++)ot.push(new it);return ot}function i(Me,it){var ot=[];return function ve(Le,dt,Je){for(var yt=Je[dt],St=0;St<yt&&(Le.push(Je.length>dt+1?[]:new it),!(Je.length<dt+1));St++)ve(Le[St],dt+1,Je)}(ot,0,Me),ot}var E=function(){var Me=this;function it(D,q){for(var ne=1<<q-1>>>0;D&ne;)ne>>>=1;return ne?(D&ne-1)+ne:D}function ot(D,q,ne,de,Ae){e(!(de%ne));do D[q+(de-=ne)]=Ae;while(0<de)}function ve(D,q,ne,de,Ae){if(e(2328>=Ae),512>=Ae)var ke=g(512);else if((ke=g(Ae))==null)return 0;return function(ze,Ve,$e,lt,Ze,tn){var nn,qt,mn=Ve,Pt=1<<$e,Ot=g(16),Ut=g(16);for(e(Ze!=0),e(lt!=null),e(ze!=null),e(0<$e),qt=0;qt<Ze;++qt){if(15<lt[qt])return 0;++Ot[lt[qt]]}if(Ot[0]==Ze)return 0;for(Ut[1]=0,nn=1;15>nn;++nn){if(Ot[nn]>1<<nn)return 0;Ut[nn+1]=Ut[nn]+Ot[nn]}for(qt=0;qt<Ze;++qt)nn=lt[qt],0<lt[qt]&&(tn[Ut[nn]++]=qt);if(Ut[15]==1)return(lt=new Le).g=0,lt.value=tn[0],ot(ze,mn,1,Pt,lt),Pt;var wn,Pn=-1,Tn=Pt-1,rr=0,qn=1,Ar=1,Zn=1<<$e;for(qt=0,nn=1,Ze=2;nn<=$e;++nn,Ze<<=1){if(qn+=Ar<<=1,0>(Ar-=Ot[nn]))return 0;for(;0<Ot[nn];--Ot[nn])(lt=new Le).g=nn,lt.value=tn[qt++],ot(ze,mn+rr,Ze,Zn,lt),rr=it(rr,nn)}for(nn=$e+1,Ze=2;15>=nn;++nn,Ze<<=1){if(qn+=Ar<<=1,0>(Ar-=Ot[nn]))return 0;for(;0<Ot[nn];--Ot[nn]){if(lt=new Le,(rr&Tn)!=Pn){for(mn+=Zn,wn=1<<(Pn=nn)-$e;15>Pn&&!(0>=(wn-=Ot[Pn]));)++Pn,wn<<=1;Pt+=Zn=1<<(wn=Pn-$e),ze[Ve+(Pn=rr&Tn)].g=wn+$e,ze[Ve+Pn].value=mn-Ve-Pn}lt.g=nn-$e,lt.value=tn[qt++],ot(ze,mn+(rr>>$e),Ze,Zn,lt),rr=it(rr,nn)}}return qn!=2*Ut[15]-1?0:Pt}(D,q,ne,de,Ae,ke)}function Le(){this.value=this.g=0}function dt(){this.value=this.g=0}function Je(){this.G=v(5,Le),this.H=g(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=v(Cs,dt)}function yt(D,q,ne,de){e(D!=null),e(q!=null),e(2147483648>de),D.Ca=254,D.I=0,D.b=-8,D.Ka=0,D.oa=q,D.pa=ne,D.Jd=q,D.Yc=ne+de,D.Zc=4<=de?ne+de-4+1:ne,Ct(D)}function St(D,q){for(var ne=0;0<q--;)ne|=Ft(D,128)<<q;return ne}function jt(D,q){var ne=St(D,q);return Wt(D)?-ne:ne}function et(D,q,ne,de){var Ae,ke=0;for(e(D!=null),e(q!=null),e(4294967288>de),D.Sb=de,D.Ra=0,D.u=0,D.h=0,4<de&&(de=4),Ae=0;Ae<de;++Ae)ke+=q[ne+Ae]<<8*Ae;D.Ra=ke,D.bb=de,D.oa=q,D.pa=ne}function Qe(D){for(;8<=D.u&&D.bb<D.Sb;)D.Ra>>>=8,D.Ra+=D.oa[D.pa+D.bb]<<un-8>>>0,++D.bb,D.u-=8;Fe(D)&&(D.h=1,D.u=0)}function Xe(D,q){if(e(0<=q),!D.h&&q<=Xl){var ne=Re(D)&Di[q];return D.u+=q,Qe(D),ne}return D.h=1,D.u=0}function Vt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function be(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Re(D){return D.Ra>>>(D.u&un-1)>>>0}function Fe(D){return e(D.bb<=D.Sb),D.h||D.bb==D.Sb&&D.u>un}function ut(D,q){D.u=q,D.h=Fe(D)}function Et(D){D.u>=nu&&(e(D.u>=nu),Qe(D))}function Ct(D){e(D!=null&&D.oa!=null),D.pa<D.Zc?(D.I=(D.oa[D.pa++]|D.I<<8)>>>0,D.b+=8):(e(D!=null&&D.oa!=null),D.pa<D.Yc?(D.b+=8,D.I=D.oa[D.pa++]|D.I<<8):D.Ka?D.b=0:(D.I<<=8,D.b+=8,D.Ka=1))}function Wt(D){return St(D,1)}function Ft(D,q){var ne=D.Ca;0>D.b&&Ct(D);var de=D.b,Ae=ne*q>>>8,ke=(D.I>>>de>Ae)+0;for(ke?(ne-=Ae,D.I-=Ae+1<<de>>>0):ne=Ae+1,de=ne,Ae=0;256<=de;)Ae+=8,de>>=8;return de=7^Ae+Ps[de],D.b-=de,D.Ca=(ne<<de)-1,ke}function me(D,q,ne){D[q+0]=ne>>24&255,D[q+1]=ne>>16&255,D[q+2]=ne>>8&255,D[q+3]=ne>>0&255}function dn(D,q){return D[q+0]<<0|D[q+1]<<8}function Cn(D,q){return dn(D,q)|D[q+2]<<16}function On(D,q){return dn(D,q)|dn(D,q+2)<<16}function $t(D,q){var ne=1<<q;return e(D!=null),e(0<q),D.X=g(ne),D.X==null?0:(D.Mb=32-q,D.Xa=q,1)}function cn(D,q){e(D!=null),e(q!=null),e(D.Xa==q.Xa),a(q.X,0,D.X,0,1<<q.Xa)}function _t(){this.X=[],this.Xa=this.Mb=0}function yr(D,q,ne,de){e(ne!=null),e(de!=null);var Ae=ne[0],ke=de[0];return Ae==0&&(Ae=(D*ke+q/2)/q),ke==0&&(ke=(q*Ae+D/2)/D),0>=Ae||0>=ke?0:(ne[0]=Ae,de[0]=ke,1)}function En(D,q){return D+(1<<q)-1>>>q}function bn(D,q){return((4278255360&D)+(4278255360&q)>>>0&4278255360)+((16711935&D)+(16711935&q)>>>0&16711935)>>>0}function Fn(D,q){Me[q]=function(ne,de,Ae,ke,ze,Ve,$e){var lt;for(lt=0;lt<ze;++lt){var Ze=Me[D](Ve[$e+lt-1],Ae,ke+lt);Ve[$e+lt]=bn(ne[de+lt],Ze)}}}function Gn(){this.ud=this.hd=this.jd=0}function Un(D,q){return((4278124286&(D^q))>>>1)+(D&q)>>>0}function pr(D){return 0<=D&&256>D?D:0>D?0:255<D?255:void 0}function Ln(D,q){return pr(D+(D-q+.5>>1))}function br(D,q,ne){return Math.abs(q-ne)-Math.abs(D-ne)}function Kr(D,q,ne,de,Ae,ke,ze){for(de=ke[ze-1],ne=0;ne<Ae;++ne)ke[ze+ne]=de=bn(D[q+ne],de)}function hi(D,q,ne,de,Ae){var ke;for(ke=0;ke<ne;++ke){var ze=D[q+ke],Ve=ze>>8&255,$e=16711935&($e=($e=16711935&ze)+((Ve<<16)+Ve));de[Ae+ke]=(4278255360&ze)+$e>>>0}}function si(D,q){q.jd=D>>0&255,q.hd=D>>8&255,q.ud=D>>16&255}function wr(D,q,ne,de,Ae,ke){var ze;for(ze=0;ze<de;++ze){var Ve=q[ne+ze],$e=Ve>>>8,lt=Ve,Ze=255&(Ze=(Ze=Ve>>>16)+((D.jd<<24>>24)*($e<<24>>24)>>>5));lt=255&(lt=(lt=lt+((D.hd<<24>>24)*($e<<24>>24)>>>5))+((D.ud<<24>>24)*(Ze<<24>>24)>>>5)),Ae[ke+ze]=(4278255360&Ve)+(Ze<<16)+lt}}function Ur(D,q,ne,de,Ae){Me[q]=function(ke,ze,Ve,$e,lt,Ze,tn,nn,qt){for($e=tn;$e<nn;++$e)for(tn=0;tn<qt;++tn)lt[Ze++]=Ae(Ve[de(ke[ze++])])},Me[D]=function(ke,ze,Ve,$e,lt,Ze,tn){var nn=8>>ke.b,qt=ke.Ea,mn=ke.K[0],Pt=ke.w;if(8>nn)for(ke=(1<<ke.b)-1,Pt=(1<<nn)-1;ze<Ve;++ze){var Ot,Ut=0;for(Ot=0;Ot<qt;++Ot)Ot&ke||(Ut=de($e[lt++])),Ze[tn++]=Ae(mn[Ut&Pt]),Ut>>=nn}else Me["VP8LMapColor"+ne]($e,lt,mn,Pt,Ze,tn,ze,Ve,qt)}}function Kn(D,q,ne,de,Ae){for(ne=q+ne;q<ne;){var ke=D[q++];de[Ae++]=ke>>16&255,de[Ae++]=ke>>8&255,de[Ae++]=ke>>0&255}}function Hs(D,q,ne,de,Ae){for(ne=q+ne;q<ne;){var ke=D[q++];de[Ae++]=ke>>16&255,de[Ae++]=ke>>8&255,de[Ae++]=ke>>0&255,de[Ae++]=ke>>24&255}}function fi(D,q,ne,de,Ae){for(ne=q+ne;q<ne;){var ke=(ze=D[q++])>>16&240|ze>>12&15,ze=ze>>0&240|ze>>28&15;de[Ae++]=ke,de[Ae++]=ze}}function xo(D,q,ne,de,Ae){for(ne=q+ne;q<ne;){var ke=(ze=D[q++])>>16&248|ze>>13&7,ze=ze>>5&224|ze>>3&31;de[Ae++]=ke,de[Ae++]=ze}}function di(D,q,ne,de,Ae){for(ne=q+ne;q<ne;){var ke=D[q++];de[Ae++]=ke>>0&255,de[Ae++]=ke>>8&255,de[Ae++]=ke>>16&255}}function Hi(D,q,ne,de,Ae,ke){if(ke==0)for(ne=q+ne;q<ne;)me(de,((ke=D[q++])[0]>>24|ke[1]>>8&65280|ke[2]<<8&16711680|ke[3]<<24)>>>0),Ae+=32;else a(de,Ae,D,q,ne)}function pi(D,q){Me[q][0]=Me[D+"0"],Me[q][1]=Me[D+"1"],Me[q][2]=Me[D+"2"],Me[q][3]=Me[D+"3"],Me[q][4]=Me[D+"4"],Me[q][5]=Me[D+"5"],Me[q][6]=Me[D+"6"],Me[q][7]=Me[D+"7"],Me[q][8]=Me[D+"8"],Me[q][9]=Me[D+"9"],Me[q][10]=Me[D+"10"],Me[q][11]=Me[D+"11"],Me[q][12]=Me[D+"12"],Me[q][13]=Me[D+"13"],Me[q][14]=Me[D+"0"],Me[q][15]=Me[D+"0"]}function lr(D){return D==vd||D==vf||D==xd||D==Wp}function ml(){this.eb=[],this.size=this.A=this.fb=0}function Yi(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function as(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ml,this.f.kb=new Yi,this.sd=null}function Ho(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ns(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Rr(D){return alert("todo:WebPSamplerProcessPlane"),D.T}function Ii(D,q){var ne=D.T,de=q.ba.f.RGBA,Ae=de.eb,ke=de.fb+D.ka*de.A,ze=ga[q.ba.S],Ve=D.y,$e=D.O,lt=D.f,Ze=D.N,tn=D.ea,nn=D.W,qt=q.cc,mn=q.dc,Pt=q.Mc,Ot=q.Nc,Ut=D.ka,wn=D.ka+D.T,Pn=D.U,Tn=Pn+1>>1;for(Ut==0?ze(Ve,$e,null,null,lt,Ze,tn,nn,lt,Ze,tn,nn,Ae,ke,null,null,Pn):(ze(q.ec,q.fc,Ve,$e,qt,mn,Pt,Ot,lt,Ze,tn,nn,Ae,ke-de.A,Ae,ke,Pn),++ne);Ut+2<wn;Ut+=2)qt=lt,mn=Ze,Pt=tn,Ot=nn,Ze+=D.Rc,nn+=D.Rc,ke+=2*de.A,ze(Ve,($e+=2*D.fa)-D.fa,Ve,$e,qt,mn,Pt,Ot,lt,Ze,tn,nn,Ae,ke-de.A,Ae,ke,Pn);return $e+=D.fa,D.j+wn<D.o?(a(q.ec,q.fc,Ve,$e,Pn),a(q.cc,q.dc,lt,Ze,Tn),a(q.Mc,q.Nc,tn,nn,Tn),ne--):1&wn||ze(Ve,$e,null,null,lt,Ze,tn,nn,lt,Ze,tn,nn,Ae,ke+de.A,null,null,Pn),ne}function $l(D,q,ne){var de=D.F,Ae=[D.J];if(de!=null){var ke=D.U,ze=q.ba.S,Ve=ze==Th||ze==xd;q=q.ba.f.RGBA;var $e=[0],lt=D.ka;$e[0]=D.T,D.Kb&&(lt==0?--$e[0]:(--lt,Ae[0]-=D.width),D.j+D.ka+D.T==D.o&&($e[0]=D.o-D.j-lt));var Ze=q.eb;lt=q.fb+lt*q.A,D=Pi(de,Ae[0],D.width,ke,$e,Ze,lt+(Ve?0:3),q.A),e(ne==$e),D&&lr(ze)&&jo(Ze,lt,Ve,ke,$e,q.A)}return 0}function Rs(D){var q=D.ma,ne=q.ba.S,de=11>ne,Ae=ne==gf||ne==_f||ne==Th||ne==yd||ne==12||lr(ne);if(q.memory=null,q.Ib=null,q.Jb=null,q.Nd=null,!vl(q.Oa,D,Ae?11:12))return 0;if(Ae&&lr(ne)&&Mn(),D.da)alert("todo:use_scaling");else{if(de){if(q.Ib=Rr,D.Kb){if(ne=D.U+1>>1,q.memory=g(D.U+2*ne),q.memory==null)return 0;q.ec=q.memory,q.fc=0,q.cc=q.ec,q.dc=q.fc+D.U,q.Mc=q.cc,q.Nc=q.dc+ne,q.Ib=Ii,Mn()}}else alert("todo:EmitYUV");Ae&&(q.Jb=$l,de&&Yt())}if(de&&!Sf){for(D=0;256>D;++D)Tf[D]=89858*(D-128)+Wa>>Ch,Pd[D]=-22014*(D-128)+Wa,xg[D]=-45773*(D-128),vg[D]=113618*(D-128)+Wa>>Ch;for(D=Ou;D<au;++D)q=76283*(D-16)+Wa>>Ch,y0[D-Ou]=Bo(q,255),bg[D-Ou]=Bo(q+8>>4,15);Sf=1}return 1}function Dt(D){var q=D.ma,ne=D.U,de=D.T;return e(!(1&D.ka)),0>=ne||0>=de?0:(ne=q.Ib(D,q),q.Jb!=null&&q.Jb(D,q,ne),q.Dc+=ne,1)}function he(D){D.ma.memory=null}function _e(D,q,ne,de){return Xe(D,8)!=47?0:(q[0]=Xe(D,14)+1,ne[0]=Xe(D,14)+1,de[0]=Xe(D,1),Xe(D,3)!=0?0:!D.h)}function Oe(D,q){if(4>D)return D+1;var ne=D-2>>1;return(2+(1&D)<<ne)+Xe(q,ne)+1}function Ye(D,q){return 120<q?q-120:1<=(ne=((ne=xf[q-1])>>4)*D+(8-(15&ne)))?ne:1;var ne}function qe(D,q,ne){var de=Re(ne),Ae=D[q+=255&de].g-8;return 0<Ae&&(ut(ne,ne.u+8),de=Re(ne),q+=D[q].value,q+=de&(1<<Ae)-1),ut(ne,ne.u+D[q].g),D[q].value}function at(D,q,ne){return ne.g+=D.g,ne.value+=D.value<<q>>>0,e(8>=ne.g),D.g}function wt(D,q,ne){var de=D.xc;return e((q=de==0?0:D.vc[D.md*(ne>>de)+(q>>de)])<D.Wb),D.Ya[q]}function ct(D,q,ne,de){var Ae=D.ab,ke=D.c*q,ze=D.C;q=ze+q;var Ve=ne,$e=de;for(de=D.Ta,ne=D.Ua;0<Ae--;){var lt=D.gc[Ae],Ze=ze,tn=q,nn=Ve,qt=$e,mn=($e=de,Ve=ne,lt.Ea);switch(e(Ze<tn),e(tn<=lt.nc),lt.hc){case 2:Ru(nn,qt,(tn-Ze)*mn,$e,Ve);break;case 0:var Pt=Ze,Ot=tn,Ut=$e,wn=Ve,Pn=(Zn=lt).Ea;Pt==0&&(Zs(nn,qt,null,null,1,Ut,wn),Kr(nn,qt+1,0,0,Pn-1,Ut,wn+1),qt+=Pn,wn+=Pn,++Pt);for(var Tn=1<<Zn.b,rr=Tn-1,qn=En(Pn,Zn.b),Ar=Zn.K,Zn=Zn.w+(Pt>>Zn.b)*qn;Pt<Ot;){var ki=Ar,mi=Zn,Ti=1;for(wh(nn,qt,Ut,wn-Pn,1,Ut,wn);Ti<Pn;){var gi=(Ti&~rr)+Tn;gi>Pn&&(gi=Pn),(0,Ca[ki[mi++]>>8&15])(nn,qt+ +Ti,Ut,wn+Ti-Pn,gi-Ti,Ut,wn+Ti),Ti=gi}qt+=Pn,wn+=Pn,++Pt&rr||(Zn+=qn)}tn!=lt.nc&&a($e,Ve-mn,$e,Ve+(tn-Ze-1)*mn,mn);break;case 1:for(mn=nn,Ot=qt,Pn=(nn=lt.Ea)-(wn=nn&~(Ut=(qt=1<<lt.b)-1)),Pt=En(nn,lt.b),Tn=lt.K,lt=lt.w+(Ze>>lt.b)*Pt;Ze<tn;){for(rr=Tn,qn=lt,Ar=new Gn,Zn=Ot+wn,ki=Ot+nn;Ot<Zn;)si(rr[qn++],Ar),Du(Ar,mn,Ot,qt,$e,Ve),Ot+=qt,Ve+=qt;Ot<ki&&(si(rr[qn++],Ar),Du(Ar,mn,Ot,Pn,$e,Ve),Ot+=Pn,Ve+=Pn),++Ze&Ut||(lt+=Pt)}break;case 3:if(nn==$e&&qt==Ve&&0<lt.b){for(Ot=$e,nn=mn=Ve+(tn-Ze)*mn-(wn=(tn-Ze)*En(lt.Ea,lt.b)),qt=$e,Ut=Ve,Pt=[],wn=(Pn=wn)-1;0<=wn;--wn)Pt[wn]=qt[Ut+wn];for(wn=Pn-1;0<=wn;--wn)Ot[nn+wn]=Pt[wn];Ks(lt,Ze,tn,$e,mn,$e,Ve)}else Ks(lt,Ze,tn,nn,qt,$e,Ve)}Ve=de,$e=ne}$e!=ne&&a(de,ne,Ve,$e,ke)}function Mt(D,q){var ne=D.V,de=D.Ba+D.c*D.C,Ae=q-D.C;if(e(q<=D.l.o),e(16>=Ae),0<Ae){var ke=D.l,ze=D.Ta,Ve=D.Ua,$e=ke.width;if(ct(D,Ae,ne,de),Ae=Ve=[Ve],e((ne=D.C)<(de=q)),e(ke.v<ke.va),de>ke.o&&(de=ke.o),ne<ke.j){var lt=ke.j-ne;ne=ke.j,Ae[0]+=lt*$e}if(ne>=de?ne=0:(Ae[0]+=4*ke.v,ke.ka=ne-ke.j,ke.U=ke.va-ke.v,ke.T=de-ne,ne=1),ne){if(Ve=Ve[0],11>(ne=D.ca).S){var Ze=ne.f.RGBA,tn=(de=ne.S,Ae=ke.U,ke=ke.T,lt=Ze.eb,Ze.A),nn=ke;for(Ze=Ze.fb+D.Ma*Ze.A;0<nn--;){var qt=ze,mn=Ve,Pt=Ae,Ot=lt,Ut=Ze;switch(de){case Sh:pa(qt,mn,Pt,Ot,Ut);break;case gf:Ao(qt,mn,Pt,Ot,Ut);break;case vd:Ao(qt,mn,Pt,Ot,Ut),jo(Ot,Ut,0,Pt,1,0);break;case Li:Jl(qt,mn,Pt,Ot,Ut);break;case _f:Hi(qt,mn,Pt,Ot,Ut,1);break;case vf:Hi(qt,mn,Pt,Ot,Ut,1),jo(Ot,Ut,0,Pt,1,0);break;case Th:Hi(qt,mn,Pt,Ot,Ut,0);break;case xd:Hi(qt,mn,Pt,Ot,Ut,0),jo(Ot,Ut,1,Pt,1,0);break;case yd:Ac(qt,mn,Pt,Ot,Ut);break;case Wp:Ac(qt,mn,Pt,Ot,Ut),Vi(Ot,Ut,Pt,1,0);break;case yf:Yl(qt,mn,Pt,Ot,Ut);break;default:e(0)}Ve+=$e,Ze+=tn}D.Ma+=ke}else alert("todo:EmitRescaledRowsYUVA");e(D.Ma<=ne.height)}}D.C=q,e(D.C<=D.i)}function Nt(D){var q;if(0<D.ua)return 0;for(q=0;q<D.Wb;++q){var ne=D.Ya[q].G,de=D.Ya[q].H;if(0<ne[1][de[1]+0].g||0<ne[2][de[2]+0].g||0<ne[3][de[3]+0].g)return 0}return 1}function Lt(D,q,ne,de,Ae,ke){if(D.Z!=0){var ze=D.qd,Ve=D.rd;for(e(Ga[D.Z]!=null);q<ne;++q)Ga[D.Z](ze,Ve,de,Ae,de,Ae,ke),ze=de,Ve=Ae,Ae+=ke;D.qd=ze,D.rd=Ve}}function sn(D,q){var ne=D.l.ma,de=ne.Z==0||ne.Z==1?D.l.j:D.C;if(de=D.C<de?de:D.C,e(q<=D.l.o),q>de){var Ae=D.l.width,ke=ne.ca,ze=ne.tb+Ae*de,Ve=D.V,$e=D.Ba+D.c*de,lt=D.gc;e(D.ab==1),e(lt[0].hc==3),bl(lt[0],de,q,Ve,$e,ke,ze),Lt(ne,de,q,ke,ze,Ae)}D.C=D.Ma=q}function pn(D,q,ne,de,Ae,ke,ze){var Ve=D.$/de,$e=D.$%de,lt=D.m,Ze=D.s,tn=ne+D.$,nn=tn;Ae=ne+de*Ae;var qt=ne+de*ke,mn=280+Ze.ua,Pt=D.Pb?Ve:16777216,Ot=0<Ze.ua?Ze.Wa:null,Ut=Ze.wc,wn=tn<qt?wt(Ze,$e,Ve):null;e(D.C<ke),e(qt<=Ae);var Pn=!1;e:for(;;){for(;Pn||tn<qt;){var Tn=0;if(Ve>=Pt){var rr=tn-ne;e((Pt=D).Pb),Pt.wd=Pt.m,Pt.xd=rr,0<Pt.s.ua&&cn(Pt.s.Wa,Pt.s.vb),Pt=Ve+Xp}if($e&Ut||(wn=wt(Ze,$e,Ve)),e(wn!=null),wn.Qb&&(q[tn]=wn.qb,Pn=!0),!Pn)if(Et(lt),wn.jc){Tn=lt,rr=q;var qn=tn,Ar=wn.pd[Re(Tn)&Cs-1];e(wn.jc),256>Ar.g?(ut(Tn,Tn.u+Ar.g),rr[qn]=Ar.value,Tn=0):(ut(Tn,Tn.u+Ar.g-256),e(256<=Ar.value),Tn=Ar.value),Tn==0&&(Pn=!0)}else Tn=qe(wn.G[0],wn.H[0],lt);if(lt.h)break;if(Pn||256>Tn){if(!Pn)if(wn.nd)q[tn]=(wn.qb|Tn<<8)>>>0;else{if(Et(lt),Pn=qe(wn.G[1],wn.H[1],lt),Et(lt),rr=qe(wn.G[2],wn.H[2],lt),qn=qe(wn.G[3],wn.H[3],lt),lt.h)break;q[tn]=(qn<<24|Pn<<16|Tn<<8|rr)>>>0}if(Pn=!1,++tn,++$e>=de&&($e=0,++Ve,ze!=null&&Ve<=ke&&!(Ve%16)&&ze(D,Ve),Ot!=null))for(;nn<tn;)Tn=q[nn++],Ot.X[(506832829*Tn&4294967295)>>>Ot.Mb]=Tn}else if(280>Tn){if(Tn=Oe(Tn-256,lt),rr=qe(wn.G[4],wn.H[4],lt),Et(lt),rr=Ye(de,rr=Oe(rr,lt)),lt.h)break;if(tn-ne<rr||Ae-tn<Tn)break e;for(qn=0;qn<Tn;++qn)q[tn+qn]=q[tn+qn-rr];for(tn+=Tn,$e+=Tn;$e>=de;)$e-=de,++Ve,ze!=null&&Ve<=ke&&!(Ve%16)&&ze(D,Ve);if(e(tn<=Ae),$e&Ut&&(wn=wt(Ze,$e,Ve)),Ot!=null)for(;nn<tn;)Tn=q[nn++],Ot.X[(506832829*Tn&4294967295)>>>Ot.Mb]=Tn}else{if(!(Tn<mn))break e;for(Pn=Tn-280,e(Ot!=null);nn<tn;)Tn=q[nn++],Ot.X[(506832829*Tn&4294967295)>>>Ot.Mb]=Tn;Tn=tn,e(!(Pn>>>(rr=Ot).Xa)),q[Tn]=rr.X[Pn],Pn=!0}Pn||e(lt.h==Fe(lt))}if(D.Pb&&lt.h&&tn<Ae)e(D.m.h),D.a=5,D.m=D.wd,D.$=D.xd,0<D.s.ua&&cn(D.s.vb,D.s.Wa);else{if(lt.h)break e;ze!=null&&ze(D,Ve>ke?ke:Ve),D.a=0,D.$=tn-ne}return 1}return D.a=3,0}function yn(D){e(D!=null),D.vc=null,D.yc=null,D.Ya=null;var q=D.Wa;q!=null&&(q.X=null),D.vb=null,e(D!=null)}function $n(){var D=new Hp;return D==null?null:(D.a=0,D.xb=_g,pi("Predictor","VP8LPredictors"),pi("Predictor","VP8LPredictors_C"),pi("PredictorAdd","VP8LPredictorsAdd"),pi("PredictorAdd","VP8LPredictorsAdd_C"),Ru=hi,Du=wr,pa=Kn,Ao=Hs,Ac=fi,Yl=xo,Jl=di,Me.VP8LMapColor32b=xl,Me.VP8LMapColor8b=Tc,D)}function er(D,q,ne,de,Ae){var ke=1,ze=[D],Ve=[q],$e=de.m,lt=de.s,Ze=null,tn=0;e:for(;;){if(ne)for(;ke&&Xe($e,1);){var nn=ze,qt=Ve,mn=de,Pt=1,Ot=mn.m,Ut=mn.gc[mn.ab],wn=Xe(Ot,2);if(mn.Oc&1<<wn)ke=0;else{switch(mn.Oc|=1<<wn,Ut.hc=wn,Ut.Ea=nn[0],Ut.nc=qt[0],Ut.K=[null],++mn.ab,e(4>=mn.ab),wn){case 0:case 1:Ut.b=Xe(Ot,3)+2,Pt=er(En(Ut.Ea,Ut.b),En(Ut.nc,Ut.b),0,mn,Ut.K),Ut.K=Ut.K[0];break;case 3:var Pn,Tn=Xe(Ot,8)+1,rr=16<Tn?0:4<Tn?1:2<Tn?2:3;if(nn[0]=En(Ut.Ea,rr),Ut.b=rr,Pn=Pt=er(Tn,1,0,mn,Ut.K)){var qn,Ar=Tn,Zn=Ut,ki=1<<(8>>Zn.b),mi=g(ki);if(mi==null)Pn=0;else{var Ti=Zn.K[0],gi=Zn.w;for(mi[0]=Zn.K[0][0],qn=1;qn<1*Ar;++qn)mi[qn]=bn(Ti[gi+qn],mi[qn-1]);for(;qn<4*ki;++qn)mi[qn]=0;Zn.K[0]=null,Zn.K[0]=mi,Pn=1}}Pt=Pn;break;case 2:break;default:e(0)}ke=Pt}}if(ze=ze[0],Ve=Ve[0],ke&&Xe($e,1)&&!(ke=1<=(tn=Xe($e,4))&&11>=tn)){de.a=3;break e}var oi;if(oi=ke)t:{var Ai,Hr,xs,ro=de,bs=ze,ea=Ve,ci=tn,Nr=ne,mo=ro.m,Xs=ro.s,io=[null],go=1,Uo=0,ta=bf[ci];n:for(;;){if(Nr&&Xe(mo,1)){var ws=Xe(mo,3)+2,_a=En(bs,ws),an=En(ea,ws),vn=_a*an;if(!er(_a,an,0,ro,io))break n;for(io=io[0],Xs.xc=ws,Ai=0;Ai<vn;++Ai){var La=io[Ai]>>8&65535;io[Ai]=La,La>=go&&(go=La+1)}}if(mo.h)break n;for(Hr=0;5>Hr;++Hr){var Ir=Zp[Hr];!Hr&&0<ci&&(Ir+=1<<ci),Uo<Ir&&(Uo=Ir)}var Tt=v(go*ta,Le),rm=go,Md=v(rm,Je);if(Md==null)var Ph=null;else e(65536>=rm),Ph=Md;var Bu=g(Uo);if(Ph==null||Bu==null||Tt==null){ro.a=1;break n}var Id=Tt;for(Ai=xs=0;Ai<go;++Ai){var Za=Ph[Ai],Al=Za.G,Mh=Za.H,wg=0,Ld=1,kd=0;for(Hr=0;5>Hr;++Hr){Ir=Zp[Hr],Al[Hr]=Id,Mh[Hr]=xs,!Hr&&0<ci&&(Ir+=1<<ci);i:{var El,Rd=Ir,Ih=ro,Cl=Bu,Cf=Id,Lh=xs,Pl=0,Ic=Ih.m,Ys=Xe(Ic,1);if(d(Cl,0,0,Rd),Ys){var v0=Xe(Ic,1)+1,Dd=Xe(Ic,1),vi=Xe(Ic,Dd==0?1:8);Cl[vi]=1,v0==2&&(Cl[vi=Xe(Ic,8)]=1);var Or=1}else{var im=g(19),ic=Xe(Ic,4)+4;if(19<ic){Ih.a=3;var Lc=0;break i}for(El=0;El<ic;++El)im[Kp[El]]=Xe(Ic,3);var Ml=void 0,Il=void 0,kh=Ih,sm=im,na=Rd,Pf=Cl,ka=0,ra=kh.m,Nd=8,Od=v(128,Le);r:for(;ve(Od,0,7,sm,19);){if(Xe(ra,1)){var om=2+2*Xe(ra,3);if((Ml=2+Xe(ra,om))>na)break r}else Ml=na;for(Il=0;Il<na&&Ml--;){Et(ra);var Mf=Od[0+(127&Re(ra))];ut(ra,ra.u+Mf.g);var Ka=Mf.value;if(16>Ka)Pf[Il++]=Ka,Ka!=0&&(Nd=Ka);else{var am=Ka==16,kc=Ka-16,lm=wd[kc],Rh=Xe(ra,bd[kc])+lm;if(Il+Rh>na)break r;for(var cm=am?Nd:0;0<Rh--;)Pf[Il++]=cm}}ka=1;break r}ka||(kh.a=3),Or=ka}(Or=Or&&!Ic.h)&&(Pl=ve(Cf,Lh,8,Cl,Rd)),Or&&Pl!=0?Lc=Pl:(Ih.a=3,Lc=0)}if(Lc==0)break n;if(Ld&&Ia[Hr]==1&&(Ld=Id[xs].g==0),wg+=Id[xs].g,xs+=Lc,3>=Hr){var ju,Os=Bu[0];for(ju=1;ju<Ir;++ju)Bu[ju]>Os&&(Os=Bu[ju]);kd+=Os}}if(Za.nd=Ld,Za.Qb=0,Ld&&(Za.qb=(Al[3][Mh[3]+0].value<<24|Al[1][Mh[1]+0].value<<16|Al[2][Mh[2]+0].value)>>>0,wg==0&&256>Al[0][Mh[0]+0].value&&(Za.Qb=1,Za.qb+=Al[0][Mh[0]+0].value<<8)),Za.jc=!Za.Qb&&6>kd,Za.jc){var Uu,Xa=Za;for(Uu=0;Uu<Cs;++Uu){var zs=Uu,Ll=Xa.pd[zs],Dh=Xa.G[0][Xa.H[0]+zs];256<=Dh.value?(Ll.g=Dh.g+256,Ll.value=Dh.value):(Ll.g=0,Ll.value=0,zs>>=at(Dh,8,Ll),zs>>=at(Xa.G[1][Xa.H[1]+zs],16,Ll),zs>>=at(Xa.G[2][Xa.H[2]+zs],0,Ll),at(Xa.G[3][Xa.H[3]+zs],24,Ll))}}}Xs.vc=io,Xs.Wb=go,Xs.Ya=Ph,Xs.yc=Tt,oi=1;break t}oi=0}if(!(ke=oi)){de.a=3;break e}if(0<tn){if(lt.ua=1<<tn,!$t(lt.Wa,tn)){de.a=1,ke=0;break e}}else lt.ua=0;var zd=de,Vu=ze,Fd=Ve,Nh=zd.s,Oh=Nh.xc;if(zd.c=Vu,zd.i=Fd,Nh.md=En(Vu,Oh),Nh.wc=Oh==0?-1:(1<<Oh)-1,ne){de.xb=_0;break e}if((Ze=g(ze*Ve))==null){de.a=1,ke=0;break e}ke=(ke=pn(de,Ze,0,ze,Ve,Ve,null))&&!$e.h;break e}return ke?(Ae!=null?Ae[0]=Ze:(e(Ze==null),e(ne)),de.$=0,ne||yn(lt)):yn(lt),ke}function or(D,q){var ne=D.c*D.i,de=ne+q+16*q;return e(D.c<=q),D.V=g(de),D.V==null?(D.Ta=null,D.Ua=0,D.a=1,0):(D.Ta=D.V,D.Ua=D.Ba+ne+q,1)}function ur(D,q){var ne=D.C,de=q-ne,Ae=D.V,ke=D.Ba+D.c*ne;for(e(q<=D.l.o);0<de;){var ze=16<de?16:de,Ve=D.l.ma,$e=D.l.width,lt=$e*ze,Ze=Ve.ca,tn=Ve.tb+$e*ne,nn=D.Ta,qt=D.Ua;ct(D,ze,Ae,ke),es(nn,qt,Ze,tn,lt),Lt(Ve,ne,ne+ze,Ze,tn,$e),de-=ze,Ae+=ze*D.c,ne+=ze}e(ne==q),D.C=D.Ma=q}function li(){this.ub=this.yd=this.td=this.Rb=0}function Si(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function mr(){this.Fb=this.Bb=this.Cb=0,this.Zb=g(4),this.Lb=g(4)}function Vr(){this.Yb=function(){var D=[];return function q(ne,de,Ae){for(var ke=Ae[de],ze=0;ze<ke&&(ne.push(Ae.length>de+1?[]:0),!(Ae.length<de+1));ze++)q(ne[ze],de+1,Ae)}(D,0,[3,11]),D}()}function Xr(){this.jb=g(3),this.Wc=i([4,8],Vr),this.Xc=i([4,17],Vr)}function ti(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new g(4),this.od=new g(4)}function Oi(){this.ld=this.La=this.dd=this.tc=0}function ms(){this.Na=this.la=0}function to(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function No(){this.ad=g(384),this.Za=0,this.Ob=g(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function fo(){this.uc=this.M=this.Nb=0,this.wa=Array(new Oi),this.Y=0,this.ya=Array(new No),this.aa=0,this.l=new gl}function gs(){this.y=g(16),this.f=g(8),this.ea=g(8)}function Ds(){this.cb=this.a=0,this.sc="",this.m=new Vt,this.Od=new li,this.Kc=new Si,this.ed=new ti,this.Qa=new mr,this.Ic=this.$c=this.Aa=0,this.D=new fo,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=v(8,Vt),this.ia=0,this.pb=v(4,to),this.Pa=new Xr,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new gs),this.Hd=0,this.rb=Array(new ms),this.sb=0,this.wa=Array(new Oi),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new No),this.L=this.aa=0,this.gd=i([4,2],Oi),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function gl(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ua(){var D=new Ds;return D!=null&&(D.a=0,D.sc="OK",D.cb=0,D.Xb=0,su||(su=Xc)),D}function Wi(D,q,ne){return D.a==0&&(D.a=q,D.sc=ne,D.cb=0),0}function yh(D,q,ne){return 3<=ne&&D[q+0]==157&&D[q+1]==1&&D[q+2]==42}function Eu(D,q){if(D==null)return 0;if(D.a=0,D.sc="OK",q==null)return Wi(D,2,"null VP8Io passed to VP8GetHeaders()");var ne=q.data,de=q.w,Ae=q.ha;if(4>Ae)return Wi(D,7,"Truncated header.");var ke=ne[de+0]|ne[de+1]<<8|ne[de+2]<<16,ze=D.Od;if(ze.Rb=!(1&ke),ze.td=ke>>1&7,ze.yd=ke>>4&1,ze.ub=ke>>5,3<ze.td)return Wi(D,3,"Incorrect keyframe parameters.");if(!ze.yd)return Wi(D,4,"Frame not displayable.");de+=3,Ae-=3;var Ve=D.Kc;if(ze.Rb){if(7>Ae)return Wi(D,7,"cannot parse picture header");if(!yh(ne,de,Ae))return Wi(D,3,"Bad code word");Ve.c=16383&(ne[de+4]<<8|ne[de+3]),Ve.Td=ne[de+4]>>6,Ve.i=16383&(ne[de+6]<<8|ne[de+5]),Ve.Ud=ne[de+6]>>6,de+=7,Ae-=7,D.za=Ve.c+15>>4,D.Ub=Ve.i+15>>4,q.width=Ve.c,q.height=Ve.i,q.Da=0,q.j=0,q.v=0,q.va=q.width,q.o=q.height,q.da=0,q.ib=q.width,q.hb=q.height,q.U=q.width,q.T=q.height,d((ke=D.Pa).jb,0,255,ke.jb.length),e((ke=D.Qa)!=null),ke.Cb=0,ke.Bb=0,ke.Fb=1,d(ke.Zb,0,0,ke.Zb.length),d(ke.Lb,0,0,ke.Lb)}if(ze.ub>Ae)return Wi(D,7,"bad partition length");yt(ke=D.m,ne,de,ze.ub),de+=ze.ub,Ae-=ze.ub,ze.Rb&&(Ve.Ld=Wt(ke),Ve.Kd=Wt(ke)),Ve=D.Qa;var $e,lt=D.Pa;if(e(ke!=null),e(Ve!=null),Ve.Cb=Wt(ke),Ve.Cb){if(Ve.Bb=Wt(ke),Wt(ke)){for(Ve.Fb=Wt(ke),$e=0;4>$e;++$e)Ve.Zb[$e]=Wt(ke)?jt(ke,7):0;for($e=0;4>$e;++$e)Ve.Lb[$e]=Wt(ke)?jt(ke,6):0}if(Ve.Bb)for($e=0;3>$e;++$e)lt.jb[$e]=Wt(ke)?St(ke,8):255}else Ve.Bb=0;if(ke.Ka)return Wi(D,3,"cannot parse segment header");if((Ve=D.ed).zd=Wt(ke),Ve.Tb=St(ke,6),Ve.wb=St(ke,3),Ve.Pc=Wt(ke),Ve.Pc&&Wt(ke)){for(lt=0;4>lt;++lt)Wt(ke)&&(Ve.vd[lt]=jt(ke,6));for(lt=0;4>lt;++lt)Wt(ke)&&(Ve.od[lt]=jt(ke,6))}if(D.L=Ve.Tb==0?0:Ve.zd?1:2,ke.Ka)return Wi(D,3,"cannot parse filter header");var Ze=Ae;if(Ae=$e=de,de=$e+Ze,Ve=Ze,D.Xb=(1<<St(D.m,2))-1,Ze<3*(lt=D.Xb))ne=7;else{for($e+=3*lt,Ve-=3*lt,Ze=0;Ze<lt;++Ze){var tn=ne[Ae+0]|ne[Ae+1]<<8|ne[Ae+2]<<16;tn>Ve&&(tn=Ve),yt(D.Jc[+Ze],ne,$e,tn),$e+=tn,Ve-=tn,Ae+=3}yt(D.Jc[+lt],ne,$e,Ve),ne=$e<de?0:5}if(ne!=0)return Wi(D,ne,"cannot parse partitions");for(ne=St($e=D.m,7),Ae=Wt($e)?jt($e,4):0,de=Wt($e)?jt($e,4):0,Ve=Wt($e)?jt($e,4):0,lt=Wt($e)?jt($e,4):0,$e=Wt($e)?jt($e,4):0,Ze=D.Qa,tn=0;4>tn;++tn){if(Ze.Cb){var nn=Ze.Zb[tn];Ze.Fb||(nn+=ne)}else{if(0<tn){D.pb[tn]=D.pb[0];continue}nn=ne}var qt=D.pb[tn];qt.Sc[0]=Sd[Bo(nn+Ae,127)],qt.Sc[1]=Td[Bo(nn+0,127)],qt.Eb[0]=2*Sd[Bo(nn+de,127)],qt.Eb[1]=101581*Td[Bo(nn+Ve,127)]>>16,8>qt.Eb[1]&&(qt.Eb[1]=8),qt.Qc[0]=Sd[Bo(nn+lt,117)],qt.Qc[1]=Td[Bo(nn+$e,127)],qt.lc=nn+$e}if(!ze.Rb)return Wi(D,4,"Not a key frame.");for(Wt(ke),ze=D.Pa,ne=0;4>ne;++ne){for(Ae=0;8>Ae;++Ae)for(de=0;3>de;++de)for(Ve=0;11>Ve;++Ve)lt=Ft(ke,Ah[ne][Ae][de][Ve])?St(ke,8):mg[ne][Ae][de][Ve],ze.Wc[ne][Ae].Yb[de][Ve]=lt;for(Ae=0;17>Ae;++Ae)ze.Xc[ne][Ae]=ze.Wc[ne][g0[Ae]]}return D.kc=Wt(ke),D.kc&&(D.Bd=St(ke,8)),D.cb=1}function Xc(D,q,ne,de,Ae,ke,ze){var Ve=q[Ae].Yb[ne];for(ne=0;16>Ae;++Ae){if(!Ft(D,Ve[ne+0]))return Ae;for(;!Ft(D,Ve[ne+1]);)if(Ve=q[++Ae].Yb[0],ne=0,Ae==16)return 16;var $e=q[Ae+1].Yb;if(Ft(D,Ve[ne+2])){var lt=D,Ze=0;if(Ft(lt,(nn=Ve)[(tn=ne)+3]))if(Ft(lt,nn[tn+6])){for(Ve=0,tn=2*(Ze=Ft(lt,nn[tn+8]))+(nn=Ft(lt,nn[tn+9+Ze])),Ze=0,nn=Yp[tn];nn[Ve];++Ve)Ze+=Ze+Ft(lt,nn[Ve]);Ze+=3+(8<<tn)}else Ft(lt,nn[tn+7])?(Ze=7+2*Ft(lt,165),Ze+=Ft(lt,145)):Ze=5+Ft(lt,159);else Ze=Ft(lt,nn[tn+4])?3+Ft(lt,nn[tn+5]):2;Ve=$e[2]}else Ze=1,Ve=$e[1];$e=ze+Jp[Ae],0>(lt=D).b&&Ct(lt);var tn,nn=lt.b,qt=(tn=lt.Ca>>1)-(lt.I>>nn)>>31;--lt.b,lt.Ca+=qt,lt.Ca|=1,lt.I-=(tn+1&qt)<<nn,ke[$e]=((Ze^qt)-qt)*de[(0<Ae)+0]}return 16}function Gl(D){var q=D.rb[D.sb-1];q.la=0,q.Na=0,d(D.zc,0,0,D.zc.length),D.ja=0}function dd(D,q){if(D==null)return 0;if(q==null)return Wi(D,2,"NULL VP8Io parameter in VP8Decode().");if(!D.cb&&!Eu(D,q))return 0;if(e(D.cb),q.ac==null||q.ac(q)){q.ob&&(D.L=0);var ne=zu[D.L];if(D.L==2?(D.yb=0,D.zb=0):(D.yb=q.v-ne>>4,D.zb=q.j-ne>>4,0>D.yb&&(D.yb=0),0>D.zb&&(D.zb=0)),D.Va=q.o+15+ne>>4,D.Hb=q.va+15+ne>>4,D.Hb>D.za&&(D.Hb=D.za),D.Va>D.Ub&&(D.Va=D.Ub),0<D.L){var de=D.ed;for(ne=0;4>ne;++ne){var Ae;if(D.Qa.Cb){var ke=D.Qa.Lb[ne];D.Qa.Fb||(ke+=de.Tb)}else ke=de.Tb;for(Ae=0;1>=Ae;++Ae){var ze=D.gd[ne][Ae],Ve=ke;if(de.Pc&&(Ve+=de.vd[0],Ae&&(Ve+=de.od[0])),0<(Ve=0>Ve?0:63<Ve?63:Ve)){var $e=Ve;0<de.wb&&($e=4<de.wb?$e>>2:$e>>1)>9-de.wb&&($e=9-de.wb),1>$e&&($e=1),ze.dd=$e,ze.tc=2*Ve+$e,ze.ld=40<=Ve?2:15<=Ve?1:0}else ze.tc=0;ze.La=Ae}}}ne=0}else Wi(D,6,"Frame setup failed"),ne=D.a;if(ne=ne==0){if(ne){D.$c=0,0<D.Aa||(D.Ic=Ef);e:{ne=D.Ic,de=4*($e=D.za);var lt=32*$e,Ze=$e+1,tn=0<D.L?$e*(0<D.Aa?2:1):0,nn=(D.Aa==2?2:1)*$e;if((ze=de+832+(Ae=3*(16*ne+zu[D.L])/2*lt)+(ke=D.Fa!=null&&0<D.Fa.length?D.Kc.c*D.Kc.i:0))!=ze)ne=0;else{if(ze>D.Vb){if(D.Vb=0,D.Ec=g(ze),D.Fc=0,D.Ec==null){ne=Wi(D,1,"no memory during frame initialization.");break e}D.Vb=ze}ze=D.Ec,Ve=D.Fc,D.Ac=ze,D.Bc=Ve,Ve+=de,D.Gd=v(lt,gs),D.Hd=0,D.rb=v(Ze+1,ms),D.sb=1,D.wa=tn?v(tn,Oi):null,D.Y=0,D.D.Nb=0,D.D.wa=D.wa,D.D.Y=D.Y,0<D.Aa&&(D.D.Y+=$e),e(!0),D.oc=ze,D.pc=Ve,Ve+=832,D.ya=v(nn,No),D.aa=0,D.D.ya=D.ya,D.D.aa=D.aa,D.Aa==2&&(D.D.aa+=$e),D.R=16*$e,D.B=8*$e,$e=(lt=zu[D.L])*D.R,lt=lt/2*D.B,D.sa=ze,D.ta=Ve+$e,D.qa=D.sa,D.ra=D.ta+16*ne*D.R+lt,D.Ha=D.qa,D.Ia=D.ra+8*ne*D.B+lt,D.$c=0,Ve+=Ae,D.mb=ke?ze:null,D.nb=ke?Ve:null,e(Ve+ke<=D.Fc+D.Vb),Gl(D),d(D.Ac,D.Bc,0,de),ne=1}}if(ne){if(q.ka=0,q.y=D.sa,q.O=D.ta,q.f=D.qa,q.N=D.ra,q.ea=D.Ha,q.Vd=D.Ia,q.fa=D.R,q.Rc=D.B,q.F=null,q.J=0,!Ma){for(ne=-255;255>=ne;++ne)fs[255+ne]=0>ne?-ne:ne;for(ne=-1020;1020>=ne;++ne)Sl[1020+ne]=-128>ne?-128:127<ne?127:ne;for(ne=-112;112>=ne;++ne)iu[112+ne]=-16>ne?-16:15<ne?15:ne;for(ne=-255;510>=ne;++ne)rc[255+ne]=0>ne?0:255<ne?255:ne;Ma=1}Ec=Yc,Cc=Sa,gd=_l,Yo=Wo,Jo=bo,Qi=zo,Nu=Xo,ru=Zi,Qo=Ji,Pc=ku,Ql=As,$a=da,ec=To,Pa=wc,tc=Lu,nc=ha,wl=ls,Eo=Ua,Tl[0]=Ns,Tl[1]=vh,Tl[2]=Mu,Tl[3]=zr,Tl[4]=Iu,Tl[5]=In,Tl[6]=vc,Tl[7]=Fr,Tl[8]=no,Tl[9]=Dr,ou[0]=qr,ou[1]=wo,ou[2]=Wl,ou[3]=Jc,ou[4]=po,ou[5]=Bn,ou[6]=fd,Mc[0]=ja,Mc[1]=Ta,Mc[2]=Qc,Mc[3]=Pr,Mc[4]=hs,Mc[5]=yl,Mc[6]=Ui,ne=1}else ne=0}ne&&(ne=function(qt,mn){for(qt.M=0;qt.M<qt.Va;++qt.M){var Pt,Ot=qt.Jc[qt.M&qt.Xb],Ut=qt.m,wn=qt;for(Pt=0;Pt<wn.za;++Pt){var Pn=Ut,Tn=wn,rr=Tn.Ac,qn=Tn.Bc+4*Pt,Ar=Tn.zc,Zn=Tn.ya[Tn.aa+Pt];if(Tn.Qa.Bb?Zn.$b=Ft(Pn,Tn.Pa.jb[0])?2+Ft(Pn,Tn.Pa.jb[2]):Ft(Pn,Tn.Pa.jb[1]):Zn.$b=0,Tn.kc&&(Zn.Ad=Ft(Pn,Tn.Bd)),Zn.Za=!Ft(Pn,145)+0,Zn.Za){var ki=Zn.Ob,mi=0;for(Tn=0;4>Tn;++Tn){var Ti,gi=Ar[0+Tn];for(Ti=0;4>Ti;++Ti){gi=gg[rr[qn+Ti]][gi];for(var oi=Ad[Ft(Pn,gi[0])];0<oi;)oi=Ad[2*oi+Ft(Pn,gi[oi])];gi=-oi,rr[qn+Ti]=gi}a(ki,mi,rr,qn,4),mi+=4,Ar[0+Tn]=gi}}else gi=Ft(Pn,156)?Ft(Pn,128)?1:3:Ft(Pn,163)?2:0,Zn.Ob[0]=gi,d(rr,qn,gi,4),d(Ar,0,gi,4);Zn.Dd=Ft(Pn,142)?Ft(Pn,114)?Ft(Pn,183)?1:3:2:0}if(wn.m.Ka)return Wi(qt,7,"Premature end-of-partition0 encountered.");for(;qt.ja<qt.za;++qt.ja){if(wn=Ot,Pn=(Ut=qt).rb[Ut.sb-1],rr=Ut.rb[Ut.sb+Ut.ja],Pt=Ut.ya[Ut.aa+Ut.ja],qn=Ut.kc?Pt.Ad:0)Pn.la=rr.la=0,Pt.Za||(Pn.Na=rr.Na=0),Pt.Hc=0,Pt.Gc=0,Pt.ia=0;else{var Ai,Hr;if(Pn=rr,rr=wn,qn=Ut.Pa.Xc,Ar=Ut.ya[Ut.aa+Ut.ja],Zn=Ut.pb[Ar.$b],Tn=Ar.ad,ki=0,mi=Ut.rb[Ut.sb-1],gi=Ti=0,d(Tn,ki,0,384),Ar.Za)var xs=0,ro=qn[3];else{oi=g(16);var bs=Pn.Na+mi.Na;if(bs=su(rr,qn[1],bs,Zn.Eb,0,oi,0),Pn.Na=mi.Na=(0<bs)+0,1<bs)Ec(oi,0,Tn,ki);else{var ea=oi[0]+3>>3;for(oi=0;256>oi;oi+=16)Tn[ki+oi]=ea}xs=1,ro=qn[0]}var ci=15&Pn.la,Nr=15&mi.la;for(oi=0;4>oi;++oi){var mo=1&Nr;for(ea=Hr=0;4>ea;++ea)ci=ci>>1|(mo=(bs=su(rr,ro,bs=mo+(1&ci),Zn.Sc,xs,Tn,ki))>xs)<<7,Hr=Hr<<2|(3<bs?3:1<bs?2:Tn[ki+0]!=0),ki+=16;ci>>=4,Nr=Nr>>1|mo<<7,Ti=(Ti<<8|Hr)>>>0}for(ro=ci,xs=Nr>>4,Ai=0;4>Ai;Ai+=2){for(Hr=0,ci=Pn.la>>4+Ai,Nr=mi.la>>4+Ai,oi=0;2>oi;++oi){for(mo=1&Nr,ea=0;2>ea;++ea)bs=mo+(1&ci),ci=ci>>1|(mo=0<(bs=su(rr,qn[2],bs,Zn.Qc,0,Tn,ki)))<<3,Hr=Hr<<2|(3<bs?3:1<bs?2:Tn[ki+0]!=0),ki+=16;ci>>=2,Nr=Nr>>1|mo<<5}gi|=Hr<<4*Ai,ro|=ci<<4<<Ai,xs|=(240&Nr)<<Ai}Pn.la=ro,mi.la=xs,Ar.Hc=Ti,Ar.Gc=gi,Ar.ia=43690&gi?0:Zn.ia,qn=!(Ti|gi)}if(0<Ut.L&&(Ut.wa[Ut.Y+Ut.ja]=Ut.gd[Pt.$b][Pt.Za],Ut.wa[Ut.Y+Ut.ja].La|=!qn),wn.Ka)return Wi(qt,7,"Premature end-of-file encountered.")}if(Gl(qt),Ut=mn,wn=1,Pt=(Ot=qt).D,Pn=0<Ot.L&&Ot.M>=Ot.zb&&Ot.M<=Ot.Va,Ot.Aa==0)e:{if(Pt.M=Ot.M,Pt.uc=Pn,Xn(Ot,Pt),wn=1,Pt=(Hr=Ot.D).Nb,Pn=(gi=zu[Ot.L])*Ot.R,rr=gi/2*Ot.B,oi=16*Pt*Ot.R,ea=8*Pt*Ot.B,qn=Ot.sa,Ar=Ot.ta-Pn+oi,Zn=Ot.qa,Tn=Ot.ra-rr+ea,ki=Ot.Ha,mi=Ot.Ia-rr+ea,Nr=(ci=Hr.M)==0,Ti=ci>=Ot.Va-1,Ot.Aa==2&&Xn(Ot,Hr),Hr.uc)for(mo=(bs=Ot).D.M,e(bs.D.uc),Hr=bs.yb;Hr<bs.Hb;++Hr){xs=Hr,ro=mo;var Xs=(io=(Ir=bs).D).Nb;Ai=Ir.R;var io=io.wa[io.Y+xs],go=Ir.sa,Uo=Ir.ta+16*Xs*Ai+16*xs,ta=io.dd,ws=io.tc;if(ws!=0)if(e(3<=ws),Ir.L==1)0<xs&&nc(go,Uo,Ai,ws+4),io.La&&Eo(go,Uo,Ai,ws),0<ro&&tc(go,Uo,Ai,ws+4),io.La&&wl(go,Uo,Ai,ws);else{var _a=Ir.B,an=Ir.qa,vn=Ir.ra+8*Xs*_a+8*xs,La=Ir.Ha,Ir=Ir.Ia+8*Xs*_a+8*xs;Xs=io.ld,0<xs&&(ru(go,Uo,Ai,ws+4,ta,Xs),Pc(an,vn,La,Ir,_a,ws+4,ta,Xs)),io.La&&($a(go,Uo,Ai,ws,ta,Xs),Pa(an,vn,La,Ir,_a,ws,ta,Xs)),0<ro&&(Nu(go,Uo,Ai,ws+4,ta,Xs),Qo(an,vn,La,Ir,_a,ws+4,ta,Xs)),io.La&&(Ql(go,Uo,Ai,ws,ta,Xs),ec(an,vn,La,Ir,_a,ws,ta,Xs))}}if(Ot.ia&&alert("todo:DitherRow"),Ut.put!=null){if(Hr=16*ci,ci=16*(ci+1),Nr?(Ut.y=Ot.sa,Ut.O=Ot.ta+oi,Ut.f=Ot.qa,Ut.N=Ot.ra+ea,Ut.ea=Ot.Ha,Ut.W=Ot.Ia+ea):(Hr-=gi,Ut.y=qn,Ut.O=Ar,Ut.f=Zn,Ut.N=Tn,Ut.ea=ki,Ut.W=mi),Ti||(ci-=gi),ci>Ut.o&&(ci=Ut.o),Ut.F=null,Ut.J=null,Ot.Fa!=null&&0<Ot.Fa.length&&Hr<ci&&(Ut.J=bh(Ot,Ut,Hr,ci-Hr),Ut.F=Ot.mb,Ut.F==null&&Ut.F.length==0)){wn=Wi(Ot,3,"Could not decode alpha data.");break e}Hr<Ut.j&&(gi=Ut.j-Hr,Hr=Ut.j,e(!(1&gi)),Ut.O+=Ot.R*gi,Ut.N+=Ot.B*(gi>>1),Ut.W+=Ot.B*(gi>>1),Ut.F!=null&&(Ut.J+=Ut.width*gi)),Hr<ci&&(Ut.O+=Ut.v,Ut.N+=Ut.v>>1,Ut.W+=Ut.v>>1,Ut.F!=null&&(Ut.J+=Ut.v),Ut.ka=Hr-Ut.j,Ut.U=Ut.va-Ut.v,Ut.T=ci-Hr,wn=Ut.put(Ut))}Pt+1!=Ot.Ic||Ti||(a(Ot.sa,Ot.ta-Pn,qn,Ar+16*Ot.R,Pn),a(Ot.qa,Ot.ra-rr,Zn,Tn+8*Ot.B,rr),a(Ot.Ha,Ot.Ia-rr,ki,mi+8*Ot.B,rr))}if(!wn)return Wi(qt,6,"Output aborted.")}return 1}(D,q)),q.bc!=null&&q.bc(q),ne&=1}return ne?(D.cb=0,ne):0}function Ba(D,q,ne,de,Ae){Ae=D[q+ne+32*de]+(Ae>>3),D[q+ne+32*de]=-256&Ae?0>Ae?0:255:Ae}function Cu(D,q,ne,de,Ae,ke){Ba(D,q,0,ne,de+Ae),Ba(D,q,1,ne,de+ke),Ba(D,q,2,ne,de-ke),Ba(D,q,3,ne,de-Ae)}function Oo(D){return(20091*D>>16)+D}function Hl(D,q,ne,de){var Ae,ke=0,ze=g(16);for(Ae=0;4>Ae;++Ae){var Ve=D[q+0]+D[q+8],$e=D[q+0]-D[q+8],lt=(35468*D[q+4]>>16)-Oo(D[q+12]),Ze=Oo(D[q+4])+(35468*D[q+12]>>16);ze[ke+0]=Ve+Ze,ze[ke+1]=$e+lt,ze[ke+2]=$e-lt,ze[ke+3]=Ve-Ze,ke+=4,q++}for(Ae=ke=0;4>Ae;++Ae)Ve=(D=ze[ke+0]+4)+ze[ke+8],$e=D-ze[ke+8],lt=(35468*ze[ke+4]>>16)-Oo(ze[ke+12]),Ba(ne,de,0,0,Ve+(Ze=Oo(ze[ke+4])+(35468*ze[ke+12]>>16))),Ba(ne,de,1,0,$e+lt),Ba(ne,de,2,0,$e-lt),Ba(ne,de,3,0,Ve-Ze),ke++,de+=32}function zo(D,q,ne,de){var Ae=D[q+0]+4,ke=35468*D[q+4]>>16,ze=Oo(D[q+4]),Ve=35468*D[q+1]>>16;Cu(ne,de,0,Ae+ze,D=Oo(D[q+1]),Ve),Cu(ne,de,1,Ae+ke,D,Ve),Cu(ne,de,2,Ae-ke,D,Ve),Cu(ne,de,3,Ae-ze,D,Ve)}function Sa(D,q,ne,de,Ae){Hl(D,q,ne,de),Ae&&Hl(D,q+16,ne,de+4)}function _l(D,q,ne,de){Cc(D,q+0,ne,de,1),Cc(D,q+32,ne,de+128,1)}function Wo(D,q,ne,de){var Ae;for(D=D[q+0]+4,Ae=0;4>Ae;++Ae)for(q=0;4>q;++q)Ba(ne,de,q,Ae,D)}function bo(D,q,ne,de){D[q+0]&&Yo(D,q+0,ne,de),D[q+16]&&Yo(D,q+16,ne,de+4),D[q+32]&&Yo(D,q+32,ne,de+128),D[q+48]&&Yo(D,q+48,ne,de+128+4)}function Yc(D,q,ne,de){var Ae,ke=g(16);for(Ae=0;4>Ae;++Ae){var ze=D[q+0+Ae]+D[q+12+Ae],Ve=D[q+4+Ae]+D[q+8+Ae],$e=D[q+4+Ae]-D[q+8+Ae],lt=D[q+0+Ae]-D[q+12+Ae];ke[0+Ae]=ze+Ve,ke[8+Ae]=ze-Ve,ke[4+Ae]=lt+$e,ke[12+Ae]=lt-$e}for(Ae=0;4>Ae;++Ae)ze=(D=ke[0+4*Ae]+3)+ke[3+4*Ae],Ve=ke[1+4*Ae]+ke[2+4*Ae],$e=ke[1+4*Ae]-ke[2+4*Ae],lt=D-ke[3+4*Ae],ne[de+0]=ze+Ve>>3,ne[de+16]=lt+$e>>3,ne[de+32]=ze-Ve>>3,ne[de+48]=lt-$e>>3,de+=64}function Pu(D,q,ne){var de,Ae=q-32,ke=ma,ze=255-D[Ae-1];for(de=0;de<ne;++de){var Ve,$e=ke,lt=ze+D[q-1];for(Ve=0;Ve<ne;++Ve)D[q+Ve]=$e[lt+D[Ae+Ve]];q+=32}}function vh(D,q){Pu(D,q,4)}function Ta(D,q){Pu(D,q,8)}function wo(D,q){Pu(D,q,16)}function Wl(D,q){var ne;for(ne=0;16>ne;++ne)a(D,q+32*ne,D,q-32,16)}function Jc(D,q){var ne;for(ne=16;0<ne;--ne)d(D,q,D[q-1],16),q+=32}function So(D,q,ne){var de;for(de=0;16>de;++de)d(q,ne+32*de,D,16)}function qr(D,q){var ne,de=16;for(ne=0;16>ne;++ne)de+=D[q-1+32*ne]+D[q+ne-32];So(de>>5,D,q)}function po(D,q){var ne,de=8;for(ne=0;16>ne;++ne)de+=D[q-1+32*ne];So(de>>4,D,q)}function Bn(D,q){var ne,de=8;for(ne=0;16>ne;++ne)de+=D[q+ne-32];So(de>>4,D,q)}function fd(D,q){So(128,D,q)}function $r(D,q,ne){return D+2*q+ne+2>>2}function Mu(D,q){var ne,de=q-32;for(de=new Uint8Array([$r(D[de-1],D[de+0],D[de+1]),$r(D[de+0],D[de+1],D[de+2]),$r(D[de+1],D[de+2],D[de+3]),$r(D[de+2],D[de+3],D[de+4])]),ne=0;4>ne;++ne)a(D,q+32*ne,de,0,de.length)}function zr(D,q){var ne=D[q-1],de=D[q-1+32],Ae=D[q-1+64],ke=D[q-1+96];me(D,q+0,16843009*$r(D[q-1-32],ne,de)),me(D,q+32,16843009*$r(ne,de,Ae)),me(D,q+64,16843009*$r(de,Ae,ke)),me(D,q+96,16843009*$r(Ae,ke,ke))}function Ns(D,q){var ne,de=4;for(ne=0;4>ne;++ne)de+=D[q+ne-32]+D[q-1+32*ne];for(de>>=3,ne=0;4>ne;++ne)d(D,q+32*ne,de,4)}function Iu(D,q){var ne=D[q-1+0],de=D[q-1+32],Ae=D[q-1+64],ke=D[q-1-32],ze=D[q+0-32],Ve=D[q+1-32],$e=D[q+2-32],lt=D[q+3-32];D[q+0+96]=$r(de,Ae,D[q-1+96]),D[q+1+96]=D[q+0+64]=$r(ne,de,Ae),D[q+2+96]=D[q+1+64]=D[q+0+32]=$r(ke,ne,de),D[q+3+96]=D[q+2+64]=D[q+1+32]=D[q+0+0]=$r(ze,ke,ne),D[q+3+64]=D[q+2+32]=D[q+1+0]=$r(Ve,ze,ke),D[q+3+32]=D[q+2+0]=$r($e,Ve,ze),D[q+3+0]=$r(lt,$e,Ve)}function vc(D,q){var ne=D[q+1-32],de=D[q+2-32],Ae=D[q+3-32],ke=D[q+4-32],ze=D[q+5-32],Ve=D[q+6-32],$e=D[q+7-32];D[q+0+0]=$r(D[q+0-32],ne,de),D[q+1+0]=D[q+0+32]=$r(ne,de,Ae),D[q+2+0]=D[q+1+32]=D[q+0+64]=$r(de,Ae,ke),D[q+3+0]=D[q+2+32]=D[q+1+64]=D[q+0+96]=$r(Ae,ke,ze),D[q+3+32]=D[q+2+64]=D[q+1+96]=$r(ke,ze,Ve),D[q+3+64]=D[q+2+96]=$r(ze,Ve,$e),D[q+3+96]=$r(Ve,$e,$e)}function In(D,q){var ne=D[q-1+0],de=D[q-1+32],Ae=D[q-1+64],ke=D[q-1-32],ze=D[q+0-32],Ve=D[q+1-32],$e=D[q+2-32],lt=D[q+3-32];D[q+0+0]=D[q+1+64]=ke+ze+1>>1,D[q+1+0]=D[q+2+64]=ze+Ve+1>>1,D[q+2+0]=D[q+3+64]=Ve+$e+1>>1,D[q+3+0]=$e+lt+1>>1,D[q+0+96]=$r(Ae,de,ne),D[q+0+64]=$r(de,ne,ke),D[q+0+32]=D[q+1+96]=$r(ne,ke,ze),D[q+1+32]=D[q+2+96]=$r(ke,ze,Ve),D[q+2+32]=D[q+3+96]=$r(ze,Ve,$e),D[q+3+32]=$r(Ve,$e,lt)}function Fr(D,q){var ne=D[q+0-32],de=D[q+1-32],Ae=D[q+2-32],ke=D[q+3-32],ze=D[q+4-32],Ve=D[q+5-32],$e=D[q+6-32],lt=D[q+7-32];D[q+0+0]=ne+de+1>>1,D[q+1+0]=D[q+0+64]=de+Ae+1>>1,D[q+2+0]=D[q+1+64]=Ae+ke+1>>1,D[q+3+0]=D[q+2+64]=ke+ze+1>>1,D[q+0+32]=$r(ne,de,Ae),D[q+1+32]=D[q+0+96]=$r(de,Ae,ke),D[q+2+32]=D[q+1+96]=$r(Ae,ke,ze),D[q+3+32]=D[q+2+96]=$r(ke,ze,Ve),D[q+3+64]=$r(ze,Ve,$e),D[q+3+96]=$r(Ve,$e,lt)}function Dr(D,q){var ne=D[q-1+0],de=D[q-1+32],Ae=D[q-1+64],ke=D[q-1+96];D[q+0+0]=ne+de+1>>1,D[q+2+0]=D[q+0+32]=de+Ae+1>>1,D[q+2+32]=D[q+0+64]=Ae+ke+1>>1,D[q+1+0]=$r(ne,de,Ae),D[q+3+0]=D[q+1+32]=$r(de,Ae,ke),D[q+3+32]=D[q+1+64]=$r(Ae,ke,ke),D[q+3+64]=D[q+2+64]=D[q+0+96]=D[q+1+96]=D[q+2+96]=D[q+3+96]=ke}function no(D,q){var ne=D[q-1+0],de=D[q-1+32],Ae=D[q-1+64],ke=D[q-1+96],ze=D[q-1-32],Ve=D[q+0-32],$e=D[q+1-32],lt=D[q+2-32];D[q+0+0]=D[q+2+32]=ne+ze+1>>1,D[q+0+32]=D[q+2+64]=de+ne+1>>1,D[q+0+64]=D[q+2+96]=Ae+de+1>>1,D[q+0+96]=ke+Ae+1>>1,D[q+3+0]=$r(Ve,$e,lt),D[q+2+0]=$r(ze,Ve,$e),D[q+1+0]=D[q+3+32]=$r(ne,ze,Ve),D[q+1+32]=D[q+3+64]=$r(de,ne,ze),D[q+1+64]=D[q+3+96]=$r(Ae,de,ne),D[q+1+96]=$r(ke,Ae,de)}function Qc(D,q){var ne;for(ne=0;8>ne;++ne)a(D,q+32*ne,D,q-32,8)}function Pr(D,q){var ne;for(ne=0;8>ne;++ne)d(D,q,D[q-1],8),q+=32}function Zo(D,q,ne){var de;for(de=0;8>de;++de)d(q,ne+32*de,D,8)}function ja(D,q){var ne,de=8;for(ne=0;8>ne;++ne)de+=D[q+ne-32]+D[q-1+32*ne];Zo(de>>4,D,q)}function yl(D,q){var ne,de=4;for(ne=0;8>ne;++ne)de+=D[q+ne-32];Zo(de>>3,D,q)}function hs(D,q){var ne,de=4;for(ne=0;8>ne;++ne)de+=D[q-1+32*ne];Zo(de>>3,D,q)}function Ui(D,q){Zo(128,D,q)}function Fo(D,q,ne){var de=D[q-ne],Ae=D[q+0],ke=3*(Ae-de)+Tr[1020+D[q-2*ne]-D[q+ne]],ze=_d[112+(ke+4>>3)];D[q-ne]=ma[255+de+_d[112+(ke+3>>3)]],D[q+0]=ma[255+Ae-ze]}function xc(D,q,ne,de){var Ae=D[q+0],ke=D[q+ne];return Co[255+D[q-2*ne]-D[q-ne]]>de||Co[255+ke-Ae]>de}function xh(D,q,ne,de){return 4*Co[255+D[q-ne]-D[q+0]]+Co[255+D[q-2*ne]-D[q+ne]]<=de}function bc(D,q,ne,de,Ae){var ke=D[q-3*ne],ze=D[q-2*ne],Ve=D[q-ne],$e=D[q+0],lt=D[q+ne],Ze=D[q+2*ne],tn=D[q+3*ne];return 4*Co[255+Ve-$e]+Co[255+ze-lt]>de?0:Co[255+D[q-4*ne]-ke]<=Ae&&Co[255+ke-ze]<=Ae&&Co[255+ze-Ve]<=Ae&&Co[255+tn-Ze]<=Ae&&Co[255+Ze-lt]<=Ae&&Co[255+lt-$e]<=Ae}function Lu(D,q,ne,de){var Ae=2*de+1;for(de=0;16>de;++de)xh(D,q+de,ne,Ae)&&Fo(D,q+de,ne)}function ha(D,q,ne,de){var Ae=2*de+1;for(de=0;16>de;++de)xh(D,q+de*ne,1,Ae)&&Fo(D,q+de*ne,1)}function ls(D,q,ne,de){var Ae;for(Ae=3;0<Ae;--Ae)Lu(D,q+=4*ne,ne,de)}function Ua(D,q,ne,de){var Ae;for(Ae=3;0<Ae;--Ae)ha(D,q+=4,ne,de)}function ds(D,q,ne,de,Ae,ke,ze,Ve){for(ke=2*ke+1;0<Ae--;){if(bc(D,q,ne,ke,ze))if(xc(D,q,ne,Ve))Fo(D,q,ne);else{var $e=D,lt=q,Ze=ne,tn=$e[lt-2*Ze],nn=$e[lt-Ze],qt=$e[lt+0],mn=$e[lt+Ze],Pt=$e[lt+2*Ze],Ot=27*(wn=Tr[1020+3*(qt-nn)+Tr[1020+tn-mn]])+63>>7,Ut=18*wn+63>>7,wn=9*wn+63>>7;$e[lt-3*Ze]=ma[255+$e[lt-3*Ze]+wn],$e[lt-2*Ze]=ma[255+tn+Ut],$e[lt-Ze]=ma[255+nn+Ot],$e[lt+0]=ma[255+qt-Ot],$e[lt+Ze]=ma[255+mn-Ut],$e[lt+2*Ze]=ma[255+Pt-wn]}q+=de}}function Ko(D,q,ne,de,Ae,ke,ze,Ve){for(ke=2*ke+1;0<Ae--;){if(bc(D,q,ne,ke,ze))if(xc(D,q,ne,Ve))Fo(D,q,ne);else{var $e=D,lt=q,Ze=ne,tn=$e[lt-Ze],nn=$e[lt+0],qt=$e[lt+Ze],mn=_d[112+((Pt=3*(nn-tn))+4>>3)],Pt=_d[112+(Pt+3>>3)],Ot=mn+1>>1;$e[lt-2*Ze]=ma[255+$e[lt-2*Ze]+Ot],$e[lt-Ze]=ma[255+tn+Pt],$e[lt+0]=ma[255+nn-mn],$e[lt+Ze]=ma[255+qt-Ot]}q+=de}}function Xo(D,q,ne,de,Ae,ke){ds(D,q,ne,1,16,de,Ae,ke)}function Zi(D,q,ne,de,Ae,ke){ds(D,q,1,ne,16,de,Ae,ke)}function As(D,q,ne,de,Ae,ke){var ze;for(ze=3;0<ze;--ze)Ko(D,q+=4*ne,ne,1,16,de,Ae,ke)}function da(D,q,ne,de,Ae,ke){var ze;for(ze=3;0<ze;--ze)Ko(D,q+=4,1,ne,16,de,Ae,ke)}function Ji(D,q,ne,de,Ae,ke,ze,Ve){ds(D,q,Ae,1,8,ke,ze,Ve),ds(ne,de,Ae,1,8,ke,ze,Ve)}function ku(D,q,ne,de,Ae,ke,ze,Ve){ds(D,q,1,Ae,8,ke,ze,Ve),ds(ne,de,1,Ae,8,ke,ze,Ve)}function To(D,q,ne,de,Ae,ke,ze,Ve){Ko(D,q+4*Ae,Ae,1,8,ke,ze,Ve),Ko(ne,de+4*Ae,Ae,1,8,ke,ze,Ve)}function wc(D,q,ne,de,Ae,ke,ze,Ve){Ko(D,q+4,1,Ae,8,ke,ze,Ve),Ko(ne,de+4,1,Ae,8,ke,ze,Ve)}function Aa(){this.ba=new as,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ns,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ea(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function pd(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Va(){this.ua=0,this.Wa=new _t,this.vb=new _t,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Je,this.yc=new Le}function Hp(){this.xb=this.a=0,this.l=new gl,this.ca=new as,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new be,this.Pb=0,this.wd=new be,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Va,this.ab=0,this.gc=v(4,pd),this.Oc=0}function Sc(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new gl,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Es(D,q,ne,de,Ae,ke,ze){for(D=D==null?0:D[q+0],q=0;q<ze;++q)Ae[ke+q]=D+ne[de+q]&255,D=Ae[ke+q]}function md(D,q,ne,de,Ae,ke,ze){var Ve;if(D==null)Es(null,null,ne,de,Ae,ke,ze);else for(Ve=0;Ve<ze;++Ve)Ae[ke+Ve]=D[q+Ve]+ne[de+Ve]&255}function fa(D,q,ne,de,Ae,ke,ze){if(D==null)Es(null,null,ne,de,Ae,ke,ze);else{var Ve,$e=D[q+0],lt=$e,Ze=$e;for(Ve=0;Ve<ze;++Ve)lt=Ze+($e=D[q+Ve])-lt,Ze=ne[de+Ve]+(-256&lt?0>lt?0:255:lt)&255,lt=$e,Ae[ke+Ve]=Ze}}function bh(D,q,ne,de){var Ae=q.width,ke=q.o;if(e(D!=null&&q!=null),0>ne||0>=de||ne+de>ke)return null;if(!D.Cc){if(D.ga==null){var ze;if(D.ga=new Sc,(ze=D.ga==null)||(ze=q.width*q.o,e(D.Gb.length==0),D.Gb=g(ze),D.Uc=0,D.Gb==null?ze=0:(D.mb=D.Gb,D.nb=D.Uc,D.rc=null,ze=1),ze=!ze),!ze){ze=D.ga;var Ve=D.Fa,$e=D.P,lt=D.qc,Ze=D.mb,tn=D.nb,nn=$e+1,qt=lt-1,mn=ze.l;if(e(Ve!=null&&Ze!=null&&q!=null),Ga[0]=null,Ga[1]=Es,Ga[2]=md,Ga[3]=fa,ze.ca=Ze,ze.tb=tn,ze.c=q.width,ze.i=q.height,e(0<ze.c&&0<ze.i),1>=lt)q=0;else if(ze.$a=Ve[$e+0]>>0&3,ze.Z=Ve[$e+0]>>2&3,ze.Lc=Ve[$e+0]>>4&3,$e=Ve[$e+0]>>6&3,0>ze.$a||1<ze.$a||4<=ze.Z||1<ze.Lc||$e)q=0;else if(mn.put=Dt,mn.ac=Rs,mn.bc=he,mn.ma=ze,mn.width=q.width,mn.height=q.height,mn.Da=q.Da,mn.v=q.v,mn.va=q.va,mn.j=q.j,mn.o=q.o,ze.$a)e:{e(ze.$a==1),q=$n();t:for(;;){if(q==null){q=0;break e}if(e(ze!=null),ze.mc=q,q.c=ze.c,q.i=ze.i,q.l=ze.l,q.l.ma=ze,q.l.width=ze.c,q.l.height=ze.i,q.a=0,et(q.m,Ve,nn,qt),!er(ze.c,ze.i,1,q,null)||(q.ab==1&&q.gc[0].hc==3&&Nt(q.s)?(ze.ic=1,Ve=q.c*q.i,q.Ta=null,q.Ua=0,q.V=g(Ve),q.Ba=0,q.V==null?(q.a=1,q=0):q=1):(ze.ic=0,q=or(q,ze.c)),!q))break t;q=1;break e}ze.mc=null,q=0}else q=qt>=ze.c*ze.i;ze=!q}if(ze)return null;D.ga.Lc!=1?D.Ga=0:de=ke-ne}e(D.ga!=null),e(ne+de<=ke);e:{if(q=(Ve=D.ga).c,ke=Ve.l.o,Ve.$a==0){if(nn=D.rc,qt=D.Vc,mn=D.Fa,$e=D.P+1+ne*q,lt=D.mb,Ze=D.nb+ne*q,e($e<=D.P+D.qc),Ve.Z!=0)for(e(Ga[Ve.Z]!=null),ze=0;ze<de;++ze)Ga[Ve.Z](nn,qt,mn,$e,lt,Ze,q),nn=lt,qt=Ze,Ze+=q,$e+=q;else for(ze=0;ze<de;++ze)a(lt,Ze,mn,$e,q),nn=lt,qt=Ze,Ze+=q,$e+=q;D.rc=nn,D.Vc=qt}else{if(e(Ve.mc!=null),q=ne+de,e((ze=Ve.mc)!=null),e(q<=ze.i),ze.C>=q)q=1;else if(Ve.ic||Yt(),Ve.ic){Ve=ze.V,nn=ze.Ba,qt=ze.c;var Pt=ze.i,Ot=(mn=1,$e=ze.$/qt,lt=ze.$%qt,Ze=ze.m,tn=ze.s,ze.$),Ut=qt*Pt,wn=qt*q,Pn=tn.wc,Tn=Ot<wn?wt(tn,lt,$e):null;e(Ot<=Ut),e(q<=Pt),e(Nt(tn));t:for(;;){for(;!Ze.h&&Ot<wn;){if(lt&Pn||(Tn=wt(tn,lt,$e)),e(Tn!=null),Et(Ze),256>(Pt=qe(Tn.G[0],Tn.H[0],Ze)))Ve[nn+Ot]=Pt,++Ot,++lt>=qt&&(lt=0,++$e<=q&&!($e%16)&&sn(ze,$e));else{if(!(280>Pt)){mn=0;break t}Pt=Oe(Pt-256,Ze);var rr,qn=qe(Tn.G[4],Tn.H[4],Ze);if(Et(Ze),!(Ot>=(qn=Ye(qt,qn=Oe(qn,Ze)))&&Ut-Ot>=Pt)){mn=0;break t}for(rr=0;rr<Pt;++rr)Ve[nn+Ot+rr]=Ve[nn+Ot+rr-qn];for(Ot+=Pt,lt+=Pt;lt>=qt;)lt-=qt,++$e<=q&&!($e%16)&&sn(ze,$e);Ot<wn&&lt&Pn&&(Tn=wt(tn,lt,$e))}e(Ze.h==Fe(Ze))}sn(ze,$e>q?q:$e);break t}!mn||Ze.h&&Ot<Ut?(mn=0,ze.a=Ze.h?5:3):ze.$=Ot,q=mn}else q=pn(ze,ze.V,ze.Ba,ze.c,ze.i,q,ur);if(!q){de=0;break e}}ne+de>=ke&&(D.Cc=1),de=1}if(!de)return null;if(D.Cc&&((de=D.ga)!=null&&(de.mc=null),D.ga=null,0<D.Ga))return alert("todo:WebPDequantizeLevels"),null}return D.nb+ne*Ae}function K(D,q,ne,de,Ae,ke){for(;0<Ae--;){var ze,Ve=D,$e=q+(ne?1:0),lt=D,Ze=q+(ne?0:3);for(ze=0;ze<de;++ze){var tn=lt[Ze+4*ze];tn!=255&&(tn*=32897,Ve[$e+4*ze+0]=Ve[$e+4*ze+0]*tn>>23,Ve[$e+4*ze+1]=Ve[$e+4*ze+1]*tn>>23,Ve[$e+4*ze+2]=Ve[$e+4*ze+2]*tn>>23)}q+=ke}}function Ee(D,q,ne,de,Ae){for(;0<de--;){var ke;for(ke=0;ke<ne;++ke){var ze=D[q+2*ke+0],Ve=15&(lt=D[q+2*ke+1]),$e=4369*Ve,lt=(240&lt|lt>>4)*$e>>16;D[q+2*ke+0]=(240&ze|ze>>4)*$e>>16&240|(15&ze|ze<<4)*$e>>16>>4&15,D[q+2*ke+1]=240&lt|Ve}q+=Ae}}function pt(D,q,ne,de,Ae,ke,ze,Ve){var $e,lt,Ze=255;for(lt=0;lt<Ae;++lt){for($e=0;$e<de;++$e){var tn=D[q+$e];ke[ze+4*$e]=tn,Ze&=tn}q+=ne,ze+=Ve}return Ze!=255}function It(D,q,ne,de,Ae){var ke;for(ke=0;ke<Ae;++ke)ne[de+ke]=D[q+ke]>>8}function Yt(){jo=K,Vi=Ee,Pi=pt,es=It}function fn(D,q,ne){Me[D]=function(de,Ae,ke,ze,Ve,$e,lt,Ze,tn,nn,qt,mn,Pt,Ot,Ut,wn,Pn){var Tn,rr=Pn-1>>1,qn=Ve[$e+0]|lt[Ze+0]<<16,Ar=tn[nn+0]|qt[mn+0]<<16;e(de!=null);var Zn=3*qn+Ar+131074>>2;for(q(de[Ae+0],255&Zn,Zn>>16,Pt,Ot),ke!=null&&(Zn=3*Ar+qn+131074>>2,q(ke[ze+0],255&Zn,Zn>>16,Ut,wn)),Tn=1;Tn<=rr;++Tn){var ki=Ve[$e+Tn]|lt[Ze+Tn]<<16,mi=tn[nn+Tn]|qt[mn+Tn]<<16,Ti=qn+ki+Ar+mi+524296,gi=Ti+2*(ki+Ar)>>3;Zn=gi+qn>>1,qn=(Ti=Ti+2*(qn+mi)>>3)+ki>>1,q(de[Ae+2*Tn-1],255&Zn,Zn>>16,Pt,Ot+(2*Tn-1)*ne),q(de[Ae+2*Tn-0],255&qn,qn>>16,Pt,Ot+(2*Tn-0)*ne),ke!=null&&(Zn=Ti+Ar>>1,qn=gi+mi>>1,q(ke[ze+2*Tn-1],255&Zn,Zn>>16,Ut,wn+(2*Tn-1)*ne),q(ke[ze+2*Tn+0],255&qn,qn>>16,Ut,wn+(2*Tn+0)*ne)),qn=ki,Ar=mi}1&Pn||(Zn=3*qn+Ar+131074>>2,q(de[Ae+Pn-1],255&Zn,Zn>>16,Pt,Ot+(Pn-1)*ne),ke!=null&&(Zn=3*Ar+qn+131074>>2,q(ke[ze+Pn-1],255&Zn,Zn>>16,Ut,wn+(Pn-1)*ne)))}}function Mn(){ga[Sh]=Qp,ga[gf]=em,ga[Li]=Eh,ga[_f]=tm,ga[Th]=wf,ga[yd]=Ed,ga[yf]=Ha,ga[vd]=em,ga[vf]=tm,ga[xd]=wf,ga[Wp]=Ed}function Wn(D){return D&~yg?0>D?0:255:D>>Cd}function vr(D,q){return Wn((19077*D>>8)+(26149*q>>8)-14234)}function Mr(D,q,ne){return Wn((19077*D>>8)-(6419*q>>8)-(13320*ne>>8)+8708)}function Gr(D,q){return Wn((19077*D>>8)+(33050*q>>8)-17685)}function Ci(D,q,ne,de,Ae){de[Ae+0]=vr(D,ne),de[Ae+1]=Mr(D,q,ne),de[Ae+2]=Gr(D,q)}function _s(D,q,ne,de,Ae){de[Ae+0]=Gr(D,q),de[Ae+1]=Mr(D,q,ne),de[Ae+2]=vr(D,ne)}function ys(D,q,ne,de,Ae){var ke=Mr(D,q,ne);q=ke<<3&224|Gr(D,q)>>3,de[Ae+0]=248&vr(D,ne)|ke>>5,de[Ae+1]=q}function Ws(D,q,ne,de,Ae){var ke=240&Gr(D,q)|15;de[Ae+0]=240&vr(D,ne)|Mr(D,q,ne)>>4,de[Ae+1]=ke}function vs(D,q,ne,de,Ae){de[Ae+0]=255,Ci(D,q,ne,de,Ae+1)}function Jn(D,q,ne,de,Ae){_s(D,q,ne,de,Ae),de[Ae+3]=255}function Rn(D,q,ne,de,Ae){Ci(D,q,ne,de,Ae),de[Ae+3]=255}function Bo(D,q){return 0>D?0:D>q?q:D}function Hn(D,q,ne){Me[D]=function(de,Ae,ke,ze,Ve,$e,lt,Ze,tn){for(var nn=Ze+(-2&tn)*ne;Ze!=nn;)q(de[Ae+0],ke[ze+0],Ve[$e+0],lt,Ze),q(de[Ae+1],ke[ze+0],Ve[$e+0],lt,Ze+ne),Ae+=2,++ze,++$e,Ze+=2*ne;1&tn&&q(de[Ae+0],ke[ze+0],Ve[$e+0],lt,Ze)}}function qa(D,q,ne){return ne==0?D==0?q==0?6:5:q==0?4:0:ne}function Zl(D,q,ne,de,Ae){switch(D>>>30){case 3:Cc(q,ne,de,Ae,0);break;case 2:Qi(q,ne,de,Ae);break;case 1:Yo(q,ne,de,Ae)}}function Xn(D,q){var ne,de,Ae=q.M,ke=q.Nb,ze=D.oc,Ve=D.pc+40,$e=D.oc,lt=D.pc+584,Ze=D.oc,tn=D.pc+600;for(ne=0;16>ne;++ne)ze[Ve+32*ne-1]=129;for(ne=0;8>ne;++ne)$e[lt+32*ne-1]=129,Ze[tn+32*ne-1]=129;for(0<Ae?ze[Ve-1-32]=$e[lt-1-32]=Ze[tn-1-32]=129:(d(ze,Ve-32-1,127,21),d($e,lt-32-1,127,9),d(Ze,tn-32-1,127,9)),de=0;de<D.za;++de){var nn=q.ya[q.aa+de];if(0<de){for(ne=-1;16>ne;++ne)a(ze,Ve+32*ne-4,ze,Ve+32*ne+12,4);for(ne=-1;8>ne;++ne)a($e,lt+32*ne-4,$e,lt+32*ne+4,4),a(Ze,tn+32*ne-4,Ze,tn+32*ne+4,4)}var qt=D.Gd,mn=D.Hd+de,Pt=nn.ad,Ot=nn.Hc;if(0<Ae&&(a(ze,Ve-32,qt[mn].y,0,16),a($e,lt-32,qt[mn].f,0,8),a(Ze,tn-32,qt[mn].ea,0,8)),nn.Za){var Ut=ze,wn=Ve-32+16;for(0<Ae&&(de>=D.za-1?d(Ut,wn,qt[mn].y[15],4):a(Ut,wn,qt[mn+1].y,0,4)),ne=0;4>ne;ne++)Ut[wn+128+ne]=Ut[wn+256+ne]=Ut[wn+384+ne]=Ut[wn+0+ne];for(ne=0;16>ne;++ne,Ot<<=2)Ut=ze,wn=Ve+Af[ne],Tl[nn.Ob[ne]](Ut,wn),Zl(Ot,Pt,16*+ne,Ut,wn)}else if(Ut=qa(de,Ae,nn.Ob[0]),ou[Ut](ze,Ve),Ot!=0)for(ne=0;16>ne;++ne,Ot<<=2)Zl(Ot,Pt,16*+ne,ze,Ve+Af[ne]);for(ne=nn.Gc,Ut=qa(de,Ae,nn.Dd),Mc[Ut]($e,lt),Mc[Ut](Ze,tn),Ot=Pt,Ut=$e,wn=lt,255&(nn=ne>>0)&&(170&nn?gd(Ot,256,Ut,wn):Jo(Ot,256,Ut,wn)),nn=Ze,Ot=tn,255&(ne>>=8)&&(170&ne?gd(Pt,320,nn,Ot):Jo(Pt,320,nn,Ot)),Ae<D.Ub-1&&(a(qt[mn].y,0,ze,Ve+480,16),a(qt[mn].f,0,$e,lt+224,8),a(qt[mn].ea,0,Ze,tn+224,8)),ne=8*ke*D.B,qt=D.sa,mn=D.ta+16*de+16*ke*D.R,Pt=D.qa,nn=D.ra+8*de+ne,Ot=D.Ha,Ut=D.Ia+8*de+ne,ne=0;16>ne;++ne)a(qt,mn+ne*D.R,ze,Ve+32*ne,16);for(ne=0;8>ne;++ne)a(Pt,nn+ne*D.B,$e,lt+32*ne,8),a(Ot,Ut+ne*D.B,Ze,tn+32*ne,8)}}function eu(D,q,ne,de,Ae,ke,ze,Ve,$e){var lt=[0],Ze=[0],tn=0,nn=$e!=null?$e.kd:0,qt=$e??new Ea;if(D==null||12>ne)return 7;qt.data=D,qt.w=q,qt.ha=ne,q=[q],ne=[ne],qt.gb=[qt.gb];e:{var mn=q,Pt=ne,Ot=qt.gb;if(e(D!=null),e(Pt!=null),e(Ot!=null),Ot[0]=0,12<=Pt[0]&&!s(D,mn[0],"RIFF")){if(s(D,mn[0]+8,"WEBP")){Ot=3;break e}var Ut=On(D,mn[0]+4);if(12>Ut||4294967286<Ut){Ot=3;break e}if(nn&&Ut>Pt[0]-8){Ot=7;break e}Ot[0]=Ut,mn[0]+=12,Pt[0]-=12}Ot=0}if(Ot!=0)return Ot;for(Ut=0<qt.gb[0],ne=ne[0];;){e:{var wn=D;Pt=q,Ot=ne;var Pn=lt,Tn=Ze,rr=mn=[0];if((Zn=tn=[tn])[0]=0,8>Ot[0])Ot=7;else{if(!s(wn,Pt[0],"VP8X")){if(On(wn,Pt[0]+4)!=10){Ot=3;break e}if(18>Ot[0]){Ot=7;break e}var qn=On(wn,Pt[0]+8),Ar=1+Cn(wn,Pt[0]+12);if(2147483648<=Ar*(wn=1+Cn(wn,Pt[0]+15))){Ot=3;break e}rr!=null&&(rr[0]=qn),Pn!=null&&(Pn[0]=Ar),Tn!=null&&(Tn[0]=wn),Pt[0]+=18,Ot[0]-=18,Zn[0]=1}Ot=0}}if(tn=tn[0],mn=mn[0],Ot!=0)return Ot;if(Pt=!!(2&mn),!Ut&&tn)return 3;if(ke!=null&&(ke[0]=!!(16&mn)),ze!=null&&(ze[0]=Pt),Ve!=null&&(Ve[0]=0),ze=lt[0],mn=Ze[0],tn&&Pt&&$e==null){Ot=0;break}if(4>ne){Ot=7;break}if(Ut&&tn||!Ut&&!tn&&!s(D,q[0],"ALPH")){ne=[ne],qt.na=[qt.na],qt.P=[qt.P],qt.Sa=[qt.Sa];e:{qn=D,Ot=q,Ut=ne;var Zn=qt.gb;Pn=qt.na,Tn=qt.P,rr=qt.Sa,Ar=22,e(qn!=null),e(Ut!=null),wn=Ot[0];var ki=Ut[0];for(e(Pn!=null),e(rr!=null),Pn[0]=null,Tn[0]=null,rr[0]=0;;){if(Ot[0]=wn,Ut[0]=ki,8>ki){Ot=7;break e}var mi=On(qn,wn+4);if(4294967286<mi){Ot=3;break e}var Ti=8+mi+1&-2;if(Ar+=Ti,0<Zn&&Ar>Zn){Ot=3;break e}if(!s(qn,wn,"VP8 ")||!s(qn,wn,"VP8L")){Ot=0;break e}if(ki[0]<Ti){Ot=7;break e}s(qn,wn,"ALPH")||(Pn[0]=qn,Tn[0]=wn+8,rr[0]=mi),wn+=Ti,ki-=Ti}}if(ne=ne[0],qt.na=qt.na[0],qt.P=qt.P[0],qt.Sa=qt.Sa[0],Ot!=0)break}ne=[ne],qt.Ja=[qt.Ja],qt.xa=[qt.xa];e:if(Zn=D,Ot=q,Ut=ne,Pn=qt.gb[0],Tn=qt.Ja,rr=qt.xa,qn=Ot[0],wn=!s(Zn,qn,"VP8 "),Ar=!s(Zn,qn,"VP8L"),e(Zn!=null),e(Ut!=null),e(Tn!=null),e(rr!=null),8>Ut[0])Ot=7;else{if(wn||Ar){if(Zn=On(Zn,qn+4),12<=Pn&&Zn>Pn-12){Ot=3;break e}if(nn&&Zn>Ut[0]-8){Ot=7;break e}Tn[0]=Zn,Ot[0]+=8,Ut[0]-=8,rr[0]=Ar}else rr[0]=5<=Ut[0]&&Zn[qn+0]==47&&!(Zn[qn+4]>>5),Tn[0]=Ut[0];Ot=0}if(ne=ne[0],qt.Ja=qt.Ja[0],qt.xa=qt.xa[0],q=q[0],Ot!=0)break;if(4294967286<qt.Ja)return 3;if(Ve==null||Pt||(Ve[0]=qt.xa?2:1),ze=[ze],mn=[mn],qt.xa){if(5>ne){Ot=7;break}Ve=ze,nn=mn,Pt=ke,D==null||5>ne?D=0:5<=ne&&D[q+0]==47&&!(D[q+4]>>5)?(Ut=[0],Zn=[0],Pn=[0],et(Tn=new be,D,q,ne),_e(Tn,Ut,Zn,Pn)?(Ve!=null&&(Ve[0]=Ut[0]),nn!=null&&(nn[0]=Zn[0]),Pt!=null&&(Pt[0]=Pn[0]),D=1):D=0):D=0}else{if(10>ne){Ot=7;break}Ve=mn,D==null||10>ne||!yh(D,q+3,ne-3)?D=0:(nn=D[q+0]|D[q+1]<<8|D[q+2]<<16,Pt=16383&(D[q+7]<<8|D[q+6]),D=16383&(D[q+9]<<8|D[q+8]),1&nn||3<(nn>>1&7)||!(nn>>4&1)||nn>>5>=qt.Ja||!Pt||!D?D=0:(ze&&(ze[0]=Pt),Ve&&(Ve[0]=D),D=1))}if(!D||(ze=ze[0],mn=mn[0],tn&&(lt[0]!=ze||Ze[0]!=mn)))return 3;$e!=null&&($e[0]=qt,$e.offset=q-$e.w,e(4294967286>q-$e.w),e($e.offset==$e.ha-ne));break}return Ot==0||Ot==7&&tn&&$e==null?(ke!=null&&(ke[0]|=qt.na!=null&&0<qt.na.length),de!=null&&(de[0]=ze),Ae!=null&&(Ae[0]=mn),0):Ot}function vl(D,q,ne){var de=q.width,Ae=q.height,ke=0,ze=0,Ve=de,$e=Ae;if(q.Da=D!=null&&0<D.Da,q.Da&&(Ve=D.cd,$e=D.bd,ke=D.v,ze=D.j,11>ne||(ke&=-2,ze&=-2),0>ke||0>ze||0>=Ve||0>=$e||ke+Ve>de||ze+$e>Ae))return 0;if(q.v=ke,q.j=ze,q.va=ke+Ve,q.o=ze+$e,q.U=Ve,q.T=$e,q.da=D!=null&&0<D.da,q.da){if(!yr(Ve,$e,ne=[D.ib],ke=[D.hb]))return 0;q.ib=ne[0],q.hb=ke[0]}return q.ob=D!=null&&D.ob,q.Kb=D==null||!D.Sd,q.da&&(q.ob=q.ib<3*de/4&&q.hb<3*Ae/4,q.Kb=0),1}function Kl(D){if(D==null)return 2;if(11>D.S){var q=D.f.RGBA;q.fb+=(D.height-1)*q.A,q.A=-q.A}else q=D.f.kb,D=D.height,q.O+=(D-1)*q.fa,q.fa=-q.fa,q.N+=(D-1>>1)*q.Ab,q.Ab=-q.Ab,q.W+=(D-1>>1)*q.Db,q.Db=-q.Db,q.F!=null&&(q.J+=(D-1)*q.lb,q.lb=-q.lb);return 0}function tu(D,q,ne,de){if(de==null||0>=D||0>=q)return 2;if(ne!=null){if(ne.Da){var Ae=ne.cd,ke=ne.bd,ze=-2&ne.v,Ve=-2&ne.j;if(0>ze||0>Ve||0>=Ae||0>=ke||ze+Ae>D||Ve+ke>q)return 2;D=Ae,q=ke}if(ne.da){if(!yr(D,q,Ae=[ne.ib],ke=[ne.hb]))return 2;D=Ae[0],q=ke[0]}}de.width=D,de.height=q;e:{var $e=de.width,lt=de.height;if(D=de.S,0>=$e||0>=lt||!(D>=Sh&&13>D))D=2;else{if(0>=de.Rd&&de.sd==null){ze=ke=Ae=q=0;var Ze=(Ve=$e*Fu[D])*lt;if(11>D||(ke=(lt+1)/2*(q=($e+1)/2),D==12&&(ze=(Ae=$e)*lt)),(lt=g(Ze+2*ke+ze))==null){D=1;break e}de.sd=lt,11>D?(($e=de.f.RGBA).eb=lt,$e.fb=0,$e.A=Ve,$e.size=Ze):(($e=de.f.kb).y=lt,$e.O=0,$e.fa=Ve,$e.Fd=Ze,$e.f=lt,$e.N=0+Ze,$e.Ab=q,$e.Cd=ke,$e.ea=lt,$e.W=0+Ze+ke,$e.Db=q,$e.Ed=ke,D==12&&($e.F=lt,$e.J=0+Ze+2*ke),$e.Tc=ze,$e.lb=Ae)}if(q=1,Ae=de.S,ke=de.width,ze=de.height,Ae>=Sh&&13>Ae)if(11>Ae)D=de.f.RGBA,q&=(Ve=Math.abs(D.A))*(ze-1)+ke<=D.size,q&=Ve>=ke*Fu[Ae],q&=D.eb!=null;else{D=de.f.kb,Ve=(ke+1)/2,Ze=(ze+1)/2,$e=Math.abs(D.fa),lt=Math.abs(D.Ab);var tn=Math.abs(D.Db),nn=Math.abs(D.lb),qt=nn*(ze-1)+ke;q&=$e*(ze-1)+ke<=D.Fd,q&=lt*(Ze-1)+Ve<=D.Cd,q=(q&=tn*(Ze-1)+Ve<=D.Ed)&$e>=ke&lt>=Ve&tn>=Ve,q&=D.y!=null,q&=D.f!=null,q&=D.ea!=null,Ae==12&&(q&=nn>=ke,q&=qt<=D.Tc,q&=D.F!=null)}else q=0;D=q?0:2}}return D!=0||ne!=null&&ne.fd&&(D=Kl(de)),D}var Cs=64,Di=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Xl=24,un=32,nu=8,Ps=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Fn("Predictor0","PredictorAdd0"),Me.Predictor0=function(){return 4278190080},Me.Predictor1=function(D){return D},Me.Predictor2=function(D,q,ne){return q[ne+0]},Me.Predictor3=function(D,q,ne){return q[ne+1]},Me.Predictor4=function(D,q,ne){return q[ne-1]},Me.Predictor5=function(D,q,ne){return Un(Un(D,q[ne+1]),q[ne+0])},Me.Predictor6=function(D,q,ne){return Un(D,q[ne-1])},Me.Predictor7=function(D,q,ne){return Un(D,q[ne+0])},Me.Predictor8=function(D,q,ne){return Un(q[ne-1],q[ne+0])},Me.Predictor9=function(D,q,ne){return Un(q[ne+0],q[ne+1])},Me.Predictor10=function(D,q,ne){return Un(Un(D,q[ne-1]),Un(q[ne+0],q[ne+1]))},Me.Predictor11=function(D,q,ne){var de=q[ne+0];return 0>=br(de>>24&255,D>>24&255,(q=q[ne-1])>>24&255)+br(de>>16&255,D>>16&255,q>>16&255)+br(de>>8&255,D>>8&255,q>>8&255)+br(255&de,255&D,255&q)?de:D},Me.Predictor12=function(D,q,ne){var de=q[ne+0];return(pr((D>>24&255)+(de>>24&255)-((q=q[ne-1])>>24&255))<<24|pr((D>>16&255)+(de>>16&255)-(q>>16&255))<<16|pr((D>>8&255)+(de>>8&255)-(q>>8&255))<<8|pr((255&D)+(255&de)-(255&q)))>>>0},Me.Predictor13=function(D,q,ne){var de=q[ne-1];return(Ln((D=Un(D,q[ne+0]))>>24&255,de>>24&255)<<24|Ln(D>>16&255,de>>16&255)<<16|Ln(D>>8&255,de>>8&255)<<8|Ln(D>>0&255,de>>0&255))>>>0};var Zs=Me.PredictorAdd0;Me.PredictorAdd1=Kr,Fn("Predictor2","PredictorAdd2"),Fn("Predictor3","PredictorAdd3"),Fn("Predictor4","PredictorAdd4"),Fn("Predictor5","PredictorAdd5"),Fn("Predictor6","PredictorAdd6"),Fn("Predictor7","PredictorAdd7"),Fn("Predictor8","PredictorAdd8"),Fn("Predictor9","PredictorAdd9"),Fn("Predictor10","PredictorAdd10"),Fn("Predictor11","PredictorAdd11"),Fn("Predictor12","PredictorAdd12"),Fn("Predictor13","PredictorAdd13");var wh=Me.PredictorAdd2;Ur("ColorIndexInverseTransform","MapARGB","32b",function(D){return D>>8&255},function(D){return D}),Ur("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(D){return D},function(D){return D>>8&255});var Ru,Ks=Me.ColorIndexInverseTransform,xl=Me.MapARGB,bl=Me.VP8LColorIndexInverseTransformAlpha,Tc=Me.MapAlpha,Ca=Me.VP8LPredictorsAdd=[];Ca.length=16,(Me.VP8LPredictors=[]).length=16,(Me.VP8LPredictorsAdd_C=[]).length=16,(Me.VP8LPredictors_C=[]).length=16;var Du,pa,Ao,Ac,Yl,Jl,Ec,Cc,Qi,gd,Yo,Jo,Nu,ru,Qo,Pc,Ql,$a,ec,Pa,tc,nc,wl,Eo,jo,Vi,Pi,es,fs=g(511),Sl=g(2041),iu=g(225),rc=g(767),Ma=0,Tr=Sl,_d=iu,ma=rc,Co=fs,Sh=0,gf=1,Li=2,_f=3,Th=4,yd=5,yf=6,vd=7,vf=8,xd=9,Wp=10,bd=[2,3,7],wd=[3,3,11],Zp=[280,256,256,256,40],Ia=[0,1,1,1,0],Kp=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],xf=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],bf=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Xp=8,Sd=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Td=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],su=null,Yp=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Jp=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Ad=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],mg=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],gg=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Ah=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],g0=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ou=[],Tl=[],Mc=[],_0=1,_g=2,Ga=[],ga=[];fn("UpsampleRgbLinePair",Ci,3),fn("UpsampleBgrLinePair",_s,3),fn("UpsampleRgbaLinePair",Rn,4),fn("UpsampleBgraLinePair",Jn,4),fn("UpsampleArgbLinePair",vs,4),fn("UpsampleRgba4444LinePair",Ws,2),fn("UpsampleRgb565LinePair",ys,2);var Qp=Me.UpsampleRgbLinePair,Eh=Me.UpsampleBgrLinePair,em=Me.UpsampleRgbaLinePair,tm=Me.UpsampleBgraLinePair,wf=Me.UpsampleArgbLinePair,Ed=Me.UpsampleRgba4444LinePair,Ha=Me.UpsampleRgb565LinePair,Ch=16,Wa=1<<Ch-1,Ou=-227,au=482,Cd=6,yg=(256<<Cd)-1,Sf=0,Tf=g(256),vg=g(256),xg=g(256),Pd=g(256),y0=g(au-Ou),bg=g(au-Ou);Hn("YuvToRgbRow",Ci,3),Hn("YuvToBgrRow",_s,3),Hn("YuvToRgbaRow",Rn,4),Hn("YuvToBgraRow",Jn,4),Hn("YuvToArgbRow",vs,4),Hn("YuvToRgba4444Row",Ws,2),Hn("YuvToRgb565Row",ys,2);var Af=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],zu=[0,2,8],nm=[8,7,6,4,4,2,2,2,1,1,1,1],Ef=1;this.WebPDecodeRGBA=function(D,q,ne,de,Ae){var ke=gf,ze=new Aa,Ve=new as;ze.ba=Ve,Ve.S=ke,Ve.width=[Ve.width],Ve.height=[Ve.height];var $e=Ve.width,lt=Ve.height,Ze=new Ho;if(Ze==null||D==null)var tn=2;else e(Ze!=null),tn=eu(D,q,ne,Ze.width,Ze.height,Ze.Pd,Ze.Qd,Ze.format,null);if(tn!=0?$e=0:($e!=null&&($e[0]=Ze.width[0]),lt!=null&&(lt[0]=Ze.height[0]),$e=1),$e){Ve.width=Ve.width[0],Ve.height=Ve.height[0],de!=null&&(de[0]=Ve.width),Ae!=null&&(Ae[0]=Ve.height);e:{if(de=new gl,(Ae=new Ea).data=D,Ae.w=q,Ae.ha=ne,Ae.kd=1,q=[0],e(Ae!=null),((D=eu(Ae.data,Ae.w,Ae.ha,null,null,null,q,null,Ae))==0||D==7)&&q[0]&&(D=4),(q=D)==0){if(e(ze!=null),de.data=Ae.data,de.w=Ae.w+Ae.offset,de.ha=Ae.ha-Ae.offset,de.put=Dt,de.ac=Rs,de.bc=he,de.ma=ze,Ae.xa){if((D=$n())==null){ze=1;break e}if(function(nn,qt){var mn=[0],Pt=[0],Ot=[0];t:for(;;){if(nn==null)return 0;if(qt==null)return nn.a=2,0;if(nn.l=qt,nn.a=0,et(nn.m,qt.data,qt.w,qt.ha),!_e(nn.m,mn,Pt,Ot)){nn.a=3;break t}if(nn.xb=_g,qt.width=mn[0],qt.height=Pt[0],!er(mn[0],Pt[0],1,nn,null))break t;return 1}return e(nn.a!=0),0}(D,de)){if(de=(q=tu(de.width,de.height,ze.Oa,ze.ba))==0){t:{de=D;n:for(;;){if(de==null){de=0;break t}if(e(de.s.yc!=null),e(de.s.Ya!=null),e(0<de.s.Wb),e((ne=de.l)!=null),e((Ae=ne.ma)!=null),de.xb!=0){if(de.ca=Ae.ba,de.tb=Ae.tb,e(de.ca!=null),!vl(Ae.Oa,ne,_f)){de.a=2;break n}if(!or(de,ne.width)||ne.da)break n;if((ne.da||lr(de.ca.S))&&Yt(),11>de.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),de.ca.f.kb.F!=null&&Yt()),de.Pb&&0<de.s.ua&&de.s.vb.X==null&&!$t(de.s.vb,de.s.Wa.Xa)){de.a=1;break n}de.xb=0}if(!pn(de,de.V,de.Ba,de.c,de.i,ne.o,Mt))break n;Ae.Dc=de.Ma,de=1;break t}e(de.a!=0),de=0}de=!de}de&&(q=D.a)}else q=D.a}else{if((D=new ua)==null){ze=1;break e}if(D.Fa=Ae.na,D.P=Ae.P,D.qc=Ae.Sa,Eu(D,de)){if((q=tu(de.width,de.height,ze.Oa,ze.ba))==0){if(D.Aa=0,ne=ze.Oa,e((Ae=D)!=null),ne!=null){if(0<($e=0>($e=ne.Md)?0:100<$e?255:255*$e/100)){for(lt=Ze=0;4>lt;++lt)12>(tn=Ae.pb[lt]).lc&&(tn.ia=$e*nm[0>tn.lc?0:tn.lc]>>3),Ze|=tn.ia;Ze&&(alert("todo:VP8InitRandom"),Ae.ia=1)}Ae.Ga=ne.Id,100<Ae.Ga?Ae.Ga=100:0>Ae.Ga&&(Ae.Ga=0)}dd(D,de)||(q=D.a)}}else q=D.a}q==0&&ze.Oa!=null&&ze.Oa.fd&&(q=Kl(ze.ba))}ze=q}ke=ze!=0?null:11>ke?Ve.f.RGBA.eb:Ve.f.kb.y}else ke=null;return ke};var Fu=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function k(Me,it){for(var ot="",ve=0;ve<4;ve++)ot+=String.fromCharCode(Me[it++]);return ot}function O(Me,it){return(Me[it+0]<<0|Me[it+1]<<8|Me[it+2]<<16)>>>0}function z(Me,it){return(Me[it+0]<<0|Me[it+1]<<8|Me[it+2]<<16|Me[it+3]<<24)>>>0}new E;var G=[0],U=[0],ie=[],Q=new E,se=t,J=function(Me,it){var ot={},ve=0,Le=!1,dt=0,Je=0;if(ot.frames=[],!function(Re,Fe,ut,Et){for(var Ct=0;Ct<Et;Ct++)if(Re[Fe+Ct]!=ut.charCodeAt(Ct))return!0;return!1}(Me,it,"RIFF",4)){for(z(Me,it+=4),it+=8;it<Me.length;){var yt=k(Me,it),St=z(Me,it+=4);it+=4;var jt=St+(1&St);switch(yt){case"VP8 ":case"VP8L":ot.frames[ve]===void 0&&(ot.frames[ve]={}),(Xe=ot.frames[ve]).src_off=Le?Je:it-8,Xe.src_size=dt+St+8,ve++,Le&&(Le=!1,dt=0,Je=0);break;case"VP8X":(Xe=ot.header={}).feature_flags=Me[it];var et=it+4;Xe.canvas_width=1+O(Me,et),et+=3,Xe.canvas_height=1+O(Me,et),et+=3;break;case"ALPH":Le=!0,dt=jt+8,Je=it-8;break;case"ANIM":(Xe=ot.header).bgcolor=z(Me,it),et=it+4,Xe.loop_count=(Vt=Me)[(be=et)+0]<<0|Vt[be+1]<<8,et+=2;break;case"ANMF":var Qe,Xe;(Xe=ot.frames[ve]={}).offset_x=2*O(Me,it),it+=3,Xe.offset_y=2*O(Me,it),it+=3,Xe.width=1+O(Me,it),it+=3,Xe.height=1+O(Me,it),it+=3,Xe.duration=O(Me,it),it+=3,Qe=Me[it++],Xe.dispose=1&Qe,Xe.blend=Qe>>1&1}yt!="ANMF"&&(it+=jt)}var Vt,be;return ot}}(se,0);J.response=se,J.rgbaoutput=!0,J.dataurl=!1;var te=J.header?J.header:null,le=J.frames?J.frames:null;if(te){te.loop_counter=te.loop_count,G=[te.canvas_height],U=[te.canvas_width];for(var ye=0;ye<le.length&&le[ye].blend!=0;ye++);}var Ne=le[0],rt=Q.WebPDecodeRGBA(se,Ne.src_off,Ne.src_size,U,G);Ne.rgba=rt,Ne.imgwidth=U[0],Ne.imgheight=G[0];for(var xe=0;xe<U[0]*G[0]*4;xe++)ie[xe]=rt[xe];return this.width=U,this.height=G,this.data=ie,this}(function(t){var e=function(){return typeof jT=="function"},s=function(G,U,ie,Q){var se=4,J=v;switch(Q){case t.image_compression.FAST:se=1,J=g;break;case t.image_compression.MEDIUM:se=6,J=i;break;case t.image_compression.SLOW:se=9,J=E}G=a(G,U,ie,J);var te=jT(G,{level:se});return t.__addimage__.arrayBufferToBinaryString(te)},a=function(G,U,ie,Q){for(var se,J,te,le=G.length/U,ye=new Uint8Array(G.length+le),Ne=O(),rt=0;rt<le;rt+=1){if(te=rt*U,se=G.subarray(te,te+U),Q)ye.set(Q(se,ie,J),te+rt);else{for(var xe,Me=Ne.length,it=[];xe<Me;xe+=1)it[xe]=Ne[xe](se,ie,J);var ot=z(it.concat());ye.set(it[ot],te+rt)}J=se}return ye},d=function(G){var U=Array.apply([],G);return U.unshift(0),U},g=function(G,U){var ie,Q=[],se=G.length;Q[0]=1;for(var J=0;J<se;J+=1)ie=G[J-U]||0,Q[J+1]=G[J]-ie+256&255;return Q},v=function(G,U,ie){var Q,se=[],J=G.length;se[0]=2;for(var te=0;te<J;te+=1)Q=ie&&ie[te]||0,se[te+1]=G[te]-Q+256&255;return se},i=function(G,U,ie){var Q,se,J=[],te=G.length;J[0]=3;for(var le=0;le<te;le+=1)Q=G[le-U]||0,se=ie&&ie[le]||0,J[le+1]=G[le]+256-(Q+se>>>1)&255;return J},E=function(G,U,ie){var Q,se,J,te,le=[],ye=G.length;le[0]=4;for(var Ne=0;Ne<ye;Ne+=1)Q=G[Ne-U]||0,se=ie&&ie[Ne]||0,J=ie&&ie[Ne-U]||0,te=k(Q,se,J),le[Ne+1]=G[Ne]-te+256&255;return le},k=function(G,U,ie){if(G===U&&U===ie)return G;var Q=Math.abs(U-ie),se=Math.abs(G-ie),J=Math.abs(G+U-ie-ie);return Q<=se&&Q<=J?G:se<=J?U:ie},O=function(){return[d,g,v,i,E]},z=function(G){var U=G.map(function(ie){return ie.reduce(function(Q,se){return Q+Math.abs(se)},0)});return U.indexOf(Math.min.apply(null,U))};t.processPNG=function(G,U,ie,Q){var se,J,te,le,ye,Ne,rt,xe,Me,it,ot,ve,Le,dt,Je,yt=this.decode.FLATE_DECODE,St="";if(this.__addimage__.isArrayBuffer(G)&&(G=new Uint8Array(G)),this.__addimage__.isArrayBufferView(G)){if(G=(te=new bZ(G)).imgData,J=te.bits,se=te.colorSpace,ye=te.colors,[4,6].indexOf(te.colorType)!==-1){if(te.bits===8){Me=(xe=te.pixelBitlength==32?new Uint32Array(te.decodePixels().buffer):te.pixelBitlength==16?new Uint16Array(te.decodePixels().buffer):new Uint8Array(te.decodePixels().buffer)).length,ot=new Uint8Array(Me*te.colors),it=new Uint8Array(Me);var jt,et=te.pixelBitlength-te.bits;for(dt=0,Je=0;dt<Me;dt++){for(Le=xe[dt],jt=0;jt<et;)ot[Je++]=Le>>>jt&255,jt+=te.bits;it[dt]=Le>>>jt&255}}if(te.bits===16){Me=(xe=new Uint32Array(te.decodePixels().buffer)).length,ot=new Uint8Array(Me*(32/te.pixelBitlength)*te.colors),it=new Uint8Array(Me*(32/te.pixelBitlength)),ve=te.colors>1,dt=0,Je=0;for(var Qe=0;dt<Me;)Le=xe[dt++],ot[Je++]=Le>>>0&255,ve&&(ot[Je++]=Le>>>16&255,Le=xe[dt++],ot[Je++]=Le>>>0&255),it[Qe++]=Le>>>16&255;J=8}Q!==t.image_compression.NONE&&e()?(G=s(ot,te.width*te.colors,te.colors,Q),rt=s(it,te.width,1,Q)):(G=ot,rt=it,yt=void 0)}if(te.colorType===3&&(se=this.color_spaces.INDEXED,Ne=te.palette,te.transparency.indexed)){var Xe=te.transparency.indexed,Vt=0;for(dt=0,Me=Xe.length;dt<Me;++dt)Vt+=Xe[dt];if((Vt/=255)===Me-1&&Xe.indexOf(0)!==-1)le=[Xe.indexOf(0)];else if(Vt!==Me){for(xe=te.decodePixels(),it=new Uint8Array(xe.length),dt=0,Me=xe.length;dt<Me;dt++)it[dt]=Xe[xe[dt]];rt=s(it,te.width,1)}}var be=function(Re){var Fe;switch(Re){case t.image_compression.FAST:Fe=11;break;case t.image_compression.MEDIUM:Fe=13;break;case t.image_compression.SLOW:Fe=14;break;default:Fe=12}return Fe}(Q);return yt===this.decode.FLATE_DECODE&&(St="/Predictor "+be+" "),St+="/Colors "+ye+" /BitsPerComponent "+J+" /Columns "+te.width,(this.__addimage__.isArrayBuffer(G)||this.__addimage__.isArrayBufferView(G))&&(G=this.__addimage__.arrayBufferToBinaryString(G)),(rt&&this.__addimage__.isArrayBuffer(rt)||this.__addimage__.isArrayBufferView(rt))&&(rt=this.__addimage__.arrayBufferToBinaryString(rt)),{alias:ie,data:G,index:U,filter:yt,decodeParameters:St,transparency:le,palette:Ne,sMask:rt,predictor:be,width:te.width,height:te.height,bitsPerComponent:J,colorSpace:se}}}})(Qr.API),function(t){t.processGIF89A=function(e,s,a,d){var g=new wZ(e),v=g.width,i=g.height,E=[];g.decodeAndBlitFrameRGBA(0,E);var k={data:E,width:v,height:i},O=new Q5(100).encode(k,100);return t.processJPEG.call(this,O,s,a,d)},t.processGIF87A=t.processGIF89A}(Qr.API),th.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),g=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:d,green:a,blue:s,quad:g}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},th.prototype.parseBGR=function(){this.pos=this.offset;try{var t="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[t]()}catch(s){Ts.log("bit decode error:"+s)}},th.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),s=e%4;for(t=this.height-1;t>=0;t--){for(var a=this.bottom_up?t:this.height-1-t,d=0;d<e;d++)for(var g=this.datav.getUint8(this.pos++,!0),v=a*this.width*4+8*d*4,i=0;i<8&&8*d+i<this.width;i++){var E=this.palette[g>>7-i&1];this.data[v+4*i]=E.blue,this.data[v+4*i+1]=E.green,this.data[v+4*i+2]=E.red,this.data[v+4*i+3]=255}s!==0&&(this.pos+=4-s)}},th.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,s=this.height-1;s>=0;s--){for(var a=this.bottom_up?s:this.height-1-s,d=0;d<t;d++){var g=this.datav.getUint8(this.pos++,!0),v=a*this.width*4+2*d*4,i=g>>4,E=15&g,k=this.palette[i];if(this.data[v]=k.blue,this.data[v+1]=k.green,this.data[v+2]=k.red,this.data[v+3]=255,2*d+1>=this.width)break;k=this.palette[E],this.data[v+4]=k.blue,this.data[v+4+1]=k.green,this.data[v+4+2]=k.red,this.data[v+4+3]=255}e!==0&&(this.pos+=4-e)}},th.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var s=this.bottom_up?e:this.height-1-e,a=0;a<this.width;a++){var d=this.datav.getUint8(this.pos++,!0),g=s*this.width*4+4*a;if(d<this.palette.length){var v=this.palette[d];this.data[g]=v.red,this.data[g+1]=v.green,this.data[g+2]=v.blue,this.data[g+3]=255}else this.data[g]=255,this.data[g+1]=255,this.data[g+2]=255,this.data[g+3]=255}t!==0&&(this.pos+=4-t)}},th.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),s=this.height-1;s>=0;s--){for(var a=this.bottom_up?s:this.height-1-s,d=0;d<this.width;d++){var g=this.datav.getUint16(this.pos,!0);this.pos+=2;var v=(g&e)/e*255|0,i=(g>>5&e)/e*255|0,E=(g>>10&e)/e*255|0,k=g>>15?255:0,O=a*this.width*4+4*d;this.data[O]=E,this.data[O+1]=i,this.data[O+2]=v,this.data[O+3]=k}this.pos+=t}},th.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),s=parseInt("111111",2),a=this.height-1;a>=0;a--){for(var d=this.bottom_up?a:this.height-1-a,g=0;g<this.width;g++){var v=this.datav.getUint16(this.pos,!0);this.pos+=2;var i=(v&e)/e*255|0,E=(v>>5&s)/s*255|0,k=(v>>11)/e*255|0,O=d*this.width*4+4*g;this.data[O]=k,this.data[O+1]=E,this.data[O+2]=i,this.data[O+3]=255}this.pos+=t}},th.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,s=0;s<this.width;s++){var a=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),g=this.datav.getUint8(this.pos++,!0),v=e*this.width*4+4*s;this.data[v]=g,this.data[v+1]=d,this.data[v+2]=a,this.data[v+3]=255}this.pos+=this.width%4}},th.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,s=0;s<this.width;s++){var a=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),g=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),i=e*this.width*4+4*s;this.data[i]=g,this.data[i+1]=d,this.data[i+2]=a,this.data[i+3]=v}},th.prototype.getData=function(){return this.data},function(t){t.processBMP=function(e,s,a,d){var g=new th(e,!1),v=g.width,i=g.height,E={data:g.getData(),width:v,height:i},k=new Q5(100).encode(E,100);return t.processJPEG.call(this,k,s,a,d)}}(Qr.API),uL.prototype.getData=function(){return this.data},function(t){t.processWEBP=function(e,s,a,d){var g=new uL(e),v=g.width,i=g.height,E={data:g.getData(),width:v,height:i},k=new Q5(100).encode(E,100);return t.processJPEG.call(this,k,s,a,d)}}(Qr.API),Qr.API.processRGBA=function(t,e,s){for(var a=t.data,d=a.length,g=new Uint8Array(d/4*3),v=new Uint8Array(d/4),i=0,E=0,k=0;k<d;k+=4){var O=a[k],z=a[k+1],G=a[k+2],U=a[k+3];g[i++]=O,g[i++]=z,g[i++]=G,v[E++]=U}var ie=this.__addimage__.arrayBufferToBinaryString(g);return{alpha:this.__addimage__.arrayBufferToBinaryString(v),data:ie,index:e,alias:s,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},Qr.API.setLanguage=function(t){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]!==void 0&&(this.internal.languageSettings.languageCode=t,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Jg=Qr.API,bx=Jg.getCharWidthsArray=function(t,e){var s,a,d=(e=e||{}).font||this.internal.getFont(),g=e.fontSize||this.internal.getFontSize(),v=e.charSpace||this.internal.getCharSpace(),i=e.widths?e.widths:d.metadata.Unicode.widths,E=i.fof?i.fof:1,k=e.kerning?e.kerning:d.metadata.Unicode.kerning,O=k.fof?k.fof:1,z=e.doKerning!==!1,G=0,U=t.length,ie=0,Q=i[0]||E,se=[];for(s=0;s<U;s++)a=t.charCodeAt(s),typeof d.metadata.widthOfString=="function"?se.push((d.metadata.widthOfGlyph(d.metadata.characterToGlyph(a))+v*(1e3/g)||0)/1e3):(G=z&&cs(k[a])==="object"&&!isNaN(parseInt(k[a][ie],10))?k[a][ie]/O:0,se.push((i[a]||Q)/E+G)),ie=a;return se},oL=Jg.getStringUnitWidth=function(t,e){var s=(e=e||{}).fontSize||this.internal.getFontSize(),a=e.font||this.internal.getFont(),d=e.charSpace||this.internal.getCharSpace();return Jg.processArabic&&(t=Jg.processArabic(t)),typeof a.metadata.widthOfString=="function"?a.metadata.widthOfString(t,s,d)/s:bx.apply(this,arguments).reduce(function(g,v){return g+v},0)},aL=function(t,e,s,a){for(var d=[],g=0,v=t.length,i=0;g!==v&&i+e[g]<s;)i+=e[g],g++;d.push(t.slice(0,g));var E=g;for(i=0;g!==v;)i+e[g]>a&&(d.push(t.slice(E,g)),i=0,E=g),i+=e[g],g++;return E!==g&&d.push(t.slice(E,g)),d},lL=function(t,e,s){s||(s={});var a,d,g,v,i,E,k,O=[],z=[O],G=s.textIndent||0,U=0,ie=0,Q=t.split(" "),se=bx.apply(this,[" ",s])[0];if(E=s.lineIndent===-1?Q[0].length+2:s.lineIndent||0){var J=Array(E).join(" "),te=[];Q.map(function(ye){(ye=ye.split(/\s*\n/)).length>1?te=te.concat(ye.map(function(Ne,rt){return(rt&&Ne.length?`
`:"")+Ne})):te.push(ye[0])}),Q=te,E=oL.apply(this,[J,s])}for(g=0,v=Q.length;g<v;g++){var le=0;if(a=Q[g],E&&a[0]==`
`&&(a=a.substr(1),le=1),G+U+(ie=(d=bx.apply(this,[a,s])).reduce(function(ye,Ne){return ye+Ne},0))>e||le){if(ie>e){for(i=aL.apply(this,[a,d,e-(G+U),e]),O.push(i.shift()),O=[i.pop()];i.length;)z.push([i.shift()]);ie=d.slice(a.length-(O[0]?O[0].length:0)).reduce(function(ye,Ne){return ye+Ne},0)}else O=[a];z.push(O),G=ie+E,U=se}else O.push(a),G+=U+ie,U=se}return k=E?function(ye,Ne){return(Ne?J:"")+ye.join(" ")}:function(ye){return ye.join(" ")},z.map(k)},Jg.splitTextToSize=function(t,e,s){var a,d=(s=s||{}).fontSize||this.internal.getFontSize(),g=(function(O){if(O.widths&&O.kerning)return{widths:O.widths,kerning:O.kerning};var z=this.internal.getFont(O.fontName,O.fontStyle);return z.metadata.Unicode?{widths:z.metadata.Unicode.widths||{0:1},kerning:z.metadata.Unicode.kerning||{}}:{font:z.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,s);a=Array.isArray(t)?t:String(t).split(/\r?\n/);var v=1*this.internal.scaleFactor*e/d;g.textIndent=s.textIndent?1*s.textIndent*this.internal.scaleFactor/d:0,g.lineIndent=s.lineIndent;var i,E,k=[];for(i=0,E=a.length;i<E;i++)k=k.concat(lL.apply(this,[a[i],v,g]));return k},function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",s={},a={},d=0;d<e.length;d++)s[e[d]]="0123456789abcdef"[d],a["0123456789abcdef"[d]]=e[d];var g=function(z){return"0x"+parseInt(z,10).toString(16)},v=t.__fontmetrics__.compress=function(z){var G,U,ie,Q,se=["{"];for(var J in z){if(G=z[J],isNaN(parseInt(J,10))?U="'"+J+"'":(J=parseInt(J,10),U=(U=g(J).slice(2)).slice(0,-1)+a[U.slice(-1)]),typeof G=="number")G<0?(ie=g(G).slice(3),Q="-"):(ie=g(G).slice(2),Q=""),ie=Q+ie.slice(0,-1)+a[ie.slice(-1)];else{if(cs(G)!=="object")throw new Error("Don't know what to do with value type "+cs(G)+".");ie=v(G)}se.push(U+ie)}return se.push("}"),se.join("")},i=t.__fontmetrics__.uncompress=function(z){if(typeof z!="string")throw new Error("Invalid argument passed to uncompress.");for(var G,U,ie,Q,se={},J=1,te=se,le=[],ye="",Ne="",rt=z.length-1,xe=1;xe<rt;xe+=1)(Q=z[xe])=="'"?G?(ie=G.join(""),G=void 0):G=[]:G?G.push(Q):Q=="{"?(le.push([te,ie]),te={},ie=void 0):Q=="}"?((U=le.pop())[0][U[1]]=te,ie=void 0,te=U[0]):Q=="-"?J=-1:ie===void 0?s.hasOwnProperty(Q)?(ye+=s[Q],ie=parseInt(ye,16)*J,J=1,ye=""):ye+=Q:s.hasOwnProperty(Q)?(Ne+=s[Q],te[ie]=parseInt(Ne,16)*J,J=1,ie=void 0,Ne=""):Ne+=Q;return se},E={codePages:["WinAnsiEncoding"],WinAnsiEncoding:i("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},k={Unicode:{Courier:E,"Courier-Bold":E,"Courier-BoldOblique":E,"Courier-Oblique":E,Helvetica:E,"Helvetica-Bold":E,"Helvetica-BoldOblique":E,"Helvetica-Oblique":E,"Times-Roman":E,"Times-Bold":E,"Times-BoldItalic":E,"Times-Italic":E}},O={Unicode:{"Courier-Oblique":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":i("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":i("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":i("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:i("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:i("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":i("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:i("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":i("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":i("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":i("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(z){var G=z.font,U=O.Unicode[G.postScriptName];U&&(G.metadata.Unicode={},G.metadata.Unicode.widths=U.widths,G.metadata.Unicode.kerning=U.kerning);var ie=k.Unicode[G.postScriptName];ie&&(G.metadata.Unicode.encoding=ie,G.encoding=ie.codePages[0])}])}(Qr.API),function(t){var e=function(s){for(var a=s.length,d=new Uint8Array(a),g=0;g<a;g++)d[g]=s.charCodeAt(g);return d};t.API.events.push(["addFont",function(s){var a=void 0,d=s.font,g=s.instance;if(!d.isStandardFont){if(g===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+d.postScriptName+"').");if(typeof(a=g.existsFileInVFS(d.postScriptName)===!1?g.loadFile(d.postScriptName):g.getFileFromVFS(d.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+d.postScriptName+"').");(function(v,i){i=/^\x00\x01\x00\x00/.test(i)?e(i):e(qy(i)),v.metadata=t.API.TTFFont.open(i),v.metadata.Unicode=v.metadata.Unicode||{encoding:{},kerning:{},widths:[]},v.metadata.glyIdsUsed=[0]})(d,a)}}])}(Qr),function(t){function e(){return(ei.canvg?Promise.resolve(ei.canvg):ad(()=>import("./index.es-DbeSBHoN.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load canvg: "+s))}).then(function(s){return s.default?s.default:s})}Qr.API.addSvgAsImage=function(s,a,d,g,v,i,E,k){if(isNaN(a)||isNaN(d))throw Ts.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(g)||isNaN(v))throw Ts.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var O=document.createElement("canvas");O.width=g,O.height=v;var z=O.getContext("2d");z.fillStyle="#fff",z.fillRect(0,0,O.width,O.height);var G={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},U=this;return e().then(function(ie){return ie.fromString(z,s,G)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(ie){return ie.render(G)}).then(function(){U.addImage(O.toDataURL("image/jpeg",1),a,d,g,v,E,k)})}}(),Qr.API.putTotalPages=function(t){var e,s=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),s=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),s=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var a=1;a<=this.internal.getNumberOfPages();a++)for(var d=0;d<this.internal.pages[a].length;d++)this.internal.pages[a][d]=this.internal.pages[a][d].replace(e,s);return this},Qr.API.viewerPreferences=function(t,e){var s;t=t||{},e=e||!1;var a,d,g,v={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},i=Object.keys(v),E=[],k=0,O=0,z=0;function G(ie,Q){var se,J=!1;for(se=0;se<ie.length;se+=1)ie[se]===Q&&(J=!0);return J}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(v)),this.internal.viewerpreferences.isSubscribed=!1),s=this.internal.viewerpreferences.configuration,t==="reset"||e===!0){var U=i.length;for(z=0;z<U;z+=1)s[i[z]].value=s[i[z]].defaultValue,s[i[z]].explicitSet=!1}if(cs(t)==="object"){for(d in t)if(g=t[d],G(i,d)&&g!==void 0){if(s[d].type==="boolean"&&typeof g=="boolean")s[d].value=g;else if(s[d].type==="name"&&G(s[d].valueSet,g))s[d].value=g;else if(s[d].type==="integer"&&Number.isInteger(g))s[d].value=g;else if(s[d].type==="array"){for(k=0;k<g.length;k+=1)if(a=!0,g[k].length===1&&typeof g[k][0]=="number")E.push(String(g[k]-1));else if(g[k].length>1){for(O=0;O<g[k].length;O+=1)typeof g[k][O]!="number"&&(a=!1);a===!0&&E.push([g[k][0]-1,g[k][1]-1].join(" "))}s[d].value="["+E.join(" ")+"]"}else s[d].value=s[d].defaultValue;s[d].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var ie,Q=[];for(ie in s)s[ie].explicitSet===!0&&(s[ie].type==="name"?Q.push("/"+ie+" /"+s[ie].value):Q.push("/"+ie+" "+s[ie].value));Q.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+Q.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=s,this},function(t){var e=function(){var a='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',d=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),g=unescape(encodeURIComponent(a)),v=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),i=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),E=unescape(encodeURIComponent("</x:xmpmeta>")),k=g.length+v.length+i.length+d.length+E.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+k+" >>"),this.internal.write("stream"),this.internal.write(d+g+v+i+E),this.internal.write("endstream"),this.internal.write("endobj")},s=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};t.addMetadata=function(a,d){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:a,namespaceuri:d||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",s),this.internal.events.subscribe("postPutResources",e)),this}}(Qr.API),function(t){var e=t.API,s=e.pdfEscape16=function(g,v){for(var i,E=v.metadata.Unicode.widths,k=["","0","00","000","0000"],O=[""],z=0,G=g.length;z<G;++z){if(i=v.metadata.characterToGlyph(g.charCodeAt(z)),v.metadata.glyIdsUsed.push(i),v.metadata.toUnicode[i]=g.charCodeAt(z),E.indexOf(i)==-1&&(E.push(i),E.push([parseInt(v.metadata.widthOfGlyph(i),10)])),i=="0")return O.join("");i=i.toString(16),O.push(k[4-i.length],i)}return O.join("")},a=function(g){var v,i,E,k,O,z,G;for(O=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,E=[],z=0,G=(i=Object.keys(g).sort(function(U,ie){return U-ie})).length;z<G;z++)v=i[z],E.length>=100&&(O+=`
`+E.length+` beginbfchar
`+E.join(`
`)+`
endbfchar`,E=[]),g[v]!==void 0&&g[v]!==null&&typeof g[v].toString=="function"&&(k=("0000"+g[v].toString(16)).slice(-4),v=("0000"+(+v).toString(16)).slice(-4),E.push("<"+v+"><"+k+">"));return E.length&&(O+=`
`+E.length+` beginbfchar
`+E.join(`
`)+`
endbfchar
`),O+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(g){(function(v){var i=v.font,E=v.out,k=v.newObject,O=v.putStream;if(i.metadata instanceof t.API.TTFFont&&i.encoding==="Identity-H"){for(var z=i.metadata.Unicode.widths,G=i.metadata.subset.encode(i.metadata.glyIdsUsed,1),U="",ie=0;ie<G.length;ie++)U+=String.fromCharCode(G[ie]);var Q=k();O({data:U,addLength1:!0,objectId:Q}),E("endobj");var se=k();O({data:a(i.metadata.toUnicode),addLength1:!0,objectId:se}),E("endobj");var J=k();E("<<"),E("/Type /FontDescriptor"),E("/FontName /"+r_(i.fontName)),E("/FontFile2 "+Q+" 0 R"),E("/FontBBox "+t.API.PDFObject.convert(i.metadata.bbox)),E("/Flags "+i.metadata.flags),E("/StemV "+i.metadata.stemV),E("/ItalicAngle "+i.metadata.italicAngle),E("/Ascent "+i.metadata.ascender),E("/Descent "+i.metadata.decender),E("/CapHeight "+i.metadata.capHeight),E(">>"),E("endobj");var te=k();E("<<"),E("/Type /Font"),E("/BaseFont /"+r_(i.fontName)),E("/FontDescriptor "+J+" 0 R"),E("/W "+t.API.PDFObject.convert(z)),E("/CIDToGIDMap /Identity"),E("/DW 1000"),E("/Subtype /CIDFontType2"),E("/CIDSystemInfo"),E("<<"),E("/Supplement 0"),E("/Registry (Adobe)"),E("/Ordering ("+i.encoding+")"),E(">>"),E(">>"),E("endobj"),i.objectNumber=k(),E("<<"),E("/Type /Font"),E("/Subtype /Type0"),E("/ToUnicode "+se+" 0 R"),E("/BaseFont /"+r_(i.fontName)),E("/Encoding /"+i.encoding),E("/DescendantFonts ["+te+" 0 R]"),E(">>"),E("endobj"),i.isAlreadyPutted=!0}})(g)}]),e.events.push(["putFont",function(g){(function(v){var i=v.font,E=v.out,k=v.newObject,O=v.putStream;if(i.metadata instanceof t.API.TTFFont&&i.encoding==="WinAnsiEncoding"){for(var z=i.metadata.rawData,G="",U=0;U<z.length;U++)G+=String.fromCharCode(z[U]);var ie=k();O({data:G,addLength1:!0,objectId:ie}),E("endobj");var Q=k();O({data:a(i.metadata.toUnicode),addLength1:!0,objectId:Q}),E("endobj");var se=k();E("<<"),E("/Descent "+i.metadata.decender),E("/CapHeight "+i.metadata.capHeight),E("/StemV "+i.metadata.stemV),E("/Type /FontDescriptor"),E("/FontFile2 "+ie+" 0 R"),E("/Flags 96"),E("/FontBBox "+t.API.PDFObject.convert(i.metadata.bbox)),E("/FontName /"+r_(i.fontName)),E("/ItalicAngle "+i.metadata.italicAngle),E("/Ascent "+i.metadata.ascender),E(">>"),E("endobj"),i.objectNumber=k();for(var J=0;J<i.metadata.hmtx.widths.length;J++)i.metadata.hmtx.widths[J]=parseInt(i.metadata.hmtx.widths[J]*(1e3/i.metadata.head.unitsPerEm));E("<</Subtype/TrueType/Type/Font/ToUnicode "+Q+" 0 R/BaseFont/"+r_(i.fontName)+"/FontDescriptor "+se+" 0 R/Encoding/"+i.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(i.metadata.hmtx.widths)+">>"),E("endobj"),i.isAlreadyPutted=!0}})(g)}]);var d=function(g){var v,i=g.text||"",E=g.x,k=g.y,O=g.options||{},z=g.mutex||{},G=z.pdfEscape,U=z.activeFontKey,ie=z.fonts,Q=U,se="",J=0,te="",le=ie[Q].encoding;if(ie[Q].encoding!=="Identity-H")return{text:i,x:E,y:k,options:O,mutex:z};for(te=i,Q=U,Array.isArray(i)&&(te=i[0]),J=0;J<te.length;J+=1)ie[Q].metadata.hasOwnProperty("cmap")&&(v=ie[Q].metadata.cmap.unicode.codeMap[te[J].charCodeAt(0)]),v||te[J].charCodeAt(0)<256&&ie[Q].metadata.hasOwnProperty("Unicode")?se+=te[J]:se+="";var ye="";return parseInt(Q.slice(1))<14||le==="WinAnsiEncoding"?ye=G(se,Q).split("").map(function(Ne){return Ne.charCodeAt(0).toString(16)}).join(""):le==="Identity-H"&&(ye=s(se,ie[Q])),z.isHex=!0,{text:ye,x:E,y:k,options:O,mutex:z}};e.events.push(["postProcessText",function(g){var v=g.text||"",i=[],E={text:v,x:g.x,y:g.y,options:g.options,mutex:g.mutex};if(Array.isArray(v)){var k=0;for(k=0;k<v.length;k+=1)Array.isArray(v[k])&&v[k].length===3?i.push([d(Object.assign({},E,{text:v[k][0]})).text,v[k][1],v[k][2]]):i.push(d(Object.assign({},E,{text:v[k]})).text);g.text=i}else g.text=d(Object.assign({},E,{text:v})).text}])}(Qr),function(t){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(s){return e.call(this),this.internal.vFS[s]!==void 0},t.addFileToVFS=function(s,a){return e.call(this),this.internal.vFS[s]=a,this},t.getFileFromVFS=function(s){return e.call(this),this.internal.vFS[s]!==void 0?this.internal.vFS[s]:null}}(Qr.API),function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(a){var d,g,v,i,E,k,O,z=e,G=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],U=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ie={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},Q={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},se=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],J=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),te=!1,le=0;this.__bidiEngine__={};var ye=function(ve){var Le=ve.charCodeAt(),dt=Le>>8,Je=Q[dt];return Je!==void 0?z[256*Je+(255&Le)]:dt===252||dt===253?"AL":J.test(dt)?"L":dt===8?"R":"N"},Ne=function(ve){for(var Le,dt=0;dt<ve.length;dt++){if((Le=ye(ve.charAt(dt)))==="L")return!1;if(Le==="R")return!0}return!1},rt=function(ve,Le,dt,Je){var yt,St,jt,et,Qe=Le[Je];switch(Qe){case"L":case"R":te=!1;break;case"N":case"AN":break;case"EN":te&&(Qe="AN");break;case"AL":te=!0,Qe="R";break;case"WS":Qe="N";break;case"CS":Je<1||Je+1>=Le.length||(yt=dt[Je-1])!=="EN"&&yt!=="AN"||(St=Le[Je+1])!=="EN"&&St!=="AN"?Qe="N":te&&(St="AN"),Qe=St===yt?St:"N";break;case"ES":Qe=(yt=Je>0?dt[Je-1]:"B")==="EN"&&Je+1<Le.length&&Le[Je+1]==="EN"?"EN":"N";break;case"ET":if(Je>0&&dt[Je-1]==="EN"){Qe="EN";break}if(te){Qe="N";break}for(jt=Je+1,et=Le.length;jt<et&&Le[jt]==="ET";)jt++;Qe=jt<et&&Le[jt]==="EN"?"EN":"N";break;case"NSM":if(v&&!i){for(et=Le.length,jt=Je+1;jt<et&&Le[jt]==="NSM";)jt++;if(jt<et){var Xe=ve[Je],Vt=Xe>=1425&&Xe<=2303||Xe===64286;if(yt=Le[jt],Vt&&(yt==="R"||yt==="AL")){Qe="R";break}}}Qe=Je<1||(yt=Le[Je-1])==="B"?"N":dt[Je-1];break;case"B":te=!1,d=!0,Qe=le;break;case"S":g=!0,Qe="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":te=!1;break;case"BN":Qe="N"}return Qe},xe=function(ve,Le,dt){var Je=ve.split("");return dt&&Me(Je,dt,{hiLevel:le}),Je.reverse(),Le&&Le.reverse(),Je.join("")},Me=function(ve,Le,dt){var Je,yt,St,jt,et,Qe=-1,Xe=ve.length,Vt=0,be=[],Re=le?U:G,Fe=[];for(te=!1,d=!1,g=!1,yt=0;yt<Xe;yt++)Fe[yt]=ye(ve[yt]);for(St=0;St<Xe;St++){if(et=Vt,be[St]=rt(ve,Fe,be,St),Je=240&(Vt=Re[et][ie[be[St]]]),Vt&=15,Le[St]=jt=Re[Vt][5],Je>0)if(Je===16){for(yt=Qe;yt<St;yt++)Le[yt]=1;Qe=-1}else Qe=-1;if(Re[Vt][6])Qe===-1&&(Qe=St);else if(Qe>-1){for(yt=Qe;yt<St;yt++)Le[yt]=jt;Qe=-1}Fe[St]==="B"&&(Le[St]=0),dt.hiLevel|=jt}g&&function(ut,Et,Ct){for(var Wt=0;Wt<Ct;Wt++)if(ut[Wt]==="S"){Et[Wt]=le;for(var Ft=Wt-1;Ft>=0&&ut[Ft]==="WS";Ft--)Et[Ft]=le}}(Fe,Le,Xe)},it=function(ve,Le,dt,Je,yt){if(!(yt.hiLevel<ve)){if(ve===1&&le===1&&!d)return Le.reverse(),void(dt&&dt.reverse());for(var St,jt,et,Qe,Xe=Le.length,Vt=0;Vt<Xe;){if(Je[Vt]>=ve){for(et=Vt+1;et<Xe&&Je[et]>=ve;)et++;for(Qe=Vt,jt=et-1;Qe<jt;Qe++,jt--)St=Le[Qe],Le[Qe]=Le[jt],Le[jt]=St,dt&&(St=dt[Qe],dt[Qe]=dt[jt],dt[jt]=St);Vt=et}Vt++}}},ot=function(ve,Le,dt){var Je=ve.split(""),yt={hiLevel:le};return dt||(dt=[]),Me(Je,dt,yt),function(St,jt,et){if(et.hiLevel!==0&&O)for(var Qe,Xe=0;Xe<St.length;Xe++)jt[Xe]===1&&(Qe=se.indexOf(St[Xe]))>=0&&(St[Xe]=se[Qe+1])}(Je,dt,yt),it(2,Je,Le,dt,yt),it(1,Je,Le,dt,yt),Je.join("")};return this.__bidiEngine__.doBidiReorder=function(ve,Le,dt){if(function(yt,St){if(St)for(var jt=0;jt<yt.length;jt++)St[jt]=jt;i===void 0&&(i=Ne(yt)),k===void 0&&(k=Ne(yt))}(ve,Le),v||!E||k)if(v&&E&&i^k)le=i?1:0,ve=xe(ve,Le,dt);else if(!v&&E&&k)le=i?1:0,ve=ot(ve,Le,dt),ve=xe(ve,Le);else if(!v||i||E||k){if(v&&!E&&i^k)ve=xe(ve,Le),i?(le=0,ve=ot(ve,Le,dt)):(le=1,ve=ot(ve,Le,dt),ve=xe(ve,Le));else if(v&&i&&!E&&k)le=1,ve=ot(ve,Le,dt),ve=xe(ve,Le);else if(!v&&!E&&i^k){var Je=O;i?(le=1,ve=ot(ve,Le,dt),le=0,O=!1,ve=ot(ve,Le,dt),O=Je):(le=0,ve=ot(ve,Le,dt),ve=xe(ve,Le),le=1,O=!1,ve=ot(ve,Le,dt),O=Je,ve=xe(ve,Le))}}else le=0,ve=ot(ve,Le,dt);else le=i?1:0,ve=ot(ve,Le,dt);return ve},this.__bidiEngine__.setOptions=function(ve){ve&&(v=ve.isInputVisual,E=ve.isOutputVisual,i=ve.isInputRtl,k=ve.isOutputRtl,O=ve.isSymmetricSwapping)},this.__bidiEngine__.setOptions(a),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],s=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(a){var d=a.text;a.x,a.y;var g=a.options||{};a.mutex,g.lang;var v=[];if(g.isInputVisual=typeof g.isInputVisual!="boolean"||g.isInputVisual,s.setOptions(g),Object.prototype.toString.call(d)==="[object Array]"){var i=0;for(v=[],i=0;i<d.length;i+=1)Object.prototype.toString.call(d[i])==="[object Array]"?v.push([s.doBidiReorder(d[i][0]),d[i][1],d[i][2]]):v.push([s.doBidiReorder(d[i])]);a.text=v}else a.text=s.doBidiReorder(d);s.setOptions({isInputVisual:!0})}])}(Qr),Qr.API.TTFFont=function(){function t(e){var s;if(this.rawData=e,s=this.contents=new Fp(e),this.contents.pos=4,s.readString(4)==="ttcf")throw new Error("TTCF not supported.");s.pos=0,this.parse(),this.subset=new zZ(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new SZ(this.contents),this.head=new AZ(this),this.name=new IZ(this),this.cmap=new gz(this),this.toUnicode={},this.hhea=new EZ(this),this.maxp=new LZ(this),this.hmtx=new kZ(this),this.post=new PZ(this),this.os2=new CZ(this),this.loca=new OZ(this),this.glyf=new RZ(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var e,s,a,d,g;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var v,i,E,k;for(k=[],v=0,i=(E=this.bbox).length;v<i;v++)e=E[v],k.push(Math.round(e*this.scaleFactor));return k}).call(this),this.stemV=0,this.post.exists?(a=255&(d=this.post.italic_angle),32768&(s=d>>16)&&(s=-(1+(65535^s))),this.italicAngle=+(s+"."+a)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(g=this.familyClass)===1||g===2||g===3||g===4||g===5||g===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(e){var s;return((s=this.cmap.unicode)!=null?s.codeMap[e]:void 0)||0},t.prototype.widthOfGlyph=function(e){var s;return s=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*s},t.prototype.widthOfString=function(e,s,a){var d,g,v,i;for(v=0,g=0,i=(e=""+e).length;0<=i?g<i:g>i;g=0<=i?++g:--g)d=e.charCodeAt(g),v+=this.widthOfGlyph(this.characterToGlyph(d))+a*(1e3/s)||0;return v*(s/1e3)},t.prototype.lineHeight=function(e,s){var a;return s==null&&(s=!1),a=s?this.lineGap:0,(this.ascender+a-this.decender)/1e3*e},t}();var gh,Fp=function(){function t(e){this.data=e??[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(e){return this.data[this.pos++]=e},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},t.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},t.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},t.prototype.readString=function(e){var s,a;for(a=[],s=0;0<=e?s<e:s>e;s=0<=e?++s:--s)a[s]=String.fromCharCode(this.readByte());return a.join("")},t.prototype.writeString=function(e){var s,a,d;for(d=[],s=0,a=e.length;0<=a?s<a:s>a;s=0<=a?++s:--s)d.push(this.writeByte(e.charCodeAt(s)));return d},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(e){return this.writeInt16(e)},t.prototype.readLongLong=function(){var e,s,a,d,g,v,i,E;return e=this.readByte(),s=this.readByte(),a=this.readByte(),d=this.readByte(),g=this.readByte(),v=this.readByte(),i=this.readByte(),E=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^s)+1099511627776*(255^a)+4294967296*(255^d)+16777216*(255^g)+65536*(255^v)+256*(255^i)+(255^E)+1):72057594037927940*e+281474976710656*s+1099511627776*a+4294967296*d+16777216*g+65536*v+256*i+E},t.prototype.writeLongLong=function(e){var s,a;return s=Math.floor(e/4294967296),a=4294967295&e,this.writeByte(s>>24&255),this.writeByte(s>>16&255),this.writeByte(s>>8&255),this.writeByte(255&s),this.writeByte(a>>24&255),this.writeByte(a>>16&255),this.writeByte(a>>8&255),this.writeByte(255&a)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(e){return this.writeInt32(e)},t.prototype.read=function(e){var s,a;for(s=[],a=0;0<=e?a<e:a>e;a=0<=e?++a:--a)s.push(this.readByte());return s},t.prototype.write=function(e){var s,a,d,g;for(g=[],a=0,d=e.length;a<d;a++)s=e[a],g.push(this.writeByte(s));return g},t}(),SZ=function(){var t;function e(s){var a,d,g;for(this.scalarType=s.readInt(),this.tableCount=s.readShort(),this.searchRange=s.readShort(),this.entrySelector=s.readShort(),this.rangeShift=s.readShort(),this.tables={},d=0,g=this.tableCount;0<=g?d<g:d>g;d=0<=g?++d:--d)a={tag:s.readString(4),checksum:s.readInt(),offset:s.readInt(),length:s.readInt()},this.tables[a.tag]=a}return e.prototype.encode=function(s){var a,d,g,v,i,E,k,O,z,G,U,ie,Q;for(Q in U=Object.keys(s).length,E=Math.log(2),z=16*Math.floor(Math.log(U)/E),v=Math.floor(z/E),O=16*U-z,(d=new Fp).writeInt(this.scalarType),d.writeShort(U),d.writeShort(z),d.writeShort(v),d.writeShort(O),g=16*U,k=d.pos+g,i=null,ie=[],s)for(G=s[Q],d.writeString(Q),d.writeInt(t(G)),d.writeInt(k),d.writeInt(G.length),ie=ie.concat(G),Q==="head"&&(i=k),k+=G.length;k%4;)ie.push(0),k++;return d.write(ie),a=2981146554-t(d.data),d.pos=i+8,d.writeUInt32(a),d.data},t=function(s){var a,d,g,v;for(s=_z.call(s);s.length%4;)s.push(0);for(g=new Fp(s),d=0,a=0,v=s.length;a<v;a=a+=4)d+=g.readUInt32();return 4294967295&d},e}(),TZ={}.hasOwnProperty,hd=function(t,e){for(var s in e)TZ.call(e,s)&&(t[s]=e[s]);function a(){this.constructor=t}return a.prototype=e.prototype,t.prototype=new a,t.__super__=e.prototype,t};gh=function(){function t(e){var s;this.file=e,s=this.file.directory.tables[this.tag],this.exists=!!s,s&&(this.offset=s.offset,this.length=s.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t}();var AZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="head",e.prototype.parse=function(s){return s.pos=this.offset,this.version=s.readInt(),this.revision=s.readInt(),this.checkSumAdjustment=s.readInt(),this.magicNumber=s.readInt(),this.flags=s.readShort(),this.unitsPerEm=s.readShort(),this.created=s.readLongLong(),this.modified=s.readLongLong(),this.xMin=s.readShort(),this.yMin=s.readShort(),this.xMax=s.readShort(),this.yMax=s.readShort(),this.macStyle=s.readShort(),this.lowestRecPPEM=s.readShort(),this.fontDirectionHint=s.readShort(),this.indexToLocFormat=s.readShort(),this.glyphDataFormat=s.readShort()},e.prototype.encode=function(s){var a;return(a=new Fp).writeInt(this.version),a.writeInt(this.revision),a.writeInt(this.checkSumAdjustment),a.writeInt(this.magicNumber),a.writeShort(this.flags),a.writeShort(this.unitsPerEm),a.writeLongLong(this.created),a.writeLongLong(this.modified),a.writeShort(this.xMin),a.writeShort(this.yMin),a.writeShort(this.xMax),a.writeShort(this.yMax),a.writeShort(this.macStyle),a.writeShort(this.lowestRecPPEM),a.writeShort(this.fontDirectionHint),a.writeShort(s),a.writeShort(this.glyphDataFormat),a.data},e}(),hL=function(){function t(e,s){var a,d,g,v,i,E,k,O,z,G,U,ie,Q,se,J,te,le;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=s+e.readInt(),z=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(E=0;E<256;++E)this.codeMap[E]=e.readByte();break;case 4:for(U=e.readUInt16(),G=U/2,e.pos+=6,g=function(){var ye,Ne;for(Ne=[],E=ye=0;0<=G?ye<G:ye>G;E=0<=G?++ye:--ye)Ne.push(e.readUInt16());return Ne}(),e.pos+=2,Q=function(){var ye,Ne;for(Ne=[],E=ye=0;0<=G?ye<G:ye>G;E=0<=G?++ye:--ye)Ne.push(e.readUInt16());return Ne}(),k=function(){var ye,Ne;for(Ne=[],E=ye=0;0<=G?ye<G:ye>G;E=0<=G?++ye:--ye)Ne.push(e.readUInt16());return Ne}(),O=function(){var ye,Ne;for(Ne=[],E=ye=0;0<=G?ye<G:ye>G;E=0<=G?++ye:--ye)Ne.push(e.readUInt16());return Ne}(),d=(this.length-e.pos+this.offset)/2,i=function(){var ye,Ne;for(Ne=[],E=ye=0;0<=d?ye<d:ye>d;E=0<=d?++ye:--ye)Ne.push(e.readUInt16());return Ne}(),E=J=0,le=g.length;J<le;E=++J)for(se=g[E],a=te=ie=Q[E];ie<=se?te<=se:te>=se;a=ie<=se?++te:--te)O[E]===0?v=a+k[E]:(v=i[O[E]/2+(a-ie)-(G-E)]||0)!==0&&(v+=k[E]),this.codeMap[a]=65535&v}e.pos=z}return t.encode=function(e,s){var a,d,g,v,i,E,k,O,z,G,U,ie,Q,se,J,te,le,ye,Ne,rt,xe,Me,it,ot,ve,Le,dt,Je,yt,St,jt,et,Qe,Xe,Vt,be,Re,Fe,ut,Et,Ct,Wt,Ft,me,dn,Cn;switch(Je=new Fp,v=Object.keys(e).sort(function(On,$t){return On-$t}),s){case"macroman":for(Q=0,se=function(){var On=[];for(ie=0;ie<256;++ie)On.push(0);return On}(),te={0:0},g={},yt=0,Qe=v.length;yt<Qe;yt++)te[Ft=e[d=v[yt]]]==null&&(te[Ft]=++Q),g[d]={old:e[d],new:te[e[d]]},se[d]=te[e[d]];return Je.writeUInt16(1),Je.writeUInt16(0),Je.writeUInt32(12),Je.writeUInt16(0),Je.writeUInt16(262),Je.writeUInt16(0),Je.write(se),{charMap:g,subtable:Je.data,maxGlyphID:Q+1};case"unicode":for(Le=[],z=[],le=0,te={},a={},J=k=null,St=0,Xe=v.length;St<Xe;St++)te[Ne=e[d=v[St]]]==null&&(te[Ne]=++le),a[d]={old:Ne,new:te[Ne]},i=te[Ne]-d,J!=null&&i===k||(J&&z.push(J),Le.push(d),k=i),J=d;for(J&&z.push(J),z.push(65535),Le.push(65535),ot=2*(it=Le.length),Me=2*Math.pow(Math.log(it)/Math.LN2,2),G=Math.log(Me/2)/Math.LN2,xe=2*it-Me,E=[],rt=[],U=[],ie=jt=0,Vt=Le.length;jt<Vt;ie=++jt){if(ve=Le[ie],O=z[ie],ve===65535){E.push(0),rt.push(0);break}if(ve-(dt=a[ve].new)>=32768)for(E.push(0),rt.push(2*(U.length+it-ie)),d=et=ve;ve<=O?et<=O:et>=O;d=ve<=O?++et:--et)U.push(a[d].new);else E.push(dt-ve),rt.push(0)}for(Je.writeUInt16(3),Je.writeUInt16(1),Je.writeUInt32(12),Je.writeUInt16(4),Je.writeUInt16(16+8*it+2*U.length),Je.writeUInt16(0),Je.writeUInt16(ot),Je.writeUInt16(Me),Je.writeUInt16(G),Je.writeUInt16(xe),Ct=0,be=z.length;Ct<be;Ct++)d=z[Ct],Je.writeUInt16(d);for(Je.writeUInt16(0),Wt=0,Re=Le.length;Wt<Re;Wt++)d=Le[Wt],Je.writeUInt16(d);for(me=0,Fe=E.length;me<Fe;me++)i=E[me],Je.writeUInt16(i);for(dn=0,ut=rt.length;dn<ut;dn++)ye=rt[dn],Je.writeUInt16(ye);for(Cn=0,Et=U.length;Cn<Et;Cn++)Q=U[Cn],Je.writeUInt16(Q);return{charMap:a,subtable:Je.data,maxGlyphID:le+1}}},t}(),gz=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="cmap",e.prototype.parse=function(s){var a,d,g;for(s.pos=this.offset,this.version=s.readUInt16(),g=s.readUInt16(),this.tables=[],this.unicode=null,d=0;0<=g?d<g:d>g;d=0<=g?++d:--d)a=new hL(s,this.offset),this.tables.push(a),a.isUnicode&&this.unicode==null&&(this.unicode=a);return!0},e.encode=function(s,a){var d,g;return a==null&&(a="macroman"),d=hL.encode(s,a),(g=new Fp).writeUInt16(0),g.writeUInt16(1),d.table=g.data.concat(d.subtable),d},e}(),EZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="hhea",e.prototype.parse=function(s){return s.pos=this.offset,this.version=s.readInt(),this.ascender=s.readShort(),this.decender=s.readShort(),this.lineGap=s.readShort(),this.advanceWidthMax=s.readShort(),this.minLeftSideBearing=s.readShort(),this.minRightSideBearing=s.readShort(),this.xMaxExtent=s.readShort(),this.caretSlopeRise=s.readShort(),this.caretSlopeRun=s.readShort(),this.caretOffset=s.readShort(),s.pos+=8,this.metricDataFormat=s.readShort(),this.numberOfMetrics=s.readUInt16()},e}(),CZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="OS/2",e.prototype.parse=function(s){if(s.pos=this.offset,this.version=s.readUInt16(),this.averageCharWidth=s.readShort(),this.weightClass=s.readUInt16(),this.widthClass=s.readUInt16(),this.type=s.readShort(),this.ySubscriptXSize=s.readShort(),this.ySubscriptYSize=s.readShort(),this.ySubscriptXOffset=s.readShort(),this.ySubscriptYOffset=s.readShort(),this.ySuperscriptXSize=s.readShort(),this.ySuperscriptYSize=s.readShort(),this.ySuperscriptXOffset=s.readShort(),this.ySuperscriptYOffset=s.readShort(),this.yStrikeoutSize=s.readShort(),this.yStrikeoutPosition=s.readShort(),this.familyClass=s.readShort(),this.panose=function(){var a,d;for(d=[],a=0;a<10;++a)d.push(s.readByte());return d}(),this.charRange=function(){var a,d;for(d=[],a=0;a<4;++a)d.push(s.readInt());return d}(),this.vendorID=s.readString(4),this.selection=s.readShort(),this.firstCharIndex=s.readShort(),this.lastCharIndex=s.readShort(),this.version>0&&(this.ascent=s.readShort(),this.descent=s.readShort(),this.lineGap=s.readShort(),this.winAscent=s.readShort(),this.winDescent=s.readShort(),this.codePageRange=function(){var a,d;for(d=[],a=0;a<2;a=++a)d.push(s.readInt());return d}(),this.version>1))return this.xHeight=s.readShort(),this.capHeight=s.readShort(),this.defaultChar=s.readShort(),this.breakChar=s.readShort(),this.maxContext=s.readShort()},e}(),PZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="post",e.prototype.parse=function(s){var a,d,g;switch(s.pos=this.offset,this.format=s.readInt(),this.italicAngle=s.readInt(),this.underlinePosition=s.readShort(),this.underlineThickness=s.readShort(),this.isFixedPitch=s.readInt(),this.minMemType42=s.readInt(),this.maxMemType42=s.readInt(),this.minMemType1=s.readInt(),this.maxMemType1=s.readInt(),this.format){case 65536:break;case 131072:var v;for(d=s.readUInt16(),this.glyphNameIndex=[],v=0;0<=d?v<d:v>d;v=0<=d?++v:--v)this.glyphNameIndex.push(s.readUInt16());for(this.names=[],g=[];s.pos<this.offset+this.length;)a=s.readByte(),g.push(this.names.push(s.readString(a)));return g;case 151552:return d=s.readUInt16(),this.offsets=s.read(d);case 196608:break;case 262144:return this.map=(function(){var i,E,k;for(k=[],v=i=0,E=this.file.maxp.numGlyphs;0<=E?i<E:i>E;v=0<=E?++i:--i)k.push(s.readUInt32());return k}).call(this)}},e}(),MZ=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},IZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="name",e.prototype.parse=function(s){var a,d,g,v,i,E,k,O,z,G,U;for(s.pos=this.offset,s.readShort(),a=s.readShort(),E=s.readShort(),d=[],v=0;0<=a?v<a:v>a;v=0<=a?++v:--v)d.push({platformID:s.readShort(),encodingID:s.readShort(),languageID:s.readShort(),nameID:s.readShort(),length:s.readShort(),offset:this.offset+E+s.readShort()});for(k={},v=z=0,G=d.length;z<G;v=++z)g=d[v],s.pos=g.offset,O=s.readString(g.length),i=new MZ(O,g),k[U=g.nameID]==null&&(k[U]=[]),k[g.nameID].push(i);this.strings=k,this.copyright=k[0],this.fontFamily=k[1],this.fontSubfamily=k[2],this.uniqueSubfamily=k[3],this.fontName=k[4],this.version=k[5];try{this.postscriptName=k[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=k[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=k[7],this.manufacturer=k[8],this.designer=k[9],this.description=k[10],this.vendorUrl=k[11],this.designerUrl=k[12],this.license=k[13],this.licenseUrl=k[14],this.preferredFamily=k[15],this.preferredSubfamily=k[17],this.compatibleFull=k[18],this.sampleText=k[19]},e}(),LZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="maxp",e.prototype.parse=function(s){return s.pos=this.offset,this.version=s.readInt(),this.numGlyphs=s.readUInt16(),this.maxPoints=s.readUInt16(),this.maxContours=s.readUInt16(),this.maxCompositePoints=s.readUInt16(),this.maxComponentContours=s.readUInt16(),this.maxZones=s.readUInt16(),this.maxTwilightPoints=s.readUInt16(),this.maxStorage=s.readUInt16(),this.maxFunctionDefs=s.readUInt16(),this.maxInstructionDefs=s.readUInt16(),this.maxStackElements=s.readUInt16(),this.maxSizeOfInstructions=s.readUInt16(),this.maxComponentElements=s.readUInt16(),this.maxComponentDepth=s.readUInt16()},e}(),kZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="hmtx",e.prototype.parse=function(s){var a,d,g,v,i,E,k;for(s.pos=this.offset,this.metrics=[],a=0,E=this.file.hhea.numberOfMetrics;0<=E?a<E:a>E;a=0<=E?++a:--a)this.metrics.push({advance:s.readUInt16(),lsb:s.readInt16()});for(g=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var O,z;for(z=[],a=O=0;0<=g?O<g:O>g;a=0<=g?++O:--O)z.push(s.readInt16());return z}(),this.widths=(function(){var O,z,G,U;for(U=[],O=0,z=(G=this.metrics).length;O<z;O++)v=G[O],U.push(v.advance);return U}).call(this),d=this.widths[this.widths.length-1],k=[],a=i=0;0<=g?i<g:i>g;a=0<=g?++i:--i)k.push(this.widths.push(d));return k},e.prototype.forGlyph=function(s){return s in this.metrics?this.metrics[s]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[s-this.metrics.length]}},e}(),_z=[].slice,RZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(s){var a,d,g,v,i,E,k,O,z,G;return s in this.cache?this.cache[s]:(v=this.file.loca,a=this.file.contents,d=v.indexOf(s),(g=v.lengthOf(s))===0?this.cache[s]=null:(a.pos=this.offset+d,i=(E=new Fp(a.read(g))).readShort(),O=E.readShort(),G=E.readShort(),k=E.readShort(),z=E.readShort(),this.cache[s]=i===-1?new NZ(E,O,G,k,z):new DZ(E,i,O,G,k,z),this.cache[s]))},e.prototype.encode=function(s,a,d){var g,v,i,E,k;for(i=[],v=[],E=0,k=a.length;E<k;E++)g=s[a[E]],v.push(i.length),g&&(i=i.concat(g.encode(d)));return v.push(i.length),{table:i,offsets:v}},e}(),DZ=function(){function t(e,s,a,d,g,v){this.raw=e,this.numberOfContours=s,this.xMin=a,this.yMin=d,this.xMax=g,this.yMax=v,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t}(),NZ=function(){function t(e,s,a,d,g){var v,i;for(this.raw=e,this.xMin=s,this.yMin=a,this.xMax=d,this.yMax=g,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],v=this.raw;i=v.readShort(),this.glyphOffsets.push(v.pos),this.glyphIDs.push(v.readUInt16()),32&i;)v.pos+=1&i?4:2,128&i?v.pos+=8:64&i?v.pos+=4:8&i&&(v.pos+=2)}return t.prototype.encode=function(){var e,s,a;for(s=new Fp(_z.call(this.raw.data)),e=0,a=this.glyphIDs.length;e<a;++e)s.pos=this.glyphOffsets[e];return s.data},t}(),OZ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return hd(e,gh),e.prototype.tag="loca",e.prototype.parse=function(s){var a,d;return s.pos=this.offset,a=this.file.head.indexToLocFormat,this.offsets=a===0?(function(){var g,v;for(v=[],d=0,g=this.length;d<g;d+=2)v.push(2*s.readUInt16());return v}).call(this):(function(){var g,v;for(v=[],d=0,g=this.length;d<g;d+=4)v.push(s.readUInt32());return v}).call(this)},e.prototype.indexOf=function(s){return this.offsets[s]},e.prototype.lengthOf=function(s){return this.offsets[s+1]-this.offsets[s]},e.prototype.encode=function(s,a){for(var d=new Uint32Array(this.offsets.length),g=0,v=0,i=0;i<d.length;++i)if(d[i]=g,v<a.length&&a[v]==i){++v,d[i]=g;var E=this.offsets[i],k=this.offsets[i+1]-E;k>0&&(g+=k)}for(var O=new Array(4*d.length),z=0;z<d.length;++z)O[4*z+3]=255&d[z],O[4*z+2]=(65280&d[z])>>8,O[4*z+1]=(16711680&d[z])>>16,O[4*z]=(4278190080&d[z])>>24;return O},e}(),zZ=function(){function t(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var e,s,a,d,g;for(s in d=this.font.cmap.tables[0].codeMap,e={},g=this.subset)a=g[s],e[s]=d[a];return e},t.prototype.glyphsFor=function(e){var s,a,d,g,v,i,E;for(d={},v=0,i=e.length;v<i;v++)d[g=e[v]]=this.font.glyf.glyphFor(g);for(g in s=[],d)(a=d[g])!=null&&a.compound&&s.push.apply(s,a.glyphIDs);if(s.length>0)for(g in E=this.glyphsFor(s))a=E[g],d[g]=a;return d},t.prototype.encode=function(e,s){var a,d,g,v,i,E,k,O,z,G,U,ie,Q,se,J;for(d in a=gz.encode(this.generateCmap(),"unicode"),v=this.glyphsFor(e),U={0:0},J=a.charMap)U[(E=J[d]).old]=E.new;for(ie in G=a.maxGlyphID,v)ie in U||(U[ie]=G++);return O=function(te){var le,ye;for(le in ye={},te)ye[te[le]]=le;return ye}(U),z=Object.keys(O).sort(function(te,le){return te-le}),Q=function(){var te,le,ye;for(ye=[],te=0,le=z.length;te<le;te++)i=z[te],ye.push(O[i]);return ye}(),g=this.font.glyf.encode(v,Q,U),k=this.font.loca.encode(g.offsets,Q),se={cmap:this.font.cmap.raw(),glyf:g.table,loca:k,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(s)},this.font.os2.exists&&(se["OS/2"]=this.font.os2.raw()),this.font.directory.encode(se)},t}();Qr.API.PDFObject=function(){var t;function e(){}return t=function(s,a){return(Array(a+1).join("0")+s).slice(-a)},e.convert=function(s){var a,d,g,v;if(Array.isArray(s))return"["+function(){var i,E,k;for(k=[],i=0,E=s.length;i<E;i++)a=s[i],k.push(e.convert(a));return k}().join(" ")+"]";if(typeof s=="string")return"/"+s;if(s!=null&&s.isString)return"("+s+")";if(s instanceof Date)return"(D:"+t(s.getUTCFullYear(),4)+t(s.getUTCMonth(),2)+t(s.getUTCDate(),2)+t(s.getUTCHours(),2)+t(s.getUTCMinutes(),2)+t(s.getUTCSeconds(),2)+"Z)";if({}.toString.call(s)==="[object Object]"){for(d in g=["<<"],s)v=s[d],g.push("/"+d+" "+e.convert(v));return g.push(">>"),g.join(`
`)}return""+s},e}();function yz(t,e,s,a,d){a=a||{};var g=1.15,v=d.internal.scaleFactor,i=d.internal.getFontSize()/v,E=d.getLineHeightFactor?d.getLineHeightFactor():g,k=i*E,O=/\r\n|\r|\n/g,z="",G=1;if((a.valign==="middle"||a.valign==="bottom"||a.halign==="center"||a.halign==="right")&&(z=typeof t=="string"?t.split(O):t,G=z.length||1),s+=i*(2-g),a.valign==="middle"?s-=G/2*k:a.valign==="bottom"&&(s-=G*k),a.halign==="center"||a.halign==="right"){var U=i;if(a.halign==="center"&&(U*=.5),z&&G>=1){for(var ie=0;ie<z.length;ie++)d.text(z[ie],e-d.getStringUnitWidth(z[ie])*U,s),s+=k;return d}e-=d.getStringUnitWidth(t)*U}return a.halign==="justify"?d.text(t,e,s,{maxWidth:a.maxWidth||100,align:"justify"}):d.text(t,e,s),d}var dL={},R_=function(){function t(e){this.jsPDFDocument=e,this.userStyles={textColor:e.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:e.internal.getFontSize(),fontStyle:e.internal.getFont().fontStyle,font:e.internal.getFont().fontName,lineWidth:e.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:e.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return t.setDefaults=function(e,s){s===void 0&&(s=null),s?s.__autoTableDocumentDefaults=e:dL=e},t.unifyColor=function(e){return Array.isArray(e)?e:typeof e=="number"?[e,e,e]:typeof e=="string"?[e]:null},t.prototype.applyStyles=function(e,s){var a,d,g;s===void 0&&(s=!1),e.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(e.fontStyle);var v=this.jsPDFDocument.internal.getFont(),i=v.fontStyle,E=v.fontName;if(e.font&&(E=e.font),e.fontStyle){i=e.fontStyle;var k=this.getFontList()[E];k&&k.indexOf(i)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(k[0]),i=k[0])}if(this.jsPDFDocument.setFont(E,i),e.fontSize&&this.jsPDFDocument.setFontSize(e.fontSize),!s){var O=t.unifyColor(e.fillColor);O&&(a=this.jsPDFDocument).setFillColor.apply(a,O),O=t.unifyColor(e.textColor),O&&(d=this.jsPDFDocument).setTextColor.apply(d,O),O=t.unifyColor(e.lineColor),O&&(g=this.jsPDFDocument).setDrawColor.apply(g,O),typeof e.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(e.lineWidth)}},t.prototype.splitTextToSize=function(e,s,a){return this.jsPDFDocument.splitTextToSize(e,s,a)},t.prototype.rect=function(e,s,a,d,g){return this.jsPDFDocument.rect(e,s,a,d,g)},t.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},t.prototype.getTextWidth=function(e){return this.jsPDFDocument.getTextWidth(e)},t.prototype.getDocument=function(){return this.jsPDFDocument},t.prototype.setPage=function(e){this.jsPDFDocument.setPage(e)},t.prototype.addPage=function(){return this.jsPDFDocument.addPage()},t.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},t.prototype.getGlobalOptions=function(){return dL||{}},t.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},t.prototype.pageSize=function(){var e=this.jsPDFDocument.internal.pageSize;return e.width==null&&(e={width:e.getWidth(),height:e.getHeight()}),e},t.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},t.prototype.getLineHeightFactor=function(){var e=this.jsPDFDocument;return e.getLineHeightFactor?e.getLineHeightFactor():1.15},t.prototype.getLineHeight=function(e){return e/this.scaleFactor()*this.getLineHeightFactor()},t.prototype.pageNumber=function(){var e=this.jsPDFDocument.internal.getCurrentPageInfo();return e?e.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},t}(),WT=function(t,e){return WT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(s[d]=a[d])},WT(t,e)};function vz(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");WT(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}var xz=function(t){vz(e,t);function e(s){var a=t.call(this)||this;return a._element=s,a}return e}(Array);function FZ(t){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/t,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function BZ(t){var e={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return e[t]}function Rb(t,e,s){s.applyStyles(e,!0);var a=Array.isArray(t)?t:[t],d=a.map(function(g){return s.getTextWidth(g)}).reduce(function(g,v){return Math.max(g,v)},0);return d}function bz(t,e,s,a){var d=e.settings.tableLineWidth,g=e.settings.tableLineColor;t.applyStyles({lineWidth:d,lineColor:g});var v=wz(d,!1);v&&t.rect(s.x,s.y,e.getWidth(t.pageSize().width),a.y-s.y,v)}function wz(t,e){var s=t>0,a=e||e===0;return s&&a?"DF":s?"S":a?"F":null}function xw(t,e){var s,a,d,g;if(t=t||e,Array.isArray(t)){if(t.length>=4)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(t.length===3)return{top:t[0],right:t[1],bottom:t[2],left:t[1]};if(t.length===2)return{top:t[0],right:t[1],bottom:t[0],left:t[1]};t.length===1?t=t[0]:t=e}return typeof t=="object"?(typeof t.vertical=="number"&&(t.top=t.vertical,t.bottom=t.vertical),typeof t.horizontal=="number"&&(t.right=t.horizontal,t.left=t.horizontal),{left:(s=t.left)!==null&&s!==void 0?s:e,top:(a=t.top)!==null&&a!==void 0?a:e,right:(d=t.right)!==null&&d!==void 0?d:e,bottom:(g=t.bottom)!==null&&g!==void 0?g:e}):(typeof t!="number"&&(t=e),{top:t,right:t,bottom:t,left:t})}function Sz(t,e){var s=xw(e.settings.margin,0);return t.pageSize().width-(s.left+s.right)}function jZ(t,e,s,a,d){var g={},v=1.3333333333333333,i=eS(e,function(le){return d.getComputedStyle(le).backgroundColor});i!=null&&(g.fillColor=i);var E=eS(e,function(le){return d.getComputedStyle(le).color});E!=null&&(g.textColor=E);var k=VZ(a,s);k&&(g.cellPadding=k);var O="borderTopColor",z=v*s,G=a.borderTopWidth;if(a.borderBottomWidth===G&&a.borderRightWidth===G&&a.borderLeftWidth===G){var U=(parseFloat(G)||0)/z;U&&(g.lineWidth=U)}else g.lineWidth={top:(parseFloat(a.borderTopWidth)||0)/z,right:(parseFloat(a.borderRightWidth)||0)/z,bottom:(parseFloat(a.borderBottomWidth)||0)/z,left:(parseFloat(a.borderLeftWidth)||0)/z},g.lineWidth.top||(g.lineWidth.right?O="borderRightColor":g.lineWidth.bottom?O="borderBottomColor":g.lineWidth.left&&(O="borderLeftColor"));var ie=eS(e,function(le){return d.getComputedStyle(le)[O]});ie!=null&&(g.lineColor=ie);var Q=["left","right","center","justify"];Q.indexOf(a.textAlign)!==-1&&(g.halign=a.textAlign),Q=["middle","bottom","top"],Q.indexOf(a.verticalAlign)!==-1&&(g.valign=a.verticalAlign);var se=parseInt(a.fontSize||"");isNaN(se)||(g.fontSize=se/v);var J=UZ(a);J&&(g.fontStyle=J);var te=(a.fontFamily||"").toLowerCase();return t.indexOf(te)!==-1&&(g.font=te),g}function UZ(t){var e="";return(t.fontWeight==="bold"||t.fontWeight==="bolder"||parseInt(t.fontWeight)>=700)&&(e="bold"),(t.fontStyle==="italic"||t.fontStyle==="oblique")&&(e+="italic"),e}function eS(t,e){var s=Tz(t,e);if(!s)return null;var a=s.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!a||!Array.isArray(a))return null;var d=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])],g=parseInt(a[4]);return g===0||isNaN(d[0])||isNaN(d[1])||isNaN(d[2])?null:d}function Tz(t,e){var s=e(t);return s==="rgba(0, 0, 0, 0)"||s==="transparent"||s==="initial"||s==="inherit"?t.parentElement==null?null:Tz(t.parentElement,e):s}function VZ(t,e){var s=[t.paddingTop,t.paddingRight,t.paddingBottom,t.paddingLeft],a=96/(72/e),d=(parseInt(t.lineHeight)-parseInt(t.fontSize))/e/2,g=s.map(function(i){return parseInt(i||"0")/a}),v=xw(g,0);return d>v.top&&(v.top=d),d>v.bottom&&(v.bottom=d),v}function Az(t,e,s,a,d){var g,v;a===void 0&&(a=!1),d===void 0&&(d=!1);var i;typeof e=="string"?i=s.document.querySelector(e):i=e;var E=Object.keys(t.getFontList()),k=t.scaleFactor(),O=[],z=[],G=[];if(!i)return console.error("Html table could not be found with input: ",e),{head:O,body:z,foot:G};for(var U=0;U<i.rows.length;U++){var ie=i.rows[U],Q=(v=(g=ie==null?void 0:ie.parentElement)===null||g===void 0?void 0:g.tagName)===null||v===void 0?void 0:v.toLowerCase(),se=qZ(E,k,s,ie,a,d);se&&(Q==="thead"?O.push(se):Q==="tfoot"?G.push(se):z.push(se))}return{head:O,body:z,foot:G}}function qZ(t,e,s,a,d,g){for(var v=new xz(a),i=0;i<a.cells.length;i++){var E=a.cells[i],k=s.getComputedStyle(E);if(d||k.display!=="none"){var O=void 0;g&&(O=jZ(t,E,e,k,s)),v.push({rowSpan:E.rowSpan,colSpan:E.colSpan,styles:O,_element:E,content:$Z(E)})}}var z=s.getComputedStyle(a);if(v.length>0&&(d||z.display!=="none"))return v}function $Z(t){var e=t.cloneNode(!0);return e.innerHTML=e.innerHTML.replace(/\n/g,"").replace(/ +/g," "),e.innerHTML=e.innerHTML.split(/<br.*?>/).map(function(s){return s.trim()}).join(`
`),e.innerText||e.textContent||""}function GZ(t,e,s){for(var a=0,d=[t,e,s];a<d.length;a++){var g=d[a];g&&typeof g!="object"&&console.error("The options parameter should be of type object, is: "+typeof g),g.startY&&typeof g.startY!="number"&&(console.error("Invalid value for startY option",g.startY),delete g.startY)}}function tf(t,e,s,a,d){if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var g=Object(t),v=1;v<arguments.length;v++){var i=arguments[v];if(i!=null)for(var E in i)Object.prototype.hasOwnProperty.call(i,E)&&(g[E]=i[E])}return g}function Ez(t,e){var s=new R_(t),a=s.getDocumentOptions(),d=s.getGlobalOptions();GZ(d,a,e);var g=tf({},d,a,e),v;typeof window<"u"&&(v=window);var i=HZ(d,a,e),E=WZ(d,a,e),k=ZZ(s,g),O=XZ(s,g,v);return{id:e.tableId,content:O,hooks:E,styles:i,settings:k}}function HZ(t,e,s){for(var a={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},d=function(E){if(E==="columnStyles"){var k=t[E],O=e[E],z=s[E];a.columnStyles=tf({},k,O,z)}else{var G=[t,e,s],U=G.map(function(ie){return ie[E]||{}});a[E]=tf({},U[0],U[1],U[2])}},g=0,v=Object.keys(a);g<v.length;g++){var i=v[g];d(i)}return a}function WZ(t,e,s){for(var a=[t,e,s],d={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},g=0,v=a;g<v.length;g++){var i=v[g];i.didParseCell&&d.didParseCell.push(i.didParseCell),i.willDrawCell&&d.willDrawCell.push(i.willDrawCell),i.didDrawCell&&d.didDrawCell.push(i.didDrawCell),i.willDrawPage&&d.willDrawPage.push(i.willDrawPage),i.didDrawPage&&d.didDrawPage.push(i.didDrawPage)}return d}function ZZ(t,e){var s,a,d,g,v,i,E,k,O,z,G,U,ie=xw(e.margin,40/t.scaleFactor()),Q=(s=KZ(t,e.startY))!==null&&s!==void 0?s:ie.top,se;e.showFoot===!0?se="everyPage":e.showFoot===!1?se="never":se=(a=e.showFoot)!==null&&a!==void 0?a:"everyPage";var J;e.showHead===!0?J="everyPage":e.showHead===!1?J="never":J=(d=e.showHead)!==null&&d!==void 0?d:"everyPage";var te=(g=e.useCss)!==null&&g!==void 0?g:!1,le=e.theme||(te?"plain":"striped"),ye=!!e.horizontalPageBreak,Ne=(v=e.horizontalPageBreakRepeat)!==null&&v!==void 0?v:null;return{includeHiddenHtml:(i=e.includeHiddenHtml)!==null&&i!==void 0?i:!1,useCss:te,theme:le,startY:Q,margin:ie,pageBreak:(E=e.pageBreak)!==null&&E!==void 0?E:"auto",rowPageBreak:(k=e.rowPageBreak)!==null&&k!==void 0?k:"auto",tableWidth:(O=e.tableWidth)!==null&&O!==void 0?O:"auto",showHead:J,showFoot:se,tableLineWidth:(z=e.tableLineWidth)!==null&&z!==void 0?z:0,tableLineColor:(G=e.tableLineColor)!==null&&G!==void 0?G:200,horizontalPageBreak:ye,horizontalPageBreakRepeat:Ne,horizontalPageBreakBehaviour:(U=e.horizontalPageBreakBehaviour)!==null&&U!==void 0?U:"afterAllRows"}}function KZ(t,e){var s=t.getLastAutoTable(),a=t.scaleFactor(),d=t.pageNumber(),g=!1;if(s&&s.startPageNumber){var v=s.startPageNumber+s.pageNumber-1;g=v===d}return typeof e=="number"?e:(e==null||e===!1)&&g&&(s==null?void 0:s.finalY)!=null?s.finalY+20/a:null}function XZ(t,e,s){var a=e.head||[],d=e.body||[],g=e.foot||[];if(e.html){var v=e.includeHiddenHtml;if(s){var i=Az(t,e.html,s,v,e.useCss)||{};a=i.head||a,d=i.body||a,g=i.foot||a}else console.error("Cannot parse html in non browser environment")}var E=e.columns||YZ(a,d,g);return{columns:E,head:a,body:d,foot:g}}function YZ(t,e,s){var a=t[0]||e[0]||s[0]||[],d=[];return Object.keys(a).filter(function(g){return g!=="_element"}).forEach(function(g){var v=1,i;Array.isArray(a)?i=a[parseInt(g)]:i=a[g],typeof i=="object"&&!Array.isArray(i)&&(v=(i==null?void 0:i.colSpan)||1);for(var E=0;E<v;E++){var k=void 0;Array.isArray(a)?k=d.length:k=g+(E>0?"_".concat(E):"");var O={dataKey:k};d.push(O)}}),d}var ZT=function(){function t(e,s,a){this.table=s,this.pageNumber=s.pageNumber,this.settings=s.settings,this.cursor=a,this.doc=e.getDocument()}return t}(),JZ=function(t){vz(e,t);function e(s,a,d,g,v,i){var E=t.call(this,s,a,i)||this;return E.cell=d,E.row=g,E.column=v,E.section=g.section,E}return e}(ZT),QZ=function(){function t(e,s){this.pageNumber=1,this.id=e.id,this.settings=e.settings,this.styles=e.styles,this.hooks=e.hooks,this.columns=s.columns,this.head=s.head,this.body=s.body,this.foot=s.foot}return t.prototype.getHeadHeight=function(e){return this.head.reduce(function(s,a){return s+a.getMaxCellHeight(e)},0)},t.prototype.getFootHeight=function(e){return this.foot.reduce(function(s,a){return s+a.getMaxCellHeight(e)},0)},t.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},t.prototype.callCellHooks=function(e,s,a,d,g,v){for(var i=0,E=s;i<E.length;i++){var k=E[i],O=new JZ(e,this,a,d,g,v),z=k(O)===!1;if(a.text=Array.isArray(a.text)?a.text:[a.text],z)return!1}return!0},t.prototype.callEndPageHooks=function(e,s){e.applyStyles(e.userStyles);for(var a=0,d=this.hooks.didDrawPage;a<d.length;a++){var g=d[a];g(new ZT(e,this,s))}},t.prototype.callWillDrawPageHooks=function(e,s){for(var a=0,d=this.hooks.willDrawPage;a<d.length;a++){var g=d[a];g(new ZT(e,this,s))}},t.prototype.getWidth=function(e){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var s=this.columns.reduce(function(d,g){return d+g.wrappedWidth},0);return s}else{var a=this.settings.margin;return e-a.left-a.right}},t}(),Cz=function(){function t(e,s,a,d,g){g===void 0&&(g=!1),this.height=0,this.raw=e,e instanceof xz&&(this.raw=e._element,this.element=e._element),this.index=s,this.section=a,this.cells=d,this.spansMultiplePages=g}return t.prototype.getMaxCellHeight=function(e){var s=this;return e.reduce(function(a,d){var g;return Math.max(a,((g=s.cells[d.index])===null||g===void 0?void 0:g.height)||0)},0)},t.prototype.hasRowSpan=function(e){var s=this;return e.filter(function(a){var d=s.cells[a.index];return d?d.rowSpan>1:!1}).length>0},t.prototype.canEntireRowFit=function(e,s){return this.getMaxCellHeight(s)<=e},t.prototype.getMinimumRowHeight=function(e,s){var a=this;return e.reduce(function(d,g){var v=a.cells[g.index];if(!v)return 0;var i=s.getLineHeight(v.styles.fontSize),E=v.padding("vertical"),k=E+i;return k>d?k:d},0)},t}(),Pz=function(){function t(e,s,a){var d;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=s,this.section=a,this.raw=e;var g=e;e!=null&&typeof e=="object"&&!Array.isArray(e)?(this.rowSpan=e.rowSpan||1,this.colSpan=e.colSpan||1,g=(d=e.content)!==null&&d!==void 0?d:e,e._element&&(this.raw=e._element)):(this.rowSpan=1,this.colSpan=1);var v=g!=null?""+g:"",i=/\r\n|\r|\n/g;this.text=v.split(i)}return t.prototype.getTextPos=function(){var e;if(this.styles.valign==="top")e=this.y+this.padding("top");else if(this.styles.valign==="bottom")e=this.y+this.height-this.padding("bottom");else{var s=this.height-this.padding("vertical");e=this.y+s/2+this.padding("top")}var a;if(this.styles.halign==="right")a=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var d=this.width-this.padding("horizontal");a=this.x+d/2+this.padding("left")}else a=this.x+this.padding("left");return{x:a,y:e}},t.prototype.getContentHeight=function(e,s){s===void 0&&(s=1.15);var a=Array.isArray(this.text)?this.text.length:1,d=this.styles.fontSize/e*s,g=a*d+this.padding("vertical");return Math.max(g,this.styles.minCellHeight)},t.prototype.padding=function(e){var s=xw(this.styles.cellPadding,0);return e==="vertical"?s.top+s.bottom:e==="horizontal"?s.left+s.right:s[e]},t}(),eK=function(){function t(e,s,a){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=e,this.raw=s,this.index=a}return t.prototype.getMaxCustomCellWidth=function(e){for(var s=0,a=0,d=e.allRows();a<d.length;a++){var g=d[a],v=g.cells[this.index];v&&typeof v.styles.cellWidth=="number"&&(s=Math.max(s,v.styles.cellWidth))}return s},t}();function tK(t,e){nK(t,e);var s=[],a=0;e.columns.forEach(function(g){var v=g.getMaxCustomCellWidth(e);v?g.width=v:(g.width=g.wrappedWidth,s.push(g)),a+=g.width});var d=e.getWidth(t.pageSize().width)-a;d&&(d=KT(s,d,function(g){return Math.max(g.minReadableWidth,g.minWidth)})),d&&(d=KT(s,d,function(g){return g.minWidth})),d=Math.abs(d),!e.settings.horizontalPageBreak&&d>.1/t.scaleFactor()&&(d=d<1?d:Math.round(d),console.warn("Of the table content, ".concat(d," units width could not fit page"))),iK(e),sK(e,t),rK(e)}function nK(t,e){var s=t.scaleFactor(),a=e.settings.horizontalPageBreak,d=Sz(t,e);e.allRows().forEach(function(g){for(var v=0,i=e.columns;v<i.length;v++){var E=i[v],k=g.cells[E.index];if(k){var O=e.hooks.didParseCell;e.callCellHooks(t,O,k,g,E,null);var z=k.padding("horizontal");k.contentWidth=Rb(k.text,k.styles,t)+z;var G=Rb(k.text.join(" ").split(/[^\S\u00A0]+/),k.styles,t);if(k.minReadableWidth=G+k.padding("horizontal"),typeof k.styles.cellWidth=="number")k.minWidth=k.styles.cellWidth,k.wrappedWidth=k.styles.cellWidth;else if(k.styles.cellWidth==="wrap"||a===!0)k.contentWidth>d?(k.minWidth=d,k.wrappedWidth=d):(k.minWidth=k.contentWidth,k.wrappedWidth=k.contentWidth);else{var U=10/s;k.minWidth=k.styles.minCellWidth||U,k.wrappedWidth=k.contentWidth,k.minWidth>k.wrappedWidth&&(k.wrappedWidth=k.minWidth)}}}}),e.allRows().forEach(function(g){for(var v=0,i=e.columns;v<i.length;v++){var E=i[v],k=g.cells[E.index];if(k&&k.colSpan===1)E.wrappedWidth=Math.max(E.wrappedWidth,k.wrappedWidth),E.minWidth=Math.max(E.minWidth,k.minWidth),E.minReadableWidth=Math.max(E.minReadableWidth,k.minReadableWidth);else{var O=e.styles.columnStyles[E.dataKey]||e.styles.columnStyles[E.index]||{},z=O.cellWidth||O.minCellWidth;z&&typeof z=="number"&&(E.minWidth=z,E.wrappedWidth=z)}k&&(k.colSpan>1&&!E.minWidth&&(E.minWidth=k.minWidth),k.colSpan>1&&!E.wrappedWidth&&(E.wrappedWidth=k.minWidth))}})}function KT(t,e,s){for(var a=e,d=t.reduce(function(U,ie){return U+ie.wrappedWidth},0),g=0;g<t.length;g++){var v=t[g],i=v.wrappedWidth/d,E=a*i,k=v.width+E,O=s(v),z=k<O?O:k;e-=z-v.width,v.width=z}if(e=Math.round(e*1e10)/1e10,e){var G=t.filter(function(U){return e<0?U.width>s(U):!0});G.length&&(e=KT(G,e,s))}return e}function rK(t){for(var e={},s=1,a=t.allRows(),d=0;d<a.length;d++)for(var g=a[d],v=0,i=t.columns;v<i.length;v++){var E=i[v],k=e[E.index];if(s>1)s--,delete g.cells[E.index];else if(k)k.cell.height+=g.height,s=k.cell.colSpan,delete g.cells[E.index],k.left--,k.left<=1&&delete e[E.index];else{var O=g.cells[E.index];if(!O)continue;if(O.height=g.height,O.rowSpan>1){var z=a.length-d,G=O.rowSpan>z?z:O.rowSpan;e[E.index]={cell:O,left:G,row:g}}}}}function iK(t){for(var e=t.allRows(),s=0;s<e.length;s++)for(var a=e[s],d=null,g=0,v=0,i=0;i<t.columns.length;i++){var E=t.columns[i];if(v-=1,v>1&&t.columns[i+1])g+=E.width,delete a.cells[E.index];else if(d){var k=d;delete a.cells[E.index],d=null,k.width=E.width+g}else{var k=a.cells[E.index];if(!k)continue;if(v=k.colSpan,g=0,k.colSpan>1){d=k,g+=E.width;continue}k.width=E.width+g}}}function sK(t,e){for(var s={count:0,height:0},a=0,d=t.allRows();a<d.length;a++){for(var g=d[a],v=0,i=t.columns;v<i.length;v++){var E=i[v],k=g.cells[E.index];if(k){e.applyStyles(k.styles,!0);var O=k.width-k.padding("horizontal");if(k.styles.overflow==="linebreak")k.text=e.splitTextToSize(k.text,O+1/e.scaleFactor(),{fontSize:k.styles.fontSize});else if(k.styles.overflow==="ellipsize")k.text=fL(k.text,O,k.styles,e,"...");else if(k.styles.overflow==="hidden")k.text=fL(k.text,O,k.styles,e,"");else if(typeof k.styles.overflow=="function"){var z=k.styles.overflow(k.text,O);typeof z=="string"?k.text=[z]:k.text=z}k.contentHeight=k.getContentHeight(e.scaleFactor(),e.getLineHeightFactor());var G=k.contentHeight/k.rowSpan;k.rowSpan>1&&s.count*s.height<G*k.rowSpan?s={height:G,count:k.rowSpan}:s&&s.count>0&&s.height>G&&(G=s.height),G>g.height&&(g.height=G)}}s.count--}}function fL(t,e,s,a,d){return t.map(function(g){return oK(g,e,s,a,d)})}function oK(t,e,s,a,d){var g=1e4*a.scaleFactor();if(e=Math.ceil(e*g)/g,e>=Rb(t,s,a))return t;for(;e<Rb(t+d,s,a)&&!(t.length<=1);)t=t.substring(0,t.length-1);return t.trim()+d}function Mz(t,e){var s=new R_(t),a=aK(e,s.scaleFactor()),d=new QZ(e,a);return tK(s,d),s.applyStyles(s.userStyles),d}function aK(t,e){var s=t.content,a=cK(s.columns);if(s.head.length===0){var d=pL(a,"head");d&&s.head.push(d)}if(s.foot.length===0){var d=pL(a,"foot");d&&s.foot.push(d)}var g=t.settings.theme,v=t.styles;return{columns:a,head:tS("head",s.head,a,v,g,e),body:tS("body",s.body,a,v,g,e),foot:tS("foot",s.foot,a,v,g,e)}}function tS(t,e,s,a,d,g){var v={},i=e.map(function(E,k){for(var O=0,z={},G=0,U=0,ie=0,Q=s;ie<Q.length;ie++){var se=Q[ie];if(v[se.index]==null||v[se.index].left===0)if(U===0){var J=void 0;Array.isArray(E)?J=E[se.index-G-O]:J=E[se.dataKey];var te={};typeof J=="object"&&!Array.isArray(J)&&(te=(J==null?void 0:J.styles)||{});var le=uK(t,se,k,d,a,g,te),ye=new Pz(J,le,t);z[se.dataKey]=ye,z[se.index]=ye,U=ye.colSpan-1,v[se.index]={left:ye.rowSpan-1,times:U}}else U--,G++;else v[se.index].left--,U=v[se.index].times,O++}return new Cz(E,k,t,z)});return i}function pL(t,e){var s={};return t.forEach(function(a){if(a.raw!=null){var d=lK(e,a.raw);d!=null&&(s[a.dataKey]=d)}}),Object.keys(s).length>0?s:null}function lK(t,e){if(t==="head"){if(typeof e=="object")return e.header||null;if(typeof e=="string"||typeof e=="number")return e}else if(t==="foot"&&typeof e=="object")return e.footer;return null}function cK(t){return t.map(function(e,s){var a,d;return typeof e=="object"?d=(a=e.dataKey)!==null&&a!==void 0?a:s:d=s,new eK(d,e,s)})}function uK(t,e,s,a,d,g,v){var i=BZ(a),E;t==="head"?E=d.headStyles:t==="body"?E=d.bodyStyles:t==="foot"&&(E=d.footStyles);var k=tf({},i.table,i[t],d.styles,E),O=d.columnStyles[e.dataKey]||d.columnStyles[e.index]||{},z=t==="body"?O:{},G=t==="body"&&s%2===0?tf({},i.alternateRow,d.alternateRowStyles):{},U=FZ(g),ie=tf({},U,k,G,z);return tf(ie,v)}function hK(t,e,s){var a;s===void 0&&(s={});var d=Sz(t,e),g=new Map,v=[],i=[],E=[];Array.isArray(e.settings.horizontalPageBreakRepeat)?E=e.settings.horizontalPageBreakRepeat:(typeof e.settings.horizontalPageBreakRepeat=="string"||typeof e.settings.horizontalPageBreakRepeat=="number")&&(E=[e.settings.horizontalPageBreakRepeat]),E.forEach(function(G){var U=e.columns.find(function(ie){return ie.dataKey===G||ie.index===G});U&&!g.has(U.index)&&(g.set(U.index,!0),v.push(U.index),i.push(e.columns[U.index]),d-=U.wrappedWidth)});for(var k=!0,O=(a=s==null?void 0:s.start)!==null&&a!==void 0?a:0;O<e.columns.length;){if(g.has(O)){O++;continue}var z=e.columns[O].wrappedWidth;if(k||d>=z)k=!1,v.push(O),i.push(e.columns[O]),d-=z;else break;O++}return{colIndexes:v,columns:i,lastIndex:O-1}}function dK(t,e){for(var s=[],a=0;a<e.columns.length;a++){var d=hK(t,e,{start:a});d.columns.length&&(s.push(d),a=d.lastIndex)}return s}function Iz(t,e){var s=e.settings,a=s.startY,d=s.margin,g={x:d.left,y:a},v=e.getHeadHeight(e.columns)+e.getFootHeight(e.columns),i=a+d.bottom+v;if(s.pageBreak==="avoid"){var E=e.body,k=E.reduce(function(G,U){return G+U.height},0);i+=k}var O=new R_(t);(s.pageBreak==="always"||s.startY!=null&&i>O.pageSize().height)&&(kz(O),g.y=d.top),e.callWillDrawPageHooks(O,g);var z=tf({},g);e.startPageNumber=O.pageNumber(),s.horizontalPageBreak?fK(O,e,z,g):(O.applyStyles(O.userStyles),(s.showHead==="firstPage"||s.showHead==="everyPage")&&e.head.forEach(function(G){return pf(O,e,G,g,e.columns)}),O.applyStyles(O.userStyles),e.body.forEach(function(G,U){var ie=U===e.body.length-1;Db(O,e,G,ie,z,g,e.columns)}),O.applyStyles(O.userStyles),(s.showFoot==="lastPage"||s.showFoot==="everyPage")&&e.foot.forEach(function(G){return pf(O,e,G,g,e.columns)})),bz(O,e,z,g),e.callEndPageHooks(O,g),e.finalY=g.y,t.lastAutoTable=e,O.applyStyles(O.userStyles)}function fK(t,e,s,a){var d=dK(t,e),g=e.settings;if(g.horizontalPageBreakBehaviour==="afterAllRows")d.forEach(function(k,O){t.applyStyles(t.userStyles),O>0?$y(t,e,s,a,k.columns,!0):mL(t,e,a,k.columns),pK(t,e,s,a,k.columns),nS(t,e,a,k.columns)});else for(var v=-1,i=d[0],E=function(){var k=v;if(i){t.applyStyles(t.userStyles);var O=i.columns;v>=0?$y(t,e,s,a,O,!0):mL(t,e,a,O),k=gL(t,e,v+1,a,O),nS(t,e,a,O)}var z=k-v;d.slice(1).forEach(function(G){t.applyStyles(t.userStyles),$y(t,e,s,a,G.columns,!0),gL(t,e,v+1,a,G.columns,z),nS(t,e,a,G.columns)}),v=k};v<e.body.length-1;)E()}function mL(t,e,s,a){var d=e.settings;t.applyStyles(t.userStyles),(d.showHead==="firstPage"||d.showHead==="everyPage")&&e.head.forEach(function(g){return pf(t,e,g,s,a)})}function pK(t,e,s,a,d){t.applyStyles(t.userStyles),e.body.forEach(function(g,v){var i=v===e.body.length-1;Db(t,e,g,i,s,a,d)})}function gL(t,e,s,a,d,g){t.applyStyles(t.userStyles),g=g??e.body.length;var v=Math.min(s+g,e.body.length),i=-1;return e.body.slice(s,v).forEach(function(E,k){var O=s+k===e.body.length-1,z=Lz(t,e,O,a);E.canEntireRowFit(z,d)&&(pf(t,e,E,a,d),i=s+k)}),i}function nS(t,e,s,a){var d=e.settings;t.applyStyles(t.userStyles),(d.showFoot==="lastPage"||d.showFoot==="everyPage")&&e.foot.forEach(function(g){return pf(t,e,g,s,a)})}function mK(t,e,s){var a=s.getLineHeight(t.styles.fontSize),d=t.padding("vertical"),g=Math.floor((e-d)/a);return Math.max(0,g)}function gK(t,e,s,a){var d={};t.spansMultiplePages=!0,t.height=0;for(var g=0,v=0,i=s.columns;v<i.length;v++){var E=i[v],k=t.cells[E.index];if(k){Array.isArray(k.text)||(k.text=[k.text]);var O=new Pz(k.raw,k.styles,k.section);O=tf(O,k),O.text=[];var z=mK(k,e,a);k.text.length>z&&(O.text=k.text.splice(z,k.text.length));var G=a.scaleFactor(),U=a.getLineHeightFactor();k.contentHeight=k.getContentHeight(G,U),k.contentHeight>=e&&(k.contentHeight=e,O.styles.minCellHeight-=e),k.contentHeight>t.height&&(t.height=k.contentHeight),O.contentHeight=O.getContentHeight(G,U),O.contentHeight>g&&(g=O.contentHeight),d[E.index]=O}}var ie=new Cz(t.raw,-1,t.section,d,!0);ie.height=g;for(var Q=0,se=s.columns;Q<se.length;Q++){var E=se[Q],O=ie.cells[E.index];O&&(O.height=ie.height);var k=t.cells[E.index];k&&(k.height=t.height)}return ie}function _K(t,e,s,a){var d=t.pageSize().height,g=a.settings.margin,v=g.top+g.bottom,i=d-v;e.section==="body"&&(i-=a.getHeadHeight(a.columns)+a.getFootHeight(a.columns));var E=e.getMinimumRowHeight(a.columns,t),k=E<s;if(E>i)return console.error("Will not be able to print row ".concat(e.index," correctly since it's minimum height is larger than page height")),!0;if(!k)return!1;var O=e.hasRowSpan(a.columns),z=e.getMaxCellHeight(a.columns)>i;return z?(O&&console.error("The content of row ".concat(e.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(O||a.settings.rowPageBreak==="avoid")}function Db(t,e,s,a,d,g,v){var i=Lz(t,e,a,g);if(s.canEntireRowFit(i,v))pf(t,e,s,g,v);else if(_K(t,s,i,e)){var E=gK(s,i,e,t);pf(t,e,s,g,v),$y(t,e,d,g,v),Db(t,e,E,a,d,g,v)}else $y(t,e,d,g,v),Db(t,e,s,a,d,g,v)}function pf(t,e,s,a,d){a.x=e.settings.margin.left;for(var g=0,v=d;g<v.length;g++){var i=v[g],E=s.cells[i.index];if(!E){a.x+=i.width;continue}t.applyStyles(E.styles),E.x=a.x,E.y=a.y;var k=e.callCellHooks(t,e.hooks.willDrawCell,E,s,i,a);if(k===!1){a.x+=i.width;continue}yK(t,E,a);var O=E.getTextPos();yz(E.text,O.x,O.y,{halign:E.styles.halign,valign:E.styles.valign,maxWidth:Math.ceil(E.width-E.padding("left")-E.padding("right"))},t.getDocument()),e.callCellHooks(t,e.hooks.didDrawCell,E,s,i,a),a.x+=i.width}a.y+=s.height}function yK(t,e,s){var a=e.styles;if(t.getDocument().setFillColor(t.getDocument().getFillColor()),typeof a.lineWidth=="number"){var d=wz(a.lineWidth,a.fillColor);d&&t.rect(e.x,s.y,e.width,e.height,d)}else typeof a.lineWidth=="object"&&(a.fillColor&&t.rect(e.x,s.y,e.width,e.height,"F"),vK(t,e,s,a.lineWidth))}function vK(t,e,s,a){var d,g,v,i;a.top&&(d=s.x,g=s.y,v=s.x+e.width,i=s.y,a.right&&(v+=.5*a.right),a.left&&(d-=.5*a.left),E(a.top,d,g,v,i)),a.bottom&&(d=s.x,g=s.y+e.height,v=s.x+e.width,i=s.y+e.height,a.right&&(v+=.5*a.right),a.left&&(d-=.5*a.left),E(a.bottom,d,g,v,i)),a.left&&(d=s.x,g=s.y,v=s.x,i=s.y+e.height,a.top&&(g-=.5*a.top),a.bottom&&(i+=.5*a.bottom),E(a.left,d,g,v,i)),a.right&&(d=s.x+e.width,g=s.y,v=s.x+e.width,i=s.y+e.height,a.top&&(g-=.5*a.top),a.bottom&&(i+=.5*a.bottom),E(a.right,d,g,v,i));function E(k,O,z,G,U){t.getDocument().setLineWidth(k),t.getDocument().line(O,z,G,U,"S")}}function Lz(t,e,s,a){var d=e.settings.margin.bottom,g=e.settings.showFoot;return(g==="everyPage"||g==="lastPage"&&s)&&(d+=e.getFootHeight(e.columns)),t.pageSize().height-a.y-d}function $y(t,e,s,a,d,g){d===void 0&&(d=[]),g===void 0&&(g=!1),t.applyStyles(t.userStyles),e.settings.showFoot==="everyPage"&&!g&&e.foot.forEach(function(i){return pf(t,e,i,a,d)}),e.callEndPageHooks(t,a);var v=e.settings.margin;bz(t,e,s,a),kz(t),e.pageNumber++,a.x=v.left,a.y=v.top,s.y=v.top,e.callWillDrawPageHooks(t,a),e.settings.showHead==="everyPage"&&(e.head.forEach(function(i){return pf(t,e,i,a,d)}),t.applyStyles(t.userStyles))}function kz(t){var e=t.pageNumber();t.setPage(e+1);var s=t.pageNumber();return s===e?(t.addPage(),!0):!1}function xK(t){t.API.autoTable=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];var a=e[0],d=Ez(this,a),g=Mz(this,d);return Iz(this,g),this},t.API.lastAutoTable=!1,t.API.autoTableText=function(e,s,a,d){yz(e,s,a,d,this)},t.API.autoTableSetDefaults=function(e){return R_.setDefaults(e,this),this},t.autoTableSetDefaults=function(e,s){R_.setDefaults(e,s)},t.API.autoTableHtmlToJson=function(e,s){var a;if(s===void 0&&(s=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var d=new R_(this),g=Az(d,e,window,s,!1),v=g.head,i=g.body,E=((a=v[0])===null||a===void 0?void 0:a.map(function(k){return k.content}))||[];return{columns:E,rows:i,data:i}}}var rS;function bK(t,e){var s=Ez(t,e),a=Mz(t,s);Iz(t,a)}try{if(typeof window<"u"&&window){var _L=window,yL=_L.jsPDF||((rS=_L.jspdf)===null||rS===void 0?void 0:rS.jsPDF);yL&&xK(yL)}}catch(t){console.error("Could not apply autoTable plugin",t)}function y_({data:t,isLoading:e,onShowDetails:s,uf:a="TODOS"}){const[d,g]=ge.useState(1),[v,i]=ge.useState(!1),[E,k]=ge.useState("asc"),O=10,z=Math.ceil(t.length/O),G=(d-1)*O,U=v?[...t].sort((te,le)=>{var rt,xe;const ye=((rt=te.prestadores[0])==null?void 0:rt.distancia)??Number.MAX_VALUE,Ne=((xe=le.prestadores[0])==null?void 0:xe.distancia)??Number.MAX_VALUE;return E==="asc"?ye-Ne:Ne-ye}):t,ie=U.slice(G,G+O),Q=()=>{switch(a){case"SP":return"Relatório de Proximidade - São Paulo";case"RJ":return"Relatório de Proximidade - Rio de Janeiro";case"DF":return"Relatório de Proximidade - Distrito Federal";default:return"Relatório de Proximidade Cliente-Prestador"}},se=()=>{const te=new Qr;te.setFontSize(18),te.text(Q(),14,22);const le=new Date().toLocaleDateString("pt-BR");te.setFontSize(12),te.text(`Gerado em: ${le}`,14,30);const ye=U.flatMap(rt=>rt.prestadores.map(xe=>[rt.cliente.nome,rt.cliente.uf,xe.ranking===1?xe.nome:"",xe.ranking===1?`${xe.distancia.toFixed(1)} km`:"",xe.ranking===2?xe.nome:"",xe.ranking===2?`${xe.distancia.toFixed(1)} km`:""]));bK(te,{startY:40,head:[["Cliente","UF","Prestador #1","Distância","Prestador #2","Distância"]],body:ye,theme:"grid",styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[37,99,235]}});const Ne=a!=="TODOS"?`relatorio-proximidade-${a.toLowerCase()}.pdf`:"relatorio-proximidade.pdf";te.save(Ne)},J=()=>{const le=[["Cliente","UF","Prestador #1","Distância (km)","Prestador #2","Distância (km)"]];U.forEach(it=>{var ve,Le,dt,Je;const ot=[it.cliente.nome,it.cliente.uf,((ve=it.prestadores[0])==null?void 0:ve.nome)||"",((Le=it.prestadores[0])==null?void 0:Le.distancia.toFixed(1))||"",((dt=it.prestadores[1])==null?void 0:dt.nome)||"",((Je=it.prestadores[1])==null?void 0:Je.distancia.toFixed(1))||""];le.push(ot)});const ye=le.map(it=>it.join(",")).join(`
`),Ne=new Blob([ye],{type:"text/csv;charset=utf-8;"}),rt=URL.createObjectURL(Ne),xe=document.createElement("a");xe.setAttribute("href",rt);const Me=a!=="TODOS"?`relatorio-proximidade-${a.toLowerCase()}.csv`:"relatorio-proximidade.csv";xe.setAttribute("download",Me),document.body.appendChild(xe),xe.click(),document.body.removeChild(xe)};return V.jsxs("div",{className:"bg-white rounded-lg shadow",children:[V.jsxs("div",{className:"p-4 border-b border-slate-200 flex justify-between items-center",children:[V.jsx("h3",{className:"font-semibold text-slate-700",children:Q()}),V.jsxs("div",{className:"flex space-x-2",children:[V.jsxs(qs,{variant:v?"secondary":"outline",size:"sm",className:"flex items-center",onClick:()=>i(!v),children:[V.jsx("span",{className:"mr-1",children:"Ordenar por Distância"}),v?V.jsx(Ux,{className:"h-4 w-4"}):V.jsx(x4,{className:"h-4 w-4"})]}),V.jsxs(qs,{variant:"outline",size:"sm",className:"flex items-center",onClick:se,children:[V.jsx(rN,{className:"h-4 w-4 mr-1"}),"Exportar PDF"]}),V.jsxs(qs,{variant:"outline",size:"sm",className:"flex items-center",onClick:J,children:[V.jsx($q,{className:"h-4 w-4 mr-1"}),"Exportar CSV"]})]})]}),V.jsx("div",{className:"overflow-x-auto",children:V.jsxs(ZO,{children:[V.jsx(KO,{children:V.jsxs(Iy,{children:[V.jsx(ep,{children:"Cliente"}),V.jsx(ep,{children:"UF"}),V.jsx(ep,{children:"Prestador #1"}),V.jsx(ep,{children:V.jsxs("div",{className:"flex items-center gap-1",children:["Distância",V.jsx("button",{"aria-label":`Ordenar por distância (${E==="asc"?"crescente":"decrescente"})`,className:"ml-1 text-blue-500 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300 rounded",onClick:()=>{v?k(te=>te==="asc"?"desc":"asc"):(i(!0),k("asc"))},"aria-pressed":v,children:v?E==="asc"?V.jsx(Ux,{className:"w-4 h-4 inline","aria-label":"Ordem crescente"}):V.jsx(Ux,{className:"w-4 h-4 inline rotate-180","aria-label":"Ordem decrescente"}):V.jsx(x4,{className:"w-4 h-4 inline","aria-label":"Sem ordenação"})})]})}),V.jsx(ep,{children:"Prestador #2"}),V.jsx(ep,{children:"Distância"}),V.jsx(ep,{children:"Ações"})]})}),V.jsx(XO,{children:e?V.jsx(Iy,{children:V.jsxs($h,{colSpan:7,className:"text-center py-8",children:[V.jsx("div",{className:"flex justify-center",children:V.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),V.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Carregando dados..."})]})}):ie.length===0?V.jsx(Iy,{children:V.jsx($h,{colSpan:7,className:"text-center py-8 text-slate-500",children:a!=="TODOS"?`Nenhum cliente encontrado em ${a}`:"Nenhum dado disponível"})}):ie.map(te=>V.jsxs(Iy,{className:v?"transition-colors duration-200":"",children:[V.jsx($h,{children:V.jsxs("div",{className:"flex items-center",children:[V.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-500",children:te.cliente.iniciais||te.cliente.nome.substring(0,2)}),V.jsxs("div",{className:"ml-4",children:[V.jsx("div",{className:"text-sm font-medium text-slate-900",children:te.cliente.nome}),V.jsxs("div",{className:"text-sm text-slate-500",children:["ID: ",te.cliente.id]})]})]})}),V.jsx($h,{children:V.jsx("div",{className:"text-sm text-slate-900",children:te.cliente.uf})}),te.prestadores[0]&&V.jsxs(V.Fragment,{children:[V.jsxs($h,{children:[V.jsx("div",{className:"text-sm text-slate-900",children:te.prestadores[0].nome}),V.jsx("div",{className:"text-xs text-slate-500",children:te.prestadores[0].local})]}),V.jsx($h,{children:V.jsxs("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${v?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:[te.prestadores[0].distancia.toFixed(1)," km"]})})]}),te.prestadores[1]&&V.jsxs(V.Fragment,{children:[V.jsxs($h,{children:[V.jsx("div",{className:"text-sm text-slate-900",children:te.prestadores[1].nome}),V.jsx("div",{className:"text-xs text-slate-500",children:te.prestadores[1].local})]}),V.jsx($h,{children:V.jsxs("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:[te.prestadores[1].distancia.toFixed(1)," km"]})})]}),V.jsx($h,{children:V.jsx("button",{className:"text-primary hover:text-blue-700 text-sm",onClick:()=>{var le;return s(te.cliente.id,((le=te.prestadores[0])==null?void 0:le.id)||0)},children:"Detalhes"})})]},te.cliente.id))})]})}),V.jsx("div",{className:"px-6 py-4 bg-slate-50 border-t border-slate-200",children:V.jsxs("div",{className:"flex items-center justify-between",children:[V.jsx("div",{className:"text-sm text-slate-700",children:t.length>0?V.jsxs(V.Fragment,{children:["Mostrando ",V.jsx("span",{className:"font-medium",children:G+1})," a ",V.jsx("span",{className:"font-medium",children:Math.min(G+O,t.length)})," de ",V.jsx("span",{className:"font-medium",children:t.length})," resultados"]}):V.jsx("span",{children:"Sem resultados para exibir"})}),V.jsxs("div",{className:"flex space-x-2",children:[V.jsx(qs,{variant:"outline",size:"sm",disabled:d===1||t.length===0,onClick:()=>g(d-1),children:"Anterior"}),V.jsx(qs,{variant:"outline",size:"sm",disabled:d===z||t.length===0,onClick:()=>g(d+1),children:"Próximo"})]})]})})]})}var zA="Dialog",[Rz,XQ]=Vp(zA),[wK,_h]=Rz(zA),Dz=t=>{const{__scopeDialog:e,children:s,open:a,defaultOpen:d,onOpenChange:g,modal:v=!0}=t,i=ge.useRef(null),E=ge.useRef(null),[k=!1,O]=hf({prop:a,defaultProp:d,onChange:g});return V.jsx(wK,{scope:e,triggerRef:i,contentRef:E,contentId:id(),titleId:id(),descriptionId:id(),open:k,onOpenChange:O,onOpenToggle:ge.useCallback(()=>O(z=>!z),[O]),modal:v,children:s})};Dz.displayName=zA;var Nz="DialogTrigger",Oz=ge.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,d=_h(Nz,s),g=ji(e,d.triggerRef);return V.jsx(Zr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":jA(d.open),...a,ref:g,onClick:nr(t.onClick,d.onOpenToggle)})});Oz.displayName=Nz;var FA="DialogPortal",[SK,zz]=Rz(FA,{forceMount:void 0}),Fz=t=>{const{__scopeDialog:e,forceMount:s,children:a,container:d}=t,g=_h(FA,e);return V.jsx(SK,{scope:e,forceMount:s,children:ge.Children.map(a,v=>V.jsx(cd,{present:s||g.open,children:V.jsx(kv,{asChild:!0,container:d,children:v})}))})};Fz.displayName=FA;var Nb="DialogOverlay",Bz=ge.forwardRef((t,e)=>{const s=zz(Nb,t.__scopeDialog),{forceMount:a=s.forceMount,...d}=t,g=_h(Nb,t.__scopeDialog);return g.modal?V.jsx(cd,{present:a||g.open,children:V.jsx(TK,{...d,ref:e})}):null});Bz.displayName=Nb;var TK=ge.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,d=_h(Nb,s);return V.jsx(dw,{as:kp,allowPinchZoom:!0,shards:[d.contentRef],children:V.jsx(Zr.div,{"data-state":jA(d.open),...a,ref:e,style:{pointerEvents:"auto",...a.style}})})}),ag="DialogContent",jz=ge.forwardRef((t,e)=>{const s=zz(ag,t.__scopeDialog),{forceMount:a=s.forceMount,...d}=t,g=_h(ag,t.__scopeDialog);return V.jsx(cd,{present:a||g.open,children:g.modal?V.jsx(AK,{...d,ref:e}):V.jsx(EK,{...d,ref:e})})});jz.displayName=ag;var AK=ge.forwardRef((t,e)=>{const s=_h(ag,t.__scopeDialog),a=ge.useRef(null),d=ji(e,s.contentRef,a);return ge.useEffect(()=>{const g=a.current;if(g)return LA(g)},[]),V.jsx(Uz,{...t,ref:d,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:nr(t.onCloseAutoFocus,g=>{var v;g.preventDefault(),(v=s.triggerRef.current)==null||v.focus()}),onPointerDownOutside:nr(t.onPointerDownOutside,g=>{const v=g.detail.originalEvent,i=v.button===0&&v.ctrlKey===!0;(v.button===2||i)&&g.preventDefault()}),onFocusOutside:nr(t.onFocusOutside,g=>g.preventDefault())})}),EK=ge.forwardRef((t,e)=>{const s=_h(ag,t.__scopeDialog),a=ge.useRef(!1),d=ge.useRef(!1);return V.jsx(Uz,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:g=>{var v,i;(v=t.onCloseAutoFocus)==null||v.call(t,g),g.defaultPrevented||(a.current||(i=s.triggerRef.current)==null||i.focus(),g.preventDefault()),a.current=!1,d.current=!1},onInteractOutside:g=>{var E,k;(E=t.onInteractOutside)==null||E.call(t,g),g.defaultPrevented||(a.current=!0,g.detail.originalEvent.type==="pointerdown"&&(d.current=!0));const v=g.target;((k=s.triggerRef.current)==null?void 0:k.contains(v))&&g.preventDefault(),g.detail.originalEvent.type==="focusin"&&d.current&&g.preventDefault()}})}),Uz=ge.forwardRef((t,e)=>{const{__scopeDialog:s,trapFocus:a,onOpenAutoFocus:d,onCloseAutoFocus:g,...v}=t,i=_h(ag,s),E=ge.useRef(null),k=ji(e,E);return vA(),V.jsxs(V.Fragment,{children:[V.jsx(ow,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:d,onUnmountAutoFocus:g,children:V.jsx(Lv,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":jA(i.open),...v,ref:k,onDismiss:()=>i.onOpenChange(!1)})}),V.jsxs(V.Fragment,{children:[V.jsx(CK,{titleId:i.titleId}),V.jsx(MK,{contentRef:E,descriptionId:i.descriptionId})]})]})}),BA="DialogTitle",Vz=ge.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,d=_h(BA,s);return V.jsx(Zr.h2,{id:d.titleId,...a,ref:e})});Vz.displayName=BA;var qz="DialogDescription",$z=ge.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,d=_h(qz,s);return V.jsx(Zr.p,{id:d.descriptionId,...a,ref:e})});$z.displayName=qz;var Gz="DialogClose",Hz=ge.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,d=_h(Gz,s);return V.jsx(Zr.button,{type:"button",...a,ref:e,onClick:nr(t.onClick,()=>d.onOpenChange(!1))})});Hz.displayName=Gz;function jA(t){return t?"open":"closed"}var Wz="DialogTitleWarning",[YQ,Zz]=Y9(Wz,{contentName:ag,titleName:BA,docsSlug:"dialog"}),CK=({titleId:t})=>{const e=Zz(Wz),s=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return ge.useEffect(()=>{t&&(document.getElementById(t)||console.error(s))},[s,t]),null},PK="DialogDescriptionWarning",MK=({contentRef:t,descriptionId:e})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Zz(PK).contentName}}.`;return ge.useEffect(()=>{var g;const d=(g=t.current)==null?void 0:g.getAttribute("aria-describedby");e&&d&&(document.getElementById(e)||console.warn(a))},[a,t,e]),null},IK=Dz,LK=Oz,kK=Fz,Kz=Bz,Xz=jz,Yz=Vz,Jz=$z,RK=Hz;const Qz=IK,DK=LK,NK=kK,eF=ge.forwardRef(({className:t,...e},s)=>V.jsx(Kz,{ref:s,className:jr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));eF.displayName=Kz.displayName;const UA=ge.forwardRef(({className:t,children:e,...s},a)=>V.jsxs(NK,{children:[V.jsx(eF,{}),V.jsxs(Xz,{ref:a,className:jr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[e,V.jsxs(RK,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[V.jsx(gA,{className:"h-4 w-4"}),V.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));UA.displayName=Xz.displayName;const VA=({className:t,...e})=>V.jsx("div",{className:jr("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});VA.displayName="DialogHeader";const qA=({className:t,...e})=>V.jsx("div",{className:jr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});qA.displayName="DialogFooter";const $A=ge.forwardRef(({className:t,...e},s)=>V.jsx(Yz,{ref:s,className:jr("text-lg font-semibold leading-none tracking-tight",t),...e}));$A.displayName=Yz.displayName;const tF=ge.forwardRef(({className:t,...e},s)=>V.jsx(Jz,{ref:s,className:jr("text-sm text-muted-foreground",t),...e}));tF.displayName=Jz.displayName;function GA({isOpen:t,onClose:e,clientData:s,prestadorData:a,distanceData:d,onGenerateReport:g}){return!s||!a?null:V.jsx(Qz,{open:t,onOpenChange:e,children:V.jsxs(UA,{className:"sm:max-w-2xl",children:[V.jsx(VA,{children:V.jsxs("div",{className:"flex justify-between items-center",children:[V.jsx($A,{className:"text-lg font-semibold text-slate-800",children:"Detalhes da Análise"}),V.jsx(qs,{variant:"ghost",size:"icon",onClick:e,children:V.jsx(gA,{className:"h-4 w-4"})})]})}),V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[V.jsxs("div",{children:[V.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Informações do Cliente"}),V.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Nome:"})," ",V.jsx("span",{className:"text-sm text-slate-600",children:s.nome})]}),V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"ID:"})," ",V.jsx("span",{className:"text-sm text-slate-600",children:s.id})]}),V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"UF:"})," ",V.jsx("span",{className:"text-sm text-slate-600",children:s.uf})]}),s.cep&&V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"CEP:"})," ",V.jsx("span",{className:"text-sm text-slate-600",children:s.cep})]}),s.latitude&&s.longitude&&V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Coordenadas:"})," ",V.jsxs("span",{className:"text-sm text-slate-600",children:[s.latitude,", ",s.longitude]})]})]})]}),V.jsxs("div",{children:[V.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Informações do Prestador"}),V.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Nome:"})," ",V.jsx("span",{className:"text-sm text-slate-600",children:a.nome})]}),V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"ID:"})," ",V.jsx("span",{className:"text-sm text-slate-600",children:a.id})]}),V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"UF:"})," ",V.jsx("span",{className:"text-sm text-slate-600",children:a.uf})]}),a.cep&&V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"CEP:"})," ",V.jsx("span",{className:"text-sm text-slate-600",children:a.cep})]}),a.latitude&&a.longitude&&V.jsxs("p",{children:[V.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Coordenadas:"})," ",V.jsxs("span",{className:"text-sm text-slate-600",children:[a.latitude,", ",a.longitude]})]})]})]})]}),d&&V.jsxs("div",{className:"mt-4",children:[V.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Detalhes da Distância"}),V.jsx("div",{className:"bg-slate-50 p-3 rounded-lg",children:V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[V.jsxs("div",{children:[V.jsx("p",{className:"text-xs text-slate-500",children:"Distância Euclidiana"}),V.jsxs("p",{className:"text-base font-medium text-slate-800",children:[(d.distanciaEuclidiana||d.distanciaKm-.2).toFixed(1)," km"]})]}),V.jsxs("div",{children:[V.jsx("p",{className:"text-xs text-slate-500",children:"Distância por Rodovia"}),V.jsxs("p",{className:"text-base font-medium text-slate-800",children:[d.distanciaKm.toFixed(1)," km"]})]}),V.jsxs("div",{children:[V.jsx("p",{className:"text-xs text-slate-500",children:"Tempo Estimado"}),V.jsx("p",{className:"text-base font-medium text-slate-800",children:d.tempoEstimado||Math.round(d.distanciaKm*2)+" min"})]})]})})]}),V.jsxs("div",{className:"mt-4",children:[V.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Mapa de Rota"}),V.jsx("div",{className:"h-64 bg-slate-200 rounded-lg flex items-center justify-center",children:V.jsx("p",{className:"text-slate-500",children:"Mapa de rota seria exibido aqui"})})]}),V.jsxs(qA,{className:"flex justify-end space-x-2 border-t border-slate-200 pt-4 mt-4",children:[V.jsx(qs,{variant:"outline",onClick:e,children:"Fechar"}),V.jsx(qs,{onClick:g,children:"Gerar Relatório"})]})]})})}function OK(t,e=[]){let s=[];function a(g,v){const i=ge.createContext(v),E=s.length;s=[...s,v];function k(z){const{scope:G,children:U,...ie}=z,Q=(G==null?void 0:G[t][E])||i,se=ge.useMemo(()=>ie,Object.values(ie));return V.jsx(Q.Provider,{value:se,children:U})}function O(z,G){const U=(G==null?void 0:G[t][E])||i,ie=ge.useContext(U);if(ie)return ie;if(v!==void 0)return v;throw new Error(`\`${z}\` must be used within \`${g}\``)}return k.displayName=g+"Provider",[k,O]}const d=()=>{const g=s.map(v=>ge.createContext(v));return function(i){const E=(i==null?void 0:i[t])||g;return ge.useMemo(()=>({[`__scope${t}`]:{...i,[t]:E}}),[i,E])}};return d.scopeName=t,[a,zK(d,...e)]}function zK(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const a=t.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(g){const v=a.reduce((i,{useScope:E,scopeName:k})=>{const z=E(g)[`__scope${k}`];return{...i,...z}},{});return ge.useMemo(()=>({[`__scope${e.scopeName}`]:v}),[v])}};return s.scopeName=e.scopeName,s}var iS="rovingFocusGroup.onEntryFocus",FK={bubbles:!1,cancelable:!0},bw="RovingFocusGroup",[XT,nF,BK]=Iv(bw),[jK,ww]=OK(bw,[BK]),[UK,VK]=jK(bw),rF=ge.forwardRef((t,e)=>V.jsx(XT.Provider,{scope:t.__scopeRovingFocusGroup,children:V.jsx(XT.Slot,{scope:t.__scopeRovingFocusGroup,children:V.jsx(qK,{...t,ref:e})})}));rF.displayName=bw;var qK=ge.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:s,orientation:a,loop:d=!1,dir:g,currentTabStopId:v,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:E,onEntryFocus:k,preventScrollOnEntryFocus:O=!1,...z}=t,G=ge.useRef(null),U=ji(e,G),ie=Rv(g),[Q=null,se]=hf({prop:v,defaultProp:i,onChange:E}),[J,te]=ge.useState(!1),le=fl(k),ye=nF(s),Ne=ge.useRef(!1),[rt,xe]=ge.useState(0);return ge.useEffect(()=>{const Me=G.current;if(Me)return Me.addEventListener(iS,le),()=>Me.removeEventListener(iS,le)},[le]),V.jsx(UK,{scope:s,orientation:a,dir:ie,loop:d,currentTabStopId:Q,onItemFocus:ge.useCallback(Me=>se(Me),[se]),onItemShiftTab:ge.useCallback(()=>te(!0),[]),onFocusableItemAdd:ge.useCallback(()=>xe(Me=>Me+1),[]),onFocusableItemRemove:ge.useCallback(()=>xe(Me=>Me-1),[]),children:V.jsx(Zr.div,{tabIndex:J||rt===0?-1:0,"data-orientation":a,...z,ref:U,style:{outline:"none",...t.style},onMouseDown:nr(t.onMouseDown,()=>{Ne.current=!0}),onFocus:nr(t.onFocus,Me=>{const it=!Ne.current;if(Me.target===Me.currentTarget&&it&&!J){const ot=new CustomEvent(iS,FK);if(Me.currentTarget.dispatchEvent(ot),!ot.defaultPrevented){const ve=ye().filter(St=>St.focusable),Le=ve.find(St=>St.active),dt=ve.find(St=>St.id===Q),yt=[Le,dt,...ve].filter(Boolean).map(St=>St.ref.current);oF(yt,O)}}Ne.current=!1}),onBlur:nr(t.onBlur,()=>te(!1))})})}),iF="RovingFocusGroupItem",sF=ge.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:s,focusable:a=!0,active:d=!1,tabStopId:g,...v}=t,i=id(),E=g||i,k=VK(iF,s),O=k.currentTabStopId===E,z=nF(s),{onFocusableItemAdd:G,onFocusableItemRemove:U}=k;return ge.useEffect(()=>{if(a)return G(),()=>U()},[a,G,U]),V.jsx(XT.ItemSlot,{scope:s,id:E,focusable:a,active:d,children:V.jsx(Zr.span,{tabIndex:O?0:-1,"data-orientation":k.orientation,...v,ref:e,onMouseDown:nr(t.onMouseDown,ie=>{a?k.onItemFocus(E):ie.preventDefault()}),onFocus:nr(t.onFocus,()=>k.onItemFocus(E)),onKeyDown:nr(t.onKeyDown,ie=>{if(ie.key==="Tab"&&ie.shiftKey){k.onItemShiftTab();return}if(ie.target!==ie.currentTarget)return;const Q=HK(ie,k.orientation,k.dir);if(Q!==void 0){if(ie.metaKey||ie.ctrlKey||ie.altKey||ie.shiftKey)return;ie.preventDefault();let J=z().filter(te=>te.focusable).map(te=>te.ref.current);if(Q==="last")J.reverse();else if(Q==="prev"||Q==="next"){Q==="prev"&&J.reverse();const te=J.indexOf(ie.currentTarget);J=k.loop?WK(J,te+1):J.slice(te+1)}setTimeout(()=>oF(J))}})})})});sF.displayName=iF;var $K={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function GK(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function HK(t,e,s){const a=GK(t.key,s);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return $K[a]}function oF(t,e=!1){const s=document.activeElement;for(const a of t)if(a===s||(a.focus({preventScroll:e}),document.activeElement!==s))return}function WK(t,e){return t.map((s,a)=>t[(e+a)%t.length])}var aF=rF,lF=sF,YT=["Enter"," "],ZK=["ArrowDown","PageUp","Home"],cF=["ArrowUp","PageDown","End"],KK=[...ZK,...cF],XK={ltr:[...YT,"ArrowRight"],rtl:[...YT,"ArrowLeft"]},YK={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ov="Menu",[_v,JK,QK]=Iv(Ov),[dg,uF]=Vp(Ov,[QK,uw,ww]),Sw=uw(),hF=ww(),[eX,fg]=dg(Ov),[tX,zv]=dg(Ov),dF=t=>{const{__scopeMenu:e,open:s=!1,children:a,dir:d,onOpenChange:g,modal:v=!0}=t,i=Sw(e),[E,k]=ge.useState(null),O=ge.useRef(!1),z=fl(g),G=Rv(d);return ge.useEffect(()=>{const U=()=>{O.current=!0,document.addEventListener("pointerdown",ie,{capture:!0,once:!0}),document.addEventListener("pointermove",ie,{capture:!0,once:!0})},ie=()=>O.current=!1;return document.addEventListener("keydown",U,{capture:!0}),()=>{document.removeEventListener("keydown",U,{capture:!0}),document.removeEventListener("pointerdown",ie,{capture:!0}),document.removeEventListener("pointermove",ie,{capture:!0})}},[]),V.jsx(FN,{...i,children:V.jsx(eX,{scope:e,open:s,onOpenChange:z,content:E,onContentChange:k,children:V.jsx(tX,{scope:e,onClose:ge.useCallback(()=>z(!1),[z]),isUsingKeyboardRef:O,dir:G,modal:v,children:a})})})};dF.displayName=Ov;var nX="MenuAnchor",HA=ge.forwardRef((t,e)=>{const{__scopeMenu:s,...a}=t,d=Sw(s);return V.jsx(BN,{...d,...a,ref:e})});HA.displayName=nX;var WA="MenuPortal",[rX,fF]=dg(WA,{forceMount:void 0}),pF=t=>{const{__scopeMenu:e,forceMount:s,children:a,container:d}=t,g=fg(WA,e);return V.jsx(rX,{scope:e,forceMount:s,children:V.jsx(cd,{present:s||g.open,children:V.jsx(kv,{asChild:!0,container:d,children:a})})})};pF.displayName=WA;var Su="MenuContent",[iX,ZA]=dg(Su),mF=ge.forwardRef((t,e)=>{const s=fF(Su,t.__scopeMenu),{forceMount:a=s.forceMount,...d}=t,g=fg(Su,t.__scopeMenu),v=zv(Su,t.__scopeMenu);return V.jsx(_v.Provider,{scope:t.__scopeMenu,children:V.jsx(cd,{present:a||g.open,children:V.jsx(_v.Slot,{scope:t.__scopeMenu,children:v.modal?V.jsx(sX,{...d,ref:e}):V.jsx(oX,{...d,ref:e})})})})}),sX=ge.forwardRef((t,e)=>{const s=fg(Su,t.__scopeMenu),a=ge.useRef(null),d=ji(e,a);return ge.useEffect(()=>{const g=a.current;if(g)return LA(g)},[]),V.jsx(KA,{...t,ref:d,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:nr(t.onFocusOutside,g=>g.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),oX=ge.forwardRef((t,e)=>{const s=fg(Su,t.__scopeMenu);return V.jsx(KA,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>s.onOpenChange(!1)})}),KA=ge.forwardRef((t,e)=>{const{__scopeMenu:s,loop:a=!1,trapFocus:d,onOpenAutoFocus:g,onCloseAutoFocus:v,disableOutsidePointerEvents:i,onEntryFocus:E,onEscapeKeyDown:k,onPointerDownOutside:O,onFocusOutside:z,onInteractOutside:G,onDismiss:U,disableOutsideScroll:ie,...Q}=t,se=fg(Su,s),J=zv(Su,s),te=Sw(s),le=hF(s),ye=JK(s),[Ne,rt]=ge.useState(null),xe=ge.useRef(null),Me=ji(e,xe,se.onContentChange),it=ge.useRef(0),ot=ge.useRef(""),ve=ge.useRef(0),Le=ge.useRef(null),dt=ge.useRef("right"),Je=ge.useRef(0),yt=ie?dw:ge.Fragment,St=ie?{as:kp,allowPinchZoom:!0}:void 0,jt=Qe=>{var Ct,Wt;const Xe=ot.current+Qe,Vt=ye().filter(Ft=>!Ft.disabled),be=document.activeElement,Re=(Ct=Vt.find(Ft=>Ft.ref.current===be))==null?void 0:Ct.textValue,Fe=Vt.map(Ft=>Ft.textValue),ut=yX(Fe,Xe,Re),Et=(Wt=Vt.find(Ft=>Ft.textValue===ut))==null?void 0:Wt.ref.current;(function Ft(me){ot.current=me,window.clearTimeout(it.current),me!==""&&(it.current=window.setTimeout(()=>Ft(""),1e3))})(Xe),Et&&setTimeout(()=>Et.focus())};ge.useEffect(()=>()=>window.clearTimeout(it.current),[]),vA();const et=ge.useCallback(Qe=>{var Vt,be;return dt.current===((Vt=Le.current)==null?void 0:Vt.side)&&xX(Qe,(be=Le.current)==null?void 0:be.area)},[]);return V.jsx(iX,{scope:s,searchRef:ot,onItemEnter:ge.useCallback(Qe=>{et(Qe)&&Qe.preventDefault()},[et]),onItemLeave:ge.useCallback(Qe=>{var Xe;et(Qe)||((Xe=xe.current)==null||Xe.focus(),rt(null))},[et]),onTriggerLeave:ge.useCallback(Qe=>{et(Qe)&&Qe.preventDefault()},[et]),pointerGraceTimerRef:ve,onPointerGraceIntentChange:ge.useCallback(Qe=>{Le.current=Qe},[]),children:V.jsx(yt,{...St,children:V.jsx(ow,{asChild:!0,trapped:d,onMountAutoFocus:nr(g,Qe=>{var Xe;Qe.preventDefault(),(Xe=xe.current)==null||Xe.focus({preventScroll:!0})}),onUnmountAutoFocus:v,children:V.jsx(Lv,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:k,onPointerDownOutside:O,onFocusOutside:z,onInteractOutside:G,onDismiss:U,children:V.jsx(aF,{asChild:!0,...le,dir:J.dir,orientation:"vertical",loop:a,currentTabStopId:Ne,onCurrentTabStopIdChange:rt,onEntryFocus:nr(E,Qe=>{J.isUsingKeyboardRef.current||Qe.preventDefault()}),preventScrollOnEntryFocus:!0,children:V.jsx(jN,{role:"menu","aria-orientation":"vertical","data-state":LF(se.open),"data-radix-menu-content":"",dir:J.dir,...te,...Q,ref:Me,style:{outline:"none",...Q.style},onKeyDown:nr(Q.onKeyDown,Qe=>{const Vt=Qe.target.closest("[data-radix-menu-content]")===Qe.currentTarget,be=Qe.ctrlKey||Qe.altKey||Qe.metaKey,Re=Qe.key.length===1;Vt&&(Qe.key==="Tab"&&Qe.preventDefault(),!be&&Re&&jt(Qe.key));const Fe=xe.current;if(Qe.target!==Fe||!KK.includes(Qe.key))return;Qe.preventDefault();const Et=ye().filter(Ct=>!Ct.disabled).map(Ct=>Ct.ref.current);cF.includes(Qe.key)&&Et.reverse(),gX(Et)}),onBlur:nr(t.onBlur,Qe=>{Qe.currentTarget.contains(Qe.target)||(window.clearTimeout(it.current),ot.current="")}),onPointerMove:nr(t.onPointerMove,yv(Qe=>{const Xe=Qe.target,Vt=Je.current!==Qe.clientX;if(Qe.currentTarget.contains(Xe)&&Vt){const be=Qe.clientX>Je.current?"right":"left";dt.current=be,Je.current=Qe.clientX}}))})})})})})})});mF.displayName=Su;var aX="MenuGroup",XA=ge.forwardRef((t,e)=>{const{__scopeMenu:s,...a}=t;return V.jsx(Zr.div,{role:"group",...a,ref:e})});XA.displayName=aX;var lX="MenuLabel",gF=ge.forwardRef((t,e)=>{const{__scopeMenu:s,...a}=t;return V.jsx(Zr.div,{...a,ref:e})});gF.displayName=lX;var Ob="MenuItem",vL="menu.itemSelect",Tw=ge.forwardRef((t,e)=>{const{disabled:s=!1,onSelect:a,...d}=t,g=ge.useRef(null),v=zv(Ob,t.__scopeMenu),i=ZA(Ob,t.__scopeMenu),E=ji(e,g),k=ge.useRef(!1),O=()=>{const z=g.current;if(!s&&z){const G=new CustomEvent(vL,{bubbles:!0,cancelable:!0});z.addEventListener(vL,U=>a==null?void 0:a(U),{once:!0}),uA(z,G),G.defaultPrevented?k.current=!1:v.onClose()}};return V.jsx(_F,{...d,ref:E,disabled:s,onClick:nr(t.onClick,O),onPointerDown:z=>{var G;(G=t.onPointerDown)==null||G.call(t,z),k.current=!0},onPointerUp:nr(t.onPointerUp,z=>{var G;k.current||(G=z.currentTarget)==null||G.click()}),onKeyDown:nr(t.onKeyDown,z=>{const G=i.searchRef.current!=="";s||G&&z.key===" "||YT.includes(z.key)&&(z.currentTarget.click(),z.preventDefault())})})});Tw.displayName=Ob;var _F=ge.forwardRef((t,e)=>{const{__scopeMenu:s,disabled:a=!1,textValue:d,...g}=t,v=ZA(Ob,s),i=hF(s),E=ge.useRef(null),k=ji(e,E),[O,z]=ge.useState(!1),[G,U]=ge.useState("");return ge.useEffect(()=>{const ie=E.current;ie&&U((ie.textContent??"").trim())},[g.children]),V.jsx(_v.ItemSlot,{scope:s,disabled:a,textValue:d??G,children:V.jsx(lF,{asChild:!0,...i,focusable:!a,children:V.jsx(Zr.div,{role:"menuitem","data-highlighted":O?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...g,ref:k,onPointerMove:nr(t.onPointerMove,yv(ie=>{a?v.onItemLeave(ie):(v.onItemEnter(ie),ie.defaultPrevented||ie.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:nr(t.onPointerLeave,yv(ie=>v.onItemLeave(ie))),onFocus:nr(t.onFocus,()=>z(!0)),onBlur:nr(t.onBlur,()=>z(!1))})})})}),cX="MenuCheckboxItem",yF=ge.forwardRef((t,e)=>{const{checked:s=!1,onCheckedChange:a,...d}=t;return V.jsx(SF,{scope:t.__scopeMenu,checked:s,children:V.jsx(Tw,{role:"menuitemcheckbox","aria-checked":zb(s)?"mixed":s,...d,ref:e,"data-state":JA(s),onSelect:nr(d.onSelect,()=>a==null?void 0:a(zb(s)?!0:!s),{checkForDefaultPrevented:!1})})})});yF.displayName=cX;var vF="MenuRadioGroup",[uX,hX]=dg(vF,{value:void 0,onValueChange:()=>{}}),xF=ge.forwardRef((t,e)=>{const{value:s,onValueChange:a,...d}=t,g=fl(a);return V.jsx(uX,{scope:t.__scopeMenu,value:s,onValueChange:g,children:V.jsx(XA,{...d,ref:e})})});xF.displayName=vF;var bF="MenuRadioItem",wF=ge.forwardRef((t,e)=>{const{value:s,...a}=t,d=hX(bF,t.__scopeMenu),g=s===d.value;return V.jsx(SF,{scope:t.__scopeMenu,checked:g,children:V.jsx(Tw,{role:"menuitemradio","aria-checked":g,...a,ref:e,"data-state":JA(g),onSelect:nr(a.onSelect,()=>{var v;return(v=d.onValueChange)==null?void 0:v.call(d,s)},{checkForDefaultPrevented:!1})})})});wF.displayName=bF;var YA="MenuItemIndicator",[SF,dX]=dg(YA,{checked:!1}),TF=ge.forwardRef((t,e)=>{const{__scopeMenu:s,forceMount:a,...d}=t,g=dX(YA,s);return V.jsx(cd,{present:a||zb(g.checked)||g.checked===!0,children:V.jsx(Zr.span,{...d,ref:e,"data-state":JA(g.checked)})})});TF.displayName=YA;var fX="MenuSeparator",AF=ge.forwardRef((t,e)=>{const{__scopeMenu:s,...a}=t;return V.jsx(Zr.div,{role:"separator","aria-orientation":"horizontal",...a,ref:e})});AF.displayName=fX;var pX="MenuArrow",EF=ge.forwardRef((t,e)=>{const{__scopeMenu:s,...a}=t,d=Sw(s);return V.jsx(UN,{...d,...a,ref:e})});EF.displayName=pX;var mX="MenuSub",[JQ,CF]=dg(mX),Ly="MenuSubTrigger",PF=ge.forwardRef((t,e)=>{const s=fg(Ly,t.__scopeMenu),a=zv(Ly,t.__scopeMenu),d=CF(Ly,t.__scopeMenu),g=ZA(Ly,t.__scopeMenu),v=ge.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:E}=g,k={__scopeMenu:t.__scopeMenu},O=ge.useCallback(()=>{v.current&&window.clearTimeout(v.current),v.current=null},[]);return ge.useEffect(()=>O,[O]),ge.useEffect(()=>{const z=i.current;return()=>{window.clearTimeout(z),E(null)}},[i,E]),V.jsx(HA,{asChild:!0,...k,children:V.jsx(_F,{id:d.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":d.contentId,"data-state":LF(s.open),...t,ref:nw(e,d.onTriggerChange),onClick:z=>{var G;(G=t.onClick)==null||G.call(t,z),!(t.disabled||z.defaultPrevented)&&(z.currentTarget.focus(),s.open||s.onOpenChange(!0))},onPointerMove:nr(t.onPointerMove,yv(z=>{g.onItemEnter(z),!z.defaultPrevented&&!t.disabled&&!s.open&&!v.current&&(g.onPointerGraceIntentChange(null),v.current=window.setTimeout(()=>{s.onOpenChange(!0),O()},100))})),onPointerLeave:nr(t.onPointerLeave,yv(z=>{var U,ie;O();const G=(U=s.content)==null?void 0:U.getBoundingClientRect();if(G){const Q=(ie=s.content)==null?void 0:ie.dataset.side,se=Q==="right",J=se?-5:5,te=G[se?"left":"right"],le=G[se?"right":"left"];g.onPointerGraceIntentChange({area:[{x:z.clientX+J,y:z.clientY},{x:te,y:G.top},{x:le,y:G.top},{x:le,y:G.bottom},{x:te,y:G.bottom}],side:Q}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>g.onPointerGraceIntentChange(null),300)}else{if(g.onTriggerLeave(z),z.defaultPrevented)return;g.onPointerGraceIntentChange(null)}})),onKeyDown:nr(t.onKeyDown,z=>{var U;const G=g.searchRef.current!=="";t.disabled||G&&z.key===" "||XK[a.dir].includes(z.key)&&(s.onOpenChange(!0),(U=s.content)==null||U.focus(),z.preventDefault())})})})});PF.displayName=Ly;var MF="MenuSubContent",IF=ge.forwardRef((t,e)=>{const s=fF(Su,t.__scopeMenu),{forceMount:a=s.forceMount,...d}=t,g=fg(Su,t.__scopeMenu),v=zv(Su,t.__scopeMenu),i=CF(MF,t.__scopeMenu),E=ge.useRef(null),k=ji(e,E);return V.jsx(_v.Provider,{scope:t.__scopeMenu,children:V.jsx(cd,{present:a||g.open,children:V.jsx(_v.Slot,{scope:t.__scopeMenu,children:V.jsx(KA,{id:i.contentId,"aria-labelledby":i.triggerId,...d,ref:k,align:"start",side:v.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:O=>{var z;v.isUsingKeyboardRef.current&&((z=E.current)==null||z.focus()),O.preventDefault()},onCloseAutoFocus:O=>O.preventDefault(),onFocusOutside:nr(t.onFocusOutside,O=>{O.target!==i.trigger&&g.onOpenChange(!1)}),onEscapeKeyDown:nr(t.onEscapeKeyDown,O=>{v.onClose(),O.preventDefault()}),onKeyDown:nr(t.onKeyDown,O=>{var U;const z=O.currentTarget.contains(O.target),G=YK[v.dir].includes(O.key);z&&G&&(g.onOpenChange(!1),(U=i.trigger)==null||U.focus(),O.preventDefault())})})})})})});IF.displayName=MF;function LF(t){return t?"open":"closed"}function zb(t){return t==="indeterminate"}function JA(t){return zb(t)?"indeterminate":t?"checked":"unchecked"}function gX(t){const e=document.activeElement;for(const s of t)if(s===e||(s.focus(),document.activeElement!==e))return}function _X(t,e){return t.map((s,a)=>t[(e+a)%t.length])}function yX(t,e,s){const d=e.length>1&&Array.from(e).every(k=>k===e[0])?e[0]:e,g=s?t.indexOf(s):-1;let v=_X(t,Math.max(g,0));d.length===1&&(v=v.filter(k=>k!==s));const E=v.find(k=>k.toLowerCase().startsWith(d.toLowerCase()));return E!==s?E:void 0}function vX(t,e){const{x:s,y:a}=t;let d=!1;for(let g=0,v=e.length-1;g<e.length;v=g++){const i=e[g].x,E=e[g].y,k=e[v].x,O=e[v].y;E>a!=O>a&&s<(k-i)*(a-E)/(O-E)+i&&(d=!d)}return d}function xX(t,e){if(!e)return!1;const s={x:t.clientX,y:t.clientY};return vX(s,e)}function yv(t){return e=>e.pointerType==="mouse"?t(e):void 0}var bX=dF,wX=HA,SX=pF,TX=mF,AX=XA,EX=gF,CX=Tw,PX=yF,MX=xF,IX=wF,LX=TF,kX=AF,RX=EF,DX=PF,NX=IF,QA="DropdownMenu",[OX,QQ]=Vp(QA,[uF]),ql=uF(),[zX,kF]=OX(QA),RF=t=>{const{__scopeDropdownMenu:e,children:s,dir:a,open:d,defaultOpen:g,onOpenChange:v,modal:i=!0}=t,E=ql(e),k=ge.useRef(null),[O=!1,z]=hf({prop:d,defaultProp:g,onChange:v});return V.jsx(zX,{scope:e,triggerId:id(),triggerRef:k,contentId:id(),open:O,onOpenChange:z,onOpenToggle:ge.useCallback(()=>z(G=>!G),[z]),modal:i,children:V.jsx(bX,{...E,open:O,onOpenChange:z,dir:a,modal:i,children:s})})};RF.displayName=QA;var DF="DropdownMenuTrigger",NF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,disabled:a=!1,...d}=t,g=kF(DF,s),v=ql(s);return V.jsx(wX,{asChild:!0,...v,children:V.jsx(Zr.button,{type:"button",id:g.triggerId,"aria-haspopup":"menu","aria-expanded":g.open,"aria-controls":g.open?g.contentId:void 0,"data-state":g.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...d,ref:nw(e,g.triggerRef),onPointerDown:nr(t.onPointerDown,i=>{!a&&i.button===0&&i.ctrlKey===!1&&(g.onOpenToggle(),g.open||i.preventDefault())}),onKeyDown:nr(t.onKeyDown,i=>{a||(["Enter"," "].includes(i.key)&&g.onOpenToggle(),i.key==="ArrowDown"&&g.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});NF.displayName=DF;var FX="DropdownMenuPortal",OF=t=>{const{__scopeDropdownMenu:e,...s}=t,a=ql(e);return V.jsx(SX,{...a,...s})};OF.displayName=FX;var zF="DropdownMenuContent",FF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=kF(zF,s),g=ql(s),v=ge.useRef(!1);return V.jsx(TX,{id:d.contentId,"aria-labelledby":d.triggerId,...g,...a,ref:e,onCloseAutoFocus:nr(t.onCloseAutoFocus,i=>{var E;v.current||(E=d.triggerRef.current)==null||E.focus(),v.current=!1,i.preventDefault()}),onInteractOutside:nr(t.onInteractOutside,i=>{const E=i.detail.originalEvent,k=E.button===0&&E.ctrlKey===!0,O=E.button===2||k;(!d.modal||O)&&(v.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});FF.displayName=zF;var BX="DropdownMenuGroup",jX=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(AX,{...d,...a,ref:e})});jX.displayName=BX;var UX="DropdownMenuLabel",BF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(EX,{...d,...a,ref:e})});BF.displayName=UX;var VX="DropdownMenuItem",jF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(CX,{...d,...a,ref:e})});jF.displayName=VX;var qX="DropdownMenuCheckboxItem",UF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(PX,{...d,...a,ref:e})});UF.displayName=qX;var $X="DropdownMenuRadioGroup",GX=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(MX,{...d,...a,ref:e})});GX.displayName=$X;var HX="DropdownMenuRadioItem",VF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(IX,{...d,...a,ref:e})});VF.displayName=HX;var WX="DropdownMenuItemIndicator",qF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(LX,{...d,...a,ref:e})});qF.displayName=WX;var ZX="DropdownMenuSeparator",$F=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(kX,{...d,...a,ref:e})});$F.displayName=ZX;var KX="DropdownMenuArrow",XX=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(RX,{...d,...a,ref:e})});XX.displayName=KX;var YX="DropdownMenuSubTrigger",GF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(DX,{...d,...a,ref:e})});GF.displayName=YX;var JX="DropdownMenuSubContent",HF=ge.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...a}=t,d=ql(s);return V.jsx(NX,{...d,...a,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});HF.displayName=JX;var QX=RF,eY=NF,tY=OF,WF=FF,ZF=BF,KF=jF,XF=UF,YF=VF,JF=qF,QF=$F,e6=GF,t6=HF;const nY=QX,rY=eY,iY=ge.forwardRef(({className:t,inset:e,children:s,...a},d)=>V.jsxs(e6,{ref:d,className:jr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",e&&"pl-8",t),...a,children:[s,V.jsx(jq,{className:"ml-auto h-4 w-4"})]}));iY.displayName=e6.displayName;const sY=ge.forwardRef(({className:t,...e},s)=>V.jsx(t6,{ref:s,className:jr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e}));sY.displayName=t6.displayName;const n6=ge.forwardRef(({className:t,sideOffset:e=4,...s},a)=>V.jsx(tY,{children:V.jsx(WF,{ref:a,sideOffset:e,className:jr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s})}));n6.displayName=WF.displayName;const Kx=ge.forwardRef(({className:t,inset:e,...s},a)=>V.jsx(KF,{ref:a,className:jr("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...s}));Kx.displayName=KF.displayName;const oY=ge.forwardRef(({className:t,children:e,checked:s,...a},d)=>V.jsxs(XF,{ref:d,className:jr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:s,...a,children:[V.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:V.jsx(JF,{children:V.jsx(mA,{className:"h-4 w-4"})})}),e]}));oY.displayName=XF.displayName;const aY=ge.forwardRef(({className:t,children:e,...s},a)=>V.jsxs(YF,{ref:a,className:jr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[V.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:V.jsx(JF,{children:V.jsx(qq,{className:"h-2 w-2 fill-current"})})}),e]}));aY.displayName=YF.displayName;const r6=ge.forwardRef(({className:t,inset:e,...s},a)=>V.jsx(ZF,{ref:a,className:jr("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...s}));r6.displayName=ZF.displayName;const i6=ge.forwardRef(({className:t,...e},s)=>V.jsx(QF,{ref:s,className:jr("-mx-1 my-1 h-px bg-muted",t),...e}));i6.displayName=QF.displayName;const oa=ge.forwardRef(({className:t,type:e,...s},a)=>V.jsx("input",{type:e,className:jr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...s}));oa.displayName="Input";var lY="Label",s6=ge.forwardRef((t,e)=>V.jsx(Zr.label,{...t,ref:e,onMouseDown:s=>{var d;s.target.closest("button, input, select, textarea")||((d=t.onMouseDown)==null||d.call(t,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));s6.displayName=lY;var o6=s6;const cY=pA("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ss=ge.forwardRef(({className:t,...e},s)=>V.jsx(o6,{ref:s,className:jr(cY(),t),...e}));ss.displayName=o6.displayName;var eE="Switch",[uY,eee]=Vp(eE),[hY,dY]=uY(eE),a6=ge.forwardRef((t,e)=>{const{__scopeSwitch:s,name:a,checked:d,defaultChecked:g,required:v,disabled:i,value:E="on",onCheckedChange:k,form:O,...z}=t,[G,U]=ge.useState(null),ie=ji(e,le=>U(le)),Q=ge.useRef(!1),se=G?O||!!G.closest("form"):!0,[J=!1,te]=hf({prop:d,defaultProp:g,onChange:k});return V.jsxs(hY,{scope:s,checked:J,disabled:i,children:[V.jsx(Zr.button,{type:"button",role:"switch","aria-checked":J,"aria-required":v,"data-state":u6(J),"data-disabled":i?"":void 0,disabled:i,value:E,...z,ref:ie,onClick:nr(t.onClick,le=>{te(ye=>!ye),se&&(Q.current=le.isPropagationStopped(),Q.current||le.stopPropagation())})}),se&&V.jsx(fY,{control:G,bubbles:!Q.current,name:a,value:E,checked:J,required:v,disabled:i,form:O,style:{transform:"translateX(-100%)"}})]})});a6.displayName=eE;var l6="SwitchThumb",c6=ge.forwardRef((t,e)=>{const{__scopeSwitch:s,...a}=t,d=dY(l6,s);return V.jsx(Zr.span,{"data-state":u6(d.checked),"data-disabled":d.disabled?"":void 0,...a,ref:e})});c6.displayName=l6;var fY=t=>{const{control:e,checked:s,bubbles:a=!0,...d}=t,g=ge.useRef(null),v=IA(s),i=CA(e);return ge.useEffect(()=>{const E=g.current,k=window.HTMLInputElement.prototype,z=Object.getOwnPropertyDescriptor(k,"checked").set;if(v!==s&&z){const G=new Event("click",{bubbles:a});z.call(E,s),E.dispatchEvent(G)}},[v,s,a]),V.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...d,tabIndex:-1,ref:g,style:{...t.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function u6(t){return t?"checked":"unchecked"}var h6=a6,pY=c6;const lp=ge.forwardRef(({className:t,...e},s)=>V.jsx(h6,{className:jr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...e,ref:s,children:V.jsx(pY,{className:jr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));lp.displayName=h6.displayName;function Xx(t){const e=window.location.origin,s=new URL("/compartilhado",e);return t.uf&&t.uf!=="Todos"&&s.searchParams.append("uf",t.uf),t.cidade&&t.cidade!=="nenhuma"&&s.searchParams.append("cidade",t.cidade),t.mostrarClientes!==void 0&&s.searchParams.append("clientes",t.mostrarClientes?"1":"0"),t.mostrarPrestadores!==void 0&&s.searchParams.append("prestadores",t.mostrarPrestadores?"1":"0"),t.mostrarRedeAtual!==void 0&&s.searchParams.append("redeAtual",t.mostrarRedeAtual?"1":"0"),t.mostrarBronzeMais!==void 0&&s.searchParams.append("bronzeMais",t.mostrarBronzeMais?"1":"0"),t.mostrarProntoSocorro!==void 0&&s.searchParams.append("prontoSocorro",t.mostrarProntoSocorro?"1":"0"),t.distanciaMaxima!==void 0&&s.searchParams.append("distancia",t.distanciaMaxima.toString()),s.searchParams.append("t",Date.now().toString()),s.toString()}async function mY(t){try{const e=Xx(t);return await navigator.clipboard.writeText(e),!0}catch(e){return console.error("Erro ao copiar link:",e),!1}}function d6({uf:t="Todos",cidade:e,mostrarClientes:s=!0,mostrarPrestadores:a=!0,mostrarRedeAtual:d=!0,mostrarBronzeMais:g=!0,mostrarProntoSocorro:v=!0,distanciaMaxima:i=15,variant:E="default",size:k="default"}){const{toast:O}=l0(),[z,G]=ge.useState(!1),[U,ie]=ge.useState({uf:t,cidade:e,mostrarClientes:s,mostrarPrestadores:a,mostrarRedeAtual:d,mostrarBronzeMais:g,mostrarProntoSocorro:v,distanciaMaxima:i}),[Q,se]=ge.useState(""),[J,te]=ge.useState(!1),le=Object.keys(Rp),ye=()=>{const Me=Xx(U);se(Me)},Ne=async()=>{await mY(U)?(te(!0),O({title:"Link copiado!",description:"O link foi copiado para a área de transferência."}),setTimeout(()=>te(!1),2e3)):O({title:"Erro ao copiar",description:"Não foi possível copiar o link.",variant:"destructive"})},rt=()=>{const Me=Xx(U),it="Relatório de Proximidade e Mapa de Distribuição",ot=`Olá,

Seguem os dados de proximidade entre clientes e prestadores de saúde:

${Me}`;window.open(`mailto:?subject=${encodeURIComponent(it)}&body=${encodeURIComponent(ot)}`)},xe=()=>{const it=`Relatório de Proximidade e Mapa de Distribuição: ${Xx(U)}`;window.open(`https://wa.me/?text=${encodeURIComponent(it)}`)};return V.jsx(V.Fragment,{children:V.jsxs(Qz,{open:z,onOpenChange:G,children:[V.jsx(DK,{asChild:!0,children:V.jsxs(qs,{variant:E,size:k,children:[V.jsx(w4,{className:"w-4 h-4 mr-2"}),"Compartilhar"]})}),V.jsxs(UA,{className:"sm:max-w-lg",children:[V.jsxs(VA,{children:[V.jsx($A,{children:"Compartilhar Relatórios"}),V.jsx(tF,{children:"Gere um link para compartilhar o Mapa de Distribuição e o Relatório de Proximidade."})]}),V.jsxs("div",{className:"grid gap-4 py-4",children:[V.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[V.jsx(ss,{htmlFor:"uf",className:"text-right",children:"UF"}),V.jsxs(Mb,{value:U.uf||"Todos",onValueChange:Me=>ie(it=>({...it,uf:Me})),children:[V.jsx(pv,{className:"col-span-3",children:V.jsx(Ib,{placeholder:"Selecione o estado"})}),V.jsxs(mv,{children:[V.jsx(Oa,{value:"Todos",children:"Todos"}),V.jsx(Oa,{value:"SP",children:"São Paulo"}),V.jsx(Oa,{value:"RJ",children:"Rio de Janeiro"}),V.jsx(Oa,{value:"DF",children:"Distrito Federal"})]})]})]}),V.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[V.jsx(ss,{htmlFor:"cidade",className:"text-right",children:"Cidade"}),V.jsxs(Mb,{value:U.cidade||"nenhuma",onValueChange:Me=>ie(it=>({...it,cidade:Me==="nenhuma"?void 0:Me})),children:[V.jsx(pv,{className:"col-span-3",children:V.jsx(Ib,{placeholder:"Selecione a cidade"})}),V.jsxs(mv,{children:[V.jsx(Oa,{value:"nenhuma",children:"Todas"}),le.map(Me=>V.jsx(Oa,{value:Me,children:Me},Me))]})]})]}),V.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[V.jsx(ss,{htmlFor:"distancia",className:"text-right",children:"Distância Máx."}),V.jsx(oa,{id:"distancia",type:"number",value:U.distanciaMaxima,onChange:Me=>ie(it=>({...it,distanciaMaxima:Number(Me.target.value)})),className:"col-span-3"})]}),V.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[V.jsx(ss,{className:"text-right",children:"Mostrar"}),V.jsxs("div",{className:"col-span-3 space-y-2",children:[V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx(lp,{id:"clientes",checked:U.mostrarClientes,onCheckedChange:Me=>ie(it=>({...it,mostrarClientes:Me}))}),V.jsx(ss,{htmlFor:"clientes",children:"Clientes"})]}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx(lp,{id:"prestadores",checked:U.mostrarPrestadores,onCheckedChange:Me=>ie(it=>({...it,mostrarPrestadores:Me}))}),V.jsx(ss,{htmlFor:"prestadores",children:"Prestadores"})]}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx(lp,{id:"redeAtual",checked:U.mostrarRedeAtual,onCheckedChange:Me=>ie(it=>({...it,mostrarRedeAtual:Me}))}),V.jsx(ss,{htmlFor:"redeAtual",children:"Rede Atual"})]}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx(lp,{id:"bronzeMais",checked:U.mostrarBronzeMais,onCheckedChange:Me=>ie(it=>({...it,mostrarBronzeMais:Me}))}),V.jsx(ss,{htmlFor:"bronzeMais",children:"Bronze Mais"})]}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx(lp,{id:"prontoSocorro",checked:U.mostrarProntoSocorro,onCheckedChange:Me=>ie(it=>({...it,mostrarProntoSocorro:Me}))}),V.jsx(ss,{htmlFor:"prontoSocorro",children:"Pronto Socorro"})]})]})]}),Q&&V.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[V.jsx(ss,{htmlFor:"link",className:"text-right",children:"Link"}),V.jsxs("div",{className:"col-span-3 flex",children:[V.jsx(oa,{id:"link",value:Q,readOnly:!0,className:"rounded-r-none"}),V.jsx(qs,{variant:"outline",size:"icon",onClick:Ne,className:"rounded-l-none border-l-0",children:J?V.jsx(mA,{className:"h-4 w-4"}):V.jsx(b4,{className:"h-4 w-4"})})]})]})]}),V.jsxs(qA,{className:"flex flex-col sm:flex-row gap-2",children:[V.jsx(qs,{variant:"outline",onClick:ye,className:"sm:mr-auto",children:"Gerar Link"}),V.jsxs(nY,{children:[V.jsx(rY,{asChild:!0,children:V.jsxs(qs,{variant:"outline",children:[V.jsx(w4,{className:"mr-2 h-4 w-4"}),"Compartilhar via"]})}),V.jsxs(n6,{children:[V.jsx(r6,{children:"Compartilhar via"}),V.jsx(i6,{}),V.jsx(Kx,{onClick:rt,children:"Email"}),V.jsx(Kx,{onClick:xe,children:"WhatsApp"}),V.jsxs(Kx,{onClick:Ne,children:[V.jsx(b4,{className:"mr-2 h-4 w-4"}),"Copiar Link"]})]})]}),V.jsxs(qs,{type:"submit",onClick:Ne,children:[V.jsx(Hq,{className:"mr-2 h-4 w-4"}),"Copiar Link"]})]})]})]})})}const gY=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>ad(async()=>{const{default:a}=await Promise.resolve().then(()=>p0);return{default:a}},void 0).then(({default:a})=>a(...s)):e=fetch,(...s)=>e(...s)};class tE extends Error{constructor(e,s="FunctionsError",a){super(e),this.name=s,this.context=a}}class _Y extends tE{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class yY extends tE{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class vY extends tE{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var JT;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(JT||(JT={}));var xY=function(t,e,s,a){function d(g){return g instanceof s?g:new s(function(v){v(g)})}return new(s||(s=Promise))(function(g,v){function i(O){try{k(a.next(O))}catch(z){v(z)}}function E(O){try{k(a.throw(O))}catch(z){v(z)}}function k(O){O.done?g(O.value):d(O.value).then(i,E)}k((a=a.apply(t,e||[])).next())})};class bY{constructor(e,{headers:s={},customFetch:a,region:d=JT.Any}={}){this.url=e,this.headers=s,this.region=d,this.fetch=gY(a)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,s={}){var a;return xY(this,void 0,void 0,function*(){try{const{headers:d,method:g,body:v}=s;let i={},{region:E}=s;E||(E=this.region),E&&E!=="any"&&(i["x-region"]=E);let k;v&&(d&&!Object.prototype.hasOwnProperty.call(d,"Content-Type")||!d)&&(typeof Blob<"u"&&v instanceof Blob||v instanceof ArrayBuffer?(i["Content-Type"]="application/octet-stream",k=v):typeof v=="string"?(i["Content-Type"]="text/plain",k=v):typeof FormData<"u"&&v instanceof FormData?k=v:(i["Content-Type"]="application/json",k=JSON.stringify(v)));const O=yield this.fetch(`${this.url}/${e}`,{method:g||"POST",headers:Object.assign(Object.assign(Object.assign({},i),this.headers),d),body:k}).catch(ie=>{throw new _Y(ie)}),z=O.headers.get("x-relay-error");if(z&&z==="true")throw new yY(O);if(!O.ok)throw new vY(O);let G=((a=O.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),U;return G==="application/json"?U=yield O.json():G==="application/octet-stream"?U=yield O.blob():G==="text/event-stream"?U=O:G==="multipart/form-data"?U=yield O.formData():U=yield O.text(),{data:U,error:null}}catch(d){return{data:null,error:d}}})}}var fc={},nE={},Aw={},Fv={},Ew={},Cw={},wY=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},r0=wY();const SY=r0.fetch,f6=r0.fetch.bind(r0),p6=r0.Headers,TY=r0.Request,AY=r0.Response,p0=Object.freeze(Object.defineProperty({__proto__:null,Headers:p6,Request:TY,Response:AY,default:f6,fetch:SY},Symbol.toStringTag,{value:"Module"})),EY=r7(p0);var Pw={};Object.defineProperty(Pw,"__esModule",{value:!0});let CY=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Pw.default=CY;var m6=Hc&&Hc.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Cw,"__esModule",{value:!0});const PY=m6(EY),MY=m6(Pw);let IY=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=PY.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,s){return this.headers=Object.assign({},this.headers),this.headers[e]=s,this}then(e,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let d=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async g=>{var v,i,E;let k=null,O=null,z=null,G=g.status,U=g.statusText;if(g.ok){if(this.method!=="HEAD"){const J=await g.text();J===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?O=J:O=JSON.parse(J))}const Q=(v=this.headers.Prefer)===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),se=(i=g.headers.get("content-range"))===null||i===void 0?void 0:i.split("/");Q&&se&&se.length>1&&(z=parseInt(se[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(O)&&(O.length>1?(k={code:"PGRST116",details:`Results contain ${O.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},O=null,z=null,G=406,U="Not Acceptable"):O.length===1?O=O[0]:O=null)}else{const Q=await g.text();try{k=JSON.parse(Q),Array.isArray(k)&&g.status===404&&(O=[],k=null,G=200,U="OK")}catch{g.status===404&&Q===""?(G=204,U="No Content"):k={message:Q}}if(k&&this.isMaybeSingle&&(!((E=k==null?void 0:k.details)===null||E===void 0)&&E.includes("0 rows"))&&(k=null,G=200,U="OK"),k&&this.shouldThrowOnError)throw new MY.default(k)}return{error:k,data:O,count:z,status:G,statusText:U}});return this.shouldThrowOnError||(d=d.catch(g=>{var v,i,E;return{error:{message:`${(v=g==null?void 0:g.name)!==null&&v!==void 0?v:"FetchError"}: ${g==null?void 0:g.message}`,details:`${(i=g==null?void 0:g.stack)!==null&&i!==void 0?i:""}`,hint:"",code:`${(E=g==null?void 0:g.code)!==null&&E!==void 0?E:""}`},data:null,count:null,status:0,statusText:""}})),d.then(e,s)}returns(){return this}overrideTypes(){return this}};Cw.default=IY;var LY=Hc&&Hc.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ew,"__esModule",{value:!0});const kY=LY(Cw);let RY=class extends kY.default{select(e){let s=!1;const a=(e??"*").split("").map(d=>/\s/.test(d)&&!s?"":(d==='"'&&(s=!s),d)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:s=!0,nullsFirst:a,foreignTable:d,referencedTable:g=d}={}){const v=g?`${g}.order`:"order",i=this.url.searchParams.get(v);return this.url.searchParams.set(v,`${i?`${i},`:""}${e}.${s?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:s,referencedTable:a=s}={}){const d=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(d,`${e}`),this}range(e,s,{foreignTable:a,referencedTable:d=a}={}){const g=typeof d>"u"?"offset":`${d}.offset`,v=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(g,`${e}`),this.url.searchParams.set(v,`${s-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:s=!1,settings:a=!1,buffers:d=!1,wal:g=!1,format:v="text"}={}){var i;const E=[e?"analyze":null,s?"verbose":null,a?"settings":null,d?"buffers":null,g?"wal":null].filter(Boolean).join("|"),k=(i=this.headers.Accept)!==null&&i!==void 0?i:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${v}; for="${k}"; options=${E};`,v==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ew.default=RY;var DY=Hc&&Hc.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Fv,"__esModule",{value:!0});const NY=DY(Ew);let OY=class extends NY.default{eq(e,s){return this.url.searchParams.append(e,`eq.${s}`),this}neq(e,s){return this.url.searchParams.append(e,`neq.${s}`),this}gt(e,s){return this.url.searchParams.append(e,`gt.${s}`),this}gte(e,s){return this.url.searchParams.append(e,`gte.${s}`),this}lt(e,s){return this.url.searchParams.append(e,`lt.${s}`),this}lte(e,s){return this.url.searchParams.append(e,`lte.${s}`),this}like(e,s){return this.url.searchParams.append(e,`like.${s}`),this}likeAllOf(e,s){return this.url.searchParams.append(e,`like(all).{${s.join(",")}}`),this}likeAnyOf(e,s){return this.url.searchParams.append(e,`like(any).{${s.join(",")}}`),this}ilike(e,s){return this.url.searchParams.append(e,`ilike.${s}`),this}ilikeAllOf(e,s){return this.url.searchParams.append(e,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(e,s){return this.url.searchParams.append(e,`ilike(any).{${s.join(",")}}`),this}is(e,s){return this.url.searchParams.append(e,`is.${s}`),this}in(e,s){const a=Array.from(new Set(s)).map(d=>typeof d=="string"&&new RegExp("[,()]").test(d)?`"${d}"`:`${d}`).join(",");return this.url.searchParams.append(e,`in.(${a})`),this}contains(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cs.{${s.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(s)}`),this}containedBy(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cd.{${s.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(s)}`),this}rangeGt(e,s){return this.url.searchParams.append(e,`sr.${s}`),this}rangeGte(e,s){return this.url.searchParams.append(e,`nxl.${s}`),this}rangeLt(e,s){return this.url.searchParams.append(e,`sl.${s}`),this}rangeLte(e,s){return this.url.searchParams.append(e,`nxr.${s}`),this}rangeAdjacent(e,s){return this.url.searchParams.append(e,`adj.${s}`),this}overlaps(e,s){return typeof s=="string"?this.url.searchParams.append(e,`ov.${s}`):this.url.searchParams.append(e,`ov.{${s.join(",")}}`),this}textSearch(e,s,{config:a,type:d}={}){let g="";d==="plain"?g="pl":d==="phrase"?g="ph":d==="websearch"&&(g="w");const v=a===void 0?"":`(${a})`;return this.url.searchParams.append(e,`${g}fts${v}.${s}`),this}match(e){return Object.entries(e).forEach(([s,a])=>{this.url.searchParams.append(s,`eq.${a}`)}),this}not(e,s,a){return this.url.searchParams.append(e,`not.${s}.${a}`),this}or(e,{foreignTable:s,referencedTable:a=s}={}){const d=a?`${a}.or`:"or";return this.url.searchParams.append(d,`(${e})`),this}filter(e,s,a){return this.url.searchParams.append(e,`${s}.${a}`),this}};Fv.default=OY;var zY=Hc&&Hc.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Aw,"__esModule",{value:!0});const Sy=zY(Fv);let FY=class{constructor(e,{headers:s={},schema:a,fetch:d}){this.url=e,this.headers=s,this.schema=a,this.fetch=d}select(e,{head:s=!1,count:a}={}){const d=s?"HEAD":"GET";let g=!1;const v=(e??"*").split("").map(i=>/\s/.test(i)&&!g?"":(i==='"'&&(g=!g),i)).join("");return this.url.searchParams.set("select",v),a&&(this.headers.Prefer=`count=${a}`),new Sy.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:s,defaultToNull:a=!0}={}){const d="POST",g=[];if(this.headers.Prefer&&g.push(this.headers.Prefer),s&&g.push(`count=${s}`),a||g.push("missing=default"),this.headers.Prefer=g.join(","),Array.isArray(e)){const v=e.reduce((i,E)=>i.concat(Object.keys(E)),[]);if(v.length>0){const i=[...new Set(v)].map(E=>`"${E}"`);this.url.searchParams.set("columns",i.join(","))}}return new Sy.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:s,ignoreDuplicates:a=!1,count:d,defaultToNull:g=!0}={}){const v="POST",i=[`resolution=${a?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&i.push(this.headers.Prefer),d&&i.push(`count=${d}`),g||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const E=e.reduce((k,O)=>k.concat(Object.keys(O)),[]);if(E.length>0){const k=[...new Set(E)].map(O=>`"${O}"`);this.url.searchParams.set("columns",k.join(","))}}return new Sy.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:s}={}){const a="PATCH",d=[];return this.headers.Prefer&&d.push(this.headers.Prefer),s&&d.push(`count=${s}`),this.headers.Prefer=d.join(","),new Sy.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const s="DELETE",a=[];return e&&a.push(`count=${e}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new Sy.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Aw.default=FY;var Mw={},Iw={};Object.defineProperty(Iw,"__esModule",{value:!0});Iw.version=void 0;Iw.version="0.0.0-automated";Object.defineProperty(Mw,"__esModule",{value:!0});Mw.DEFAULT_HEADERS=void 0;const BY=Iw;Mw.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${BY.version}`};var g6=Hc&&Hc.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(nE,"__esModule",{value:!0});const jY=g6(Aw),UY=g6(Fv),VY=Mw;let qY=class _6{constructor(e,{headers:s={},schema:a,fetch:d}={}){this.url=e,this.headers=Object.assign(Object.assign({},VY.DEFAULT_HEADERS),s),this.schemaName=a,this.fetch=d}from(e){const s=new URL(`${this.url}/${e}`);return new jY.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new _6(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,s={},{head:a=!1,get:d=!1,count:g}={}){let v;const i=new URL(`${this.url}/rpc/${e}`);let E;a||d?(v=a?"HEAD":"GET",Object.entries(s).filter(([O,z])=>z!==void 0).map(([O,z])=>[O,Array.isArray(z)?`{${z.join(",")}}`:`${z}`]).forEach(([O,z])=>{i.searchParams.append(O,z)})):(v="POST",E=s);const k=Object.assign({},this.headers);return g&&(k.Prefer=`count=${g}`),new UY.default({method:v,url:i,headers:k,schema:this.schemaName,body:E,fetch:this.fetch,allowEmpty:!1})}};nE.default=qY;var m0=Hc&&Hc.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(fc,"__esModule",{value:!0});fc.PostgrestError=fc.PostgrestBuilder=fc.PostgrestTransformBuilder=fc.PostgrestFilterBuilder=fc.PostgrestQueryBuilder=fc.PostgrestClient=void 0;const y6=m0(nE);fc.PostgrestClient=y6.default;const v6=m0(Aw);fc.PostgrestQueryBuilder=v6.default;const x6=m0(Fv);fc.PostgrestFilterBuilder=x6.default;const b6=m0(Ew);fc.PostgrestTransformBuilder=b6.default;const w6=m0(Cw);fc.PostgrestBuilder=w6.default;const S6=m0(Pw);fc.PostgrestError=S6.default;var $Y=fc.default={PostgrestClient:y6.default,PostgrestQueryBuilder:v6.default,PostgrestFilterBuilder:x6.default,PostgrestTransformBuilder:b6.default,PostgrestBuilder:w6.default,PostgrestError:S6.default};const{PostgrestClient:GY,PostgrestQueryBuilder:oee,PostgrestFilterBuilder:aee,PostgrestTransformBuilder:lee,PostgrestBuilder:cee,PostgrestError:uee}=$Y,HY="2.11.2",WY={"X-Client-Info":`realtime-js/${HY}`},ZY="1.0.0",T6=1e4,KY=1e3;var D_;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(D_||(D_={}));var zc;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(zc||(zc={}));var ah;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ah||(ah={}));var QT;(function(t){t.websocket="websocket"})(QT||(QT={}));var zm;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(zm||(zm={}));class XY{constructor(){this.HEADER_LENGTH=1}decode(e,s){return e.constructor===ArrayBuffer?s(this._binaryDecode(e)):s(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const s=new DataView(e),a=new TextDecoder;return this._decodeBroadcast(e,s,a)}_decodeBroadcast(e,s,a){const d=s.getUint8(1),g=s.getUint8(2);let v=this.HEADER_LENGTH+2;const i=a.decode(e.slice(v,v+d));v=v+d;const E=a.decode(e.slice(v,v+g));v=v+g;const k=JSON.parse(a.decode(e.slice(v,e.byteLength)));return{ref:null,topic:i,event:E,payload:k}}}class A6{constructor(e,s){this.callback=e,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ls;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ls||(Ls={}));const xL=(t,e,s={})=>{var a;const d=(a=s.skipTypes)!==null&&a!==void 0?a:[];return Object.keys(e).reduce((g,v)=>(g[v]=YY(v,t,e,d),g),{})},YY=(t,e,s,a)=>{const d=e.find(i=>i.name===t),g=d==null?void 0:d.type,v=s[t];return g&&!a.includes(g)?E6(g,v):e3(v)},E6=(t,e)=>{if(t.charAt(0)==="_"){const s=t.slice(1,t.length);return tJ(e,s)}switch(t){case Ls.bool:return JY(e);case Ls.float4:case Ls.float8:case Ls.int2:case Ls.int4:case Ls.int8:case Ls.numeric:case Ls.oid:return QY(e);case Ls.json:case Ls.jsonb:return eJ(e);case Ls.timestamp:return nJ(e);case Ls.abstime:case Ls.date:case Ls.daterange:case Ls.int4range:case Ls.int8range:case Ls.money:case Ls.reltime:case Ls.text:case Ls.time:case Ls.timestamptz:case Ls.timetz:case Ls.tsrange:case Ls.tstzrange:return e3(e);default:return e3(e)}},e3=t=>t,JY=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},QY=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},eJ=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},tJ=(t,e)=>{if(typeof t!="string")return t;const s=t.length-1,a=t[s];if(t[0]==="{"&&a==="}"){let g;const v=t.slice(1,s);try{g=JSON.parse("["+v+"]")}catch{g=v?v.split(","):[]}return g.map(i=>E6(e,i))}return t},nJ=t=>typeof t=="string"?t.replace(" ","T"):t,C6=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class sS{constructor(e,s,a={},d=T6){this.channel=e,this.event=s,this.payload=a,this.timeout=d,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,s){var a;return this._hasReceived(e)&&s((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:e,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:s}){this.recHooks.filter(a=>a.status===e).forEach(a=>a.callback(s))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var bL;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(bL||(bL={}));class Gy{constructor(e,s){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},d=>{const{onJoin:g,onLeave:v,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Gy.syncState(this.state,d,g,v),this.pendingDiffs.forEach(E=>{this.state=Gy.syncDiff(this.state,E,g,v)}),this.pendingDiffs=[],i()}),this.channel._on(a.diff,{},d=>{const{onJoin:g,onLeave:v,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(d):(this.state=Gy.syncDiff(this.state,d,g,v),i())}),this.onJoin((d,g,v)=>{this.channel._trigger("presence",{event:"join",key:d,currentPresences:g,newPresences:v})}),this.onLeave((d,g,v)=>{this.channel._trigger("presence",{event:"leave",key:d,currentPresences:g,leftPresences:v})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,s,a,d){const g=this.cloneDeep(e),v=this.transformState(s),i={},E={};return this.map(g,(k,O)=>{v[k]||(E[k]=O)}),this.map(v,(k,O)=>{const z=g[k];if(z){const G=O.map(se=>se.presence_ref),U=z.map(se=>se.presence_ref),ie=O.filter(se=>U.indexOf(se.presence_ref)<0),Q=z.filter(se=>G.indexOf(se.presence_ref)<0);ie.length>0&&(i[k]=ie),Q.length>0&&(E[k]=Q)}else i[k]=O}),this.syncDiff(g,{joins:i,leaves:E},a,d)}static syncDiff(e,s,a,d){const{joins:g,leaves:v}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return a||(a=()=>{}),d||(d=()=>{}),this.map(g,(i,E)=>{var k;const O=(k=e[i])!==null&&k!==void 0?k:[];if(e[i]=this.cloneDeep(E),O.length>0){const z=e[i].map(U=>U.presence_ref),G=O.filter(U=>z.indexOf(U.presence_ref)<0);e[i].unshift(...G)}a(i,O,E)}),this.map(v,(i,E)=>{let k=e[i];if(!k)return;const O=E.map(z=>z.presence_ref);k=k.filter(z=>O.indexOf(z.presence_ref)<0),e[i]=k,d(i,k,E),k.length===0&&delete e[i]}),e}static map(e,s){return Object.getOwnPropertyNames(e).map(a=>s(a,e[a]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((s,a)=>{const d=e[a];return"metas"in d?s[a]=d.metas.map(g=>(g.presence_ref=g.phx_ref,delete g.phx_ref,delete g.phx_ref_prev,g)):s[a]=d,s},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var wL;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(wL||(wL={}));var SL;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(SL||(SL={}));var Kd;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Kd||(Kd={}));class rE{constructor(e,s={config:{}},a){this.topic=e,this.params=s,this.socket=a,this.bindings={},this.state=zc.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new sS(this,ah.join,this.params,this.timeout),this.rejoinTimer=new A6(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=zc.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=zc.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=zc.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=zc.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ah.reply,{},(d,g)=>{this._trigger(this._replyEventName(g),d)}),this.presence=new Gy(this),this.broadcastEndpointURL=C6(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,s=this.timeout){var a,d;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:g,presence:v,private:i}}=this.params;this._onError(O=>e==null?void 0:e(Kd.CHANNEL_ERROR,O)),this._onClose(()=>e==null?void 0:e(Kd.CLOSED));const E={},k={broadcast:g,presence:v,postgres_changes:(d=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(O=>O.filter))!==null&&d!==void 0?d:[],private:i};this.socket.accessTokenValue&&(E.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:k},E)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:O})=>{var z;if(this.socket.setAuth(),O===void 0){e==null||e(Kd.SUBSCRIBED);return}else{const G=this.bindings.postgres_changes,U=(z=G==null?void 0:G.length)!==null&&z!==void 0?z:0,ie=[];for(let Q=0;Q<U;Q++){const se=G[Q],{filter:{event:J,schema:te,table:le,filter:ye}}=se,Ne=O&&O[Q];if(Ne&&Ne.event===J&&Ne.schema===te&&Ne.table===le&&Ne.filter===ye)ie.push(Object.assign(Object.assign({},se),{id:Ne.id}));else{this.unsubscribe(),e==null||e(Kd.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=ie,e&&e(Kd.SUBSCRIBED);return}}).receive("error",O=>{e==null||e(Kd.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(O).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Kd.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,s={}){return await this.send({type:"presence",event:"track",payload:e},s.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,s,a){return this._on(e,s,a)}async send(e,s={}){var a,d;if(!this._canPush()&&e.type==="broadcast"){const{event:g,payload:v}=e,E={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:g,payload:v,private:this.private}]})};try{const k=await this._fetchWithTimeout(this.broadcastEndpointURL,E,(a=s.timeout)!==null&&a!==void 0?a:this.timeout);return await((d=k.body)===null||d===void 0?void 0:d.cancel()),k.ok?"ok":"error"}catch(k){return k.name==="AbortError"?"timed out":"error"}}else return new Promise(g=>{var v,i,E;const k=this._push(e.type,e,s.timeout||this.timeout);e.type==="broadcast"&&!(!((E=(i=(v=this.params)===null||v===void 0?void 0:v.config)===null||i===void 0?void 0:i.broadcast)===null||E===void 0)&&E.ack)&&g("ok"),k.receive("ok",()=>g("ok")),k.receive("error",()=>g("error")),k.receive("timeout",()=>g("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=zc.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ah.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(a=>{const d=new sS(this,ah.leave,{},e);d.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),d.send(),this._canPush()||d.trigger("ok",{})})}async _fetchWithTimeout(e,s,a){const d=new AbortController,g=setTimeout(()=>d.abort(),a),v=await this.socket.fetch(e,Object.assign(Object.assign({},s),{signal:d.signal}));return clearTimeout(g),v}_push(e,s,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let d=new sS(this,e,s,a);return this._canPush()?d.send():(d.startTimeout(),this.pushBuffer.push(d)),d}_onMessage(e,s,a){return s}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,s,a){var d,g;const v=e.toLocaleLowerCase(),{close:i,error:E,leave:k,join:O}=ah;if(a&&[i,E,k,O].indexOf(v)>=0&&a!==this._joinRef())return;let G=this._onMessage(v,s,a);if(s&&!G)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(v)?(d=this.bindings.postgres_changes)===null||d===void 0||d.filter(U=>{var ie,Q,se;return((ie=U.filter)===null||ie===void 0?void 0:ie.event)==="*"||((se=(Q=U.filter)===null||Q===void 0?void 0:Q.event)===null||se===void 0?void 0:se.toLocaleLowerCase())===v}).map(U=>U.callback(G,a)):(g=this.bindings[v])===null||g===void 0||g.filter(U=>{var ie,Q,se,J,te,le;if(["broadcast","presence","postgres_changes"].includes(v))if("id"in U){const ye=U.id,Ne=(ie=U.filter)===null||ie===void 0?void 0:ie.event;return ye&&((Q=s.ids)===null||Q===void 0?void 0:Q.includes(ye))&&(Ne==="*"||(Ne==null?void 0:Ne.toLocaleLowerCase())===((se=s.data)===null||se===void 0?void 0:se.type.toLocaleLowerCase()))}else{const ye=(te=(J=U==null?void 0:U.filter)===null||J===void 0?void 0:J.event)===null||te===void 0?void 0:te.toLocaleLowerCase();return ye==="*"||ye===((le=s==null?void 0:s.event)===null||le===void 0?void 0:le.toLocaleLowerCase())}else return U.type.toLocaleLowerCase()===v}).map(U=>{if(typeof G=="object"&&"ids"in G){const ie=G.data,{schema:Q,table:se,commit_timestamp:J,type:te,errors:le}=ie;G=Object.assign(Object.assign({},{schema:Q,table:se,commit_timestamp:J,eventType:te,new:{},old:{},errors:le}),this._getPayloadRecords(ie))}U.callback(G,a)})}_isClosed(){return this.state===zc.closed}_isJoined(){return this.state===zc.joined}_isJoining(){return this.state===zc.joining}_isLeaving(){return this.state===zc.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,s,a){const d=e.toLocaleLowerCase(),g={type:d,filter:s,callback:a};return this.bindings[d]?this.bindings[d].push(g):this.bindings[d]=[g],this}_off(e,s){const a=e.toLocaleLowerCase();return this.bindings[a]=this.bindings[a].filter(d=>{var g;return!(((g=d.type)===null||g===void 0?void 0:g.toLocaleLowerCase())===a&&rE.isEqual(d.filter,s))}),this}static isEqual(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const a in e)if(e[a]!==s[a])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ah.close,{},e)}_onError(e){this._on(ah.error,{},s=>e(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=zc.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const s={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(s.new=xL(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(s.old=xL(e.columns,e.old_record)),s}}const rJ=()=>{},iJ=typeof WebSocket<"u",sJ=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class oJ{constructor(e,s){var a;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=WY,this.params={},this.timeout=T6,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=rJ,this.conn=null,this.sendBuffer=[],this.serializer=new XY,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=g=>{let v;return g?v=g:typeof fetch>"u"?v=(...i)=>ad(async()=>{const{default:E}=await Promise.resolve().then(()=>p0);return{default:E}},void 0).then(({default:E})=>E(...i)):v=fetch,(...i)=>v(...i)},this.endPoint=`${e}/${QT.websocket}`,this.httpEndpoint=C6(e),s!=null&&s.transport?this.transport=s.transport:this.transport=null,s!=null&&s.params&&(this.params=s.params),s!=null&&s.headers&&(this.headers=Object.assign(Object.assign({},this.headers),s.headers)),s!=null&&s.timeout&&(this.timeout=s.timeout),s!=null&&s.logger&&(this.logger=s.logger),s!=null&&s.heartbeatIntervalMs&&(this.heartbeatIntervalMs=s.heartbeatIntervalMs);const d=(a=s==null?void 0:s.params)===null||a===void 0?void 0:a.apikey;if(d&&(this.accessTokenValue=d,this.apiKey=d),this.reconnectAfterMs=s!=null&&s.reconnectAfterMs?s.reconnectAfterMs:g=>[1e3,2e3,5e3,1e4][g-1]||1e4,this.encode=s!=null&&s.encode?s.encode:(g,v)=>v(JSON.stringify(g)),this.decode=s!=null&&s.decode?s.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new A6(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(s==null?void 0:s.fetch),s!=null&&s.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(s==null?void 0:s.worker)||!1,this.workerUrl=s==null?void 0:s.workerUrl}this.accessToken=(s==null?void 0:s.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(iJ){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new aJ(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),ad(async()=>{const{default:e}=await import("./browser-D2RuGRVx.js").then(s=>s.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ZY}))}disconnect(e,s){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,s??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const s=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const e=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.disconnect(),e}log(e,s,a){this.logger(e,s,a)}connectionState(){switch(this.conn&&this.conn.readyState){case D_.connecting:return zm.Connecting;case D_.open:return zm.Open;case D_.closing:return zm.Closing;default:return zm.Closed}}isConnected(){return this.connectionState()===zm.Open}channel(e,s={config:{}}){const a=new rE(`realtime:${e}`,s,this);return this.channels.push(a),a}push(e){const{topic:s,event:a,payload:d,ref:g}=e,v=()=>{this.encode(e,i=>{var E;(E=this.conn)===null||E===void 0||E.send(i)})};this.log("push",`${s} ${a} (${g})`,d),this.isConnected()?v():this.sendBuffer.push(v)}async setAuth(e=null){let s=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(s){let a=null;try{a=JSON.parse(atob(s.split(".")[1]))}catch{}if(a&&a.exp&&!(Math.floor(Date.now()/1e3)-a.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`);this.accessTokenValue=s,this.channels.forEach(d=>{s&&d.updateJoinPayload({access_token:s}),d.joinedOnce&&d._isJoined()&&d._push(ah.access_token,{access_token:s})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(KY,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let s=this.channels.find(a=>a.topic===e&&(a._isJoined()||a._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${e}"`),s.unsubscribe())}_remove(e){this.channels=this.channels.filter(s=>s._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,s=>{let{topic:a,event:d,payload:g,ref:v}=s;v&&v===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${g.status||""} ${a} ${d} ${v&&"("+v+")"||""}`,g),this.channels.filter(i=>i._isMember(a)).forEach(i=>i._trigger(d,g,v)),this.stateChangeCallbacks.message.forEach(i=>i(s))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(s=>s(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(s=>s(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ah.error))}_appendParams(e,s){if(Object.keys(s).length===0)return e;const a=e.match(/\?/)?"&":"?",d=new URLSearchParams(s);return`${e}${a}${d}`}_workerObjectUrl(e){let s;if(e)s=e;else{const a=new Blob([sJ],{type:"application/javascript"});s=URL.createObjectURL(a)}return s}}class aJ{constructor(e,s,a){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=D_.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=a.close}}class iE extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function va(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class lJ extends iE{constructor(e,s){super(e),this.name="StorageApiError",this.status=s}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class t3 extends iE{constructor(e,s){super(e),this.name="StorageUnknownError",this.originalError=s}}var cJ=function(t,e,s,a){function d(g){return g instanceof s?g:new s(function(v){v(g)})}return new(s||(s=Promise))(function(g,v){function i(O){try{k(a.next(O))}catch(z){v(z)}}function E(O){try{k(a.throw(O))}catch(z){v(z)}}function k(O){O.done?g(O.value):d(O.value).then(i,E)}k((a=a.apply(t,e||[])).next())})};const P6=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>ad(async()=>{const{default:a}=await Promise.resolve().then(()=>p0);return{default:a}},void 0).then(({default:a})=>a(...s)):e=fetch,(...s)=>e(...s)},uJ=()=>cJ(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ad(()=>Promise.resolve().then(()=>p0),void 0)).Response:Response}),n3=t=>{if(Array.isArray(t))return t.map(s=>n3(s));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([s,a])=>{const d=s.replace(/([-_][a-z])/gi,g=>g.toUpperCase().replace(/[-_]/g,""));e[d]=n3(a)}),e};var pg=function(t,e,s,a){function d(g){return g instanceof s?g:new s(function(v){v(g)})}return new(s||(s=Promise))(function(g,v){function i(O){try{k(a.next(O))}catch(z){v(z)}}function E(O){try{k(a.throw(O))}catch(z){v(z)}}function k(O){O.done?g(O.value):d(O.value).then(i,E)}k((a=a.apply(t,e||[])).next())})};const oS=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),hJ=(t,e,s)=>pg(void 0,void 0,void 0,function*(){const a=yield uJ();t instanceof a&&!(s!=null&&s.noResolveJson)?t.json().then(d=>{e(new lJ(oS(d),t.status||500))}).catch(d=>{e(new t3(oS(d),d))}):e(new t3(oS(t),t))}),dJ=(t,e,s,a)=>{const d={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?d:(d.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),a&&(d.body=JSON.stringify(a)),Object.assign(Object.assign({},d),s))};function Bv(t,e,s,a,d,g){return pg(this,void 0,void 0,function*(){return new Promise((v,i)=>{t(s,dJ(e,a,d,g)).then(E=>{if(!E.ok)throw E;return a!=null&&a.noResolveJson?E:E.json()}).then(E=>v(E)).catch(E=>hJ(E,i,a))})})}function Fb(t,e,s,a){return pg(this,void 0,void 0,function*(){return Bv(t,"GET",e,s,a)})}function sp(t,e,s,a,d){return pg(this,void 0,void 0,function*(){return Bv(t,"POST",e,a,d,s)})}function fJ(t,e,s,a,d){return pg(this,void 0,void 0,function*(){return Bv(t,"PUT",e,a,d,s)})}function pJ(t,e,s,a){return pg(this,void 0,void 0,function*(){return Bv(t,"HEAD",e,Object.assign(Object.assign({},s),{noResolveJson:!0}),a)})}function M6(t,e,s,a,d){return pg(this,void 0,void 0,function*(){return Bv(t,"DELETE",e,a,d,s)})}var lc=function(t,e,s,a){function d(g){return g instanceof s?g:new s(function(v){v(g)})}return new(s||(s=Promise))(function(g,v){function i(O){try{k(a.next(O))}catch(z){v(z)}}function E(O){try{k(a.throw(O))}catch(z){v(z)}}function k(O){O.done?g(O.value):d(O.value).then(i,E)}k((a=a.apply(t,e||[])).next())})};const mJ={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},TL={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class gJ{constructor(e,s={},a,d){this.url=e,this.headers=s,this.bucketId=a,this.fetch=P6(d)}uploadOrUpdate(e,s,a,d){return lc(this,void 0,void 0,function*(){try{let g;const v=Object.assign(Object.assign({},TL),d);let i=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(v.upsert)});const E=v.metadata;typeof Blob<"u"&&a instanceof Blob?(g=new FormData,g.append("cacheControl",v.cacheControl),E&&g.append("metadata",this.encodeMetadata(E)),g.append("",a)):typeof FormData<"u"&&a instanceof FormData?(g=a,g.append("cacheControl",v.cacheControl),E&&g.append("metadata",this.encodeMetadata(E))):(g=a,i["cache-control"]=`max-age=${v.cacheControl}`,i["content-type"]=v.contentType,E&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(E)))),d!=null&&d.headers&&(i=Object.assign(Object.assign({},i),d.headers));const k=this._removeEmptyFolders(s),O=this._getFinalPath(k),z=yield this.fetch(`${this.url}/object/${O}`,Object.assign({method:e,body:g,headers:i},v!=null&&v.duplex?{duplex:v.duplex}:{})),G=yield z.json();return z.ok?{data:{path:k,id:G.Id,fullPath:G.Key},error:null}:{data:null,error:G}}catch(g){if(va(g))return{data:null,error:g};throw g}})}upload(e,s,a){return lc(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,s,a)})}uploadToSignedUrl(e,s,a,d){return lc(this,void 0,void 0,function*(){const g=this._removeEmptyFolders(e),v=this._getFinalPath(g),i=new URL(this.url+`/object/upload/sign/${v}`);i.searchParams.set("token",s);try{let E;const k=Object.assign({upsert:TL.upsert},d),O=Object.assign(Object.assign({},this.headers),{"x-upsert":String(k.upsert)});typeof Blob<"u"&&a instanceof Blob?(E=new FormData,E.append("cacheControl",k.cacheControl),E.append("",a)):typeof FormData<"u"&&a instanceof FormData?(E=a,E.append("cacheControl",k.cacheControl)):(E=a,O["cache-control"]=`max-age=${k.cacheControl}`,O["content-type"]=k.contentType);const z=yield this.fetch(i.toString(),{method:"PUT",body:E,headers:O}),G=yield z.json();return z.ok?{data:{path:g,fullPath:G.Key},error:null}:{data:null,error:G}}catch(E){if(va(E))return{data:null,error:E};throw E}})}createSignedUploadUrl(e,s){return lc(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e);const d=Object.assign({},this.headers);s!=null&&s.upsert&&(d["x-upsert"]="true");const g=yield sp(this.fetch,`${this.url}/object/upload/sign/${a}`,{},{headers:d}),v=new URL(this.url+g.url),i=v.searchParams.get("token");if(!i)throw new iE("No token returned by API");return{data:{signedUrl:v.toString(),path:e,token:i},error:null}}catch(a){if(va(a))return{data:null,error:a};throw a}})}update(e,s,a){return lc(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,s,a)})}move(e,s,a){return lc(this,void 0,void 0,function*(){try{return{data:yield sp(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:s,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers}),error:null}}catch(d){if(va(d))return{data:null,error:d};throw d}})}copy(e,s,a){return lc(this,void 0,void 0,function*(){try{return{data:{path:(yield sp(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:s,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers})).Key},error:null}}catch(d){if(va(d))return{data:null,error:d};throw d}})}createSignedUrl(e,s,a){return lc(this,void 0,void 0,function*(){try{let d=this._getFinalPath(e),g=yield sp(this.fetch,`${this.url}/object/sign/${d}`,Object.assign({expiresIn:s},a!=null&&a.transform?{transform:a.transform}:{}),{headers:this.headers});const v=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return g={signedUrl:encodeURI(`${this.url}${g.signedURL}${v}`)},{data:g,error:null}}catch(d){if(va(d))return{data:null,error:d};throw d}})}createSignedUrls(e,s,a){return lc(this,void 0,void 0,function*(){try{const d=yield sp(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:e},{headers:this.headers}),g=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return{data:d.map(v=>Object.assign(Object.assign({},v),{signedUrl:v.signedURL?encodeURI(`${this.url}${v.signedURL}${g}`):null})),error:null}}catch(d){if(va(d))return{data:null,error:d};throw d}})}download(e,s){return lc(this,void 0,void 0,function*(){const d=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",g=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),v=g?`?${g}`:"";try{const i=this._getFinalPath(e);return{data:yield(yield Fb(this.fetch,`${this.url}/${d}/${i}${v}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(i){if(va(i))return{data:null,error:i};throw i}})}info(e){return lc(this,void 0,void 0,function*(){const s=this._getFinalPath(e);try{const a=yield Fb(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:n3(a),error:null}}catch(a){if(va(a))return{data:null,error:a};throw a}})}exists(e){return lc(this,void 0,void 0,function*(){const s=this._getFinalPath(e);try{return yield pJ(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(va(a)&&a instanceof t3){const d=a.originalError;if([400,404].includes(d==null?void 0:d.status))return{data:!1,error:a}}throw a}})}getPublicUrl(e,s){const a=this._getFinalPath(e),d=[],g=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";g!==""&&d.push(g);const i=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",E=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});E!==""&&d.push(E);let k=d.join("&");return k!==""&&(k=`?${k}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${a}${k}`)}}}remove(e){return lc(this,void 0,void 0,function*(){try{return{data:yield M6(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(s){if(va(s))return{data:null,error:s};throw s}})}list(e,s,a){return lc(this,void 0,void 0,function*(){try{const d=Object.assign(Object.assign(Object.assign({},mJ),s),{prefix:e||""});return{data:yield sp(this.fetch,`${this.url}/object/list/${this.bucketId}`,d,{headers:this.headers},a),error:null}}catch(d){if(va(d))return{data:null,error:d};throw d}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const s=[];return e.width&&s.push(`width=${e.width}`),e.height&&s.push(`height=${e.height}`),e.resize&&s.push(`resize=${e.resize}`),e.format&&s.push(`format=${e.format}`),e.quality&&s.push(`quality=${e.quality}`),s.join("&")}}const _J="2.7.1",yJ={"X-Client-Info":`storage-js/${_J}`};var Qg=function(t,e,s,a){function d(g){return g instanceof s?g:new s(function(v){v(g)})}return new(s||(s=Promise))(function(g,v){function i(O){try{k(a.next(O))}catch(z){v(z)}}function E(O){try{k(a.throw(O))}catch(z){v(z)}}function k(O){O.done?g(O.value):d(O.value).then(i,E)}k((a=a.apply(t,e||[])).next())})};class vJ{constructor(e,s={},a){this.url=e,this.headers=Object.assign(Object.assign({},yJ),s),this.fetch=P6(a)}listBuckets(){return Qg(this,void 0,void 0,function*(){try{return{data:yield Fb(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(va(e))return{data:null,error:e};throw e}})}getBucket(e){return Qg(this,void 0,void 0,function*(){try{return{data:yield Fb(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(s){if(va(s))return{data:null,error:s};throw s}})}createBucket(e,s={public:!1}){return Qg(this,void 0,void 0,function*(){try{return{data:yield sp(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(va(a))return{data:null,error:a};throw a}})}updateBucket(e,s){return Qg(this,void 0,void 0,function*(){try{return{data:yield fJ(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(va(a))return{data:null,error:a};throw a}})}emptyBucket(e){return Qg(this,void 0,void 0,function*(){try{return{data:yield sp(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(va(s))return{data:null,error:s};throw s}})}deleteBucket(e){return Qg(this,void 0,void 0,function*(){try{return{data:yield M6(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(s){if(va(s))return{data:null,error:s};throw s}})}}class xJ extends vJ{constructor(e,s={},a){super(e,s,a)}from(e){return new gJ(this.url,this.headers,e,this.fetch)}}const bJ="2.49.4";let ky="";typeof Deno<"u"?ky="deno":typeof document<"u"?ky="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ky="react-native":ky="node";const wJ={"X-Client-Info":`supabase-js-${ky}/${bJ}`},SJ={headers:wJ},TJ={schema:"public"},AJ={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},EJ={};var CJ=function(t,e,s,a){function d(g){return g instanceof s?g:new s(function(v){v(g)})}return new(s||(s=Promise))(function(g,v){function i(O){try{k(a.next(O))}catch(z){v(z)}}function E(O){try{k(a.throw(O))}catch(z){v(z)}}function k(O){O.done?g(O.value):d(O.value).then(i,E)}k((a=a.apply(t,e||[])).next())})};const PJ=t=>{let e;return t?e=t:typeof fetch>"u"?e=f6:e=fetch,(...s)=>e(...s)},MJ=()=>typeof Headers>"u"?p6:Headers,IJ=(t,e,s)=>{const a=PJ(s),d=MJ();return(g,v)=>CJ(void 0,void 0,void 0,function*(){var i;const E=(i=yield e())!==null&&i!==void 0?i:t;let k=new d(v==null?void 0:v.headers);return k.has("apikey")||k.set("apikey",t),k.has("Authorization")||k.set("Authorization",`Bearer ${E}`),a(g,Object.assign(Object.assign({},v),{headers:k}))})};var LJ=function(t,e,s,a){function d(g){return g instanceof s?g:new s(function(v){v(g)})}return new(s||(s=Promise))(function(g,v){function i(O){try{k(a.next(O))}catch(z){v(z)}}function E(O){try{k(a.throw(O))}catch(z){v(z)}}function k(O){O.done?g(O.value):d(O.value).then(i,E)}k((a=a.apply(t,e||[])).next())})};function kJ(t){return t.replace(/\/$/,"")}function RJ(t,e){const{db:s,auth:a,realtime:d,global:g}=t,{db:v,auth:i,realtime:E,global:k}=e,O={db:Object.assign(Object.assign({},v),s),auth:Object.assign(Object.assign({},i),a),realtime:Object.assign(Object.assign({},E),d),global:Object.assign(Object.assign({},k),g),accessToken:()=>LJ(this,void 0,void 0,function*(){return""})};return t.accessToken?O.accessToken=t.accessToken:delete O.accessToken,O}const I6="2.69.1",i_=30*1e3,r3=3,aS=r3*i_,DJ="http://localhost:9999",NJ="supabase.auth.token",OJ={"X-Client-Info":`gotrue-js/${I6}`},i3="X-Supabase-Api-Version",L6={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},zJ=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,FJ=6e5;class sE extends Error{constructor(e,s,a){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=a}}function yi(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class BJ extends sE{constructor(e,s,a){super(e,s,a),this.name="AuthApiError",this.status=s,this.code=a}}function jJ(t){return yi(t)&&t.name==="AuthApiError"}class k6 extends sE{constructor(e,s){super(e),this.name="AuthUnknownError",this.originalError=s}}class Gp extends sE{constructor(e,s,a,d){super(e,a,d),this.name=s,this.status=a}}class tp extends Gp{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function UJ(t){return yi(t)&&t.name==="AuthSessionMissingError"}class lS extends Gp{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class wx extends Gp{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Sx extends Gp{constructor(e,s=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function VJ(t){return yi(t)&&t.name==="AuthImplicitGrantRedirectError"}class AL extends Gp{constructor(e,s=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class s3 extends Gp{constructor(e,s){super(e,"AuthRetryableFetchError",s,void 0)}}function cS(t){return yi(t)&&t.name==="AuthRetryableFetchError"}class EL extends Gp{constructor(e,s,a){super(e,"AuthWeakPasswordError",s,"weak_password"),this.reasons=a}}class Hy extends Gp{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const CL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),PL=` 	
\r=`.split(""),qJ=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<PL.length;e+=1)t[PL[e].charCodeAt(0)]=-2;for(let e=0;e<CL.length;e+=1)t[CL[e].charCodeAt(0)]=e;return t})();function R6(t,e,s){const a=qJ[t];if(a>-1)for(e.queue=e.queue<<6|a,e.queuedBits+=6;e.queuedBits>=8;)s(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function ML(t){const e=[],s=v=>{e.push(String.fromCodePoint(v))},a={utf8seq:0,codepoint:0},d={queue:0,queuedBits:0},g=v=>{HJ(v,a,s)};for(let v=0;v<t.length;v+=1)R6(t.charCodeAt(v),d,g);return e.join("")}function $J(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function GJ(t,e){for(let s=0;s<t.length;s+=1){let a=t.charCodeAt(s);if(a>55295&&a<=56319){const d=(a-55296)*1024&65535;a=(t.charCodeAt(s+1)-56320&65535|d)+65536,s+=1}$J(a,e)}}function HJ(t,e,s){if(e.utf8seq===0){if(t<=127){s(t);return}for(let a=1;a<6;a+=1)if(!(t>>7-a&1)){e.utf8seq=a;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&s(e.codepoint)}}function WJ(t){const e=[],s={queue:0,queuedBits:0},a=d=>{e.push(d)};for(let d=0;d<t.length;d+=1)R6(t.charCodeAt(d),s,a);return new Uint8Array(e)}function ZJ(t){const e=[];return GJ(t,s=>e.push(s)),new Uint8Array(e)}function KJ(t){return Math.round(Date.now()/1e3)+t}function XJ(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const Hh=()=>typeof window<"u"&&typeof document<"u",Lm={tested:!1,writable:!1},Wy=()=>{if(!Hh())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Lm.tested)return Lm.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Lm.tested=!0,Lm.writable=!0}catch{Lm.tested=!0,Lm.writable=!1}return Lm.writable};function YJ(t){const e={},s=new URL(t);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((d,g)=>{e[g]=d})}catch{}return s.searchParams.forEach((a,d)=>{e[d]=a}),e}const D6=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...s)=>ad(async()=>{const{default:a}=await Promise.resolve().then(()=>p0);return{default:a}},void 0).then(({default:a})=>a(...s)):e=fetch,(...s)=>e(...s)},JJ=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",N6=async(t,e,s)=>{await t.setItem(e,JSON.stringify(s))},Tx=async(t,e)=>{const s=await t.getItem(e);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Ax=async(t,e)=>{await t.removeItem(e)};class Lw{constructor(){this.promise=new Lw.promiseConstructor((e,s)=>{this.resolve=e,this.reject=s})}}Lw.promiseConstructor=Promise;function uS(t){const e=t.split(".");if(e.length!==3)throw new Hy("Invalid JWT structure");for(let a=0;a<e.length;a++)if(!zJ.test(e[a]))throw new Hy("JWT not in base64url format");return{header:JSON.parse(ML(e[0])),payload:JSON.parse(ML(e[1])),signature:WJ(e[2]),raw:{header:e[0],payload:e[1]}}}async function QJ(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function eQ(t,e){return new Promise((a,d)=>{(async()=>{for(let g=0;g<1/0;g++)try{const v=await t(g);if(!e(g,null,v)){a(v);return}}catch(v){if(!e(g,v)){d(v);return}}})()})}function tQ(t){return("0"+t.toString(16)).substr(-2)}function nQ(){const e=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=s.length;let d="";for(let g=0;g<56;g++)d+=s.charAt(Math.floor(Math.random()*a));return d}return crypto.getRandomValues(e),Array.from(e,tQ).join("")}async function rQ(t){const s=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",s),d=new Uint8Array(a);return Array.from(d).map(g=>String.fromCharCode(g)).join("")}async function iQ(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const s=await rQ(t);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function e_(t,e,s=!1){const a=nQ();let d=a;s&&(d+="/PASSWORD_RECOVERY"),await N6(t,`${e}-code-verifier`,d);const g=await iQ(a);return[g,a===g?"plain":"s256"]}const sQ=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function oQ(t){const e=t.headers.get(i3);if(!e||!e.match(sQ))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function aQ(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function lQ(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var cQ=function(t,e){var s={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(t);d<a.length;d++)e.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(t,a[d])&&(s[a[d]]=t[a[d]]);return s};const Nm=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),uQ=[502,503,504];async function IL(t){var e;if(!JJ(t))throw new s3(Nm(t),0);if(uQ.includes(t.status))throw new s3(Nm(t),t.status);let s;try{s=await t.json()}catch(g){throw new k6(Nm(g),g)}let a;const d=oQ(t);if(d&&d.getTime()>=L6["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?a=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(a=s.error_code),a){if(a==="weak_password")throw new EL(Nm(s),t.status,((e=s.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(a==="session_not_found")throw new tp}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((g,v)=>g&&typeof v=="string",!0))throw new EL(Nm(s),t.status,s.weak_password.reasons);throw new BJ(Nm(s),t.status||500,a)}const hQ=(t,e,s,a)=>{const d={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?d:(d.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),d.body=JSON.stringify(a),Object.assign(Object.assign({},d),s))};async function Ni(t,e,s,a){var d;const g=Object.assign({},a==null?void 0:a.headers);g[i3]||(g[i3]=L6["2024-01-01"].name),a!=null&&a.jwt&&(g.Authorization=`Bearer ${a.jwt}`);const v=(d=a==null?void 0:a.query)!==null&&d!==void 0?d:{};a!=null&&a.redirectTo&&(v.redirect_to=a.redirectTo);const i=Object.keys(v).length?"?"+new URLSearchParams(v).toString():"",E=await dQ(t,e,s+i,{headers:g,noResolveJson:a==null?void 0:a.noResolveJson},{},a==null?void 0:a.body);return a!=null&&a.xform?a==null?void 0:a.xform(E):{data:Object.assign({},E),error:null}}async function dQ(t,e,s,a,d,g){const v=hQ(e,a,d,g);let i;try{i=await t(s,Object.assign({},v))}catch(E){throw console.error(E),new s3(Nm(E),0)}if(i.ok||await IL(i),a!=null&&a.noResolveJson)return i;try{return await i.json()}catch(E){await IL(E)}}function np(t){var e;let s=null;gQ(t)&&(s=Object.assign({},t),t.expires_at||(s.expires_at=KJ(t.expires_in)));const a=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:s,user:a},error:null}}function LL(t){const e=np(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0)&&(e.data.weak_password=t.weak_password),e}function cp(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function fQ(t){return{data:t,error:null}}function pQ(t){const{action_link:e,email_otp:s,hashed_token:a,redirect_to:d,verification_type:g}=t,v=cQ(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:e,email_otp:s,hashed_token:a,redirect_to:d,verification_type:g},E=Object.assign({},v);return{data:{properties:i,user:E},error:null}}function mQ(t){return t}function gQ(t){return t.access_token&&t.refresh_token&&t.expires_in}var _Q=function(t,e){var s={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(t);d<a.length;d++)e.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(t,a[d])&&(s[a[d]]=t[a[d]]);return s};class yQ{constructor({url:e="",headers:s={},fetch:a}){this.url=e,this.headers=s,this.fetch=D6(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,s="global"){try{return await Ni(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(a){if(yi(a))return{data:null,error:a};throw a}}async inviteUserByEmail(e,s={}){try{return await Ni(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:cp})}catch(a){if(yi(a))return{data:{user:null},error:a};throw a}}async generateLink(e){try{const{options:s}=e,a=_Q(e,["options"]),d=Object.assign(Object.assign({},a),s);return"newEmail"in a&&(d.new_email=a==null?void 0:a.newEmail,delete d.newEmail),await Ni(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:d,headers:this.headers,xform:pQ,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(yi(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(e){try{return await Ni(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:cp})}catch(s){if(yi(s))return{data:{user:null},error:s};throw s}}async listUsers(e){var s,a,d,g,v,i,E;try{const k={nextPage:null,lastPage:0,total:0},O=await Ni(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=e==null?void 0:e.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(g=(d=e==null?void 0:e.perPage)===null||d===void 0?void 0:d.toString())!==null&&g!==void 0?g:""},xform:mQ});if(O.error)throw O.error;const z=await O.json(),G=(v=O.headers.get("x-total-count"))!==null&&v!==void 0?v:0,U=(E=(i=O.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&E!==void 0?E:[];return U.length>0&&(U.forEach(ie=>{const Q=parseInt(ie.split(";")[0].split("=")[1].substring(0,1)),se=JSON.parse(ie.split(";")[1].split("=")[1]);k[`${se}Page`]=Q}),k.total=parseInt(G)),{data:Object.assign(Object.assign({},z),k),error:null}}catch(k){if(yi(k))return{data:{users:[]},error:k};throw k}}async getUserById(e){try{return await Ni(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:cp})}catch(s){if(yi(s))return{data:{user:null},error:s};throw s}}async updateUserById(e,s){try{return await Ni(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:s,headers:this.headers,xform:cp})}catch(a){if(yi(a))return{data:{user:null},error:a};throw a}}async deleteUser(e,s=!1){try{return await Ni(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:s},xform:cp})}catch(a){if(yi(a))return{data:{user:null},error:a};throw a}}async _listFactors(e){try{const{data:s,error:a}=await Ni(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:d=>({data:{factors:d},error:null})});return{data:s,error:a}}catch(s){if(yi(s))return{data:null,error:s};throw s}}async _deleteFactor(e){try{return{data:await Ni(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(s){if(yi(s))return{data:null,error:s};throw s}}}const vQ={getItem:t=>Wy()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{Wy()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{Wy()&&globalThis.localStorage.removeItem(t)}};function kL(t={}){return{getItem:e=>t[e]||null,setItem:(e,s)=>{t[e]=s},removeItem:e=>{delete t[e]}}}function xQ(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const t_={debug:!!(globalThis&&Wy()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class O6 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class bQ extends O6{}async function wQ(t,e,s){t_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const a=new globalThis.AbortController;return e>0&&setTimeout(()=>{a.abort(),t_.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async d=>{if(d){t_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,d.name);try{return await s()}finally{t_.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,d.name)}}else{if(e===0)throw t_.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new bQ(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(t_.debug)try{const g=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(g,null,"  "))}catch(g){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",g)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}xQ();const SQ={url:DJ,storageKey:NJ,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:OJ,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function RL(t,e,s){return await s()}class vv{constructor(e){var s,a;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=vv.nextInstanceID,vv.nextInstanceID+=1,this.instanceID>0&&Hh()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const d=Object.assign(Object.assign({},SQ),e);if(this.logDebugMessages=!!d.debug,typeof d.debug=="function"&&(this.logger=d.debug),this.persistSession=d.persistSession,this.storageKey=d.storageKey,this.autoRefreshToken=d.autoRefreshToken,this.admin=new yQ({url:d.url,headers:d.headers,fetch:d.fetch}),this.url=d.url,this.headers=d.headers,this.fetch=D6(d.fetch),this.lock=d.lock||RL,this.detectSessionInUrl=d.detectSessionInUrl,this.flowType=d.flowType,this.hasCustomAuthorizationHeader=d.hasCustomAuthorizationHeader,d.lock?this.lock=d.lock:Hh()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=wQ:this.lock=RL,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?d.storage?this.storage=d.storage:Wy()?this.storage=vQ:(this.memoryStorage={},this.storage=kL(this.memoryStorage)):(this.memoryStorage={},this.storage=kL(this.memoryStorage)),Hh()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(g){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",g)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async g=>{this._debug("received broadcast notification from other tab or client",g),await this._notifyAllSubscribers(g.data.event,g.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${I6}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const s=YJ(window.location.href);let a="none";if(this._isImplicitGrantCallback(s)?a="implicit":await this._isPKCECallback(s)&&(a="pkce"),Hh()&&this.detectSessionInUrl&&a!=="none"){const{data:d,error:g}=await this._getSessionFromURL(s,a);if(g){if(this._debug("#_initialize()","error detecting session from URL",g),VJ(g)){const E=(e=g.details)===null||e===void 0?void 0:e.code;if(E==="identity_already_exists"||E==="identity_not_found"||E==="single_identity_not_deletable")return{error:g}}return await this._removeSession(),{error:g}}const{session:v,redirectType:i}=d;return this._debug("#_initialize()","detected session in URL",v,"redirect type",i),await this._saveSession(v),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",v):await this._notifyAllSubscribers("SIGNED_IN",v)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return yi(s)?{error:s}:{error:new k6("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var s,a,d;try{const g=await Ni(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(d=e==null?void 0:e.options)===null||d===void 0?void 0:d.captchaToken}},xform:np}),{data:v,error:i}=g;if(i||!v)return{data:{user:null,session:null},error:i};const E=v.session,k=v.user;return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",E)),{data:{user:k,session:E},error:null}}catch(g){if(yi(g))return{data:{user:null,session:null},error:g};throw g}}async signUp(e){var s,a,d;try{let g;if("email"in e){const{email:O,password:z,options:G}=e;let U=null,ie=null;this.flowType==="pkce"&&([U,ie]=await e_(this.storage,this.storageKey)),g=await Ni(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:G==null?void 0:G.emailRedirectTo,body:{email:O,password:z,data:(s=G==null?void 0:G.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:G==null?void 0:G.captchaToken},code_challenge:U,code_challenge_method:ie},xform:np})}else if("phone"in e){const{phone:O,password:z,options:G}=e;g=await Ni(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:O,password:z,data:(a=G==null?void 0:G.data)!==null&&a!==void 0?a:{},channel:(d=G==null?void 0:G.channel)!==null&&d!==void 0?d:"sms",gotrue_meta_security:{captcha_token:G==null?void 0:G.captchaToken}},xform:np})}else throw new wx("You must provide either an email or phone number and a password");const{data:v,error:i}=g;if(i||!v)return{data:{user:null,session:null},error:i};const E=v.session,k=v.user;return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",E)),{data:{user:k,session:E},error:null}}catch(g){if(yi(g))return{data:{user:null,session:null},error:g};throw g}}async signInWithPassword(e){try{let s;if("email"in e){const{email:g,password:v,options:i}=e;s=await Ni(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:g,password:v,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:LL})}else if("phone"in e){const{phone:g,password:v,options:i}=e;s=await Ni(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:g,password:v,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:LL})}else throw new wx("You must provide either an email or phone number and a password");const{data:a,error:d}=s;return d?{data:{user:null,session:null},error:d}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new lS}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:d})}catch(s){if(yi(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(e){var s,a,d,g;return await this._handleProviderSignIn(e.provider,{redirectTo:(s=e.options)===null||s===void 0?void 0:s.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(d=e.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:(g=e.options)===null||g===void 0?void 0:g.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const s=await Tx(this.storage,`${this.storageKey}-code-verifier`),[a,d]=(s??"").split("/");try{const{data:g,error:v}=await Ni(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:a},xform:np});if(await Ax(this.storage,`${this.storageKey}-code-verifier`),v)throw v;return!g||!g.session||!g.user?{data:{user:null,session:null,redirectType:null},error:new lS}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign(Object.assign({},g),{redirectType:d??null}),error:v})}catch(g){if(yi(g))return{data:{user:null,session:null,redirectType:null},error:g};throw g}}async signInWithIdToken(e){try{const{options:s,provider:a,token:d,access_token:g,nonce:v}=e,i=await Ni(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:d,access_token:g,nonce:v,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:np}),{data:E,error:k}=i;return k?{data:{user:null,session:null},error:k}:!E||!E.session||!E.user?{data:{user:null,session:null},error:new lS}:(E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),{data:E,error:k})}catch(s){if(yi(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(e){var s,a,d,g,v;try{if("email"in e){const{email:i,options:E}=e;let k=null,O=null;this.flowType==="pkce"&&([k,O]=await e_(this.storage,this.storageKey));const{error:z}=await Ni(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(s=E==null?void 0:E.data)!==null&&s!==void 0?s:{},create_user:(a=E==null?void 0:E.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken},code_challenge:k,code_challenge_method:O},redirectTo:E==null?void 0:E.emailRedirectTo});return{data:{user:null,session:null},error:z}}if("phone"in e){const{phone:i,options:E}=e,{data:k,error:O}=await Ni(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(d=E==null?void 0:E.data)!==null&&d!==void 0?d:{},create_user:(g=E==null?void 0:E.shouldCreateUser)!==null&&g!==void 0?g:!0,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken},channel:(v=E==null?void 0:E.channel)!==null&&v!==void 0?v:"sms"}});return{data:{user:null,session:null,messageId:k==null?void 0:k.message_id},error:O}}throw new wx("You must provide either an email or phone number.")}catch(i){if(yi(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(e){var s,a;try{let d,g;"options"in e&&(d=(s=e.options)===null||s===void 0?void 0:s.redirectTo,g=(a=e.options)===null||a===void 0?void 0:a.captchaToken);const{data:v,error:i}=await Ni(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:g}}),redirectTo:d,xform:np});if(i)throw i;if(!v)throw new Error("An error occurred on token verification.");const E=v.session,k=v.user;return E!=null&&E.access_token&&(await this._saveSession(E),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",E)),{data:{user:k,session:E},error:null}}catch(d){if(yi(d))return{data:{user:null,session:null},error:d};throw d}}async signInWithSSO(e){var s,a,d;try{let g=null,v=null;return this.flowType==="pkce"&&([g,v]=await e_(this.storage,this.storageKey)),await Ni(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(a=(s=e.options)===null||s===void 0?void 0:s.redirectTo)!==null&&a!==void 0?a:void 0}),!((d=e==null?void 0:e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:g,code_challenge_method:v}),headers:this.headers,xform:fQ})}catch(g){if(yi(g))return{data:null,error:g};throw g}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:s},error:a}=e;if(a)throw a;if(!s)throw new tp;const{error:d}=await Ni(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:d}})}catch(e){if(yi(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const s=`${this.url}/resend`;if("email"in e){const{email:a,type:d,options:g}=e,{error:v}=await Ni(this.fetch,"POST",s,{headers:this.headers,body:{email:a,type:d,gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},redirectTo:g==null?void 0:g.emailRedirectTo});return{data:{user:null,session:null},error:v}}else if("phone"in e){const{phone:a,type:d,options:g}=e,{data:v,error:i}=await Ni(this.fetch,"POST",s,{headers:this.headers,body:{phone:a,type:d,gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}}});return{data:{user:null,session:null,messageId:v==null?void 0:v.message_id},error:i}}throw new wx("You must provide either an email or phone number and a type")}catch(s){if(yi(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(e,s){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),d=(async()=>(await a,await s()))();return this.pendingInLock.push((async()=>{try{await d}catch{}})()),d}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=s();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const d=[...this.pendingInLock];await Promise.all(d),this.pendingInLock.splice(0,d.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await e(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const s=await Tx(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?e=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const a=e.expires_at?e.expires_at*1e3-Date.now()<aS:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",e.expires_at),!a){if(this.storage.isServer){let v=this.suppressGetSessionWarning;e=new Proxy(e,{get:(E,k,O)=>(!v&&k==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),v=!0,this.suppressGetSessionWarning=!0),Reflect.get(E,k,O))})}return{data:{session:e},error:null}}const{session:d,error:g}=await this._callRefreshToken(e.refresh_token);return g?{data:{session:null},error:g}:{data:{session:d},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Ni(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:cp}):await this._useSession(async s=>{var a,d,g;const{data:v,error:i}=s;if(i)throw i;return!(!((a=v.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new tp}:await Ni(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(g=(d=v.session)===null||d===void 0?void 0:d.access_token)!==null&&g!==void 0?g:void 0,xform:cp})})}catch(s){if(yi(s))return UJ(s)&&(await this._removeSession(),await Ax(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(e,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,s))}async _updateUser(e,s={}){try{return await this._useSession(async a=>{const{data:d,error:g}=a;if(g)throw g;if(!d.session)throw new tp;const v=d.session;let i=null,E=null;this.flowType==="pkce"&&e.email!=null&&([i,E]=await e_(this.storage,this.storageKey));const{data:k,error:O}=await Ni(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:E}),jwt:v.access_token,xform:cp});if(O)throw O;return v.user=k.user,await this._saveSession(v),await this._notifyAllSubscribers("USER_UPDATED",v),{data:{user:v.user},error:null}})}catch(a){if(yi(a))return{data:{user:null},error:a};throw a}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new tp;const s=Date.now()/1e3;let a=s,d=!0,g=null;const{payload:v}=uS(e.access_token);if(v.exp&&(a=v.exp,d=a<=s),d){const{session:i,error:E}=await this._callRefreshToken(e.refresh_token);if(E)return{data:{user:null,session:null},error:E};if(!i)return{data:{user:null,session:null},error:null};g=i}else{const{data:i,error:E}=await this._getUser(e.access_token);if(E)throw E;g={access_token:e.access_token,refresh_token:e.refresh_token,user:i.user,token_type:"bearer",expires_in:a-s,expires_at:a},await this._saveSession(g),await this._notifyAllSubscribers("SIGNED_IN",g)}return{data:{user:g.user,session:g},error:null}}catch(s){if(yi(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async s=>{var a;if(!e){const{data:v,error:i}=s;if(i)throw i;e=(a=v.session)!==null&&a!==void 0?a:void 0}if(!(e!=null&&e.refresh_token))throw new tp;const{session:d,error:g}=await this._callRefreshToken(e.refresh_token);return g?{data:{user:null,session:null},error:g}:d?{data:{user:d.user,session:d},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(yi(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(e,s){try{if(!Hh())throw new Sx("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Sx(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new AL("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Sx("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new AL("No code detected.");const{data:te,error:le}=await this._exchangeCodeForSession(e.code);if(le)throw le;const ye=new URL(window.location.href);return ye.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ye.toString()),{data:{session:te.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:d,access_token:g,refresh_token:v,expires_in:i,expires_at:E,token_type:k}=e;if(!g||!i||!v||!k)throw new Sx("No session defined in URL");const O=Math.round(Date.now()/1e3),z=parseInt(i);let G=O+z;E&&(G=parseInt(E));const U=G-O;U*1e3<=i_&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${U}s, should have been closer to ${z}s`);const ie=G-z;O-ie>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",ie,G,O):O-ie<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",ie,G,O);const{data:Q,error:se}=await this._getUser(g);if(se)throw se;const J={provider_token:a,provider_refresh_token:d,access_token:g,expires_in:z,expires_at:G,refresh_token:v,token_type:k,user:Q.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:J,redirectType:e.type},error:null}}catch(a){if(yi(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const s=await Tx(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&s)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async s=>{var a;const{data:d,error:g}=s;if(g)return{error:g};const v=(a=d.session)===null||a===void 0?void 0:a.access_token;if(v){const{error:i}=await this.admin.signOut(v,e);if(i&&!(jJ(i)&&(i.status===404||i.status===401||i.status===403)))return{error:i}}return e!=="others"&&(await this._removeSession(),await Ax(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const s=XJ(),a={id:s,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:a}}}async _emitInitialSession(e){return await this._useSession(async s=>{var a,d;try{const{data:{session:g},error:v}=s;if(v)throw v;await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",g)),this._debug("INITIAL_SESSION","callback id",e,"session",g)}catch(g){await((d=this.stateChangeEmitters.get(e))===null||d===void 0?void 0:d.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",g),console.error(g)}})}async resetPasswordForEmail(e,s={}){let a=null,d=null;this.flowType==="pkce"&&([a,d]=await e_(this.storage,this.storageKey,!0));try{return await Ni(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:a,code_challenge_method:d,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(g){if(yi(g))return{data:null,error:g};throw g}}async getUserIdentities(){var e;try{const{data:s,error:a}=await this.getUser();if(a)throw a;return{data:{identities:(e=s.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(s){if(yi(s))return{data:null,error:s};throw s}}async linkIdentity(e){var s;try{const{data:a,error:d}=await this._useSession(async g=>{var v,i,E,k,O;const{data:z,error:G}=g;if(G)throw G;const U=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(v=e.options)===null||v===void 0?void 0:v.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(E=e.options)===null||E===void 0?void 0:E.queryParams,skipBrowserRedirect:!0});return await Ni(this.fetch,"GET",U,{headers:this.headers,jwt:(O=(k=z.session)===null||k===void 0?void 0:k.access_token)!==null&&O!==void 0?O:void 0})});if(d)throw d;return Hh()&&!(!((s=e.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(a==null?void 0:a.url),{data:{provider:e.provider,url:a==null?void 0:a.url},error:null}}catch(a){if(yi(a))return{data:{provider:e.provider,url:null},error:a};throw a}}async unlinkIdentity(e){try{return await this._useSession(async s=>{var a,d;const{data:g,error:v}=s;if(v)throw v;return await Ni(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(d=(a=g.session)===null||a===void 0?void 0:a.access_token)!==null&&d!==void 0?d:void 0})})}catch(s){if(yi(s))return{data:null,error:s};throw s}}async _refreshAccessToken(e){const s=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{const a=Date.now();return await eQ(async d=>(d>0&&await QJ(200*Math.pow(2,d-1)),this._debug(s,"refreshing attempt",d),await Ni(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:np})),(d,g)=>{const v=200*Math.pow(2,d);return g&&cS(g)&&Date.now()+v-a<i_})}catch(a){if(this._debug(s,"error",a),yi(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(s,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,s){const a=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",s,"url",a),Hh()&&!s.skipBrowserRedirect&&window.location.assign(a),{data:{provider:e,url:a},error:null}}async _recoverAndRefresh(){var e;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const a=await Tx(this.storage,this.storageKey);if(this._debug(s,"session from storage",a),!this._isValidSession(a)){this._debug(s,"session is not valid"),a!==null&&await this._removeSession();return}const d=((e=a.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<aS;if(this._debug(s,`session has${d?"":" not"} expired with margin of ${aS}s`),d){if(this.autoRefreshToken&&a.refresh_token){const{error:g}=await this._callRefreshToken(a.refresh_token);g&&(console.error(g),cS(g)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",g),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(s,"error",a),console.error(a);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var s,a;if(!e)throw new tp;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const d=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(d,"begin");try{this.refreshingDeferred=new Lw;const{data:g,error:v}=await this._refreshAccessToken(e);if(v)throw v;if(!g.session)throw new tp;await this._saveSession(g.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",g.session);const i={session:g.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(g){if(this._debug(d,"error",g),yi(g)){const v={session:null,error:g};return cS(g)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(v),v}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(g),g}finally{this.refreshingDeferred=null,this._debug(d,"end")}}async _notifyAllSubscribers(e,s,a=!0){const d=`#_notifyAllSubscribers(${e})`;this._debug(d,"begin",s,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:e,session:s});const g=[],v=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(e,s)}catch(E){g.push(E)}});if(await Promise.all(v),g.length>0){for(let i=0;i<g.length;i+=1)console.error(g[i]);throw g[0]}}finally{this._debug(d,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await N6(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ax(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Hh()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),i_);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async s=>{const{data:{session:a}}=s;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const d=Math.floor((a.expires_at*1e3-e)/i_);this._debug("#_autoRefreshTokenTick()",`access token expires in ${d} ticks, a tick lasts ${i_}ms, refresh threshold is ${r3} ticks`),d<=r3&&await this._callRefreshToken(a.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof O6)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Hh()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const s=`#_onVisibilityChanged(${e})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,s,a){const d=[`provider=${encodeURIComponent(s)}`];if(a!=null&&a.redirectTo&&d.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a!=null&&a.scopes&&d.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[g,v]=await e_(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(g)}`,code_challenge_method:`${encodeURIComponent(v)}`});d.push(i.toString())}if(a!=null&&a.queryParams){const g=new URLSearchParams(a.queryParams);d.push(g.toString())}return a!=null&&a.skipBrowserRedirect&&d.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${e}?${d.join("&")}`}async _unenroll(e){try{return await this._useSession(async s=>{var a;const{data:d,error:g}=s;return g?{data:null,error:g}:await Ni(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token})})}catch(s){if(yi(s))return{data:null,error:s};throw s}}async _enroll(e){try{return await this._useSession(async s=>{var a,d;const{data:g,error:v}=s;if(v)return{data:null,error:v};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:E,error:k}=await Ni(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(a=g==null?void 0:g.session)===null||a===void 0?void 0:a.access_token});return k?{data:null,error:k}:(e.factorType==="totp"&&(!((d=E==null?void 0:E.totp)===null||d===void 0)&&d.qr_code)&&(E.totp.qr_code=`data:image/svg+xml;utf-8,${E.totp.qr_code}`),{data:E,error:null})})}catch(s){if(yi(s))return{data:null,error:s};throw s}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var a;const{data:d,error:g}=s;if(g)return{data:null,error:g};const{data:v,error:i}=await Ni(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+v.expires_in},v)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",v),{data:v,error:i})})}catch(s){if(yi(s))return{data:null,error:s};throw s}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var a;const{data:d,error:g}=s;return g?{data:null,error:g}:await Ni(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token})})}catch(s){if(yi(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(e){const{data:s,error:a}=await this._challenge({factorId:e.factorId});return a?{data:null,error:a}:await this._verify({factorId:e.factorId,challengeId:s.id,code:e.code})}async _listFactors(){const{data:{user:e},error:s}=await this.getUser();if(s)return{data:null,error:s};const a=(e==null?void 0:e.factors)||[],d=a.filter(v=>v.factor_type==="totp"&&v.status==="verified"),g=a.filter(v=>v.factor_type==="phone"&&v.status==="verified");return{data:{all:a,totp:d,phone:g},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var s,a;const{data:{session:d},error:g}=e;if(g)return{data:null,error:g};if(!d)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:v}=uS(d.access_token);let i=null;v.aal&&(i=v.aal);let E=i;((a=(s=d.user.factors)===null||s===void 0?void 0:s.filter(z=>z.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(E="aal2");const O=v.amr||[];return{data:{currentLevel:i,nextLevel:E,currentAuthenticationMethods:O},error:null}}))}async fetchJwk(e,s={keys:[]}){let a=s.keys.find(v=>v.kid===e);if(a||(a=this.jwks.keys.find(v=>v.kid===e),a&&this.jwks_cached_at+FJ>Date.now()))return a;const{data:d,error:g}=await Ni(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(g)throw g;if(!d.keys||d.keys.length===0)throw new Hy("JWKS is empty");if(this.jwks=d,this.jwks_cached_at=Date.now(),a=d.keys.find(v=>v.kid===e),!a)throw new Hy("No matching signing key found in JWKS");return a}async getClaims(e,s={keys:[]}){try{let a=e;if(!a){const{data:U,error:ie}=await this.getSession();if(ie||!U.session)return{data:null,error:ie};a=U.session.access_token}const{header:d,payload:g,signature:v,raw:{header:i,payload:E}}=uS(a);if(aQ(g.exp),!d.kid||d.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:U}=await this.getUser(a);if(U)throw U;return{data:{claims:g,header:d,signature:v},error:null}}const k=lQ(d.alg),O=await this.fetchJwk(d.kid,s),z=await crypto.subtle.importKey("jwk",O,k,!0,["verify"]);if(!await crypto.subtle.verify(k,z,v,ZJ(`${i}.${E}`)))throw new Hy("Invalid JWT signature");return{data:{claims:g,header:d,signature:v},error:null}}catch(a){if(yi(a))return{data:null,error:a};throw a}}}vv.nextInstanceID=0;const TQ=vv;class AQ extends TQ{constructor(e){super(e)}}var EQ=function(t,e,s,a){function d(g){return g instanceof s?g:new s(function(v){v(g)})}return new(s||(s=Promise))(function(g,v){function i(O){try{k(a.next(O))}catch(z){v(z)}}function E(O){try{k(a.throw(O))}catch(z){v(z)}}function k(O){O.done?g(O.value):d(O.value).then(i,E)}k((a=a.apply(t,e||[])).next())})};class CQ{constructor(e,s,a){var d,g,v;if(this.supabaseUrl=e,this.supabaseKey=s,!e)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const i=kJ(e);this.realtimeUrl=`${i}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${i}/auth/v1`,this.storageUrl=`${i}/storage/v1`,this.functionsUrl=`${i}/functions/v1`;const E=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,k={db:TJ,realtime:EJ,auth:Object.assign(Object.assign({},AJ),{storageKey:E}),global:SJ},O=RJ(a??{},k);this.storageKey=(d=O.auth.storageKey)!==null&&d!==void 0?d:"",this.headers=(g=O.global.headers)!==null&&g!==void 0?g:{},O.accessToken?(this.accessToken=O.accessToken,this.auth=new Proxy({},{get:(z,G)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(G)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((v=O.auth)!==null&&v!==void 0?v:{},this.headers,O.global.fetch),this.fetch=IJ(s,this._getAccessToken.bind(this),O.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},O.realtime)),this.rest=new GY(`${i}/rest/v1`,{headers:this.headers,schema:O.db.schema,fetch:this.fetch}),O.accessToken||this._listenForAuthEvents()}get functions(){return new bY(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new xJ(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,s={},a={}){return this.rest.rpc(e,s,a)}channel(e,s={config:{}}){return this.realtime.channel(e,s)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,s;return EQ(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:a}=yield this.auth.getSession();return(s=(e=a.session)===null||e===void 0?void 0:e.access_token)!==null&&s!==void 0?s:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:s,detectSessionInUrl:a,storage:d,storageKey:g,flowType:v,lock:i,debug:E},k,O){const z={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new AQ({url:this.authUrl,headers:Object.assign(Object.assign({},z),k),storageKey:g,autoRefreshToken:e,persistSession:s,detectSessionInUrl:a,storage:d,flowType:v,lock:i,debug:E,fetch:O,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new oJ(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,a)=>{this._handleTokenChanged(s,"CLIENT",a==null?void 0:a.access_token)})}_handleTokenChanged(e,s,a){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==a?this.changedAccessToken=a:e==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const PQ=(t,e,s)=>new CQ(t,e,s),MQ="https://prkpjleyzzdnqxhgmnbp.supabase.co",IQ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBya3BqbGV5enpkbnF4aGdtbmJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIyMTgxODMsImV4cCI6MjA1Nzc5NDE4M30.LXp4NFhDvicu_bmvP0ibfcsr_wPAVIBpKWN82Y25IDQ",hl=PQ(MQ,IQ);async function z6(){const{data:t,error:e}=await hl.from("base_rubayia_cpf").select("*");if(e)throw new Error(e.message);return t||[]}async function F6(){const{data:t,error:e}=await hl.from("rede_bronze_amil_resumida").select("*");if(e)throw new Error(e.message);return t||[]}async function B6(){console.log("Iniciando fetchAnalises...");const t=await j6();if(t&&t!=="analise_distancia_ps"){console.log(`Usando nome de tabela encontrado: ${t}`);const{data:e,error:s}=await hl.from(t).select("*");if(!s&&e)return console.log(`Dados carregados da tabela ${t}. Total: ${e.length}`),e}try{const{data:e,error:s}=await hl.from("analise_distancia_ps").select("*");if(s){console.error("Erro ao buscar análises:",s),console.log("Tentando buscar de tabelas alternativas...");const a=await LQ();return a.length>0?a:(console.log("Gerando dados fictícios para demonstração..."),await a3())}return console.log(`Análises carregadas com sucesso. Total: ${(e==null?void 0:e.length)||0}`),e||[]}catch(e){return console.error("Exceção ao buscar análises:",e),await a3()}}let hS=null;async function j6(){if(hS)return hS;console.log("Procurando pelo nome correto da tabela de análises...");const e=(await o3()).filter(s=>s.includes("analise")||s.includes("analises")||s.includes("distancia"));console.log("Tabelas potenciais de análise:",e);for(const s of e){console.log(`Verificando estrutura da tabela: ${s}`);try{const{data:a,error:d}=await hl.from(s).select("id, cliente_id, prestador_id, distancia_km, posicao_ranking").limit(1);if(!d&&a)return console.log(`Tabela ${s} tem a estrutura correta!`),hS=s,s}catch(a){console.error(`Erro ao verificar tabela ${s}:`,a)}}return console.log("Nenhuma tabela de análise válida encontrada"),null}async function LQ(){try{const{data:e,error:s}=await hl.from("analises_distancia").select("*");if(!s&&e&&e.length>0)return console.log(`Análises carregadas com sucesso da tabela 'analises_distancia'. Total: ${e.length}`),e}catch(e){console.error("Erro na tabela alternativa 1:",e)}try{const{data:e,error:s}=await hl.from("analise_distancia").select("*");if(!s&&e&&e.length>0)return console.log(`Análises carregadas com sucesso da tabela 'analise_distancia'. Total: ${e.length}`),e}catch(e){console.error("Erro na tabela alternativa 2:",e)}try{const{data:e,error:s}=await hl.from("distancia_analise").select("*");if(!s&&e&&e.length>0)return console.log(`Análises carregadas com sucesso da tabela 'distancia_analise'. Total: ${e.length}`),e}catch(e){console.error("Erro na tabela alternativa 3:",e)}const t=await j6();if(t)try{const{data:e,error:s}=await hl.from(t).select("*");if(!s&&e&&e.length>0)return console.log(`Análises carregadas com sucesso da tabela '${t}'. Total: ${e.length}`),e}catch(e){console.error(`Erro ao acessar tabela encontrada '${t}':`,e)}return console.error("Falha ao carregar análises de qualquer tabela alternativa"),[]}async function oE(){const{data:t,error:e}=await hl.from("rede_atual").select("*");if(e)throw new Error(e.message);return t||[]}async function U6(){console.log("Verificando tabelas disponíveis...");try{const{data:t,error:e}=await hl.rpc("list_tables");return e?(console.error("Erro ao listar tabelas via RPC:",e),console.log("Tentando verificar tabelas individualmente..."),o3()):(console.log("Tabelas encontradas via RPC:",t),t||[])}catch(t){return console.error("Erro ao listar tabelas:",t),o3()}}async function o3(){const t=["analise_distancia_ps","analises_distancia","analise_distancia","distancia_analise","analise_dist","base_rubayia_cpf","rede_bronze_amil_resumida","rede_atual"],s=(await Promise.all(t.map(async a=>{try{const{error:d}=await hl.from(a).select("count(*)",{count:"exact",head:!0});return console.log(`Verificação de tabela '${a}': ${d?"ERRO":"OK"}`),d&&console.error(`Erro na tabela '${a}':`,d.message),{tableName:a,exists:!d}}catch{return console.error(`Exceção na verificação de '${a}'`),{tableName:a,exists:!1}}}))).filter(a=>a.exists).map(a=>a.tableName);return console.log("Tabelas disponíveis (verificação individual):",s),s}async function a3(){console.log("Gerando dados fictícios de análise com clientes e prestadores reais...");try{const{data:t}=await hl.from("base_rubayia_cpf").select("id, nome, uf, cliente_latitude, cliente_longitude").limit(30),{data:e}=await hl.from("rede_bronze_amil_resumida").select("id, nome_prestador, uf, municipio, prestador_latitude, prestador_longitude").limit(60);if(t!=null&&t.length&&(e!=null&&e.length)){console.log(`Gerando dados com ${t.length} clientes e ${e.length} prestadores reais`);const s=[];let a=1;return t.forEach(d=>{const g=e.filter(E=>E.uf===d.uf),v=g.length>=2?g:e;kQ(v,2).forEach((E,k)=>{const O=d.uf===E.uf?Math.random()*10:10+Math.random()*20;s.push({id:a++,cliente_id:d.id,prestador_id:E.id,distancia_km:O,posicao_ranking:k+1,cliente_nome:d.nome,cliente_uf:d.uf,prestador_nome:E.nome_prestador,prestador_uf:E.uf,cliente_latitude:d.cliente_latitude,cliente_longitude:d.cliente_longitude,prestador_latitude:E.prestador_latitude,prestador_longitude:E.prestador_longitude})})}),console.log(`Gerados ${s.length} registros fictícios com dados reais`),s}}catch(t){console.error("Erro ao gerar dados fictícios com dados reais:",t)}return RQ()}function kQ(t,e){if(t.length<=e)return[...t];const s=[],a=[...t];for(let d=0;d<e;d++){const g=Math.floor(Math.random()*a.length);s.push(a[g]),a.splice(g,1)}return s}function RQ(){console.log("Gerando dados fictícios aleatórios...");const t=[];for(let e=1;e<=50;e++)for(let s=1;s<=2;s++)t.push({id:e*100+s,cliente_id:e,prestador_id:s+100,distancia_km:Math.random()*20,posicao_ranking:s,cliente_nome:`Cliente Fictício ${e}`,prestador_nome:`Prestador Fictício ${s+100}`,cliente_uf:["SP","RJ","MG","PR","RS"][Math.floor(Math.random()*5)],prestador_uf:["SP","RJ","MG","PR","RS"][Math.floor(Math.random()*5)]});return console.log(`Gerados ${t.length} registros fictícios aleatórios`),t}const DQ=Object.freeze(Object.defineProperty({__proto__:null,fetchAnalises:B6,fetchClientes:z6,fetchPrestadores:F6,fetchRedeAtual:oE,generateMockAnaliseData:a3,listAvailableTables:U6,supabase:hl},Symbol.toStringTag,{value:"Module"}));function NQ(){const[t,e]=sA(),{toast:s}=l0(),[a,d]=ge.useState(),[g,v]=ge.useState(!1),[i,E]=ge.useState(null),[k,O]=ge.useState(null),[z,G]=ge.useState({uf:"Todos",tipoServico:"Todos",distanciaMaxima:15}),[U,ie]=ge.useState({showClients:!0,showProviders:!0,showRedeAtual:!0,showBronzeMais:!0});ge.useEffect(()=>{const ut=new URLSearchParams(window.location.search).get("city");ut&&ut in Rp&&d(ut)},[t]);const{data:Q,isLoading:se}=dc({queryKey:["/api/clientes"],staleTime:6e4}),{data:J,isLoading:te}=dc({queryKey:["/api/prestadores"],staleTime:6e4}),{data:le,isLoading:ye}=dc({queryKey:["/api/bronzeMais"],queryFn:async()=>{const{data:Fe,error:ut}=await ad(async()=>{const{data:Et,error:Ct}=await Promise.resolve().then(()=>DQ);return{data:Et,error:Ct}},void 0).then(Et=>Et.supabase.from("rede_bronze_mais_amil_resumida").select("*"));if(ut)throw new Error(ut.message);return Fe||[]},staleTime:6e4}),{data:Ne,isLoading:rt}=dc({queryKey:["/api/analises"],staleTime:6e4}),{data:xe,isLoading:Me}=dc({queryKey:["/api/statistics"],staleTime:6e4}),{data:it,isLoading:ot}=dc({queryKey:["redeAtual"],queryFn:oE,staleTime:6e4}),ve=(Q||[]).filter(Fe=>Fe.cliente_latitude&&Fe.cliente_longitude).map(Fe=>({id:Fe.id,latitude:Number(Fe.cliente_latitude),longitude:Number(Fe.cliente_longitude),name:Fe.nome||`Cliente ${Fe.id}`,type:"cliente",details:{uf:Fe.uf,cep:Fe.cep}})),Le=(J||[]).filter(Fe=>Fe.prestador_latitude&&Fe.prestador_longitude).map(Fe=>({id:Fe.id,latitude:Number(Fe.prestador_latitude),longitude:Number(Fe.prestador_longitude),name:Fe.nome_prestador||`Prestador ${Fe.id}`,type:"prestador",details:{uf:Fe.uf,cep:Fe.cep,tipo:Fe.tipo_servico,especialidade:Fe.especialidades&&Fe.especialidades.length?Fe.especialidades[0]:void 0}})),dt=(it||[]).filter(Fe=>Fe.latitude&&Fe.longitude).map(Fe=>({id:Fe.id,latitude:Number(Fe.latitude),longitude:Number(Fe.longitude),name:Fe.nome_prestador||`Prestador Rede Atual ${Fe.id}`,type:"rede_atual",details:{uf:Fe.uf,cep:Fe.cep,plano:Fe.plano,tipo:Fe.tipo_servico,especialidade:Fe.especialidade,operadora:Fe.operadora}})),Je=(le||[]).filter(Fe=>Fe.prestador_latitude&&Fe.prestador_longitude).map(Fe=>({id:Fe.id,latitude:Number(Fe.prestador_latitude),longitude:Number(Fe.prestador_longitude),name:Fe.nome_prestador||`Bronze Mais ${Fe.id}`,type:"bronzeMais",details:{uf:Fe.uf,cep:Fe.cep,tipo:Fe.tipo_servico,especialidade:Fe.especialidades&&Fe.especialidades.length?Fe.especialidades[0]:void 0}})),yt=Vs.useMemo(()=>!Q||!J||!Ne?[]:[...new Set(Ne.map(ut=>ut.cliente_id))].map(ut=>{const Et=Q.find(Ft=>Ft.id===ut);if(!Et)return null;const Wt=Ne.filter(Ft=>Ft.cliente_id===ut&&Ft.posicao_ranking<=2).sort((Ft,me)=>Ft.posicao_ranking-me.posicao_ranking).map(Ft=>{const me=J.find(dn=>dn.id===Ft.prestador_id);return{id:Ft.prestador_id,ranking:Ft.posicao_ranking,nome:Ft.prestador_nome||(me==null?void 0:me.nome_prestador)||`Prestador ${Ft.prestador_id}`,distancia:Number(Ft.distancia_km),local:(me==null?void 0:me.municipio)||Ft.prestador_uf||""}});return{clienteId:ut,clienteNome:Et.nome||`Cliente ${ut}`,clienteUf:Et.uf||"",prestadores:Wt}}).filter(Boolean),[Q,J,Ne]),St=Vs.useMemo(()=>yt?yt.map(Fe=>({cliente:{id:Fe.clienteId,nome:Fe.clienteNome,uf:Fe.clienteUf,iniciais:Fe.clienteNome?Fe.clienteNome.split(" ").map(ut=>ut.charAt(0)).join("").substring(0,2).toUpperCase():""},prestadores:Fe.prestadores})):[],[yt]),jt=Vs.useMemo(()=>yt?yt.filter(Fe=>z.uf!=="Todos"&&Fe.clienteUf!==z.uf?!1:Fe.prestadores.some(Et=>!(Et.distancia>z.distanciaMaxima))):[],[yt,z]),et=(Fe,ut)=>{E(Fe),O(ut),v(!0)},Qe=Fe=>{G(Fe)};MD({mutationFn:async Fe=>LD("POST",`/api/calculate/cliente/${Fe}`),onSuccess:()=>{s({title:"Cálculo concluído",description:"As distâncias foram calculadas com sucesso."})},onError:Fe=>{s({title:"Erro no cálculo",description:`Ocorreu um erro: ${Fe.message}`,variant:"destructive"})}});const Xe=Q==null?void 0:Q.find(Fe=>Fe.id===i),Vt=J==null?void 0:J.find(Fe=>Fe.id===k),be=Ne==null?void 0:Ne.find(Fe=>Fe.cliente_id===i&&Fe.prestador_id===k),Re=Fe=>{ie(ut=>Fe==="clients"?{...ut,showClients:!ut.showClients}:Fe==="providers"?{...ut,showProviders:!ut.showProviders}:Fe==="redeAtual"?{...ut,showRedeAtual:!ut.showRedeAtual}:Fe==="bronzeMais"?{...ut,showBronzeMais:!ut.showBronzeMais}:ut)};return V.jsxs(yA,{children:[V.jsxs("div",{className:"flex justify-between items-center mb-6",children:[V.jsxs("div",{children:[V.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Dashboard"}),V.jsx("p",{className:"text-slate-500",children:"Análise de proximidade entre clientes e prestadores"})]}),V.jsx("div",{children:V.jsx(d6,{uf:z.uf,cidade:a,mostrarClientes:U.showClients,mostrarPrestadores:U.showProviders,mostrarRedeAtual:U.showRedeAtual,distanciaMaxima:z.distanciaMaxima})})]}),V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[V.jsx(hx,{title:"Total de Clientes",value:(xe==null?void 0:xe.totalClientes)||0,icon:V.jsx(Yq,{className:"h-5 w-5 text-primary"}),trend:{value:8.5,label:"desde o último mês",isPositive:!0},iconBgColor:"bg-blue-100"}),V.jsx(hx,{title:"Total de Prestadores",value:(xe==null?void 0:xe.totalPrestadores)||0,icon:V.jsx(Fq,{className:"h-5 w-5 text-accent"}),trend:{value:3.2,label:"desde o último mês",isPositive:!1},iconBgColor:"bg-orange-100"}),V.jsx(hx,{title:"Distância Média",value:`${(xe==null?void 0:xe.avgDistance)||0} km`,icon:V.jsx(Zq,{className:"h-5 w-5 text-purple-600"}),trend:{value:5.1,label:"melhor acesso",isPositive:!0},iconBgColor:"bg-purple-100"}),V.jsx(hx,{title:"Análises Concluídas",value:(xe==null?void 0:xe.totalAnalyses)||0,icon:V.jsx(Bq,{className:"h-5 w-5 text-green-600"}),trend:{value:12.3,label:"desde a última semana",isPositive:!0},iconBgColor:"bg-green-100"})]}),V.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[V.jsx("div",{className:"lg:col-span-2",children:V.jsx(_N,{clientLocations:ve,providerLocations:Le,redeAtualLocations:dt,bronzeMaisLocations:Je,focusCity:a,isLoading:se||te||ot||ye,showClients:U.showClients,showProviders:U.showProviders,showRedeAtual:U.showRedeAtual,showBronzeMais:U.showBronzeMais,onToggleFilter:Re})}),V.jsx("div",{children:V.jsx(FW,{data:jt,isLoading:rt,onShowDetails:et,onFilterChange:Qe})})]}),V.jsx("div",{className:"mt-6",children:V.jsx(y_,{data:St,isLoading:rt,onShowDetails:et})}),V.jsx(GA,{isOpen:g,onClose:()=>v(!1),clientData:Xe?{id:Xe.id,nome:Xe.nome||`Cliente ${Xe.id}`,uf:Xe.uf||"",cep:Xe.cep||void 0,latitude:Xe.cliente_latitude?Number(Xe.cliente_latitude):void 0,longitude:Xe.cliente_longitude?Number(Xe.cliente_longitude):void 0}:void 0,prestadorData:Vt?{id:Vt.id,nome:Vt.nome_prestador||`Prestador ${Vt.id}`,uf:Vt.uf||"",cep:Vt.cep||void 0,latitude:Vt.prestador_latitude?Number(Vt.prestador_latitude):void 0,longitude:Vt.prestador_longitude?Number(Vt.prestador_longitude):void 0}:void 0,distanceData:be?{distanciaKm:Number(be.distancia_km),distanciaEuclidiana:Number(be.distancia_km)*.85,tempoEstimado:`${Math.round(Number(be.distancia_km)*2)} min`}:void 0,onGenerateReport:()=>{s({title:"Relatório gerado",description:"O relatório foi gerado com sucesso."}),v(!1)}})]})}var aE="Tabs",[OQ,hee]=Vp(aE,[ww]),V6=ww(),[zQ,lE]=OQ(aE),q6=ge.forwardRef((t,e)=>{const{__scopeTabs:s,value:a,onValueChange:d,defaultValue:g,orientation:v="horizontal",dir:i,activationMode:E="automatic",...k}=t,O=Rv(i),[z,G]=hf({prop:a,onChange:d,defaultProp:g});return V.jsx(zQ,{scope:s,baseId:id(),value:z,onValueChange:G,orientation:v,dir:O,activationMode:E,children:V.jsx(Zr.div,{dir:O,"data-orientation":v,...k,ref:e})})});q6.displayName=aE;var $6="TabsList",G6=ge.forwardRef((t,e)=>{const{__scopeTabs:s,loop:a=!0,...d}=t,g=lE($6,s),v=V6(s);return V.jsx(aF,{asChild:!0,...v,orientation:g.orientation,dir:g.dir,loop:a,children:V.jsx(Zr.div,{role:"tablist","aria-orientation":g.orientation,...d,ref:e})})});G6.displayName=$6;var H6="TabsTrigger",W6=ge.forwardRef((t,e)=>{const{__scopeTabs:s,value:a,disabled:d=!1,...g}=t,v=lE(H6,s),i=V6(s),E=X6(v.baseId,a),k=Y6(v.baseId,a),O=a===v.value;return V.jsx(lF,{asChild:!0,...i,focusable:!d,active:O,children:V.jsx(Zr.button,{type:"button",role:"tab","aria-selected":O,"aria-controls":k,"data-state":O?"active":"inactive","data-disabled":d?"":void 0,disabled:d,id:E,...g,ref:e,onMouseDown:nr(t.onMouseDown,z=>{!d&&z.button===0&&z.ctrlKey===!1?v.onValueChange(a):z.preventDefault()}),onKeyDown:nr(t.onKeyDown,z=>{[" ","Enter"].includes(z.key)&&v.onValueChange(a)}),onFocus:nr(t.onFocus,()=>{const z=v.activationMode!=="manual";!O&&!d&&z&&v.onValueChange(a)})})})});W6.displayName=H6;var Z6="TabsContent",K6=ge.forwardRef((t,e)=>{const{__scopeTabs:s,value:a,forceMount:d,children:g,...v}=t,i=lE(Z6,s),E=X6(i.baseId,a),k=Y6(i.baseId,a),O=a===i.value,z=ge.useRef(O);return ge.useEffect(()=>{const G=requestAnimationFrame(()=>z.current=!1);return()=>cancelAnimationFrame(G)},[]),V.jsx(cd,{present:d||O,children:({present:G})=>V.jsx(Zr.div,{"data-state":O?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":E,hidden:!G,id:k,tabIndex:0,...v,ref:e,style:{...t.style,animationDuration:z.current?"0s":void 0},children:G&&g})})});K6.displayName=Z6;function X6(t,e){return`${t}-trigger-${e}`}function Y6(t,e){return`${t}-content-${e}`}var FQ=q6,J6=G6,Q6=W6,eB=K6;const tB=FQ,cE=ge.forwardRef(({className:t,...e},s)=>V.jsx(J6,{ref:s,className:jr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));cE.displayName=J6.displayName;const nf=ge.forwardRef(({className:t,...e},s)=>V.jsx(Q6,{ref:s,className:jr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...e}));nf.displayName=Q6.displayName;const rf=ge.forwardRef(({className:t,...e},s)=>V.jsx(eB,{ref:s,className:jr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));rf.displayName=eB.displayName;function BQ(){const{toast:t}=l0(),[e,s]=ge.useState(!1),[a,d]=ge.useState(null),[g,v]=ge.useState(null),[i,E]=ge.useState("TODOS"),{data:k,isLoading:O}=dc({queryKey:["/api/clientes"],staleTime:6e4}),{data:z,isLoading:G}=dc({queryKey:["/api/prestadores"],staleTime:6e4}),{data:U,isLoading:ie}=dc({queryKey:["/api/analises"],staleTime:6e4}),Q=Vs.useMemo(()=>{if(!k||!z||!U)return[];const rt=new Map;return U.forEach(xe=>{if(!rt.has(xe.cliente_id)){const it=k.find(ot=>ot.id===xe.cliente_id);if(!it)return;rt.set(xe.cliente_id,{cliente:{id:it.id,nome:it.nome||`Cliente ${it.id}`,uf:it.uf||"",iniciais:it.nome?it.nome.split(" ").map(ot=>ot.charAt(0)).join("").substring(0,2).toUpperCase():""},prestadores:[]})}const Me=z.find(it=>it.id===xe.prestador_id);if(xe.posicao_ranking<=2){const it=rt.get(xe.cliente_id);it.prestadores.push({id:xe.prestador_id,nome:xe.prestador_nome||(Me==null?void 0:Me.nome_prestador)||`Prestador ${xe.prestador_id}`,local:(Me==null?void 0:Me.municipio)||xe.prestador_uf||"",distancia:Number(xe.distancia_km),ranking:xe.posicao_ranking}),it.prestadores.sort((ot,ve)=>ot.ranking-ve.ranking)}}),Array.from(rt.values())},[k,z,U]),se=Vs.useMemo(()=>i==="TODOS"?Q:Q.filter(rt=>rt.cliente.uf===i),[Q,i]),J=Vs.useMemo(()=>{const rt={SP:{clientes:0,distanciaTotal:0,distanciaMedia:0},RJ:{clientes:0,distanciaTotal:0,distanciaMedia:0},DF:{clientes:0,distanciaTotal:0,distanciaMedia:0},TODOS:{clientes:0,distanciaTotal:0,distanciaMedia:0}};return Q.forEach(xe=>{const Me=xe.cliente.uf||"Outros";xe.prestadores[0]&&(rt[Me]&&(rt[Me].clientes++,rt[Me].distanciaTotal+=xe.prestadores[0].distancia),rt.TODOS.clientes++,rt.TODOS.distanciaTotal+=xe.prestadores[0].distancia)}),Object.keys(rt).forEach(xe=>{rt[xe].clientes>0&&(rt[xe].distanciaMedia=rt[xe].distanciaTotal/rt[xe].clientes)}),rt},[Q]),te=(rt,xe)=>{d(rt),v(xe),s(!0)},le=k==null?void 0:k.find(rt=>rt.id===a),ye=z==null?void 0:z.find(rt=>rt.id===g),Ne=U==null?void 0:U.find(rt=>rt.cliente_id===a&&rt.prestador_id===g);return V.jsxs(yA,{children:[V.jsxs("div",{className:"flex justify-between items-center mb-6",children:[V.jsxs("div",{children:[V.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Relatórios de Proximidade"}),V.jsx("p",{className:"text-slate-500",children:"Relatórios detalhados das análises de distância entre clientes e prestadores"})]}),V.jsx("div",{children:V.jsx(d6,{uf:i,distanciaMaxima:15,variant:"outline"})})]}),V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[V.jsxs(Uc,{children:[V.jsxs(yu,{children:[V.jsx(vu,{children:"Relatório Completo"}),V.jsx(xu,{children:"Todos os clientes e seus prestadores mais próximos"})]}),V.jsx(Qh,{children:V.jsx("p",{className:"text-sm text-slate-500",children:"Visualize todos os clientes e os dois prestadores mais próximos para cada um, com informações detalhadas sobre distâncias."})}),V.jsx(Jd,{children:V.jsx(qs,{className:"w-full",onClick:()=>window.print(),children:"Imprimir Relatório"})})]}),V.jsxs(Uc,{children:[V.jsxs(yu,{children:[V.jsx(vu,{children:"Relatório por UF"}),V.jsx(xu,{children:"Filtre por estado para análise regional"})]}),V.jsx(Qh,{children:V.jsx("p",{className:"text-sm text-slate-500",children:"Gere relatórios específicos por UF para analisar a cobertura regional dos prestadores de saúde."})}),V.jsx(Jd,{children:V.jsx(qs,{className:"w-full",variant:"outline",onClick:()=>E(i==="TODOS"?"SP":"TODOS"),children:i==="TODOS"?"Filtrar por UF":"Mostrar Todos"})})]}),V.jsxs(Uc,{children:[V.jsxs(yu,{children:[V.jsx(vu,{children:"Relatório de Cobertura"}),V.jsx(xu,{children:"Análise de raio de cobertura"})]}),V.jsx(Qh,{children:V.jsx("p",{className:"text-sm text-slate-500",children:"Verifique a cobertura dos prestadores em diferentes raios de distância para otimizar a rede."})}),V.jsx(Jd,{children:V.jsx(qs,{className:"w-full",variant:"outline",children:"Gerar Relatório de Cobertura"})})]})]}),V.jsxs(tB,{value:i,onValueChange:rt=>E(rt),className:"mb-6",children:[V.jsxs("div",{className:"flex justify-between items-center mb-4",children:[V.jsx("h3",{className:"text-xl font-semibold text-slate-700",children:"Proximidade Cliente-Prestador"}),V.jsxs(cE,{className:"bg-slate-100",children:[V.jsx(nf,{value:"TODOS",className:"data-[state=active]:bg-white",children:"Todos"}),V.jsx(nf,{value:"SP",className:"data-[state=active]:bg-white",children:"São Paulo"}),V.jsx(nf,{value:"RJ",className:"data-[state=active]:bg-white",children:"Rio de Janeiro"}),V.jsx(nf,{value:"DF",className:"data-[state=active]:bg-white",children:"Distrito Federal"})]})]}),J[i]&&V.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-4",children:V.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[V.jsxs("div",{children:[V.jsx("p",{className:"text-sm text-slate-500",children:"Total de Clientes"}),V.jsx("p",{className:"text-2xl font-semibold text-slate-800",children:J[i].clientes})]}),V.jsxs("div",{children:[V.jsx("p",{className:"text-sm text-slate-500",children:"Distância Média"}),V.jsxs("p",{className:"text-2xl font-semibold text-slate-800",children:[J[i].distanciaMedia.toFixed(1)," km"]})]}),V.jsxs("div",{children:[V.jsx("p",{className:"text-sm text-slate-500",children:"UF"}),V.jsx("p",{className:"text-2xl font-semibold text-slate-800",children:i==="TODOS"?"Todos":i})]})]})}),V.jsxs(rf,{value:"TODOS",className:"mt-0",children:[V.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Visualizando dados de todos os estados. Utilize as abas acima para filtrar por UF específica."}),V.jsx(y_,{data:Q,isLoading:ie||O||G,onShowDetails:te,uf:"TODOS"})]}),V.jsxs(rf,{value:"SP",className:"mt-0",children:[V.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Clientes localizados em São Paulo e seus prestadores mais próximos."}),V.jsx(y_,{data:se,isLoading:ie||O||G,onShowDetails:te,uf:"SP"})]}),V.jsxs(rf,{value:"RJ",className:"mt-0",children:[V.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Clientes localizados no Rio de Janeiro e seus prestadores mais próximos."}),V.jsx(y_,{data:se,isLoading:ie||O||G,onShowDetails:te,uf:"RJ"})]}),V.jsxs(rf,{value:"DF",className:"mt-0",children:[V.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Clientes localizados no Distrito Federal e seus prestadores mais próximos."}),V.jsx(y_,{data:se,isLoading:ie||O||G,onShowDetails:te,uf:"DF"})]})]}),V.jsx(GA,{isOpen:e,onClose:()=>s(!1),clientData:le?{id:le.id,nome:le.nome||`Cliente ${le.id}`,uf:le.uf||"",cep:le.cep||void 0,latitude:le.cliente_latitude?Number(le.cliente_latitude):void 0,longitude:le.cliente_longitude?Number(le.cliente_longitude):void 0}:void 0,prestadorData:ye?{id:ye.id,nome:ye.nome_prestador||`Prestador ${ye.id}`,uf:ye.uf||"",cep:ye.cep||void 0,latitude:ye.prestador_latitude?Number(ye.prestador_latitude):void 0,longitude:ye.prestador_longitude?Number(ye.prestador_longitude):void 0}:void 0,distanceData:Ne?{distanciaKm:Number(Ne.distancia_km),distanciaEuclidiana:Number(Ne.distancia_km)*.85,tempoEstimado:`${Math.round(Number(Ne.distancia_km)*2)} min`}:void 0,onGenerateReport:()=>{t({title:"Relatório gerado",description:"O relatório foi gerado com sucesso."}),s(!1)}})]})}function jQ(){const{toast:t}=l0(),[e,s]=ge.useState({mapbox:{token:"pk.eyJ1IjoiZ3VpdmFuaGVsZGVuIiwiYSI6ImNtOGRpOHA0dTA2eXYybnB1cGZpdXE5amoifQ.AaT1j9pOdFhZwKS-H2Xfcw"},google:{apiKey:"AIzaSyCUkiOKvorfH6hVfw7Z1uiVQkKPv-XVt7w",useHaversine:!1},supabase:{url:"https://prkpjleyzzdnqxhgmnbp.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBya3BqbGV5enpkbnF4aGdtbmJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIyMTgxODMsImV4cCI6MjA1Nzc5NDE4M30.LXp4NFhDvicu_bmvP0ibfcsr_wPAVIBpKWN82Y25IDQ"},general:{circleRadius:7,maxDistanceAnalysis:20,refreshInterval:30}}),a=MD({mutationFn:async()=>LD("POST","/api/calculate/all"),onSuccess:v=>{var i,E;t({title:"Processamento concluído",description:`Cálculo em massa finalizado: ${((i=v.results)==null?void 0:i.success)||0} sucessos, ${((E=v.results)==null?void 0:E.failed)||0} falhas.`})},onError:v=>{t({title:"Erro no processamento",description:`Ocorreu um erro: ${v.message}`,variant:"destructive"})}}),d=(v,i,E)=>{s(k=>({...k,[v]:{...k[v],[i]:E}}))},g=v=>{t({title:"Configurações salvas",description:`As configurações de ${v} foram salvas com sucesso.`})};return V.jsxs(yA,{children:[V.jsxs("div",{className:"mb-6",children:[V.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Configurações"}),V.jsx("p",{className:"text-slate-500",children:"Configure as APIs e parâmetros do sistema"})]}),V.jsxs(tB,{defaultValue:"api",className:"w-full",children:[V.jsxs(cE,{className:"grid w-full grid-cols-4",children:[V.jsx(nf,{value:"api",children:"Chaves de API"}),V.jsx(nf,{value:"analysis",children:"Análise de Distância"}),V.jsx(nf,{value:"map",children:"Configurações de Mapa"}),V.jsx(nf,{value:"database",children:"Banco de Dados"})]}),V.jsx(rf,{value:"api",children:V.jsxs("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2",children:[V.jsxs(Uc,{children:[V.jsxs(yu,{children:[V.jsx(vu,{children:"Google Maps API"}),V.jsx(xu,{children:"Configure as chaves de API do Google Maps"})]}),V.jsxs(Qh,{className:"space-y-4",children:[V.jsxs("div",{className:"space-y-2",children:[V.jsx(ss,{htmlFor:"google-api-key",children:"API Key"}),V.jsx(oa,{id:"google-api-key",value:e.google.apiKey,onChange:v=>d("google","apiKey",v.target.value)}),V.jsx("p",{className:"text-xs text-slate-500",children:"Utilizada para Geocoding e Distance Matrix"})]}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx(lp,{id:"haversine",checked:e.google.useHaversine,onCheckedChange:v=>d("google","useHaversine",v)}),V.jsx(ss,{htmlFor:"haversine",children:"Usar Haversine como fallback"})]})]}),V.jsx(Jd,{children:V.jsx(qs,{onClick:()=>g("Google Maps API"),children:"Salvar Configurações"})})]}),V.jsxs(Uc,{children:[V.jsxs(yu,{children:[V.jsx(vu,{children:"Mapbox"}),V.jsx(xu,{children:"Configure a chave de API do Mapbox"})]}),V.jsx(Qh,{children:V.jsxs("div",{className:"space-y-2",children:[V.jsx(ss,{htmlFor:"mapbox-token",children:"Access Token"}),V.jsx(oa,{id:"mapbox-token",value:e.mapbox.token,onChange:v=>d("mapbox","token",v.target.value)}),V.jsx("p",{className:"text-xs text-slate-500",children:"Utilizado para a renderização de mapas"})]})}),V.jsx(Jd,{children:V.jsx(qs,{onClick:()=>g("Mapbox"),children:"Salvar Configurações"})})]})]})}),V.jsx(rf,{value:"analysis",children:V.jsxs(Uc,{children:[V.jsxs(yu,{children:[V.jsx(vu,{children:"Análise de Distância"}),V.jsx(xu,{children:"Configure parâmetros para análise de distância"})]}),V.jsxs(Qh,{className:"space-y-4",children:[V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[V.jsxs("div",{className:"space-y-2",children:[V.jsx(ss,{htmlFor:"circle-radius",children:"Raio do Círculo (km)"}),V.jsx(oa,{id:"circle-radius",type:"number",value:e.general.circleRadius,onChange:v=>d("general","circleRadius",Number(v.target.value))}),V.jsx("p",{className:"text-xs text-slate-500",children:"Raio de cobertura exibido no mapa"})]}),V.jsxs("div",{className:"space-y-2",children:[V.jsx(ss,{htmlFor:"max-distance",children:"Distância Máxima de Análise (km)"}),V.jsx(oa,{id:"max-distance",type:"number",value:e.general.maxDistanceAnalysis,onChange:v=>d("general","maxDistanceAnalysis",Number(v.target.value))}),V.jsx("p",{className:"text-xs text-slate-500",children:"Distância máxima considerada na análise"})]})]}),V.jsxs("div",{className:"pt-4 border-t",children:[V.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Operações de Dados"}),V.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[V.jsx(qs,{onClick:()=>a.mutate(),disabled:a.isPending,children:a.isPending?"Processando...":"Calcular Todas as Distâncias"}),V.jsx(qs,{variant:"outline",children:"Limpar Dados de Análise"})]}),a.isPending&&V.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Calculando distâncias para todos os clientes. Isso pode levar alguns minutos..."})]})]}),V.jsx(Jd,{children:V.jsx(qs,{onClick:()=>g("Análise de Distância"),children:"Salvar Configurações"})})]})}),V.jsx(rf,{value:"map",children:V.jsxs(Uc,{children:[V.jsxs(yu,{children:[V.jsx(vu,{children:"Configurações de Mapa"}),V.jsx(xu,{children:"Ajuste as configurações de visualização do mapa"})]}),V.jsxs(Qh,{className:"space-y-4",children:[V.jsxs("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-3",children:[V.jsxs("div",{className:"space-y-2",children:[V.jsx(ss,{children:"Estilo do Mapa"}),V.jsxs("select",{className:"w-full p-2 border rounded-md",children:[V.jsx("option",{value:"streets-v11",children:"Streets"}),V.jsx("option",{value:"light-v10",children:"Light"}),V.jsx("option",{value:"dark-v10",children:"Dark"}),V.jsx("option",{value:"satellite-v9",children:"Satellite"})]})]}),V.jsxs("div",{className:"space-y-2",children:[V.jsx(ss,{htmlFor:"default-zoom",children:"Zoom Padrão"}),V.jsx(oa,{id:"default-zoom",type:"number",defaultValue:10,min:1,max:20})]}),V.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[V.jsx(lp,{id:"3d-buildings"}),V.jsx(ss,{htmlFor:"3d-buildings",children:"Mostrar Edifícios 3D"})]})]}),V.jsxs("div",{className:"pt-4",children:[V.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Cidades Principais"}),V.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Defina as coordenadas das cidades principais"}),V.jsxs("div",{className:"space-y-4",children:[V.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[V.jsxs("div",{children:[V.jsx(ss,{children:"Cidade"}),V.jsx(oa,{defaultValue:"São Paulo",disabled:!0})]}),V.jsxs("div",{children:[V.jsx(ss,{children:"Latitude"}),V.jsx(oa,{defaultValue:"-23.5505"})]}),V.jsxs("div",{children:[V.jsx(ss,{children:"Longitude"}),V.jsx(oa,{defaultValue:"-46.6333"})]})]}),V.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[V.jsxs("div",{children:[V.jsx(ss,{children:"Cidade"}),V.jsx(oa,{defaultValue:"Rio de Janeiro",disabled:!0})]}),V.jsxs("div",{children:[V.jsx(ss,{children:"Latitude"}),V.jsx(oa,{defaultValue:"-22.9068"})]}),V.jsxs("div",{children:[V.jsx(ss,{children:"Longitude"}),V.jsx(oa,{defaultValue:"-43.1729"})]})]}),V.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[V.jsxs("div",{children:[V.jsx(ss,{children:"Cidade"}),V.jsx(oa,{defaultValue:"Brasília",disabled:!0})]}),V.jsxs("div",{children:[V.jsx(ss,{children:"Latitude"}),V.jsx(oa,{defaultValue:"-15.7801"})]}),V.jsxs("div",{children:[V.jsx(ss,{children:"Longitude"}),V.jsx(oa,{defaultValue:"-47.9292"})]})]})]})]})]}),V.jsx(Jd,{children:V.jsx(qs,{onClick:()=>g("Mapa"),children:"Salvar Configurações"})})]})}),V.jsx(rf,{value:"database",children:V.jsxs(Uc,{children:[V.jsxs(yu,{children:[V.jsx(vu,{children:"Banco de Dados (Supabase)"}),V.jsx(xu,{children:"Configure a conexão com o banco de dados"})]}),V.jsxs(Qh,{className:"space-y-4",children:[V.jsxs("div",{className:"space-y-2",children:[V.jsx(ss,{htmlFor:"supabase-url",children:"URL"}),V.jsx(oa,{id:"supabase-url",value:e.supabase.url,onChange:v=>d("supabase","url",v.target.value)})]}),V.jsxs("div",{className:"space-y-2",children:[V.jsx(ss,{htmlFor:"supabase-key",children:"Anon Key"}),V.jsx(oa,{id:"supabase-key",value:e.supabase.anonKey,onChange:v=>d("supabase","anonKey",v.target.value)})]}),V.jsxs("div",{className:"pt-4 border-t",children:[V.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Tabelas"}),V.jsxs("div",{className:"space-y-2",children:[V.jsxs("div",{className:"flex items-center justify-between bg-slate-50 p-3 rounded-lg",children:[V.jsxs("div",{children:[V.jsx("p",{className:"font-medium",children:"base_rubayia_cpf"}),V.jsx("p",{className:"text-xs text-slate-500",children:"Tabela de clientes"})]}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),V.jsx("span",{className:"text-sm text-slate-700",children:"Conectado"})]})]}),V.jsxs("div",{className:"flex items-center justify-between bg-slate-50 p-3 rounded-lg",children:[V.jsxs("div",{children:[V.jsx("p",{className:"font-medium",children:"rede_bronze_amil_resumida"}),V.jsx("p",{className:"text-xs text-slate-500",children:"Tabela de prestadores"})]}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),V.jsx("span",{className:"text-sm text-slate-700",children:"Conectado"})]})]}),V.jsxs("div",{className:"flex items-center justify-between bg-slate-50 p-3 rounded-lg",children:[V.jsxs("div",{children:[V.jsx("p",{className:"font-medium",children:"analise_distancia_ps"}),V.jsx("p",{className:"text-xs text-slate-500",children:"Tabela de análise de distância"})]}),V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),V.jsx("span",{className:"text-sm text-slate-700",children:"Conectado"})]})]})]})]})]}),V.jsx(Jd,{children:V.jsx(qs,{onClick:()=>g("Banco de Dados"),children:"Salvar Configurações"})})]})})]})]})}function UQ({children:t,pageTitle:e="Relatório Compartilhado"}){return ge.useEffect(()=>{const s=document.title;return document.title=`${e} | Health Distance Tracker`,()=>{document.title=s}},[e]),V.jsxs("div",{className:"min-h-screen bg-slate-50",children:[V.jsx("header",{className:"bg-white border-b border-slate-200 p-4",children:V.jsxs("div",{className:"container mx-auto max-w-7xl flex items-center",children:[V.jsx("div",{className:"mr-6",children:V.jsx("img",{src:"https://doc.vhseguros.com.br/files/public_html/LogoVH%2FVAN-HELDEN-cor.png",alt:"Van Helden Seguros",className:"h-12 w-auto"})}),V.jsxs("div",{children:[V.jsx("h1",{className:"text-xl font-semibold text-slate-800",children:"Análise de Distância"}),V.jsx("p",{className:"text-sm text-slate-500",children:"Cliente-Prestador"})]})]})}),V.jsx("main",{className:"container mx-auto max-w-7xl p-4",children:t}),V.jsx("footer",{className:"border-t border-slate-200 p-4 text-center text-slate-500 text-sm",children:V.jsxs("p",{children:["© ",new Date().getFullYear()," Health Distance Tracker - Van Helden Seguros"]})})]})}function VQ(){const[t,e]=sA(),{toast:s}=l0(),[a,d]=ge.useState(),[g,v]=ge.useState(!1),[i,E]=ge.useState(null),[k,O]=ge.useState(null),[z,G]=ge.useState({uf:"Todos",distanciaMaxima:15,mostrarClientes:!0,mostrarPrestadores:!0,mostrarRedeAtual:!0,mostrarBronzeMais:!0,mostrarProntoSocorro:!0});ge.useEffect(()=>{(async()=>{try{const{data:Vt,error:be}=await hl.from("analise_distancia_ps").select("count()",{count:"exact"});if(be){console.error("Erro ao conectar com a tabela analise_distancia_ps:",be),s({title:"Erro de conexão",description:`Erro ao acessar a tabela analise_distancia_ps: ${be.message}`});const Re=await U6();console.log("Tabelas disponíveis:",Re),Re.length>0&&s({title:"Tabelas disponíveis",description:`Tabelas encontradas: ${Re.join(", ")}`})}else console.log("Conexão com analise_distancia_ps bem-sucedida. Contagem:",Vt[0].count)}catch(Vt){console.error("Exceção ao verificar conexão:",Vt)}})()},[s]),ge.useEffect(()=>{const Xe=new URLSearchParams(window.location.search),Vt=Xe.get("uf");Vt&&G(Ft=>({...Ft,uf:Vt}));const be=Xe.get("cidade");be&&be in Rp&&be!=="nenhuma"&&d(be);const Re=Xe.get("clientes"),Fe=Xe.get("prestadores"),ut=Xe.get("redeAtual"),Et=Xe.get("bronzeMais"),Ct=Xe.get("prontoSocorro"),Wt=Xe.get("distancia");G(Ft=>({...Ft,mostrarClientes:Re?Re==="1":Ft.mostrarClientes,mostrarPrestadores:Fe?Fe==="1":Ft.mostrarPrestadores,mostrarRedeAtual:ut?ut==="1":Ft.mostrarRedeAtual,mostrarBronzeMais:Et?Et==="1":Ft.mostrarBronzeMais,mostrarProntoSocorro:Ct?Ct==="1":Ft.mostrarProntoSocorro,distanciaMaxima:Wt?parseInt(Wt,10):Ft.distanciaMaxima}))},[t]);const{data:U=[],isLoading:ie}=dc({queryKey:["clientes"],queryFn:z6,staleTime:6e4}),{data:Q=[],isLoading:se}=dc({queryKey:["bronzeMais"],queryFn:()=>Promise.resolve([]),staleTime:6e4});Vs.useEffect(()=>{console.log("Clientes carregados:",U.length)},[U]);const{data:J=[],isLoading:te}=dc({queryKey:["prestadores"],queryFn:F6,staleTime:6e4});Vs.useEffect(()=>{console.log("Prestadores carregados:",J.length)},[J]);const{data:le=[],isLoading:ye}=dc({queryKey:["analises"],queryFn:B6,staleTime:6e4});Vs.useEffect(()=>{console.log("Análises carregadas:",le.length)},[le]);const{data:Ne=[],isLoading:rt}=dc({queryKey:["redeAtual"],queryFn:oE,staleTime:6e4});Vs.useEffect(()=>{console.log("Rede atual carregada:",Ne.length)},[Ne]);const xe=Vs.useMemo(()=>U.map(Xe=>({id:Xe.id,latitude:Xe.cliente_latitude?Number(Xe.cliente_latitude):0,longitude:Xe.cliente_longitude?Number(Xe.cliente_longitude):0,name:Xe.nome||`Cliente ${Xe.id}`,type:"cliente",details:{uf:Xe.uf,cep:Xe.cep,plano:Xe.plano}})).filter(Xe=>Xe.latitude&&Xe.longitude),[U]),Me=Vs.useMemo(()=>J.map(Xe=>{var Vt;return{id:Xe.id,latitude:Xe.prestador_latitude?Number(Xe.prestador_latitude):0,longitude:Xe.prestador_longitude?Number(Xe.prestador_longitude):0,name:Xe.nome_prestador||`Prestador ${Xe.id}`,type:"prestador",details:{uf:Xe.uf,cep:Xe.cep,tipo:Xe.tipo_servico,especialidade:(Vt=Xe.especialidades)==null?void 0:Vt[0],operadora:"Amil"}}}).filter(Xe=>Xe.latitude&&Xe.longitude),[J]),it=Vs.useMemo(()=>Ne.map(Xe=>({id:Xe.id,latitude:Xe.latitude?Number(Xe.latitude):0,longitude:Xe.longitude?Number(Xe.longitude):0,name:Xe.nome_prestador||`Prestador Rede Atual ${Xe.id}`,type:"rede_atual",details:{uf:Xe.uf,cep:Xe.cep,tipo:Xe.tipo_servico,especialidade:Xe.especialidade,operadora:Xe.operadora}})).filter(Xe=>Xe.latitude&&Xe.longitude),[Ne]),ot=Vs.useMemo(()=>Q.map(Xe=>{var Vt;return{id:Xe.id,latitude:Xe.prestador_latitude?Number(Xe.prestador_latitude):0,longitude:Xe.prestador_longitude?Number(Xe.prestador_longitude):0,name:Xe.nome_prestador||`Prestador Bronze Mais ${Xe.id}`,type:"bronzeMais",details:{uf:Xe.uf,cep:Xe.cep,tipo:Xe.tipo_servico,especialidade:(Vt=Xe.especialidades)==null?void 0:Vt[0],operadora:"Amil Bronze Mais"}}}).filter(Xe=>Xe.latitude&&Xe.longitude),[Q]),ve=Vs.useMemo(()=>{if(!U.length||!J.length)return[];if(!le.length){console.log("Sem dados de análise disponíveis, gerando visualização de demonstração");const Vt=[];for(let be=0;be<Math.min(U.length,20);be++){const Re=U[be];let Fe=[];Re.cliente_latitude&&Re.cliente_longitude?Fe=J.filter(ut=>ut.uf===Re.uf).slice(0,5):Fe=J.filter(ut=>ut.uf===Re.uf).slice(0,2),Fe.length!==0&&Vt.push({cliente:{id:Re.id,nome:Re.nome||`Cliente ${Re.id}`,uf:Re.uf||"",iniciais:Re.nome?Re.nome.split(" ").map(ut=>ut.charAt(0)).join("").substring(0,2).toUpperCase():""},prestadores:Fe.map((ut,Et)=>({id:ut.id,nome:ut.nome_prestador||`Prestador ${ut.id}`,local:ut.municipio||ut.uf||"",distancia:Math.random()*15,ranking:Et+1}))})}return Vt}const Xe=new Map;return le.forEach(Vt=>{if(!Xe.has(Vt.cliente_id)){const Re=U.find(Fe=>Fe.id===Vt.cliente_id);if(!Re)return;Xe.set(Vt.cliente_id,{cliente:{id:Re.id,nome:Re.nome||`Cliente ${Re.id}`,uf:Re.uf||"",iniciais:Re.nome?Re.nome.split(" ").map(Fe=>Fe.charAt(0)).join("").substring(0,2).toUpperCase():""},prestadores:[]})}const be=J.find(Re=>Re.id===Vt.prestador_id);if(Vt.posicao_ranking<=2){const Re=Xe.get(Vt.cliente_id);Re.prestadores.push({id:Vt.prestador_id,nome:Vt.prestador_nome||(be==null?void 0:be.nome_prestador)||`Prestador ${Vt.prestador_id}`,local:(be==null?void 0:be.municipio)||Vt.prestador_uf||"",distancia:Number(Vt.distancia_km),ranking:Vt.posicao_ranking}),Re.prestadores.sort((Fe,ut)=>Fe.ranking-ut.ranking)}}),Array.from(Xe.values())},[U,J,le]),Le=Vs.useMemo(()=>z.uf==="Todos"?ve:ve.filter(Xe=>Xe.cliente.uf===z.uf),[ve,z.uf]),dt=Vs.useMemo(()=>{if(!Le.length)return{clientes:0,prestadoresUnicos:0,distanciaMedia:0};const Xe=new Set;let Vt=0,be=0;return Le.forEach(Re=>{Re.prestadores[0]&&(Vt+=Re.prestadores[0].distancia,be++,Xe.add(Re.prestadores[0].id)),Re.prestadores[1]&&Xe.add(Re.prestadores[1].id)}),{clientes:Le.length,prestadoresUnicos:Xe.size,distanciaMedia:be>0?Vt/be:0}},[Le]),Je=(Xe,Vt)=>{E(Xe),O(Vt),v(!0)},yt=U.find(Xe=>Xe.id===i),St=J.find(Xe=>Xe.id===k),jt=le.find(Xe=>Xe.cliente_id===i&&Xe.prestador_id===k),et=ie||te||ye||rt||se,Qe=()=>z.uf!=="Todos"?`Relatório de Proximidade - ${z.uf}`:"Mapa de Distribuição e Relatório de Proximidade";return V.jsxs(UQ,{pageTitle:Qe(),children:[V.jsxs("div",{className:"mb-6",children:[V.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Relatório Compartilhado"}),V.jsx("p",{className:"text-slate-500",children:"Mapa de Distribuição e Relatório de Proximidade Cliente-Prestador"})]}),V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[V.jsx(Uc,{children:V.jsxs(yu,{children:[V.jsx(xu,{children:"Total de Clientes"}),V.jsx(vu,{children:dt.clientes})]})}),V.jsx(Uc,{children:V.jsxs(yu,{children:[V.jsx(xu,{children:"Prestadores Únicos"}),V.jsx(vu,{children:dt.prestadoresUnicos})]})}),V.jsx(Uc,{children:V.jsxs(yu,{children:[V.jsx(xu,{children:"Distância Média"}),V.jsxs(vu,{children:[dt.distanciaMedia.toFixed(1)," km"]})]})})]}),V.jsx("div",{className:"mb-6",children:V.jsx(_N,{clientLocations:xe,providerLocations:Me,redeAtualLocations:it,bronzeMaisLocations:ot,focusCity:a,isLoading:et,showClients:z.mostrarClientes,showProviders:z.mostrarPrestadores,showRedeAtual:z.mostrarRedeAtual,showBronzeMais:z.mostrarBronzeMais,showProntoSocorro:z.mostrarProntoSocorro,onToggleFilter:Xe=>{Xe==="clients"?G(Vt=>({...Vt,mostrarClientes:!Vt.mostrarClientes})):Xe==="providers"?G(Vt=>({...Vt,mostrarPrestadores:!Vt.mostrarPrestadores})):Xe==="redeAtual"?G(Vt=>({...Vt,mostrarRedeAtual:!Vt.mostrarRedeAtual})):Xe==="bronzeMais"?G(Vt=>({...Vt,mostrarBronzeMais:!Vt.mostrarBronzeMais})):Xe==="prontoSocorro"&&G(Vt=>({...Vt,mostrarProntoSocorro:!Vt.mostrarProntoSocorro}))}})}),V.jsxs("div",{className:"mb-6",children:[V.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-4",children:"Relatório de Proximidade Cliente-Prestador"}),V.jsx(y_,{data:Le,isLoading:et,onShowDetails:Je,uf:z.uf})]}),V.jsx(GA,{isOpen:g,onClose:()=>v(!1),clientData:yt?{id:yt.id,nome:yt.nome||`Cliente ${yt.id}`,uf:yt.uf||"",cep:yt.cep||void 0,latitude:yt.cliente_latitude?Number(yt.cliente_latitude):void 0,longitude:yt.cliente_longitude?Number(yt.cliente_longitude):void 0}:void 0,prestadorData:St?{id:St.id,nome:St.nome_prestador||`Prestador ${St.id}`,uf:St.uf||"",cep:St.cep||void 0,latitude:St.prestador_latitude?Number(St.prestador_latitude):void 0,longitude:St.prestador_longitude?Number(St.prestador_longitude):void 0}:void 0,distanceData:jt?{distanciaKm:Number(jt.distancia_km),distanciaEuclidiana:Number(jt.distancia_km)*.85,tempoEstimado:`${Math.round(Number(jt.distancia_km)*2)} min`}:void 0,onGenerateReport:()=>{s({title:"Relatório gerado",description:"O relatório foi gerado com sucesso."}),v(!1)}})]})}function qQ(){return V.jsxs(s9,{children:[V.jsx(yy,{path:"/",component:NQ}),V.jsx(yy,{path:"/relatorios",component:BQ}),V.jsx(yy,{path:"/configuracoes",component:jQ}),V.jsx(yy,{path:"/compartilhado",component:VQ}),V.jsx(yy,{component:N$})]})}function $Q(){return V.jsxs(A9,{client:F9,children:[V.jsx(qQ,{}),V.jsx(D$,{})]})}rD(document.getElementById("root")).render(V.jsx($Q,{}));export{cs as _,Hc as c,l3 as g};
